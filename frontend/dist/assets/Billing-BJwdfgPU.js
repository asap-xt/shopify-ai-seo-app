import{r as e,j as n}from"./react-vendor-BXVC7v0l.js";import{L as i,C as t,B as a,a as r,i as o,T as s,y as l,z as d,G as c,d as h,I as u,f as p,D as x,b as g,M as m,x as j,h as v}from"./polaris-leLMpU_u.js";import"./app-bridge-DUY42B6P.js";import"./vendor-Cs_VgJ2r.js";const b=[10,20,50,100];function y({shop:y}){var f,w,S;const[T,A]=e.useState(!0),[k,P]=e.useState(null),[C,U]=e.useState(null),[M,L]=e.useState(!1),[R,$]=e.useState(!1),[I,D]=e.useState(!1),[O,W]=e.useState(""),[z,E]=e.useState(b[0]),[F,G]=e.useState(!1),[N,H]=e.useState(null),[Y,q]=e.useState(!1),[B,J]=e.useState(!1),[_,V]=e.useState(!1),K=e.useCallback(async()=>{var e;try{A(!0),H(null);const n=await fetch(`/api/billing/info?shop=${y}`,{headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP ${n.status}`);const i=await n.json();P(i),"pending"!==(null==(e=i.subscription)?void 0:e.status)&&i.subscription||J(!0)}catch(n){H("Failed to load billing information")}finally{A(!1)}},[y]);e.useEffect(()=>{const e=new URLSearchParams(window.location.search);if("true"===e.get("success")){const n=e.get("host"),i=e.get("embedded");if(V(!0),n&&i){const e=`/dashboard?shop=${encodeURIComponent(y)}&embedded=${i}&host=${encodeURIComponent(n)}`;window.location.href=e}}else K()},[K,y]);if(_)return n.jsx(i,{children:n.jsx(i.Section,{children:n.jsx(t,{children:n.jsx(a,{padding:"800",children:n.jsxs(r,{gap:"400",align:"center",children:[n.jsx(o,{size:"large"}),n.jsx(s,{variant:"headingMd",alignment:"center",children:"Plan Activated Successfully! ðŸŽ‰"}),n.jsx(s,{variant:"bodyMd",tone:"subdued",alignment:"center",children:"Redirecting to your Dashboard..."})]})})})})});if(T)return n.jsx(l,{title:"Plans & Billing",primaryAction:!0,children:n.jsxs(i,{children:[n.jsx(i.Section,{children:n.jsx(t,{children:n.jsxs(r,{gap:"400",children:[n.jsx(d,{size:"small"}),n.jsx(c,{lines:3})]})})}),n.jsx(i.Section,{children:n.jsx(t,{children:n.jsxs(r,{gap:"400",children:[n.jsx(d,{size:"medium"}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},children:[1,2,3,4].map(e=>n.jsx(t,{children:n.jsxs(r,{gap:"200",children:[n.jsx(d,{size:"small"}),n.jsx(c,{lines:5})]})},e))})]})})})]})});const Q=null==k?void 0:k.subscription,X=null==k?void 0:k.tokens,Z=((null==k?void 0:k.plans)||[]).filter(e=>!["starter","growth"].includes(e.key));return n.jsxs(n.Fragment,{children:[n.jsxs(i,{children:[N&&n.jsx(i.Section,{children:n.jsx(h,{title:"Error",tone:"critical",onDismiss:()=>H(null),children:n.jsx("p",{children:N})})}),B&&n.jsx(i.Section,{children:n.jsx(h,{title:"ðŸ¤– Future-Proof Your Product Discovery",tone:"success",onDismiss:()=>J(!1),children:n.jsxs(r,{gap:"200",children:[n.jsx("p",{children:"Traditional SEO isn't enough anymore. AI assistants like ChatGPT, Gemini & Perplexity need structured data to recommend your products."}),n.jsx("p",{children:"indexAIze transforms your product data into structured formats optimized for AI search engines, making it easy for ChatGPT, Gemini, Perplexity and others to find and recommend your products."}),n.jsxs("p",{children:[n.jsx("strong",{children:"âœ… Smart approach:"})," Start with a smaller plan to test optimization. Upgrade anytime to scale across your entire catalog."]})]})})}),Q&&Q.pendingActivation&&!Q.pendingPlan&&n.jsx(i.Section,{children:n.jsx(h,{title:"Plan Activation Pending",tone:"warning",action:{content:"Complete Activation",onAction:async()=>{try{G(!0),H(null);const e=await fetch("/api/billing/activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:y,endTrial:!0})}),n=await e.json();if(!e.ok)throw new Error(n.error||"Failed to activate plan");if(n.requiresApproval&&n.confirmationUrl)return void(window.top.location.href=n.confirmationUrl);const i=Date.now();window.location.href=`/billing?shop=${encodeURIComponent(y)}&_t=${i}&embedded=${new URLSearchParams(window.location.search).get("embedded")}&host=${encodeURIComponent(new URLSearchParams(window.location.search).get("host")||"")}`}catch(e){H(e.message)}finally{G(!1)}}},children:n.jsxs("p",{children:["Your ",Q.plan," plan activation is pending. Complete the activation to start using all features."]})})}),(null==Q?void 0:Q.inTrial)&&!(null==Q?void 0:Q.pendingActivation)&&n.jsx(i.Section,{children:n.jsx(h,{title:"Trial Period Active",tone:"info",action:{content:"Activate Plan",onAction:async()=>{try{G(!0),H(null);const e=await fetch("/api/billing/activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:y,endTrial:!0})}),n=await e.json();if(!e.ok)throw new Error(n.error||"Failed to activate plan");if(n.requiresApproval&&n.confirmationUrl)return void(window.top.location.href=n.confirmationUrl);const i=Date.now();window.location.href=`/billing?shop=${encodeURIComponent(y)}&_t=${i}&embedded=${new URLSearchParams(window.location.search).get("embedded")}&host=${encodeURIComponent(new URLSearchParams(window.location.search).get("host")||"")}`}catch(e){H(e.message)}finally{G(!1)}}},children:n.jsxs("p",{children:["Trial ends on ",new Date(Q.trialEndsAt).toLocaleDateString(),". Advanced AI features are locked during trial. Activate your ",Q.plan," plan to use them now."]})})}),n.jsx(i.Section,{children:n.jsx(t,{children:n.jsx(r,{gap:"400",children:n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px",alignItems:"stretch"},children:Z.map(e=>{var i;return n.jsx(t,{style:{display:"flex",flexDirection:"column",minHeight:"100%"},children:n.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 auto",gap:"12px",minHeight:0},children:[n.jsxs(u,{align:"space-between",blockAlign:"center",children:[n.jsx(s,{variant:"headingMd",children:e.name}),(null==Q?void 0:Q.plan)===e.key&&"active"===(null==Q?void 0:Q.status)&&((null==Q?void 0:Q.activatedAt)||(null==Q?void 0:Q.inTrial))&&n.jsx(p,{tone:"success",children:"Current"})]}),e.badge&&n.jsx(s,{variant:"bodySm",tone:"subdued",fontWeight:"medium",children:e.badge}),n.jsxs(s,{variant:"heading2xl",children:["$",e.price]}),n.jsx(s,{variant:"bodySm",tone:"subdued",children:"per month"}),n.jsx(x,{}),n.jsxs(s,{variant:"bodySm",tone:"subdued",children:["Optimize up to ",n.jsx("strong",{children:(null==(i=e.productLimit)?void 0:i.toLocaleString())||"N/A"})," products in up to ",n.jsx("strong",{children:e.languageLimit||1})," ",1===e.languageLimit?"language":"languages"]}),e.features&&e.features.length>0&&n.jsxs(a,{children:[n.jsx(s,{variant:"bodySm",fontWeight:"semibold",children:"Features:"}),n.jsx(r,{gap:"100",children:e.features.map((e,i)=>{const t=e.includes("ðŸ”“")?e.replace(/^âœ“\s*/,"").trim():e,a=t.startsWith("All from")||t.startsWith("âœ“")||t.includes("ðŸ”“")?t:`âœ“ ${t}`;return n.jsx(s,{variant:"bodySm",tone:"subdued",children:a},i)})})]}),n.jsx("div",{style:{flexGrow:1,flexShrink:0,minHeight:"20px"}}),n.jsx("div",{style:{marginTop:"auto",flexShrink:0},children:(null==Q?void 0:Q.plan)===e.key&&"active"===(null==Q?void 0:Q.status)&&((null==Q?void 0:Q.activatedAt)||(null==Q?void 0:Q.inTrial))?n.jsx(a,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:n.jsxs(s,{variant:"bodySm",alignment:"center",tone:"subdued",fontWeight:"medium",children:["Current Plan",(null==Q?void 0:Q.inTrial)?" (Trial)":""]})}):(null==Q?void 0:Q.plan)!==e.key||"active"!==(null==Q?void 0:Q.status)||(null==Q?void 0:Q.activatedAt)||(null==Q?void 0:Q.inTrial)?n.jsx(g,{variant:"primary",fullWidth:!0,onClick:()=>{U(e),L(!0)},children:"Select Plan"}):n.jsx(a,{background:"bg-surface-warning-subdued",padding:"300",borderRadius:"200",children:n.jsx(s,{variant:"bodySm",alignment:"center",tone:"warning",fontWeight:"medium",children:"Activation Pending"})})})]})},e.key)})})})})}),n.jsx(i.Section,{variant:"oneThird",children:n.jsx(t,{children:n.jsxs(r,{gap:"400",children:[n.jsx(s,{variant:"headingMd",children:"Token Balance"}),n.jsx(x,{}),n.jsxs(r,{gap:"300",children:[n.jsxs(a,{children:[n.jsx(s,{variant:"heading2xl",alignment:"center",children:(null==(f=null==X?void 0:X.balance)?void 0:f.toLocaleString())||0}),n.jsx(s,{variant:"bodySm",tone:"subdued",alignment:"center",children:"tokens available"}),(()=>{var e;const i=null==(e=null==Q?void 0:Q.plan)?void 0:e.toLowerCase().trim(),t="growth extra"===i;if(!t&&!("enterprise"===i))return null;const a=t?"100M":"300M";return n.jsxs(s,{variant:"bodySm",tone:"subdued",alignment:"center",fontWeight:"medium",children:["(",a," included this cycle)"]})})()]}),n.jsxs(u,{align:"space-between",children:[n.jsx(s,{variant:"bodySm",tone:"subdued",children:(()=>{var e;const n=null==(e=null==Q?void 0:Q.plan)?void 0:e.toLowerCase().trim();return"growth extra"===n||"enterprise"===n?"Additional Purchased":"Purchased"})()}),n.jsx(s,{variant:"bodySm",children:(null==(w=null==X?void 0:X.totalPurchased)?void 0:w.toLocaleString())||0})]}),n.jsxs(u,{align:"space-between",children:[n.jsx(s,{variant:"bodySm",tone:"subdued",children:"Used"}),n.jsx(s,{variant:"bodySm",children:(null==(S=null==X?void 0:X.totalUsed)?void 0:S.toLocaleString())||0})]}),n.jsx(x,{}),n.jsx(g,{variant:"primary",fullWidth:!0,onClick:()=>{"starter"===(null==Q?void 0:Q.plan)?D(!0):$(!0)},children:"Buy Tokens"}),n.jsx(a,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:n.jsxs(r,{gap:"100",children:[n.jsx(s,{variant:"bodySm",tone:"subdued",children:"ðŸ’¡ Tokens enable AI features"}),n.jsx(s,{variant:"bodySm",tone:"subdued",children:"â™»ï¸ Never expire, roll over monthly"})]})})]})]})})})]}),n.jsx(m,{open:M,onClose:()=>{L(!1),U(null),q(!1)},title:"Confirm Plan Selection",primaryAction:{content:F?"Processing...":"Confirm",loading:F,onAction:()=>(async e=>{try{G(!0),H(null),J(!1);const n=new URLSearchParams(window.location.search).get("returnTo")||"/billing",i=await fetch("/api/billing/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:y,plan:e,endTrial:Y,returnTo:n})}),t=await i.json();if(!i.ok)throw new Error(t.error||"Failed to create subscription");t.confirmationUrl&&(window.top.location.href=t.confirmationUrl)}catch(n){H(n.message)}finally{G(!1),L(!1),q(!1)}})((null==C?void 0:C.key)||(null==Q?void 0:Q.plan))},secondaryActions:[{content:"Cancel",onAction:()=>{L(!1),U(null),q(!1)}}],children:n.jsx(m.Section,{children:n.jsxs(r,{gap:"400",children:[n.jsxs(s,{children:["You are about to subscribe to the ",n.jsx("strong",{children:(null==C?void 0:C.name)||(null==Q?void 0:Q.plan)})," plan."]}),(null==Q?void 0:Q.inTrial)&&Y&&n.jsx(h,{tone:"warning",children:n.jsx("p",{children:"This will end your trial period and start billing immediately."})})]})})}),n.jsx(m,{open:R,onClose:()=>{$(!1),W(""),E(b[0])},title:"Purchase Tokens",primaryAction:{content:F?"Processing...":"Purchase",loading:F,onAction:()=>(async e=>{try{G(!0),H(null);const n=new URLSearchParams(window.location.search).get("returnTo")||"/billing",i=await fetch("/api/billing/tokens/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:y,amount:parseFloat(e),returnTo:n})}),t=await i.json();if(!i.ok)throw new Error(t.error||"Failed to purchase tokens");t.confirmationUrl&&(window.top.location.href=t.confirmationUrl)}catch(n){H(n.message)}finally{G(!1),$(!1)}})(O||z)},secondaryActions:[{content:"Cancel",onAction:()=>{$(!1),W(""),E(b[0])}}],children:n.jsx(m.Section,{children:n.jsxs(r,{gap:"400",children:[n.jsx(s,{variant:"headingMd",children:"Select Amount"}),n.jsx(j,{variant:"segmented",children:b.map(e=>n.jsxs(g,{pressed:z===e&&!O,onClick:()=>{E(e),W("")},children:["$",e]},e))}),n.jsx(s,{variant:"bodyMd",tone:"subdued",children:"Or enter a custom amount (multiples of $5)"}),n.jsx(v,{type:"number",value:O,onChange:e=>{W(e),E(null)},placeholder:"Enter amount",prefix:"$",min:5,step:5,autoComplete:"off"}),n.jsx(a,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:n.jsxs(r,{gap:"200",children:[n.jsxs(u,{align:"space-between",children:[n.jsx(s,{variant:"bodyMd",children:"Amount"}),n.jsxs(s,{variant:"bodyMd",fontWeight:"semibold",children:["$",O||z]})]}),n.jsxs(u,{align:"space-between",children:[n.jsx(s,{variant:"bodyMd",children:"Tokens"}),n.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:(e=>{const n=.15*e/.16;return Math.floor(1e6*n)})(parseFloat(O||z)).toLocaleString()})]}),n.jsx(x,{}),n.jsx(s,{variant:"bodySm",tone:"subdued",children:"Tokens never expire and roll over indefinitely"})]})}),(null==Q?void 0:Q.inTrial)&&n.jsx(h,{tone:"info",children:n.jsx("p",{children:"Your trial will continue after purchasing tokens."})})]})})}),n.jsx(m,{open:I,onClose:()=>D(!1),title:"Upgrade Required",primaryAction:{content:"View Plans",onAction:()=>{D(!1),window.scrollTo({top:0,behavior:"smooth"})}},secondaryActions:[{content:"Cancel",onAction:()=>D(!1)}],children:n.jsx(m.Section,{children:n.jsxs(r,{gap:"400",children:[n.jsxs(s,{variant:"bodyLg",children:["Token purchases require ",n.jsx("strong",{children:"Professional"})," plan or higher."]}),n.jsxs(s,{variant:"bodyMd",tone:"subdued",children:["Your current plan: ",n.jsx("strong",{children:"Starter"})]}),n.jsx(a,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:n.jsxs(r,{gap:"200",children:[n.jsx(s,{variant:"headingSm",children:"Upgrade to unlock:"}),n.jsx(s,{variant:"bodyMd",children:"âœ“ Token purchases"}),n.jsx(s,{variant:"bodyMd",children:"âœ“ AI-enhanced optimization"}),n.jsx(s,{variant:"bodyMd",children:"âœ“ Store Metadata for AI Search"}),n.jsx(s,{variant:"bodyMd",children:"âœ“ More AI bot access"}),n.jsx(s,{variant:"bodyMd",children:"âœ“ Higher product limits"})]})}),n.jsx(h,{tone:"info",children:n.jsx("p",{children:"Professional plan starts at $15.99/month with up to 250 products."})})]})})})]})}export{y as default};
