import{j as e}from"./app-bridge-CcQl0Wuq-1758088469299.js";import{r as s}from"./react-vendor-tAaa2TlE-1758088469299.js";import{m as nt}from"./index-DdBml9h3-1758088469299.js";import{M as u,d as j,T as o,a as d,I as b,f as we,B as I,D as lt,g as q,e as Ae,C as ve,h as ot,S as at,P as rt,i as it,R as ct,j as dt,l as ht,E as ut}from"./polaris-NOW1F5iJ-1758088469299.js";function gt({open:R,onClose:i,featureName:x="AI Enhancement",currentPlan:f="starter"}){const Y=()=>{i();const z=new URLSearchParams(window.location.search).get("shop"),M=`/billing${z?`?shop=${encodeURIComponent(z)}`:""}`;window.location.href=M};return e.jsx(u,{open:R,onClose:i,title:`Unlock ${x} Features`,primaryAction:{content:"Upgrade Plan",onAction:Y},secondaryActions:[{content:"Cancel",onAction:i}],children:e.jsx(u.Section,{children:e.jsxs(j,{gap:"400",children:[e.jsx(o,{variant:"bodyMd",children:"This feature is available for Growth Extra and Enterprise plans only."}),e.jsx(o,{variant:"bodyMd",children:e.jsxs("strong",{children:["Current plan: ",f]})}),e.jsxs(j,{gap:"200",children:[e.jsx(o,{variant:"bodyMd",children:e.jsx("strong",{children:"Upgrade now to get:"})}),e.jsxs(j,{gap:"100",children:[e.jsx(o,{variant:"bodyMd",children:"✓ AI-optimized bullets and FAQs"}),e.jsx(o,{variant:"bodyMd",children:"✓ Enhanced collection descriptions"}),e.jsx(o,{variant:"bodyMd",children:"✓ Other AI-enhanced features"})]})]})]})})})}const pt=(R,i="")=>{try{return new URLSearchParams(window.location.search).get(R)||i}catch{return i}};function Ot({shop:R}){const i=R||pt("shop",""),x=s.useMemo(()=>nt(),[]),[f,Y]=s.useState([]),[re,z]=s.useState(!1),[M,Ce]=s.useState(0),[S,W]=s.useState([]),[w,_]=s.useState(!1),[ft,ie]=s.useState(""),[k,K]=s.useState(""),[A,F]=s.useState("all"),[ce,X]=s.useState(!1),[Ee,Ie]=s.useState(""),[xt,Me]=s.useState([]),[C,N]=s.useState([]),[E,de]=s.useState([]),[ke,D]=s.useState(!1),[H,O]=s.useState({current:0,total:0,percent:0}),[mt,G]=s.useState(""),[$,he]=s.useState([]),[St,jt]=s.useState(!1),[yt,bt]=s.useState(null),[wt,At]=s.useState(!1),[vt,Oe]=s.useState(""),[Pe,J]=s.useState(!1),[L,T]=s.useState([]),[ue,ge]=s.useState(!1),[De,U]=s.useState(!1),[Le,V]=s.useState(!1),[pe,Q]=s.useState([]),[B,Z]=s.useState({}),[Te,ee]=s.useState(!1),[Be,te]=s.useState(!1),[fe,Ct]=s.useState({}),[Re,se]=s.useState(!1),[xe,ne]=s.useState(null),[ze,me]=s.useState(!1),[Se,m]=s.useState(""),[le,oe]=s.useState(!1),[We,je]=s.useState(!1),[$e,Ue]=s.useState("starter"),[p,ye]=s.useState({processing:!1,current:0,total:0,currentItem:"",results:null});s.useEffect(()=>{i&&x("/plans/me",{shop:i}).then(t=>{const l=(t==null?void 0:t.modelsSuggested)||["google/gemini-1.5-flash"];Me(l.map(n=>({label:n,value:n}))),Ie(l[0])}).catch(t=>m(`Error loading models: ${t.message}`))},[i,x]),s.useEffect(()=>{i&&x(`/api/languages/shop/${i}`).then(t=>{const l=(t==null?void 0:t.shopLanguages)||["en"];de(l),N([])}).catch(()=>{de(["en"]),N([])})},[i,x]);const P=s.useCallback(async()=>{z(!0);try{const t=new URLSearchParams({shop:i,...k&&{search:k},...A!=="all"&&{optimized:A}});let n=(await x(`/collections/list?${t}`)).collections||[];if(k){const c=k.toLowerCase();n=n.filter(a=>a.title.toLowerCase().includes(c)||a.handle.toLowerCase().includes(c))}A!=="all"&&(n=n.filter(c=>A==="true"?c.hasSeoData:!c.hasSeoData)),Y(n),Ce(n.length)}catch(t){m(`Error loading collections: ${t.message}`)}finally{z(!1)}},[i,k,A,x]);s.useEffect(()=>{i&&(P(),U(!1))},[i,A]),s.useEffect(()=>{const t=setTimeout(()=>{i&&P()},500);return()=>clearTimeout(t)},[k]);const Fe=s.useCallback(t=>{W(t);const l=t.some(n=>{const c=f.find(a=>a.id===n);return c==null?void 0:c.hasSeoData});U(l),t.length===0&&_(!1)},[f]),Ne=s.useCallback(t=>{if(_(t),t){W(f.map(n=>n.id));const l=f.some(n=>n.hasSeoData);U(l)}else W([]),U(!1)},[f]),He=async t=>{me(!0);try{const l=`/collections/${t.split("/").pop()}/seo-data?shop=${encodeURIComponent(i)}`,n=await x(l);ne(n),se(!0)}catch(l){m((l==null?void 0:l.status)===404?"No SEO data found for this collection":"Failed to load SEO data")}finally{me(!1)}},Ge=()=>{if(S.length===0&&!w){m("Please select collections first");return}te(!0)},Je=()=>{const t=f.filter(a=>S.includes(a.id)),l=t.filter(a=>{var r;return((r=a.optimizedLanguages)==null?void 0:r.length)>0}),n=async()=>{try{D(!0),ie("Checking eligibility...");const a=await x("/ai-enhance/check-eligibility",{method:"POST",shop:i,body:{shop:i}});if(!a.eligible){Ue(a.currentPlan||"starter"),oe(!1),je(!0);return}console.log("Selected collections:",t),console.log("Selected collections length:",t.length),console.log("Shop domain:",i),console.log("Selected language:",C);const r={successful:0,failed:0,skipped:0};for(const h of l)try{const g=h.optimizedLanguages||[];if(g.length===0){console.log(`No optimized languages for ${h.title}, skipping`),r.skipped++;continue}console.log(`Enhancing ${h.title} for languages:`,g);try{(await x(`/ai-enhance/collection/${encodeURIComponent(h.id)}`,{method:"POST",shop:i,body:{shop:i,languages:g}})).ok?r.successful++:r.failed++}catch(v){console.error("API call error:",v),r.failed++}}catch(g){console.error("Error enhancing collection:",h.id,g),r.failed++,m(`Error enhancing ${h.title}`)}ye({processing:!1,current:0,total:0,currentItem:"",results:r}),await P()}catch(a){console.error("AI Enhance error:",a),m("Failed to enhance collections")}finally{D(!1),ie("")}},c=()=>{oe(!1),ye({processing:!1,current:0,total:0,currentItem:"",results:null}),p.results&&p.results.successful>0&&P()};return!p.processing&&!p.results?e.jsx(u,{open:le,title:"AI Enhanced add-ons for AI Search",onClose:c,primaryAction:{content:"Start AI Enhancement",onAction:n},secondaryActions:[{content:"Cancel",onAction:c}],children:e.jsx(u.Section,{children:e.jsxs(j,{gap:"300",children:[e.jsxs(o,{variant:"bodyMd",children:["AI enhancement will improve bullets and FAQ for ",l.length," collections."]}),e.jsx(o,{variant:"bodySm",tone:"subdued",children:"Note: AI enhancement is only available for Growth Extra and Enterprise plans."})]})})}):p.processing?e.jsx(u,{open:le,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(u.Section,{children:e.jsxs(j,{gap:"400",children:[e.jsxs(o,{variant:"bodyMd",children:["Processing: ",p.currentItem]}),e.jsx(Ae,{progress:p.current/p.total*100}),e.jsxs(o,{variant:"bodySm",tone:"subdued",children:[p.current," of ",p.total," collections (",Math.round(p.current/p.total*100),"%)"]})]})})}):p.results!==null?e.jsx(u,{open:le,title:"AI Enhancement Results",onClose:c,primaryAction:{content:"Done",onAction:c},children:e.jsx(u.Section,{children:e.jsxs(j,{gap:"300",children:[e.jsxs(b,{gap:"400",children:[e.jsxs(d,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"success",children:p.results.successful})]}),e.jsxs(d,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:p.results.failed})]}),e.jsxs(d,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"info",children:p.results.skipped})]})]}),p.results.skippedDueToPlan>0&&e.jsx(d,{paddingBlockStart:"300",children:e.jsx(o,{variant:"bodySm",tone:"subdued",children:"AI enhancement is only available for Growth Extra and Enterprise plans."})})]})})}):null},Ve=async()=>{if(!C.length){m("Please select at least one language");return}te(!1),D(!0),O({current:0,total:0,percent:0}),he([]),Z({});try{const t=w?f:f.filter(a=>S.includes(a.id)),l=t.length;O({current:0,total:l,percent:0});const n={};for(let a=0;a<t.length;a++){const r=t[a];G(r.title);try{const v=await x("/seo/generate-collection-multi",{method:"POST",shop:i,body:{shop:i,collectionId:r.id,model:Ee,languages:C}});n[r.id]={success:!0,data:v}}catch(v){n[r.id]={success:!1,error:v.message},he(ae=>[...ae,{collection:r.title,error:v.message}])}const h=a+1,g=Math.round(h/l*100);O({current:h,total:l,percent:g})}Z(n),ee(!0);const c=Object.values(n).filter(a=>a.success).length;m(`Generated SEO for ${c} collections`)}catch(t){m(`Error: ${t.message}`)}finally{D(!1),G("")}},Qe=async()=>{var t,l;D(!0),O({current:0,total:0,percent:0});try{const n=Object.entries(B).filter(([a,r])=>r.success),c=n.length;O({current:0,total:c,percent:0});for(let a=0;a<n.length;a++){const[r,h]=n[a],g=f.find(y=>y.id===r);if(!g)continue;G(g.title);try{if(console.log("Applying SEO for collection:",r),console.log("Result data:",h.data),console.log("Results array:",(t=h.data)==null?void 0:t.results),!((l=h.data)!=null&&l.results)||!Array.isArray(h.data.results))throw new Error("Invalid results structure");const y=await x("/seo/apply-collection-multi",{method:"POST",shop:i,body:{shop:i,collectionId:r,results:h.data.results.map(be=>({language:be.language,seo:be.data})),options:{updateTitle:!0,updateDescription:!0,updateSeo:!0,updateMetafields:!0}}});if(!(y!=null&&y.ok))throw new Error((y==null?void 0:y.error)||"Apply failed")}catch(y){console.error("Apply error for collection:",r,y),$.push({id:g.id,title:g.title,message:y.message})}const v=a+1,ae=Math.round(v/c*100);O({current:v,total:c,percent:ae})}m("SEO applied successfully!"),ee(!1),Z({}),W([]),await P()}catch(n){m(`Error applying SEO: ${n.message}`)}finally{D(!1),G("")}},qe=async(t=[])=>{ge(!0),Oe("");try{const l=w?f:f.filter(r=>S.includes(r.id)),n=l.length*t.length;let c=0;const a=[];for(const r of l)for(const h of t)try{await x("/collections/delete-seo",{method:"DELETE",shop:i,body:{shop:i,collectionId:r.id,language:h}})}catch(g){console.error(`Failed to delete ${h} for ${r.title}:`,g),a.push({id:r.id,title:r.title,message:g.message})}finally{c++,O({current:c,total:n,percent:Math.round(c/n*100)})}m(`Deleted SEO for ${t.join(", ").toUpperCase()}`),setTimeout(async()=>{await P(),W([]),_(!1),U(!1)},100)}catch(l){m(`Delete error: ${l.message}`)}finally{ge(!1),Q([]),T([])}},Ye=t=>{var r,h;const l=((r=B[t.id])==null?void 0:r.success)||fe[t.id],n=((h=B[t.id])==null?void 0:h.data)||fe[t.id],c=t.optimizedLanguages||[],a=e.jsx(d,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(ht,{id:t.id,url:"",media:a,accessibilityLabel:`View details for ${t.title}`,children:e.jsxs(b,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(d,{style:{flex:"1 1 30%",minWidth:"200px"},children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:t.title}),e.jsxs(o,{variant:"bodySm",tone:"subdued",children:["Handle: ",t.handle]})]}),e.jsx(d,{style:{flex:"0 0 15%",minWidth:"100px",textAlign:"center"},children:e.jsxs(o,{variant:"bodyMd",children:[t.productsCount," products"]})}),e.jsx(d,{style:{flex:"0 0 25%",minWidth:"160px"},children:t.hasSeoData?e.jsx(b,{gap:"100",children:E.map(g=>e.jsx(q,{tone:c.includes(g)?"success":"subdued",size:"small",children:g.toUpperCase()},g))}):e.jsx(q,{tone:"subdued",children:"No AI Search Optimisation"})}),e.jsxs(d,{style:{flex:"0 0 15%",minWidth:"120px"},children:[l&&e.jsx(I,{size:"slim",onClick:()=>{ne(n),se(!0)},children:"Preview JSON"}),!l&&t.hasSeoData&&e.jsx(I,{size:"slim",loading:ze,onClick:()=>He(t.id),children:"Preview JSON"})]})]})})},_e=e.jsx(u,{open:Be,title:"Select Languages",primaryAction:{content:"Generate Optimization for AI Search",onAction:Ve,disabled:C.length===0},secondaryActions:[{content:"Cancel",onAction:()=>te(!1)}],children:e.jsx(u.Section,{children:e.jsxs(j,{gap:"300",children:[e.jsxs(o,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",w?"all":S.length," selected collections:"]}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(b,{gap:"200",wrap:!0,children:E.map(t=>e.jsx(we,{label:t.toUpperCase(),checked:C.includes(t),onChange:l=>{N(l?[...C,t]:C.filter(n=>n!==t))}},t))})}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(I,{plain:!0,onClick:()=>{N(C.length===E.length?[]:[...E])},children:C.length===E.length?"Deselect all":"Select all"})})]})})}),Ke=e.jsx(u,{open:Te&&!ke,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:Qe,disabled:!Object.values(B).some(t=>t.success)},secondaryActions:[{content:"Cancel",onAction:()=>ee(!1)}],children:e.jsx(u.Section,{children:e.jsxs(j,{gap:"300",children:[e.jsxs(b,{gap:"400",children:[e.jsxs(d,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(B).filter(t=>t.success).length})]}),e.jsxs(d,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(B).filter(t=>!t.success).length})]})]}),$.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(d,{maxHeight:"200px",overflowY:"scroll",children:[$.slice(0,10).map((t,l)=>e.jsxs(o,{variant:"bodySm",tone:"critical",children:[t.collection,": ",t.error]},l)),$.length>10&&e.jsxs(o,{variant:"bodySm",tone:"subdued",children:["... and ",$.length-10," more errors"]})]})]})]})})}),Xe=e.jsx(u,{open:Re,title:"SEO Data Preview",secondaryActions:[{content:"Close",onAction:()=>{se(!1),ne(null)}}],children:e.jsx(u.Section,{children:e.jsx(d,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",backgroundColor:"#f6f6f7",padding:"12px",borderRadius:"4px",maxHeight:"400px",overflow:"auto"},children:xe?JSON.stringify(xe,null,2):""})})})}),Ze=e.jsx(u,{open:Pe,title:"Delete Optimization for AI Search",onClose:()=>{J(!1),T([])},primaryAction:{content:"Continue",onAction:()=>{Q(L),J(!1),V(!0)},disabled:L.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{J(!1),T([])}}],children:e.jsx(u.Section,{children:e.jsxs(j,{gap:"400",children:[e.jsxs(o,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",w?M:S.length," selected collections:"]}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(b,{gap:"400",wrap:!1,children:E.map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[e.jsx("input",{type:"checkbox",checked:L.includes(t),onChange:l=>{T(l.target.checked?[...L,t]:L.filter(n=>n!==t))},style:{marginRight:"8px",width:"18px",height:"18px",cursor:"pointer"}}),e.jsx(o,{variant:"bodyMd",children:t.toUpperCase()})]},t))})}),e.jsx(d,{children:e.jsx(I,{plain:!0,onClick:()=>{T(L.length===E.length?[]:[...E])},children:"Select all"})}),e.jsx(d,{paddingBlockStart:"300",children:e.jsx(o,{variant:"bodySm",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})})]})})}),et=e.jsx(u,{open:Le,title:"Confirm Deletion",onClose:()=>{V(!1),Q([])},primaryAction:{content:"Delete",destructive:!0,onAction:async()=>{V(!1),setTimeout(()=>{qe(pe)},100)}},secondaryActions:[{content:"Cancel",onAction:()=>{V(!1),Q([]),T([])}}],children:e.jsx(u.Section,{children:e.jsxs(j,{gap:"400",children:[e.jsx(o,{variant:"bodyMd",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(b,{gap:"200",children:pe.map(t=>e.jsx(q,{tone:"warning",children:t.toUpperCase()},t))})}),e.jsxs(o,{variant:"bodyMd",children:["This will delete optimisation from ",w?M:S.length," selected collections."]}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(o,{variant:"bodySm",tone:"critical",children:"This action cannot be undone."})})]})})}),tt=ue&&e.jsx(u,{open:ue,title:"Deleting SEO Data",onClose:()=>{},noScroll:!0,children:e.jsx(u.Section,{children:e.jsxs(j,{gap:"400",children:[e.jsx(o,{variant:"bodyMd",children:"Deleting selected languages..."}),e.jsx(Ae,{progress:H.percent}),e.jsxs(o,{variant:"bodySm",tone:"subdued",children:[H.current," of ",H.total," operations (",H.percent,"%)"]})]})})}),st=e.jsx(ut,{heading:"No collections found",action:{content:"Clear filters",onAction:()=>{K(""),F("all"),P()}},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms"})});return e.jsxs(e.Fragment,{children:[e.jsx(ve,{children:e.jsxs(d,{padding:"400",children:[e.jsxs(b,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(d,{minWidth:"400px",maxWidth:"600px",children:e.jsx(ot,{label:"",placeholder:"Search by collection name...",value:k,onChange:K,prefix:e.jsx(at,{}),clearButton:!0,onClearButtonClick:()=>K("")})}),e.jsxs(j,{gap:"200",children:[e.jsx(I,{primary:!0,onClick:Ge,disabled:S.length===0&&!w,children:"Generate Optimization for AI Search"}),S.length===0&&!w||!f.filter(n=>S.includes(n.id)).some(n=>{var c;return((c=n.optimizedLanguages)==null?void 0:c.length)>0})?null:e.jsx(I,{onClick:()=>oe(!0),disabled:S.length===0&&!w,children:"AI Enhanced add-ons for AI Search"}),e.jsx(I,{outline:!0,destructive:!0,onClick:()=>J(!0),disabled:S.length===0||!De,children:"Delete Optimization for AI Search"})]})]}),M>0&&e.jsx(d,{paddingBlockStart:"300",children:e.jsx(we,{label:`Select all ${M} collections`,checked:w,onChange:Ne})})]})}),e.jsx(d,{paddingBlockStart:"400",children:e.jsxs(ve,{children:[e.jsxs(d,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsx(b,{gap:"200",wrap:!0,children:e.jsx(rt,{active:ce,activator:e.jsx(I,{disclosure:"down",onClick:()=>X(!ce),removeUnderline:!0,children:e.jsxs(b,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),A!=="all"&&e.jsx(d,{onClick:t=>{t.stopPropagation(),F("all")},children:e.jsx(o,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>X(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(it,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All collections",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[A],onChange:t=>{F(t[0]),X(!1)}})})})}),A!=="all"&&e.jsx(d,{paddingBlockStart:"200",children:e.jsx(b,{gap:"100",wrap:!0,children:e.jsx(q,{onRemove:()=>F("all"),children:A==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"})})})]}),e.jsx(ct,{resourceName:{singular:"collection",plural:"collections"},items:f,renderItem:Ye,selectedItems:S,onSelectionChange:Fe,selectable:!0,loading:re,totalItemsCount:M,emptyState:st,showHeader:!1})]})}),_e,Ke,Xe,Ze,et,tt,Je(),e.jsx(gt,{open:We,onClose:()=>je(!1),featureName:"AI Enhancement",currentPlan:$e}),Se&&e.jsx(dt,{content:Se,onDismiss:()=>m("")})]})}export{Ot as default};
