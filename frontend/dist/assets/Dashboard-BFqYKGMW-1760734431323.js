import{j as e}from"./app-bridge-VgVSxPQE-1760734431323.js";import{r as c}from"./react-vendor-tAaa2TlE-1760734431323.js";import{m as ie}from"./sessionFetch-CJepNHo3-1760734431323.js";import{L as u,C as p,a as d,T as n,d as re,e as s,f as w,I as l,B as x,D as b,g as se,h as Y,i as oe}from"./polaris-CF8QZPrM-1760734431323.js";const de=(M,h="")=>{try{return new URLSearchParams(window.location.search).get(M)||h}catch{return h}};function ue({shop:M}){var W,T,I,$,N,U,_,F,R,V,G,H,q;const h=M||de("shop",""),j=c.useMemo(()=>ie(),[]),m=t=>{const r=new URLSearchParams(window.location.search),k=r.toString()?`?${r.toString()}`:"";window.location.href=`${t}${k}`},[Q,A]=c.useState(!0),[a,J]=c.useState(null),[i,K]=c.useState(null),[z,X]=c.useState(null),[o,S]=c.useState(null),[v,y]=c.useState(!1),[Z,C]=c.useState(!1),g=c.useRef(null),[f,ee]=c.useState(!1);c.useEffect(()=>(E(),ne(),()=>{g.current&&(clearInterval(g.current),g.current=null)}),[h]),c.useEffect(()=>{o&&o.autoSyncEnabled&&!o.synced&&P()},[o]);const E=async()=>{try{A(!0);const[t,r]=await Promise.all([j(`/api/dashboard/stats?shop=${h}`),j(`/api/billing/tokens/balance?shop=${h}`)]);t&&(J(t),K(t.subscription)),r&&X(r)}catch(t){console.error("[Dashboard] Error loading data:",t)}finally{A(!1)}},ne=async()=>{try{const t=await j(`/api/dashboard/sync-status?shop=${h}`);t&&(S(t),C(t.autoSyncEnabled||!1),y(!!t.inProgress))}catch(t){console.error("[Dashboard] Error loading sync status:",t)}},P=async()=>{try{y(!0);const t=await j(`/api/dashboard/sync?shop=${h}`,{method:"POST"});console.log("[Dashboard] Sync start response:",t),t!=null&&t.success||t!=null&&t.inProgress?(g.current&&clearInterval(g.current),g.current=setInterval(async()=>{try{const r=await j(`/api/dashboard/sync-status?shop=${h}`);r&&(S(r),r.inProgress||(g.current&&(clearInterval(g.current),g.current=null),y(!1),E()))}catch(r){console.error("[Dashboard] Poll error:",r)}},2e3)):y(!1)}catch(t){console.error("[Dashboard] Error syncing:",t),y(!1)}},ae=async t=>{try{const r=await j(`/api/dashboard/auto-sync?shop=${h}`,{method:"POST",body:{enabled:t}});r!=null&&r.success?(C(!!r.autoSyncEnabled),S({...o||{},autoSyncEnabled:!!r.autoSyncEnabled})):(C(t),S({...o||{},autoSyncEnabled:t}))}catch(r){console.error("[Dashboard] Error toggling auto-sync:",r)}},B=((W=a==null?void 0:a.products)==null?void 0:W.total)>0?Math.round(a.products.optimized/a.products.total*100):0,D=((T=a==null?void 0:a.collections)==null?void 0:T.total)>0?Math.round(a.collections.optimized/a.collections.total*100):0;["growth","growth_extra","enterprise"].includes(i==null?void 0:i.plan),["professional","growth","growth_extra","enterprise"].includes(i==null?void 0:i.plan),i==null||i.plan,["growth_extra","enterprise"].includes(i==null?void 0:i.plan);const te=c.useMemo(()=>({starter:9.99,professional:29.99,growth:79.99,growth_extra:149.99,enterprise:499.99}),[]),O=i!=null&&i.price&&i.price>0?i.price:i!=null&&i.plan?te[i.plan]:void 0;if(Q)return e.jsx(u,{children:e.jsx(u.Section,{children:e.jsx(p,{children:e.jsx(d,{padding:"400",children:e.jsx(n,{children:"Loading dashboard..."})})})})});const L=!(o!=null&&o.synced);return e.jsxs(u,{children:[e.jsx(u.Section,{children:e.jsx(n,{variant:"headingLg",as:"h1",children:"Store Overview"})}),L&&e.jsx(u.Section,{children:e.jsx(re,{title:"Sync your store",tone:"info",action:{content:v?"Syncing...":"Sync Now",onAction:P,loading:v},children:e.jsxs(s,{gap:"200",children:[e.jsx(n,{children:"Sync products, collections, languages, and markets to get started with AI optimization."}),v&&e.jsxs(d,{paddingBlockStart:"200",children:[e.jsx(w,{progress:50,size:"small",tone:"highlight"}),e.jsx(d,{paddingBlockStart:"100",children:e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Fetching store data..."})})]})]})})}),!L&&o&&e.jsx(u.Section,{children:e.jsx(p,{children:e.jsxs(s,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"Store Sync"}),e.jsx(d,{paddingBlockStart:"050",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["Last synced: ",o.lastSyncDate?new Date(o.lastSyncDate).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"]})})]}),e.jsx(x,{onClick:P,loading:v,children:"Sync Now"})]}),e.jsx(b,{}),e.jsx(se,{label:"Auto-sync on load",checked:Z,onChange:ae,helpText:"Automatically sync store data when you open the dashboard"})]})})}),e.jsx(u.Section,{children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:"16px"},children:[e.jsxs("div",{style:{display:"grid",gap:16},children:[e.jsx(p,{children:e.jsxs(s,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Products & Collections"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs(s,{gap:"150",children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"Products"}),e.jsxs(l,{align:"space-between",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Total"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",children:((I=a==null?void 0:a.products)==null?void 0:I.total)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Optimized"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",tone:"success",children:(($=a==null?void 0:a.products)==null?void 0:$.optimized)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Unoptimized"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",children:Math.max((((N=a==null?void 0:a.products)==null?void 0:N.total)||0)-(((U=a==null?void 0:a.products)==null?void 0:U.optimized)||0),0)})]}),e.jsxs(d,{paddingBlockStart:"100",children:[e.jsx(w,{progress:B,size:"small",tone:B===100?"success":"primary"}),e.jsx(d,{paddingBlockStart:"050",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[B,"% optimized"]})})]})]}),e.jsxs(s,{gap:"150",children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"Collections"}),e.jsxs(l,{align:"space-between",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Total"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",children:((_=a==null?void 0:a.collections)==null?void 0:_.total)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Optimized"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",tone:"success",children:((F=a==null?void 0:a.collections)==null?void 0:F.optimized)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Unoptimized"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",children:Math.max((((R=a==null?void 0:a.collections)==null?void 0:R.total)||0)-(((V=a==null?void 0:a.collections)==null?void 0:V.optimized)||0),0)})]}),e.jsxs(d,{paddingBlockStart:"100",children:[e.jsx(w,{progress:D,size:"small",tone:D===100?"success":"primary"}),e.jsx(d,{paddingBlockStart:"050",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[D,"% optimized"]})})]})]})]}),e.jsx(b,{}),e.jsx(l,{align:"space-between",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["Last synced: ",o!=null&&o.lastSyncDate?new Date(o.lastSyncDate).toLocaleString():"Never"]})})]})}),e.jsx(p,{style:{minHeight:180},children:e.jsxs(s,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(n,{variant:"headingMd",children:"Current Plan"}),e.jsx(d,{paddingBlockStart:"100",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[O?`$${O.toFixed(2)}`:"—","/month"]})})]}),e.jsx(Y,{tone:"info",size:"large",children:((G=i==null?void 0:i.plan)==null?void 0:G.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsx(x,{onClick:()=>m("/billing"),children:"View Plans & Billing"})]})})]}),e.jsxs("div",{style:{display:"grid",gap:16},children:[e.jsx(p,{children:e.jsxs(s,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Languages & Markets"}),e.jsx(s,{gap:"200",children:a!=null&&a.languages&&a.languages.length>0?e.jsxs(e.Fragment,{children:[a.languages.slice().sort((t,r)=>(r.primary?1:0)-(t.primary?1:0)||(r.totalCount||0)-(t.totalCount||0)).slice(0,3).map((t,r)=>{const k=t.totalCount>0?Math.round(t.optimizedCount/t.totalCount*100):0;return e.jsxs(s,{gap:"050",children:[e.jsxs(l,{align:"space-between",children:[e.jsxs(n,{variant:"bodyMd",tone:"subdued",children:[t.name||t.code," ",t.primary?"★":""]}),e.jsxs(n,{variant:"bodySm",fontWeight:"semibold",children:[t.optimizedCount||0,"/",t.totalCount||0]})]}),e.jsx(w,{progress:k,size:"small",tone:k===100?"success":"primary"})]},r)}),a.languages.length>3&&e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["+",a.languages.length-3," more..."]})]}):e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"No language data"})}),(a==null?void 0:a.storeMarkets)&&a.storeMarkets.length>0&&e.jsxs(d,{paddingBlockStart:"200",children:[e.jsx(b,{}),e.jsx(d,{paddingBlockStart:"200",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["Markets: ",a.storeMarkets.slice(0,2).map(t=>t.name).join(", "),a.storeMarkets.length>2?` +${a.storeMarkets.length-2}`:""]})})]})]})}),e.jsx(p,{children:e.jsxs(s,{gap:"300",children:[e.jsx(n,{variant:"headingMd",children:"Last Optimization"}),e.jsx(n,{variant:"bodyLg",fontWeight:"semibold",children:a!=null&&a.lastOptimization?new Date(a.lastOptimization).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}),e.jsx(x,{onClick:()=>m("/ai-seo/products"),children:"Optimize Now"})]})}),e.jsx(p,{style:{minHeight:180},children:e.jsxs(s,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{variant:"headingMd",children:"Token Balance"}),e.jsx(n,{variant:"headingMd",fontWeight:"semibold",children:((H=z==null?void 0:z.balance)==null?void 0:H.toLocaleString())||0})]}),((i==null?void 0:i.plan)==="growth_extra"||(i==null?void 0:i.plan)==="enterprise")&&e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[(i==null?void 0:i.plan)==="growth_extra"?"100M":"300M"," included monthly"]}),e.jsx(x,{onClick:()=>m("/billing"),children:"Manage Tokens"})]})})]})]})}),e.jsx(u.Section,{children:e.jsx(p,{children:e.jsxs(s,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(n,{variant:"headingMd",children:"Current Plan"}),e.jsx(d,{paddingBlockStart:"100",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["$",(i==null?void 0:i.price)||0,"/month"]})})]}),e.jsx(Y,{tone:"info",size:"large",children:((q=i==null?void 0:i.plan)==null?void 0:q.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsx(x,{onClick:()=>m("/billing"),children:"View Plans & Billing"})]})})}),e.jsx(u.Section,{children:e.jsx(p,{children:e.jsxs(s,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{variant:"headingMd",children:"Getting Started"}),e.jsxs(x,{onClick:()=>ee(!f),disclosure:f?"up":"down",children:[f?"Hide":"Show"," Guide"]})]}),e.jsx(oe,{open:f,id:"onboarding-collapsible",transition:{duration:"200ms",timingFunction:"ease-in-out"},children:e.jsx(d,{paddingBlockStart:"300",children:e.jsxs(s,{gap:"400",children:[e.jsx(b,{}),e.jsxs(s,{gap:"300",children:[e.jsx(n,{variant:"headingMd",as:"h3",children:"Quick Start Guide"}),e.jsxs(s,{gap:"200",children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"1. Sync Your Store"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:'Click "Sync Now" to fetch your products, collections, and languages from Shopify. This is required before you can start optimizing.'}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"2. Choose a Plan"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Visit Plans & Billing to select the plan that fits your store size. Each plan includes different limits for products, languages, and features."}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"3. Optimize Your Products"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:'Go to "Search Optimization for AI" → Products tab. Select products and click "AI Enhance" to generate SEO-optimized titles, descriptions, and metadata.'}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"4. Generate AI Sitemap"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Navigate to Sitemap tab and generate your AI-optimized sitemap. This helps AI search engines discover and index your products."}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"5. Monitor & Improve"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Return to Dashboard regularly to track optimization progress and token usage. Enable auto-sync to keep your data fresh."})]})]}),e.jsx(b,{}),e.jsxs(s,{gap:"200",children:[e.jsx(n,{variant:"headingMd",as:"h3",children:"Video Tutorial"}),e.jsx(d,{padding:"400",background:"bg-surface-secondary",borderRadius:"200",children:e.jsxs(s,{gap:"200",inlineAlign:"center",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",alignment:"center",children:"Video tutorial coming soon"}),e.jsx(n,{variant:"bodySm",tone:"subdued",alignment:"center",children:"[Embedded video will be added here]"})]})})]}),e.jsx(d,{paddingBlockStart:"200",children:e.jsxs(l,{gap:"200",children:[e.jsx(x,{variant:"primary",onClick:()=>m("/ai-seo/products"),children:"Start Optimizing"}),e.jsx(x,{onClick:()=>m("/billing"),children:"View Plans"})]})})]})})})]})})})]})}export{ue as default};
