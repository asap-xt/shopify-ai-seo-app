import{j as e}from"./app-bridge-DqWsz3v4-1757708641058.js";import{r as o}from"./react-vendor-tAaa2TlE-1757708641058.js";import{u as jt}from"./index-D2KQQ-dm-1757708641058.js";import{M as A,d as M,T as d,e as We,a as u,I,f as Ie,B as k,D as yt,g as F,C as _e,h as bt,S as Lt,P as ge,i as pe,R as Et,j as At,k as Re,l as It,E as Ct}from"./polaris-C4cnJJsg-1757708641058.js";const vt=(z,p="")=>{try{return new URLSearchParams(window.location.search).get(z)||p}catch{return p}},Ce=z=>{if(!z)return z;const p=String(z).trim();return p.startsWith("gid://")?p:`gid://shopify/Product/${p}`},Pt=z=>{if(!z)return"";const p=String(z).match(/\/(\d+)$/);return p?p[1]:z};function Bt({shop:z}){const{api:p,shop:He}=jt(),i=z||He||vt("shop","");o.useEffect(()=>{console.log("[BULK-EDIT] Component mounted"),console.log("[BULK-EDIT] Shop:",i),console.log("[BULK-EDIT] API function available:",typeof p=="function")},[i,p]);const[T,R]=o.useState([]),[he,se]=o.useState(!1),[Fe,ve]=o.useState(1),[Ge,me]=o.useState(!0),[fe,Pe]=o.useState(0),[C,V]=o.useState([]),[w,ne]=o.useState(!1),[H,Te]=o.useState(""),[B,oe]=o.useState("all"),[D,Q]=o.useState(""),[ae,Tt]=o.useState("createdAt"),[G,qe]=o.useState("desc"),[$,le]=o.useState([]),[Je,Ve]=o.useState([]),[we,Se]=o.useState(!1),[De,xe]=o.useState(!1),[Oe,je]=o.useState(!1),[ke,ye]=o.useState(!1),[Qe,Ye]=o.useState(""),[wt,Xe]=o.useState([]),[W,ie]=o.useState([]),[v,ze]=o.useState([]),[be,q]=o.useState(!1),[re,K]=o.useState({current:0,total:0,percent:0}),[Be,J]=o.useState(""),[ce,Y]=o.useState([]),[X,Ue]=o.useState({}),[Ze,Le]=o.useState(!1),[et,de]=o.useState(!1),[tt,Z]=o.useState(!1),[N,ee]=o.useState([]),[st,ue]=o.useState(!1),[$e,j]=o.useState(""),[Ee,Me]=o.useState(!1),[b,te]=o.useState({processing:!1,current:0,total:0,currentItem:"",results:null});o.useEffect(()=>{i&&p("/plans/me",{shop:i}).then(t=>{const s=(t==null?void 0:t.modelsSuggested)||["anthropic/claude-3.5-sonnet"];Xe(s.map(n=>({label:n,value:n}))),Ye(s[0])}).catch(t=>console.error("[BULK-EDIT] /plans/me failed:",t))},[i,p]),o.useEffect(()=>{if(console.log("[BULK-EDIT] Languages useEffect triggered",{shop:i,api:!!p}),!i){console.log("[BULK-EDIT] No shop, skipping languages load");return}console.log("[BULK-EDIT] Making languages API call to:",`/api/languages/shop/${i}`),console.log("[BULK-EDIT] About to call api() function");const t=new Promise((s,n)=>{setTimeout(()=>n(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([p(`/api/languages/shop/${i}`),t]).then(s=>{console.log("[BULK-EDIT] Languages API response:",s);const n=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];console.log("[BULK-EDIT] Setting available languages to:",n.includes("en")?n:["en",...n]),ze(n.includes("en")?n:["en",...n])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),console.error("[BULK-EDIT] Error details:",s.message,s.stack),ze(["en"])})},[i,p]),o.useEffect(()=>{i&&p("/api/products/tags/list",{shop:i}).then(t=>Ve((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[i,p]);const _=o.useCallback(async(t=1,s=!1,n=null)=>{var r,c,S,l;console.log(`[BULK-EDIT-LOAD] loadProducts called with pageNum: ${t}, append: ${s}, timestamp: ${n}`),console.log("[BULK-EDIT-LOAD] Current products state:",T.length),se(!0);try{const a=new URLSearchParams({shop:i,page:t,limit:50,...B!=="all"&&{optimized:B},...H&&{search:H},...D&&{languageFilter:D},...$.length>0&&{tags:$.join(",")},sortBy:ae,sortOrder:G,...n&&{_t:n}}),g=await p(`/api/products/list?${a}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log(`[BULK-EDIT-LOAD] API returned ${((r=g.products)==null?void 0:r.length)||0} products`),((c=g.products)==null?void 0:c.length)>0&&console.log("[BULK-EDIT-LOAD] First product data:",{id:g.products[0]._id,title:g.products[0].title,optimizationSummary:g.products[0].optimizationSummary}),R(s?x=>[...x,...g.products]:g.products||[]),ve(t),me(((S=g.pagination)==null?void 0:S.hasNext)||!1),Pe(((l=g.pagination)==null?void 0:l.total)||0)}catch(a){R(s?T:[]),me(!1),j(`Error loading products: ${a.message}`)}finally{se(!1)}},[i,B,H,D,$,ae,G]);o.useEffect(()=>{i&&_(1,!1,null)},[i,_,B,D,$,ae,G]);const Ke=o.useCallback(t=>{Te(t)},[]);o.useEffect(()=>{const t=setTimeout(()=>{i&&_(1,!1,null)},500);return()=>clearTimeout(t)},[H]);const nt=o.useCallback(t=>{V(t),t.length===0&&ne(!1)},[]),ot=o.useCallback(t=>{ne(t),V(t?T.map(s=>s._id):[])},[T]),at=()=>{if(C.length===0&&!w){j("Please select products first");return}de(!0)},lt=()=>{if(C.length===0&&!w){j("Please select products first");return}ee([]),Z(!0)},it=()=>{const s=T.filter(c=>C.includes(c._id)).filter(c=>{var S,l;return((l=(S=c.optimizationSummary)==null?void 0:S.optimizedLanguages)==null?void 0:l.length)>0}),n=async()=>{var S;console.log("üîç [AI-ENHANCE] handleStartEnhancement called with products:",s),te({processing:!0,current:0,total:s.length,currentItem:"",results:null});const c={successful:0,failed:0,skipped:0,skippedDueToPlan:0};for(let l=0;l<s.length;l++){const a=s[l];te(g=>({...g,current:l,currentItem:a.title}));try{if(!(await p("/ai-enhance/check-eligibility",{method:"POST",shop:i,body:{shop:i}})).eligible){c.skipped++,c.skippedDueToPlan++;continue}const x=await p("/ai-enhance/product",{method:"POST",shop:i,body:{shop:i,productId:a.gid||`gid://shopify/Product/${a.productId}`,languages:a.optimizationSummary.optimizedLanguages}});if(console.log(`üîç [AI-ENHANCE] Product ${a.productId} enhance data:`,x),x.results&&x.results.length>0){const O={shop:i,productId:a.gid||`gid://shopify/Product/${a.productId}`,results:x.results.filter(f=>f.bullets&&f.faq).map(f=>{var P;const L=`seo_ai.seo__${f.language}`,y=(P=a.metafields)==null?void 0:P.find(U=>U.key===L);let h={};if(y!=null&&y.value)try{h=JSON.parse(y.value)}catch(U){console.warn(`Failed to parse metafield for ${f.language}:`,U),h={}}console.log(`üîç [AI-ENHANCE] Language ${f.language} - existing metafield SEO:`,JSON.stringify(h,null,2)),console.log(`üîç [AI-ENHANCE] Language ${f.language} - AI bullets:`,f.bullets),console.log(`üîç [AI-ENHANCE] Language ${f.language} - AI FAQ:`,f.faq);const E={language:f.language,seo:{title:h.title||`Product ${a.productId}`,metaDescription:h.metaDescription||"Product description",slug:h.slug||`product-${a.productId}`,bodyHtml:h.bodyHtml||"<p>Product description</p>",bullets:f.bullets||[],faq:f.faq||[],imageAlt:h.imageAlt||[],jsonLd:h.jsonLd||{}}};return console.log(`üîç [AI-ENHANCE] Language ${f.language} - final seo result:`,JSON.stringify(E.seo,null,2)),E}),options:{updateBullets:!0,updateFaq:!0}};console.log(`üîç [AI-ENHANCE] Applying data for product ${a.productId}:`,O),console.log("üîç [AI-ENHANCE] First result SEO object:",JSON.stringify((S=O.results[0])==null?void 0:S.seo,null,2));const m=await p("/api/seo/apply-multi",{method:"POST",shop:i,body:O});console.log(`üîç [AI-ENHANCE] Apply result for product ${a.productId}:`,m),c.successful++}else console.log(`üîç [AI-ENHANCE] No valid results for product ${a.productId}:`,x),c.failed++}catch(g){console.error("Enhancement error:",g),c.failed++}te(g=>({...g,current:l+1}))}te(l=>({...l,processing:!1,results:c})),j(`AI enhancement complete! ${c.successful} products enhanced.`)},r=()=>{Me(!1),te({processing:!1,current:0,total:0,currentItem:"",results:null}),b.results&&b.results.successful>0&&_(1,!1,null)};return!b.processing&&!b.results?e.jsx(A,{open:Ee,title:"AI Enhanced Search Optimisation",onClose:r,primaryAction:{content:"Start AI Enhancement",onAction:n},secondaryActions:[{content:"Cancel",onAction:r}],children:e.jsx(A.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(d,{variant:"bodyMd",children:["AI enhancement will improve bullets and FAQ for ",s.length," products."]}),e.jsx(d,{variant:"bodySm",tone:"subdued",children:"Note: AI enhancement is only available for Growth Extra and Enterprise plans."})]})})}):b.processing?e.jsx(A,{open:Ee,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(A.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsxs(d,{variant:"bodyMd",children:["Processing: ",b.currentItem]}),e.jsx(We,{progress:b.current/b.total*100}),e.jsxs(d,{variant:"bodySm",tone:"subdued",children:[b.current," of ",b.total," products (",Math.round(b.current/b.total*100),"%)"]})]})})}):b.results!==null?e.jsx(A,{open:Ee,title:"AI Enhancement Results",onClose:r,primaryAction:{content:"Done",onAction:r},children:e.jsx(A.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(I,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"success",children:b.results.successful})]}),e.jsxs(u,{children:[e.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:b.results.failed})]}),e.jsxs(u,{children:[e.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"info",children:b.results.skipped})]})]}),b.results.skippedDueToPlan>0&&e.jsx(u,{paddingBlockStart:"300",children:e.jsx(d,{variant:"bodySm",tone:"subdued",children:"AI enhancement is only available for Growth Extra and Enterprise plans."})})]})})}):null},rt=async()=>{if(!W.length){j("Please select at least one language");return}de(!1),q(!0),K({current:0,total:0,percent:0}),Y([]),Ue({});try{let t=[];w?t=(await p(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:t=T.filter(l=>C.includes(l._id));const s=t.length;K({current:0,total:s,percent:0});const n=5,r={};for(let l=0;l<t.length;l+=n){const g=t.slice(l,Math.min(l+n,t.length)).map(async m=>{var f;J(m.title||m.handle||"Product");try{const L=m.gid||Ce(m.productId||m.id),y=((f=m.optimizationSummary)==null?void 0:f.optimizedLanguages)||[],h=W.filter(P=>!y.includes(P));if(h.length===0){r[m._id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const E=await p("/api/seo/generate-multi",{method:"POST",shop:i,body:{shop:i,productId:L,model:Qe,languages:h}});r[m._id]={success:!0,data:E,languages:h}}catch(L){r[m._id]={success:!1,error:L.message},Y(y=>[...y,{product:m.title,error:L.message}])}});await Promise.all(g);const x=Math.min(l+n,t.length),O=Math.round(x/s*100);K({current:x,total:s,percent:O})}Ue(r),Le(!0);const c=Object.keys(r).filter(l=>r[l].success&&!r[l].skipped).length,S=Object.keys(r).filter(l=>r[l].skipped).length;S>0?j(`Generated AI Search Optimisation for ${c} products (${S} already optimised)`):j(`Generated AI Search Optimisation for ${c} products`)}catch(t){j(`Error: ${t.message}`)}finally{q(!1),J("")}},ct=async()=>{var t,s,n,r;q(!0),K({current:0,total:0,percent:0});try{const c=Object.entries(X).filter(([g,x])=>x.success&&!x.skipped),S=c.length;K({current:0,total:S,percent:0});for(let g=0;g<c.length;g++){const[x,O]=c[g],m=T.find(y=>y._id===x);if(!m)continue;J(m.title||"Product");try{const y=m.gid||Ce(m.productId||m.id),h=await p("/api/seo/apply-multi",{method:"POST",shop:i,body:{shop:i,productId:y,results:O.data.results.filter(E=>E==null?void 0:E.seo).map(E=>({language:E.language,seo:E.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});h.appliedLanguages&&h.appliedLanguages.length>0&&(console.log(`[BULK-EDIT] Optimistic update for product ${x}, languages:`,h.appliedLanguages),R(E=>E.map(P=>{var U;if(P._id===x){const Ae=((U=P.optimizationSummary)==null?void 0:U.optimizedLanguages)||[],xt=[...new Set([...Ae,...h.appliedLanguages])];return{...P,optimizationSummary:{...P.optimizationSummary,optimizedLanguages:xt,optimized:!0,lastOptimized:new Date().toISOString()}}}return P})))}catch(y){Y(h=>[...h,{product:m.title,error:`Apply failed: ${y.message}`}])}const f=g+1,L=Math.round(f/S*100);K({current:f,total:S,percent:L})}j("AI Search Optimisation applied successfully!"),Le(!1),V([]),ne(!1),console.log("[BULK-EDIT] Waiting for database propagation..."),await new Promise(g=>setTimeout(g,1e3)),console.log("[BULK-EDIT] Clearing products state before reload..."),R([]),console.log("[BULK-EDIT] Reloading products with cache bypass...");const l=new URLSearchParams({shop:i,page:1,limit:50,...B!=="all"&&{optimized:B},...H&&{search:H},...D&&{languageFilter:D},...$.length>0&&{tags:$.join(",")},sortBy:ae,sortOrder:G,_t:Date.now()}),a=await p(`/api/products/list?${l}`,{shop:i,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log("[BULK-EDIT] Products reloaded, first product:",(t=a.products[0])==null?void 0:t.title),console.log("[BULK-EDIT] First product optimization summary:",(s=a.products[0])==null?void 0:s.optimizationSummary),R(a.products||[]),ve(1),me(((n=a.pagination)==null?void 0:n.hasNext)||!1),Pe(((r=a.pagination)==null?void 0:r.total)||0)}catch(c){j(`Error applying AI Search Optimisation: ${c.message}`)}finally{q(!1),J("")}},dt=async()=>{var t,s;if(!N.length){j("Please select at least one language to delete");return}Z(!1),ue(!1),q(!0),K({current:0,total:0,percent:0}),Y([]);try{let n=[];w?n=(await p(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:n=T.filter(l=>C.includes(l._id));const r=n.length;K({current:0,total:r,percent:0});let c=0,S=0;for(let l=0;l<n.length;l++){const a=n[l];J(a.title||a.handle||"Product");try{const O=a.gid||Ce(a.productId||a.id),m=((t=a.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],f=N.filter(y=>m&&m.length>0&&m.includes(y));if(console.log("[BULK-DELETE] Product optimized languages:",m),console.log("[BULK-DELETE] Languages to delete:",f),f.length===0){S++;continue}const L=await p("/api/seo/delete-multi",{method:"POST",shop:i,body:{shop:i,productId:O,languages:f}});console.log("[BULK-DELETE] Delete response:",L),console.log("[BULK-DELETE] Deleted languages:",L.deletedLanguages),L.deletedLanguages&&L.deletedLanguages.length>0&&(console.log("[BULK-DELETE] Before optimistic update, product:",a),console.log("[BULK-DELETE] Current optimized languages:",(s=a.optimizationSummary)==null?void 0:s.optimizedLanguages),R(y=>y.map(h=>{var E;if(h._id===a._id){const P=((E=h.optimizationSummary)==null?void 0:E.optimizedLanguages)||[],U=P.filter(Ae=>!L.deletedLanguages.includes(Ae));return console.log("[BULK-DELETE] Updating product:",h._id),console.log("[BULK-DELETE] Languages before:",P),console.log("[BULK-DELETE] Languages after:",U),{...h,optimizationSummary:{...h.optimizationSummary,optimizedLanguages:U,optimized:U.length>0,lastOptimized:U.length>0?h.optimizationSummary.lastOptimized:null}}}return h})),console.log("[BULK-DELETE] State updated, checking first product:",T[0])),c++,L.deletedLanguages&&L.deletedLanguages.length>0&&await p("/api/products/verify-after-delete",{method:"POST",shop:i,body:{shop:i,productIds:[O],deletedLanguages:L.deletedLanguages}})}catch(O){Y(m=>[...m,{product:a.title,error:O.message}])}const g=l+1,x=Math.round(g/r*100);K({current:g,total:r,percent:x})}V([]),ne(!1),S>0?j(`Deleted AI Search Optimisation from ${c} products (${S} had no optimisation to delete)`):j(`Deleted AI Search Optimisation from ${c} products`),console.log("[BULK-DELETE] Operation successful!"),setTimeout(()=>{console.log("[BULK-DELETE] Triggering reload with timestamp");const l=Date.now();_(1,!1,l)},500)}catch(n){j(`Error: ${n.message}`)}finally{q(!1),J("")}},ut=t=>{var S,l;const s=t,n=Pt(s.productId||s.id),r=((S=s.optimizationSummary)==null?void 0:S.optimizedLanguages)||[];console.log(`[BULK-EDIT] Rendering product: "${s.title}"`),console.log("[BULK-EDIT] optimizationSummary:",s.optimizationSummary),console.log("[BULK-EDIT] optimizedLanguages:",r),console.log("[BULK-EDIT] availableLanguages:",v);const c=(l=s.images)!=null&&l[0]?e.jsx(Re,{source:s.images[0].url||s.images[0].src||s.images[0],alt:s.title,size:"small"}):s.imageUrl?e.jsx(Re,{source:s.imageUrl,alt:s.title,size:"small"}):e.jsx(u,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(It,{id:s._id,url:"",media:c,accessibilityLabel:`View details for ${s.title}`,children:e.jsxs(I,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(u,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:s.title}),e.jsxs(d,{variant:"bodySm",tone:"subdued",children:["ID: ",n]})]}),e.jsx(u,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(I,{gap:"100",children:(console.log(`[BULK-EDIT] Rendering badges for "${s.title}"`),console.log("[BULK-EDIT] availableLanguages.length:",v.length),console.log("[BULK-EDIT] availableLanguages:",v),console.log("[BULK-EDIT] optimizedLanguages:",r),v.length>0?(console.log("[BULK-EDIT] Using availableLanguages.map"),v.map(a=>{const g=r.includes(a);return console.log(`[BULK-EDIT] Language ${a}: optimized=${g}`),e.jsx(F,{tone:g?"success":"subdued",size:"small",children:a.toUpperCase()},a)})):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),r.map(a=>e.jsx(F,{tone:"success",size:"small",children:a.toUpperCase()},a))))})}),e.jsx(u,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(F,{tone:"success",children:"Active"})})]})})},gt=be&&e.jsx(A,{open:be,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(A.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsx(d,{variant:"bodyMd",children:Be?`Processing: ${Be}`:"Preparing..."}),e.jsx(We,{progress:re.percent}),e.jsxs(d,{variant:"bodySm",tone:"subdued",children:[re.current," of ",re.total," products (",re.percent,"%)"]})]})})}),pt=e.jsx(A,{open:et,title:"Select Languages",onClose:()=>{de(!1),ie([])},primaryAction:{content:"Generate AI Search Optimisation",onAction:rt,disabled:W.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{de(!1),ie([])}}],children:e.jsx(A.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(d,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",w?"all":C.length," selected products:"]}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(I,{gap:"200",wrap:!0,children:v.map(t=>e.jsx(Ie,{label:t.toUpperCase(),checked:W.includes(t),onChange:s=>{ie(s?[...W,t]:W.filter(n=>n!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{ie(W.length===v.length?[]:[...v])},children:W.length===v.length?"Deselect all":"Select all"})}),e.jsx(d,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),ht=e.jsx(A,{open:Ze&&!be,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:ct,disabled:!Object.values(X).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Le(!1)}],children:e.jsx(A.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(I,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(X).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(X).filter(t=>t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(X).filter(t=>!t.success).length})]})]}),ce.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(yt,{}),e.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(u,{maxHeight:"200px",overflowY:"scroll",children:[ce.slice(0,10).map((t,s)=>e.jsxs(d,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),ce.length>10&&e.jsxs(d,{variant:"bodySm",tone:"subdued",children:["... and ",ce.length-10," more errors"]})]})]})]})})}),mt=e.jsx(A,{open:tt,title:"Delete AI Search Optimisation",onClose:()=>{Z(!1),ee([])},primaryAction:{content:"Continue",onAction:()=>{Z(!1),ue(!0)},disabled:N.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{Z(!1),ee([])}}],children:e.jsx(A.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(d,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",w?"all":C.length," selected products:"]}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(I,{gap:"200",wrap:!0,children:v.map(t=>e.jsx(Ie,{label:t.toUpperCase(),checked:N.includes(t),onChange:s=>{ee(s?[...N,t]:N.filter(n=>n!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{ee(N.length===v.length?[]:[...v])},children:N.length===v.length?"Deselect all":"Select all"})}),e.jsx(d,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),ft=e.jsx(A,{open:st,title:"Confirm Deletion",onClose:()=>{ue(!1)},primaryAction:{content:"Delete",onAction:dt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>ue(!1)}],children:e.jsx(A.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsx(d,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(u,{paddingBlock:"200",children:e.jsx(I,{gap:"100",children:N.map(t=>e.jsx(F,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(d,{variant:"bodyMd",children:["This will delete optimisation from ",w?"ALL":C.length," selected products."]}),e.jsx(d,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Ne=async()=>{try{se(!0),j("Syncing products from Shopify...");const t=await p("/api/products/sync",{method:"POST",shop:i});if(t.success)j(`‚úÖ Synced ${t.synced} products successfully!`),setTimeout(()=>{_(1,!1,Date.now())},1e3);else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),j(`‚ùå Sync failed: ${t.message}`)}finally{se(!1)}},St=e.jsx(Ct,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Te(""),oe("all"),Q(""),le([]),_(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Ne},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(_e,{children:e.jsxs(u,{padding:"400",children:[e.jsxs(M,{gap:"300",children:[e.jsxs(I,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(u,{minWidth:"400px",children:e.jsx(bt,{label:"",placeholder:"Search by product ID, name, or details...",value:H,onChange:Ke,prefix:e.jsx(Lt,{}),clearButton:!0,onClearButtonClick:()=>Ke("")})}),e.jsx(u,{width:"320px",children:e.jsx(k,{primary:!0,onClick:at,disabled:C.length===0&&!w,size:"medium",fullWidth:!0,children:"Generate AI Search Optimisation"})})]}),e.jsxs(I,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(k,{onClick:Ne,disabled:he,size:"medium",children:"Sync Products"}),e.jsx(u,{width:"320px",children:e.jsxs(M,{gap:"200",align:"end",children:[C.length===0&&!w||!T.filter(n=>C.includes(n._id)).some(n=>{var r,c;return((c=(r=n.optimizationSummary)==null?void 0:r.optimizedLanguages)==null?void 0:c.length)>0})?null:e.jsx(k,{onClick:()=>Me(!0),disabled:C.length===0&&!w,size:"medium",fullWidth:!0,children:"AI Enhanced Search Optimisation"}),e.jsx(k,{onClick:lt,disabled:C.length===0&&!w||!T.filter(n=>C.includes(n._id)).some(n=>{var r,c;return((c=(r=n.optimizationSummary)==null?void 0:r.optimizedLanguages)==null?void 0:c.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete AI Search Optimisation"})]})})]})]}),fe>0&&e.jsx(u,{paddingBlockStart:"300",children:e.jsx(Ie,{label:`Select all ${fe} products in your store`,checked:w,onChange:ot})})]})}),e.jsx(u,{paddingBlockStart:"400",children:e.jsxs(_e,{children:[e.jsxs(u,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(I,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(I,{gap:"200",wrap:!0,children:[e.jsx(ge,{active:we,activator:e.jsx(k,{disclosure:"down",onClick:()=>Se(!we),removeUnderline:!0,children:e.jsxs(I,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),B!=="all"&&e.jsx(u,{onClick:t=>{t.stopPropagation(),oe("all")},children:e.jsx(d,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>Se(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(pe,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[B],onChange:t=>{oe(t[0]),Q(""),Se(!1)}})})}),e.jsx(ge,{active:De,activator:e.jsx(k,{disclosure:"down",onClick:()=>xe(!De),removeUnderline:!0,children:e.jsxs(I,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),D&&e.jsx(u,{onClick:t=>{t.stopPropagation(),Q("")},children:e.jsx(d,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>xe(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(pe,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...v.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...v.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:D?[D]:[],onChange:t=>{Q(t[0]||""),xe(!1)}})})}),e.jsx(ge,{active:Oe,activator:e.jsx(k,{disclosure:"down",onClick:()=>je(!Oe),removeUnderline:!0,children:e.jsxs(I,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),$.length>0&&e.jsx(u,{onClick:t=>{t.stopPropagation(),le([])},children:e.jsx(d,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>je(!1),children:e.jsxs(u,{padding:"300",minWidth:"200px",children:[e.jsx(pe,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:Je.map(t=>({label:t,value:t})),selected:$,onChange:t=>{le(t)}}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(k,{size:"slim",onClick:()=>je(!1),children:"Apply"})})]})})]}),e.jsx(ge,{active:ke,activator:e.jsx(k,{disclosure:"down",onClick:()=>ye(!ke),removeUnderline:!0,children:e.jsx(I,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:G==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>ye(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(pe,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[G],onChange:t=>{qe(t[0]),ye(!1)}})})})]}),(B!=="all"||D||$.length>0)&&e.jsx(u,{paddingBlockStart:"200",children:e.jsxs(I,{gap:"100",wrap:!0,children:[B!=="all"&&e.jsx(F,{onRemove:()=>oe("all"),children:B==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),D&&e.jsx(F,{onRemove:()=>Q(""),children:D.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),$.map(t=>e.jsxs(F,{onRemove:()=>le(s=>s.filter(n=>n!==t)),children:["Tag: ",t]},t))]})})]}),e.jsx(Et,{resourceName:{singular:"product",plural:"products"},items:T,renderItem:ut,selectedItems:C,onSelectionChange:nt,selectable:!0,loading:he,totalItemsCount:fe,emptyState:St,showHeader:!1}),Ge&&!he&&e.jsx(u,{padding:"400",textAlign:"center",children:e.jsx(k,{onClick:()=>_(Fe+1,!0,null),children:"Load more"})})]})}),gt,pt,ht,mt,ft,it(),$e&&e.jsx(At,{content:$e,onDismiss:()=>j("")})]})}export{Bt as default};
