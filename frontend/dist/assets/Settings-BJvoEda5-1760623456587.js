import{j as e}from"./app-bridge-Bq3vqj6n-1760623456587.js";import{r as d}from"./react-vendor-tAaa2TlE-1760623456587.js";import{m as Be}from"./index-BqbXKEvc-1760623456587.js";import{C as y,a as p,T as i,I as G,r as Oe,d as E,h as k,f as C,D as J,g as O,B as I,v as co,M as N,e as io,k as ho}from"./polaris-RvCMdRHO-1760623456587.js";function No(){var we,De,Pe,Me,ke,ve;console.log("[SETTINGS] ===== SETTINGS COMPONENT LOADED ====="),console.log("[SETTINGS] Starting component initialization...");const Re=(o,s="")=>{try{return new URLSearchParams(window.location.search).get(o)||s}catch{return s}},v=o=>(o||"starter").toLowerCase().replace(" ","_"),Ue=(o,s=null)=>{console.log(`[SETTINGS DEBUG] ${o}`,s||"")},a=Re("shop",""),[Le,he]=d.useState(!0),[He,Se]=d.useState(!1),[t,F]=d.useState(null),[ge,X]=d.useState(""),[ue,Z]=d.useState(!1),[R,g]=d.useState(""),[pe,Je]=d.useState(null),[Ee,ee]=d.useState(null),[Te,Fe]=d.useState(!1),[oe,$e]=d.useState(!1),[te,ze]=d.useState(!1),[se,Ve]=d.useState(!1),[We,Qe]=d.useState(!1),[_e,qe]=d.useState(!1),[So,go]=d.useState(!1),[Ke,me]=d.useState(!1),[fe,ne]=d.useState(!1),[Ge,ae]=d.useState(!1),[xe,Ye]=d.useState(""),[Ie,P]=d.useState(null),[Ne,be]=d.useState(!1),[le,re]=d.useState(null),[je,Xe]=d.useState(!1),[uo,po]=d.useState(!1),[Eo,To]=d.useState(""),[mo,Ze]=d.useState({enabled:!1,generating:!1,generated:!1,progress:""}),[w,b]=d.useState(!1),[D,$]=d.useState({current:0,total:0,percent:0,currentProduct:"",stats:{siteFAQ:!1,products:0,totalSchemas:0}}),[B,A]=d.useState(!1),[eo,ce]=d.useState(!1),[oo,U]=d.useState(!1),[z,Ce]=d.useState(!1),[V,to]=d.useState(null),u=d.useMemo(()=>Be(),[]);console.log("[SETTINGS] ===== SHOP EXTRACTION DEBUG ====="),console.log("[SETTINGS] Extracted shop:",a),console.log("[SETTINGS] API function created:",typeof u),console.log("[SETTINGS] makeSessionFetch function:",typeof Be),d.useEffect(()=>{if(R){console.log("[SETTINGS] Toast state changed to:",R),pe&&clearTimeout(pe);const o=setTimeout(()=>{console.log("[SETTINGS] Auto-clearing toast after 5 seconds"),g("")},5e3);Je(o)}},[R]);const so=()=>{console.log("[SETTINGS] Starting polling for background regeneration completion..."),Ee&&clearInterval(Ee);let o=0;const s=30,n=setInterval(async()=>{o++,console.log(`[SETTINGS] Polling attempt ${o}/${s}`);try{const l=await u(`/api/sitemap/info?shop=${a}`);if(console.log("[SETTINGS] Sitemap info:",l),l&&l.generatedAt){const S=new Date(l.generatedAt).getTime();if(Date.now()-S<12e4){console.log("[SETTINGS] Background regeneration completed!"),clearInterval(n),ee(null),g("AI-Optimized Sitemap regeneration completed successfully!"),console.log("[SETTINGS] Setting showAiSitemapView to true for AI sitemap regeneration completion"),Qe(!0);return}}o>=s&&(console.log("[SETTINGS] Polling timeout reached"),clearInterval(n),ee(null),g("Background regeneration is taking longer than expected. Please check the sitemap manually."))}catch(l){console.error("[SETTINGS] Polling error:",l)}},1e4);ee(n)},W=d.useCallback(async()=>{var o,s;try{console.log("[SETTINGS DEBUG] ===== CHECKING PRODUCTS DATA ====="),console.log("[SETTINGS DEBUG] Shop:",a);const n=await u(`/api/products/list?shop=${a}&limit=10&optimized=true`);console.log("[SETTINGS DEBUG] API Result:",n),console.log("[SETTINGS DEBUG] Products length:",(o=n==null?void 0:n.products)==null?void 0:o.length),console.log("[SETTINGS DEBUG] Products:",n==null?void 0:n.products);const l=(s=n==null?void 0:n.products)==null?void 0:s.some(S=>{var r,h;return((h=(r=S==null?void 0:S.optimizationSummary)==null?void 0:r.optimizedLanguages)==null?void 0:h.length)>0});return console.log("[SETTINGS DEBUG] Has optimized products:",l),console.log("[SETTINGS DEBUG] ===== PRODUCTS CHECK COMPLETE ====="),l}catch(n){return console.error("[SETTINGS] Error checking products data:",n),!1}},[a,u]),Q=d.useCallback(async()=>{var o,s;try{console.log("[SETTINGS DEBUG] ===== CHECKING COLLECTIONS DATA ====="),console.log("[SETTINGS DEBUG] Shop:",a);const n=await u(`/collections/list-graphql?shop=${a}`);console.log("[SETTINGS DEBUG] API Result:",n),console.log("[SETTINGS DEBUG] Collections length:",(o=n==null?void 0:n.collections)==null?void 0:o.length),console.log("[SETTINGS DEBUG] Collections:",n==null?void 0:n.collections);const l=(s=n==null?void 0:n.collections)==null?void 0:s.some(S=>{var r;return((r=S==null?void 0:S.optimizedLanguages)==null?void 0:r.length)>0});return console.log("[SETTINGS DEBUG] Has optimized collections:",l),console.log("[SETTINGS DEBUG] ===== COLLECTIONS CHECK COMPLETE ====="),l}catch(n){return console.error("[SETTINGS] Error checking collections data:",n),!1}},[a,u]),_=d.useCallback(async()=>{var o,s,n,l,S;try{console.log("[SETTINGS DEBUG] ===== CHECKING STORE METADATA ====="),console.log("[SETTINGS DEBUG] Shop:",a);const r=`
        query CheckStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
          }
        }
      `;console.log("[SETTINGS DEBUG] GraphQL Query:",r),console.log("[SETTINGS DEBUG] Variables:",{shop:a});const h=await u("/graphql",{method:"POST",body:JSON.stringify({query:r,variables:{shop:a}}),shop:a});console.log("[SETTINGS DEBUG] GraphQL Result:",h),console.log("[SETTINGS DEBUG] Result data:",h==null?void 0:h.data),console.log("[SETTINGS DEBUG] Store metadata:",(o=h==null?void 0:h.data)==null?void 0:o.storeMetadata),console.log("[SETTINGS DEBUG] Shop name:",(n=(s=h==null?void 0:h.data)==null?void 0:s.storeMetadata)==null?void 0:n.shopName);const T=!!((S=(l=h==null?void 0:h.data)==null?void 0:l.storeMetadata)!=null&&S.shopName);return console.log("[SETTINGS DEBUG] Has metadata:",T),console.log("[SETTINGS DEBUG] ===== STORE METADATA CHECK COMPLETE ====="),T}catch(r){return console.error("[SETTINGS] Error checking store metadata:",r),console.error("[SETTINGS] Error details:",r==null?void 0:r.message,r==null?void 0:r.stack),!1}},[a,u]),q=d.useCallback(async()=>{var o;try{console.log("[SETTINGS DEBUG] ===== CHECKING WELCOME PAGE ====="),console.log("[SETTINGS DEBUG] Shop:",a),console.log("[SETTINGS DEBUG] Current settings features:",t==null?void 0:t.features),console.log("[SETTINGS DEBUG] Welcome page feature enabled:",(o=t==null?void 0:t.features)==null?void 0:o.welcomePage),console.log("[SETTINGS DEBUG] Current plan:",t==null?void 0:t.plan);const s=await u(`/ai/welcome?shop=${a}`);if(console.log("[SETTINGS DEBUG] Welcome page result:",s),console.log("[SETTINGS DEBUG] Result type:",typeof s),console.log("[SETTINGS DEBUG] Result keys:",s?Object.keys(s):"null"),s!=null&&s.error&&typeof s.error=="string"&&!s.error.includes("<!DOCTYPE html>"))return console.log("[SETTINGS DEBUG] Welcome page error:",s.error),console.log("[SETTINGS DEBUG] Error debug info:",s.debug),!1;const n=typeof s=="string"&&s.includes("<!DOCTYPE html>")||(s==null?void 0:s.error)&&typeof s.error=="string"&&s.error.includes("<!DOCTYPE html>");return console.log("[SETTINGS DEBUG] Has welcome page:",n),console.log("[SETTINGS DEBUG] ===== WELCOME PAGE CHECK COMPLETE ====="),n}catch(s){return console.error("[SETTINGS] Error checking welcome page:",s),!1}},[a,u,t]),K=d.useCallback(async()=>{var o,s,n,l,S,r,h,T,c,m,M;console.log("[SETTINGS] ===== checkGeneratedData CALLED ====="),console.log("[SETTINGS] checkGeneratedData - shop:",a),console.log("[SETTINGS] checkGeneratedData - settings:",t),console.log("[SETTINGS] checkGeneratedData - settings?.features:",t==null?void 0:t.features),console.log("[SETTINGS] checkGeneratedData - Store Metadata feature:",(o=t==null?void 0:t.features)==null?void 0:o.storeMetadata),console.log("[SETTINGS] checkGeneratedData - Store Metadata type:",typeof((s=t==null?void 0:t.features)==null?void 0:s.storeMetadata)),console.log("[SETTINGS] checkGeneratedData - Store Metadata enabled:",!!((n=t==null?void 0:t.features)!=null&&n.storeMetadata));try{if(console.log("[SETTINGS] ===== CHECKING GENERATED DATA ====="),(l=t==null?void 0:t.features)!=null&&l.productsJson){console.log("[SETTINGS] ===== CHECKING PRODUCTS JSON FEATURE ====="),console.log("[SETTINGS] Products JSON feature is enabled:",(S=t==null?void 0:t.features)==null?void 0:S.productsJson);const f=await W();console.log("[SETTINGS] Setting showProductsJsonView to:",f),$e(f),console.log("[SETTINGS] Products JSON data exists:",f)}else console.log("[SETTINGS] Products JSON feature is disabled");if((r=t==null?void 0:t.features)!=null&&r.collectionsJson){console.log("[SETTINGS] ===== CHECKING COLLECTIONS JSON FEATURE ====="),console.log("[SETTINGS] Collections JSON feature is enabled:",(h=t==null?void 0:t.features)==null?void 0:h.collectionsJson);const f=await Q();console.log("[SETTINGS] Setting showCollectionsJsonView to:",f),ze(f),console.log("[SETTINGS] Collections JSON data exists:",f)}else console.log("[SETTINGS] Collections JSON feature is disabled");if((T=t==null?void 0:t.features)!=null&&T.storeMetadata){console.log("[SETTINGS] ===== CHECKING STORE METADATA IN checkGeneratedData ====="),console.log("[SETTINGS] Store Metadata feature is enabled:",(c=t==null?void 0:t.features)==null?void 0:c.storeMetadata),console.log("[SETTINGS] About to call checkStoreMetadata...");const f=await _();console.log("[SETTINGS] checkStoreMetadata returned:",f),console.log("[SETTINGS] Setting showStoreMetadataView to:",f),Ve(f),console.log("[SETTINGS] Store Metadata exists:",f),console.log("[SETTINGS] ===== STORE METADATA CHECK COMPLETE =====")}else console.log("[SETTINGS] Store Metadata feature is NOT enabled:",(m=t==null?void 0:t.features)==null?void 0:m.storeMetadata);if((M=t==null?void 0:t.features)!=null&&M.welcomePage){console.log("[SETTINGS] Checking Welcome Page data...");const f=await q();qe(f),console.log("[SETTINGS] Welcome Page exists:",f)}console.log("[SETTINGS] ===== GENERATED DATA CHECK COMPLETE =====")}catch(f){console.error("[SETTINGS] Error checking generated data:",f)}},[t==null?void 0:t.features,W,Q,_,q]);d.useEffect(()=>{console.log("[SETTINGS DEBUG] ===== useEffect DEPENDENCIES DEBUG ====="),console.log("[SETTINGS DEBUG] settings?.features:",t==null?void 0:t.features),console.log("[SETTINGS DEBUG] settings exists:",!!t),console.log("[SETTINGS DEBUG] settings type:",typeof t),console.log("[SETTINGS DEBUG] checkProductsData exists:",!!W),console.log("[SETTINGS DEBUG] checkCollectionsData exists:",!!Q),console.log("[SETTINGS DEBUG] checkStoreMetadata exists:",!!_),console.log("[SETTINGS DEBUG] checkWelcomePage exists:",!!q),console.log("[SETTINGS DEBUG] ===== END useEffect DEPENDENCIES DEBUG =====")},[t==null?void 0:t.features,W,Q,_,q]),console.log("[SETTINGS] State variables initialized successfully"),console.log("[SETTINGS] About to create useEffect hooks...");const no=async(o,s)=>{var S,r;console.log("[DEBUG] runGQL called with query:",o),console.log("[DEBUG] runGQL variables:",s);const n=JSON.stringify({query:o,variables:s});console.log("[DEBUG] runGQL body:",n);const l=await u("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:n});if(console.log("[DEBUG] runGQL response:",l),(S=l==null?void 0:l.errors)!=null&&S.length)throw console.error("[DEBUG] GraphQL errors:",l.errors),new Error(((r=l.errors[0])==null?void 0:r.message)||"GraphQL error");return l==null?void 0:l.data};console.log("[SETTINGS] Creating loadSettings useEffect..."),console.log("[SETTINGS] Current shop value:",a),console.log("[SETTINGS] Shop type:",typeof a),console.log("[SETTINGS] Shop length:",a==null?void 0:a.length),d.useEffect(()=>{if(console.log("[SETTINGS] ===== LOAD SETTINGS useEffect TRIGGERED ====="),console.log("[SETTINGS] Shop:",a),console.log("[SETTINGS] API function:",typeof u),console.log("[SETTINGS] useEffect dependencies - shop:",a),console.log("[SETTINGS] useEffect dependencies - api:",typeof u),!a){console.log("[SETTINGS] No shop, setting loading to false"),he(!1);return}console.log("[SETTINGS] Shop available, calling loadSettings..."),lo()},[a,u]),console.log("[SETTINGS] loadSettings useEffect created successfully"),d.useEffect(()=>{je&&ao()},[je]),d.useEffect(()=>{},[t==null?void 0:t.features]);const ao=async()=>{try{const o=await u(`/api/schema/status?shop=${a}`);Ze({enabled:o.enabled,generating:o.generating,generated:o.hasSiteFAQ||o.productsWithSchema>0,progress:o.progress||""})}catch(o){console.error("Failed to check schema status:",o)}},x=d.useRef(!1),j=d.useRef(0),ie=d.useCallback(async()=>{if(console.log("[PROGRESS-CHECK] Starting check..."),console.log("[PROGRESS-CHECK] isGeneratingRef.current:",x.current),console.log("[PROGRESS-CHECK] checkCountRef.current:",j.current),!x.current){console.log("[PROGRESS-CHECK] Not generating (ref is false), stopping check");return}if(j.current++,j.current>30){console.log("[PROGRESS-CHECK] ⏰ Maximum checks reached, stopping"),x.current=!1,j.current=0,b(!1),g("Schema generation timed out. Please check if data was generated.");return}try{const o=await u(`/api/schema/status?shop=${a}`);if(console.log("[PROGRESS-CHECK] Status data:",o),o.dataReady){console.log("[PROGRESS-CHECK] ✅ Data is ready! Generation complete!"),x.current=!1,j.current=0,b(!1),A(!0),$(s=>({...s,percent:100,currentProduct:"Complete!",stats:{siteFAQ:o.hasSiteFAQ||!1,products:o.productsWithSchema||0,totalSchemas:o.productsWithSchema||0}}));return}if(o.generating){console.log("[PROGRESS-CHECK] Still generating, updating progress...");let s=0;if(o.progress){const n=o.progress.match(/(\d+)%/);n&&(s=parseInt(n[1]))}$(n=>({...n,percent:Math.max(n.percent,s),currentProduct:o.currentProduct||`Processing... (${j.current}/30)`})),setTimeout(()=>{x.current&&ie()},3e3)}else{console.log("[PROGRESS-CHECK] ⚠️ Not generating but no data ready");try{const s=await u(`/ai/schema-data.json?shop=${a}`);if(s&&s.schemas&&s.schemas.length>0){console.log("[PROGRESS-CHECK] Found data on direct check!"),x.current=!1,j.current=0,b(!1),A(!0);const n=[...new Set(s.schemas.map(l=>{var S,r;return(r=(S=l.url)==null?void 0:S.split("/products/")[1])==null?void 0:r.split("#")[0]}))].filter(Boolean);$(l=>({...l,percent:100,currentProduct:"Complete!",stats:{siteFAQ:!!s.siteFAQ,products:n.length,totalSchemas:s.schemas.length}}))}else console.log("[PROGRESS-CHECK] No data found, generation may have failed"),x.current=!1,j.current=0,b(!1),g("Schema generation may have failed. Please try again.")}catch(s){console.error("[PROGRESS-CHECK] Error checking for final data:",s),x.current=!1,j.current=0,b(!1),g("Unable to verify schema generation status.")}}}catch(o){console.error("[PROGRESS-CHECK] ❌ Error:",o),j.current<5?(console.log("[PROGRESS-CHECK] Retrying after error..."),setTimeout(()=>{x.current&&ie()},5e3)):(x.current=!1,j.current=0,b(!1),g("Error checking generation status. Please refresh and try again."))}},[u,a]),lo=async()=>{var o,s,n,l,S,r,h,T;try{console.log("[SETTINGS] ===== STARTING LOAD SETTINGS ====="),console.log("[SETTINGS] Shop:",a),console.log("[SETTINGS] API function:",typeof u),console.log("[SETTINGS] Calling API...");const c=await u(`/api/ai-discovery/settings?shop=${a}`);console.log("[SETTINGS] ===== SETTINGS LOADED ====="),console.log("[SETTINGS] Raw data:",c),console.log("[SETTINGS] Settings plan:",c==null?void 0:c.plan),console.log("[SETTINGS] Normalized plan:",v(c==null?void 0:c.plan)),console.log("[SETTINGS] Features:",c==null?void 0:c.features),console.log("[SETTINGS] Products JSON feature:",(o=c==null?void 0:c.features)==null?void 0:o.productsJson),console.log("[SETTINGS] Collections JSON feature:",(s=c==null?void 0:c.features)==null?void 0:s.collectionsJson),console.log("[SETTINGS] AI Sitemap feature:",(n=c==null?void 0:c.features)==null?void 0:n.aiSitemap),console.log("[SETTINGS] Welcome Page feature:",(l=c==null?void 0:c.features)==null?void 0:l.welcomePage),console.log("[SETTINGS] Store Metadata feature:",(S=c==null?void 0:c.features)==null?void 0:S.storeMetadata),console.log("[SETTINGS] Schema Data feature:",(r=c==null?void 0:c.features)==null?void 0:r.schemaData),console.log("[SETTINGS] Auto Robots Txt feature:",(h=c==null?void 0:c.features)==null?void 0:h.autoRobotsTxt);const m=Object.entries((c==null?void 0:c.features)||{}).filter(([M,f])=>f===!0);console.log("[SETTINGS] Features that are TRUE:",m),console.log("[SETTINGS] Number of true features:",m.length),console.log("[SETTINGS] Setting settings state..."),console.log("[SETTINGS] Data to set:",c),console.log("[SETTINGS] Store Metadata in data:",(T=c==null?void 0:c.features)==null?void 0:T.storeMetadata),F(c),re(c),console.log("[SETTINGS] Settings state set successfully"),Xe(c.advancedSchemaEnabled||!1),Y(c),console.log("[SETTINGS] ===== LOAD SETTINGS COMPLETE =====")}catch(c){console.error("[SETTINGS] ===== LOAD SETTINGS ERROR ====="),console.error("[SETTINGS] Failed to load settings:",c),g("Failed to load settings")}finally{he(!1)}},Y=async(o=t)=>{console.log("[GENERATE ROBOTS] Called with shop:",a);try{const s=await u(`/api/ai-discovery/robots-txt?shop=${a}`,{responseType:"text"});console.log("[GENERATE ROBOTS] Received:",s),X(s||`User-agent: *
Disallow: /`)}catch(s){console.error("[GENERATE ROBOTS] Error:",s),X(`# Error generating robots.txt
# `+s.message)}};console.log("[SETTINGS DEBUG] generateRobotsTxt function exists:",typeof Y);const de=o=>{var s;if(!((s=t==null?void 0:t.availableBots)!=null&&s.includes(o))){g(`Upgrade to ${requiredPlan} plan to enable ${t.bots[o].name}`);return}F(n=>({...n,bots:{...n.bots,[o]:{...n.bots[o],enabled:!n.bots[o].enabled}}})),me(!0)},Ae=o=>{if(!ye(o)){g(`Upgrade your plan to enable ${{productsJson:"Products JSON Feed",aiSitemap:"AI-Optimized Sitemap",welcomePage:"AI Welcome Page",collectionsJson:"Collections JSON Feed",storeMetadata:"Store Metadata",schemaData:"Schema Data"}[o]||o}`);return}F(s=>({...s,features:{...s.features,[o]:!s.features[o]}}))},ro=async()=>{var o,s,n,l,S;console.log("[SETTINGS] ===== SAVE SETTINGS CALLED ====="),console.log("[SETTINGS] Current settings:",t),Se(!0);try{if(await u(`/api/ai-discovery/settings?shop=${a}`,{method:"POST",body:{shop:a,bots:t.bots,features:t.features,richAttributes:t.richAttributes}}),me(!1),re(t),Y(),console.log("[SETTINGS] Checking AI Sitemap feature:",(o=t.features)==null?void 0:o.aiSitemap),(s=t.features)!=null&&s.aiSitemap)try{console.log("[SETTINGS] ===== AI SITEMAP BACKGROUND REGENERATION START ====="),console.log("[SETTINGS] AI Sitemap enabled, starting background regeneration..."),console.log("[SETTINGS] Shop:",a);const r=`
            mutation RegenerateSitemap($shop: String!) {
              regenerateSitemap(shop: $shop) {
                success
                message
                shop
              }
            }
          `;console.log("[SETTINGS] GraphQL mutation:",r),console.log("[SETTINGS] Variables:",{shop:a});const h=await u("/graphql",{method:"POST",body:JSON.stringify({query:r,variables:{shop:a}}),shop:a});console.log("[SETTINGS] GraphQL sitemap regeneration result:",h),(l=(n=h==null?void 0:h.data)==null?void 0:n.regenerateSitemap)!=null&&l.success?(console.log("[SETTINGS] Background regeneration started successfully"),console.log("[SETTINGS] Setting toast for AI sitemap regeneration with delay..."),g(""),setTimeout(()=>{g("Settings saved! AI-Optimized Sitemap is being regenerated in the background. This may take a few moments."),console.log("[SETTINGS] Success toast set after delay"),so()},100)):(console.log("[SETTINGS] Background regeneration failed:",(S=h==null?void 0:h.data)==null?void 0:S.regenerateSitemap),console.log("[SETTINGS] Setting toast for failed regeneration..."),g(""),setTimeout(()=>{g("Settings saved, but sitemap regeneration failed"),console.log("[SETTINGS] Error toast set after delay")},100)),console.log("[SETTINGS] ===== AI SITEMAP BACKGROUND REGENERATION END =====")}catch(r){console.error("[SETTINGS] Failed to start sitemap regeneration:",r),g("Settings saved, but sitemap regeneration failed")}else console.log("[SETTINGS] AI Sitemap disabled, skipping background regeneration"),console.log("[SETTINGS] Setting toast for basic save with delay..."),g(""),setTimeout(()=>{const r=Object.values((t==null?void 0:t.bots)||{}).some(h=>h.enabled);g(r?"Settings saved! Scroll down to configure robots.txt (REQUIRED for AI Discovery).":"Settings saved successfully"),console.log("[SETTINGS] Basic success toast set after delay"),console.log("[SETTINGS] Basic save completed, not showing View buttons")},100)}catch(r){console.error("Failed to save settings:",r),g("Failed to save settings")}finally{Se(!1)}},ye=o=>{var l;const s=v(t==null?void 0:t.plan);return((l={productsJson:["starter","professional","growth","growth_extra","enterprise"],storeMetadata:["professional","growth","growth_extra","enterprise"],welcomePage:["growth","growth_extra","enterprise"],collectionsJson:["growth","growth_extra","enterprise"],aiSitemap:["growth_extra","enterprise"],schemaData:["enterprise"]}[o])==null?void 0:l.includes(s))||!1},L=async o=>{console.log(`[DEBUG] setTestPlan called with plan: ${o}, shop: ${a}`);try{const s=`
        mutation SetPlan($shop:String!, $plan: PlanEnum) {
          setPlanOverride(shop:$shop, plan:$plan) { shop plan }
        }
      `;console.log("[DEBUG] GraphQL mutation:",s),console.log("[DEBUG] Variables:",{shop:a,plan:o});const n=await no(s,{shop:a,plan:o});console.log("[DEBUG] GraphQL result:",n),g(`Test plan set to ${o||"actual"}`),setTimeout(()=>window.location.reload(),500)}catch(s){console.error("[DEBUG] Failed to set test plan",s),g(`Failed to set test plan: ${s.message}`)}},H=async(o,s)=>{var n,l,S,r,h,T;Ye(s),ae(!0),be(!0),P(null);try{const c={productsJson:`/ai/products.json?shop=${a}`,collectionsJson:`/ai/collections-feed.json?shop=${a}`,storeMetadata:`/ai/store-metadata.json?shop=${a}`,schemaData:`/ai/schema-data.json?shop=${a}`,aiSitemap:`/api/sitemap/generate?shop=${a}&force=true`,welcomePage:`/ai/welcome?shop=${a}`};if(o==="aiSitemap"){console.log("[SETTINGS] Loading AI Sitemap XML...");const m=await fetch(c[o],{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${((S=(l=(n=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:n.getState())==null?void 0:l.session)==null?void 0:S.token)||""}`}});if(m.ok){console.log("[SETTINGS] AI Sitemap XML loaded successfully");const M=await m.text();P(M)}else throw new Error(`HTTP ${m.status}: ${m.statusText}`)}else if(o==="welcomePage"){console.log("[SETTINGS] Loading AI Welcome Page HTML...");const m=await fetch(c[o],{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${((T=(h=(r=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:r.getState())==null?void 0:h.session)==null?void 0:T.token)||""}`}});if(m.ok){console.log("[SETTINGS] AI Welcome Page HTML loaded successfully");const M=await m.text();P(M)}else throw new Error(`HTTP ${m.status}: ${m.statusText}`)}else{const m=await u(c[o]);P(JSON.stringify(m,null,2))}}catch(c){console.error("[SETTINGS] Error loading data:",c),P(`Error loading data: ${c.message}`)}finally{be(!1)}};d.useEffect(()=>{console.log("[SETTINGS] showViewButtons state changed to:",Te)},[Te]),d.useEffect(()=>{console.log("[SETTINGS] Resetting showViewButtons on component mount"),Fe(!1),console.log("[SETTINGS] Resetting schema generation states on component mount"),b(!1),A(!1),console.log("[SETTINGS] Resetting refs to prevent infinite loops"),x.current=!1,j.current=0},[]),console.log("[SETTINGS] Creating checkGeneratedData useEffect..."),console.log("[SETTINGS] Current settings:",t),console.log("[SETTINGS] Current settings features:",t==null?void 0:t.features),d.useEffect(()=>{console.log("[SETTINGS DEBUG] ===== useEffect TRIGGERED ====="),console.log("[SETTINGS DEBUG] Settings:",t),console.log("[SETTINGS DEBUG] Settings features:",t==null?void 0:t.features),console.log("[SETTINGS DEBUG] Shop:",a),console.log("[SETTINGS DEBUG] Conditions check:"),console.log("[SETTINGS DEBUG] - settings?.features exists:",!!(t!=null&&t.features)),console.log("[SETTINGS DEBUG] - shop exists:",!!a),console.log("[SETTINGS DEBUG] - Both conditions met:",!!(t!=null&&t.features&&a)),t!=null&&t.features&&a?(console.log("[SETTINGS] Checking for generated data..."),K()):console.log("[SETTINGS] Skipping checkGeneratedData - conditions not met")},[t==null?void 0:t.features,a,K]),console.log("[SETTINGS] checkGeneratedData useEffect created successfully"),d.useEffect(()=>{console.log("[SETTINGS] ===== FORCE CHECK ON MOUNT ====="),console.log("[SETTINGS] Shop:",a),console.log("[SETTINGS] Settings:",t),console.log("[SETTINGS] Settings features:",t==null?void 0:t.features),console.log("[SETTINGS] checkGeneratedData function:",typeof K),console.log("[SETTINGS] isGeneratingRef.current:",x.current),x.current&&!w&&(console.log("[SETTINGS] ⚠️ Found stale generating state, resetting..."),x.current=!1,j.current=0),a&&(t!=null&&t.features)?(console.log("[SETTINGS] Both shop and settings available, calling checkGeneratedData..."),K()):(console.log("[SETTINGS] Missing shop or settings, skipping checkGeneratedData"),console.log("[SETTINGS] - shop exists:",!!a),console.log("[SETTINGS] - settings?.features exists:",!!(t!=null&&t.features)))},[]);try{return a?Le?e.jsx(y,{children:e.jsx(p,{padding:"400",children:e.jsxs(G,{align:"center",children:[e.jsx(Oe,{size:"small"}),e.jsx(i,{children:"Loading settings..."})]})})}):e.jsxs(E,{gap:"600",children:[e.jsx(y,{children:e.jsx(p,{padding:"400",children:e.jsxs(E,{gap:"400",children:[e.jsxs(G,{align:"space-between",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"AI Bot Access Control"}),(t==null?void 0:t.plan)&&e.jsxs(k,{tone:"info",children:[t.plan.charAt(0).toUpperCase()+t.plan.slice(1)," Plan"]})]}),e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Choose which AI bots can access your store's structured data"}),e.jsx(C,{status:"info",children:e.jsxs(E,{gap:"200",children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"How it works:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginBottom:0},children:[e.jsx("li",{children:"Select AI bots below"}),e.jsx("li",{children:"Configure AI Discovery Features below"}),e.jsx("li",{children:'Click "Save Settings" at the bottom'}),e.jsx("li",{children:"Configure robots.txt (instructions will appear)"})]})]})}),e.jsx(J,{}),e.jsxs(E,{gap:"300",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["meta","anthropic"].map(o=>{var T,c,m;const s=(T=t==null?void 0:t.bots)==null?void 0:T[o];if(!s)return null;const n={starter:["meta","anthropic"],professional:["meta","anthropic","google"],growth:["meta","anthropic","google","openai"],growth_extra:["meta","anthropic","google","openai","perplexity"],enterprise:["meta","anthropic","google","openai","perplexity","others"]},l=v(t==null?void 0:t.plan),r=(n[l]||n.starter).includes(o),h=o==="google"?"Professional":o==="openai"?"Growth":o==="perplexity"?"Growth Extra":o==="others"?"Enterprise":null;return e.jsx(p,{padding:"200",background:r?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(E,{gap:"100",children:e.jsx(O,{label:e.jsxs(G,{gap:"200",align:"center",children:[e.jsx(i,{variant:r?"bodyMd":"bodySm",tone:r?"base":"subdued",children:s.name||o}),!r&&h&&e.jsxs(k,{tone:"info",size:"small",children:[h,"+"]})]}),checked:!!((m=(c=t==null?void 0:t.bots)==null?void 0:c[o])!=null&&m.enabled),onChange:()=>de(o),disabled:!r,helpText:r?o==="meta"?"Meta AI platforms":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="openai"?"ChatGPT":o==="perplexity"?"AI-powered search":o==="others"?"Deepseek, Bytespider & others":"":`Upgrade to ${h} plan to enable this AI bot`})})},o)})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["google","openai"].map(o=>{var S,r,h,T;const s=(S=t==null?void 0:t.bots)==null?void 0:S[o];if(!s)return null;const n=(r=t==null?void 0:t.availableBots)==null?void 0:r.includes(o),l=o==="google"?"Professional":o==="openai"?"Growth":o==="perplexity"?"Growth Extra":o==="others"?"Enterprise":null;return e.jsx(p,{padding:"200",background:n?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(E,{gap:"100",children:e.jsx(O,{label:e.jsxs(G,{gap:"200",align:"center",children:[e.jsx(i,{variant:n?"bodyMd":"bodySm",tone:n?"base":"subdued",children:s.name||o}),!n&&l&&e.jsxs(k,{tone:"info",size:"small",children:[l,"+"]})]}),checked:!!((T=(h=t==null?void 0:t.bots)==null?void 0:h[o])!=null&&T.enabled),onChange:()=>de(o),disabled:!n,helpText:n?o==="meta"?"Meta AI platforms":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="openai"?"ChatGPT":o==="perplexity"?"AI-powered search":o==="others"?"Deepseek, Bytespider & others":"":`Upgrade to ${l} plan to enable this AI bot`})})},o)})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["perplexity","others"].map(o=>{var S,r,h,T;const s=(S=t==null?void 0:t.bots)==null?void 0:S[o];if(!s)return null;const n=(r=t==null?void 0:t.availableBots)==null?void 0:r.includes(o),l=o==="google"?"Professional":o==="openai"?"Growth":o==="perplexity"?"Growth Extra":o==="others"?"Enterprise":null;return e.jsx(p,{padding:"200",background:n?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(E,{gap:"100",children:e.jsx(O,{label:e.jsxs(G,{gap:"200",align:"center",children:[e.jsx(i,{variant:n?"bodyMd":"bodySm",tone:n?"base":"subdued",children:s.name||o}),!n&&l&&e.jsxs(k,{tone:"info",size:"small",children:[l,"+"]})]}),checked:!!((T=(h=t==null?void 0:t.bots)==null?void 0:h[o])!=null&&T.enabled),onChange:()=>de(o),disabled:!n,helpText:n?o==="meta"?"Meta AI platforms":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="openai"?"ChatGPT":o==="perplexity"?"AI-powered search":o==="others"?"Deepseek, Bytespider & others":"":`Upgrade to ${l} plan to enable this AI bot`})})},o)})})]})]})})}),e.jsx(y,{children:e.jsx(p,{padding:"400",children:e.jsxs(E,{gap:"400",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"AI Discovery Features"}),e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Select the features you want to enable for AI bots to consume your store data."}),e.jsx(C,{status:"info",children:`Don't forget to click "Save Settings" after making changes.`}),e.jsx(J,{}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1rem"},children:[{key:"productsJson",name:"Products JSON Feed",description:"Bulk product data for AI consumption",requiredPlan:"Starter"},{key:"storeMetadata",name:"Store Metadata for AI Search",description:"Organization schema & AI metadata",requiredPlan:"Professional"},{key:"welcomePage",name:"AI Welcome Page",description:"Landing page for AI bots",requiredPlan:"Growth"},{key:"collectionsJson",name:"Collections JSON Feed",description:"Category data for better AI understanding",requiredPlan:"Growth"},{key:"aiSitemap",name:"AI-Optimized Sitemap",description:"Enhanced sitemap with AI hints",requiredPlan:"Growth Extra"},{key:"schemaData",name:"Advanced Schema Data",description:"BreadcrumbList, FAQPage & more",requiredPlan:"Enterprise"}].map(o=>{var l,S;const s=ye(o.key),n=!!((l=t==null?void 0:t.features)!=null&&l[o.key]);return console.log(`[SETTINGS DEBUG] Feature ${o.key}:`,{isAvailable:s,isEnabled:n,rawValue:(S=t==null?void 0:t.features)==null?void 0:S[o.key],plan:t==null?void 0:t.plan,normalizedPlan:v(t==null?void 0:t.plan)}),e.jsx(p,{padding:"200",background:s?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:s?e.jsxs(G,{align:"space-between",blockAlign:"center",children:[e.jsx(p,{flexGrow:1,children:e.jsx(O,{label:o.name,checked:n,onChange:()=>Ae(o.key),helpText:o.description})}),o.key==="aiSitemap"&&We&&e.jsx(I,{size:"slim",onClick:()=>H(o.key,o.name),children:"View"}),o.key==="productsJson"&&(console.log("[SETTINGS DEBUG] Products JSON button check:"),console.log("[SETTINGS DEBUG] - feature.key === productsJson:",o.key==="productsJson"),console.log("[SETTINGS DEBUG] - showProductsJsonView:",oe),console.log("[SETTINGS DEBUG] - Should show button:",o.key==="productsJson"&&oe),o.key==="productsJson"&&oe)&&e.jsx(I,{size:"slim",onClick:()=>H(o.key,o.name),children:"View"}),o.key==="collectionsJson"&&(console.log("[SETTINGS DEBUG] Collections JSON button check:"),console.log("[SETTINGS DEBUG] - feature.key === collectionsJson:",o.key==="collectionsJson"),console.log("[SETTINGS DEBUG] - showCollectionsJsonView:",te),console.log("[SETTINGS DEBUG] - Should show button:",o.key==="collectionsJson"&&te),o.key==="collectionsJson"&&te)&&e.jsx(I,{size:"slim",onClick:()=>H(o.key,o.name),children:"View"}),o.key==="storeMetadata"&&(console.log("[SETTINGS DEBUG] ===== STORE METADATA BUTTON RENDER ====="),console.log("[SETTINGS DEBUG] feature.key === storeMetadata:",o.key==="storeMetadata"),console.log("[SETTINGS DEBUG] isEnabled:",n),console.log("[SETTINGS DEBUG] showStoreMetadataView:",se),console.log("[SETTINGS DEBUG] Should show button:",o.key==="storeMetadata"&&n),console.log("[SETTINGS DEBUG] Button type:",se?"View":"Configure"),console.log("[SETTINGS DEBUG] ===== END STORE METADATA BUTTON DEBUG ====="),o.key==="storeMetadata"&&n)&&(se?e.jsx(I,{size:"slim",onClick:()=>H(o.key,o.name),children:"View"}):e.jsx(I,{size:"slim",variant:"primary",onClick:()=>{console.log("[SETTINGS DEBUG] Configure button clicked!");const r=`/ai-seo/store-metadata?shop=${a}`;console.log("[SETTINGS DEBUG] Opening URL:",r),window.open(r,"_blank")},children:"Configure"})),o.key==="welcomePage"&&_e&&e.jsx(I,{size:"slim",onClick:()=>H(o.key,o.name),children:"View"})]}):e.jsx(O,{label:e.jsxs(G,{gap:"200",align:"center",children:[e.jsx(i,{variant:"bodySm",tone:"subdued",children:o.name}),o.requiredPlan&&e.jsxs(k,{tone:"info",size:"small",children:[o.requiredPlan,o.requiredPlan!=="Enterprise"&&"+"]})]}),checked:!1,onChange:()=>Ae(o.key),disabled:!0,helpText:`Upgrade to ${o.requiredPlan} plan to enable`})},o.key)})})]})})}),(()=>{var l,S;const o=v(t==null?void 0:t.plan)==="enterprise",s=(l=t==null?void 0:t.features)==null?void 0:l.schemaData,n=(S=le==null?void 0:le.features)==null?void 0:S.schemaData;return console.log("[SCHEMA-DEBUG] Advanced Schema Management visibility check:"),console.log("[SCHEMA-DEBUG] - Plan check (enterprise):",o),console.log("[SCHEMA-DEBUG] - Settings schemaData:",s),console.log("[SCHEMA-DEBUG] - Original schemaData:",n),console.log("[SCHEMA-DEBUG] - All conditions met:",o&&s&&n),o&&s&&n})()&&e.jsx(y,{children:e.jsx(p,{padding:"400",children:e.jsxs(E,{gap:"400",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"Advanced Schema Data Management"}),e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Generate and manage structured data for your products"}),e.jsxs(G,{gap:"300",children:[e.jsx(I,{primary:!0,onClick:async()=>{if(console.log("[SCHEMA-GEN] Button clicked!"),x.current){console.log("[SCHEMA-GEN] Already generating, ignoring click");return}try{console.log("[SCHEMA-GEN] Checking for existing data...");const o=await u(`/ai/schema-data.json?shop=${a}`);if(console.log("[SCHEMA-GEN] Existing data:",o),o.schemas&&o.schemas.length>0&&(console.log("[SCHEMA-GEN] Found existing schemas, asking for confirmation..."),!confirm("This will replace existing schema data. Continue?"))){console.log("[SCHEMA-GEN] User cancelled");return}console.log("[SCHEMA-GEN] Starting generation..."),console.log("[SCHEMA-GEN] ⚠️ BEFORE setState - schemaGenerating:",w),x.current=!0,j.current=0,console.log("[SCHEMA-GEN] 🔵 Set isGeneratingRef.current = true"),b(!0),console.log("[SCHEMA-GEN] 🔵 Set schemaGenerating state = true"),A(!1),$({current:0,total:0,percent:10,currentProduct:"Initializing...",stats:{siteFAQ:!1,products:0,totalSchemas:0}}),console.log("[SCHEMA-GEN] ✅ AFTER setState - should be true now"),console.log("[SCHEMA-GEN] About to call api() function..."),console.log("[SCHEMA-GEN] api function exists:",typeof u),console.log("[SCHEMA-GEN] shop value:",a),console.log("[SCHEMA-GEN] Calling POST /api/schema/generate-all...");let s;try{s=await u(`/api/schema/generate-all?shop=${a}`,{method:"POST",shop:a,body:{shop:a}}),console.log("[SCHEMA-GEN] ✅ API call successful!")}catch(n){throw console.error("[SCHEMA-GEN] ❌ API call failed:",n),console.error("[SCHEMA-GEN] ❌ API error message:",n.message),console.error("[SCHEMA-GEN] ❌ API error stack:",n.stack),n}console.log("[SCHEMA-GEN] POST response:",s),console.log("[SCHEMA-GEN] 🕐 Scheduling progress check in 2 seconds..."),console.log("[SCHEMA-GEN] 🕐 Current schemaGenerating value:",w),setTimeout(()=>{console.log("[SCHEMA-GEN] ⏰ setTimeout fired! Calling checkGenerationProgress..."),ie()},3e3)}catch(o){console.error("[SCHEMA-GEN] Error:",o),g("Failed to generate schema: "+(o.message||"Unknown error")),b(!1)}},children:"Generate/Update Schema Data"}),e.jsx(I,{onClick:()=>{window.open(`/ai/schema-data.json?shop=${a}`,"_blank")},children:"View Generated Schema"}),e.jsx(I,{destructive:!0,onClick:async()=>{if(confirm("This will delete all advanced schema data. Are you sure?"))try{await u(`/api/schema/delete?shop=${a}`,{method:"DELETE",shop:a,body:{shop:a}}),g("Schema data deleted successfully")}catch{g("Failed to delete schema data")}},children:"Delete Schema Data"})]}),e.jsx(y,{children:e.jsx(p,{padding:"300",children:e.jsxs(E,{gap:"300",children:[e.jsx(i,{as:"h3",variant:"headingSm",children:"Rich Product Attributes"}),e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Select which AI-generated attributes to include in product schemas"}),e.jsx(co,{columns:2,gap:"400",children:[{key:"material",label:"Material",description:"Product material (cotton, leather, metal, etc.)"},{key:"color",label:"Color",description:"Product color information"},{key:"size",label:"Size",description:"Product size or dimensions"},{key:"weight",label:"Weight",description:"Product weight information"},{key:"dimensions",label:"Dimensions",description:"Product measurements"},{key:"category",label:"Category",description:"Product category classification"},{key:"audience",label:"Target Audience",description:"Intended user group (men, women, kids, etc.)"},{key:"reviews",label:"Review Schemas",description:"AI-generated product reviews for schema.org"},{key:"ratings",label:"Rating Schemas",description:"AI-generated ratings and aggregate ratings"},{key:"enhancedDescription",label:"Enhanced Descriptions",description:"AI-enhanced product descriptions"},{key:"organization",label:"Organization Schema",description:"Brand organization information"}].map(o=>{var s;return e.jsx(O,{label:o.label,helpText:o.description,checked:((s=t==null?void 0:t.richAttributes)==null?void 0:s[o.key])||!1,onChange:n=>{F(l=>({...l,richAttributes:{...l.richAttributes,[o.key]:n}}))}},o.key)})})]})})}),e.jsx(C,{status:"info",tone:"subdued",children:e.jsxs("p",{children:["Generation creates BreadcrumbList, FAQPage, WebPage and more schemas for each product. AI can access them at ",e.jsx("code",{children:"/ai/product/[handle]/schemas.json"})]})})]})})}),e.jsxs(G,{gap:"200",align:"end",children:[e.jsx(I,{tone:"critical",onClick:async()=>{if(window.confirm("Are you sure you want to reset all AI Discovery settings to defaults?"))try{await u(`/api/ai-discovery/settings?shop=${a}`,{method:"DELETE",shop:a}),g("Settings reset successfully"),re(null),setTimeout(()=>{window.location.reload()},1e3)}catch(o){console.error("Failed to reset:",o),g("Failed to reset settings")}},children:"Reset to Defaults"}),e.jsx(I,{primary:!0,size:"large",loading:He,onClick:ro,disabled:!t,children:"Save Settings"})]}),!Ke&&Object.values((t==null?void 0:t.bots)||{}).some(o=>o.enabled)&&e.jsx(y,{children:e.jsx(p,{padding:"400",children:e.jsxs(E,{gap:"400",children:[e.jsxs(G,{align:"space-between",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"📋 robots.txt Configuration"}),e.jsx(k,{tone:"critical",children:"REQUIRED"})]}),e.jsx(C,{status:"critical",title:"⚠️ IMPORTANT: AI Discovery will NOT work without this step!",children:e.jsxs(E,{gap:"300",children:[e.jsx("p",{children:e.jsx("strong",{children:"Your AI bot settings are saved, but they can't access your store yet."})}),e.jsx("p",{children:"You must manually add robots.txt to your theme for AI bots to discover your products."}),e.jsx("p",{children:"Click the button below to see your custom robots.txt code and installation instructions."})]})}),e.jsx(I,{primary:!0,size:"large",onClick:async()=>{console.log("[GENERATE ROBOTS] Starting..."),console.log("[GENERATE ROBOTS] Settings:",t);try{const o=Object.values((t==null?void 0:t.bots)||{}).some(s=>s.enabled);console.log("[GENERATE ROBOTS] Has selected bots:",o),o?(console.log("[GENERATE ROBOTS] Calling generateRobotsTxt..."),await Y(),console.log("[GENERATE ROBOTS] Robots.txt generated, showing modal"),Z(!0)):(console.log("[GENERATE ROBOTS] No bots, showing modal"),ne(!0))}catch(o){console.error("[GENERATE ROBOTS] Error:",o),g("Error generating robots.txt: "+o.message)}},children:"📋 View & Copy robots.txt Code"}),e.jsx(J,{}),e.jsxs(E,{gap:"300",children:[e.jsx(i,{variant:"headingMd",children:"Installation Instructions:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:"Click the button above to see your custom robots.txt code"}),e.jsx("li",{children:"Copy the generated content"}),e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Online Store → Themes"})," in your Shopify admin"]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Actions → Edit code"})," on your active theme"]}),e.jsxs("li",{children:["Find or create ",e.jsx("strong",{children:"robots.txt.liquid"})," file in the templates folder"]}),e.jsxs("li",{children:["Paste the content and click ",e.jsx("strong",{children:"Save"})]})]})]}),e.jsx(C,{status:"info",children:e.jsxs("p",{children:["💡 ",e.jsx("strong",{children:"Why this matters:"})," The robots.txt file tells AI bots (OpenAI, Anthropic, Google, etc.) which pages and endpoints they can access to properly understand and index your products for AI search results and recommendations."]})})]})})}),ue&&e.jsx(N,{open:ue,onClose:()=>Z(!1),title:"robots.txt Configuration",primaryAction:{content:"Copy to clipboard",onAction:()=>{navigator.clipboard.writeText(ge),g("Copied to clipboard!")}},secondaryActions:[{content:"Close",onAction:()=>Z(!1)}],children:e.jsx(N.Section,{children:e.jsxs(E,{gap:"400",children:[!["growth","growth_extra","enterprise"].includes(v(t==null?void 0:t.plan))&&e.jsx(C,{status:"info",title:"Manual Configuration Steps",children:e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:"Copy the robots.txt content below"}),e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Online Store → Themes"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Actions → Edit code"})," on your active theme"]}),e.jsxs("li",{children:["In the file browser, look for ",e.jsx("strong",{children:"robots.txt.liquid"})]}),e.jsxs("li",{children:["If it doesn't exist, click ",e.jsx("strong",{children:"Add a new template"}),' → Select "robots" → Create']}),e.jsx("li",{children:"Replace the content with what you copied"}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Save"})]})]})}),e.jsx(p,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:ge})})]})})}),fe&&e.jsx(N,{open:fe,onClose:()=>ne(!1),title:"No AI Bots Selected",primaryAction:{content:"Got it",onAction:()=>ne(!1)},children:e.jsx(N.Section,{children:e.jsxs(E,{gap:"400",children:[e.jsx(C,{status:"warning",children:e.jsx("p",{children:"You haven't selected any AI bots yet."})}),e.jsx(i,{children:"To configure robots.txt:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:'Select AI bots from the "AI Bot Access Control" section above'}),e.jsx("li",{children:'Click "Save Settings" to save your selections'}),e.jsx("li",{children:'Then click "Generate robots.txt" to configure'})]})]})})}),e.jsx(y,{children:e.jsx(p,{padding:"400",children:e.jsxs(E,{gap:"400",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"Test Plan Switcher (Dev Only)"}),e.jsxs(G,{gap:"200",children:[e.jsx(I,{onClick:()=>L("starter"),children:"Starter"}),e.jsx(I,{onClick:()=>L("professional"),children:"Professional"}),e.jsx(I,{onClick:()=>L("growth"),children:"Growth"}),e.jsx(I,{onClick:()=>L("growth_extra"),children:"Growth Extra"}),e.jsx(I,{onClick:()=>L("enterprise"),children:"Enterprise"})]})]})})}),Ge&&e.jsx(N,{open:Ge,onClose:()=>{ae(!1),P(null)},title:xe,primaryAction:{content:"Copy",onAction:()=>{navigator.clipboard.writeText(Ie),g("Copied to clipboard!")},disabled:Ne},secondaryActions:[{content:"Close",onAction:()=>{ae(!1),P(null)}}],children:e.jsx(N.Section,{children:e.jsx(p,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:Ne?e.jsxs(G,{align:"center",gap:"200",children:[e.jsx(Oe,{size:"small"}),e.jsx(i,{variant:"bodyMd",children:xe==="AI-Optimized Sitemap"?"Loading sitemap XML... This may take a moment for large stores.":"Loading..."})]}):e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:Ie})})})}),Ue("Modal states",{schemaGenerating:w,schemaComplete:B,modalShouldShow:w&&!B}),w&&!B&&e.jsx(N,{open:w,title:"Generating Advanced Schema Data",onClose:()=>{console.log("[SCHEMA-MODAL] ❌ Close button clicked"),x.current=!1,b(!1),A(!1),console.log("[SCHEMA-MODAL] States and ref reset to false")},children:e.jsx(N.Section,{children:e.jsxs(i,{children:["Modal is showing! Progress: ",D.percent,"%"]})})}),B&&e.jsx(N,{open:!0,title:"Schema Generation Complete",onClose:()=>{b(!1),A(!1)},primaryAction:{content:"View Generated Schemas",onAction:()=>{window.open(`/ai/schema-data.json?shop=${a}`,"_blank"),b(!1),A(!1)}},secondaryActions:[{content:"Close",onAction:()=>{b(!1),A(!1)}}],children:e.jsx(N.Section,{children:e.jsxs(E,{gap:"400",children:[e.jsx(C,{status:"success",title:"Generation successful!",children:e.jsx("p",{children:"Advanced schema data has been generated for your products."})}),e.jsx(i,{variant:"headingMd",children:"Generation Statistics"}),e.jsxs(G,{gap:"600",wrap:!0,children:[e.jsxs(p,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Site FAQ"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:D.stats.siteFAQ?"✓":"—"})]}),e.jsxs(p,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Products Processed"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:D.stats.products})]}),e.jsxs(p,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Total Schemas"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:D.stats.totalSchemas})]})]}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Schemas are now available at /ai/product/[handle]/schemas.json"})})]})})}),w&&!B&&e.jsx(N,{open:!0,title:"Generating Advanced Schema Data",onClose:()=>{console.log("[SCHEMA-MODAL] Closing modal..."),x.current=!1,j.current=0,b(!1),A(!1)},noScroll:!0,children:e.jsx(N.Section,{children:e.jsxs(E,{gap:"400",children:[e.jsx(i,{variant:"bodyMd",children:"Generating schemas for your products..."}),e.jsx(io,{progress:D.percent,size:"small"}),e.jsx(i,{variant:"bodySm",tone:"subdued",children:"This process may take 1-2 minutes depending on the number of products."})]})})}),B&&e.jsx(N,{open:!0,title:"Schema Generation Complete",onClose:()=>{b(!1),A(!1)},primaryAction:{content:"View Generated Schemas",onAction:()=>{window.open(`/ai/schema-data.json?shop=${a}`,"_blank"),b(!1),A(!1)}},secondaryActions:[{content:"Close",onAction:()=>{b(!1),A(!1)}}],children:e.jsx(N.Section,{children:e.jsxs(E,{gap:"400",children:[e.jsx(C,{status:"success",title:"Generation successful!",children:e.jsx("p",{children:"Advanced schema data has been generated for your products."})}),e.jsx(i,{variant:"headingMd",children:"Generation Statistics"}),e.jsxs(G,{gap:"600",wrap:!0,children:[e.jsxs(p,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Site FAQ"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:D.stats.siteFAQ?"✓":"—"})]}),e.jsxs(p,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Products Processed"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:D.stats.products})]}),e.jsxs(p,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Total Schemas"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:D.stats.totalSchemas})]})]}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Schemas are now available at /ai/product/[handle]/schemas.json"})})]})})}),e.jsx(y,{children:e.jsx(p,{padding:"400",children:e.jsxs(E,{gap:"400",children:[e.jsxs(G,{align:"space-between",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"🗑️ Uninstall Preparation"}),e.jsx(k,{tone:"critical",children:"DANGER ZONE"})]}),e.jsx(C,{status:"warning",children:e.jsx("p",{children:"Before uninstalling this app, we recommend cleaning up all app data from your store to avoid leaving behind unused metafields."})}),e.jsxs(E,{gap:"300",children:[e.jsx(i,{variant:"headingMd",children:"What will be removed:"}),e.jsxs("ul",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:"All SEO metafield definitions (seo_ai namespace)"}),e.jsx("li",{children:"All AI-generated content (titles, descriptions, bullets, FAQs)"}),e.jsx("li",{children:"Store metadata configurations"}),e.jsx("li",{children:"Advanced schema data"})]})]}),e.jsx(J,{}),e.jsx(G,{gap:"200",children:e.jsx(I,{tone:"critical",onClick:()=>U(!0),children:"Clean & Prepare for Uninstall"})}),e.jsx(C,{status:"info",children:e.jsxs("p",{children:["💡 ",e.jsx("strong",{children:"Note:"})," This action will NOT uninstall the app automatically. After cleaning, you'll receive instructions on how to complete the uninstall process in Shopify Admin."]})})]})})}),oo&&e.jsx(N,{open:!0,title:"⚠️ Confirm Data Cleanup",onClose:()=>!z&&U(!1),primaryAction:{content:z?"Cleaning...":"Yes, Clean Everything",onAction:async()=>{Ce(!0);try{console.log("[UNINSTALL] Starting cleanup...");const o=await u(`/api/store/prepare-uninstall?shop=${a}`,{method:"POST",shop:a});console.log("[UNINSTALL] Cleanup result:",o),to(o),U(!1),ce(!0)}catch(o){console.error("[UNINSTALL] Cleanup error:",o),g("Error cleaning app data: "+o.message),U(!1)}finally{Ce(!1)}},loading:z,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>U(!1),disabled:z}],children:e.jsx(N.Section,{children:e.jsxs(E,{gap:"400",children:[e.jsx(C,{status:"critical",title:"This action cannot be undone!",children:e.jsx("p",{children:"All SEO content, metafields, and app configurations will be permanently deleted from your Shopify store."})}),e.jsx(i,{variant:"bodyMd",children:e.jsx("strong",{children:"Are you sure you want to proceed?"})}),e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"This will remove:"}),e.jsxs("ul",{style:{marginLeft:"20px"},children:[e.jsx("li",{children:"All product SEO metafields (titles, descriptions, bullets, FAQs)"}),e.jsx("li",{children:"All collection SEO metafields"}),e.jsx("li",{children:"Store metadata (brand voice, policies, target audience)"}),e.jsx("li",{children:"Advanced schema data"}),e.jsx("li",{children:"All metafield definitions created by this app"})]})]})})}),eo&&V&&e.jsx(N,{open:!0,title:"✅ App Data Cleaned Successfully",onClose:()=>ce(!1),primaryAction:{content:"Go to Apps & Sales Channels",onAction:()=>{window.open("https://admin.shopify.com/store/"+a.replace(".myshopify.com","")+"/settings/apps","_blank")}},secondaryActions:[{content:"Close",onAction:()=>ce(!1)}],children:e.jsx(N.Section,{children:e.jsxs(E,{gap:"400",children:[e.jsx(C,{status:"success",title:"Cleanup completed!",children:e.jsx("p",{children:"All app data has been removed from your Shopify store."})}),e.jsx(i,{variant:"headingMd",children:"Cleanup Summary:"}),e.jsxs(E,{gap:"200",children:[e.jsxs(G,{gap:"200",align:"start",children:[e.jsx(i,{variant:"bodyMd",children:"✓"}),e.jsxs(i,{variant:"bodyMd",children:["Metafield definitions deleted: ",e.jsx("strong",{children:((De=(we=V.results)==null?void 0:we.metafieldDefinitions)==null?void 0:De.deleted)||0})]})]}),e.jsxs(G,{gap:"200",align:"start",children:[e.jsx(i,{variant:"bodyMd",children:"✓"}),e.jsxs(i,{variant:"bodyMd",children:["Store metadata: ",e.jsx("strong",{children:(Me=(Pe=V.results)==null?void 0:Pe.storeMetadata)!=null&&Me.deleted?"Removed":"Not found"})]})]}),e.jsxs(G,{gap:"200",align:"start",children:[e.jsx(i,{variant:"bodyMd",children:"✓"}),e.jsxs(i,{variant:"bodyMd",children:["Advanced schemas: ",e.jsx("strong",{children:(ve=(ke=V.results)==null?void 0:ke.advancedSchemas)!=null&&ve.deleted?"Removed":"Not found"})]})]})]}),e.jsx(J,{}),e.jsx(i,{variant:"headingMd",children:"Next Steps:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Settings → Apps and sales channels"})]}),e.jsxs("li",{children:["Find ",e.jsx("strong",{children:'"NEW AI SEO"'})," in the list"]}),e.jsxs("li",{children:["Click the ",e.jsx("strong",{children:"three dots (•••)"})," menu"]}),e.jsxs("li",{children:["Select ",e.jsx("strong",{children:'"Uninstall"'})]}),e.jsx("li",{children:"Confirm the uninstallation"})]}),e.jsx(C,{status:"info",children:e.jsx("p",{children:"💡 Your store data is now clean. You can safely uninstall the app without leaving behind any unused metafields or configurations."})})]})})}),R&&e.jsx(ho,{content:R,onDismiss:()=>g("")})]}):e.jsx(y,{children:e.jsx(p,{padding:"400",children:e.jsx(i,{tone:"critical",children:"Missing shop parameter"})})})}catch(o){return console.error("[SETTINGS] Component render error:",o),e.jsx(E,{gap:"400",children:e.jsx(y,{children:e.jsxs(p,{padding:"400",children:[e.jsx(i,{variant:"headingMd",children:"Settings Error"}),e.jsx(p,{paddingBlockStart:"200",children:e.jsxs(i,{children:["Failed to load settings: ",o.message]})})]})})})}}export{No as default};
