import{r as e,j as n}from"./react-vendor-BXVC7v0l.js";import{m as a}from"./sessionFetch-CQx0bOV4.js";import"./usePlanHierarchy-fXt-6sDq.js";import{T as s,I as t,a as i}from"./TokenPurchaseModal-DnK58cDo.js";import{U as o}from"./UpgradeModal-DYlOzGkq.js";import{e as r}from"./tokenEstimates-Dgf19ZiR.js";import{C as c,B as d,a as l,i as h,T as u,d as p,t as m,I as g,f as j,D as S,b as f,u as v,l as x,M as _}from"./polaris-LiLfZG0r.js";import"./app-bridge-DUY42B6P.js";import"./vendor-Cs_VgJ2r.js";import"./index-DemooNeg.js";const y=(e,n="")=>{try{return new URLSearchParams(window.location.search).get(e)||n}catch{return n}},b=e=>(e||"starter").toLowerCase().replace(/\s+/g,"_");function O({shop:O}){const A=O||y("shop","");y("shop","");const[w,P]=e.useState(0),[I,k]=e.useState(!0),[E,C]=e.useState({organization:null,website:null,products:[]}),[T,D]=e.useState(""),N=e.useMemo(()=>a(),[]),[q,B]=e.useState(""),[M,R]=e.useState(null),[$,L]=e.useState(null),[U,z]=e.useState(null),[F,G]=e.useState(0),[J,Y]=e.useState({inProgress:!1,status:"idle",message:null,position:null,estimatedTime:null,generatedAt:null,schemaCount:0}),[Z,Q]=e.useState(null),[W,V]=e.useState(!1),[X,H]=e.useState(!1),[K,ee]=e.useState({}),[ne,ae]=e.useState(!1),[se,te]=e.useState(!1),[ie,oe]=e.useState(!1),[re,ce]=e.useState(null),[de,le]=e.useState(!1),[he,ue]=e.useState(null);e.useEffect(()=>{A&&(Se(),pe(),me())},[A,N]),e.useEffect(()=>()=>{Z&&clearInterval(Z)},[Z]);const pe=async()=>{var e;try{const a=await N(`/api/ai-discovery/settings?shop=${A}`);R(null==a?void 0:a.plan),L(b(null==a?void 0:a.plan)),G((null==a?void 0:a.productCount)||0);try{const n="\n          query PlansMe($shop:String!) {\n            plansMe(shop:$shop) {\n              shop\n              plan\n              planKey\n              trialEndsAt\n              activatedAt\n            }\n          }\n        ",a=await N("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n,variables:{shop:A}})});z(null==(e=null==a?void 0:a.data)?void 0:e.plansMe)}catch(n){}}catch(a){}},me=e.useCallback(async()=>{var e,n,a,s,t;try{const i=await N(`/api/schema/status?shop=${A}`);return Y({inProgress:i.inProgress||!1,status:i.status||"idle",message:i.message||null,position:(null==(e=i.queue)?void 0:e.position)||null,estimatedTime:(null==(n=i.queue)?void 0:n.estimatedTime)||null,generatedAt:(null==(a=i.schema)?void 0:a.generatedAt)||null,schemaCount:(null==(s=i.schema)?void 0:s.schemaCount)||0}),"completed"!==i.status||i.inProgress||(Z&&(clearInterval(Z),Q(null)),J.inProgress&&D(`Advanced Schema Data generated! (${(null==(t=i.schema)?void 0:t.schemaCount)||0} schemas)`)),"failed"===i.status&&(Z&&(clearInterval(Z),Q(null)),"NO_OPTIMIZED_PRODUCTS"===i.message?(ue("NO_OPTIMIZED_PRODUCTS"),le(!0)):"ONLY_BASIC_SEO"===i.message&&(ue("ONLY_BASIC_SEO"),le(!0))),i}catch(i){}},[A,N,Z,J.inProgress]),ge=e.useCallback(()=>{Z&&clearInterval(Z),me();const e=setInterval(()=>{me()},1e4);Q(e)},[me,Z]),je=async(e=!1)=>{V(!0);try{const a=b(M),s=["professional_plus","growth_plus","starter_plus"],t=["growth_extra","enterprise"].includes(a),i=s.includes(a),o=r("ai-schema-advanced",{productCount:F||0}).withMargin;if(!t&&!i)return ee({feature:"Advanced Schema Data",currentPlan:M,requiredPlan:"Professional Plus, Growth Plus, Growth Extra, or Enterprise",tokensRequired:o}),H(!0),void V(!1);if(i)try{const e=await N(`/api/billing/tokens/balance?shop=${A}`),n=(null==e?void 0:e.balance)||0;if(n<o)return ce({feature:"ai-schema-advanced",tokensRequired:o,tokensAvailable:n,tokensNeeded:o-n}),te(!0),void V(!1)}catch(n){}const c=await N(`/api/schema/generate-all?shop=${A}`,{method:"POST",body:{shop:A,forceBasicSeo:e}});c.queued?(D("Advanced Schema generation started..."),ge()):c.error&&("NO_OPTIMIZED_PRODUCTS"===c.error?(ue("NO_OPTIMIZED_PRODUCTS"),le(!0)):"ONLY_BASIC_SEO"===c.error?(ue("ONLY_BASIC_SEO"),le(!0)):D(`Error: ${c.error}`))}catch(a){402===a.status?a.trialRestriction&&a.requiresActivation?(ce(a),ae(!0)):a.requiresPurchase?(ce(a),te(!0)):D(a.message||"Payment required"):403===a.status?(ee({feature:"Advanced Schema Data",currentPlan:M,requiredPlan:"Professional Plus, Growth Plus, Growth Extra, or Enterprise"}),H(!0)):400===a.status?"NO_OPTIMIZED_PRODUCTS"===a.error?(ue("NO_OPTIMIZED_PRODUCTS"),le(!0)):"ONLY_BASIC_SEO"===a.error?(ue("ONLY_BASIC_SEO"),le(!0)):D(a.message||"Error generating schema"):D(`Error: ${a.message}`)}finally{V(!1)}},Se=async()=>{k(!0);try{const e=`/api/schema/preview?shop=${encodeURIComponent(A)}`,n=await N(e,{headers:{"X-Shop":A}});n.ok?(C(n.schemas),fe(n.schemas)):D(`Error: ${n.error}`)}catch(e){D(`Failed to load schemas: ${e.message}`)}finally{k(!1)}},fe=e=>{const n=[];e.organization&&n.push(e.organization),e.website&&n.push(e.website);const a=`<script type="application/ld+json">\n${JSON.stringify(n,null,2)}\n<\/script>`;B(a)};return I?n.jsx(c,{children:n.jsx(d,{padding:"400",children:n.jsxs(l,{gap:"400",align:"center",children:[n.jsx(h,{}),n.jsx(u,{children:"Loading schema data..."})]})})}):n.jsxs(n.Fragment,{children:[n.jsx(c,{children:n.jsx(d,{padding:"400",children:n.jsxs(l,{gap:"400",children:[n.jsx(u,{as:"h3",variant:"headingMd",children:"Schema.org Structured Data"}),n.jsx(p,{tone:"info",children:n.jsx(u,{children:"Schema.org structured data helps AI models understand your store content better, improving your visibility and search results."})}),n.jsxs(m,{tabs:[{id:"overview",content:"Overview",accessibilityLabel:"Overview"},{id:"installation",content:"Installation",accessibilityLabel:"Installation"}],selected:w,onSelect:P,children:[0===w&&n.jsx(d,{paddingBlockStart:"400",children:n.jsxs(l,{gap:"400",children:[n.jsx(c,{children:n.jsx(d,{padding:"300",children:n.jsxs(l,{gap:"300",children:[n.jsxs(g,{align:"space-between",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"Organization Schema"}),n.jsx(j,{tone:E.organization?"success":"warning",children:E.organization?"Active":"Not configured"})]}),!E.organization&&n.jsx(u,{as:"p",tone:"subdued",children:"Configure organization details in Store Metadata to enable this schema."})]})})}),n.jsx(c,{children:n.jsx(d,{padding:"300",children:n.jsxs(l,{gap:"300",children:[n.jsxs(g,{align:"space-between",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"WebSite Schema"}),n.jsx(j,{tone:E.website?"success":"warning",children:E.website?"Active":"Not configured"})]}),!E.website&&n.jsx(u,{as:"p",tone:"subdued",children:"Website schema is automatically generated from your store information."})]})})}),n.jsx(c,{children:n.jsx(d,{padding:"300",children:n.jsxs(l,{gap:"300",children:[n.jsxs(g,{align:"space-between",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"Product Schemas"}),n.jsx(j,{tone:"success",children:"Auto-generated"})]}),n.jsxs(u,{tone:"subdued",children:["Product schemas are automatically generated from your AI Optimisation data when pages load.",E.products.length>0&&` ${E.products.length} products have SEO data.`]})]})})}),n.jsx(S,{}),n.jsx(c,{children:n.jsx(d,{padding:"300",children:n.jsxs(l,{gap:"300",children:[n.jsxs(g,{align:"space-between",blockAlign:"center",children:[n.jsxs(l,{gap:"100",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"Advanced Schema Data"}),n.jsx(u,{variant:"bodySm",tone:"subdued",children:"BreadcrumbList, FAQPage, AggregateRating & more AI-generated schemas"})]}),"completed"===J.status&&J.generatedAt?n.jsx(j,{tone:"success",children:"Generated"}):J.inProgress?n.jsx(j,{tone:"attention",children:"Generating..."}):n.jsx(j,{tone:"info",children:"Not generated"})]}),J.inProgress&&n.jsx(d,{paddingBlockStart:"200",children:n.jsxs(g,{gap:"200",blockAlign:"center",children:[n.jsx(h,{size:"small"}),n.jsxs(l,{gap:"100",children:[n.jsx(u,{variant:"bodyMd",tone:"subdued",children:J.message||"Generating schema data..."}),J.position>0&&n.jsxs(u,{variant:"bodySm",tone:"subdued",children:["Queue position: ",J.position," · Est. ",Math.ceil(J.estimatedTime/60)," min"]})]})]})}),!J.inProgress&&"completed"===J.status&&J.generatedAt&&n.jsx(d,{paddingBlockStart:"200",children:n.jsx(g,{gap:"200",blockAlign:"center",children:n.jsxs(u,{variant:"bodySm",tone:"subdued",children:[J.schemaCount," schemas · ",(e=>{if(!e)return"";const n=new Date,a=new Date(e),s=Math.floor((n-a)/1e3/60);if(s<1)return"Just now";if(s<60)return`${s} min ago`;const t=Math.floor(s/60);if(t<24)return`${t}h ago`;return`${Math.floor(t/24)}d ago`})(J.generatedAt)]})})}),n.jsx(d,{paddingBlockStart:"200",children:n.jsx(g,{gap:"200",children:n.jsx(f,{onClick:()=>je(!1),loading:W,disabled:J.inProgress,children:"completed"===J.status?"Regenerate Advanced Schemas":"Generate Advanced Schemas"})})}),n.jsx(d,{paddingBlockStart:"100",children:n.jsx(u,{variant:"bodySm",tone:"subdued",children:"✓ AI-generated FAQ schemas · ✓ Aggregate ratings · ✓ Enhanced product data · ✓ Better AI visibility"})})]})})}),n.jsxs(g,{gap:"300",children:[n.jsx(f,{onClick:async()=>{k(!0);try{const e=`/api/schema/generate?shop=${encodeURIComponent(A)}`,n=await N(e,{method:"POST",headers:{"X-Shop":A},body:{shop:A}});n.ok?(D("Schemas regenerated successfully!"),Se()):D(`Error: ${n.error}`)}catch(e){D(`Failed to regenerate: ${e.message}`)}finally{k(!1)}},loading:I,children:"Regenerate Basic Schemas"}),n.jsx(f,{variant:"plain",url:"https://developers.google.com/search/docs/appearance/structured-data",children:"Learn about Schema.org"})]})]})}),1===w&&n.jsx(d,{paddingBlockStart:"400",children:n.jsxs(l,{gap:"400",children:[n.jsx(p,{tone:"info",children:n.jsxs(l,{gap:"300",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"Theme Installation"}),n.jsxs(v,{type:"number",children:[n.jsx(v.Item,{children:"Go to your Shopify Admin → Online Store → Themes"}),n.jsx(v.Item,{children:'Click "Actions" → "Edit code" on your current theme'}),n.jsxs(v.Item,{children:["Open the file: ",n.jsx("code",{children:"layout/theme.liquid"})]}),n.jsxs(v.Item,{children:["Add this code before the closing ",n.jsx("code",{children:"</head>"})," tag:"]})]})]})}),n.jsx(c,{children:n.jsx(d,{padding:"300",children:n.jsxs(l,{gap:"300",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"Code to Install"}),n.jsx(d,{background:"bg-surface-secondary",padding:"200",borderRadius:"200",children:n.jsx("pre",{style:{fontSize:"12px",overflow:"auto",whiteSpace:"pre-wrap"},children:'{%- comment -%} Advanced Schema Data - Auto-generated by indexAIze - Unlock AI Search {%- endcomment -%}\n\n{%- comment -%} Organization & WebSite Schema (site-wide) {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.shop_schemas -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.shop_schemas.value }}\n  <\/script>\n{%- endif -%}\n\n{%- comment -%} Product Schema (product pages only) {%- endcomment -%}\n{%- if product -%}\n  {%- comment -%} Try Advanced Schema first (requires tokens/Enterprise plan) {%- endcomment -%}\n  {%- assign schema_key = \'schemas_\' | append: request.locale.iso_code -%}\n  {%- assign schemas_json = product.metafields.advanced_schema[schema_key].value -%}\n  {%- if schemas_json -%}\n    <script type="application/ld+json">\n{{ schemas_json }}\n    <\/script>\n  {%- else -%}\n    {%- comment -%} Fallback to basic SEO JSON-LD (available for all plans) {%- endcomment -%}\n    {%- assign seo_key = \'seo__\' | append: request.locale.iso_code -%}\n    {%- assign seo_data_json = product.metafields.seo_ai[seo_key].value | default: product.metafields.seo_ai.seo__en.value -%}\n    {%- if seo_data_json -%}\n      <script type="application/ld+json" id="seo-basic-jsonld-{{ product.id }}">\n      <\/script>\n      <script>\n        (function() {\n          try {\n            var seoData = JSON.parse({{ seo_data_json | json }});\n            if (seoData && seoData.jsonLd) {\n              var scriptTag = document.getElementById(\'seo-basic-jsonld-{{ product.id }}\');\n              if (scriptTag) {\n                scriptTag.textContent = JSON.stringify(seoData.jsonLd);\n              }\n            }\n          } catch(e) {\n            console.error(\'Failed to parse SEO JSON-LD:\', e);\n          }\n        })();\n      <\/script>\n    {%- endif -%}\n  {%- endif -%}\n{%- endif -%}\n\n{%- comment -%} Site-wide FAQ Schema {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.site_faq -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.site_faq.value }}\n  <\/script>\n{%- endif -%}'})}),n.jsx(g,{align:"end",children:n.jsx(f,{onClick:()=>{navigator.clipboard.writeText('{%- comment -%} Advanced Schema Data - Auto-generated by indexAIze - Unlock AI Search {%- endcomment -%}\n\n{%- comment -%} Organization & WebSite Schema (site-wide) {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.shop_schemas -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.shop_schemas.value }}\n  <\/script>\n{%- endif -%}\n\n{%- comment -%} Product Schema (product pages only) {%- endcomment -%}\n{%- if product -%}\n  {%- comment -%} Try Advanced Schema first (requires tokens/Enterprise plan) {%- endcomment -%}\n  {%- assign schema_key = \'schemas_\' | append: request.locale.iso_code -%}\n  {%- assign schemas_json = product.metafields.advanced_schema[schema_key].value -%}\n  {%- if schemas_json -%}\n    <script type="application/ld+json">\n{{ schemas_json }}\n    <\/script>\n  {%- else -%}\n    {%- comment -%} Fallback to basic SEO JSON-LD (available for all plans) {%- endcomment -%}\n    {%- assign seo_key = \'seo__\' | append: request.locale.iso_code -%}\n    {%- assign seo_data_json = product.metafields.seo_ai[seo_key].value | default: product.metafields.seo_ai.seo__en.value -%}\n    {%- if seo_data_json -%}\n      <script type="application/ld+json" id="seo-basic-jsonld-{{ product.id }}">\n      <\/script>\n      <script>\n        (function() {\n          try {\n            var seoData = JSON.parse({{ seo_data_json | json }});\n            if (seoData && seoData.jsonLd) {\n              var scriptTag = document.getElementById(\'seo-basic-jsonld-{{ product.id }}\');\n              if (scriptTag) {\n                scriptTag.textContent = JSON.stringify(seoData.jsonLd);\n              }\n            }\n          } catch(e) {\n            console.error(\'Failed to parse SEO JSON-LD:\', e);\n          }\n        })();\n      <\/script>\n    {%- endif -%}\n  {%- endif -%}\n{%- endif -%}\n\n{%- comment -%} Site-wide FAQ Schema {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.site_faq -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.site_faq.value }}\n  <\/script>\n{%- endif -%}'),D("Code copied to clipboard!")},children:"Copy Code"})}),n.jsx(p,{tone:"warning",children:n.jsx(u,{children:"Always backup your theme before making changes!"})})]})})}),n.jsx(c,{children:n.jsx(d,{padding:"300",children:n.jsxs(l,{gap:"300",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"Testing Your Installation"}),n.jsxs(v,{children:[n.jsx(v.Item,{children:"After installation, visit your store's homepage and product pages"}),n.jsx(v.Item,{children:"View the page source (right-click → View Source)"}),n.jsxs(v.Item,{children:["Search for ",n.jsx("code",{children:"application/ld+json"})," to find your schemas"]}),n.jsx(v.Item,{children:"Use the Validation tab to test with Google's tools"})]})]})})})]})})]})]})})}),T&&n.jsx(x,{content:T,onDismiss:()=>D("")}),n.jsx(o,{open:X,onClose:()=>H(!1),feature:K.feature,currentPlan:K.currentPlan,requiredPlan:K.requiredPlan,returnTo:"/ai-seo/schema-data"}),n.jsx(s,{open:ne,onClose:()=>ae(!1),onActivate:async()=>{try{const e=await N(`/api/billing/activate?shop=${A}`,{method:"POST",body:{shop:A,endTrial:!0,returnTo:window.location.pathname}});e.confirmationUrl?window.top.location.href=e.confirmationUrl:e.success&&(ae(!1),D("Plan activated! You can now generate Advanced Schema Data."),setTimeout(()=>je(),1e3))}catch(e){D("Failed to activate plan")}},feature:"Advanced Schema Data",tokensRequired:(null==re?void 0:re.tokensRequired)||r("ai-schema-advanced",{productCount:F}).withMargin}),n.jsx(t,{open:se,onClose:()=>te(!1),onPurchase:()=>{te(!1),oe(!0)},feature:"ai-schema-advanced",tokensRequired:(null==re?void 0:re.tokensRequired)||0,tokensAvailable:(null==re?void 0:re.tokensAvailable)||0,tokensNeeded:(null==re?void 0:re.tokensNeeded)||(null==re?void 0:re.tokensRequired)||0}),n.jsx(i,{open:ie,onClose:()=>oe(!1),tokensNeeded:(null==re?void 0:re.tokensNeeded)||0,returnTo:"/ai-seo/schema-data"}),n.jsx(_,{open:de,onClose:()=>le(!1),title:"NO_OPTIMIZED_PRODUCTS"===he?"No Optimized Products":"Only Basic SEO Found",primaryAction:"ONLY_BASIC_SEO"===he?{content:"Generate with Basic SEO",onAction:()=>{le(!1),je(!0)}}:{content:"Go to Products",onAction:()=>{le(!1);const e=new URLSearchParams(window.location.search);window.location.href=`/ai-seo/bulk-edit?shop=${A}&host=${e.get("host")}&embedded=${e.get("embedded")}`}},secondaryActions:[{content:"Cancel",onAction:()=>le(!1)}],children:n.jsx(_.Section,{children:"NO_OPTIMIZED_PRODUCTS"===he?n.jsx(u,{children:"Advanced Schema Data requires products with AI Search Optimisation. Please run Basic or AI Enhanced SEO on your products first."}):n.jsxs(l,{gap:"200",children:[n.jsx(u,{children:"Your products only have Basic SEO optimisation. For best results, we recommend using AI Enhanced SEO which provides richer data for schemas."}),n.jsx(u,{tone:"subdued",children:"You can still generate Advanced Schemas using Basic SEO data, but the results may be less comprehensive."})]})})})]})}export{O as default};
