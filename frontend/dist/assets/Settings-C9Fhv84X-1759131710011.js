import{j as e}from"./app-bridge-BSbYxldi-1759131710011.js";import{r as c}from"./react-vendor-tAaa2TlE-1759131710011.js";import{m as Ie}from"./index-BY5w-LQp-1759131710011.js";import{C as j,a as g,T as i,I as E,r as je,d as u,g as v,h as G,D as Ne,f as B,B as T,n as He,v as Qe,M as m,e as Ye,k as Ke}from"./polaris-BwY5cKlu-1759131710011.js";function lo(){var xe,fe;console.log("[SETTINGS] ===== SETTINGS COMPONENT LOADED ====="),console.log("[SETTINGS] Starting component initialization...");const Ae=(o,a="")=>{try{return new URLSearchParams(window.location.search).get(o)||a}catch{return a}},N=o=>(o||"starter").toLowerCase().replace(" ","_"),Y=(o,a=null)=>{console.log(`[SETTINGS DEBUG] ${o}`,a||"")},n=Ae("shop",""),[we,K]=c.useState(!0),[ye,X]=c.useState(!1),[s,k]=c.useState(null),[Z,R]=c.useState(""),[ee,J]=c.useState(!1),[y,S]=c.useState(""),[oe,Ce]=c.useState(null),[se,$]=c.useState(null),[te,De]=c.useState(!1),[F,Pe]=c.useState(!1),[z,ve]=c.useState(!1),[Be,ke]=c.useState(!1),[Oe,Me]=c.useState(!1),[Ue,Le]=c.useState(!1),[Re,ae]=c.useState(!1),[ne,O]=c.useState(!1),[re,M]=c.useState(!1),[le,V]=c.useState(!1),[ce,Je]=c.useState(""),[ie,A]=c.useState(null),[de,he]=c.useState(!1),[_,W]=c.useState(null),[Se,$e]=c.useState(!1),[Xe,Ze]=c.useState(!1),[eo,oo]=c.useState(""),[so,Fe]=c.useState({enabled:!1,generating:!1,generated:!1,progress:""}),[C,x]=c.useState(!1),[b,q]=c.useState({current:0,total:0,percent:0,currentProduct:"",stats:{siteFAQ:!1,products:0,totalSchemas:0}}),[w,I]=c.useState(!1),p=c.useMemo(()=>Ie(),[]);console.log("[SETTINGS] ===== SHOP EXTRACTION DEBUG ====="),console.log("[SETTINGS] Extracted shop:",n),console.log("[SETTINGS] API function created:",typeof p),console.log("[SETTINGS] makeSessionFetch function:",typeof Ie),c.useEffect(()=>{if(y){console.log("[SETTINGS] Toast state changed to:",y),oe&&clearTimeout(oe);const o=setTimeout(()=>{console.log("[SETTINGS] Auto-clearing toast after 5 seconds"),S("")},5e3);Ce(o)}},[y]);const ze=()=>{console.log("[SETTINGS] Starting polling for background regeneration completion..."),se&&clearInterval(se);let o=0;const a=30,t=setInterval(async()=>{o++,console.log(`[SETTINGS] Polling attempt ${o}/${a}`);try{const r=await p(`/api/sitemap/info?shop=${n}`);if(console.log("[SETTINGS] Sitemap info:",r),r&&r.generatedAt){const h=new Date(r.generatedAt).getTime();if(Date.now()-h<12e4){console.log("[SETTINGS] Background regeneration completed!"),clearInterval(t),$(null),S("AI-Optimized Sitemap regeneration completed successfully!"),console.log("[SETTINGS] Setting showAiSitemapView to true for AI sitemap regeneration completion"),Me(!0);return}}o>=a&&(console.log("[SETTINGS] Polling timeout reached"),clearInterval(t),$(null),S("Background regeneration is taking longer than expected. Please check the sitemap manually."))}catch(r){console.error("[SETTINGS] Polling error:",r)}},1e4);$(t)},ge=c.useCallback(async()=>{var o,a;try{console.log("[SETTINGS DEBUG] ===== CHECKING PRODUCTS DATA ====="),console.log("[SETTINGS DEBUG] Shop:",n);const t=await p(`/api/products/list?shop=${n}&limit=10&optimized=true`);console.log("[SETTINGS DEBUG] API Result:",t),console.log("[SETTINGS DEBUG] Products length:",(o=t==null?void 0:t.products)==null?void 0:o.length),console.log("[SETTINGS DEBUG] Products:",t==null?void 0:t.products);const r=(a=t==null?void 0:t.products)==null?void 0:a.some(h=>{var d,l;return((l=(d=h==null?void 0:h.optimizationSummary)==null?void 0:d.optimizedLanguages)==null?void 0:l.length)>0});return console.log("[SETTINGS DEBUG] Has optimized products:",r),console.log("[SETTINGS DEBUG] ===== PRODUCTS CHECK COMPLETE ====="),r}catch(t){return console.error("[SETTINGS] Error checking products data:",t),!1}},[n,p]),pe=c.useCallback(async()=>{var o,a;try{console.log("[SETTINGS DEBUG] ===== CHECKING COLLECTIONS DATA ====="),console.log("[SETTINGS DEBUG] Shop:",n);const t=await p(`/collections/list-graphql?shop=${n}`);console.log("[SETTINGS DEBUG] API Result:",t),console.log("[SETTINGS DEBUG] Collections length:",(o=t==null?void 0:t.collections)==null?void 0:o.length),console.log("[SETTINGS DEBUG] Collections:",t==null?void 0:t.collections);const r=(a=t==null?void 0:t.collections)==null?void 0:a.some(h=>{var d;return((d=h==null?void 0:h.optimizedLanguages)==null?void 0:d.length)>0});return console.log("[SETTINGS DEBUG] Has optimized collections:",r),console.log("[SETTINGS DEBUG] ===== COLLECTIONS CHECK COMPLETE ====="),r}catch(t){return console.error("[SETTINGS] Error checking collections data:",t),!1}},[n,p]),ue=c.useCallback(async()=>{var o,a;try{const r=await p("/graphql",{method:"POST",body:JSON.stringify({query:`
        query CheckStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
          }
        }
      `,variables:{shop:n}}),shop:n});return(a=(o=r==null?void 0:r.data)==null?void 0:o.storeMetadata)==null?void 0:a.shopName}catch(t){return console.error("[SETTINGS] Error checking store metadata:",t),!1}},[n,p]),Te=c.useCallback(async()=>{var o;try{console.log("[SETTINGS DEBUG] ===== CHECKING WELCOME PAGE ====="),console.log("[SETTINGS DEBUG] Shop:",n),console.log("[SETTINGS DEBUG] Current settings features:",s==null?void 0:s.features),console.log("[SETTINGS DEBUG] Welcome page feature enabled:",(o=s==null?void 0:s.features)==null?void 0:o.welcomePage),console.log("[SETTINGS DEBUG] Current plan:",s==null?void 0:s.plan);const a=await p(`/ai/welcome?shop=${n}`);if(console.log("[SETTINGS DEBUG] Welcome page result:",a),console.log("[SETTINGS DEBUG] Result type:",typeof a),console.log("[SETTINGS DEBUG] Result keys:",a?Object.keys(a):"null"),a!=null&&a.error&&typeof a.error=="string"&&!a.error.includes("<!DOCTYPE html>"))return console.log("[SETTINGS DEBUG] Welcome page error:",a.error),console.log("[SETTINGS DEBUG] Error debug info:",a.debug),!1;const t=typeof a=="string"&&a.includes("<!DOCTYPE html>")||(a==null?void 0:a.error)&&typeof a.error=="string"&&a.error.includes("<!DOCTYPE html>");return console.log("[SETTINGS DEBUG] Has welcome page:",t),console.log("[SETTINGS DEBUG] ===== WELCOME PAGE CHECK COMPLETE ====="),t}catch(a){return console.error("[SETTINGS] Error checking welcome page:",a),!1}},[n,p,s]),U=c.useCallback(async()=>{var o,a,t,r,h,d;console.log("[SETTINGS] ===== checkGeneratedData CALLED ====="),console.log("[SETTINGS] checkGeneratedData - shop:",n),console.log("[SETTINGS] checkGeneratedData - settings:",s),console.log("[SETTINGS] checkGeneratedData - settings?.features:",s==null?void 0:s.features);try{if(console.log("[SETTINGS] ===== CHECKING GENERATED DATA ====="),(o=s==null?void 0:s.features)!=null&&o.productsJson){console.log("[SETTINGS] ===== CHECKING PRODUCTS JSON FEATURE ====="),console.log("[SETTINGS] Products JSON feature is enabled:",(a=s==null?void 0:s.features)==null?void 0:a.productsJson);const l=await ge();console.log("[SETTINGS] Setting showProductsJsonView to:",l),Pe(l),console.log("[SETTINGS] Products JSON data exists:",l)}else console.log("[SETTINGS] Products JSON feature is disabled");if((t=s==null?void 0:s.features)!=null&&t.collectionsJson){console.log("[SETTINGS] ===== CHECKING COLLECTIONS JSON FEATURE ====="),console.log("[SETTINGS] Collections JSON feature is enabled:",(r=s==null?void 0:s.features)==null?void 0:r.collectionsJson);const l=await pe();console.log("[SETTINGS] Setting showCollectionsJsonView to:",l),ve(l),console.log("[SETTINGS] Collections JSON data exists:",l)}else console.log("[SETTINGS] Collections JSON feature is disabled");if((h=s==null?void 0:s.features)!=null&&h.storeMetadata){console.log("[SETTINGS] Checking Store Metadata data...");const l=await ue();ke(l),console.log("[SETTINGS] Store Metadata exists:",l)}if((d=s==null?void 0:s.features)!=null&&d.welcomePage){console.log("[SETTINGS] Checking Welcome Page data...");const l=await Te();Le(l),console.log("[SETTINGS] Welcome Page exists:",l)}console.log("[SETTINGS] ===== GENERATED DATA CHECK COMPLETE =====")}catch(l){console.error("[SETTINGS] Error checking generated data:",l)}},[s==null?void 0:s.features,ge,pe,ue,Te]);console.log("[SETTINGS] State variables initialized successfully"),console.log("[SETTINGS] About to create useEffect hooks...");const Ve=async(o,a)=>{var h,d;console.log("[DEBUG] runGQL called with query:",o),console.log("[DEBUG] runGQL variables:",a);const t=JSON.stringify({query:o,variables:a});console.log("[DEBUG] runGQL body:",t);const r=await p("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:t});if(console.log("[DEBUG] runGQL response:",r),(h=r==null?void 0:r.errors)!=null&&h.length)throw console.error("[DEBUG] GraphQL errors:",r.errors),new Error(((d=r.errors[0])==null?void 0:d.message)||"GraphQL error");return r==null?void 0:r.data};console.log("[SETTINGS] Creating loadSettings useEffect..."),console.log("[SETTINGS] Current shop value:",n),console.log("[SETTINGS] Shop type:",typeof n),console.log("[SETTINGS] Shop length:",n==null?void 0:n.length),c.useEffect(()=>{if(console.log("[SETTINGS] ===== LOAD SETTINGS useEffect ====="),console.log("[SETTINGS] Shop:",n),console.log("[SETTINGS] API function:",typeof p),console.log("[SETTINGS] useEffect dependencies - shop:",n),!n){console.log("[SETTINGS] No shop, setting loading to false"),K(!1);return}console.log("[SETTINGS] Shop available, calling loadSettings..."),We()},[n]),console.log("[SETTINGS] loadSettings useEffect created successfully"),c.useEffect(()=>{Se&&_e()},[Se]),c.useEffect(()=>{s&&Object.values(s.features||{}).some(o=>o)&&k(o=>({...o,enabled:!0,discoveryEnabled:!0}))},[s==null?void 0:s.features]);const _e=async()=>{try{const o=await p(`/api/schema/status?shop=${n}`);Fe({enabled:o.enabled,generating:o.generating,generated:o.hasSiteFAQ||o.productsWithSchema>0,progress:o.progress||""})}catch(o){console.error("Failed to check schema status:",o)}},H=async()=>{try{const o=await p(`/ai/schema-data.json?shop=${n}`);if(o.schemas&&o.schemas.length>0){I(!0),x(!1);const a=[...new Set(o.schemas.map(t=>{var r,h;return(h=(r=t.url)==null?void 0:r.split("/products/")[1])==null?void 0:h.split("#")[0]}))].filter(Boolean);q(t=>({...t,percent:100,stats:{siteFAQ:!!o.site_faq,products:a.length,totalSchemas:o.schemas.length}}))}else q(a=>({...a,percent:Math.min(a.percent+10,90),currentProduct:"Processing products..."})),setTimeout(H,3e3)}catch(o){console.error("Progress check error:",o),setTimeout(H,3e3)}},We=async()=>{var o,a;try{console.log("[SETTINGS] ===== STARTING LOAD SETTINGS ====="),console.log("[SETTINGS] Shop:",n),console.log("[SETTINGS] API function:",typeof p),console.log("[SETTINGS] Calling API...");const t=await p(`/api/ai-discovery/settings?shop=${n}`);console.log("[SETTINGS] ===== SETTINGS LOADED ====="),console.log("[SETTINGS] Raw data:",t),console.log("[SETTINGS] Settings plan:",t==null?void 0:t.plan),console.log("[SETTINGS] Normalized plan:",N(t==null?void 0:t.plan)),console.log("[SETTINGS] Features:",t==null?void 0:t.features),console.log("[SETTINGS] Products JSON feature:",(o=t==null?void 0:t.features)==null?void 0:o.productsJson),console.log("[SETTINGS] Collections JSON feature:",(a=t==null?void 0:t.features)==null?void 0:a.collectionsJson),k(t),W(t),$e(t.advancedSchemaEnabled||!1),L(t),console.log("[SETTINGS] ===== LOAD SETTINGS COMPLETE =====")}catch(t){console.error("[SETTINGS] ===== LOAD SETTINGS ERROR ====="),console.error("[SETTINGS] Failed to load settings:",t),S("Failed to load settings")}finally{K(!1)}},L=async(o=s)=>{console.log("[GENERATE ROBOTS] Called with shop:",n);try{const a=await p(`/api/ai-discovery/robots-txt?shop=${n}`,{responseType:"text"});console.log("[GENERATE ROBOTS] Received:",a),R(a||`User-agent: *
Disallow: /`)}catch(a){console.error("[GENERATE ROBOTS] Error:",a),R(`# Error generating robots.txt
# `+a.message)}};console.log("[SETTINGS DEBUG] generateRobotsTxt function exists:",typeof L);const Q=o=>{var a;if(!((a=s==null?void 0:s.availableBots)!=null&&a.includes(o))){S(`Upgrade to ${requiredPlan} plan to enable ${s.bots[o].name}`);return}k(t=>({...t,bots:{...t.bots,[o]:{...t.bots[o],enabled:!t.bots[o].enabled}}})),ae(!0)},me=o=>{if(!Ee(o)){S(`Upgrade your plan to enable ${{productsJson:"Products JSON Feed",aiSitemap:"AI-Optimized Sitemap",welcomePage:"AI Welcome Page",collectionsJson:"Collections JSON Feed",storeMetadata:"Store Metadata",schemaData:"Schema Data"}[o]||o}`);return}k(a=>({...a,features:{...a.features,[o]:!a.features[o]}}))},qe=async()=>{var o,a,t,r,h;console.log("[SETTINGS] ===== SAVE SETTINGS CALLED ====="),console.log("[SETTINGS] Current settings:",s),X(!0);try{if(await p(`/api/ai-discovery/settings?shop=${n}`,{method:"POST",body:{shop:n,bots:s.bots,features:s.features}}),ae(!1),W(s),L(),console.log("[SETTINGS] Checking AI Sitemap feature:",(o=s.features)==null?void 0:o.aiSitemap),(a=s.features)!=null&&a.aiSitemap)try{console.log("[SETTINGS] ===== AI SITEMAP BACKGROUND REGENERATION START ====="),console.log("[SETTINGS] AI Sitemap enabled, starting background regeneration..."),console.log("[SETTINGS] Shop:",n);const d=`
            mutation RegenerateSitemap($shop: String!) {
              regenerateSitemap(shop: $shop) {
                success
                message
                shop
              }
            }
          `;console.log("[SETTINGS] GraphQL mutation:",d),console.log("[SETTINGS] Variables:",{shop:n});const l=await p("/graphql",{method:"POST",body:JSON.stringify({query:d,variables:{shop:n}}),shop:n});console.log("[SETTINGS] GraphQL sitemap regeneration result:",l),(r=(t=l==null?void 0:l.data)==null?void 0:t.regenerateSitemap)!=null&&r.success?(console.log("[SETTINGS] Background regeneration started successfully"),console.log("[SETTINGS] Setting toast for AI sitemap regeneration with delay..."),S(""),setTimeout(()=>{S("Settings saved! AI-Optimized Sitemap is being regenerated in the background. This may take a few moments."),console.log("[SETTINGS] Success toast set after delay"),ze()},100)):(console.log("[SETTINGS] Background regeneration failed:",(h=l==null?void 0:l.data)==null?void 0:h.regenerateSitemap),console.log("[SETTINGS] Setting toast for failed regeneration..."),S(""),setTimeout(()=>{S("Settings saved, but sitemap regeneration failed"),console.log("[SETTINGS] Error toast set after delay")},100)),console.log("[SETTINGS] ===== AI SITEMAP BACKGROUND REGENERATION END =====")}catch(d){console.error("[SETTINGS] Failed to start sitemap regeneration:",d),S("Settings saved, but sitemap regeneration failed")}else console.log("[SETTINGS] AI Sitemap disabled, skipping background regeneration"),console.log("[SETTINGS] Setting toast for basic save with delay..."),S(""),setTimeout(()=>{S("Settings saved successfully"),console.log("[SETTINGS] Basic success toast set after delay"),console.log("[SETTINGS] Basic save completed, not showing View buttons")},100)}catch(d){console.error("Failed to save settings:",d),S("Failed to save settings")}finally{X(!1)}},Ee=o=>{var r;const a=N(s==null?void 0:s.plan);return((r={productsJson:["starter","professional","growth","growth_extra","enterprise"],aiSitemap:["starter","professional","growth","growth_extra","enterprise"],welcomePage:["professional","growth","growth_extra","enterprise"],collectionsJson:["growth","growth_extra","enterprise"],storeMetadata:["growth_extra","enterprise"],schemaData:["enterprise"]}[o])==null?void 0:r.includes(a))||!1},D=async o=>{console.log(`[DEBUG] setTestPlan called with plan: ${o}, shop: ${n}`);try{const a=`
        mutation SetPlan($shop:String!, $plan: PlanEnum) {
          setPlanOverride(shop:$shop, plan:$plan) { shop plan }
        }
      `;console.log("[DEBUG] GraphQL mutation:",a),console.log("[DEBUG] Variables:",{shop:n,plan:o});const t=await Ve(a,{shop:n,plan:o});console.log("[DEBUG] GraphQL result:",t),S(`Test plan set to ${o||"actual"}`),setTimeout(()=>window.location.reload(),500)}catch(a){console.error("[DEBUG] Failed to set test plan",a),S(`Failed to set test plan: ${a.message}`)}},P=async(o,a)=>{var t,r,h;Je(a),V(!0),he(!0),A(null);try{const d={productsJson:`/ai/products.json?shop=${n}`,collectionsJson:`/ai/collections-feed.json?shop=${n}`,storeMetadata:`/ai/store-metadata.json?shop=${n}`,schemaData:`/ai/schema-data.json?shop=${n}`,aiSitemap:`/api/sitemap/generate?shop=${n}&force=true`,welcomePage:`/ai/welcome?shop=${n}`};if(o==="aiSitemap"){console.log("[SETTINGS] Loading AI Sitemap XML...");const l=await fetch(d[o],{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${((h=(r=(t=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:t.getState())==null?void 0:r.session)==null?void 0:h.token)||""}`}});if(l.ok){console.log("[SETTINGS] AI Sitemap XML loaded successfully");const f=await l.text();A(f)}else throw new Error(`HTTP ${l.status}: ${l.statusText}`)}else{const l=await p(d[o]);A(JSON.stringify(l,null,2))}}catch(d){console.error("[SETTINGS] Error loading data:",d),A(`Error loading data: ${d.message}`)}finally{he(!1)}};c.useEffect(()=>{console.log("[SETTINGS] showViewButtons state changed to:",te)},[te]),c.useEffect(()=>{console.log("[SETTINGS] Resetting showViewButtons on component mount"),De(!1)},[]),console.log("[SETTINGS] Creating checkGeneratedData useEffect..."),console.log("[SETTINGS] Current settings:",s),console.log("[SETTINGS] Current settings features:",s==null?void 0:s.features),c.useEffect(()=>{console.log("[SETTINGS DEBUG] ===== useEffect TRIGGERED ====="),console.log("[SETTINGS DEBUG] Settings:",s),console.log("[SETTINGS DEBUG] Settings features:",s==null?void 0:s.features),console.log("[SETTINGS DEBUG] Shop:",n),console.log("[SETTINGS DEBUG] Conditions check:"),console.log("[SETTINGS DEBUG] - settings?.features exists:",!!(s!=null&&s.features)),console.log("[SETTINGS DEBUG] - shop exists:",!!n),console.log("[SETTINGS DEBUG] - Both conditions met:",!!(s!=null&&s.features&&n)),s!=null&&s.features&&n?(console.log("[SETTINGS] Checking for generated data..."),U()):console.log("[SETTINGS] Skipping checkGeneratedData - conditions not met")},[s==null?void 0:s.features,n,U]),console.log("[SETTINGS] checkGeneratedData useEffect created successfully"),c.useEffect(()=>{console.log("[SETTINGS] ===== FORCE CHECK ON MOUNT ====="),console.log("[SETTINGS] Shop:",n),console.log("[SETTINGS] Settings:",s),console.log("[SETTINGS] Settings features:",s==null?void 0:s.features),console.log("[SETTINGS] checkGeneratedData function:",typeof U),n&&(s!=null&&s.features)?(console.log("[SETTINGS] Both shop and settings available, calling checkGeneratedData..."),U()):(console.log("[SETTINGS] Missing shop or settings, skipping checkGeneratedData"),console.log("[SETTINGS] - shop exists:",!!n),console.log("[SETTINGS] - settings?.features exists:",!!(s!=null&&s.features)))},[]);try{return n?we?e.jsx(j,{children:e.jsx(g,{padding:"400",children:e.jsxs(E,{align:"center",children:[e.jsx(je,{size:"small"}),e.jsx(i,{children:"Loading settings..."})]})})}):e.jsxs(u,{gap:"600",children:[e.jsx(j,{children:e.jsx(g,{padding:"400",children:e.jsxs(u,{gap:"400",children:[e.jsxs(E,{align:"space-between",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"AI Bot Access Control"}),(s==null?void 0:s.plan)&&e.jsxs(v,{tone:"info",children:[s.plan.charAt(0).toUpperCase()+s.plan.slice(1)," Plan"]})]}),e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Choose which AI bots can access your store's structured data"}),e.jsx(G,{status:"info",children:e.jsxs(u,{gap:"200",children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"How it works:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginBottom:0},children:[e.jsx("li",{children:"Select AI bots below"}),e.jsx("li",{children:"Save Settings"}),e.jsx("li",{children:"Generate robots.txt"})]})]})}),e.jsx(Ne,{}),e.jsxs(u,{gap:"300",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["openai","perplexity"].map(o=>{var f,Ge,be;const a=(f=s==null?void 0:s.bots)==null?void 0:f[o];if(!a)return null;const t={starter:["openai","perplexity"],professional:["openai","anthropic","perplexity"],growth:["openai","anthropic","google","perplexity","meta","others"],growth_extra:["openai","anthropic","google","perplexity","meta","others"],enterprise:["openai","anthropic","google","perplexity","meta","others"]},r=N(s==null?void 0:s.plan),d=(t[r]||t.starter).includes(o),l=o==="anthropic"?"Professional":o==="google"?"Growth":["meta","others"].includes(o)?"Growth Extra":null;return e.jsx(g,{padding:"200",background:d?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(u,{gap:"100",children:e.jsx(B,{label:e.jsxs(E,{gap:"200",align:"center",children:[e.jsx(i,{variant:d?"bodyMd":"bodySm",tone:d?"base":"subdued",children:a.name||o}),!d&&l&&e.jsxs(v,{tone:"info",size:"small",children:[l,"+"]})]}),checked:!!((be=(Ge=s==null?void 0:s.bots)==null?void 0:Ge[o])!=null&&be.enabled),onChange:()=>Q(o),disabled:!d,helpText:d?o==="openai"?"Most popular AI assistant":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="perplexity"?"AI-powered search":o==="meta"?"Meta AI platforms":o==="others"?"Bytespider, DeepSeek, etc.":"":`Upgrade to ${l} plan to enable this AI bot`})})},o)})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["anthropic","google"].map(o=>{var h,d,l,f;const a=(h=s==null?void 0:s.bots)==null?void 0:h[o];if(!a)return null;const t=(d=s==null?void 0:s.availableBots)==null?void 0:d.includes(o),r=o==="anthropic"?"Professional":o==="google"?"Growth":["meta","others"].includes(o)?"Growth Extra":null;return e.jsx(g,{padding:"200",background:t?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(u,{gap:"100",children:e.jsx(B,{label:e.jsxs(E,{gap:"200",align:"center",children:[e.jsx(i,{variant:t?"bodyMd":"bodySm",tone:t?"base":"subdued",children:a.name||o}),!t&&r&&e.jsxs(v,{tone:"info",size:"small",children:[r,"+"]})]}),checked:!!((f=(l=s==null?void 0:s.bots)==null?void 0:l[o])!=null&&f.enabled),onChange:()=>Q(o),disabled:!t,helpText:t?o==="openai"?"Most popular AI assistant":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="perplexity"?"AI-powered search":o==="meta"?"Meta AI platforms":o==="others"?"Bytespider, DeepSeek, etc.":"":`Upgrade to ${r} plan to enable this AI bot`})})},o)})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["meta","others"].map(o=>{var h,d,l,f;const a=(h=s==null?void 0:s.bots)==null?void 0:h[o];if(!a)return null;const t=(d=s==null?void 0:s.availableBots)==null?void 0:d.includes(o),r=o==="anthropic"?"Professional":o==="google"?"Growth":["meta","others"].includes(o)?"Growth Extra":null;return e.jsx(g,{padding:"200",background:t?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(u,{gap:"100",children:e.jsx(B,{label:e.jsxs(E,{gap:"200",align:"center",children:[e.jsx(i,{variant:t?"bodyMd":"bodySm",tone:t?"base":"subdued",children:a.name||o}),!t&&r&&e.jsxs(v,{tone:"info",size:"small",children:[r,"+"]})]}),checked:!!((f=(l=s==null?void 0:s.bots)==null?void 0:l[o])!=null&&f.enabled),onChange:()=>Q(o),disabled:!t,helpText:t?o==="openai"?"Most popular AI assistant":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="perplexity"?"AI-powered search":o==="meta"?"Meta AI platforms":o==="others"?"Bytespider, DeepSeek, etc.":"":`Upgrade to ${r} plan to enable this AI bot`})})},o)})})]})]})})}),e.jsx(j,{children:e.jsx(g,{padding:"400",children:e.jsxs(u,{gap:"400",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"robots.txt Configuration"}),Re&&e.jsx(G,{status:"warning",title:"Unsaved changes",children:e.jsx("p",{children:'You have unsaved bot selections. Please click "Save Settings" before configuring robots.txt.'})}),e.jsx(G,{children:e.jsx("p",{children:["growth","growth_extra","enterprise"].includes(N(s==null?void 0:s.plan))?"With your plan, you can apply robots.txt changes directly to your theme!":"Copy the generated rules and add them to your theme's robots.txt.liquid file."})}),e.jsxs(E,{gap:"200",children:[e.jsx(T,{onClick:async()=>{console.log("[ADD MANUAL] Starting..."),console.log("[ADD MANUAL] Settings:",s);try{const o=Object.values((s==null?void 0:s.bots)||{}).some(a=>a.enabled);console.log("[ADD MANUAL] Has selected bots:",o),o?(console.log("[ADD MANUAL] Calling generateRobotsTxt..."),await L(),console.log("[ADD MANUAL] Robots.txt generated, showing instructions"),M(!0)):(console.log("[ADD MANUAL] No bots, showing modal"),O(!0))}catch(o){console.error("[ADD MANUAL] Error:",o),S("Error generating robots.txt: "+o.message)}},children:"Add manually"}),["growth","growth_extra","enterprise"].includes(N(s==null?void 0:s.plan))&&e.jsx(T,{primary:!0,onClick:async()=>{console.log("[APPLY AUTO] Starting..."),console.log("[APPLY AUTO] Settings:",s),console.log("[APPLY AUTO] Bots:",s==null?void 0:s.bots);try{const o=Object.values((s==null?void 0:s.bots)||{}).some(t=>t.enabled);if(console.log("[APPLY AUTO] Has selected bots:",o),!o){console.log("[APPLY AUTO] No bots selected, showing modal"),O(!0);return}console.log("[APPLY AUTO] Applying robots.txt...");const a=await p(`/api/ai-discovery/apply-robots?shop=${n}`,{method:"POST",shop:n,body:{shop:n}});console.log("[APPLY AUTO] Data:",a),S(a.message||"robots.txt applied successfully!")}catch(o){console.error("[APPLY AUTO] Error:",o),S(o.message)}},children:"Apply Automatically"})]})]})})}),e.jsx(g,{paddingInlineStart:"600",paddingInlineEnd:"600",children:e.jsxs(E,{align:"center",blockAlign:"center",children:[e.jsx(g,{children:e.jsx(He,{source:Qe,color:"subdued"})}),e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Configure what data the AI bots can access"})]})}),e.jsx(j,{children:e.jsx(g,{padding:"400",children:e.jsxs(u,{gap:"400",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"AI Discovery Features"}),e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Select the features you want to enable for AI bots to consume your store data."}),e.jsx(G,{status:"info",children:`Don't forget to click "Save Settings" after making changes.`}),e.jsx(Ne,{}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1rem"},children:[{key:"productsJson",name:"Products JSON Feed",description:"Bulk product data for AI consumption",requiredPlan:null},{key:"aiSitemap",name:"AI-Optimized Sitemap",description:"Enhanced sitemap with AI hints",requiredPlan:null},{key:"welcomePage",name:"AI Welcome Page",description:"Landing page for AI bots",requiredPlan:"Professional"},{key:"collectionsJson",name:"Collections JSON Feed",description:"Category data for better AI understanding",requiredPlan:"Growth"},{key:"storeMetadata",name:"Store Metadata for AI Search",description:"Organization & LocalBusiness schema",requiredPlan:"Growth Extra"},{key:"schemaData",name:"Advanced Schema Data",description:"BreadcrumbList, FAQPage & more",requiredPlan:"Enterprise"}].map(o=>{var r;const a=Ee(o.key),t=!!((r=s==null?void 0:s.features)!=null&&r[o.key]);return e.jsx(g,{padding:"200",background:a?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:a?e.jsxs(E,{align:"space-between",blockAlign:"center",children:[e.jsx(g,{flexGrow:1,children:e.jsx(B,{label:o.name,checked:t,onChange:()=>me(o.key),helpText:o.description})}),o.key==="aiSitemap"&&Oe&&e.jsx(T,{size:"slim",onClick:()=>P(o.key,o.name),children:"View"}),o.key==="productsJson"&&(console.log("[SETTINGS DEBUG] Products JSON button check:"),console.log("[SETTINGS DEBUG] - feature.key === productsJson:",o.key==="productsJson"),console.log("[SETTINGS DEBUG] - showProductsJsonView:",F),console.log("[SETTINGS DEBUG] - Should show button:",o.key==="productsJson"&&F),o.key==="productsJson"&&F)&&e.jsx(T,{size:"slim",onClick:()=>P(o.key,o.name),children:"View"}),o.key==="collectionsJson"&&(console.log("[SETTINGS DEBUG] Collections JSON button check:"),console.log("[SETTINGS DEBUG] - feature.key === collectionsJson:",o.key==="collectionsJson"),console.log("[SETTINGS DEBUG] - showCollectionsJsonView:",z),console.log("[SETTINGS DEBUG] - Should show button:",o.key==="collectionsJson"&&z),o.key==="collectionsJson"&&z)&&e.jsx(T,{size:"slim",onClick:()=>P(o.key,o.name),children:"View"}),o.key==="storeMetadata"&&Be&&e.jsx(T,{size:"slim",onClick:()=>P(o.key,o.name),children:"View"}),o.key==="welcomePage"&&Ue&&e.jsx(T,{size:"slim",onClick:()=>P(o.key,o.name),children:"View"})]}):e.jsx(B,{label:e.jsxs(E,{gap:"200",align:"center",children:[e.jsx(i,{variant:"bodySm",tone:"subdued",children:o.name}),o.requiredPlan&&e.jsxs(v,{tone:"info",size:"small",children:[o.requiredPlan,o.requiredPlan!=="Enterprise"&&"+"]})]}),checked:!1,onChange:()=>me(o.key),disabled:!0,helpText:`Upgrade to ${o.requiredPlan} plan to enable`})},o.key)})})]})})}),N(s==null?void 0:s.plan)==="enterprise"&&((xe=s==null?void 0:s.features)==null?void 0:xe.schemaData)&&((fe=_==null?void 0:_.features)==null?void 0:fe.schemaData)&&e.jsx(j,{children:e.jsx(g,{padding:"400",children:e.jsxs(u,{gap:"400",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"Advanced Schema Data Management"}),e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Generate and manage structured data for your products"}),e.jsxs(E,{gap:"300",children:[e.jsx(T,{primary:!0,onClick:async()=>{const o=await p(`/ai/schema-data.json?shop=${n}`);if(!(o.schemas&&o.schemas.length>0&&!confirm("This will replace existing schema data. Continue?"))){x(!0),I(!1),q({current:0,total:0,percent:0,currentProduct:"Initializing...",stats:{siteFAQ:!1,products:0,totalSchemas:0}});try{const a=await p(`/api/schema/generate-all?shop=${n}`,{method:"POST",shop:n,body:{shop:n}});setTimeout(H,2e3)}catch(a){console.error("Error:",a),S("Failed to generate schema"),x(!1)}}},children:"Generate/Update Schema Data"}),e.jsx(T,{onClick:()=>{window.open(`/ai/schema-data.json?shop=${n}`,"_blank")},children:"View Generated Schema"}),e.jsx(T,{destructive:!0,onClick:async()=>{if(confirm("This will delete all advanced schema data. Are you sure?"))try{await p(`/api/schema/delete?shop=${n}`,{method:"DELETE",shop:n,body:{shop:n}}),S("Schema data deleted successfully")}catch{S("Failed to delete schema data")}},children:"Delete Schema Data"})]}),e.jsx(G,{status:"info",tone:"subdued",children:e.jsxs("p",{children:["Generation creates BreadcrumbList, FAQPage, WebPage and more schemas for each product. AI can access them at ",e.jsx("code",{children:"/ai/product/[handle]/schemas.json"})]})})]})})}),e.jsxs(E,{gap:"200",align:"end",children:[e.jsx(T,{tone:"critical",onClick:async()=>{if(window.confirm("Are you sure you want to reset all AI Discovery settings to defaults?"))try{await p(`/api/ai-discovery/settings?shop=${n}`,{method:"DELETE",shop:n}),S("Settings reset successfully"),W(null),setTimeout(()=>{window.location.reload()},1e3)}catch(o){console.error("Failed to reset:",o),S("Failed to reset settings")}},children:"Reset to Defaults"}),e.jsx(T,{primary:!0,size:"large",loading:ye,onClick:qe,disabled:!s,children:"Save Settings"})]}),ee&&e.jsx(m,{open:ee,onClose:()=>J(!1),title:"robots.txt Configuration",primaryAction:{content:"Copy to clipboard",onAction:()=>{navigator.clipboard.writeText(Z),S("Copied to clipboard!")}},secondaryActions:[{content:"Close",onAction:()=>J(!1)}],children:e.jsx(m.Section,{children:e.jsxs(u,{gap:"400",children:[!["growth","growth_extra","enterprise"].includes(N(s==null?void 0:s.plan))&&e.jsx(G,{status:"info",title:"Manual Configuration Steps",children:e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:"Copy the robots.txt content below"}),e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Online Store â†’ Themes"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Actions â†’ Edit code"})," on your active theme"]}),e.jsxs("li",{children:["In the file browser, look for ",e.jsx("strong",{children:"robots.txt.liquid"})]}),e.jsxs("li",{children:["If it doesn't exist, click ",e.jsx("strong",{children:"Add a new template"}),' â†’ Select "robots" â†’ Create']}),e.jsx("li",{children:"Replace the content with what you copied"}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Save"})]})]})}),e.jsx(g,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:Z})})]})})}),ne&&e.jsx(m,{open:ne,onClose:()=>O(!1),title:"No AI Bots Selected",primaryAction:{content:"Got it",onAction:()=>O(!1)},children:e.jsx(m.Section,{children:e.jsxs(u,{gap:"400",children:[e.jsx(G,{status:"warning",children:e.jsx("p",{children:"You haven't selected any AI bots yet."})}),e.jsx(i,{children:"To configure robots.txt:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:'Select AI bots from the "AI Bot Access Control" section above'}),e.jsx("li",{children:'Click "Save Settings" to save your selections'}),e.jsx("li",{children:'Then click "Apply Automatically" to configure robots.txt'})]})]})})}),re&&e.jsx(m,{open:re,onClose:()=>M(!1),title:"Manual robots.txt Configuration",primaryAction:{content:"Continue",onAction:()=>{M(!1),J(!0)}},secondaryActions:[{content:"Cancel",onAction:()=>M(!1)}],children:e.jsx(m.Section,{children:e.jsxs(u,{gap:"400",children:[e.jsx(i,{variant:"headingMd",children:"How to add robots.txt manually:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:'Click "Continue" to see your custom robots.txt content'}),e.jsx("li",{children:"Copy the generated content"}),e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Online Store â†’ Themes"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Actions â†’ Edit code"})," on your active theme"]}),e.jsxs("li",{children:["Find or create ",e.jsx("strong",{children:"robots.txt.liquid"})," file"]}),e.jsx("li",{children:"Paste the content and save"})]}),e.jsx(G,{status:"info",children:e.jsx("p",{children:"This allows AI bots to discover and properly index your products."})})]})})}),e.jsx(j,{children:e.jsx(g,{padding:"400",children:e.jsxs(u,{gap:"400",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"Test Plan Switcher (Dev Only)"}),e.jsxs(E,{gap:"200",children:[e.jsx(T,{onClick:()=>D("starter"),children:"Starter"}),e.jsx(T,{onClick:()=>D("professional"),children:"Professional"}),e.jsx(T,{onClick:()=>D("growth"),children:"Growth"}),e.jsx(T,{onClick:()=>D("growth_extra"),children:"Growth Extra"}),e.jsx(T,{onClick:()=>D("enterprise"),children:"Enterprise"})]})]})})}),le&&e.jsx(m,{open:le,onClose:()=>{V(!1),A(null)},title:ce,primaryAction:{content:"Copy",onAction:()=>{navigator.clipboard.writeText(ie),S("Copied to clipboard!")},disabled:de},secondaryActions:[{content:"Close",onAction:()=>{V(!1),A(null)}}],children:e.jsx(m.Section,{children:e.jsx(g,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:de?e.jsxs(E,{align:"center",gap:"200",children:[e.jsx(je,{size:"small"}),e.jsx(i,{variant:"bodyMd",children:ce==="AI-Optimized Sitemap"?"Loading sitemap XML... This may take a moment for large stores.":"Loading..."})]}):e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:ie})})})}),Y("Modal states",{schemaGenerating:C,schemaComplete:w,modalShouldShow:C&&!w}),C&&!w&&e.jsx(m,{open:C,title:"Generating Advanced Schema Data",onClose:()=>{Y("Modal close clicked"),x(!1)},children:e.jsx(m.Section,{children:e.jsxs(i,{children:["Modal is showing! Progress: ",b.percent,"%"]})})}),w&&e.jsx(m,{open:!0,title:"Schema Generation Complete",onClose:()=>{x(!1),I(!1)},primaryAction:{content:"View Generated Schemas",onAction:()=>{window.open(`/ai/schema-data.json?shop=${n}`,"_blank"),x(!1),I(!1)}},secondaryActions:[{content:"Close",onAction:()=>{x(!1),I(!1)}}],children:e.jsx(m.Section,{children:e.jsxs(u,{gap:"400",children:[e.jsx(G,{status:"success",title:"Generation successful!",children:e.jsx("p",{children:"Advanced schema data has been generated for your products."})}),e.jsx(i,{variant:"headingMd",children:"Generation Statistics"}),e.jsxs(E,{gap:"600",wrap:!0,children:[e.jsxs(g,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Site FAQ"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:b.stats.siteFAQ?"âœ“":"â€”"})]}),e.jsxs(g,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Products Processed"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:b.stats.products})]}),e.jsxs(g,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Total Schemas"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:b.stats.totalSchemas})]})]}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Schemas are now available at /ai/product/[handle]/schemas.json"})})]})})}),C&&!w&&e.jsx(m,{open:!0,title:"Generating Advanced Schema Data",onClose:()=>{},noScroll:!0,children:e.jsx(m.Section,{children:e.jsxs(u,{gap:"400",children:[e.jsx(i,{variant:"bodyMd",children:"Generating schemas for your products..."}),e.jsx(Ye,{progress:b.percent,size:"small"}),e.jsx(i,{variant:"bodySm",tone:"subdued",children:"This process may take 1-2 minutes depending on the number of products."})]})})}),w&&e.jsx(m,{open:!0,title:"Schema Generation Complete",onClose:()=>{x(!1),I(!1)},primaryAction:{content:"View Generated Schemas",onAction:()=>{window.open(`/ai/schema-data.json?shop=${n}`,"_blank"),x(!1),I(!1)}},secondaryActions:[{content:"Close",onAction:()=>{x(!1),I(!1)}}],children:e.jsx(m.Section,{children:e.jsxs(u,{gap:"400",children:[e.jsx(G,{status:"success",title:"Generation successful!",children:e.jsx("p",{children:"Advanced schema data has been generated for your products."})}),e.jsx(i,{variant:"headingMd",children:"Generation Statistics"}),e.jsxs(E,{gap:"600",wrap:!0,children:[e.jsxs(g,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Site FAQ"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:b.stats.siteFAQ?"âœ“":"â€”"})]}),e.jsxs(g,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Products Processed"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:b.stats.products})]}),e.jsxs(g,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Total Schemas"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:b.stats.totalSchemas})]})]}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Schemas are now available at /ai/product/[handle]/schemas.json"})})]})})}),y&&e.jsx(Ke,{content:y,onDismiss:()=>S("")})]}):e.jsx(j,{children:e.jsx(g,{padding:"400",children:e.jsx(i,{tone:"critical",children:"Missing shop parameter"})})})}catch(o){return console.error("[SETTINGS] Component render error:",o),e.jsx(u,{gap:"400",children:e.jsx(j,{children:e.jsxs(g,{padding:"400",children:[e.jsx(i,{variant:"headingMd",children:"Settings Error"}),e.jsx(g,{paddingBlockStart:"200",children:e.jsxs(i,{children:["Failed to load settings: ",o.message]})})]})})})}}export{lo as default};
