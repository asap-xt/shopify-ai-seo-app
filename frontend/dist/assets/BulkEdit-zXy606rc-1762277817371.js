import{j as e}from"./app-bridge-BbcLotMG-1762277817371.js";import{r as a}from"./react-vendor-tAaa2TlE-1762277817371.js";import{u as Vt}from"./useShopApi-DgOfzlIO-1762277817371.js";import{S as Qt,U as Jt}from"./StoreMetadataBanner-CYGitQcl-1762277817371.js";import{I as Xt}from"./InsufficientTokensModal-BgQnNKih-1762277817371.js";import{M as L,a as T,T as c,e as dt,d as Ge,b as O,B as u,I as y,g as ve,D as Zt,f as se,C as ut,h as es,S as ts,i as Ie,j as Le,R as ss,k as ns,l as pt,m as rs,E as as}from"./polaris-DCM1NKxz-1762277817371.js";const os=(I,x="")=>{try{return new URLSearchParams(window.location.search).get(I)||x}catch{return x}},fe=I=>{if(!I)return I;const x=String(I).trim();return x.startsWith("gid://")?x:`gid://shopify/Product/${x}`},is=I=>{if(!I)return"";const x=String(I).match(/\/(\d+)$/);return x?x[1]:I},Ee=I=>I<=70?"Starter":I<=200?"Professional":I<=450?"Growth":I<=750?"Growth Extra":"Enterprise";function ms({shop:I,globalPlan:x}){var it,lt,ct;const{api:b,shop:ht}=Vt(),d=I||ht||os("shop","");a.useEffect(()=>{},[d,b]);const[S,J]=a.useState([]),[ie,xe]=a.useState(!1),[gt,He]=a.useState(1),[mt,ze]=a.useState(!0),[R,Fe]=a.useState(0),[p,ne]=a.useState([]),[m,le]=a.useState(!1),[X,Ye]=a.useState(""),[U,Se]=a.useState("all"),[$,ce]=a.useState(""),[je,ls]=a.useState("createdAt"),[re,ft]=a.useState("desc"),[W,ye]=a.useState([]),[xt,St]=a.useState([]),[Ke,Oe]=a.useState(!1),[Ve,ke]=a.useState(!1),[Qe,Me]=a.useState(!1),[Je,Te]=a.useState(!1),[jt,yt]=a.useState(""),[bt,Pt]=a.useState([]),[D,ae]=a.useState([]),[E,Xe]=a.useState([]),[Re,Z]=a.useState(!1),[be,N]=a.useState({current:0,total:0,percent:0}),[Ze,oe]=a.useState(""),[Pe,de]=a.useState([]),[ue,et]=a.useState({}),[wt,$e]=a.useState(!1),[At,pe]=a.useState(!1),[Ct,he]=a.useState(!1),[G,ge]=a.useState([]),[vt,we]=a.useState(!1),[tt,P]=a.useState(""),[st,nt]=a.useState(!1),[C,ee]=a.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[q,It]=a.useState(null),[z,Lt]=a.useState(70),[F,De]=a.useState(1),[Et,Ae]=a.useState(!1),[Ce,zt]=a.useState(localStorage.getItem("hasVisitedProducts")==="true"),[Ue,Y]=a.useState(!1),[Ot,Be]=a.useState(!1),[f,H]=a.useState(null),[K,me]=a.useState("starter");a.useEffect(()=>{if(!(!x||typeof x!="object")){if(x.planKey&&x.planKey!==""){me(x.planKey);const r={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[x.planKey.toLowerCase()]||1;De(r)}else if(x.plan&&x.plan!==""){const t=x.plan.toLowerCase().replace(/\s+/g,"-");me(t);const n={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[t]||1;De(n)}}},[x]),a.useEffect(()=>{Ue&&q&&(m?R:p.length)<=z&&(Y(!1),H(null))},[p.length,m,R,Ue,q]),a.useEffect(()=>{if(!d)return;b("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
          language_limit
        }
      }
    `,variables:{shop:d}})}).then(r=>{var h,i,l;if((h=r==null?void 0:r.errors)!=null&&h.length)throw new Error(((i=r.errors[0])==null?void 0:i.message)||"GraphQL error");const n=(l=r==null?void 0:r.data)==null?void 0:l.plansMe,o=(n==null?void 0:n.modelsSuggested)||["anthropic/claude-3.5-sonnet"];Pt(o.map(s=>({label:s,value:s}))),yt(o[0]),It((n==null?void 0:n.plan)||"starter"),me((n==null?void 0:n.planKey)||"starter"),Lt((n==null?void 0:n.product_limit)||70),De((n==null?void 0:n.language_limit)||1)}).catch(r=>console.error("[BULK-EDIT] GraphQL plansMe failed:",r))},[d,b]),a.useEffect(()=>{if(!d)return;const t=new Promise((r,n)=>{setTimeout(()=>n(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([b(`/api/languages/shop/${d}`),t]).then(r=>{const n=Array.isArray(r==null?void 0:r.shopLanguages)&&r.shopLanguages.length?r.shopLanguages:["en"];Xe(n.includes("en")?n:["en",...n])}).catch(r=>{console.error("[BULK-EDIT] Languages API error:",r),Xe(["en"])})},[d,b]),a.useEffect(()=>{d&&b("/api/products/tags/list",{shop:d}).then(t=>St((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[d,b]);const te=a.useCallback(async(t=1,r=!1,n=null)=>{var o,h,i,l;xe(!0);try{const s=new URLSearchParams({shop:d,page:t,limit:50,...U!=="all"&&{optimized:U},...X&&{search:X},...$&&{languageFilter:$},...W.length>0&&{tags:W.join(",")},sortBy:je,sortOrder:re,...n&&{_t:n}}),v=await b(`/api/products/list?${s}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((o=v.products)==null?void 0:o.length)>0,((h=v.products)==null?void 0:h.length)>0&&v.products.forEach((w,j)=>{}),J(r?w=>[...w,...v.products]:v.products||[]),He(t),ze(((i=v.pagination)==null?void 0:i.hasNext)||!1),Fe(((l=v.pagination)==null?void 0:l.total)||0)}catch(s){J(r?S:[]),ze(!1),P(`Error loading products: ${s.message}`)}finally{xe(!1)}},[d,U,X,$,W,je,re]);a.useEffect(()=>{d&&te(1,!1,null)},[d,U,$,W,je,re]),a.useEffect(()=>{!Ce&&d&&(localStorage.setItem("hasVisitedProducts","true"),zt(!0))},[Ce,d]),a.useEffect(()=>{S.length===0&&!ie&&d&&!Ce&&Ae(!0)},[S.length,ie,d,Ce]),a.useEffect(()=>{},[S,p]);const rt=a.useCallback(t=>{Ye(t)},[]);a.useEffect(()=>{const t=setTimeout(()=>{d&&te(1,!1,null)},500);return()=>clearTimeout(t)},[X]);const kt=a.useCallback(t=>{ne(t),t.length===0&&le(!1)},[S]),at=a.useCallback(t=>{le(t),ne(t?S.map(r=>r.id):[])},[S]),ot=a.useMemo(()=>{var r;if(m)return D.length>F;const t=S.filter(n=>p.includes(n.id));if(t.length===0)return D.length>F;for(const n of t){const o=((r=n.optimizationSummary)==null?void 0:r.optimizedLanguages)||[],h=D.filter(l=>!o.includes(l));if(o.length+h.length>F)return!0}return!1},[S,p,m,F,D]),Mt=()=>{if(p.length===0&&!m){P("Please select products first");return}pe(!0)},Tt=()=>{if(p.length===0&&!m){P("Please select products first");return}ge([]),he(!0)},Rt=async()=>{const t=S.filter(i=>p.includes(i.id)),r=t.filter(i=>{var l,s;return((s=(l=i.optimizationSummary)==null?void 0:l.optimizedLanguages)==null?void 0:s.length)>0}),n=t.filter(i=>{var l,s;return!((s=(l=i.optimizationSummary)==null?void 0:l.optimizedLanguages)!=null&&s.length)}),o=r.length;if(o>z){const i=Ee(o);H({error:"Product limit exceeded",message:`Your ${q} plan supports up to ${z} products for AI Enhancement. You have selected ${o} products with Basic SEO.`,minimumPlanRequired:i,currentPlan:q,features:[`Optimize up to ${z} products`,"All features from your current plan",i==="Growth Extra"||i==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",i==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),Y(!0);return}nt(!0),ee({processing:!0,current:0,total:r.length,currentItem:"",results:null});const h={successful:0,failed:0,skipped:n.length,skipReasons:n.length>0?[`${n.length} product(s): No Basic Optimization`]:[]};for(let i=0;i<r.length;i++){const l=r[i];ee(s=>({...s,current:i,currentItem:l.title}));try{const s=await b("/ai-enhance/product",{method:"POST",shop:d,body:{shop:d,productId:l.gid||fe(l.id),languages:l.optimizationSummary.optimizedLanguages}});if(s.results&&s.results.length>0){const v={shop:d,productId:l.gid||fe(l.id),results:s.results.filter(j=>j.bullets&&j.faq).map(j=>({language:j.language,seo:{...j.updatedSeo,bullets:j.bullets||[],faq:j.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},w=await b("/api/seo/apply-multi",{method:"POST",shop:d,body:v});h.successful++}else h.failed++}catch(s){if(console.error("âŒ [AI-ENHANCE] Enhancement error:",s),console.error("ðŸ” [AI-ENHANCE DEBUG] Error type:",typeof s),console.error("ðŸ” [AI-ENHANCE DEBUG] Error.status:",s.status,"Type:",typeof s.status),console.error("ðŸ” [AI-ENHANCE DEBUG] Error.requiresPurchase:",s.requiresPurchase),console.error("ðŸ” [AI-ENHANCE DEBUG] Error.trialRestriction:",s.trialRestriction),console.error("ðŸ” [AI-ENHANCE DEBUG] Full error object:",JSON.stringify(s,Object.getOwnPropertyNames(s))),console.error("ðŸ” [AI-ENHANCE DEBUG] Error details:",{status:s.status,trialRestriction:s.trialRestriction,needsUpgrade:s.needsUpgrade,requiresPurchase:s.requiresPurchase,message:s.message,currentPlan:s.currentPlan}),s.status===403){ee({processing:!1,current:0,total:0,currentItem:"",results:null}),H({...s,message:s.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),me(s.currentPlan||K),s.needsUpgrade===!1&&s.requiresPurchase?Be(!0):Y(!0);return}if(s.status===402||s.requiresPurchase||s.trialRestriction){ee({processing:!1,current:0,total:0,currentItem:"",results:null}),H(s),me(s.currentPlan||q||"starter"),s.trialRestriction?Y(!0):Be(!0);return}h.failed++}ee(s=>({...s,current:i+1}))}ee(i=>({...i,processing:!1,results:h})),P(`AI enhancement complete! ${h.successful} products enhanced.`)},We=()=>{nt(!1),ee({processing:!1,current:0,total:0,currentItem:"",results:null}),C.results&&C.results.successful>0&&te(1,!1,null)},$t=()=>C.processing?e.jsx(L,{open:st,title:"Processing AI Enhancement",onClose:We,noScroll:!0,children:e.jsx(L.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsxs(c,{variant:"bodyMd",children:["Processing: ",C.currentItem]}),e.jsx(dt,{progress:C.current/C.total*100}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:[C.current," of ",C.total," products (",Math.round(C.current/C.total*100),"%)"]})]})})}):C.results!==null?e.jsx(L,{open:st,title:"AI Enhancement Results",onClose:We,primaryAction:{content:"Done",onAction:We},children:e.jsx(L.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsxs(y,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:C.results.successful})]}),e.jsxs(u,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:C.results.failed})]}),e.jsxs(u,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:C.results.skipped})]})]}),C.results.skipReasons&&C.results.skipReasons.length>0&&e.jsxs(T,{gap:"200",children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped products:"}),C.results.skipReasons.map((t,r)=>e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["â€¢ ",t]},r))]})]})})}):null,Dt=async()=>{var r;if(!D.length){P("Please select at least one language");return}let t=jt;(!t||!t.trim())&&(t=((r=bt[0])==null?void 0:r.value)||"anthropic/claude-3.5-sonnet"),Z(!0),N({current:0,total:0,percent:0}),de([]),et({});try{let n=[];m?n=(await b(`/api/products/list?shop=${encodeURIComponent(d)}&limit=1000&fields=id`)).products||[]:n=S.filter(g=>p.includes(g.id));const o=n.length;if(o>z){Z(!1),N({current:0,total:0,percent:0}),pe(!1);const g=Ee(o);H({error:"Product limit exceeded",message:`Your ${K} plan supports up to ${z} products for SEO optimization. You have selected ${o} products.`,minimumPlanRequired:g,currentPlan:K,features:["Optimize more products","All features from your current plan",g==="Growth Extra"||g==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",g==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),Y(!0);return}pe(!1);const h=o,i=0;N({current:0,total:h,percent:0});const l=5,s={};for(let g=0;g<n.length;g+=l){const B=n.slice(g,Math.min(g+l,n.length)).map(async k=>{var V;oe(k.title||k.handle||"Product");try{const Q=k.gid||fe(k.productId||k.id),qe=((V=k.optimizationSummary)==null?void 0:V.optimizedLanguages)||[],_e=D.filter(Kt=>!qe.includes(Kt));if(_e.length===0){s[k.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Yt=await b("/api/seo/generate-multi",{method:"POST",shop:d,body:{shop:d,productId:Q,model:t,languages:_e}});s[k.id]={success:!0,data:Yt,languages:_e}}catch(Q){s[k.id]={success:!1,error:Q.message},de(qe=>[...qe,{product:k.title,error:Q.message}])}});await Promise.all(B);const A=Math.min(g+l,n.length),_=Math.round(A/h*100);N({current:A,total:h,percent:_})}et(s),$e(!0);const v=Object.keys(s).filter(g=>s[g].success&&!s[g].skipped).length,w=Object.keys(s).filter(g=>s[g].skipped).length;let j=`Generated Optimization for AI Search for ${v} products`;w>0&&(j+=` (${w} already optimised)`),i>0,P(j)}catch(n){P(`Error: ${n.message}`)}finally{Z(!1),oe("")}},Ut=async()=>{var t,r;Z(!0),N({current:0,total:0,percent:0});try{const n=Object.entries(ue).filter(([l,s])=>s.success&&!s.skipped),o=n.length;N({current:0,total:o,percent:0});for(let l=0;l<n.length;l++){const[s,v]=n[l],w=S.find(M=>M.id===s);if(!w)continue;oe(w.title||"Product");try{const M=w.gid||fe(w.productId||w.id),B=await b("/api/seo/apply-multi",{method:"POST",shop:d,body:{shop:d,productId:M,results:v.data.results.filter(A=>A==null?void 0:A.seo).map(A=>({language:A.language,seo:A.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});B.appliedLanguages&&B.appliedLanguages.length>0&&J(A=>A.map(_=>{var k;if(_.id===s){const V=((k=_.optimizationSummary)==null?void 0:k.optimizedLanguages)||[],Q=[...new Set([...V,...B.appliedLanguages])];return{..._,optimizationSummary:{..._.optimizationSummary,optimizedLanguages:Q,optimized:!0,lastOptimized:new Date().toISOString()}}}return _}))}catch(M){de(B=>[...B,{product:w.title,error:`Apply failed: ${M.message}`}])}const j=l+1,g=Math.round(j/o*100);N({current:j,total:o,percent:g})}P("AI Search Optimisation applied successfully!"),$e(!1),ne([]),le(!1),await new Promise(l=>setTimeout(l,1e3)),J([]);const h=new URLSearchParams({shop:d,page:1,limit:50,...U!=="all"&&{optimized:U},...X&&{search:X},...$&&{languageFilter:$},...W.length>0&&{tags:W.join(",")},sortBy:je,sortOrder:re,_t:Date.now()}),i=await b(`/api/products/list?${h}`,{shop:d,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});J(i.products||[]),He(1),ze(((t=i.pagination)==null?void 0:t.hasNext)||!1),Fe(((r=i.pagination)==null?void 0:r.total)||0)}catch(n){P(`Error applying AI Search Optimisation: ${n.message}`)}finally{Z(!1),oe("")}},Bt=async()=>{var t;if(!G.length){P("Please select at least one language to delete");return}he(!1),we(!1),Z(!0),N({current:0,total:0,percent:0}),de([]);try{let r=[];m?r=(await b(`/api/products/list?shop=${encodeURIComponent(d)}&limit=1000&fields=id`)).products||[]:r=S.filter(i=>p.includes(i.id));const n=r.length;N({current:0,total:n,percent:0});let o=0,h=0;for(let i=0;i<r.length;i++){const l=r[i];oe(l.title||l.handle||"Product");try{const w=l.gid||fe(l.productId||l.id),j=((t=l.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],g=G.filter(B=>j&&j.length>0&&j.includes(B));if(g.length===0){h++;continue}const M=await b("/api/seo/delete-multi",{method:"POST",shop:d,body:{shop:d,productId:w,languages:g}});M.deletedLanguages&&M.deletedLanguages.length>0&&J(B=>B.map(A=>{var _;if(A.id===l.id){const V=(((_=A.optimizationSummary)==null?void 0:_.optimizedLanguages)||[]).filter(Q=>!M.deletedLanguages.includes(Q));return{...A,optimizationSummary:{...A.optimizationSummary,optimizedLanguages:V,optimized:V.length>0,lastOptimized:V.length>0?A.optimizationSummary.lastOptimized:null}}}return A})),o++,M.deletedLanguages&&M.deletedLanguages.length>0&&await b("/api/products/verify-after-delete",{method:"POST",shop:d,body:{shop:d,productIds:[w],deletedLanguages:M.deletedLanguages}})}catch(w){de(j=>[...j,{product:l.title,error:w.message}])}const s=i+1,v=Math.round(s/n*100);N({current:s,total:n,percent:v})}ne([]),le(!1),h>0?P(`Deleted Optimization for AI Search from ${o} products (${h} had no optimisation to delete)`):P(`Deleted Optimization for AI Search from ${o} products`),setTimeout(()=>{const i=Date.now();te(1,!1,i)},500)}catch(r){P(`Error: ${r.message}`)}finally{Z(!1),oe("")}},Wt=t=>{var r,n;try{const o=t,h=is(o.productId||o.id),i=((r=o.optimizationSummary)==null?void 0:r.optimizedLanguages)||[],l=(n=o.images)!=null&&n[0]?e.jsx(pt,{source:o.images[0].url||o.images[0].src||o.images[0],alt:o.title,size:"small"}):o.imageUrl?e.jsx(pt,{source:o.imageUrl,alt:o.title,size:"small"}):e.jsx(u,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(rs,{id:o.id,media:l,accessibilityLabel:`View details for ${o.title}`,onClick:s=>{},children:e.jsxs(y,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(u,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:o.title}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["ID: ",h]})]}),e.jsx(u,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(y,{gap:"100",children:E.length>0?E.map(s=>{const v=i.includes(s);return e.jsx(se,{tone:v?"success":"subdued",size:"small",children:s.toUpperCase()},s)}):i.map(s=>e.jsx(se,{tone:"success",size:"small",children:s.toUpperCase()},s))})}),e.jsx(u,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(se,{tone:"success",children:"Active"})})]})})}catch(o){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",o),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},Nt=Re&&e.jsx(L,{open:Re,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(L.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsx(c,{variant:"bodyMd",children:Ze?`Processing: ${Ze}`:"Preparing..."}),e.jsx(dt,{progress:be.percent}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:[be.current," of ",be.total," products (",be.percent,"%)"]})]})})}),qt=e.jsx(L,{open:At,title:"Select Languages",onClose:()=>{pe(!1),ae([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Dt,disabled:D.length===0||ot},secondaryActions:[{content:"Cancel",onAction:()=>{pe(!1),ae([])}}],children:e.jsx(L.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsxs(c,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",m?"all":p.length," selected products:"]}),ot&&e.jsx(Ge,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(T,{gap:"200",children:[e.jsxs(c,{variant:"bodyMd",children:["Your ",K," plan supports up to ",F," language",F>1?"s":""," per product.",p.length===1&&((ct=(lt=(it=S.find(t=>t.id===p[0]))==null?void 0:it.optimizationSummary)==null?void 0:lt.optimizedLanguages)==null?void 0:ct.length)>0&&e.jsxs(e.Fragment,{children:[" This product already has ",S.find(t=>t.id===p[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(c,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(O,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),r=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${r}`},children:"Upgrade Plan"})]})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:E.map(t=>e.jsx(ve,{label:t.toUpperCase(),checked:D.includes(t),onChange:r=>{ae(r?[...D,t]:D.filter(n=>n!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(O,{plain:!0,onClick:()=>{D.length===E.length?ae([]):E.length>F?(ae([...E]),P(`You selected ${E.length} languages. Your ${K} plan supports ${F}. Please deselect or upgrade.`)):ae([...E])},children:D.length===E.length?"Deselect all":"Select all"})}),e.jsx(c,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),_t=e.jsx(L,{open:wt&&!Re,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:Ut,disabled:!Object.values(ue).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>$e(!1)}],children:e.jsx(L.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsxs(y,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(ue).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(ue).filter(t=>t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(ue).filter(t=>!t.success).length})]})]}),Pe.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Zt,{}),e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(u,{maxHeight:"200px",overflowY:"scroll",children:[Pe.slice(0,10).map((t,r)=>e.jsxs(c,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},r)),Pe.length>10&&e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["... and ",Pe.length-10," more errors"]})]})]})]})})}),Gt=e.jsx(L,{open:Ct,title:"Delete Optimization for AI Search",onClose:()=>{he(!1),ge([])},primaryAction:{content:"Continue",onAction:()=>{he(!1),we(!0)},disabled:G.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{he(!1),ge([])}}],children:e.jsx(L.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsxs(c,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",m?"all":p.length," selected products:"]}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:E.map(t=>e.jsx(ve,{label:t.toUpperCase(),checked:G.includes(t),onChange:r=>{ge(r?[...G,t]:G.filter(n=>n!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(O,{plain:!0,onClick:()=>{ge(G.length===E.length?[]:[...E])},children:G.length===E.length?"Deselect all":"Select all"})}),e.jsx(c,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Ht=e.jsx(L,{open:vt,title:"Confirm Deletion",onClose:()=>{we(!1)},primaryAction:{content:"Delete",onAction:Bt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>we(!1)}],children:e.jsx(L.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsx(c,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(u,{paddingBlock:"200",children:e.jsx(y,{gap:"100",children:G.map(t=>e.jsx(se,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(c,{variant:"bodyMd",children:["This will delete optimisation from ",m?"ALL":p.length," selected products."]}),e.jsx(c,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Ne=async()=>{try{xe(!0),P("Syncing products from Shopify...");const t=await b("/api/products/sync",{method:"POST",shop:d});if(t.success){const r=t.productsCount||t.synced||0;P(`âœ… Synced ${r} products successfully!`),setTimeout(()=>{te(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),P(`âŒ Sync failed: ${t.message}`)}finally{xe(!1)}},Ft=e.jsx(as,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Ye(""),Se("all"),ce(""),ye([]),te(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Ne},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Qt,{globalPlan:x}),e.jsx(ut,{children:e.jsxs(u,{padding:"400",children:[e.jsxs(T,{gap:"300",children:[q&&e.jsx(Ge,{tone:"info",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(c,{children:["Your ",e.jsx("strong",{children:q})," plan includes up to"," ",e.jsx("strong",{children:z})," products for SEO optimization.",R>z&&e.jsxs(e.Fragment,{children:[" You have ",R," products, so only the first ",z," will be processed."]})]}),(p.length>0||m)&&e.jsxs(c,{children:["Selected: ",m?Math.min(R,z):p.length,"/",z]})]})}),q&&(p.length>z||m&&R>z)&&e.jsx(Ge,{tone:"critical",children:e.jsxs(T,{gap:"200",children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),e.jsxs(c,{children:["Your ",e.jsx("strong",{children:q})," plan supports up to ",e.jsx("strong",{children:z})," products. You have selected ",e.jsx("strong",{children:m?R:p.length})," products."]}),e.jsx(c,{children:"Please deselect some products or upgrade your plan to continue."}),e.jsxs(y,{gap:"200",children:[e.jsx(O,{onClick:()=>{ne([]),le(!1)},children:"Clear Selection"}),e.jsx(O,{variant:"primary",onClick:()=>{H({error:"Product limit exceeded",message:`Your ${q} plan supports up to ${z} products. Upgrade to ${Ee(m?R:p.length)} to optimize more products.`,minimumPlanRequired:Ee(m?R:p.length)}),Y(!0)},children:"Upgrade Plan"})]})]})}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(u,{minWidth:"400px",children:e.jsx(es,{label:"",placeholder:"Search by product ID, name, or details...",value:X,onChange:rt,prefix:e.jsx(ts,{}),clearButton:!0,onClearButtonClick:()=>rt("")})}),e.jsx(u,{width:"320px",children:e.jsx(O,{primary:!0,onClick:Mt,disabled:p.length===0&&!m,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(O,{onClick:Ne,disabled:ie,size:"medium",children:"Sync Products"}),e.jsx(u,{width:"320px",children:e.jsxs(T,{gap:"200",align:"end",children:[(()=>{if(p.length===0&&!m||!S.filter(o=>p.includes(o.id)).some(o=>{var h,i;return((i=(h=o.optimizationSummary)==null?void 0:h.optimizedLanguages)==null?void 0:i.length)>0}))return null;const n=["professional","professional_plus","professional plus","growth","growth_plus","growth plus","growth_extra","growth extra","enterprise"].includes(K.toLowerCase().replace(/_/g," "));return e.jsx(O,{onClick:n?Rt:()=>{H({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),Y(!0)},disabled:p.length===0&&!m,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(O,{onClick:Tt,disabled:p.length===0&&!m||!S.filter(n=>p.includes(n.id)).some(n=>{var o,h;return((h=(o=n.optimizationSummary)==null?void 0:o.optimizedLanguages)==null?void 0:h.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),R>0&&e.jsx(u,{paddingBlockStart:"300",children:e.jsx(ve,{label:`Select all ${R} products in your store`,checked:m,onChange:at})})]})}),e.jsx(u,{paddingBlockStart:"400",children:e.jsxs(ut,{children:[e.jsxs(u,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(y,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(y,{gap:"200",wrap:!0,children:[e.jsx(Ie,{active:Ke,activator:e.jsx(O,{disclosure:"down",onClick:()=>Oe(!Ke),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),U!=="all"&&e.jsx(u,{onClick:t=>{t.stopPropagation(),Se("all")},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Oe(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(Le,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[U],onChange:t=>{Se(t[0]),ce(""),Oe(!1)}})})}),e.jsx(Ie,{active:Ve,activator:e.jsx(O,{disclosure:"down",onClick:()=>ke(!Ve),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),$&&e.jsx(u,{onClick:t=>{t.stopPropagation(),ce("")},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>ke(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(Le,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...E.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...E.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:$?[$]:[],onChange:t=>{ce(t[0]||""),ke(!1)}})})}),e.jsx(Ie,{active:Qe,activator:e.jsx(O,{disclosure:"down",onClick:()=>Me(!Qe),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),W.length>0&&e.jsx(u,{onClick:t=>{t.stopPropagation(),ye([])},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Me(!1),children:e.jsxs(u,{padding:"300",minWidth:"200px",children:[e.jsx(Le,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:xt.map(t=>({label:t,value:t})),selected:W,onChange:t=>{ye(t)}}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(O,{size:"slim",onClick:()=>Me(!1),children:"Apply"})})]})})]}),e.jsx(Ie,{active:Je,activator:e.jsx(O,{disclosure:"down",onClick:()=>Te(!Je),removeUnderline:!0,children:e.jsx(y,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:re==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Te(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(Le,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[re],onChange:t=>{ft(t[0]),Te(!1)}})})})]}),(U!=="all"||$||W.length>0)&&e.jsx(u,{paddingBlockStart:"200",children:e.jsxs(y,{gap:"100",wrap:!0,children:[U!=="all"&&e.jsx(se,{onRemove:()=>Se("all"),children:U==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),$&&e.jsx(se,{onRemove:()=>ce(""),children:$.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),W.map(t=>e.jsxs(se,{onRemove:()=>ye(r=>r.filter(n=>n!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(u,{children:[e.jsx(u,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(y,{gap:"200",align:"start",children:[e.jsx(ve,{checked:p.length===S.length&&S.length>0,onChange:at,label:""}),e.jsxs(c,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",p.length>0&&` (${p.length} selected products)`]})]})}),e.jsx(ss,{resourceName:{singular:"product",plural:"products"},items:S,renderItem:Wt,selectedItems:p,onSelectionChange:kt,selectable:!0,loading:ie,totalItemsCount:R,emptyState:Ft,showHeader:!1},`products-${S.length}-${p.length}`)]}),mt&&!ie&&e.jsx(u,{padding:"400",textAlign:"center",children:e.jsx(O,{onClick:()=>te(gt+1,!0,null),children:"Load more"})})]})}),Nt,qt,_t,Gt,Ht,$t(),e.jsx(L,{open:Et,onClose:()=>Ae(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Ae(!1),Ne()}},secondaryActions:[{content:"Skip for now",onAction:()=>Ae(!1)}],children:e.jsx(L.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsx(c,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(c,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Jt,{open:Ue,onClose:()=>{Y(!1),H(null)},featureName:(f==null?void 0:f.error)||"Feature",errorMessage:f==null?void 0:f.message,currentPlan:(f==null?void 0:f.currentPlan)||K,minimumPlanRequired:f==null?void 0:f.minimumPlanRequired,features:f==null?void 0:f.features}),f&&e.jsx(Xt,{open:Ot,onClose:()=>{Be(!1),H(null)},tokensRequired:f.tokensRequired||0,tokensAvailable:f.tokensAvailable||0,tokensNeeded:f.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:d,needsUpgrade:f.needsUpgrade||!1,minimumPlan:f.minimumPlanForFeature||null,currentPlan:f.currentPlan||K}),tt&&e.jsx(ns,{content:tt,onDismiss:()=>P("")})]})}export{ms as default};
