import{j as n}from"./app-bridge-D7B5clQG-1757924813525.js";import{r as c}from"./react-vendor-tAaa2TlE-1757924813525.js";import{m as V}from"./index-DmExxLdi-1757924813525.js";import{C as m,a as d,T as j,m as F,L as g,r as u,h as s,f as q,I as v,B as G,s as $,j as X}from"./polaris-gHuDchql-1757924813525.js";const H=(x,l="")=>{try{return new URLSearchParams(window.location.search).get(x)||l}catch{return l}};function Q({shop:x}){var z;const l=x||H("shop",""),[R,f]=c.useState(!1),[U,b]=c.useState(!1),[y,S]=c.useState(""),[r,_]=c.useState(null),p=c.useMemo(()=>V(),[]),[t,o]=c.useState({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}});c.useEffect(()=>{l&&D()},[l,p]);async function D(){f(!0);try{const e=`/api/store/generate?shop=${encodeURIComponent(l)}`;console.log("[StoreMeta] GET",e);const a=await p(e,{headers:{"X-Shop":l}});if(console.log("[StoreMeta] GET ok",{url:e,keys:Object.keys(a||{})}),_(a),a.existingMetadata){const i=a.existingMetadata;o(h=>{var C,k,T,w,L,P,A,B,I,E;return{...h,seo:{...h.seo,...((C=i.seo_metadata)==null?void 0:C.value)||{},keywords:Array.isArray((T=(k=i.seo_metadata)==null?void 0:k.value)==null?void 0:T.keywords)?i.seo_metadata.value.keywords.join(", "):((L=(w=i.seo_metadata)==null?void 0:w.value)==null?void 0:L.keywords)||h.seo.keywords||""},aiMetadata:((P=i.ai_metadata)==null?void 0:P.value)||h.aiMetadata,organizationSchema:{...h.organizationSchema,...((A=i.organization_schema)==null?void 0:A.value)||{},enabled:((I=(B=i.organization_schema)==null?void 0:B.value)==null?void 0:I.enabled)===!0},localBusinessSchema:((E=i.local_business_schema)==null?void 0:E.value)||h.localBusinessSchema}})}a.shopInfo&&o(i=>({...i,seo:{...i.seo,title:i.seo.title||a.shopInfo.name},organizationSchema:{...i.organizationSchema,name:i.organizationSchema.name||a.shopInfo.name,email:i.organizationSchema.email||a.shopInfo.email}}))}catch(e){console.error("[StoreMeta] GET error",(e==null?void 0:e.debug)||e,e),S(`Load failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{f(!1)}}async function O(){b(!0);try{const e=`/api/store/apply?shop=${encodeURIComponent(l)}`;console.log("[StoreMeta] SAVE",e);const a=await p(e,{method:"POST",headers:{"X-Shop":l},body:{metadata:t,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:t.organizationSchema.enabled,updateLocalBusiness:t.localBusinessSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:e,ok:a==null?void 0:a.ok}),S("Metadata saved successfully!")}catch(e){console.error("[StoreMeta] SAVE error",(e==null?void 0:e.debug)||e,e),S(`Save failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{b(!1)}}if(R&&!r)return n.jsx(m,{children:n.jsx(d,{padding:"400",children:n.jsx(j,{children:"Loading store data..."})})});if((r==null?void 0:r.plan)==="Starter")return n.jsx(F,{status:"warning",children:n.jsx(j,{children:"Store metadata features are available starting from the Professional plan."})});const M=`/api/store/public/${l}`;return n.jsxs(g,{children:[n.jsx(g.Section,{children:n.jsx(m,{title:"Basic Store Information",children:n.jsx(d,{padding:"400",children:n.jsxs(u,{children:[n.jsx(s,{label:"SEO Title",value:t.seo.title,onChange:e=>o(a=>({...a,seo:{...a.seo,title:e}})),helpText:"Title for search engines (max 70 chars)",maxLength:70}),n.jsx(s,{label:"Meta Description",value:t.seo.metaDescription,onChange:e=>o(a=>({...a,seo:{...a.seo,metaDescription:e}})),helpText:"Description for search results (150-160 chars)",maxLength:160,multiline:3}),n.jsx(s,{label:"Keywords",value:t.seo.keywords,onChange:e=>o(a=>({...a,seo:{...a.seo,keywords:e}})),helpText:"Comma-separated keywords"})]})})})}),n.jsx(g.Section,{children:n.jsx(m,{title:"AI Metadata",children:n.jsx(d,{padding:"400",children:n.jsxs(u,{children:[n.jsxs(u.Group,{children:[n.jsx(s,{label:"Business Type",value:t.aiMetadata.businessType,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,businessType:e}})),placeholder:"e.g., Fashion Retailer, Electronics Store"}),n.jsx(s,{label:"Target Audience",value:t.aiMetadata.targetAudience,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,targetAudience:e}})),placeholder:"e.g., Young professionals, Parents"})]}),n.jsx(s,{label:"Unique Selling Points",value:t.aiMetadata.uniqueSellingPoints,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,uniqueSellingPoints:e}})),helpText:"Comma-separated list",multiline:2}),n.jsx(s,{label:"Brand Voice",value:t.aiMetadata.brandVoice,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,brandVoice:e}})),placeholder:"e.g., Professional, Friendly, Casual"}),n.jsx(s,{label:"Primary Categories",value:t.aiMetadata.primaryCategories,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,primaryCategories:e}})),helpText:"Main product categories, comma-separated"}),n.jsx(s,{label:"Shipping Information",value:t.aiMetadata.shippingInfo,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,shippingInfo:e}})),multiline:2}),n.jsx(s,{label:"Return Policy",value:t.aiMetadata.returnPolicy,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,returnPolicy:e}})),multiline:2})]})})})}),((z=r==null?void 0:r.features)==null?void 0:z.organizationSchema)&&n.jsx(g.Section,{children:n.jsx(m,{title:"Organization Schema",children:n.jsxs(d,{padding:"400",children:[n.jsx(q,{label:"Enable Organization Schema",checked:t.organizationSchema.enabled,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,enabled:e}}))}),t.organizationSchema.enabled&&n.jsx(d,{paddingBlockStart:"400",children:n.jsxs(u,{children:[n.jsxs(u.Group,{children:[n.jsx(s,{label:"Organization Name",value:t.organizationSchema.name,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,name:e}}))}),n.jsx(s,{label:"Contact Email",value:t.organizationSchema.email,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,email:e}})),type:"email"})]}),n.jsx(s,{label:"Phone",value:t.organizationSchema.phone,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,phone:e}})),type:"tel"}),n.jsx(s,{label:"Logo URL",value:t.organizationSchema.logo,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,logo:e}})),type:"url"}),n.jsx(s,{label:"Social Media Links",value:t.organizationSchema.sameAs,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,sameAs:e}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}),n.jsx(g.Section,{children:n.jsx(m,{children:n.jsxs(d,{padding:"400",children:[n.jsx(v,{gap:"300",children:n.jsx(G,{onClick:O,loading:U,children:"Save Metadata"})}),n.jsx(d,{paddingBlockStart:"400",children:n.jsxs(j,{variant:"bodyMd",color:"subdued",children:["Public metadata URL: ",n.jsx($,{url:M,external:!0,children:M})]})})]})})}),y&&n.jsx(X,{content:y,onDismiss:()=>S("")})]})}export{Q as default};
