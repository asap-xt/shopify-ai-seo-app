import{d as t}from"./index-CO9eZkpI.js";const e=t=>new Promise(e=>setTimeout(e,t));function s(s=!0){return s&&t("[SFETCH] Creating session fetch for App Bridge v4"),async(s,r={})=>{var o,n,a;t("[SFETCH] Fetching:",s,r);const{method:i="GET",headers:u={},body:l,responseType:c,...d}=r,f={method:i,headers:{"Content-Type":"application/json",...u},credentials:"include",body:l?"string"==typeof l?l:JSON.stringify(l):void 0};let m=null;for(let p=1;p<=3;p++)try{const e=await fetch(s,f);let r;if(t("[SFETCH] Response:",e.status,e.statusText),"text"===c)r=await e.text();else{const t=await e.text();try{r=t?JSON.parse(t):null}catch{r={error:(null==t?void 0:t.slice(0,500))||"Non-JSON response"}}}if(!e.ok){if(402===e.status&&r){const t=new Error(r.error||r.message||"Payment Required");throw t.status=402,Object.assign(t,r),t}const t=(null==r?void 0:r.error)||(null==r?void 0:r.message)||`HTTP ${e.status}`,s=new Error(t);throw s.status=e.status,s}return r}catch(h){if(m=h,h.status&&h.status>=400&&h.status<500&&408!==h.status&&429!==h.status)throw h;if(!h.status&&((null==(o=h.message)?void 0:o.includes("Failed to fetch"))||(null==(n=h.message)?void 0:n.includes("NetworkError"))||(null==(a=h.message)?void 0:a.includes("CORS"))||"TypeError"===h.name)&&p<3){t(`[SFETCH] CORS/Network error on attempt ${p}, retrying in 1000ms...`),await e(1e3*p);continue}throw h}throw m||new Error("Request failed after retries")}}export{s as m};
