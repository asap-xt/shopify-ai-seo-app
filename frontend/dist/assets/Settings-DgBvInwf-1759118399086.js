import{j as e}from"./app-bridge-DFsp6jXj-1759118399086.js";import{r as i}from"./react-vendor-tAaa2TlE-1759118399086.js";import{m as Ve}from"./index-DhcctWGM-1759118399086.js";import{C as y,a as g,T as c,I as T,r as we,d as S,g as O,h as E,D as Ae,f as k,B as m,n as We,v as He,M as x,e as Ye,k as Xe}from"./polaris-okD5GOoV-1759118399086.js";function co(){var K,Z;console.log("[SETTINGS] ===== SETTINGS COMPONENT LOADED ====="),console.log("[SETTINGS] Starting component initialization...");const Y=(b,G="")=>{try{return new URLSearchParams(window.location.search).get(b)||G}catch{return G}},I=b=>(b||"starter").toLowerCase().replace(" ","_"),X=(b,G=null)=>{console.log(`[SETTINGS DEBUG] ${b}`,G||"")};Y("shop","");try{const[b,G]=i.useState(!0),[ye,ee]=i.useState(!1),[t,L]=i.useState(null),[$,_]=i.useState(""),[oe,F]=i.useState(!1),[v,d]=i.useState(""),[te,Ie]=i.useState(null),[se,J]=i.useState(null),[ae,Ge]=i.useState(!1),[Ce,Ne]=i.useState(!1),[ve,Pe]=i.useState(!1),[Me,De]=i.useState(!1),[Oe,ke]=i.useState(!1),[Le,Be]=i.useState(!1);i.useEffect(()=>{console.log("[SETTINGS] showViewButtons state changed to:",ae)},[ae]),i.useEffect(()=>{console.log("[SETTINGS] Resetting showViewButtons on component mount"),Ge(!1)},[]);const ne=i.useCallback(async()=>{var o,s,n,r;try{if(console.log("[SETTINGS] ===== CHECKING GENERATED DATA ====="),(o=t==null?void 0:t.features)!=null&&o.productsJson){console.log("[SETTINGS] Checking Products JSON data...");const l=await ue();Ne(l),console.log("[SETTINGS] Products JSON data exists:",l)}if((s=t==null?void 0:t.features)!=null&&s.collectionsJson){console.log("[SETTINGS] Checking Collections JSON data...");const l=await Se();Pe(l),console.log("[SETTINGS] Collections JSON data exists:",l)}if((n=t==null?void 0:t.features)!=null&&n.storeMetadata){console.log("[SETTINGS] Checking Store Metadata data...");const l=await me();De(l),console.log("[SETTINGS] Store Metadata exists:",l)}if((r=t==null?void 0:t.features)!=null&&r.welcomePage){console.log("[SETTINGS] Checking Welcome Page data...");const l=await xe();Be(l),console.log("[SETTINGS] Welcome Page exists:",l)}console.log("[SETTINGS] ===== GENERATED DATA CHECK COMPLETE =====")}catch(l){console.error("[SETTINGS] Error checking generated data:",l)}},[t==null?void 0:t.features,ue,Se,me,xe]);i.useEffect(()=>{t!=null&&t.features&&a&&(console.log("[SETTINGS] Checking for generated data..."),ne())},[t==null?void 0:t.features,a,ne]),i.useEffect(()=>{if(v){console.log("[SETTINGS] Toast state changed to:",v),te&&clearTimeout(te);const o=setTimeout(()=>{console.log("[SETTINGS] Auto-clearing toast after 5 seconds"),d("")},5e3);Ie(o)}},[v]);const Re=()=>{console.log("[SETTINGS] Starting polling for background regeneration completion..."),se&&clearInterval(se);let o=0;const s=30,n=setInterval(async()=>{o++,console.log(`[SETTINGS] Polling attempt ${o}/${s}`);try{const r=await p(`/api/sitemap/info?shop=${a}`);if(console.log("[SETTINGS] Sitemap info:",r),r&&r.generatedAt){const l=new Date(r.generatedAt).getTime();if(Date.now()-l<12e4){console.log("[SETTINGS] Background regeneration completed!"),clearInterval(n),J(null),d("AI-Optimized Sitemap regeneration completed successfully!"),console.log("[SETTINGS] Setting showAiSitemapView to true for AI sitemap regeneration completion"),ke(!0);return}}o>=s&&(console.log("[SETTINGS] Polling timeout reached"),clearInterval(n),J(null),d("Background regeneration is taking longer than expected. Please check the sitemap manually."))}catch(r){console.error("[SETTINGS] Polling error:",r)}},1e4);J(n)},[Ue,re]=i.useState(!1),[le,B]=i.useState(!1),[ie,R]=i.useState(!1),[ce,q]=i.useState(!1),[de,$e]=i.useState(""),[he,C]=i.useState(null),[pe,ge]=i.useState(!1),[z,Q]=i.useState(null),p=i.useMemo(()=>Ve(),[]),ue=i.useCallback(async()=>{var o,s,n;try{const l=await p("/graphql",{method:"POST",body:JSON.stringify({query:`
        query CheckProductsData($shop: String!) {
          products(shop: $shop, first: 1) {
            edges {
              node {
                id
                title
              }
            }
          }
        }
      `,variables:{shop:a}}),shop:a});return((n=(s=(o=l==null?void 0:l.data)==null?void 0:o.products)==null?void 0:s.edges)==null?void 0:n.length)>0}catch(r){return console.error("[SETTINGS] Error checking products data:",r),!1}},[a,p]),Se=i.useCallback(async()=>{var o,s,n;try{const l=await p("/graphql",{method:"POST",body:JSON.stringify({query:`
        query CheckCollectionsData($shop: String!) {
          collections(shop: $shop, first: 1) {
            edges {
              node {
                id
                title
              }
            }
          }
        }
      `,variables:{shop:a}}),shop:a});return((n=(s=(o=l==null?void 0:l.data)==null?void 0:o.collections)==null?void 0:s.edges)==null?void 0:n.length)>0}catch(r){return console.error("[SETTINGS] Error checking collections data:",r),!1}},[a,p]),me=i.useCallback(async()=>{var o,s;try{const r=await p("/graphql",{method:"POST",body:JSON.stringify({query:`
        query CheckStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
          }
        }
      `,variables:{shop:a}}),shop:a});return(s=(o=r==null?void 0:r.data)==null?void 0:o.storeMetadata)==null?void 0:s.shopName}catch(n){return console.error("[SETTINGS] Error checking store metadata:",n),!1}},[a,p]),xe=i.useCallback(async()=>{var o,s;try{const r=await p("/graphql",{method:"POST",body:JSON.stringify({query:`
        query CheckWelcomePage($shop: String!) {
          welcomePage(shop: $shop) {
            title
            content
          }
        }
      `,variables:{shop:a}}),shop:a});return(s=(o=r==null?void 0:r.data)==null?void 0:o.welcomePage)==null?void 0:s.title}catch(n){return console.error("[SETTINGS] Error checking welcome page:",n),!1}},[a,p]);console.log("[SETTINGS] State variables initialized successfully");const _e=async(o,s)=>{var l,h;console.log("[DEBUG] runGQL called with query:",o),console.log("[DEBUG] runGQL variables:",s);const n=JSON.stringify({query:o,variables:s});console.log("[DEBUG] runGQL body:",n);const r=await p("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:n});if(console.log("[DEBUG] runGQL response:",r),(l=r==null?void 0:r.errors)!=null&&l.length)throw console.error("[DEBUG] GraphQL errors:",r.errors),new Error(((h=r.errors[0])==null?void 0:h.message)||"GraphQL error");return r==null?void 0:r.data},[Te,Fe]=i.useState(!1),[Ke,Ze]=i.useState(!1),[eo,oo]=i.useState(""),[to,Je]=i.useState({enabled:!1,generating:!1,generated:!1,progress:""}),[P,f]=i.useState(!1),[w,V]=i.useState({current:0,total:0,percent:0,currentProduct:"",stats:{siteFAQ:!1,products:0,totalSchemas:0}}),[N,A]=i.useState(!1),a=Y("shop","");console.log("[SETTINGS] ===== SHOP EXTRACTION DEBUG ====="),console.log("[SETTINGS] window.location.search:",window.location.search),console.log("[SETTINGS] Extracted shop:",a),console.log("[SETTINGS] Shop type:",typeof a),console.log("[SETTINGS] Shop length:",a==null?void 0:a.length),console.log("[SETTINGS] ===== SHOP EXTRACTION COMPLETE ====="),i.useEffect(()=>{if(console.log("[SETTINGS] ===== LOAD SETTINGS useEffect ====="),console.log("[SETTINGS] Shop:",a),console.log("[SETTINGS] API function:",typeof p),!a){console.log("[SETTINGS] No shop, setting loading to false"),G(!1);return}console.log("[SETTINGS] Shop available, calling loadSettings..."),ze()},[a,p]),i.useEffect(()=>{Te&&qe()},[Te]),i.useEffect(()=>{t&&Object.values(t.features||{}).some(o=>o)&&L(o=>({...o,enabled:!0,discoveryEnabled:!0}))},[t==null?void 0:t.features]);const qe=async()=>{try{const o=await p(`/api/schema/status?shop=${a}`);Je({enabled:o.enabled,generating:o.generating,generated:o.hasSiteFAQ||o.productsWithSchema>0,progress:o.progress||""})}catch(o){console.error("Failed to check schema status:",o)}},W=async()=>{try{const o=await p(`/ai/schema-data.json?shop=${a}`);if(o.schemas&&o.schemas.length>0){A(!0),f(!1);const s=[...new Set(o.schemas.map(n=>{var r,l;return(l=(r=n.url)==null?void 0:r.split("/products/")[1])==null?void 0:l.split("#")[0]}))].filter(Boolean);V(n=>({...n,percent:100,stats:{siteFAQ:!!o.site_faq,products:s.length,totalSchemas:o.schemas.length}}))}else V(s=>({...s,percent:Math.min(s.percent+10,90),currentProduct:"Processing products..."})),setTimeout(W,3e3)}catch(o){console.error("Progress check error:",o),setTimeout(W,3e3)}},ze=async()=>{try{console.log("[SETTINGS] ===== STARTING LOAD SETTINGS ====="),console.log("[SETTINGS] Shop:",a),console.log("[SETTINGS] API function:",typeof p),console.log("[SETTINGS] Calling API...");const o=await p(`/api/ai-discovery/settings?shop=${a}`);console.log("[SETTINGS] ===== SETTINGS LOADED ====="),console.log("[SETTINGS] Raw data:",o),console.log("[SETTINGS] Settings plan:",o==null?void 0:o.plan),console.log("[SETTINGS] Normalized plan:",I(o==null?void 0:o.plan)),console.log("[SETTINGS] Features:",o==null?void 0:o.features),L(o),Q(o),Fe(o.advancedSchemaEnabled||!1),U(o),console.log("[SETTINGS] ===== LOAD SETTINGS COMPLETE =====")}catch(o){console.error("[SETTINGS] ===== LOAD SETTINGS ERROR ====="),console.error("[SETTINGS] Failed to load settings:",o),d("Failed to load settings")}finally{G(!1)}},U=async(o=t)=>{console.log("[GENERATE ROBOTS] Called with shop:",a);try{const s=await p(`/api/ai-discovery/robots-txt?shop=${a}`,{responseType:"text"});console.log("[GENERATE ROBOTS] Received:",s),_(s||`User-agent: *
Disallow: /`)}catch(s){console.error("[GENERATE ROBOTS] Error:",s),_(`# Error generating robots.txt
# `+s.message)}};console.log("[SETTINGS DEBUG] generateRobotsTxt function exists:",typeof U);const H=o=>{var s;if(!((s=t==null?void 0:t.availableBots)!=null&&s.includes(o))){d(`Upgrade to ${requiredPlan} plan to enable ${t.bots[o].name}`);return}L(n=>({...n,bots:{...n.bots,[o]:{...n.bots[o],enabled:!n.bots[o].enabled}}})),re(!0)},be=o=>{if(!fe(o)){d(`Upgrade your plan to enable ${{productsJson:"Products JSON Feed",aiSitemap:"AI-Optimized Sitemap",welcomePage:"AI Welcome Page",collectionsJson:"Collections JSON Feed",storeMetadata:"Store Metadata",schemaData:"Schema Data"}[o]||o}`);return}L(s=>({...s,features:{...s.features,[o]:!s.features[o]}}))},Qe=async()=>{var o,s,n,r,l;console.log("[SETTINGS] ===== SAVE SETTINGS CALLED ====="),console.log("[SETTINGS] Current settings:",t),ee(!0);try{if(await p(`/api/ai-discovery/settings?shop=${a}`,{method:"POST",body:{shop:a,bots:t.bots,features:t.features}}),re(!1),Q(t),U(),console.log("[SETTINGS] Checking AI Sitemap feature:",(o=t.features)==null?void 0:o.aiSitemap),(s=t.features)!=null&&s.aiSitemap)try{console.log("[SETTINGS] ===== AI SITEMAP BACKGROUND REGENERATION START ====="),console.log("[SETTINGS] AI Sitemap enabled, starting background regeneration..."),console.log("[SETTINGS] Shop:",a);const h=`
            mutation RegenerateSitemap($shop: String!) {
              regenerateSitemap(shop: $shop) {
                success
                message
                shop
              }
            }
          `;console.log("[SETTINGS] GraphQL mutation:",h),console.log("[SETTINGS] Variables:",{shop:a});const u=await p("/graphql",{method:"POST",body:JSON.stringify({query:h,variables:{shop:a}}),shop:a});console.log("[SETTINGS] GraphQL sitemap regeneration result:",u),(r=(n=u==null?void 0:u.data)==null?void 0:n.regenerateSitemap)!=null&&r.success?(console.log("[SETTINGS] Background regeneration started successfully"),console.log("[SETTINGS] Setting toast for AI sitemap regeneration with delay..."),d(""),setTimeout(()=>{d("Settings saved! AI-Optimized Sitemap is being regenerated in the background. This may take a few moments."),console.log("[SETTINGS] Success toast set after delay"),Re()},100)):(console.log("[SETTINGS] Background regeneration failed:",(l=u==null?void 0:u.data)==null?void 0:l.regenerateSitemap),console.log("[SETTINGS] Setting toast for failed regeneration..."),d(""),setTimeout(()=>{d("Settings saved, but sitemap regeneration failed"),console.log("[SETTINGS] Error toast set after delay")},100)),console.log("[SETTINGS] ===== AI SITEMAP BACKGROUND REGENERATION END =====")}catch(h){console.error("[SETTINGS] Failed to start sitemap regeneration:",h),d("Settings saved, but sitemap regeneration failed")}else console.log("[SETTINGS] AI Sitemap disabled, skipping background regeneration"),console.log("[SETTINGS] Setting toast for basic save with delay..."),d(""),setTimeout(()=>{d("Settings saved successfully"),console.log("[SETTINGS] Basic success toast set after delay"),console.log("[SETTINGS] Basic save completed, not showing View buttons")},100)}catch(h){console.error("Failed to save settings:",h),d("Failed to save settings")}finally{ee(!1)}},so=()=>{navigator.clipboard.writeText($),d("Copied to clipboard!")},ao=async()=>{try{const o=await p(`/api/ai-discovery/apply-robots?shop=${a}`,{method:"POST",body:{shop:a}});d("robots.txt applied successfully!")}catch(o){console.error("Failed to apply robots.txt:",o),d(o.message)}},fe=o=>{var r;const s=I(t==null?void 0:t.plan);return((r={productsJson:["starter","professional","growth","growth_extra","enterprise"],aiSitemap:["starter","professional","growth","growth_extra","enterprise"],welcomePage:["professional","growth","growth_extra","enterprise"],collectionsJson:["growth","growth_extra","enterprise"],storeMetadata:["growth_extra","enterprise"],schemaData:["enterprise"]}[o])==null?void 0:r.includes(s))||!1},M=async o=>{console.log(`[DEBUG] setTestPlan called with plan: ${o}, shop: ${a}`);try{const s=`
        mutation SetPlan($shop:String!, $plan: PlanEnum) {
          setPlanOverride(shop:$shop, plan:$plan) { shop plan }
        }
      `;console.log("[DEBUG] GraphQL mutation:",s),console.log("[DEBUG] Variables:",{shop:a,plan:o});const n=await _e(s,{shop:a,plan:o});console.log("[DEBUG] GraphQL result:",n),d(`Test plan set to ${o||"actual"}`),setTimeout(()=>window.location.reload(),500)}catch(s){console.error("[DEBUG] Failed to set test plan",s),d(`Failed to set test plan: ${s.message}`)}},D=async(o,s)=>{var n,r,l;$e(s),q(!0),ge(!0),C(null);try{const h={productsJson:`/ai/products.json?shop=${a}`,collectionsJson:`/ai/collections-feed.json?shop=${a}`,storeMetadata:`/ai/store-metadata.json?shop=${a}`,schemaData:`/ai/schema-data.json?shop=${a}`,aiSitemap:`/api/sitemap/generate?shop=${a}&force=true`,welcomePage:`/ai/welcome?shop=${a}`};if(o==="aiSitemap"){console.log("[SETTINGS] Loading AI Sitemap XML...");const u=await fetch(h[o],{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${((l=(r=(n=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:n.getState())==null?void 0:r.session)==null?void 0:l.token)||""}`}});if(u.ok){console.log("[SETTINGS] AI Sitemap XML loaded successfully");const j=await u.text();C(j)}else throw new Error(`HTTP ${u.status}: ${u.statusText}`)}else{const u=await p(h[o]);C(JSON.stringify(u,null,2))}}catch(h){console.error("[SETTINGS] Error loading data:",h),C(`Error loading data: ${h.message}`)}finally{ge(!1)}};return a?b?e.jsx(y,{children:e.jsx(g,{padding:"400",children:e.jsxs(T,{align:"center",children:[e.jsx(we,{size:"small"}),e.jsx(c,{children:"Loading settings..."})]})})}):e.jsxs(S,{gap:"600",children:[e.jsx(y,{children:e.jsx(g,{padding:"400",children:e.jsxs(S,{gap:"400",children:[e.jsxs(T,{align:"space-between",children:[e.jsx(c,{as:"h2",variant:"headingMd",children:"AI Bot Access Control"}),(t==null?void 0:t.plan)&&e.jsxs(O,{tone:"info",children:[t.plan.charAt(0).toUpperCase()+t.plan.slice(1)," Plan"]})]}),e.jsx(c,{variant:"bodyMd",tone:"subdued",children:"Choose which AI bots can access your store's structured data"}),e.jsx(E,{status:"info",children:e.jsxs(S,{gap:"200",children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"How it works:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginBottom:0},children:[e.jsx("li",{children:"Select AI bots below"}),e.jsx("li",{children:"Save Settings"}),e.jsx("li",{children:"Generate robots.txt"})]})]})}),e.jsx(Ae,{}),e.jsxs(S,{gap:"300",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["openai","perplexity"].map(o=>{var j,je,Ee;const s=(j=t==null?void 0:t.bots)==null?void 0:j[o];if(!s)return null;const n={starter:["openai","perplexity"],professional:["openai","anthropic","perplexity"],growth:["openai","anthropic","google","perplexity","meta","others"],growth_extra:["openai","anthropic","google","perplexity","meta","others"],enterprise:["openai","anthropic","google","perplexity","meta","others"]},r=I(t==null?void 0:t.plan),h=(n[r]||n.starter).includes(o),u=o==="anthropic"?"Professional":o==="google"?"Growth":["meta","others"].includes(o)?"Growth Extra":null;return e.jsx(g,{padding:"200",background:h?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(S,{gap:"100",children:e.jsx(k,{label:e.jsxs(T,{gap:"200",align:"center",children:[e.jsx(c,{variant:h?"bodyMd":"bodySm",tone:h?"base":"subdued",children:s.name||o}),!h&&u&&e.jsxs(O,{tone:"info",size:"small",children:[u,"+"]})]}),checked:!!((Ee=(je=t==null?void 0:t.bots)==null?void 0:je[o])!=null&&Ee.enabled),onChange:()=>H(o),disabled:!h,helpText:h?o==="openai"?"Most popular AI assistant":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="perplexity"?"AI-powered search":o==="meta"?"Meta AI platforms":o==="others"?"Bytespider, DeepSeek, etc.":"":`Upgrade to ${u} plan to enable this AI bot`})})},o)})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["anthropic","google"].map(o=>{var l,h,u,j;const s=(l=t==null?void 0:t.bots)==null?void 0:l[o];if(!s)return null;const n=(h=t==null?void 0:t.availableBots)==null?void 0:h.includes(o),r=o==="anthropic"?"Professional":o==="google"?"Growth":["meta","others"].includes(o)?"Growth Extra":null;return e.jsx(g,{padding:"200",background:n?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(S,{gap:"100",children:e.jsx(k,{label:e.jsxs(T,{gap:"200",align:"center",children:[e.jsx(c,{variant:n?"bodyMd":"bodySm",tone:n?"base":"subdued",children:s.name||o}),!n&&r&&e.jsxs(O,{tone:"info",size:"small",children:[r,"+"]})]}),checked:!!((j=(u=t==null?void 0:t.bots)==null?void 0:u[o])!=null&&j.enabled),onChange:()=>H(o),disabled:!n,helpText:n?o==="openai"?"Most popular AI assistant":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="perplexity"?"AI-powered search":o==="meta"?"Meta AI platforms":o==="others"?"Bytespider, DeepSeek, etc.":"":`Upgrade to ${r} plan to enable this AI bot`})})},o)})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["meta","others"].map(o=>{var l,h,u,j;const s=(l=t==null?void 0:t.bots)==null?void 0:l[o];if(!s)return null;const n=(h=t==null?void 0:t.availableBots)==null?void 0:h.includes(o),r=o==="anthropic"?"Professional":o==="google"?"Growth":["meta","others"].includes(o)?"Growth Extra":null;return e.jsx(g,{padding:"200",background:n?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(S,{gap:"100",children:e.jsx(k,{label:e.jsxs(T,{gap:"200",align:"center",children:[e.jsx(c,{variant:n?"bodyMd":"bodySm",tone:n?"base":"subdued",children:s.name||o}),!n&&r&&e.jsxs(O,{tone:"info",size:"small",children:[r,"+"]})]}),checked:!!((j=(u=t==null?void 0:t.bots)==null?void 0:u[o])!=null&&j.enabled),onChange:()=>H(o),disabled:!n,helpText:n?o==="openai"?"Most popular AI assistant":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="perplexity"?"AI-powered search":o==="meta"?"Meta AI platforms":o==="others"?"Bytespider, DeepSeek, etc.":"":`Upgrade to ${r} plan to enable this AI bot`})})},o)})})]})]})})}),e.jsx(y,{children:e.jsx(g,{padding:"400",children:e.jsxs(S,{gap:"400",children:[e.jsx(c,{as:"h2",variant:"headingMd",children:"robots.txt Configuration"}),Ue&&e.jsx(E,{status:"warning",title:"Unsaved changes",children:e.jsx("p",{children:'You have unsaved bot selections. Please click "Save Settings" before configuring robots.txt.'})}),e.jsx(E,{children:e.jsx("p",{children:["growth","growth_extra","enterprise"].includes(I(t==null?void 0:t.plan))?"With your plan, you can apply robots.txt changes directly to your theme!":"Copy the generated rules and add them to your theme's robots.txt.liquid file."})}),e.jsxs(T,{gap:"200",children:[e.jsx(m,{onClick:async()=>{console.log("[ADD MANUAL] Starting..."),console.log("[ADD MANUAL] Settings:",t);try{const o=Object.values((t==null?void 0:t.bots)||{}).some(s=>s.enabled);console.log("[ADD MANUAL] Has selected bots:",o),o?(console.log("[ADD MANUAL] Calling generateRobotsTxt..."),await U(),console.log("[ADD MANUAL] Robots.txt generated, showing instructions"),R(!0)):(console.log("[ADD MANUAL] No bots, showing modal"),B(!0))}catch(o){console.error("[ADD MANUAL] Error:",o),d("Error generating robots.txt: "+o.message)}},children:"Add manually"}),["growth","growth_extra","enterprise"].includes(I(t==null?void 0:t.plan))&&e.jsx(m,{primary:!0,onClick:async()=>{console.log("[APPLY AUTO] Starting..."),console.log("[APPLY AUTO] Settings:",t),console.log("[APPLY AUTO] Bots:",t==null?void 0:t.bots);try{const o=Object.values((t==null?void 0:t.bots)||{}).some(n=>n.enabled);if(console.log("[APPLY AUTO] Has selected bots:",o),!o){console.log("[APPLY AUTO] No bots selected, showing modal"),B(!0);return}console.log("[APPLY AUTO] Applying robots.txt...");const s=await p(`/api/ai-discovery/apply-robots?shop=${a}`,{method:"POST",shop:a,body:{shop:a}});console.log("[APPLY AUTO] Data:",s),d(s.message||"robots.txt applied successfully!")}catch(o){console.error("[APPLY AUTO] Error:",o),d(o.message)}},children:"Apply Automatically"})]})]})})}),e.jsx(g,{paddingInlineStart:"600",paddingInlineEnd:"600",children:e.jsxs(T,{align:"center",blockAlign:"center",children:[e.jsx(g,{children:e.jsx(We,{source:He,color:"subdued"})}),e.jsx(c,{variant:"bodySm",tone:"subdued",children:"Configure what data the AI bots can access"})]})}),e.jsx(y,{children:e.jsx(g,{padding:"400",children:e.jsxs(S,{gap:"400",children:[e.jsx(c,{as:"h2",variant:"headingMd",children:"AI Discovery Features"}),e.jsx(c,{variant:"bodyMd",tone:"subdued",children:"Select the features you want to enable for AI bots to consume your store data."}),e.jsx(E,{status:"info",children:`Don't forget to click "Save Settings" after making changes.`}),e.jsx(Ae,{}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1rem"},children:[{key:"productsJson",name:"Products JSON Feed",description:"Bulk product data for AI consumption",requiredPlan:null},{key:"aiSitemap",name:"AI-Optimized Sitemap",description:"Enhanced sitemap with AI hints",requiredPlan:null},{key:"welcomePage",name:"AI Welcome Page",description:"Landing page for AI bots",requiredPlan:"Professional"},{key:"collectionsJson",name:"Collections JSON Feed",description:"Category data for better AI understanding",requiredPlan:"Growth"},{key:"storeMetadata",name:"Store Metadata for AI Search",description:"Organization & LocalBusiness schema",requiredPlan:"Growth Extra"},{key:"schemaData",name:"Advanced Schema Data",description:"BreadcrumbList, FAQPage & more",requiredPlan:"Enterprise"}].map(o=>{var r;const s=fe(o.key),n=!!((r=t==null?void 0:t.features)!=null&&r[o.key]);return e.jsx(g,{padding:"200",background:s?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:s?e.jsxs(T,{align:"space-between",blockAlign:"center",children:[e.jsx(g,{flexGrow:1,children:e.jsx(k,{label:o.name,checked:n,onChange:()=>be(o.key),helpText:o.description})}),o.key==="aiSitemap"&&Oe&&e.jsx(m,{size:"slim",onClick:()=>D(o.key,o.name),children:"View"}),o.key==="productsJson"&&Ce&&e.jsx(m,{size:"slim",onClick:()=>D(o.key,o.name),children:"View"}),o.key==="collectionsJson"&&ve&&e.jsx(m,{size:"slim",onClick:()=>D(o.key,o.name),children:"View"}),o.key==="storeMetadata"&&Me&&e.jsx(m,{size:"slim",onClick:()=>D(o.key,o.name),children:"View"}),o.key==="welcomePage"&&Le&&e.jsx(m,{size:"slim",onClick:()=>D(o.key,o.name),children:"View"})]}):e.jsx(k,{label:e.jsxs(T,{gap:"200",align:"center",children:[e.jsx(c,{variant:"bodySm",tone:"subdued",children:o.name}),o.requiredPlan&&e.jsxs(O,{tone:"info",size:"small",children:[o.requiredPlan,o.requiredPlan!=="Enterprise"&&"+"]})]}),checked:!1,onChange:()=>be(o.key),disabled:!0,helpText:`Upgrade to ${o.requiredPlan} plan to enable`})},o.key)})})]})})}),I(t==null?void 0:t.plan)==="enterprise"&&((K=t==null?void 0:t.features)==null?void 0:K.schemaData)&&((Z=z==null?void 0:z.features)==null?void 0:Z.schemaData)&&e.jsx(y,{children:e.jsx(g,{padding:"400",children:e.jsxs(S,{gap:"400",children:[e.jsx(c,{as:"h2",variant:"headingMd",children:"Advanced Schema Data Management"}),e.jsx(c,{variant:"bodyMd",tone:"subdued",children:"Generate and manage structured data for your products"}),e.jsxs(T,{gap:"300",children:[e.jsx(m,{primary:!0,onClick:async()=>{const o=await p(`/ai/schema-data.json?shop=${a}`);if(!(o.schemas&&o.schemas.length>0&&!confirm("This will replace existing schema data. Continue?"))){f(!0),A(!1),V({current:0,total:0,percent:0,currentProduct:"Initializing...",stats:{siteFAQ:!1,products:0,totalSchemas:0}});try{const s=await p(`/api/schema/generate-all?shop=${a}`,{method:"POST",shop:a,body:{shop:a}});setTimeout(W,2e3)}catch(s){console.error("Error:",s),d("Failed to generate schema"),f(!1)}}},children:"Generate/Update Schema Data"}),e.jsx(m,{onClick:()=>{window.open(`/ai/schema-data.json?shop=${a}`,"_blank")},children:"View Generated Schema"}),e.jsx(m,{destructive:!0,onClick:async()=>{if(confirm("This will delete all advanced schema data. Are you sure?"))try{await p(`/api/schema/delete?shop=${a}`,{method:"DELETE",shop:a,body:{shop:a}}),d("Schema data deleted successfully")}catch{d("Failed to delete schema data")}},children:"Delete Schema Data"})]}),e.jsx(E,{status:"info",tone:"subdued",children:e.jsxs("p",{children:["Generation creates BreadcrumbList, FAQPage, WebPage and more schemas for each product. AI can access them at ",e.jsx("code",{children:"/ai/product/[handle]/schemas.json"})]})})]})})}),e.jsxs(T,{gap:"200",align:"end",children:[e.jsx(m,{tone:"critical",onClick:async()=>{if(window.confirm("Are you sure you want to reset all AI Discovery settings to defaults?"))try{await p(`/api/ai-discovery/settings?shop=${a}`,{method:"DELETE",shop:a}),d("Settings reset successfully"),Q(null),setTimeout(()=>{window.location.reload()},1e3)}catch(o){console.error("Failed to reset:",o),d("Failed to reset settings")}},children:"Reset to Defaults"}),e.jsx(m,{primary:!0,size:"large",loading:ye,onClick:Qe,disabled:!t,children:"Save Settings"})]}),oe&&e.jsx(x,{open:oe,onClose:()=>F(!1),title:"robots.txt Configuration",primaryAction:{content:"Copy to clipboard",onAction:()=>{navigator.clipboard.writeText($),d("Copied to clipboard!")}},secondaryActions:[{content:"Close",onAction:()=>F(!1)}],children:e.jsx(x.Section,{children:e.jsxs(S,{gap:"400",children:[!["growth","growth_extra","enterprise"].includes(I(t==null?void 0:t.plan))&&e.jsx(E,{status:"info",title:"Manual Configuration Steps",children:e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:"Copy the robots.txt content below"}),e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Online Store → Themes"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Actions → Edit code"})," on your active theme"]}),e.jsxs("li",{children:["In the file browser, look for ",e.jsx("strong",{children:"robots.txt.liquid"})]}),e.jsxs("li",{children:["If it doesn't exist, click ",e.jsx("strong",{children:"Add a new template"}),' → Select "robots" → Create']}),e.jsx("li",{children:"Replace the content with what you copied"}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Save"})]})]})}),e.jsx(g,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:$})})]})})}),le&&e.jsx(x,{open:le,onClose:()=>B(!1),title:"No AI Bots Selected",primaryAction:{content:"Got it",onAction:()=>B(!1)},children:e.jsx(x.Section,{children:e.jsxs(S,{gap:"400",children:[e.jsx(E,{status:"warning",children:e.jsx("p",{children:"You haven't selected any AI bots yet."})}),e.jsx(c,{children:"To configure robots.txt:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:'Select AI bots from the "AI Bot Access Control" section above'}),e.jsx("li",{children:'Click "Save Settings" to save your selections'}),e.jsx("li",{children:'Then click "Apply Automatically" to configure robots.txt'})]})]})})}),ie&&e.jsx(x,{open:ie,onClose:()=>R(!1),title:"Manual robots.txt Configuration",primaryAction:{content:"Continue",onAction:()=>{R(!1),F(!0)}},secondaryActions:[{content:"Cancel",onAction:()=>R(!1)}],children:e.jsx(x.Section,{children:e.jsxs(S,{gap:"400",children:[e.jsx(c,{variant:"headingMd",children:"How to add robots.txt manually:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:'Click "Continue" to see your custom robots.txt content'}),e.jsx("li",{children:"Copy the generated content"}),e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Online Store → Themes"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Actions → Edit code"})," on your active theme"]}),e.jsxs("li",{children:["Find or create ",e.jsx("strong",{children:"robots.txt.liquid"})," file"]}),e.jsx("li",{children:"Paste the content and save"})]}),e.jsx(E,{status:"info",children:e.jsx("p",{children:"This allows AI bots to discover and properly index your products."})})]})})}),e.jsx(y,{children:e.jsx(g,{padding:"400",children:e.jsxs(S,{gap:"400",children:[e.jsx(c,{as:"h2",variant:"headingMd",children:"Test Plan Switcher (Dev Only)"}),e.jsxs(T,{gap:"200",children:[e.jsx(m,{onClick:()=>M("starter"),children:"Starter"}),e.jsx(m,{onClick:()=>M("professional"),children:"Professional"}),e.jsx(m,{onClick:()=>M("growth"),children:"Growth"}),e.jsx(m,{onClick:()=>M("growth_extra"),children:"Growth Extra"}),e.jsx(m,{onClick:()=>M("enterprise"),children:"Enterprise"})]})]})})}),ce&&e.jsx(x,{open:ce,onClose:()=>{q(!1),C(null)},title:de,primaryAction:{content:"Copy",onAction:()=>{navigator.clipboard.writeText(he),d("Copied to clipboard!")},disabled:pe},secondaryActions:[{content:"Close",onAction:()=>{q(!1),C(null)}}],children:e.jsx(x.Section,{children:e.jsx(g,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:pe?e.jsxs(T,{align:"center",gap:"200",children:[e.jsx(we,{size:"small"}),e.jsx(c,{variant:"bodyMd",children:de==="AI-Optimized Sitemap"?"Loading sitemap XML... This may take a moment for large stores.":"Loading..."})]}):e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:he})})})}),X("Modal states",{schemaGenerating:P,schemaComplete:N,modalShouldShow:P&&!N}),P&&!N&&e.jsx(x,{open:P,title:"Generating Advanced Schema Data",onClose:()=>{X("Modal close clicked"),f(!1)},children:e.jsx(x.Section,{children:e.jsxs(c,{children:["Modal is showing! Progress: ",w.percent,"%"]})})}),N&&e.jsx(x,{open:!0,title:"Schema Generation Complete",onClose:()=>{f(!1),A(!1)},primaryAction:{content:"View Generated Schemas",onAction:()=>{window.open(`/ai/schema-data.json?shop=${a}`,"_blank"),f(!1),A(!1)}},secondaryActions:[{content:"Close",onAction:()=>{f(!1),A(!1)}}],children:e.jsx(x.Section,{children:e.jsxs(S,{gap:"400",children:[e.jsx(E,{status:"success",title:"Generation successful!",children:e.jsx("p",{children:"Advanced schema data has been generated for your products."})}),e.jsx(c,{variant:"headingMd",children:"Generation Statistics"}),e.jsxs(T,{gap:"600",wrap:!0,children:[e.jsxs(g,{children:[e.jsx(c,{variant:"bodyMd",tone:"subdued",children:"Site FAQ"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",children:w.stats.siteFAQ?"✓":"—"})]}),e.jsxs(g,{children:[e.jsx(c,{variant:"bodyMd",tone:"subdued",children:"Products Processed"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",children:w.stats.products})]}),e.jsxs(g,{children:[e.jsx(c,{variant:"bodyMd",tone:"subdued",children:"Total Schemas"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",children:w.stats.totalSchemas})]})]}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(c,{variant:"bodySm",tone:"subdued",children:"Schemas are now available at /ai/product/[handle]/schemas.json"})})]})})}),P&&!N&&e.jsx(x,{open:!0,title:"Generating Advanced Schema Data",onClose:()=>{},noScroll:!0,children:e.jsx(x.Section,{children:e.jsxs(S,{gap:"400",children:[e.jsx(c,{variant:"bodyMd",children:"Generating schemas for your products..."}),e.jsx(Ye,{progress:w.percent,size:"small"}),e.jsx(c,{variant:"bodySm",tone:"subdued",children:"This process may take 1-2 minutes depending on the number of products."})]})})}),N&&e.jsx(x,{open:!0,title:"Schema Generation Complete",onClose:()=>{f(!1),A(!1)},primaryAction:{content:"View Generated Schemas",onAction:()=>{window.open(`/ai/schema-data.json?shop=${a}`,"_blank"),f(!1),A(!1)}},secondaryActions:[{content:"Close",onAction:()=>{f(!1),A(!1)}}],children:e.jsx(x.Section,{children:e.jsxs(S,{gap:"400",children:[e.jsx(E,{status:"success",title:"Generation successful!",children:e.jsx("p",{children:"Advanced schema data has been generated for your products."})}),e.jsx(c,{variant:"headingMd",children:"Generation Statistics"}),e.jsxs(T,{gap:"600",wrap:!0,children:[e.jsxs(g,{children:[e.jsx(c,{variant:"bodyMd",tone:"subdued",children:"Site FAQ"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",children:w.stats.siteFAQ?"✓":"—"})]}),e.jsxs(g,{children:[e.jsx(c,{variant:"bodyMd",tone:"subdued",children:"Products Processed"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",children:w.stats.products})]}),e.jsxs(g,{children:[e.jsx(c,{variant:"bodyMd",tone:"subdued",children:"Total Schemas"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",children:w.stats.totalSchemas})]})]}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(c,{variant:"bodySm",tone:"subdued",children:"Schemas are now available at /ai/product/[handle]/schemas.json"})})]})})}),v&&e.jsx(Xe,{content:v,onDismiss:()=>d("")})]}):e.jsx(y,{children:e.jsx(g,{padding:"400",children:e.jsx(c,{tone:"critical",children:"Missing shop parameter"})})})}catch(b){return console.error("[SETTINGS] Component initialization error:",b),e.jsx(S,{gap:"400",children:e.jsx(y,{children:e.jsxs(g,{padding:"400",children:[e.jsx(c,{variant:"headingMd",children:"Settings Error"}),e.jsx(g,{paddingBlockStart:"200",children:e.jsxs(c,{children:["Failed to load settings: ",b.message]})})]})})})}}export{co as default};
