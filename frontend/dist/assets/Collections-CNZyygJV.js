import{r as e,j as t}from"./react-vendor-BXVC7v0l.js";import{m as n}from"./sessionFetch-D-wQHgMT.js";import{S as s,U as l}from"./StoreMetadataBanner-_-ut6CwW.js";import{I as i,T as a,a as o}from"./TokenPurchaseModal-DozAvzCY.js";import{M as r,a as c,T as d,e as u,d as h,b as p,B as g,I as m,g as x,D as j,f,C as S,h as b,S as y,j as v,k as C,i as A,R as k,l as w,n as P,E as I}from"./polaris-CyaoFo5Q.js";import"./app-bridge-DUY42B6P.js";import"./vendor-Cs_VgJ2r.js";import"./index-Tyt1Q8Am.js";function E({shop:E,globalPlan:O}){var $,M,z;const L=E||((e,t="")=>{try{return new URLSearchParams(window.location.search).get(e)||t}catch{return t}})("shop",""),T=e.useMemo(()=>n(),[]),[W,R]=e.useState([]),[D,U]=e.useState(!1),[B,q]=e.useState(0),[N,F]=e.useState([]),[_,H]=e.useState(!1),[J,K]=e.useState(""),[Y,Z]=e.useState(""),[G,Q]=e.useState("all"),[V,X]=e.useState(""),[ee,te]=e.useState([]),[ne,se]=e.useState([]),[le,ie]=e.useState(!1),[ae,oe]=e.useState(!1),[re,ce]=e.useState(!1),[de,ue]=e.useState(!1),[he,pe]=e.useState("updatedAt"),[ge,me]=e.useState("desc"),[xe,je]=e.useState(""),[fe,Se]=e.useState([]),[be,ye]=e.useState([]),[ve,Ce]=e.useState([]),[Ae,ke]=e.useState(!1),[we,Pe]=e.useState({current:0,total:0,percent:0}),[Ie,Ee]=e.useState(""),[Oe,$e]=e.useState([]),[Me,ze]=e.useState(!1),[Le,Te]=e.useState(null),[We,Re]=e.useState(!1),[De,Ue]=e.useState(""),[Be,qe]=e.useState(!1),[Ne,Fe]=e.useState([]),[_e,He]=e.useState(!1),[Je,Ke]=e.useState(!1),[Ye,Ze]=e.useState(!1),[Ge,Qe]=e.useState(!1),[Ve,Xe]=e.useState([]),[et,tt]=e.useState({}),[nt,st]=e.useState(!1),[lt,it]=e.useState(!1),[at,ot]=e.useState({}),[rt,ct]=e.useState(!1),[dt,ut]=e.useState(null),[ht,pt]=e.useState(!1),[gt,mt]=e.useState(""),[xt,jt]=e.useState(!1),[ft,St]=e.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[bt,yt]=e.useState(!1),[vt,Ct]=e.useState(!1),[At,kt]=e.useState(!1),[wt,Pt]=e.useState(!1),[It,Et]=e.useState(null),[Ot,$t]=e.useState("starter"),[Mt,zt]=e.useState(1),[Lt,Tt]=e.useState(!1);e.useEffect(()=>{if(O&&"object"==typeof O&&!Lt&&"starter"===Ot)if(O.planKey&&""!==O.planKey){$t(O.planKey);const e=O.language_limit||1;zt(e)}else if(O.plan&&""!==O.plan){const e=O.plan.toLowerCase().replace(/\s+/g,"-");$t(e);const t=O.language_limit||1;zt(t)}},[O,Ot,Lt]);const[Wt,Rt]=e.useState({inProgress:!1,status:"idle",message:null,totalCollections:0,processedCollections:0,successfulCollections:0,failedCollections:0,skippedCollections:0,completedAt:null}),Dt=e.useRef(null),[Ut,Bt]=e.useState({inProgress:!1,status:"idle",message:null,totalCollections:0,processedCollections:0,successfulCollections:0,failedCollections:0,skippedCollections:0,completedAt:null}),qt=e.useRef(null);e.useEffect(()=>{if(!L)return;T("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n      query PlansMe($shop:String!) {\n        plansMe(shop:$shop) {\n          plan\n          planKey\n          modelsSuggested\n          language_limit\n          product_limit\n        }\n      }\n    ",variables:{shop:L}})}).then(e=>{var t,n,s;if(null==(t=null==e?void 0:e.errors)?void 0:t.length)throw new Error((null==(n=e.errors[0])?void 0:n.message)||"GraphQL error");const l=null==(s=null==e?void 0:e.data)?void 0:s.plansMe,i=(null==l?void 0:l.modelsSuggested)||["google/gemini-1.5-flash"];Se(i.map(e=>({label:e,value:e}))),je(i[0]),$t((null==l?void 0:l.planKey)||"starter");const a=(null==l?void 0:l.language_limit)||1;zt(a),Tt(!0)}).catch(e=>{mt(`Error loading models: ${e.message}`),Tt(!0)})},[L,T]),e.useEffect(()=>{L&&T(`/api/languages/shop/${L}?shop=${L}`).then(e=>{const t=(null==e?void 0:e.shopLanguages)||["en"];Ce(t),ye([])}).catch(e=>{Ce(["en"]),ye([])})},[L,T]);const Nt=e.useCallback(async()=>{U(!0);try{const e=`/collections/list-graphql?${new URLSearchParams({shop:L,...Y&&{search:Y},..."all"!==G&&{optimized:G},sortBy:he,sortOrder:ge})}`;let t=(await T(e)).collections||[];if(Y){const e=Y.toLowerCase();t=t.filter(t=>t.title.toLowerCase().includes(e)||t.handle.toLowerCase().includes(e))}"all"!==G&&(t=t.filter(e=>"true"===G?e.hasSeoData:!e.hasSeoData)),R(t),q(t.length)}catch(e){mt(`Error loading collections: ${e.message}`)}finally{U(!1)}},[L,Y,G,he,ge,T]);e.useEffect(()=>{L&&(Nt(),Ke(!1))},[L,G,he,ge,Nt]),e.useEffect(()=>{const e=setTimeout(()=>{L&&Nt()},500);return()=>clearTimeout(e)},[Y]);const Ft=e.useCallback(e=>{F(e);const t=e.some(e=>{const t=W.find(t=>t.id===e);return null==t?void 0:t.hasSeoData});Ke(t),0===e.length&&H(!1)},[W]),_t=e.useCallback(e=>{if(H(e),e){F(W.map(e=>e.id));const e=W.some(e=>e.hasSeoData);Ke(e)}else F([]),Ke(!1)},[W]),Ht=e=>{if(!e)return"";const t=Math.floor((new Date-new Date(e))/1e3);if(t<60)return"just now";const n=Math.floor(t/60);if(n<60)return`${n}m ago`;const s=Math.floor(n/60);if(s<24)return`${s}h ago`;return`${Math.floor(s/24)}d ago`},Jt=e.useCallback(async()=>{try{const e=await T(`/api/seo/collection-job-status?shop=${L}&type=seo`);return Rt(t=>(t.inProgress&&!e.inProgress&&("completed"===e.status||"failed"===e.status)&&(Dt.current&&(clearInterval(Dt.current),Dt.current=null),"completed"===e.status?mt(`Optimized ${e.successfulCollections} collection${1!==e.successfulCollections?"s":""}`):"failed"===e.status&&mt(`Collection SEO failed: ${e.message||"Unknown error"}`),Nt()),e)),e}catch(e){}},[L,T,Nt]),Kt=e.useCallback(()=>{Dt.current&&clearInterval(Dt.current),Jt(),Dt.current=setInterval(()=>{Jt()},5e3)},[Jt]),Yt=e.useCallback(async()=>{try{const e=await T(`/ai-enhance/collection-job-status?shop=${L}`);return Bt(t=>(t.inProgress&&!e.inProgress&&("completed"===e.status||"failed"===e.status)&&(qt.current&&(clearInterval(qt.current),qt.current=null),"completed"===e.status?mt(`AI Enhanced ${e.successfulCollections} collection${1!==e.successfulCollections?"s":""}`):"failed"===e.status&&mt(`AI Enhancement failed: ${e.message||"Unknown error"}`),Nt()),e)),e}catch(e){}},[L,T,Nt]),Zt=e.useCallback(()=>{qt.current&&clearInterval(qt.current),Yt(),qt.current=setInterval(()=>{Yt()},5e3)},[Yt]);e.useEffect(()=>()=>{Dt.current&&clearInterval(Dt.current),qt.current&&clearInterval(qt.current)},[]),e.useEffect(()=>{L&&(Jt().then(e=>{(null==e?void 0:e.inProgress)&&Kt()}),Yt().then(e=>{(null==e?void 0:e.inProgress)&&Zt()}))},[L,Jt,Yt,Kt,Zt]);const Gt=e.useMemo(()=>{var e;if(_)return be.length>Mt;const t=W.filter(e=>N.includes(e.id));if(0===t.length)return be.length>Mt;for(const n of t){const t=(null==(e=n.optimizationSummary)?void 0:e.optimizedLanguages)||[],s=be.filter(e=>!t.includes(e));if(t.length+s.length>Mt)return!0}return!1},[W,N,_,Mt,be]),Qt=async()=>{const e=W.filter(e=>N.includes(e.id)).filter(e=>{var t;return(null==(t=e.optimizedLanguages)?void 0:t.length)>0});if(0===e.length)return void mt("Please select collections with Basic SEO optimization");const t=e.map(e=>({collectionId:e.id,languages:e.optimizedLanguages||[],title:e.title}));try{const e=await T("/ai-enhance/collection-batch",{method:"POST",shop:L,body:{collections:t}});e.queued?(mt(`Enhancing ${t.length} collections in background...`),F([]),H(!1),Zt()):mt(e.message||"Failed to queue AI Enhancement job")}catch(n){if(403===n.status)return Et(n),$t(n.currentPlan||Ot||"starter"),void yt(!0);if(402===n.status||n.requiresPurchase||n.trialRestriction)return Et(n),$t(n.currentPlan||Ot||"starter"),void(n.trialRestriction&&n.requiresActivation?kt(!0):n.trialRestriction?yt(!0):Ct(!0));mt(`Error: ${n.message||"Failed to start AI Enhancement"}`)}},Vt=Ae&&!ft.processing&&t.jsx(r,{open:Ae,title:"Processing Collections",onClose:()=>{},noScroll:!0,children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsx(d,{variant:"bodyMd",children:Ie?`Processing: ${Ie}`:"Preparing..."}),t.jsx(u,{progress:we.percent}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:[we.current," of ",we.total," collections (",we.percent,"%)"]})]})})}),Xt=t.jsx(r,{open:lt,title:"Select Languages",primaryAction:{content:"Generate Optimization for AI Search",onAction:async()=>{var e;if(be.length){it(!1);try{const e=(_?W:W.filter(e=>N.includes(e.id))).map(e=>({collectionId:e.id,languages:be,title:e.title})),t=await T("/api/seo/collection-generate-apply-batch",{method:"POST",shop:L,body:{collections:e,model:xe||"google/gemini-1.5-flash"}});t.queued?(mt(`Optimizing ${e.length} collections in background...`),F([]),H(!1),Kt()):mt(t.message||"Failed to queue optimization job")}catch(t){if(403===t.status||(null==(e=t.message)?void 0:e.includes("requires Professional plan")))return Et({error:t.message||"Collections SEO requires Professional plan or higher",currentPlan:t.currentPlan||Ot||"starter",upgradeMessage:t.upgradeMessage||"Upgrade to Professional plan to optimize collections for AI search"}),void yt(!0);mt(`Error: ${t.message||"Failed to start optimization"}`)}}else mt("Please select at least one language")},disabled:0===be.length||Gt},secondaryActions:[{content:"Cancel",onAction:()=>it(!1)}],children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"300",children:[t.jsxs(d,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",_?"all":N.length," selected collections:"]}),Gt&&t.jsx(h,{tone:"warning",title:"Language limit exceeded",children:t.jsxs(c,{gap:"200",children:[t.jsxs(d,{variant:"bodyMd",children:["Your ",Ot," plan supports up to ",Mt," language",Mt>1?"s":""," per collection.",1===N.length&&(null==(z=null==(M=null==($=W.find(e=>e.id===N[0]))?void 0:$.optimizationSummary)?void 0:M.optimizedLanguages)?void 0:z.length)>0&&t.jsxs(t.Fragment,{children:[" This collection already has ",W.find(e=>e.id===N[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),t.jsx(d,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),t.jsx(p,{variant:"primary",onClick:()=>{const e=new URLSearchParams(window.location.search),t=e.toString()?`?${e.toString()}`:"";window.location.href=`/billing${t}`},children:"Upgrade Plan"})]})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"200",wrap:!0,children:ve.map(e=>t.jsx(x,{label:e.toUpperCase(),checked:be.includes(e),onChange:t=>{ye(t?[...be,e]:be.filter(t=>t!==e))}},e))})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(p,{plain:!0,onClick:()=>{be.length===ve.length?ye([]):ve.length>Mt?(ye([...ve]),mt(`You selected ${ve.length} languages. Your ${Ot} plan supports ${Mt}. Please deselect or upgrade.`)):ye([...ve])},children:be.length===ve.length?"Deselect all":"Select all"})})]})})}),en=t.jsx(r,{open:nt&&!Ae,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:async()=>{var e;ke(!0),Pe({current:0,total:0,percent:0});try{const n=Object.entries(et).filter(([e,t])=>t.success),s=n.length;Pe({current:0,total:s,percent:0});for(let l=0;l<n.length;l++){const[i,a]=n[l],o=W.find(e=>e.id===i);if(!o)continue;Ee(o.title);try{if(!(null==(e=a.data)?void 0:e.results)||!Array.isArray(a.data.results))throw new Error("Invalid results structure");const t=await T("/seo/apply-collection-multi",{method:"POST",shop:L,body:{shop:L,collectionId:i,results:a.data.results.map(e=>({language:e.language,seo:e.data})),options:{updateTitle:!0,updateDescription:!0,updateSeo:!0,updateMetafields:!0}}});if(!(null==t?void 0:t.ok))throw new Error((null==t?void 0:t.error)||"Apply failed")}catch(t){Oe.push({id:o.id,title:o.title,message:t.message})}const r=l+1,c=Math.round(r/s*100);Pe({current:r,total:s,percent:c})}mt("Optimization applied successfully!"),st(!1),tt({}),F([]),await Nt(),H(!1)}catch(t){mt(`Error applying optimization: ${t.message}`)}finally{ke(!1),Ee("")}},disabled:!Object.values(et).some(e=>e.success)},secondaryActions:[{content:"Cancel",onAction:()=>st(!1)}],children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"300",children:[t.jsxs(m,{gap:"400",children:[t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(et).filter(e=>e.success&&!e.skipped).length})]}),t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(et).filter(e=>e.skipped).length})]}),t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(et).filter(e=>!e.success&&!e.skipped).length})]})]}),Oe.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(j,{}),t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),t.jsxs(g,{maxHeight:"200px",overflowY:"scroll",children:[Oe.slice(0,10).map((e,n)=>t.jsxs(d,{variant:"bodySm",tone:"critical",children:[e.collection,": ",e.error]},n)),Oe.length>10&&t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["... and ",Oe.length-10," more errors"]})]})]})]})})}),tn=t.jsx(r,{open:rt,title:"SEO Data Preview",secondaryActions:[{content:"Close",onAction:()=>{ct(!1),ut(null)}}],children:t.jsx(r.Section,{children:t.jsx(g,{children:t.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",backgroundColor:"#f6f6f7",padding:"12px",borderRadius:"4px",maxHeight:"400px",overflow:"auto"},children:dt?JSON.stringify(dt,null,2):""})})})}),nn=t.jsx(r,{open:Be,title:"Delete Optimization for AI Search",onClose:()=>{qe(!1),Fe([])},primaryAction:{content:"Continue",onAction:()=>{Xe(Ne),qe(!1),Qe(!0)},disabled:0===Ne.length},secondaryActions:[{content:"Cancel",onAction:()=>{qe(!1),Fe([])}}],children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsxs(d,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",_?B:N.length," selected collections:"]}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"400",wrap:!1,children:ve.map(e=>t.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[t.jsx("input",{type:"checkbox",checked:Ne.includes(e),onChange:t=>{Fe(t.target.checked?[...Ne,e]:Ne.filter(t=>t!==e))},style:{marginRight:"8px",width:"18px",height:"18px",cursor:"pointer"}}),t.jsx(d,{variant:"bodyMd",children:e.toUpperCase()})]},e))})}),t.jsx(g,{children:t.jsx(p,{plain:!0,onClick:()=>{Fe(Ne.length===ve.length?[]:[...ve])},children:"Select all"})}),t.jsx(g,{paddingBlockStart:"300",children:t.jsx(d,{variant:"bodySm",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})})]})})}),sn=t.jsx(r,{open:Ge,title:"Confirm Deletion",onClose:()=>{Qe(!1),Xe([])},primaryAction:{content:"Delete",destructive:!0,onAction:async()=>{Qe(!1),setTimeout(()=>{(async(e=[])=>{He(!0),Ue("");try{const n=_?W:W.filter(e=>N.includes(e.id)),s=n.length*e.length;let l=0;const i=[];for(const a of n)for(const n of e)try{await T("/collections/delete-seo",{method:"DELETE",shop:L,body:{shop:L,collectionId:a.id,language:n}})}catch(t){i.push({id:a.id,title:a.title,message:t.message})}finally{l++,Pe({current:l,total:s,percent:Math.round(l/s*100)})}mt(`Deleted optimization for ${e.join(", ").toUpperCase()}`),setTimeout(async()=>{await Nt(),F([]),H(!1),Ke(!1)},100)}catch(t){mt(`Delete error: ${t.message}`)}finally{He(!1),Xe([]),Fe([])}})(Ve)},100)}},secondaryActions:[{content:"Cancel",onAction:()=>{Qe(!1),Xe([]),Fe([])}}],children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsx(d,{variant:"bodyMd",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"200",children:Ve.map(e=>t.jsx(f,{tone:"warning",children:e.toUpperCase()},e))})}),t.jsxs(d,{variant:"bodyMd",children:["This will delete optimisation from ",_?B:N.length," selected collections."]}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(d,{variant:"bodySm",tone:"critical",children:"This action cannot be undone."})})]})})}),ln=_e&&t.jsx(r,{open:_e,title:"Deleting SEO Data",onClose:()=>{},noScroll:!0,children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsx(d,{variant:"bodyMd",children:"Deleting selected languages..."}),t.jsx(u,{progress:we.percent}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:[we.current," of ",we.total," operations (",we.percent,"%)"]})]})})}),an=t.jsx(I,{heading:"No collections found",action:{content:"Clear filters",onAction:()=>{Z(""),Q("all"),Nt()}},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:t.jsx("p",{children:"Try adjusting your filters or search terms"})});return t.jsxs(t.Fragment,{children:[t.jsx(s,{globalPlan:O}),t.jsx(S,{children:t.jsx(g,{padding:"400",children:t.jsxs(c,{gap:"300",children:[t.jsxs(m,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[t.jsx(g,{minWidth:"400px",children:t.jsx(b,{label:"",placeholder:"Search by collection name...",value:Y,onChange:Z,prefix:t.jsx(y,{}),clearButton:!0,onClearButtonClick:()=>Z("")})}),t.jsx(g,{width:"320px",children:t.jsx(p,{primary:!0,onClick:()=>{0!==N.length||_?it(!0):mt("Please select collections first")},disabled:0===N.length&&!_,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),t.jsxs(m,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[t.jsx(p,{onClick:async()=>{try{Ze(!0);const e=await T(`/api/collections/sync?shop=${L}`,{method:"POST"});(null==e?void 0:e.success)?(mt("Collections synced successfully!"),await Nt()):mt("Failed to sync collections")}catch(e){mt("Error syncing collections")}finally{Ze(!1)}},disabled:Ye||D,size:"medium",children:Ye?"Syncing...":"Sync Collections"}),t.jsx(g,{width:"320px",children:t.jsxs(c,{gap:"200",align:"end",children:[(()=>{if(0===N.length&&!_)return null;if(!W.filter(e=>N.includes(e.id)).some(e=>{var t;return(null==(t=e.optimizedLanguages)?void 0:t.length)>0}))return null;const e="starter"===Ot.toLowerCase().replace(/_/g," ");return t.jsx(p,{onClick:e?()=>{Et({error:"Collections require Professional plan or higher",message:"Upgrade to Professional plan to access Collections optimization",minimumPlanRequired:"Professional"}),yt(!0)}:Qt,disabled:0===N.length&&!_,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),t.jsx(p,{outline:!0,destructive:!0,onClick:()=>qe(!0),disabled:0===N.length||!Je,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]})})}),t.jsx(g,{paddingBlockStart:"400",children:t.jsxs(S,{children:[t.jsxs(g,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[t.jsxs(m,{gap:"200",wrap:!0,align:"space-between",children:[t.jsx(m,{gap:"200",wrap:!0,children:t.jsx(v,{active:le,activator:t.jsx(p,{disclosure:"down",onClick:()=>ie(!le),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"AI Search Status"}),"all"!==G&&t.jsx(g,{onClick:e=>{e.stopPropagation(),Q("all")},children:t.jsx(d,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ie(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(C,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All collections",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[G],onChange:e=>{Q(e[0]),ie(!1)}})})})}),t.jsx(v,{active:de,activator:t.jsx(p,{disclosure:"down",onClick:()=>ue(!de),removeUnderline:!0,children:t.jsx(m,{gap:"100",blockAlign:"center",children:t.jsxs("span",{children:["updatedAt"===he&&"desc"===ge&&"Newest first","updatedAt"===he&&"asc"===ge&&"Oldest first","title"===he&&"asc"===ge&&"Name A-Z","title"===he&&"desc"===ge&&"Name Z-A","productsCount"===he&&"desc"===ge&&"Most products","productsCount"===he&&"asc"===ge&&"Least products"]})})}),onClose:()=>ue(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(C,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"updatedAt_desc"},{label:"Oldest first",value:"updatedAt_asc"},{label:"Name A-Z",value:"title_asc"},{label:"Name Z-A",value:"title_desc"},{label:"Most products",value:"productsCount_desc"},{label:"Least products",value:"productsCount_asc"}],selected:[`${he}_${ge}`],onChange:e=>{const[t,n]=e[0].split("_");pe(t),me(n),ue(!1)}})})})]}),"all"!==G&&t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"100",wrap:!0,children:t.jsx(f,{onRemove:()=>Q("all"),children:"true"===G?"Has AI Search Optimisation":"No AI Search Optimisation"})})})]}),B>0&&t.jsx(g,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:t.jsx(x,{label:`Select all ${B} collections`,checked:_,onChange:_t})})]})}),(()=>{const e=Ut.inProgress||"completed"===Ut.status||"failed"===Ut.status,n=Wt.inProgress||"completed"===Wt.status||"failed"===Wt.status;return e?t.jsx(g,{paddingBlockStart:"400",children:t.jsx(S,{children:t.jsx(g,{padding:"400",children:Ut.inProgress?t.jsxs(m,{gap:"300",align:"start",blockAlign:"center",children:[t.jsx(A,{size:"small"}),t.jsxs(c,{gap:"100",children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"AI Enhancing Collections..."}),t.jsx(d,{variant:"bodySm",tone:"subdued",children:Ut.message||`Processing ${Ut.processedCollections}/${Ut.totalCollections} collections`}),Ut.totalCollections>0&&t.jsx(g,{paddingBlockStart:"100",children:t.jsx(u,{progress:Ut.processedCollections/Ut.totalCollections*100,size:"small"})})]})]}):"completed"===Ut.status?t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(f,{tone:"success",children:"AI Enhanced"}),t.jsxs(d,{variant:"bodyMd",children:["Enhanced ",Ut.successfulCollections," collection",1!==Ut.successfulCollections?"s":"",Ut.skippedCollections>0&&t.jsxs(d,{as:"span",tone:"subdued",children:[" (",Ut.skippedCollections," skipped)"]}),Ut.failedCollections>0&&t.jsxs(d,{as:"span",tone:"critical",children:[" (",Ut.failedCollections," failed)"]})]}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["· ",Ht(Ut.completedAt)]})]}):t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(f,{tone:"critical",children:"AI Enhancement Failed"}),t.jsx(d,{variant:"bodyMd",tone:"critical",children:Ut.message||"Enhancement failed"})]})})})}):n?t.jsx(g,{paddingBlockStart:"400",children:t.jsx(S,{children:t.jsx(g,{padding:"400",children:Wt.inProgress?t.jsxs(m,{gap:"300",align:"start",blockAlign:"center",children:[t.jsx(A,{size:"small"}),t.jsxs(c,{gap:"100",children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Optimizing Collections..."}),t.jsx(d,{variant:"bodySm",tone:"subdued",children:Wt.message||`Processing ${Wt.processedCollections}/${Wt.totalCollections} collections`}),Wt.totalCollections>0&&t.jsx(g,{paddingBlockStart:"100",children:t.jsx(u,{progress:Wt.processedCollections/Wt.totalCollections*100,size:"small"})})]})]}):"completed"===Wt.status?t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(f,{tone:"success",children:"Completed"}),t.jsxs(d,{variant:"bodyMd",children:["Optimized ",Wt.successfulCollections," collection",1!==Wt.successfulCollections?"s":"",Wt.skippedCollections>0&&t.jsxs(d,{as:"span",tone:"subdued",children:[" (",Wt.skippedCollections," skipped)"]}),Wt.failedCollections>0&&t.jsxs(d,{as:"span",tone:"critical",children:[" (",Wt.failedCollections," failed)"]})]}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["· ",Ht(Wt.completedAt)]})]}):t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(f,{tone:"critical",children:"Failed"}),t.jsx(d,{variant:"bodyMd",tone:"critical",children:Wt.message||"Optimization failed"})]})})})}):null})(),t.jsx(g,{paddingBlockStart:"400",children:t.jsx(S,{children:t.jsx(k,{resourceName:{singular:"collection",plural:"collections"},items:W,renderItem:e=>{var n,s;const l=(null==(n=et[e.id])?void 0:n.success)||at[e.id],i=(null==(s=et[e.id])?void 0:s.data)||at[e.id],a=e.optimizedLanguages||[],o=t.jsx(g,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return t.jsx(P,{id:e.id,media:o,accessibilityLabel:`View details for ${e.title}`,children:t.jsxs(m,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[t.jsxs(g,{style:{flex:"1 1 30%",minWidth:"200px"},children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:e.title}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["Handle: ",e.handle]})]}),t.jsx(g,{style:{flex:"0 0 15%",minWidth:"100px",textAlign:"center"},children:t.jsxs(d,{variant:"bodyMd",children:[e.productsCount," products"]})}),t.jsx(g,{style:{flex:"0 0 25%",minWidth:"160px"},children:t.jsx(m,{gap:"100",wrap:!0,children:e.hasSeoData?t.jsxs(t.Fragment,{children:[ve.map(e=>t.jsx(f,{tone:a.includes(e)?"success":"subdued",size:"small",children:e.toUpperCase()},e)),e.aiEnhanced&&t.jsx(f,{tone:"info",size:"small",children:"AI✨"})]}):t.jsx(f,{tone:"subdued",children:"No AI Search Optimisation"})})}),t.jsxs(g,{style:{flex:"0 0 15%",minWidth:"120px"},children:[l&&t.jsx(p,{size:"slim",onClick:()=>{ut(i),ct(!0)},children:"Preview JSON"}),!l&&e.hasSeoData&&t.jsx(p,{size:"slim",loading:ht,onClick:()=>(async e=>{pt(!0);try{const t=`/collections/${e.split("/").pop()}/seo-data?shop=${encodeURIComponent(L)}`,n=await T(t);ut(n),ct(!0)}catch(t){mt(404===(null==t?void 0:t.status)?"No SEO data found for this collection":"Failed to load SEO data")}finally{pt(!1)}})(e.id),children:"Preview JSON"})]})]})})},selectedItems:N,onSelectionChange:Ft,selectable:!0,loading:D,totalItemsCount:B,emptyState:an,showHeader:!1},`collections-${W.length}-${N.length}`)})}),Vt,Xt,en,tn,nn,sn,ln,(()=>{W.filter(e=>N.includes(e.id)).filter(e=>{var t;return(null==(t=e.optimizedLanguages)?void 0:t.length)>0});const e=()=>{const e=ft.results;jt(!1),St({processing:!1,current:0,total:0,currentItem:"",results:null}),e&&e.successful>0&&setTimeout(()=>{R([]),Nt()},1500)};return ft.processing?t.jsx(r,{open:xt,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsxs(d,{variant:"bodyMd",children:["Processing: ",ft.currentItem]}),t.jsx(u,{progress:ft.current/ft.total*100}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:[ft.current," of ",ft.total," collections (",Math.round(ft.current/ft.total*100),"%)"]})]})})}):null!==ft.results?t.jsx(r,{open:xt,title:"AI Enhancement Results",onClose:e,primaryAction:{content:"Done",onAction:e},children:t.jsx(r.Section,{children:t.jsx(c,{gap:"300",children:t.jsxs(m,{gap:"400",children:[t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"success",children:ft.results.successful})]}),t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:ft.results.failed})]}),t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"info",children:ft.results.skipped})]})]})})})}):null})(),t.jsx(l,{open:bt,onClose:()=>yt(!1),featureName:"Collections AI Enhancement",currentPlan:Ot,errorMessage:(null==It?void 0:It.error)||(null==It?void 0:It.message),minimumPlanRequired:null==It?void 0:It.minimumPlanRequired}),It&&t.jsxs(t.Fragment,{children:[t.jsx(i,{open:vt,onClose:()=>{Ct(!1),Et(null)},tokensRequired:It.tokensRequired||0,tokensAvailable:It.tokensAvailable||0,tokensNeeded:It.tokensNeeded||0,feature:"ai-seo-collection",shop:L,needsUpgrade:It.needsUpgrade||!1,minimumPlan:It.minimumPlanForFeature||null,currentPlan:It.currentPlan||Ot,returnTo:"/ai-seo/collections",onBuyTokens:()=>{Ct(!1),Pt(!0)}}),t.jsx(a,{open:At,onClose:()=>{kt(!1),Et(null)},feature:It.feature||"ai-seo-collection",trialEndsAt:It.trialEndsAt,currentPlan:It.currentPlan||Ot,tokensRequired:It.tokensRequired||0,onActivatePlan:async()=>{try{const e=await T("/api/billing/activate",{method:"POST",body:JSON.stringify({shop:L,endTrial:!0,returnTo:"/ai-seo/collections"})});if(e.requiresApproval&&e.confirmationUrl)return void(window.top.location.href=e.confirmationUrl);window.location.reload()}catch(e){const t=new URLSearchParams(window.location.search),n=t.get("host"),s=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(L)}&embedded=${s}&host=${encodeURIComponent(n)}`}},onPurchaseTokens:()=>{kt(!1),Pt(!0)}})]}),t.jsx(o,{open:wt,onClose:()=>{Pt(!1),Et(null)},shop:L,returnTo:"/ai-seo/collections",inTrial:!!(null==It?void 0:It.trialEndsAt)}),gt&&t.jsx(w,{content:gt,onDismiss:()=>mt("")})]})}export{E as default};
