import{j as e}from"./app-bridge-u2nvUDWe-1760423939847.js";import{r as a}from"./react-vendor-tAaa2TlE-1760423939847.js";import{u as Yt}from"./index-BtEkjp16-1760423939847.js";import{U as Vt,I as Qt}from"./InsufficientTokensModal-Dgb7_I5x-1760423939847.js";import{M as L,d as U,T as l,e as ct,f as Ge,B as k,a as c,I as y,g as Le,D as Jt,h as Q,C as dt,i as Xt,S as Zt,P as Ae,j as Oe,R as es,k as ts,l as ut,m as ss,E as ns}from"./polaris-CEM7Crdu-1760423939847.js";const os=(b,x="")=>{try{return new URLSearchParams(window.location.search).get(b)||x}catch{return x}},pe=b=>{if(!b)return b;const x=String(b).trim();return x.startsWith("gid://")?x:`gid://shopify/Product/${x}`},rs=b=>{if(!b)return"";const x=String(b).match(/\/(\d+)$/);return x?x[1]:b},G=b=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(b==null?void 0:b.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(b==null?void 0:b.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}};function gs({shop:b,globalPlan:x}){var at,lt,it;const{api:w,shop:gt}=Yt(),i=b||gt||os("shop","");a.useEffect(()=>{},[i,w]);const[S,q]=a.useState([]),[ne,me]=a.useState(!1),[ht,He]=a.useState(1),[pt,ve]=a.useState(!0),[F,Ke]=a.useState(0),[d,oe]=a.useState([]),[C,fe]=a.useState(!1),[_,qe]=a.useState(""),[D,Se]=a.useState("all"),[T,re]=a.useState(""),[xe,as]=a.useState("createdAt"),[J,mt]=a.useState("desc"),[$,je]=a.useState([]),[ft,St]=a.useState([]),[Fe,ke]=a.useState(!1),[_e,ze]=a.useState(!1),[Ye,Te]=a.useState(!1),[Ve,Me]=a.useState(!1),[xt,jt]=a.useState(""),[yt,bt]=a.useState([]),[M,X]=a.useState([]),[A,Qe]=a.useState([]),[De,Z]=a.useState(!1),[ye,N]=a.useState({current:0,total:0,percent:0}),[Je,ee]=a.useState(""),[be,ae]=a.useState([]),[le,Xe]=a.useState({}),[wt,Re]=a.useState(!1),[Pt,we]=a.useState(!1),[Ct,ie]=a.useState(!1),[W,ce]=a.useState([]),[It,Pe]=a.useState(!1),[Ze,P]=a.useState(""),[et,tt]=a.useState(!1),[O,Y]=a.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[v,Et]=a.useState(null),[H,Ue]=a.useState(1),[Lt,Ce]=a.useState(!1),[Ie,At]=a.useState(localStorage.getItem("hasVisitedProducts")==="true"),[Ot,de]=a.useState(!1),[vt,st]=a.useState(!1),[V,ue]=a.useState(null),[te,ge]=a.useState("starter");a.useEffect(()=>{if(!(!x||typeof x!="object")){if(x.planKey&&x.planKey!==""){ge(x.planKey);const n={starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[x.planKey.toLowerCase()]||1;Ue(n)}else if(x.plan&&x.plan!==""){const t=x.plan.toLowerCase().replace(/\s+/g,"-");ge(t);const s={starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[t]||1;Ue(s)}}},[x]),a.useEffect(()=>{if(!i)return;w("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
        }
      }
    `,variables:{shop:i}})}).then(n=>{var g,h,p;if((g=n==null?void 0:n.errors)!=null&&g.length)throw new Error(((h=n.errors[0])==null?void 0:h.message)||"GraphQL error");const s=(p=n==null?void 0:n.data)==null?void 0:p.plansMe,r=(s==null?void 0:s.modelsSuggested)||["anthropic/claude-3.5-sonnet"];bt(r.map(f=>({label:f,value:f}))),jt(r[0]),Et((s==null?void 0:s.plan)||"starter"),ge((s==null?void 0:s.planKey)||"starter");const u=((s==null?void 0:s.planKey)||"starter").toLowerCase();Ue({starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[u]||1)}).catch(n=>console.error("[BULK-EDIT] GraphQL plansMe failed:",n))},[i,w]),a.useEffect(()=>{if(!i)return;const t=new Promise((n,s)=>{setTimeout(()=>s(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([w(`/api/languages/shop/${i}`),t]).then(n=>{const s=Array.isArray(n==null?void 0:n.shopLanguages)&&n.shopLanguages.length?n.shopLanguages:["en"];Qe(s.includes("en")?s:["en",...s])}).catch(n=>{console.error("[BULK-EDIT] Languages API error:",n),Qe(["en"])})},[i,w]),a.useEffect(()=>{i&&w("/api/products/tags/list",{shop:i}).then(t=>St((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[i,w]);const K=a.useCallback(async(t=1,n=!1,s=null)=>{var r,u,o,g,h;me(!0);try{const p=new URLSearchParams({shop:i,page:t,limit:50,...D!=="all"&&{optimized:D},..._&&{search:_},...T&&{languageFilter:T},...$.length>0&&{tags:$.join(",")},sortBy:xe,sortOrder:J,...s&&{_t:s}}),f=await w(`/api/products/list?${p}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((r=f.products)==null?void 0:r.length)>0,console.log("[LOAD-PRODUCTS] ===== PRODUCTS LOADED ====="),console.log("[LOAD-PRODUCTS] Total products:",(u=f.products)==null?void 0:u.length),((o=f.products)==null?void 0:o.length)>0&&f.products.forEach((j,B)=>{var m,z;console.log(`[LOAD-PRODUCTS] Product ${B}: ID=${j.id} (type: ${typeof j.id}), _id=${j._id}, title="${j.title}", has SEO: ${!!((z=(m=j.optimizationSummary)==null?void 0:m.optimizedLanguages)!=null&&z.length)}`)}),q(n?j=>[...j,...f.products]:f.products||[]),He(t),ve(((g=f.pagination)==null?void 0:g.hasNext)||!1),Ke(((h=f.pagination)==null?void 0:h.total)||0)}catch(p){q(n?S:[]),ve(!1),P(`Error loading products: ${p.message}`)}finally{me(!1)}},[i,D,_,T,$,xe,J]);a.useEffect(()=>{i&&K(1,!1,null)},[i,K,D,T,$,xe,J]),a.useEffect(()=>{!Ie&&i&&(localStorage.setItem("hasVisitedProducts","true"),At(!0))},[Ie,i]),a.useEffect(()=>{S.length===0&&!ne&&i&&!Ie&&Ce(!0)},[S.length,ne,i,Ie]),a.useEffect(()=>{console.log("[DEBUG-MONITOR] ===== STATE CHANGED ====="),console.log("[DEBUG-MONITOR] Products count:",S.length),console.log("[DEBUG-MONITOR] Selected items count:",d.length),console.log("[DEBUG-MONITOR] Products:",S.map(t=>({id:t.id,title:t.title}))),console.log("[DEBUG-MONITOR] Selected items:",d)},[S,d]);const nt=a.useCallback(t=>{qe(t)},[]);a.useEffect(()=>{const t=setTimeout(()=>{i&&K(1,!1,null)},500);return()=>clearTimeout(t)},[_]);const kt=a.useCallback(t=>{console.log("[SELECTION-CHANGE] ===== SELECTION CHANGED ====="),console.log("[SELECTION-CHANGE] New selected items:",t),console.log("[SELECTION-CHANGE] Item count:",t.length),console.log("[SELECTION-CHANGE] Item types:",t.map(n=>typeof n)),console.log("[SELECTION-CHANGE] Current products count:",S.length),console.log("[SELECTION-CHANGE] Current products IDs:",S.map(n=>n.id)),oe(t),t.length===0&&fe(!1)},[S]),ot=a.useCallback(t=>{fe(t),oe(t?S.map(n=>n.id):[])},[S]),rt=a.useMemo(()=>{var n;if(C)return M.length>H;const t=S.filter(s=>d.includes(s.id));if(t.length===0)return M.length>H;for(const s of t){const r=((n=s.optimizationSummary)==null?void 0:n.optimizedLanguages)||[],u=M.filter(g=>!r.includes(g));if(r.length+u.length>H)return!0}return!1},[S,d,C,H,M]),zt=()=>{if(d.length===0&&!C){P("Please select products first");return}we(!0)},Tt=()=>{if(d.length===0&&!C){P("Please select products first");return}ce([]),ie(!0)},Mt=async()=>{const n=S.filter(r=>d.includes(r.id)).filter(r=>{var u,o;return((o=(u=r.optimizationSummary)==null?void 0:u.optimizedLanguages)==null?void 0:o.length)>0});tt(!0),Y({processing:!0,current:0,total:n.length,currentItem:"",results:null});const s={successful:0,failed:0,skipped:0};for(let r=0;r<n.length;r++){const u=n[r];Y(o=>({...o,current:r,currentItem:u.title}));try{const o=await w("/ai-enhance/product",{method:"POST",shop:i,body:{shop:i,productId:u.gid||pe(u.id),languages:u.optimizationSummary.optimizedLanguages}});if(o.results&&o.results.length>0){const g={shop:i,productId:u.gid||pe(u.id),results:o.results.filter(p=>p.bullets&&p.faq).map(p=>({language:p.language,seo:{...p.updatedSeo,bullets:p.bullets||[],faq:p.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},h=await w("/api/seo/apply-multi",{method:"POST",shop:i,body:g});s.successful++}else s.failed++}catch(o){if(console.error("Enhancement error:",o),console.error("🔍 [DEBUG] Error details:",{status:o.status,trialRestriction:o.trialRestriction,needsUpgrade:o.needsUpgrade,requiresPurchase:o.requiresPurchase,message:o.message,currentPlan:o.currentPlan}),o.status===403){Y({processing:!1,current:0,total:0,currentItem:"",results:null}),ue({...o,message:o.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),ge(o.currentPlan||te),de(!0);return}if(o.status===402||o.requiresPurchase||o.trialRestriction){Y({processing:!1,current:0,total:0,currentItem:"",results:null}),ue(o),ge(o.currentPlan||v||"starter"),o.trialRestriction?de(!0):st(!0);return}s.failed++}Y(o=>({...o,current:r+1}))}Y(r=>({...r,processing:!1,results:s})),P(`AI enhancement complete! ${s.successful} products enhanced.`)},$e=()=>{tt(!1),Y({processing:!1,current:0,total:0,currentItem:"",results:null}),O.results&&O.results.successful>0&&K(1,!1,null)},Dt=()=>O.processing?e.jsx(L,{open:et,title:"Processing AI Enhancement",onClose:$e,noScroll:!0,children:e.jsx(L.Section,{children:e.jsxs(U,{gap:"400",children:[e.jsxs(l,{variant:"bodyMd",children:["Processing: ",O.currentItem]}),e.jsx(ct,{progress:O.current/O.total*100}),e.jsxs(l,{variant:"bodySm",tone:"subdued",children:[O.current," of ",O.total," products (",Math.round(O.current/O.total*100),"%)"]})]})})}):O.results!==null?e.jsx(L,{open:et,title:"AI Enhancement Results",onClose:$e,primaryAction:{content:"Done",onAction:$e},children:e.jsx(L.Section,{children:e.jsx(U,{gap:"300",children:e.jsxs(y,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"success",children:O.results.successful})]}),e.jsxs(c,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:O.results.failed})]}),e.jsxs(c,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"info",children:O.results.skipped})]})]})})})}):null,Rt=async()=>{var n;if(!M.length){P("Please select at least one language");return}let t=xt;(!t||!t.trim())&&(t=((n=yt[0])==null?void 0:n.value)||"anthropic/claude-3.5-sonnet"),we(!1),Z(!0),N({current:0,total:0,percent:0}),ae([]),Xe({});try{let s=[];C?s=(await w(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:s=S.filter(m=>d.includes(m.id));const r=G(v),u=s.length;s=s.slice(0,r);const o=s.length,g=u-o;N({current:0,total:o,percent:0});const h=5,p={};for(let m=0;m<s.length;m+=h){const I=s.slice(m,Math.min(m+h,s.length)).map(async E=>{var se;ee(E.title||E.handle||"Product");try{const Ee=E.gid||pe(E.productId||E.id),Ne=((se=E.optimizationSummary)==null?void 0:se.optimizedLanguages)||[],We=M.filter(_t=>!Ne.includes(_t));if(We.length===0){p[E.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Ft=await w("/api/seo/generate-multi",{method:"POST",shop:i,body:{shop:i,productId:Ee,model:t,languages:We}});p[E.id]={success:!0,data:Ft,languages:We}}catch(Ee){p[E.id]={success:!1,error:Ee.message},ae(Ne=>[...Ne,{product:E.title,error:Ee.message}])}});await Promise.all(I);const R=Math.min(m+h,s.length),he=Math.round(R/o*100);N({current:R,total:o,percent:he})}Xe(p),Re(!0);const f=Object.keys(p).filter(m=>p[m].success&&!p[m].skipped).length,j=Object.keys(p).filter(m=>p[m].skipped).length;let B=`Generated Optimization for AI Search for ${f} products`;j>0&&(B+=` (${j} already optimised)`),g>0&&(B+=` (${g} skipped due to plan limit)`),P(B)}catch(s){P(`Error: ${s.message}`)}finally{Z(!1),ee("")}},Ut=async()=>{var t,n;Z(!0),N({current:0,total:0,percent:0});try{const s=Object.entries(le).filter(([g,h])=>h.success&&!h.skipped),r=s.length;N({current:0,total:r,percent:0});for(let g=0;g<s.length;g++){const[h,p]=s[g],f=S.find(m=>m.id===h);if(!f)continue;ee(f.title||"Product");try{const m=f.gid||pe(f.productId||f.id),z=await w("/api/seo/apply-multi",{method:"POST",shop:i,body:{shop:i,productId:m,results:p.data.results.filter(I=>I==null?void 0:I.seo).map(I=>({language:I.language,seo:I.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});z.appliedLanguages&&z.appliedLanguages.length>0&&q(I=>I.map(R=>{var he;if(R.id===h){const E=((he=R.optimizationSummary)==null?void 0:he.optimizedLanguages)||[],se=[...new Set([...E,...z.appliedLanguages])];return{...R,optimizationSummary:{...R.optimizationSummary,optimizedLanguages:se,optimized:!0,lastOptimized:new Date().toISOString()}}}return R}))}catch(m){ae(z=>[...z,{product:f.title,error:`Apply failed: ${m.message}`}])}const j=g+1,B=Math.round(j/r*100);N({current:j,total:r,percent:B})}P("AI Search Optimisation applied successfully!"),Re(!1),console.log("[APPLY-SEO] ===== CLEARING SELECTION ====="),console.log("[APPLY-SEO] Selected items BEFORE clear:",d),oe([]),fe(!1),console.log("[APPLY-SEO] Selected items cleared"),console.log("[APPLY-SEO] Waiting for database propagation..."),await new Promise(g=>setTimeout(g,1e3)),console.log("[APPLY-SEO] Clearing products state before reload..."),q([]);const u=new URLSearchParams({shop:i,page:1,limit:50,...D!=="all"&&{optimized:D},..._&&{search:_},...T&&{languageFilter:T},...$.length>0&&{tags:$.join(",")},sortBy:xe,sortOrder:J,_t:Date.now()}),o=await w(`/api/products/list?${u}`,{shop:i,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});q(o.products||[]),He(1),ve(((t=o.pagination)==null?void 0:t.hasNext)||!1),Ke(((n=o.pagination)==null?void 0:n.total)||0)}catch(s){P(`Error applying AI Search Optimisation: ${s.message}`)}finally{Z(!1),ee("")}},$t=async()=>{var t;if(!W.length){P("Please select at least one language to delete");return}ie(!1),Pe(!1),Z(!0),N({current:0,total:0,percent:0}),ae([]);try{let n=[];C?n=(await w(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:n=S.filter(o=>d.includes(o.id));const s=n.length;N({current:0,total:s,percent:0});let r=0,u=0;for(let o=0;o<n.length;o++){const g=n[o];ee(g.title||g.handle||"Product");try{const f=g.gid||pe(g.productId||g.id),j=((t=g.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],B=W.filter(z=>j&&j.length>0&&j.includes(z));if(B.length===0){u++;continue}const m=await w("/api/seo/delete-multi",{method:"POST",shop:i,body:{shop:i,productId:f,languages:B}});m.deletedLanguages&&m.deletedLanguages.length>0&&q(z=>z.map(I=>{var R;if(I.id===g.id){const E=(((R=I.optimizationSummary)==null?void 0:R.optimizedLanguages)||[]).filter(se=>!m.deletedLanguages.includes(se));return{...I,optimizationSummary:{...I.optimizationSummary,optimizedLanguages:E,optimized:E.length>0,lastOptimized:E.length>0?I.optimizationSummary.lastOptimized:null}}}return I})),r++,m.deletedLanguages&&m.deletedLanguages.length>0&&await w("/api/products/verify-after-delete",{method:"POST",shop:i,body:{shop:i,productIds:[f],deletedLanguages:m.deletedLanguages}})}catch(f){ae(j=>[...j,{product:g.title,error:f.message}])}const h=o+1,p=Math.round(h/s*100);N({current:h,total:s,percent:p})}oe([]),fe(!1),u>0?P(`Deleted Optimization for AI Search from ${r} products (${u} had no optimisation to delete)`):P(`Deleted Optimization for AI Search from ${r} products`),setTimeout(()=>{const o=Date.now();K(1,!1,o)},500)}catch(n){P(`Error: ${n.message}`)}finally{Z(!1),ee("")}},Bt=t=>{var n,s;try{const r=t,u=rs(r.productId||r.id),o=((n=r.optimizationSummary)==null?void 0:n.optimizedLanguages)||[];console.log(`[BULK-EDIT-RENDER] Product: "${r.title}", ID: ${r.id}, Type: ${typeof r.id}`),console.log("[BULK-EDIT-RENDER] Optimized Languages:",o),console.log("[BULK-EDIT-RENDER] Selected Items:",d),console.log("[BULK-EDIT-RENDER] Is Selected:",d.includes(r.id));const g=(s=r.images)!=null&&s[0]?e.jsx(ut,{source:r.images[0].url||r.images[0].src||r.images[0],alt:r.title,size:"small"}):r.imageUrl?e.jsx(ut,{source:r.imageUrl,alt:r.title,size:"small"}):e.jsx(c,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(ss,{id:r.id,media:g,accessibilityLabel:`View details for ${r.title}`,onClick:h=>{console.log("[ResourceItem] ===== CLICK ON RESOURCE ITEM ====="),console.log("[ResourceItem] e.target:",h.target),console.log("[ResourceItem] e.target.tagName:",h.target.tagName),console.log('[ResourceItem] e.target.closest("input"):',h.target.closest("input")),console.log('[ResourceItem] e.target.closest("a"):',h.target.closest("a")),console.log("[ResourceItem] Event bubbling up...")},children:e.jsxs(y,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(c,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:r.title}),e.jsxs(l,{variant:"bodySm",tone:"subdued",children:["ID: ",u]})]}),e.jsx(c,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(y,{gap:"100",children:A.length>0?A.map(h=>{const p=o.includes(h);return e.jsx(Q,{tone:p?"success":"subdued",size:"small",children:h.toUpperCase()},h)}):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),o.map(h=>e.jsx(Q,{tone:"success",size:"small",children:h.toUpperCase()},h)))})}),e.jsx(c,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(Q,{tone:"success",children:"Active"})})]})})}catch(r){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",r),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},Nt=De&&e.jsx(L,{open:De,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(L.Section,{children:e.jsxs(U,{gap:"400",children:[e.jsx(l,{variant:"bodyMd",children:Je?`Processing: ${Je}`:"Preparing..."}),e.jsx(ct,{progress:ye.percent}),e.jsxs(l,{variant:"bodySm",tone:"subdued",children:[ye.current," of ",ye.total," products (",ye.percent,"%)"]})]})})}),Wt=e.jsx(L,{open:Pt,title:"Select Languages",onClose:()=>{we(!1),X([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Rt,disabled:M.length===0||rt},secondaryActions:[{content:"Cancel",onAction:()=>{we(!1),X([])}}],children:e.jsx(L.Section,{children:e.jsxs(U,{gap:"300",children:[e.jsxs(l,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",C?"all":d.length," selected products:"]}),rt&&e.jsx(Ge,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(U,{gap:"200",children:[e.jsxs(l,{variant:"bodyMd",children:["Your ",te," plan supports up to ",H," language",H>1?"s":""," per product.",d.length===1&&((it=(lt=(at=S.find(t=>t.id===d[0]))==null?void 0:at.optimizationSummary)==null?void 0:lt.optimizedLanguages)==null?void 0:it.length)>0&&e.jsxs(e.Fragment,{children:[" This product already has ",S.find(t=>t.id===d[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(l,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(k,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),n=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${n}`},children:"Upgrade Plan"})]})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:A.map(t=>e.jsx(Le,{label:t.toUpperCase(),checked:M.includes(t),onChange:n=>{X(n?[...M,t]:M.filter(s=>s!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{M.length===A.length?X([]):A.length>H?(X([...A]),P(`You selected ${A.length} languages. Your ${te} plan supports ${H}. Please deselect or upgrade.`)):X([...A])},children:M.length===A.length?"Deselect all":"Select all"})}),e.jsx(l,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Gt=e.jsx(L,{open:wt&&!De,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:Ut,disabled:!Object.values(le).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Re(!1)}],children:e.jsx(L.Section,{children:e.jsxs(U,{gap:"300",children:[e.jsxs(y,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(le).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(le).filter(t=>t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(le).filter(t=>!t.success).length})]})]}),be.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Jt,{}),e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(c,{maxHeight:"200px",overflowY:"scroll",children:[be.slice(0,10).map((t,n)=>e.jsxs(l,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},n)),be.length>10&&e.jsxs(l,{variant:"bodySm",tone:"subdued",children:["... and ",be.length-10," more errors"]})]})]})]})})}),Ht=e.jsx(L,{open:Ct,title:"Delete Optimization for AI Search",onClose:()=>{ie(!1),ce([])},primaryAction:{content:"Continue",onAction:()=>{ie(!1),Pe(!0)},disabled:W.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{ie(!1),ce([])}}],children:e.jsx(L.Section,{children:e.jsxs(U,{gap:"300",children:[e.jsxs(l,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",C?"all":d.length," selected products:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:A.map(t=>e.jsx(Le,{label:t.toUpperCase(),checked:W.includes(t),onChange:n=>{ce(n?[...W,t]:W.filter(s=>s!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{ce(W.length===A.length?[]:[...A])},children:W.length===A.length?"Deselect all":"Select all"})}),e.jsx(l,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Kt=e.jsx(L,{open:It,title:"Confirm Deletion",onClose:()=>{Pe(!1)},primaryAction:{content:"Delete",onAction:$t,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>Pe(!1)}],children:e.jsx(L.Section,{children:e.jsxs(U,{gap:"300",children:[e.jsx(l,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(c,{paddingBlock:"200",children:e.jsx(y,{gap:"100",children:W.map(t=>e.jsx(Q,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(l,{variant:"bodyMd",children:["This will delete optimisation from ",C?"ALL":d.length," selected products."]}),e.jsx(l,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Be=async()=>{try{me(!0),P("Syncing products from Shopify...");const t=await w("/api/products/sync",{method:"POST",shop:i});if(t.success){const n=t.productsCount||t.synced||0;P(`✅ Synced ${n} products successfully!`),setTimeout(()=>{K(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),P(`❌ Sync failed: ${t.message}`)}finally{me(!1)}},qt=e.jsx(ns,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{qe(""),Se("all"),re(""),je([]),K(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Be},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(dt,{children:e.jsxs(c,{padding:"400",children:[e.jsxs(U,{gap:"300",children:[v&&e.jsx(Ge,{tone:"info",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(l,{children:["Your ",e.jsx("strong",{children:v})," plan includes up to"," ",e.jsx("strong",{children:G(v)})," products for SEO optimization.",F>G(v)&&e.jsxs(e.Fragment,{children:[" You have ",F," products, so only the first ",G(v)," will be processed."]})]}),(d.length>0||C)&&e.jsxs(l,{children:["Selected: ",C?Math.min(F,G(v)):d.length,"/",G(v)]})]})}),v&&(d.length>G(v)||C&&F>G(v))&&e.jsx(Ge,{tone:"warning",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(l,{children:[e.jsx("strong",{children:"Plan Limit Exceeded:"})," You've selected more products than your ",v," plan allows. Only the first ",G(v)," products will be processed."]}),e.jsx(k,{size:"micro",onClick:()=>de(!0),children:"Upgrade Plan"})]})}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(c,{minWidth:"400px",children:e.jsx(Xt,{label:"",placeholder:"Search by product ID, name, or details...",value:_,onChange:nt,prefix:e.jsx(Zt,{}),clearButton:!0,onClearButtonClick:()=>nt("")})}),e.jsx(c,{width:"320px",children:e.jsx(k,{primary:!0,onClick:zt,disabled:d.length===0&&!C,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(k,{onClick:Be,disabled:ne,size:"medium",children:"Sync Products"}),e.jsx(c,{width:"320px",children:e.jsxs(U,{gap:"200",align:"end",children:[(()=>{if(d.length===0&&!C||!S.filter(r=>d.includes(r.id)).some(r=>{var u,o;return((o=(u=r.optimizationSummary)==null?void 0:u.optimizedLanguages)==null?void 0:o.length)>0}))return null;const s=["professional","growth","growth_extra","growth extra","enterprise"].includes(te.toLowerCase().replace(/_/g," "));return e.jsx(k,{onClick:s?Mt:()=>{ue({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),de(!0)},disabled:d.length===0&&!C,size:"medium",fullWidth:!0,children:s?"AI Enhanced add-ons for AI Search":"✨ AI Enhanced add-ons"})})(),e.jsx(k,{onClick:Tt,disabled:d.length===0&&!C||!S.filter(s=>d.includes(s.id)).some(s=>{var r,u;return((u=(r=s.optimizationSummary)==null?void 0:r.optimizedLanguages)==null?void 0:u.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),F>0&&e.jsx(c,{paddingBlockStart:"300",children:e.jsx(Le,{label:`Select all ${F} products in your store`,checked:C,onChange:ot})})]})}),e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(dt,{children:[e.jsxs(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(y,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(y,{gap:"200",wrap:!0,children:[e.jsx(Ae,{active:Fe,activator:e.jsx(k,{disclosure:"down",onClick:()=>ke(!Fe),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),D!=="all"&&e.jsx(c,{onClick:t=>{t.stopPropagation(),Se("all")},children:e.jsx(l,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ke(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Oe,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[D],onChange:t=>{Se(t[0]),re(""),ke(!1)}})})}),e.jsx(Ae,{active:_e,activator:e.jsx(k,{disclosure:"down",onClick:()=>ze(!_e),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),T&&e.jsx(c,{onClick:t=>{t.stopPropagation(),re("")},children:e.jsx(l,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ze(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Oe,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...A.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...A.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:T?[T]:[],onChange:t=>{re(t[0]||""),ze(!1)}})})}),e.jsx(Ae,{active:Ye,activator:e.jsx(k,{disclosure:"down",onClick:()=>Te(!Ye),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),$.length>0&&e.jsx(c,{onClick:t=>{t.stopPropagation(),je([])},children:e.jsx(l,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Te(!1),children:e.jsxs(c,{padding:"300",minWidth:"200px",children:[e.jsx(Oe,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:ft.map(t=>({label:t,value:t})),selected:$,onChange:t=>{je(t)}}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(k,{size:"slim",onClick:()=>Te(!1),children:"Apply"})})]})})]}),e.jsx(Ae,{active:Ve,activator:e.jsx(k,{disclosure:"down",onClick:()=>Me(!Ve),removeUnderline:!0,children:e.jsx(y,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:J==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Me(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Oe,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[J],onChange:t=>{mt(t[0]),Me(!1)}})})})]}),(D!=="all"||T||$.length>0)&&e.jsx(c,{paddingBlockStart:"200",children:e.jsxs(y,{gap:"100",wrap:!0,children:[D!=="all"&&e.jsx(Q,{onRemove:()=>Se("all"),children:D==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),T&&e.jsx(Q,{onRemove:()=>re(""),children:T.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),$.map(t=>e.jsxs(Q,{onRemove:()=>je(n=>n.filter(s=>s!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(c,{children:[e.jsx(c,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(y,{gap:"200",align:"start",children:[e.jsx(Le,{checked:d.length===S.length&&S.length>0,onChange:ot,label:""}),e.jsxs(l,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",d.length>0&&` (${d.length} selected products)`]})]})}),e.jsx(es,{resourceName:{singular:"product",plural:"products"},items:S,renderItem:Bt,selectedItems:d,onSelectionChange:kt,selectable:!0,loading:ne,totalItemsCount:F,emptyState:qt,showHeader:!1},`products-${S.length}-${d.length}`)]}),pt&&!ne&&e.jsx(c,{padding:"400",textAlign:"center",children:e.jsx(k,{onClick:()=>K(ht+1,!0,null),children:"Load more"})})]})}),Nt,Wt,Gt,Ht,Kt,Dt(),e.jsx(L,{open:Lt,onClose:()=>Ce(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Ce(!1),Be()}},secondaryActions:[{content:"Skip for now",onAction:()=>Ce(!1)}],children:e.jsx(L.Section,{children:e.jsxs(U,{gap:"300",children:[e.jsx(l,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(l,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Vt,{open:Ot,onClose:()=>{de(!1),ue(null)},featureName:"AI Enhancement",currentPlan:te}),V&&e.jsx(Qt,{open:vt,onClose:()=>{st(!1),ue(null)},tokensRequired:V.tokensRequired||0,tokensAvailable:V.tokensAvailable||0,tokensNeeded:V.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:i,needsUpgrade:V.needsUpgrade||!1,minimumPlan:V.minimumPlanForFeature||null,currentPlan:V.currentPlan||te}),Ze&&e.jsx(ts,{content:Ze,onDismiss:()=>P("")})]})}export{gs as default};
