import{r as e,j as n}from"./react-vendor-BXVC7v0l.js";import{m as a}from"./sessionFetch-3kEXRUag.js";import"./usePlanHierarchy-fXt-6sDq.js";import{T as s,I as t,a as i}from"./TokenPurchaseModal-DnK58cDo.js";import{U as o}from"./UpgradeModal-DYlOzGkq.js";import{e as r}from"./tokenEstimates-Dgf19ZiR.js";import{C as c,B as d,a as l,i as h,T as u,d as p,t as m,I as g,f as j,D as S,b as v,u as f,l as x,M as _}from"./polaris-LiLfZG0r.js";import"./app-bridge-DUY42B6P.js";import"./vendor-Cs_VgJ2r.js";import"./index-BSAw-dAE.js";const y=(e,n="")=>{try{return new URLSearchParams(window.location.search).get(e)||n}catch{return n}};function b({shop:b}){const O=b||y("shop","");y("shop","");const[A,w]=e.useState(0),[P,I]=e.useState(!0),[k,E]=e.useState({organization:null,website:null,products:[]}),[C,T]=e.useState(""),D=e.useMemo(()=>a(),[]),[N,q]=e.useState(""),[M,B]=e.useState(null),[R,$]=e.useState(null),[L,U]=e.useState(null),[z,F]=e.useState(0),[G,J]=e.useState({inProgress:!1,status:"idle",message:null,position:null,estimatedTime:null,generatedAt:null,schemaCount:0}),[Y,Z]=e.useState(null),[Q,W]=e.useState(!1),[V,K]=e.useState(!1),[X,H]=e.useState({}),[ee,ne]=e.useState(!1),[ae,se]=e.useState(!1),[te,ie]=e.useState(!1),[oe,re]=e.useState(null),[ce,de]=e.useState(!1),[le,he]=e.useState(null);e.useEffect(()=>{O&&(je(),ue(),pe())},[O,D]),e.useEffect(()=>()=>{Y&&clearInterval(Y)},[Y]);const ue=async()=>{var e,n,a,s,t;try{const o="\n        query PlansMe($shop:String!) {\n          plansMe(shop:$shop) {\n            shop\n            plan\n            planKey\n            trialEndsAt\n            activatedAt\n          }\n        }\n      ",r=await D("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:o,variables:{shop:O}})});B(null==(n=null==(e=null==r?void 0:r.data)?void 0:e.plansMe)?void 0:n.plan),$(null==(s=null==(a=null==r?void 0:r.data)?void 0:a.plansMe)?void 0:s.planKey),U(null==(t=null==r?void 0:r.data)?void 0:t.plansMe);try{const e=await D(`/api/ai-discovery/settings?shop=${O}`);F((null==e?void 0:e.productCount)||0)}catch(i){}}catch(o){}},pe=e.useCallback(async()=>{var e,n,a,s,t;try{const i=await D(`/api/schema/status?shop=${O}`);return J({inProgress:i.inProgress||!1,status:i.status||"idle",message:i.message||null,position:(null==(e=i.queue)?void 0:e.position)||null,estimatedTime:(null==(n=i.queue)?void 0:n.estimatedTime)||null,generatedAt:(null==(a=i.schema)?void 0:a.generatedAt)||null,schemaCount:(null==(s=i.schema)?void 0:s.schemaCount)||0}),"completed"!==i.status||i.inProgress||(Y&&(clearInterval(Y),Z(null)),G.inProgress&&T(`Advanced Schema Data generated! (${(null==(t=i.schema)?void 0:t.schemaCount)||0} schemas)`)),"failed"===i.status&&(Y&&(clearInterval(Y),Z(null)),"NO_OPTIMIZED_PRODUCTS"===i.message?(he("NO_OPTIMIZED_PRODUCTS"),de(!0)):"ONLY_BASIC_SEO"===i.message&&(he("ONLY_BASIC_SEO"),de(!0))),i}catch(i){}},[O,D,Y,G.inProgress]),me=e.useCallback(()=>{Y&&clearInterval(Y),pe();const e=setInterval(()=>{pe()},1e4);Z(e)},[pe,Y]),ge=async(e=!1)=>{W(!0);try{const a=(R||M||"starter").toLowerCase().replace(/\s+/g,"_"),s=["professional_plus","growth_plus","starter_plus"],t=["growth_extra","enterprise"].includes(a),i=s.includes(a),o=r("ai-schema-advanced",{productCount:z||0}).withMargin;if(!t&&!i)return H({feature:"Advanced Schema Data",currentPlan:M,requiredPlan:"Professional Plus, Growth Plus, Growth Extra, or Enterprise",tokensRequired:o}),K(!0),void W(!1);if(i)try{const e=await D(`/api/billing/tokens/balance?shop=${O}`),n=(null==e?void 0:e.balance)||0;if(n<o)return re({feature:"ai-schema-advanced",tokensRequired:o,tokensAvailable:n,tokensNeeded:o-n}),se(!0),void W(!1)}catch(n){}const c=await D(`/api/schema/generate-all?shop=${O}`,{method:"POST",body:{shop:O,forceBasicSeo:e}});c.queued?(T("Advanced Schema generation started..."),me()):c.error&&("NO_OPTIMIZED_PRODUCTS"===c.error?(he("NO_OPTIMIZED_PRODUCTS"),de(!0)):"ONLY_BASIC_SEO"===c.error?(he("ONLY_BASIC_SEO"),de(!0)):T(`Error: ${c.error}`))}catch(a){402===a.status?a.trialRestriction&&a.requiresActivation?(re(a),ne(!0)):a.requiresPurchase?(re(a),se(!0)):T(a.message||"Payment required"):403===a.status?(H({feature:"Advanced Schema Data",currentPlan:M,requiredPlan:"Professional Plus, Growth Plus, Growth Extra, or Enterprise"}),K(!0)):400===a.status?"NO_OPTIMIZED_PRODUCTS"===a.error?(he("NO_OPTIMIZED_PRODUCTS"),de(!0)):"ONLY_BASIC_SEO"===a.error?(he("ONLY_BASIC_SEO"),de(!0)):T(a.message||"Error generating schema"):T(`Error: ${a.message}`)}finally{W(!1)}},je=async()=>{I(!0);try{const e=`/api/schema/preview?shop=${encodeURIComponent(O)}`,n=await D(e,{headers:{"X-Shop":O}});n.ok?(E(n.schemas),Se(n.schemas)):T(`Error: ${n.error}`)}catch(e){T(`Failed to load schemas: ${e.message}`)}finally{I(!1)}},Se=e=>{const n=[];e.organization&&n.push(e.organization),e.website&&n.push(e.website);const a=`<script type="application/ld+json">\n${JSON.stringify(n,null,2)}\n<\/script>`;q(a)};return P?n.jsx(c,{children:n.jsx(d,{padding:"400",children:n.jsxs(l,{gap:"400",align:"center",children:[n.jsx(h,{}),n.jsx(u,{children:"Loading schema data..."})]})})}):n.jsxs(n.Fragment,{children:[n.jsx(c,{children:n.jsx(d,{padding:"400",children:n.jsxs(l,{gap:"400",children:[n.jsx(u,{as:"h3",variant:"headingMd",children:"Schema.org Structured Data"}),n.jsx(p,{tone:"info",children:n.jsx(u,{children:"Schema.org structured data helps AI models understand your store content better, improving your visibility and search results."})}),n.jsxs(m,{tabs:[{id:"overview",content:"Overview",accessibilityLabel:"Overview"},{id:"installation",content:"Installation",accessibilityLabel:"Installation"}],selected:A,onSelect:w,children:[0===A&&n.jsx(d,{paddingBlockStart:"400",children:n.jsxs(l,{gap:"400",children:[n.jsx(c,{children:n.jsx(d,{padding:"300",children:n.jsxs(l,{gap:"300",children:[n.jsxs(g,{align:"space-between",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"Organization Schema"}),n.jsx(j,{tone:k.organization?"success":"warning",children:k.organization?"Active":"Not configured"})]}),!k.organization&&n.jsx(u,{as:"p",tone:"subdued",children:"Configure organization details in Store Metadata to enable this schema."})]})})}),n.jsx(c,{children:n.jsx(d,{padding:"300",children:n.jsxs(l,{gap:"300",children:[n.jsxs(g,{align:"space-between",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"WebSite Schema"}),n.jsx(j,{tone:k.website?"success":"warning",children:k.website?"Active":"Not configured"})]}),!k.website&&n.jsx(u,{as:"p",tone:"subdued",children:"Website schema is automatically generated from your store information."})]})})}),n.jsx(c,{children:n.jsx(d,{padding:"300",children:n.jsxs(l,{gap:"300",children:[n.jsxs(g,{align:"space-between",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"Product Schemas"}),n.jsx(j,{tone:"success",children:"Auto-generated"})]}),n.jsxs(u,{tone:"subdued",children:["Product schemas are automatically generated from your AI Optimisation data when pages load.",k.products.length>0&&` ${k.products.length} products have SEO data.`]})]})})}),n.jsx(S,{}),n.jsx(c,{children:n.jsx(d,{padding:"300",children:n.jsxs(l,{gap:"300",children:[n.jsxs(g,{align:"space-between",blockAlign:"center",children:[n.jsxs(l,{gap:"100",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"Advanced Schema Data"}),n.jsx(u,{variant:"bodySm",tone:"subdued",children:"BreadcrumbList, FAQPage, AggregateRating & more AI-generated schemas"})]}),"completed"===G.status&&G.generatedAt?n.jsx(j,{tone:"success",children:"Generated"}):G.inProgress?n.jsx(j,{tone:"attention",children:"Generating..."}):n.jsx(j,{tone:"info",children:"Not generated"})]}),G.inProgress&&n.jsx(d,{paddingBlockStart:"200",children:n.jsxs(g,{gap:"200",blockAlign:"center",children:[n.jsx(h,{size:"small"}),n.jsxs(l,{gap:"100",children:[n.jsx(u,{variant:"bodyMd",tone:"subdued",children:G.message||"Generating schema data..."}),G.position>0&&n.jsxs(u,{variant:"bodySm",tone:"subdued",children:["Queue position: ",G.position," · Est. ",Math.ceil(G.estimatedTime/60)," min"]})]})]})}),!G.inProgress&&"completed"===G.status&&G.generatedAt&&n.jsx(d,{paddingBlockStart:"200",children:n.jsx(g,{gap:"200",blockAlign:"center",children:n.jsxs(u,{variant:"bodySm",tone:"subdued",children:[G.schemaCount," schemas · ",(e=>{if(!e)return"";const n=new Date,a=new Date(e),s=Math.floor((n-a)/1e3/60);if(s<1)return"Just now";if(s<60)return`${s} min ago`;const t=Math.floor(s/60);if(t<24)return`${t}h ago`;return`${Math.floor(t/24)}d ago`})(G.generatedAt)]})})}),n.jsx(d,{paddingBlockStart:"200",children:n.jsx(g,{gap:"200",children:n.jsx(v,{onClick:()=>ge(!1),loading:Q,disabled:G.inProgress,children:"completed"===G.status?"Regenerate Advanced Schemas":"Generate Advanced Schemas"})})}),n.jsx(d,{paddingBlockStart:"100",children:n.jsx(u,{variant:"bodySm",tone:"subdued",children:"✓ AI-generated FAQ schemas · ✓ Aggregate ratings · ✓ Enhanced product data · ✓ Better AI visibility"})})]})})}),n.jsxs(g,{gap:"300",children:[n.jsx(v,{onClick:async()=>{I(!0);try{const e=`/api/schema/generate?shop=${encodeURIComponent(O)}`,n=await D(e,{method:"POST",headers:{"X-Shop":O},body:{shop:O}});n.ok?(T("Schemas regenerated successfully!"),je()):T(`Error: ${n.error}`)}catch(e){T(`Failed to regenerate: ${e.message}`)}finally{I(!1)}},loading:P,children:"Regenerate Basic Schemas"}),n.jsx(v,{variant:"plain",url:"https://developers.google.com/search/docs/appearance/structured-data",children:"Learn about Schema.org"})]})]})}),1===A&&n.jsx(d,{paddingBlockStart:"400",children:n.jsxs(l,{gap:"400",children:[n.jsx(p,{tone:"info",children:n.jsxs(l,{gap:"300",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"Theme Installation"}),n.jsxs(f,{type:"number",children:[n.jsx(f.Item,{children:"Go to your Shopify Admin → Online Store → Themes"}),n.jsx(f.Item,{children:'Click "Actions" → "Edit code" on your current theme'}),n.jsxs(f.Item,{children:["Open the file: ",n.jsx("code",{children:"layout/theme.liquid"})]}),n.jsxs(f.Item,{children:["Add this code before the closing ",n.jsx("code",{children:"</head>"})," tag:"]})]})]})}),n.jsx(c,{children:n.jsx(d,{padding:"300",children:n.jsxs(l,{gap:"300",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"Code to Install"}),n.jsx(d,{background:"bg-surface-secondary",padding:"200",borderRadius:"200",children:n.jsx("pre",{style:{fontSize:"12px",overflow:"auto",whiteSpace:"pre-wrap"},children:'{%- comment -%} Advanced Schema Data - Auto-generated by indexAIze - Unlock AI Search {%- endcomment -%}\n\n{%- comment -%} Organization & WebSite Schema (site-wide) {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.shop_schemas -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.shop_schemas.value }}\n  <\/script>\n{%- endif -%}\n\n{%- comment -%} Product Schema (product pages only) {%- endcomment -%}\n{%- if product -%}\n  {%- comment -%} Try Advanced Schema first (requires tokens/Enterprise plan) {%- endcomment -%}\n  {%- assign schema_key = \'schemas_\' | append: request.locale.iso_code -%}\n  {%- assign schemas_json = product.metafields.advanced_schema[schema_key].value -%}\n  {%- if schemas_json -%}\n    <script type="application/ld+json">\n{{ schemas_json }}\n    <\/script>\n  {%- else -%}\n    {%- comment -%} Fallback to basic SEO JSON-LD (available for all plans) {%- endcomment -%}\n    {%- assign seo_key = \'seo__\' | append: request.locale.iso_code -%}\n    {%- assign seo_data_json = product.metafields.seo_ai[seo_key].value | default: product.metafields.seo_ai.seo__en.value -%}\n    {%- if seo_data_json -%}\n      <script type="application/ld+json" id="seo-basic-jsonld-{{ product.id }}">\n      <\/script>\n      <script>\n        (function() {\n          try {\n            var seoData = JSON.parse({{ seo_data_json | json }});\n            if (seoData && seoData.jsonLd) {\n              var scriptTag = document.getElementById(\'seo-basic-jsonld-{{ product.id }}\');\n              if (scriptTag) {\n                scriptTag.textContent = JSON.stringify(seoData.jsonLd);\n              }\n            }\n          } catch(e) {\n            console.error(\'Failed to parse SEO JSON-LD:\', e);\n          }\n        })();\n      <\/script>\n    {%- endif -%}\n  {%- endif -%}\n{%- endif -%}\n\n{%- comment -%} Site-wide FAQ Schema {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.site_faq -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.site_faq.value }}\n  <\/script>\n{%- endif -%}'})}),n.jsx(g,{align:"end",children:n.jsx(v,{onClick:()=>{navigator.clipboard.writeText('{%- comment -%} Advanced Schema Data - Auto-generated by indexAIze - Unlock AI Search {%- endcomment -%}\n\n{%- comment -%} Organization & WebSite Schema (site-wide) {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.shop_schemas -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.shop_schemas.value }}\n  <\/script>\n{%- endif -%}\n\n{%- comment -%} Product Schema (product pages only) {%- endcomment -%}\n{%- if product -%}\n  {%- comment -%} Try Advanced Schema first (requires tokens/Enterprise plan) {%- endcomment -%}\n  {%- assign schema_key = \'schemas_\' | append: request.locale.iso_code -%}\n  {%- assign schemas_json = product.metafields.advanced_schema[schema_key].value -%}\n  {%- if schemas_json -%}\n    <script type="application/ld+json">\n{{ schemas_json }}\n    <\/script>\n  {%- else -%}\n    {%- comment -%} Fallback to basic SEO JSON-LD (available for all plans) {%- endcomment -%}\n    {%- assign seo_key = \'seo__\' | append: request.locale.iso_code -%}\n    {%- assign seo_data_json = product.metafields.seo_ai[seo_key].value | default: product.metafields.seo_ai.seo__en.value -%}\n    {%- if seo_data_json -%}\n      <script type="application/ld+json" id="seo-basic-jsonld-{{ product.id }}">\n      <\/script>\n      <script>\n        (function() {\n          try {\n            var seoData = JSON.parse({{ seo_data_json | json }});\n            if (seoData && seoData.jsonLd) {\n              var scriptTag = document.getElementById(\'seo-basic-jsonld-{{ product.id }}\');\n              if (scriptTag) {\n                scriptTag.textContent = JSON.stringify(seoData.jsonLd);\n              }\n            }\n          } catch(e) {\n            console.error(\'Failed to parse SEO JSON-LD:\', e);\n          }\n        })();\n      <\/script>\n    {%- endif -%}\n  {%- endif -%}\n{%- endif -%}\n\n{%- comment -%} Site-wide FAQ Schema {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.site_faq -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.site_faq.value }}\n  <\/script>\n{%- endif -%}'),T("Code copied to clipboard!")},children:"Copy Code"})}),n.jsx(p,{tone:"warning",children:n.jsx(u,{children:"Always backup your theme before making changes!"})})]})})}),n.jsx(c,{children:n.jsx(d,{padding:"300",children:n.jsxs(l,{gap:"300",children:[n.jsx(u,{as:"h4",variant:"headingSm",children:"Testing Your Installation"}),n.jsxs(f,{children:[n.jsx(f.Item,{children:"After installation, visit your store's homepage and product pages"}),n.jsx(f.Item,{children:"View the page source (right-click → View Source)"}),n.jsxs(f.Item,{children:["Search for ",n.jsx("code",{children:"application/ld+json"})," to find your schemas"]}),n.jsx(f.Item,{children:"Use the Validation tab to test with Google's tools"})]})]})})})]})})]})]})})}),C&&n.jsx(x,{content:C,onDismiss:()=>T("")}),n.jsx(o,{open:V,onClose:()=>K(!1),feature:X.feature,currentPlan:X.currentPlan,requiredPlan:X.requiredPlan,returnTo:"/ai-seo/schema-data"}),n.jsx(s,{open:ee,onClose:()=>ne(!1),onActivate:async()=>{try{const e=await D(`/api/billing/activate?shop=${O}`,{method:"POST",body:{shop:O,endTrial:!0,returnTo:window.location.pathname}});e.confirmationUrl?window.top.location.href=e.confirmationUrl:e.success&&(ne(!1),T("Plan activated! You can now generate Advanced Schema Data."),setTimeout(()=>ge(),1e3))}catch(e){T("Failed to activate plan")}},feature:"Advanced Schema Data",tokensRequired:(null==oe?void 0:oe.tokensRequired)||r("ai-schema-advanced",{productCount:z}).withMargin}),n.jsx(t,{open:ae,onClose:()=>se(!1),onPurchase:()=>{se(!1),ie(!0)},feature:"ai-schema-advanced",tokensRequired:(null==oe?void 0:oe.tokensRequired)||0,tokensAvailable:(null==oe?void 0:oe.tokensAvailable)||0,tokensNeeded:(null==oe?void 0:oe.tokensNeeded)||(null==oe?void 0:oe.tokensRequired)||0}),n.jsx(i,{open:te,onClose:()=>ie(!1),tokensNeeded:(null==oe?void 0:oe.tokensNeeded)||0,returnTo:"/ai-seo/schema-data"}),n.jsx(_,{open:ce,onClose:()=>de(!1),title:"NO_OPTIMIZED_PRODUCTS"===le?"No Optimized Products":"Only Basic SEO Found",primaryAction:"ONLY_BASIC_SEO"===le?{content:"Generate with Basic SEO",onAction:()=>{de(!1),ge(!0)}}:{content:"Go to Products",onAction:()=>{de(!1);const e=new URLSearchParams(window.location.search);window.location.href=`/ai-seo/bulk-edit?shop=${O}&host=${e.get("host")}&embedded=${e.get("embedded")}`}},secondaryActions:[{content:"Cancel",onAction:()=>de(!1)}],children:n.jsx(_.Section,{children:"NO_OPTIMIZED_PRODUCTS"===le?n.jsx(u,{children:"Advanced Schema Data requires products with AI Search Optimisation. Please run Basic or AI Enhanced SEO on your products first."}):n.jsxs(l,{gap:"200",children:[n.jsx(u,{children:"Your products only have Basic SEO optimisation. For best results, we recommend using AI Enhanced SEO which provides richer data for schemas."}),n.jsx(u,{tone:"subdued",children:"You can still generate Advanced Schemas using Basic SEO data, but the results may be less comprehensive."})]})})})]})}export{b as default};
