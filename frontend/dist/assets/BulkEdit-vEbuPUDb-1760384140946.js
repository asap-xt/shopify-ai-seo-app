import{j as e}from"./app-bridge-COcKIT1q-1760384140946.js";import{r}from"./react-vendor-tAaa2TlE-1760384140946.js";import{u as Ft}from"./index-CtNoD_Gi-1760384140946.js";import{U as qt,I as Yt}from"./InsufficientTokensModal-Dza8aIhS-1760384140946.js";import{M as A,d as $,T as i,e as ot,f as We,B as T,a as d,I as y,g as Le,D as _t,h as V,C as rt,i as Vt,S as Qt,P as be,j as Ae,R as Jt,k as Xt,l as at,m as Zt,E as es}from"./polaris-9YxoMwNT-1760384140946.js";const ts=(E,u="")=>{try{return new URLSearchParams(window.location.search).get(E)||u}catch{return u}},ue=E=>{if(!E)return E;const u=String(E).trim();return u.startsWith("gid://")?u:`gid://shopify/Product/${u}`},ss=E=>{if(!E)return"";const u=String(E).match(/\/(\d+)$/);return u?u[1]:E},K=E=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(E==null?void 0:E.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(E==null?void 0:E.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}};function cs({shop:E,globalPlan:u}){const{api:C,shop:it}=Ft(),l=E||it||ts("shop","");r.useEffect(()=>{},[l,C]);const[x,F]=r.useState([]),[ne,pe]=r.useState(!1),[lt,Ge]=r.useState(1),[ct,Oe]=r.useState(!0),[q,Ke]=r.useState(0),[p,oe]=r.useState([]),[I,he]=r.useState(!1),[Y,He]=r.useState(""),[D,ge]=r.useState("all"),[z,re]=r.useState(""),[me,ns]=r.useState("createdAt"),[Q,dt]=r.useState("desc"),[B,fe]=r.useState([]),[ut,pt]=r.useState([]),[Fe,Pe]=r.useState(!1),[qe,ve]=r.useState(!1),[Ye,Te]=r.useState(!1),[_e,ke]=r.useState(!1),[ht,gt]=r.useState(""),[mt,ft]=r.useState([]),[M,J]=r.useState([]),[O,Ve]=r.useState([]),[ze,X]=r.useState(!1),[Se,W]=r.useState({current:0,total:0,percent:0}),[Qe,Z]=r.useState(""),[xe,ae]=r.useState([]),[ie,Je]=r.useState({}),[St,Me]=r.useState(!1),[xt,je]=r.useState(!1),[jt,le]=r.useState(!1),[G,ce]=r.useState([]),[yt,ye]=r.useState(!1),[Xe,w]=r.useState(""),[Ze,Et]=r.useState(!1),[P,ee]=r.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[v,Ct]=r.useState(null),[R,wt]=r.useState(1),[It,Ee]=r.useState(!1),[Ce,Lt]=r.useState(localStorage.getItem("hasVisitedProducts")==="true"),[bt,De]=r.useState(!1),[At,et]=r.useState(!1),[_,Re]=r.useState(null),[te,we]=r.useState("starter");r.useEffect(()=>{if(console.log("[BULK-EDIT] globalPlan changed:",u),u!=null&&u.planKey)console.log("[BULK-EDIT] Updating currentPlan from globalPlan.planKey:",u.planKey),we(u.planKey);else if(u!=null&&u.plan){const t=u.plan.toLowerCase().replace(/\s+/g,"-");console.log("[BULK-EDIT] planKey missing, deriving from plan name:",t),we(t)}},[u==null?void 0:u.planKey,u==null?void 0:u.plan]),r.useEffect(()=>{if(!l)return;C("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
        }
      }
    `,variables:{shop:l}})}).then(n=>{var h,g,m;if((h=n==null?void 0:n.errors)!=null&&h.length)throw new Error(((g=n.errors[0])==null?void 0:g.message)||"GraphQL error");const s=(m=n==null?void 0:n.data)==null?void 0:m.plansMe,o=(s==null?void 0:s.modelsSuggested)||["anthropic/claude-3.5-sonnet"];ft(o.map(S=>({label:S,value:S}))),gt(o[0]),Ct((s==null?void 0:s.plan)||"starter"),we((s==null?void 0:s.planKey)||"starter");const c=((s==null?void 0:s.planKey)||"starter").toLowerCase();wt({starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[c]||1)}).catch(n=>console.error("[BULK-EDIT] GraphQL plansMe failed:",n))},[l,C]),r.useEffect(()=>{if(!l)return;const t=new Promise((n,s)=>{setTimeout(()=>s(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([C(`/api/languages/shop/${l}`),t]).then(n=>{const s=Array.isArray(n==null?void 0:n.shopLanguages)&&n.shopLanguages.length?n.shopLanguages:["en"];Ve(s.includes("en")?s:["en",...s])}).catch(n=>{console.error("[BULK-EDIT] Languages API error:",n),Ve(["en"])})},[l,C]),r.useEffect(()=>{l&&C("/api/products/tags/list",{shop:l}).then(t=>pt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[l,C]);const H=r.useCallback(async(t=1,n=!1,s=null)=>{var o,c,a,h,g;pe(!0);try{const m=new URLSearchParams({shop:l,page:t,limit:50,...D!=="all"&&{optimized:D},...Y&&{search:Y},...z&&{languageFilter:z},...B.length>0&&{tags:B.join(",")},sortBy:me,sortOrder:Q,...s&&{_t:s}}),S=await C(`/api/products/list?${m}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((o=S.products)==null?void 0:o.length)>0,console.log("[LOAD-PRODUCTS] ===== PRODUCTS LOADED ====="),console.log("[LOAD-PRODUCTS] Total products:",(c=S.products)==null?void 0:c.length),((a=S.products)==null?void 0:a.length)>0&&S.products.forEach((j,N)=>{var f,k;console.log(`[LOAD-PRODUCTS] Product ${N}: ID=${j.id} (type: ${typeof j.id}), _id=${j._id}, title="${j.title}", has SEO: ${!!((k=(f=j.optimizationSummary)==null?void 0:f.optimizedLanguages)!=null&&k.length)}`)}),F(n?j=>[...j,...S.products]:S.products||[]),Ge(t),Oe(((h=S.pagination)==null?void 0:h.hasNext)||!1),Ke(((g=S.pagination)==null?void 0:g.total)||0)}catch(m){F(n?x:[]),Oe(!1),w(`Error loading products: ${m.message}`)}finally{pe(!1)}},[l,D,Y,z,B,me,Q]);r.useEffect(()=>{l&&H(1,!1,null)},[l,H,D,z,B,me,Q]),r.useEffect(()=>{!Ce&&l&&(localStorage.setItem("hasVisitedProducts","true"),Lt(!0))},[Ce,l]),r.useEffect(()=>{x.length===0&&!ne&&l&&!Ce&&Ee(!0)},[x.length,ne,l,Ce]),r.useEffect(()=>{console.log("[DEBUG-MONITOR] ===== STATE CHANGED ====="),console.log("[DEBUG-MONITOR] Products count:",x.length),console.log("[DEBUG-MONITOR] Selected items count:",p.length),console.log("[DEBUG-MONITOR] Products:",x.map(t=>({id:t.id,title:t.title}))),console.log("[DEBUG-MONITOR] Selected items:",p)},[x,p]);const tt=r.useCallback(t=>{He(t)},[]);r.useEffect(()=>{const t=setTimeout(()=>{l&&H(1,!1,null)},500);return()=>clearTimeout(t)},[Y]);const Ot=r.useCallback(t=>{console.log("[SELECTION-CHANGE] ===== SELECTION CHANGED ====="),console.log("[SELECTION-CHANGE] New selected items:",t),console.log("[SELECTION-CHANGE] Item count:",t.length),console.log("[SELECTION-CHANGE] Item types:",t.map(n=>typeof n)),console.log("[SELECTION-CHANGE] Current products count:",x.length),console.log("[SELECTION-CHANGE] Current products IDs:",x.map(n=>n.id)),oe(t),t.length===0&&he(!1)},[x]),st=r.useCallback(t=>{he(t),oe(t?x.map(n=>n.id):[])},[x]),nt=r.useMemo(()=>{var n;if(I)return M.length>R;const t=x.filter(s=>p.includes(s.id));if(t.length===0)return M.length>R;for(const s of t){const o=((n=s.optimizationSummary)==null?void 0:n.optimizedLanguages)||[],c=M.filter(h=>!o.includes(h)),a=o.length+c.length;if(console.log(`[LANGUAGE-LIMIT] Product ${s.id}: existing ${o.length}, new ${c.length}, total ${a}, limit ${R}`),a>R)return!0}return!1},[x,p,I,R,M]),Pt=()=>{if(p.length===0&&!I){w("Please select products first");return}je(!0)},vt=()=>{if(p.length===0&&!I){w("Please select products first");return}ce([]),le(!0)},Tt=async()=>{const n=x.filter(o=>p.includes(o.id)).filter(o=>{var c,a;return((a=(c=o.optimizationSummary)==null?void 0:c.optimizedLanguages)==null?void 0:a.length)>0});ee({processing:!0,current:0,total:n.length,currentItem:"",results:null});const s={successful:0,failed:0,skipped:0};for(let o=0;o<n.length;o++){const c=n[o];ee(a=>({...a,current:o,currentItem:c.title}));try{const a=await C("/ai-enhance/product",{method:"POST",shop:l,body:{shop:l,productId:c.gid||ue(c.id),languages:c.optimizationSummary.optimizedLanguages}});if(a.results&&a.results.length>0){const h={shop:l,productId:c.gid||ue(c.id),results:a.results.filter(m=>m.bullets&&m.faq).map(m=>({language:m.language,seo:{...m.updatedSeo,bullets:m.bullets||[],faq:m.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},g=await C("/api/seo/apply-multi",{method:"POST",shop:l,body:h});s.successful++}else s.failed++}catch(a){if(console.error("Enhancement error:",a),a.status===402||a.requiresPurchase||a.trialRestriction){ee({processing:!1,current:0,total:0,currentItem:"",results:null}),Re(a),we(a.currentPlan||v||"starter"),a.trialRestriction?De(!0):et(!0);return}s.failed++}ee(a=>({...a,current:o+1}))}ee(o=>({...o,processing:!1,results:s})),w(`AI enhancement complete! ${s.successful} products enhanced.`)},Ue=()=>{Et(!1),ee({processing:!1,current:0,total:0,currentItem:"",results:null}),P.results&&P.results.successful>0&&H(1,!1,null)},kt=()=>P.processing?e.jsx(A,{open:Ze,title:"Processing AI Enhancement",onClose:Ue,noScroll:!0,children:e.jsx(A.Section,{children:e.jsxs($,{gap:"400",children:[e.jsxs(i,{variant:"bodyMd",children:["Processing: ",P.currentItem]}),e.jsx(ot,{progress:P.current/P.total*100}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[P.current," of ",P.total," products (",Math.round(P.current/P.total*100),"%)"]})]})})}):P.results!==null?e.jsx(A,{open:Ze,title:"AI Enhancement Results",onClose:Ue,primaryAction:{content:"Done",onAction:Ue},children:e.jsx(A.Section,{children:e.jsx($,{gap:"300",children:e.jsxs(y,{gap:"400",children:[e.jsxs(d,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"success",children:P.results.successful})]}),e.jsxs(d,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:P.results.failed})]}),e.jsxs(d,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"info",children:P.results.skipped})]})]})})})}):null,zt=async()=>{var n;if(!M.length){w("Please select at least one language");return}let t=ht;(!t||!t.trim())&&(t=((n=mt[0])==null?void 0:n.value)||"anthropic/claude-3.5-sonnet"),je(!1),X(!0),W({current:0,total:0,percent:0}),ae([]),Je({});try{let s=[];I?s=(await C(`/api/products/list?shop=${encodeURIComponent(l)}&limit=1000&fields=id`)).products||[]:s=x.filter(f=>p.includes(f.id));const o=K(v),c=s.length;s=s.slice(0,o);const a=s.length,h=c-a;W({current:0,total:a,percent:0});const g=5,m={};for(let f=0;f<s.length;f+=g){const L=s.slice(f,Math.min(f+g,s.length)).map(async b=>{var se;Z(b.title||b.handle||"Product");try{const Ie=b.gid||ue(b.productId||b.id),Be=((se=b.optimizationSummary)==null?void 0:se.optimizedLanguages)||[],Ne=M.filter(Ht=>!Be.includes(Ht));if(Ne.length===0){m[b.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Kt=await C("/api/seo/generate-multi",{method:"POST",shop:l,body:{shop:l,productId:Ie,model:t,languages:Ne}});m[b.id]={success:!0,data:Kt,languages:Ne}}catch(Ie){m[b.id]={success:!1,error:Ie.message},ae(Be=>[...Be,{product:b.title,error:Ie.message}])}});await Promise.all(L);const U=Math.min(f+g,s.length),de=Math.round(U/a*100);W({current:U,total:a,percent:de})}Je(m),Me(!0);const S=Object.keys(m).filter(f=>m[f].success&&!m[f].skipped).length,j=Object.keys(m).filter(f=>m[f].skipped).length;let N=`Generated Optimization for AI Search for ${S} products`;j>0&&(N+=` (${j} already optimised)`),h>0&&(N+=` (${h} skipped due to plan limit)`),w(N)}catch(s){w(`Error: ${s.message}`)}finally{X(!1),Z("")}},Mt=async()=>{var t,n;X(!0),W({current:0,total:0,percent:0});try{const s=Object.entries(ie).filter(([h,g])=>g.success&&!g.skipped),o=s.length;W({current:0,total:o,percent:0});for(let h=0;h<s.length;h++){const[g,m]=s[h],S=x.find(f=>f.id===g);if(!S)continue;Z(S.title||"Product");try{const f=S.gid||ue(S.productId||S.id),k=await C("/api/seo/apply-multi",{method:"POST",shop:l,body:{shop:l,productId:f,results:m.data.results.filter(L=>L==null?void 0:L.seo).map(L=>({language:L.language,seo:L.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});k.appliedLanguages&&k.appliedLanguages.length>0&&F(L=>L.map(U=>{var de;if(U.id===g){const b=((de=U.optimizationSummary)==null?void 0:de.optimizedLanguages)||[],se=[...new Set([...b,...k.appliedLanguages])];return{...U,optimizationSummary:{...U.optimizationSummary,optimizedLanguages:se,optimized:!0,lastOptimized:new Date().toISOString()}}}return U}))}catch(f){ae(k=>[...k,{product:S.title,error:`Apply failed: ${f.message}`}])}const j=h+1,N=Math.round(j/o*100);W({current:j,total:o,percent:N})}w("AI Search Optimisation applied successfully!"),Me(!1),console.log("[APPLY-SEO] ===== CLEARING SELECTION ====="),console.log("[APPLY-SEO] Selected items BEFORE clear:",p),oe([]),he(!1),console.log("[APPLY-SEO] Selected items cleared"),console.log("[APPLY-SEO] Waiting for database propagation..."),await new Promise(h=>setTimeout(h,1e3)),console.log("[APPLY-SEO] Clearing products state before reload..."),F([]);const c=new URLSearchParams({shop:l,page:1,limit:50,...D!=="all"&&{optimized:D},...Y&&{search:Y},...z&&{languageFilter:z},...B.length>0&&{tags:B.join(",")},sortBy:me,sortOrder:Q,_t:Date.now()}),a=await C(`/api/products/list?${c}`,{shop:l,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});F(a.products||[]),Ge(1),Oe(((t=a.pagination)==null?void 0:t.hasNext)||!1),Ke(((n=a.pagination)==null?void 0:n.total)||0)}catch(s){w(`Error applying AI Search Optimisation: ${s.message}`)}finally{X(!1),Z("")}},Dt=async()=>{var t;if(!G.length){w("Please select at least one language to delete");return}le(!1),ye(!1),X(!0),W({current:0,total:0,percent:0}),ae([]);try{let n=[];I?n=(await C(`/api/products/list?shop=${encodeURIComponent(l)}&limit=1000&fields=id`)).products||[]:n=x.filter(a=>p.includes(a.id));const s=n.length;W({current:0,total:s,percent:0});let o=0,c=0;for(let a=0;a<n.length;a++){const h=n[a];Z(h.title||h.handle||"Product");try{const S=h.gid||ue(h.productId||h.id),j=((t=h.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],N=G.filter(k=>j&&j.length>0&&j.includes(k));if(N.length===0){c++;continue}const f=await C("/api/seo/delete-multi",{method:"POST",shop:l,body:{shop:l,productId:S,languages:N}});f.deletedLanguages&&f.deletedLanguages.length>0&&F(k=>k.map(L=>{var U;if(L.id===h.id){const b=(((U=L.optimizationSummary)==null?void 0:U.optimizedLanguages)||[]).filter(se=>!f.deletedLanguages.includes(se));return{...L,optimizationSummary:{...L.optimizationSummary,optimizedLanguages:b,optimized:b.length>0,lastOptimized:b.length>0?L.optimizationSummary.lastOptimized:null}}}return L})),o++,f.deletedLanguages&&f.deletedLanguages.length>0&&await C("/api/products/verify-after-delete",{method:"POST",shop:l,body:{shop:l,productIds:[S],deletedLanguages:f.deletedLanguages}})}catch(S){ae(j=>[...j,{product:h.title,error:S.message}])}const g=a+1,m=Math.round(g/s*100);W({current:g,total:s,percent:m})}oe([]),he(!1),c>0?w(`Deleted Optimization for AI Search from ${o} products (${c} had no optimisation to delete)`):w(`Deleted Optimization for AI Search from ${o} products`),setTimeout(()=>{const a=Date.now();H(1,!1,a)},500)}catch(n){w(`Error: ${n.message}`)}finally{X(!1),Z("")}},Rt=t=>{var n,s;try{const o=t,c=ss(o.productId||o.id),a=((n=o.optimizationSummary)==null?void 0:n.optimizedLanguages)||[];console.log(`[BULK-EDIT-RENDER] Product: "${o.title}", ID: ${o.id}, Type: ${typeof o.id}`),console.log("[BULK-EDIT-RENDER] Optimized Languages:",a),console.log("[BULK-EDIT-RENDER] Selected Items:",p),console.log("[BULK-EDIT-RENDER] Is Selected:",p.includes(o.id));const h=(s=o.images)!=null&&s[0]?e.jsx(at,{source:o.images[0].url||o.images[0].src||o.images[0],alt:o.title,size:"small"}):o.imageUrl?e.jsx(at,{source:o.imageUrl,alt:o.title,size:"small"}):e.jsx(d,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Zt,{id:o.id,media:h,accessibilityLabel:`View details for ${o.title}`,onClick:g=>{console.log("[ResourceItem] ===== CLICK ON RESOURCE ITEM ====="),console.log("[ResourceItem] e.target:",g.target),console.log("[ResourceItem] e.target.tagName:",g.target.tagName),console.log('[ResourceItem] e.target.closest("input"):',g.target.closest("input")),console.log('[ResourceItem] e.target.closest("a"):',g.target.closest("a")),console.log("[ResourceItem] Event bubbling up...")},children:e.jsxs(y,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(d,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:o.title}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["ID: ",c]})]}),e.jsx(d,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(y,{gap:"100",children:O.length>0?O.map(g=>{const m=a.includes(g);return e.jsx(V,{tone:m?"success":"subdued",size:"small",children:g.toUpperCase()},g)}):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),a.map(g=>e.jsx(V,{tone:"success",size:"small",children:g.toUpperCase()},g)))})}),e.jsx(d,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(V,{tone:"success",children:"Active"})})]})})}catch(o){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",o),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},Ut=ze&&e.jsx(A,{open:ze,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(A.Section,{children:e.jsxs($,{gap:"400",children:[e.jsx(i,{variant:"bodyMd",children:Qe?`Processing: ${Qe}`:"Preparing..."}),e.jsx(ot,{progress:Se.percent}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[Se.current," of ",Se.total," products (",Se.percent,"%)"]})]})})}),$t=e.jsx(A,{open:xt,title:"Select Languages",onClose:()=>{je(!1),J([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:zt,disabled:M.length===0||nt},secondaryActions:[{content:"Cancel",onAction:()=>{je(!1),J([])}}],children:e.jsx(A.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(i,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",I?"all":p.length," selected products:"]}),nt&&(()=>{var t,n,s;return console.log("[BANNER-RENDER] currentPlan:",te,"languageLimit:",R,"globalPlan:",u),e.jsx(We,{tone:"warning",title:"Language limit exceeded",children:e.jsxs($,{gap:"200",children:[e.jsxs(i,{variant:"bodyMd",children:["Your ",te," plan supports up to ",R," language",R>1?"s":""," per product.",p.length===1&&((s=(n=(t=x.find(o=>o.id===p[0]))==null?void 0:t.optimizationSummary)==null?void 0:n.optimizedLanguages)==null?void 0:s.length)>0&&e.jsxs(e.Fragment,{children:[" This product already has ",x.find(o=>o.id===p[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsxs(i,{variant:"bodyMd",tone:"subdued",children:['DEBUG: currentPlan="',te,'", languageLimit=',R,', globalPlan.planKey="',u==null?void 0:u.planKey,'", globalPlan.plan="',u==null?void 0:u.plan,'"']}),e.jsx(i,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(T,{variant:"primary",onClick:()=>{const o=new URLSearchParams(window.location.search),c=o.toString()?`?${o.toString()}`:"";window.location.href=`/billing${c}`},children:"Upgrade Plan"})]})})})(),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:O.map(t=>e.jsx(Le,{label:t.toUpperCase(),checked:M.includes(t),onChange:n=>{J(n?[...M,t]:M.filter(s=>s!==t))}},t))})}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(T,{plain:!0,onClick:()=>{M.length===O.length?J([]):O.length>R?(J([...O]),w(`You selected ${O.length} languages. Your ${te} plan supports ${R}. Please deselect or upgrade.`)):J([...O])},children:M.length===O.length?"Deselect all":"Select all"})}),e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Bt=e.jsx(A,{open:St&&!ze,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:Mt,disabled:!Object.values(ie).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Me(!1)}],children:e.jsx(A.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(y,{gap:"400",children:[e.jsxs(d,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(ie).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(d,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(ie).filter(t=>t.skipped).length})]}),e.jsxs(d,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(ie).filter(t=>!t.success).length})]})]}),xe.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(_t,{}),e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(d,{maxHeight:"200px",overflowY:"scroll",children:[xe.slice(0,10).map((t,n)=>e.jsxs(i,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},n)),xe.length>10&&e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["... and ",xe.length-10," more errors"]})]})]})]})})}),Nt=e.jsx(A,{open:jt,title:"Delete Optimization for AI Search",onClose:()=>{le(!1),ce([])},primaryAction:{content:"Continue",onAction:()=>{le(!1),ye(!0)},disabled:G.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{le(!1),ce([])}}],children:e.jsx(A.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(i,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",I?"all":p.length," selected products:"]}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:O.map(t=>e.jsx(Le,{label:t.toUpperCase(),checked:G.includes(t),onChange:n=>{ce(n?[...G,t]:G.filter(s=>s!==t))}},t))})}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(T,{plain:!0,onClick:()=>{ce(G.length===O.length?[]:[...O])},children:G.length===O.length?"Deselect all":"Select all"})}),e.jsx(i,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Wt=e.jsx(A,{open:yt,title:"Confirm Deletion",onClose:()=>{ye(!1)},primaryAction:{content:"Delete",onAction:Dt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>ye(!1)}],children:e.jsx(A.Section,{children:e.jsxs($,{gap:"300",children:[e.jsx(i,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(d,{paddingBlock:"200",children:e.jsx(y,{gap:"100",children:G.map(t=>e.jsx(V,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(i,{variant:"bodyMd",children:["This will delete optimisation from ",I?"ALL":p.length," selected products."]}),e.jsx(i,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),$e=async()=>{try{pe(!0),w("Syncing products from Shopify...");const t=await C("/api/products/sync",{method:"POST",shop:l});if(t.success){const n=t.productsCount||t.synced||0;w(`✅ Synced ${n} products successfully!`),setTimeout(()=>{H(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),w(`❌ Sync failed: ${t.message}`)}finally{pe(!1)}},Gt=e.jsx(es,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{He(""),ge("all"),re(""),fe([]),H(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:$e},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(rt,{children:e.jsxs(d,{padding:"400",children:[e.jsxs($,{gap:"300",children:[v&&e.jsx(We,{tone:"info",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(i,{children:["Your ",e.jsx("strong",{children:v})," plan includes up to"," ",e.jsx("strong",{children:K(v)})," products for SEO optimization.",q>K(v)&&e.jsxs(e.Fragment,{children:[" You have ",q," products, so only the first ",K(v)," will be processed."]})]}),(p.length>0||I)&&e.jsxs(i,{children:["Selected: ",I?Math.min(q,K(v)):p.length,"/",K(v)]})]})}),v&&(p.length>K(v)||I&&q>K(v))&&e.jsx(We,{tone:"warning",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(i,{children:[e.jsx("strong",{children:"Plan Limit Exceeded:"})," You've selected more products than your ",v," plan allows. Only the first ",K(v)," products will be processed."]}),e.jsx(T,{size:"micro",onClick:()=>De(!0),children:"Upgrade Plan"})]})}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(d,{minWidth:"400px",children:e.jsx(Vt,{label:"",placeholder:"Search by product ID, name, or details...",value:Y,onChange:tt,prefix:e.jsx(Qt,{}),clearButton:!0,onClearButtonClick:()=>tt("")})}),e.jsx(d,{width:"320px",children:e.jsx(T,{primary:!0,onClick:Pt,disabled:p.length===0&&!I,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(T,{onClick:$e,disabled:ne,size:"medium",children:"Sync Products"}),e.jsx(d,{width:"320px",children:e.jsxs($,{gap:"200",align:"end",children:[p.length===0&&!I||!x.filter(s=>p.includes(s.id)).some(s=>{var o,c;return((c=(o=s.optimizationSummary)==null?void 0:o.optimizedLanguages)==null?void 0:c.length)>0})?null:e.jsx(T,{onClick:Tt,disabled:p.length===0&&!I,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(T,{onClick:vt,disabled:p.length===0&&!I||!x.filter(s=>p.includes(s.id)).some(s=>{var o,c;return((c=(o=s.optimizationSummary)==null?void 0:o.optimizedLanguages)==null?void 0:c.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),q>0&&e.jsx(d,{paddingBlockStart:"300",children:e.jsx(Le,{label:`Select all ${q} products in your store`,checked:I,onChange:st})})]})}),e.jsx(d,{paddingBlockStart:"400",children:e.jsxs(rt,{children:[e.jsxs(d,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(y,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(y,{gap:"200",wrap:!0,children:[e.jsx(be,{active:Fe,activator:e.jsx(T,{disclosure:"down",onClick:()=>Pe(!Fe),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),D!=="all"&&e.jsx(d,{onClick:t=>{t.stopPropagation(),ge("all")},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Pe(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(Ae,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[D],onChange:t=>{ge(t[0]),re(""),Pe(!1)}})})}),e.jsx(be,{active:qe,activator:e.jsx(T,{disclosure:"down",onClick:()=>ve(!qe),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),z&&e.jsx(d,{onClick:t=>{t.stopPropagation(),re("")},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ve(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(Ae,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...O.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...O.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:z?[z]:[],onChange:t=>{re(t[0]||""),ve(!1)}})})}),e.jsx(be,{active:Ye,activator:e.jsx(T,{disclosure:"down",onClick:()=>Te(!Ye),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),B.length>0&&e.jsx(d,{onClick:t=>{t.stopPropagation(),fe([])},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Te(!1),children:e.jsxs(d,{padding:"300",minWidth:"200px",children:[e.jsx(Ae,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:ut.map(t=>({label:t,value:t})),selected:B,onChange:t=>{fe(t)}}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(T,{size:"slim",onClick:()=>Te(!1),children:"Apply"})})]})})]}),e.jsx(be,{active:_e,activator:e.jsx(T,{disclosure:"down",onClick:()=>ke(!_e),removeUnderline:!0,children:e.jsx(y,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:Q==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>ke(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(Ae,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[Q],onChange:t=>{dt(t[0]),ke(!1)}})})})]}),(D!=="all"||z||B.length>0)&&e.jsx(d,{paddingBlockStart:"200",children:e.jsxs(y,{gap:"100",wrap:!0,children:[D!=="all"&&e.jsx(V,{onRemove:()=>ge("all"),children:D==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),z&&e.jsx(V,{onRemove:()=>re(""),children:z.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),B.map(t=>e.jsxs(V,{onRemove:()=>fe(n=>n.filter(s=>s!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(d,{children:[e.jsx(d,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(y,{gap:"200",align:"start",children:[e.jsx(Le,{checked:p.length===x.length&&x.length>0,onChange:st,label:""}),e.jsxs(i,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",p.length>0&&` (${p.length} selected products)`]})]})}),e.jsx(Jt,{resourceName:{singular:"product",plural:"products"},items:x,renderItem:Rt,selectedItems:p,onSelectionChange:Ot,selectable:!0,loading:ne,totalItemsCount:q,emptyState:Gt,showHeader:!1},`products-${x.length}-${p.length}`)]}),ct&&!ne&&e.jsx(d,{padding:"400",textAlign:"center",children:e.jsx(T,{onClick:()=>H(lt+1,!0,null),children:"Load more"})})]})}),Ut,$t,Bt,Nt,Wt,kt(),e.jsx(A,{open:It,onClose:()=>Ee(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Ee(!1),$e()}},secondaryActions:[{content:"Skip for now",onAction:()=>Ee(!1)}],children:e.jsx(A.Section,{children:e.jsxs($,{gap:"300",children:[e.jsx(i,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(i,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(qt,{open:bt,onClose:()=>{De(!1),Re(null)},featureName:"AI Enhancement",currentPlan:te}),_&&e.jsx(Yt,{open:At,onClose:()=>{et(!1),Re(null)},tokensRequired:_.tokensRequired||0,tokensAvailable:_.tokensAvailable||0,tokensNeeded:_.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:l,needsUpgrade:_.needsUpgrade||!1,minimumPlan:_.minimumPlanForFeature||null,currentPlan:_.currentPlan||te}),Xe&&e.jsx(Xt,{content:Xe,onDismiss:()=>w("")})]})}export{cs as default};
