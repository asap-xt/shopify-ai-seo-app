import{r as e,j as t}from"./react-vendor-BLtYaay5.js";import{m as s}from"./sessionFetch-C6f0cex3.js";import{I as n,T as a}from"./TrialActivationModal-CmZNJenq.js";import{T as o}from"./TokenPurchaseModal-ChVK648j.js";import{g as r}from"./usePlanHierarchy-CpsbOjPs.js";import{e as i}from"./tokenEstimates-Dgf19ZiR.js";import{C as l,B as c,T as d,I as u,i as h,d as p,a as m,f as g,D as x,g as f,b as y,M as b,n as v}from"./polaris-BgbORwUH.js";import"./app-bridge-DUY42B6P.js";import"./vendor-L4_WdQez.js";import"./index-t0gsEZ_t.js";function j(){const j=e=>(e||"starter").toLowerCase().replace(" ","_"),w=((e,t="")=>{try{return new URLSearchParams(window.location.search).get(e)||t}catch{return t}})("shop",""),[S,A]=e.useState(!0),[k,P]=e.useState(!1),[I,C]=e.useState(null),[T,E]=e.useState(""),[O,$]=e.useState(!1),[G,M]=e.useState(""),[D,R]=e.useState(null),[U,_]=e.useState(null),[z,q]=e.useState(!1),[F,L]=e.useState(!1),[N,B]=e.useState(!1),[J,W]=e.useState(!1),[Y,H]=e.useState(!1),[V,Q]=e.useState(!1),[Z,K]=e.useState(!1),[X,ee]=e.useState(!1),[te,se]=e.useState(!1),[ne,ae]=e.useState(""),[oe,re]=e.useState(null),[ie,le]=e.useState(null),[ce,de]=e.useState(!1),[ue,he]=e.useState(null),[pe,me]=e.useState(!1),[ge,xe]=e.useState(!1),[fe,ye]=e.useState(!1),[be,ve]=e.useState(!1),[je,we]=e.useState({feature:"",tokensRequired:0,tokensAvailable:0,tokensNeeded:0}),[Se,Ae]=e.useState(null),[ke,Pe]=e.useState(!1),[Ie,Ce]=e.useState(""),[Te,Ee]=e.useState({enabled:!1,generating:!1,generated:!1,progress:""}),[Oe,$e]=e.useState(!1),[Ge,Me]=e.useState(null),[De,Re]=e.useState({inProgress:!1,status:"idle",message:null,position:null,estimatedTime:null,generatedAt:null,schemaCount:0}),[Ue,_e]=e.useState(null),[ze,qe]=e.useState(!1),[Fe,Le]=e.useState(!1),[Ne,Be]=e.useState({current:0,total:0,percent:0,currentProduct:"",stats:{siteFAQ:!1,products:0,totalSchemas:0}}),Je=e.useMemo(()=>s(),[]);e.useEffect(()=>{if(G){D&&clearTimeout(D);const e=setTimeout(()=>{M("")},5e3);R(e)}},[G]);const We=e.useCallback(async()=>{var e,t,s,n,a,o,r,i,l;try{const c=await Je(`/api/schema/status?shop=${w}`);if(Re({inProgress:c.inProgress||!1,status:c.status||"idle",message:c.message||null,position:(null==(e=c.queue)?void 0:e.position)||null,estimatedTime:(null==(t=c.queue)?void 0:t.estimatedTime)||null,generatedAt:(null==(s=c.schema)?void 0:s.generatedAt)||null,schemaCount:(null==(n=c.schema)?void 0:n.schemaCount)||0}),"completed"!==c.status||c.inProgress||(Ue&&(clearInterval(Ue),_e(null)),C(e=>e&&e.features?{...e,features:{...e.features,schemaData:!1}}:e),De.inProgress&&M(`Advanced Schema Data generated successfully! (${(null==(a=c.schema)?void 0:a.schemaCount)||0} schemas)`)),"failed"===c.status){const e=(null==(o=c.shopStatus)?void 0:o.failedAt)?new Date(c.shopStatus.failedAt):null,t=(null==(r=c.schema)?void 0:r.generatedAt)?new Date(c.schema.generatedAt):null;if((null==(i=c.schema)?void 0:i.exists)&&t&&e&&t>e)return Ue&&(clearInterval(Ue),_e(null)),C(e=>e&&e.features?{...e,features:{...e.features,schemaData:!1}}:e),De.inProgress&&M(`Advanced Schema Data generated successfully! (${(null==(l=c.schema)?void 0:l.schemaCount)||0} schemas)`),c;Ue&&(clearInterval(Ue),_e(null)),"NO_OPTIMIZED_PRODUCTS"===c.message?(Me("NO_OPTIMIZED_PRODUCTS"),$e(!0)):"ONLY_BASIC_SEO"===c.message?(Me("ONLY_BASIC_SEO"),$e(!0)):M(`Advanced Schema Data generation failed: ${c.message||"Unknown error"}`)}return c}catch(c){}},[w,Je,Ue,De.inProgress]),Ye=e.useCallback(()=>{Ue&&clearInterval(Ue),We();const e=setInterval(()=>{We()},1e4);_e(e)},[We,Ue]);e.useEffect(()=>()=>{Ue&&clearInterval(Ue)},[Ue]),e.useEffect(()=>{w&&!Ue&&We().then(e=>{(null==e?void 0:e.inProgress)&&Ye()})},[w]);const He=e.useCallback(async()=>{var e;try{const t=await Je(`/api/products/list?shop=${w}&limit=10&optimized=true`);return null==(e=null==t?void 0:t.products)?void 0:e.some(e=>{var t,s;return(null==(s=null==(t=null==e?void 0:e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:s.length)>0})}catch(t){return!1}},[w,Je]),Ve=e.useCallback(async()=>{var e;try{const t=await Je(`/collections/list-graphql?shop=${w}`);return null==(e=null==t?void 0:t.collections)?void 0:e.some(e=>{var t;return(null==(t=null==e?void 0:e.optimizedLanguages)?void 0:t.length)>0})}catch(t){return!1}},[w,Je]),Qe=e.useCallback(async()=>{var e,t;try{const s="\n        query CheckStoreMetadata($shop: String!) {\n          storeMetadata(shop: $shop) {\n            shopName\n            description\n          }\n        }\n      ",n=await Je("/graphql",{method:"POST",body:JSON.stringify({query:s,variables:{shop:w}}),shop:w});return!!(null==(t=null==(e=null==n?void 0:n.data)?void 0:e.storeMetadata)?void 0:t.shopName)}catch(s){return!1}},[w,Je]),Ze=e.useCallback(async()=>{var e,t,s;try{const n=await fetch(`/ai/welcome?shop=${w}`,{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${(null==(s=null==(t=null==(e=window.__SHOPIFY_APP_BRIDGE__)?void 0:e.getState())?void 0:t.session)?void 0:s.token)||""}`}});if(n.ok){const e=await n.text();return e.includes("<!DOCTYPE html>")||e.includes("<!doctype html>")}return!1}catch(n){return!1}},[w]),Ke=e.useCallback(async()=>{var e,t,s,n;try{if(null==(e=null==I?void 0:I.features)?void 0:e.productsJson){const e=await He();L(e)}if(null==(t=null==I?void 0:I.features)?void 0:t.collectionsJson){const e=await Ve();B(e)}if(null==(s=null==I?void 0:I.features)?void 0:s.storeMetadata){const e=await Qe();W(e)}if(null==(n=null==I?void 0:I.features)?void 0:n.welcomePage){const e=await Ze();H(e)}else H(!1)}catch(a){}},[null==I?void 0:I.features,He,Ve,Qe,Ze]);e.useEffect(()=>{},[null==I?void 0:I.features,He,Ve,Qe,Ze]),e.useEffect(()=>{w?nt():A(!1)},[w,Je]),e.useEffect(()=>{pe&&Xe()},[pe]);const Xe=async()=>{try{const e=await Je(`/api/schema/status?shop=${w}`);Ee({enabled:e.enabled,generating:e.generating,generated:e.hasSiteFAQ||e.productsWithSchema>0,progress:e.progress||""})}catch(e){}},et=e.useRef(!1),tt=e.useRef(0),st=e.useCallback(async()=>{if(et.current,tt.current,et.current){if(tt.current++,tt.current>30)return et.current=!1,tt.current=0,qe(!1),void M("Schema generation timed out. Please check if data was generated.");try{const t=await Je(`/api/schema/status?shop=${w}`);if("NO_OPTIMIZED_PRODUCTS"===t.error||"ONLY_BASIC_SEO"===t.error)return t.error,et.current=!1,tt.current=0,qe(!1),M(null),Me(t.error),void $e(!0);if("TRIAL_RESTRICTION"===t.error)return et.current=!1,tt.current=0,qe(!1),M(t.errorMessage||"Advanced Schema Data is locked during trial. Please activate your plan to use included tokens."),void setTimeout(()=>{const e=new URLSearchParams(window.location.search),t=e.get("host"),s=e.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(w)}&embedded=${s}&host=${encodeURIComponent(t)}`},2e3);if("INSUFFICIENT_TOKENS"===t.error)return et.current=!1,tt.current=0,qe(!1),void M(t.errorMessage||"Insufficient token balance for Advanced Schema generation. Please purchase tokens.");if(t.dataReady)return et.current=!1,tt.current=0,qe(!1),Le(!0),void Be(e=>({...e,percent:100,currentProduct:"Complete!",stats:{siteFAQ:t.hasSiteFAQ||!1,products:t.productsWithSchema||0,totalSchemas:t.productsWithSchema||0}}));if(t.generating){let e=0;if(t.progress){const s=t.progress.match(/(\d+)%/);s&&(e=parseInt(s[1]))}Be(s=>({...s,percent:Math.max(s.percent,e),currentProduct:t.currentProduct||`Processing... (${tt.current}/30)`})),setTimeout(()=>{et.current&&st()},3e3)}else try{const e=await Je(`/ai/schema-data.json?shop=${w}`);if(e&&e.schemas&&e.schemas.length>0){et.current=!1,tt.current=0,qe(!1),Le(!0);const t=[...new Set(e.schemas.map(e=>{var t,s;return null==(s=null==(t=e.url)?void 0:t.split("/products/")[1])?void 0:s.split("#")[0]}))].filter(Boolean);Be(s=>({...s,percent:100,currentProduct:"Complete!",stats:{siteFAQ:!!e.siteFAQ,products:t.length,totalSchemas:e.schemas.length}}))}else et.current=!1,tt.current=0,qe(!1),M("Schema generation may have failed. Please try again.")}catch(e){et.current=!1,tt.current=0,qe(!1),M("Unable to verify schema generation status.")}}catch(e){tt.current<5?setTimeout(()=>{et.current&&st()},5e3):(et.current=!1,tt.current=0,qe(!1),M("Error checking generation status. Please refresh and try again."))}}},[Je,w]),nt=async()=>{var e,t;try{const s=await Je(`/api/ai-discovery/settings?shop=${w}`);if(!s||!s.features||!s.bots)return C({features:{},bots:{},plan:"starter",enabled:!1}),void M("Failed to load settings - please refresh the page");Object.entries((null==s?void 0:s.features)||{}).filter(([e,t])=>!0===t);s.hasAiSitemap&&(null==(e=s.features)?void 0:e.aiSitemap)&&(s.features.aiSitemap=!1),s.hasAdvancedSchema&&(null==(t=s.features)?void 0:t.schemaData)&&(s.features.schemaData=!1),C(s),he(s),me(s.advancedSchemaEnabled||!1),at(s)}catch(s){C({features:{},bots:{},plan:"starter",enabled:!1}),M("Failed to load settings - please refresh the page")}finally{A(!1)}},at=async(e=I)=>{try{const e=await Je(`/api/ai-discovery/robots-txt?shop=${w}`,{responseType:"text"});if(e)E(e);else{E("User-agent: *\nDisallow: /")}}catch(t){E("# Error generating robots.txt\n# "+t.message)}},ot=e=>{var t,s;I&&I.bots&&((null==(t=null==I?void 0:I.availableBots)?void 0:t.includes(e))?(C(t=>{var s;return t&&t.bots?{...t,bots:{...t.bots,[e]:{...t.bots[e],enabled:!(null==(s=t.bots[e])?void 0:s.enabled)}}}:t}),K(!0)):M(`Upgrade to ${requiredPlan} plan to enable ${(null==(s=I.bots[e])?void 0:s.name)||e}`))},rt=async e=>{if(!I||!I.features)return;if(!mt(e)){return void M(`Upgrade your plan to enable ${{productsJson:"Products JSON Feed",aiSitemap:"AI-Optimized Sitemap",welcomePage:"AI Welcome Page",collectionsJson:"Collections JSON Feed",storeMetadata:"Store Metadata",schemaData:"Schema Data",llmsTxt:"LLMs.txt File",discoveryLinks:"AI Discovery Links",aiAsk:"AI Ask Endpoint"}[e]||e}`)}if(!I.features[e]&&xt(e))try{const t=await Je(`/api/billing/tokens/balance?shop=${w}`);if(t.balance<=0){const s={aiSitemap:"ai-sitemap-optimized",schemaData:"ai-schema-advanced",welcomePage:"ai-welcome-page",collectionsJson:"ai-collections-json",storeMetadata:"ai-store-metadata",llmsTxt:"ai-llms-txt",discoveryLinks:"ai-discovery-links",aiAsk:"ai-ask-endpoint"}[e]||e,n=(null==I?void 0:I.productCount)||0,a=i(s,{productCount:n});return we({feature:s,tokensRequired:a.withMargin,tokensAvailable:t.balance||0,tokensNeeded:a.withMargin}),void xe(!0)}}catch(t){return void M("Error checking token balance")}C(t=>t&&t.features?{...t,features:{...t.features,[e]:!t.features[e]}}:t)},it=async()=>{if(I&&I.features&&I.bots){P(!0);try{const{aiSitemap:e,schemaData:t,...s}=I.features||{};await Je(`/api/ai-discovery/settings?shop=${w}`,{method:"POST",body:{shop:w,bots:I.bots,features:s,richAttributes:I.richAttributes}}),K(!1),he(I),at(),M(""),setTimeout(()=>{const e=Object.values((null==I?void 0:I.bots)||{}).some(e=>e.enabled);M(e?"Settings saved! Scroll down to configure robots.txt (REQUIRED for AI Discovery).":"Settings saved successfully")},100)}catch(e){if(402===e.status)return P(!1),Ae(e),void(e.trialRestriction&&e.requiresActivation?ye(!0):e.requiresPurchase?xe(!0):M("AI-Optimized Sitemap requires tokens. Please upgrade or purchase tokens."));M("Failed to save settings")}finally{P(!1)}}else M("Settings not loaded yet. Please wait and try again.")},[lt,ct]=e.useState(!1),[dt,ut]=e.useState(!1),[ht,pt]=e.useState(!1),mt=e=>{const t=r(null==I?void 0:I.plan),s={productsJson:0,llmsTxt:0,storeMetadata:1,welcomePage:2,collectionsJson:2,discoveryLinks:2,aiSitemap:2,schemaData:2,aiAsk:2}[e];return void 0!==s&&t>=s},gt=e=>{var t;const s=j(null==I?void 0:I.plan);return(null==(t={storeMetadata:{starter:"Available in Professional or higher"},welcomePage:{starter:"Available in Professional Plus (pay-per-use tokens) or Growth+",professional:"Available in Professional Plus (pay-per-use tokens) or Growth+"},collectionsJson:{starter:"Available in Professional Plus (pay-per-use tokens) or Growth+",professional:"Available in Professional Plus (pay-per-use tokens) or Growth+"},aiSitemap:{starter:"Available in Professional Plus (pay-per-use tokens) or Growth Extra+",professional:"Available in Professional Plus (pay-per-use tokens) or Growth Extra+",growth:"Available in Growth Plus (pay-per-use tokens) or Growth Extra+"},schemaData:{starter:"Available in Professional Plus (pay-per-use tokens), Growth Plus (pay-per-use tokens) or Enterprise",professional:"Available in Professional Plus (pay-per-use tokens), Growth Plus (pay-per-use tokens) or Enterprise",growth:"Available in Growth Plus (pay-per-use tokens) or Enterprise",growth_extra:"Available in Enterprise"},discoveryLinks:{starter:"Available in Professional Plus or Growth+",professional:"Available in Professional Plus or Growth+"},aiAsk:{starter:"Available in Professional Plus or Growth+",professional:"Available in Professional Plus or Growth+"}}[e])?void 0:t[s])||"Upgrade to enable this feature"},xt=e=>{var t;if("aiSitemap"===e||"schemaData"===e)return!1;return(null==(t={professional_plus:[],growth_plus:[]}[j(null==I?void 0:I.plan)])?void 0:t.includes(e))||!1},ft=async e=>{if(!xt(e))return!0;try{const t=await Je(`/api/billing/tokens/balance?shop=${w}`);if(t.balance<=0){const s={aiSitemap:"ai-sitemap-optimized",schemaData:"ai-schema-advanced",welcomePage:"ai-welcome-page",collectionsJson:"ai-collections-json",storeMetadata:"ai-store-metadata"}[e]||e,n=(null==I?void 0:I.productCount)||0,a=i(s,{productCount:n});return we({feature:s,tokensRequired:a.withMargin,tokensAvailable:t.balance||0,tokensNeeded:a.withMargin}),xe(!0),!1}return!0}catch(t){return M("Error checking token balance"),!1}},yt=async(e,t)=>{var s,n,a,o,r,i,l,c,d;if(await ft(e)){ae(t),le(e),se(!0),de(!0),re(null);try{const t={productsJson:`/ai/products.json?shop=${w}`,collectionsJson:`/ai/collections-feed.json?shop=${w}`,storeMetadata:`/ai/store-metadata.json?shop=${w}`,schemaData:`/ai/schema-data.json?shop=${w}`,aiSitemap:`/api/sitemap/generate?shop=${w}&force=true`,welcomePage:`/ai/welcome?shop=${w}`,llmsTxt:`/llms.txt?shop=${w}`};if("aiSitemap"===e){const o=await fetch(t[e],{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${(null==(a=null==(n=null==(s=window.__SHOPIFY_APP_BRIDGE__)?void 0:s.getState())?void 0:n.session)?void 0:a.token)||""}`}});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);{const e=await o.text();re(e)}}else if("welcomePage"===e){const s=await fetch(t[e],{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${(null==(i=null==(r=null==(o=window.__SHOPIFY_APP_BRIDGE__)?void 0:o.getState())?void 0:r.session)?void 0:i.token)||""}`}});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);{const e=await s.text();re(e)}}else if("llmsTxt"===e){const s=await fetch(t[e],{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${(null==(d=null==(c=null==(l=window.__SHOPIFY_APP_BRIDGE__)?void 0:l.getState())?void 0:c.session)?void 0:d.token)||""}`}});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);{const e=await s.text();re(e)}}else{const s=await Je(t[e]);re(JSON.stringify(s,null,2))}}catch(u){re(`Error loading data: ${u.message}`)}finally{de(!1)}}};e.useEffect(()=>{},[z]),e.useEffect(()=>{q(!1),qe(!1),Le(!1),et.current=!1,tt.current=0},[]),e.useEffect(()=>{(null==I?void 0:I.features)&&w&&Ke()},[null==I?void 0:I.features,w,Ke]),e.useEffect(()=>{et.current&&!ze&&(et.current=!1,tt.current=0),w&&(null==I?void 0:I.features)&&Ke()},[]);try{return w?S?t.jsx(l,{children:t.jsx(c,{padding:"400",children:t.jsxs(u,{align:"center",children:[t.jsx(h,{size:"small"}),t.jsx(d,{children:"Loading settings..."})]})})}):I&&I.features?t.jsxs(m,{gap:"600",children:[t.jsx(l,{children:t.jsx(c,{padding:"400",children:t.jsxs(m,{gap:"400",children:[t.jsxs(u,{align:"space-between",children:[t.jsx(d,{as:"h2",variant:"headingMd",children:"AI Bot Access Control"}),(null==I?void 0:I.plan)&&t.jsxs(g,{tone:"info",children:[I.plan.charAt(0).toUpperCase()+I.plan.slice(1)," Plan"]})]}),t.jsx(d,{variant:"bodyMd",tone:"subdued",children:"Choose which AI bots can access your store's structured data"}),t.jsx(p,{status:"info",children:t.jsxs(m,{gap:"200",children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"How it works:"}),t.jsxs("ol",{style:{marginLeft:"20px",marginBottom:0},children:[t.jsx("li",{children:"Select AI bots below"}),t.jsx("li",{children:"Configure AI Discovery Features below"}),t.jsx("li",{children:'Click "Save Settings" at the bottom'}),t.jsx("li",{children:"Configure robots.txt (instructions will appear)"})]})]})}),t.jsx(x,{}),t.jsxs(m,{gap:"300",children:[t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["meta","anthropic"].map(e=>{var s,n,a;const o=null==(s=null==I?void 0:I.bots)?void 0:s[e];if(!o)return null;const r={starter:["meta","anthropic"],professional:["meta","anthropic","google"],growth:["meta","anthropic","google","openai"],growth_extra:["meta","anthropic","google","openai","perplexity"],enterprise:["meta","anthropic","google","openai","perplexity","others"]},i=(r[j(null==I?void 0:I.plan)]||r.starter).includes(e),l="google"===e?"Professional":"openai"===e?"Growth":"perplexity"===e?"Growth Extra":"others"===e?"Enterprise":null;return t.jsx(c,{padding:"200",background:i?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:t.jsx(m,{gap:"100",children:t.jsx(f,{label:t.jsxs(u,{gap:"200",align:"center",children:[t.jsx(d,{variant:i?"bodyMd":"bodySm",tone:i?"base":"subdued",children:o.name||e}),!i&&l&&t.jsx(g,{tone:"info",size:"small",children:"Upgrade"})]}),checked:!!(null==(a=null==(n=null==I?void 0:I.bots)?void 0:n[e])?void 0:a.enabled),onChange:()=>ot(e),disabled:!i,helpText:i?"meta"===e?"Meta AI platforms":"anthropic"===e?"Claude AI assistant":"google"===e?"Google Gemini":"openai"===e?"ChatGPT":"perplexity"===e?"AI-powered search":"others"===e?"Deepseek, Bytespider & others":"":`Upgrade to ${l} plan to enable this AI bot`})})},e)})}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["google","openai"].map(e=>{var s,n,a,o;const r=null==(s=null==I?void 0:I.bots)?void 0:s[e];if(!r)return null;const i=null==(n=null==I?void 0:I.availableBots)?void 0:n.includes(e),l="google"===e?"Professional":"openai"===e?"Growth":"perplexity"===e?"Growth Extra":"others"===e?"Enterprise":null;return t.jsx(c,{padding:"200",background:i?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:t.jsx(m,{gap:"100",children:t.jsx(f,{label:t.jsxs(u,{gap:"200",align:"center",children:[t.jsx(d,{variant:i?"bodyMd":"bodySm",tone:i?"base":"subdued",children:r.name||e}),!i&&l&&t.jsx(g,{tone:"info",size:"small",children:"Upgrade"})]}),checked:!!(null==(o=null==(a=null==I?void 0:I.bots)?void 0:a[e])?void 0:o.enabled),onChange:()=>ot(e),disabled:!i,helpText:i?"meta"===e?"Meta AI platforms":"anthropic"===e?"Claude AI assistant":"google"===e?"Google Gemini":"openai"===e?"ChatGPT":"perplexity"===e?"AI-powered search":"others"===e?"Deepseek, Bytespider & others":"":`Upgrade to ${l} plan to enable this AI bot`})})},e)})}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["perplexity","others"].map(e=>{var s,n,a,o;const r=null==(s=null==I?void 0:I.bots)?void 0:s[e];if(!r)return null;const i=null==(n=null==I?void 0:I.availableBots)?void 0:n.includes(e),l="google"===e?"Professional":"openai"===e?"Growth":"perplexity"===e?"Growth Extra":"others"===e?"Enterprise":null;return t.jsx(c,{padding:"200",background:i?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:t.jsx(m,{gap:"100",children:t.jsx(f,{label:t.jsxs(u,{gap:"200",align:"center",children:[t.jsx(d,{variant:i?"bodyMd":"bodySm",tone:i?"base":"subdued",children:r.name||e}),!i&&l&&t.jsx(g,{tone:"info",size:"small",children:"Upgrade"})]}),checked:!!(null==(o=null==(a=null==I?void 0:I.bots)?void 0:a[e])?void 0:o.enabled),onChange:()=>ot(e),disabled:!i,helpText:i?"meta"===e?"Meta AI platforms":"anthropic"===e?"Claude AI assistant":"google"===e?"Google Gemini":"openai"===e?"ChatGPT":"perplexity"===e?"AI-powered search":"others"===e?"Deepseek, Bytespider & others":"":`Upgrade to ${l} plan to enable this AI bot`})})},e)})})]})]})})}),t.jsx(l,{children:t.jsx(c,{padding:"400",children:t.jsxs(m,{gap:"400",children:[t.jsx(d,{as:"h2",variant:"headingMd",children:"AI Discovery Features"}),t.jsx(d,{variant:"bodyMd",tone:"subdued",children:"Select the features you want to enable for AI bots to consume your store data."}),t.jsx(p,{status:"info",children:'Don\'t forget to click "Save Settings" after making changes.'}),t.jsx(x,{}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1rem"},children:[{key:"productsJson",name:"Products JSON Feed",description:"Bulk product data for AI consumption",requiredPlan:"Starter"},{key:"storeMetadata",name:"Store Metadata for AI Search",description:"Organization schema & AI metadata",requiredPlan:"Professional"},{key:"welcomePage",name:"AI Welcome Page",description:"Landing page for AI bots",requiredPlan:"Growth"},{key:"collectionsJson",name:"Collections JSON Feed",description:"Category data for better AI understanding",requiredPlan:"Growth"},{key:"llmsTxt",name:"LLMs.txt File",description:"AI discovery file (llmstxt.org standard) â€” helps AI agents find your store data",requiredPlan:"Starter"},{key:"discoveryLinks",name:"AI Discovery Links",description:'Adds <link rel="alternate"> tags in your store\'s <head> for AI crawler discovery',requiredPlan:"Growth"},{key:"aiAsk",name:"AI Ask Endpoint",description:"Interactive endpoint â€” AI agents can ask questions about your store and get answers based on real data",requiredPlan:"Growth"}].map(e=>{var s;const n=mt(e.key),a=!!(null==(s=null==I?void 0:I.features)?void 0:s[e.key]);return t.jsx(c,{padding:"200",background:n?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:n?t.jsx(m,{gap:"200",children:t.jsxs(u,{align:"space-between",blockAlign:"center",children:[t.jsx(c,{flexGrow:1,children:t.jsx(f,{label:e.name,checked:a,onChange:()=>rt(e.key),helpText:e.description})}),"productsJson"===e.key&&F&&t.jsx(y,{size:"slim",onClick:()=>yt(e.key,e.name),children:"View"}),"collectionsJson"===e.key&&N&&t.jsx(y,{size:"slim",onClick:()=>yt(e.key,e.name),children:"View"}),"storeMetadata"===e.key&&a&&(J?t.jsx(y,{size:"slim",onClick:()=>yt(e.key,e.name),children:"View"}):t.jsx(y,{size:"slim",variant:"primary",onClick:async()=>{if(!(await ft("storeMetadata")))return;const e=`/ai-seo/store-metadata?shop=${w}`;window.open(e,"_blank")},children:"Configure"})),"welcomePage"===e.key&&Y&&t.jsx(y,{size:"slim",onClick:()=>yt(e.key,e.name),children:"View"}),"llmsTxt"===e.key&&a&&t.jsx(y,{size:"slim",onClick:()=>yt(e.key,e.name),children:"View"})]})}):t.jsx(f,{label:t.jsxs(u,{gap:"200",align:"center",children:[t.jsx(d,{variant:"bodySm",tone:"subdued",children:e.name}),e.requiredPlan&&t.jsx(g,{tone:"info",size:"small",children:"Upgrade"})]}),checked:!1,onChange:()=>rt(e.key),disabled:!0,helpText:gt(e.key)})},e.key)})})]})})}),t.jsxs(u,{gap:"200",align:"end",children:[t.jsx(y,{tone:"critical",onClick:async()=>{if(window.confirm("Are you sure you want to reset all AI Discovery settings to defaults?"))try{await Je(`/api/ai-discovery/settings?shop=${w}`,{method:"DELETE",shop:w}),M("Settings reset successfully"),he(null),setTimeout(()=>{window.location.reload()},1e3)}catch(e){M("Failed to reset settings")}},children:"Reset to Defaults"}),t.jsx(y,{primary:!0,size:"large",loading:k,onClick:it,children:"Save Settings"})]}),!Z&&Object.values((null==I?void 0:I.bots)||{}).some(e=>e.enabled)&&t.jsx(l,{children:t.jsx(c,{padding:"400",children:t.jsxs(m,{gap:"400",children:[t.jsxs(u,{align:"space-between",children:[t.jsx(d,{as:"h2",variant:"headingMd",children:"ðŸ“‹ robots.txt Configuration"}),t.jsx(g,{tone:"critical",children:"REQUIRED"})]}),t.jsx(p,{status:"info",title:"AI Discovery requires robots.txt configuration",children:t.jsx("p",{children:"Your AI bot settings are saved. Install robots.txt to enable AI bot access to your store."})}),(()=>{const e=new URLSearchParams(window.location.search).get("testPlan")||(null==I?void 0:I.plan),s=r(e)>=4;return t.jsxs(m,{gap:"300",children:[t.jsxs(u,{gap:"300",wrap:!1,children:[s?t.jsx(y,{variant:"primary",size:"large",loading:lt,onClick:()=>pt(!0),children:"Auto-Install to Theme"}):t.jsx(y,{size:"large",onClick:()=>ut(!0),children:"Auto-Install (Growth Plus+)"}),t.jsx(y,{size:"large",variant:s?"secondary":"primary",onClick:async()=>{try{Object.values((null==I?void 0:I.bots)||{}).some(e=>e.enabled)?(await at(),$(!0)):ee(!0)}catch(e){M("Error generating robots.txt: "+e.message)}},children:"View & Copy Code"})]}),t.jsx(d,{variant:"bodySm",tone:"subdued",children:s?"Auto-Install replaces existing robots.txt.liquid. Use 'View & Copy Code' if you have custom rules to preserve.":"Upgrade to Growth Plus for automatic installation, or copy the code manually."})]})})(),t.jsx(x,{}),t.jsxs(m,{gap:"300",children:[t.jsx(d,{variant:"headingMd",children:"Installation Options:"}),t.jsx(p,{status:"success",title:"Option 1: Automatic Installation (Recommended)",children:t.jsxs(m,{gap:"200",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Growth Plus+ plans:"}),' Click "Auto-Install to Theme" for one-click installation.']}),t.jsxs("p",{children:["This creates ",t.jsx("code",{children:"templates/robots.txt.liquid"})," with AI bot access rules automatically."]})]})}),t.jsx(p,{status:"info",title:"Option 2: Manual Installation",children:t.jsxs(m,{gap:"200",children:[t.jsx("p",{children:t.jsx("strong",{children:"Use this option if:"})}),t.jsxs("ul",{style:{marginLeft:"20px",marginTop:"5px"},children:[t.jsx("li",{children:"Your plan does not include Auto-Install"}),t.jsx("li",{children:"You have an existing robots.txt.liquid with custom rules you want to preserve"}),t.jsx("li",{children:"You prefer manual control over theme files"})]}),t.jsx("p",{style:{marginTop:"10px"},children:t.jsx("strong",{children:"Steps:"})}),t.jsxs("ol",{style:{marginLeft:"20px",marginTop:"5px",lineHeight:"1.6"},children:[t.jsx("li",{children:'Click "View & Copy Code" to see your custom robots.txt'}),t.jsxs("li",{children:["Go to ",t.jsx("strong",{children:"Online Store â†’ Themes â†’ Edit code"})]}),t.jsxs("li",{children:["Find ",t.jsx("code",{children:"templates/robots.txt.liquid"})]}),t.jsxs("li",{children:["If file exists: ",t.jsx("strong",{children:"Add"})," the code to the end (do not replace)"]}),t.jsx("li",{children:"If no file: Create new file and paste the code"}),t.jsx("li",{children:"Save the file"})]})]})}),t.jsx(p,{status:"warning",children:t.jsxs("p",{children:[t.jsx("strong",{children:"Have custom robots.txt rules?"}),' Use "View & Copy Code" and manually add our AI bot rules to your existing file. Auto-Install will replace existing content.']})}),t.jsx(p,{tone:"info",children:t.jsxs("p",{children:[t.jsx("strong",{children:"Note:"})," Our configuration does NOT block standard search engines (Google, Bing). It only adds access rules for AI bots. Shopify default rules remain active."]})})]}),t.jsx(p,{status:"info",children:t.jsxs("p",{children:["ðŸ’¡ ",t.jsx("strong",{children:"Why this matters:"})," The robots.txt file tells AI bots (OpenAI, Anthropic, Google, etc.) which pages and endpoints they can access to properly understand and index your products for AI search results and recommendations."]})})]})})}),O&&t.jsx(b,{open:O,onClose:()=>$(!1),title:"robots.txt Configuration",primaryAction:{content:"Copy to clipboard",onAction:()=>{navigator.clipboard.writeText(T),M("Copied to clipboard!")}},secondaryActions:[{content:"Close",onAction:()=>$(!1)}],children:t.jsx(b.Section,{children:t.jsxs(m,{gap:"400",children:[!["growth","growth_extra","enterprise"].includes(j(null==I?void 0:I.plan))&&t.jsx(p,{status:"info",title:"Manual Configuration Steps",children:t.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[t.jsx("li",{children:"Copy the robots.txt content below"}),t.jsxs("li",{children:["Go to ",t.jsx("strong",{children:"Online Store â†’ Themes"})]}),t.jsxs("li",{children:["Click ",t.jsx("strong",{children:"Actions â†’ Edit code"})," on your active theme"]}),t.jsxs("li",{children:["In the file browser, look for ",t.jsx("strong",{children:"templates/robots.txt.liquid"})]}),t.jsxs("li",{children:[t.jsx("strong",{children:"If file exists:"})," Add the copied code to the end (don't replace existing content)"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"If file doesn't exist:"})," Click ",t.jsx("strong",{children:"Add a new file"}),", type ",t.jsx("code",{children:"templates/robots.txt.liquid"}),", and paste the code"]}),t.jsxs("li",{children:["Click ",t.jsx("strong",{children:"Save"})]})]})}),t.jsx(c,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:t.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:T})})]})})}),X&&t.jsx(b,{open:X,onClose:()=>ee(!1),title:"No AI Bots Selected",primaryAction:{content:"Got it",onAction:()=>ee(!1)},children:t.jsx(b.Section,{children:t.jsxs(m,{gap:"400",children:[t.jsx(p,{status:"warning",children:t.jsx("p",{children:"You haven't selected any AI bots yet."})}),t.jsx(d,{children:"To configure robots.txt:"}),t.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[t.jsx("li",{children:'Select AI bots from the "AI Bot Access Control" section above'}),t.jsx("li",{children:'Click "Save Settings" to save your selections'}),t.jsx("li",{children:'Then click "Generate robots.txt" to configure'})]})]})})}),te&&t.jsx(b,{open:te,onClose:()=>{se(!1),re(null),le(null)},title:ne,primaryAction:{content:"Copy",onAction:()=>{navigator.clipboard.writeText(oe),M("Copied to clipboard!")},disabled:ce},secondaryActions:[{content:"Close",onAction:()=>{se(!1),re(null),le(null)}}],children:t.jsx(b.Section,{children:t.jsx(c,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:ce?t.jsxs(u,{align:"center",gap:"200",children:[t.jsx(h,{size:"small"}),t.jsx(d,{variant:"bodyMd",children:"AI-Optimized Sitemap"===ne?"Loading sitemap XML... This may take a moment for large stores.":"Loading..."})]}):"welcomePage"===ie?t.jsx("div",{style:{border:"1px solid #e1e3e5",borderRadius:"8px",overflow:"hidden",maxHeight:"600px",backgroundColor:"#fff"},children:t.jsx("iframe",{srcDoc:oe,style:{width:"100%",height:"600px",border:"none",display:"block"},title:"AI Welcome Page Preview",sandbox:"allow-same-origin"})}):t.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:oe})})})}),Oe&&"NO_OPTIMIZED_PRODUCTS"===Ge&&t.jsx(b,{open:!0,title:"No Optimized Products Found",onClose:async()=>{$e(!1),Me(null);try{await Je(`/api/schema/dismiss-error?shop=${w}`,{method:"POST"})}catch(e){}},primaryAction:{content:"Go to Search Optimization",onAction:async()=>{$e(!1),Me(null);try{await Je(`/api/schema/dismiss-error?shop=${w}`,{method:"POST"})}catch(s){}const e=new URLSearchParams(window.location.search),t=e.toString()?`?${e.toString()}`:"";window.location.href=`/ai-seo${t}`}},secondaryActions:[{content:"Cancel",onAction:async()=>{$e(!1),Me(null);try{await Je(`/api/schema/dismiss-error?shop=${w}`,{method:"POST"})}catch(e){}}}],children:t.jsx(b.Section,{children:t.jsxs(m,{gap:"400",children:[t.jsx(p,{status:"warning",children:t.jsx("p",{children:"No optimized products were found in your store."})}),t.jsx(d,{children:"Advanced Schema Data requires at least basic AISEO optimization on your products. Please run AISEO optimization first, then try generating schemas again."}),t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"You can choose:"}),t.jsxs(m,{gap:"200",children:[t.jsxs(d,{children:["â€¢ ",t.jsx("strong",{children:"Basic AISEO"})," - Free AISEO optimization"]}),t.jsxs(d,{children:["â€¢ ",t.jsx("strong",{children:"AI-Enhanced AISEO"})," - Advanced optimization (requires tokens)"]})]})]})})}),Oe&&"ONLY_BASIC_SEO"===Ge&&t.jsx(b,{open:!0,title:"AI-Enhanced Optimization Recommended",onClose:async()=>{$e(!1),Me(null);try{await Je(`/api/schema/dismiss-error?shop=${w}`,{method:"POST"})}catch(e){}},primaryAction:{content:"Generate AI-Enhanced Add-ons",onAction:async()=>{$e(!1),Me(null);try{await Je(`/api/schema/dismiss-error?shop=${w}`,{method:"POST"})}catch(s){}const e=new URLSearchParams(window.location.search),t=e.toString()?`?${e.toString()}`:"";window.location.href=`/ai-seo${t}`}},secondaryActions:[{content:"Proceed with Basic AISEO",onAction:async()=>{$e(!1),Me(null);try{M("Starting schema generation with basic AISEO..."),await Je(`/api/schema/generate-all?shop=${w}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({forceBasicSeo:!0})}),Ye()}catch(e){M("Failed to generate schema: "+(e.message||"Unknown error"))}}}],children:t.jsx(b.Section,{children:t.jsxs(m,{gap:"400",children:[t.jsx(p,{status:"info",children:t.jsx("p",{children:"Only basic AISEO optimization was found on your products."})}),t.jsx(d,{children:"For best results with Advanced Schema Data, we recommend running AI-Enhanced AISEO optimization first. This will provide richer product data for schema generation."}),t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"What would you like to do?"}),t.jsxs(m,{gap:"200",children:[t.jsxs(d,{children:["â€¢ ",t.jsx("strong",{children:"Generate AI-Enhanced Add-ons"})," - Get the best results (requires tokens)"]}),t.jsxs(d,{children:["â€¢ ",t.jsx("strong",{children:"Proceed with Basic AISEO"})," - Continue with current basic AISEO"]})]})]})})}),G&&t.jsx(v,{content:G,onDismiss:()=>M("")}),Se&&t.jsxs(t.Fragment,{children:[t.jsx(n,{open:ge,onClose:()=>{xe(!1),Ae(null)},feature:Se.feature||"ai-sitemap-optimized",tokensRequired:Se.tokensRequired||0,tokensAvailable:Se.tokensAvailable||0,tokensNeeded:Se.tokensNeeded||0,shop:w,needsUpgrade:Se.needsUpgrade||!1,minimumPlan:Se.minimumPlanForFeature||null,currentPlan:Se.currentPlan||(null==I?void 0:I.plan)||"starter",returnTo:"/settings",onBuyTokens:()=>{xe(!1),ve(!0)}}),t.jsx(a,{open:fe,onClose:()=>{ye(!1),Ae(null)},feature:Se.feature||"ai-sitemap-optimized",trialEndsAt:Se.trialEndsAt,currentPlan:Se.currentPlan||(null==I?void 0:I.plan)||"enterprise",tokensRequired:Se.tokensRequired||0,onActivatePlan:async()=>{try{const e=await Je("/api/billing/activate",{method:"POST",body:JSON.stringify({shop:w,endTrial:!0,returnTo:"/settings"})});if(e.requiresApproval&&e.confirmationUrl)return void(window.top.location.href=e.confirmationUrl);window.location.reload()}catch(e){const t=new URLSearchParams(window.location.search),s=t.get("host"),n=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(w)}&embedded=${n}&host=${encodeURIComponent(s)}`}},onPurchaseTokens:()=>{ye(!1),ve(!0)},shop:w})]}),!Se&&ge&&t.jsx(n,{open:ge,onClose:()=>xe(!1),feature:je.feature,tokensRequired:je.tokensRequired,tokensAvailable:je.tokensAvailable,tokensNeeded:je.tokensNeeded,shop:w,needsUpgrade:!1,minimumPlan:null,currentPlan:(null==I?void 0:I.plan)||"starter",returnTo:"/settings",onBuyTokens:()=>{xe(!1),ve(!0)}}),t.jsx(o,{open:be,onClose:()=>{ve(!1),Ae(null)},shop:w,returnTo:"/settings",inTrial:!0}),ht&&t.jsx(b,{open:ht,onClose:()=>pt(!1),title:"Install robots.txt to Theme",primaryAction:{content:"Install",onAction:()=>{pt(!1),(async()=>{ct(!0);try{await Je(`/api/ai-discovery/apply-robots?shop=${w}`,{method:"POST",body:{shop:w}}),M("robots.txt.liquid installed successfully! AI bots can now discover your store.")}catch(e){M("Failed to install: "+(e.message||"Unknown error. You may need to re-authorize the app."))}finally{ct(!1)}})()}},secondaryActions:[{content:"Cancel",onAction:()=>pt(!1)}],children:t.jsx(b.Section,{children:t.jsxs(m,{gap:"400",children:[t.jsx(p,{status:"warning",children:t.jsxs("p",{children:[t.jsx("strong",{children:"Warning:"})," This will replace any existing ",t.jsx("code",{children:"robots.txt.liquid"})," file in your theme."]})}),t.jsxs(d,{children:["If you have custom robots.txt rules that you want to keep, use ",t.jsx("strong",{children:'"View & Copy Code"'})," instead and manually add our AI bot rules to your existing file."]}),t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Do you want to proceed with automatic installation?"})]})})}),dt&&t.jsx(b,{open:dt,onClose:()=>ut(!1),title:"Upgrade for Auto-Install",primaryAction:{content:"Upgrade to Growth Plus",onAction:()=>{const e=new URLSearchParams(window.location.search),t=e.get("host"),s=e.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(w)}&embedded=${s}&host=${encodeURIComponent(t)}`}},secondaryActions:[{content:"Use Manual Install",onAction:async()=>{ut(!1),await at(),$(!0)}}],children:t.jsx(b.Section,{children:t.jsxs(m,{gap:"400",children:[t.jsx(p,{status:"info",children:t.jsxs("p",{children:["Auto-Install to Theme is available on ",t.jsx("strong",{children:"Growth Plus"})," plan and higher."]})}),t.jsx(d,{children:"This feature automatically installs the robots.txt.liquid file to your Shopify theme, saving you time and ensuring correct configuration."}),t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Your options:"}),t.jsxs(m,{gap:"200",children:[t.jsxs(d,{children:["â€¢ ",t.jsx("strong",{children:"Upgrade to Growth Plus"})," - Get Auto-Install and many more features"]}),t.jsxs(d,{children:["â€¢ ",t.jsx("strong",{children:"Use Manual Install"})," - Copy the code and paste it in your theme editor"]})]})]})})})]}):t.jsx(l,{children:t.jsx(c,{padding:"400",children:t.jsx(p,{status:"critical",children:t.jsx(d,{children:"Failed to load settings. Please refresh the page."})})})}):t.jsx(l,{children:t.jsx(c,{padding:"400",children:t.jsx(d,{tone:"critical",children:"Missing shop parameter"})})})}catch(bt){return t.jsx(m,{gap:"400",children:t.jsx(l,{children:t.jsxs(c,{padding:"400",children:[t.jsx(d,{variant:"headingMd",children:"Settings Error"}),t.jsx(c,{paddingBlockStart:"200",children:t.jsxs(d,{children:["Failed to load settings: ",bt.message]})})]})})})}}export{j as default};
