import{r as e,j as n}from"./react-vendor-BXVC7v0l.js";import{m as t}from"./sessionFetch-CeBL7Ait.js";import{C as s,B as i,a,d as o,I as r,i as d,T as l,b as c,o as u,p,q as h,M as g,l as m}from"./polaris-CyaoFo5Q.js";import"./app-bridge-DUY42B6P.js";import"./vendor-Cs_VgJ2r.js";import"./index-ByiDf9QT.js";function x({shop:x}){var j;const b=x||((e,n="")=>{try{return new URLSearchParams(window.location.search).get(e)||n}catch{return n}})("shop",""),[v,f]=e.useState(null),[y,S]=e.useState(!1),[w,k]=e.useState(""),[A,C]=e.useState(null),[_,M]=e.useState(null),[I,B]=e.useState(!1),P=e.useMemo(()=>t(),[]),[E,W]=e.useState(!1),[L,$]=e.useState(null),[q,T]=e.useState(!1),F=e.useCallback(async()=>{if(b)try{const e=await P(`/api/sitemap/info?shop=${b}`);f(e)}catch(e){k(e.message||"Failed to load sitemap info")}},[b,P]),R=e.useCallback(async()=>{var e,n,t;if(b)try{const s="\n        query PlansMe($shop:String!) {\n          plansMe(shop:$shop) {\n            shop\n            plan\n            planKey\n            priceUsd\n            product_limit\n            collection_limit\n            language_limit\n            providersAllowed\n            modelsSuggested\n            autosyncCron\n            trial {\n              active\n              ends_at\n              days_left\n            }\n          }\n        }\n      ",i=await P("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:s,variables:{shop:b}})});if(null==(e=null==i?void 0:i.errors)?void 0:e.length)throw new Error((null==(n=i.errors[0])?void 0:n.message)||"GraphQL error");const a=null==(t=null==i?void 0:i.data)?void 0:t.plansMe;C(a||null)}catch(s){}},[b,P]),z=e.useCallback(async()=>{var e,n,t,s;if(b){S(!0),M(null);try{const i=await fetch(`/api/sitemap/generate?shop=${encodeURIComponent(b)}`,{method:"POST",credentials:"include",headers:{Authorization:`Bearer ${(null==(t=null==(n=null==(e=window.__SHOPIFY_APP_BRIDGE__)?void 0:e.getState())?void 0:n.session)?void 0:t.token)||""}`,"Content-Type":"application/json"}});if(i.ok){const e=await i.json();e.success?(k(e.message||"Sitemap generation started!"),M(e.job),(null==(s=e.job)?void 0:s.queued)&&B(!0)):k(e.message||"Sitemap generation failed")}else{const e=await i.text();k(`Sitemap generation failed: ${e}`)}}catch(i){k(i.message||"Sitemap generation failed")}finally{S(!1)}}},[b]),G=e.useCallback(async()=>{if(b&&I)try{const e=await P(`/api/sitemap/status?shop=${b}`);M(e.queue),"completed"!==e.queue.status&&"failed"!==e.queue.status&&"idle"!==e.queue.status||(B(!1),k(e.queue.message||"Sitemap generation completed!"),await F())}catch(e){}},[b,I,P,F]);e.useEffect(()=>{if(I){const e=setInterval(G,3e3);return()=>clearInterval(e)}},[I,G]);const U=e.useCallback(async()=>{var e,n,t;if(b){W(!0),T(!0),$(null);try{const s=await fetch(`/api/sitemap/generate?shop=${encodeURIComponent(b)}&force=true&t=${Date.now()}`,{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${(null==(t=null==(n=null==(e=window.__SHOPIFY_APP_BRIDGE__)?void 0:e.getState())?void 0:n.session)?void 0:t.token)||""}`}});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);{const e=await s.text();$(e)}}catch(s){$(`Error loading sitemap: ${s.message}`)}finally{T(!1)}}},[b]);return e.useEffect(()=>{F(),R()},[F,R]),n.jsxs(s,{children:[n.jsx(i,{padding:"400",children:n.jsxs(a,{gap:"400",children:[n.jsx(o,{tone:"info",children:n.jsxs("p",{children:["Your ",(null==A?void 0:A.plan)||"Starter"," plan includes up to"," ",n.jsxs("strong",{children:[(null==(j=null==A?void 0:A.product_limit)?void 0:j.toLocaleString())||"70"," products in up to ",(null==A?void 0:A.language_limit)||1," language",((null==A?void 0:A.language_limit)||1)>1?"s":""]}),".",(null==v?void 0:v.productCount)&&(null==A?void 0:A.product_limit)&&v.productCount>A.product_limit&&n.jsxs(n.Fragment,{children:[" You have ",v.productCount," products, so only the first"," ",A.product_limit.toLocaleString()," ","will be included in the sitemap."]})]})}),(I||_)&&n.jsx(o,{tone:"processing"===(null==_?void 0:_.status)?"info":"failed"===(null==_?void 0:_.status)?"critical":"success",children:n.jsxs(a,{gap:"200",children:[n.jsxs(r,{gap:"200",blockAlign:"center",children:[I&&n.jsx(d,{size:"small"}),n.jsx(l,{variant:"bodyMd",fontWeight:"medium",children:(null==_?void 0:_.message)||"Processing..."})]}),(null==_?void 0:_.position)>0&&n.jsxs(l,{variant:"bodySm",tone:"subdued",children:["Position in queue: ",_.position," | Estimated time: ~",_.estimatedTime,"s"]}),(null==_?void 0:_.queueLength)>0&&n.jsxs(l,{variant:"bodySm",tone:"subdued",children:["Queue length: ",_.queueLength," job(s)"]})]})}),n.jsxs(r,{align:"space-between",blockAlign:"center",children:[n.jsxs(i,{children:[n.jsx(l,{variant:"headingMd",as:"h3",children:"Sitemap Generator"}),n.jsx(l,{variant:"bodySm",tone:"subdued",children:"Generate structured sitemap for AI models to discover and index your products"})]}),n.jsx(c,{primary:!0,onClick:z,loading:y,disabled:y,children:y?"Generating...":"Generate Sitemap"})]}),v&&n.jsx(i,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:n.jsxs(a,{gap:"300",children:[n.jsx(r,{gap:"200",blockAlign:"center",children:v.generated?n.jsxs(n.Fragment,{children:[n.jsx(u,{source:p,tone:"success"}),n.jsx(l,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:"Sitemap Active"})]}):n.jsxs(n.Fragment,{children:[n.jsx(u,{source:h}),n.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"No Sitemap Found"})]})}),v.generated&&n.jsxs(a,{gap:"400",children:[n.jsx(i,{children:n.jsxs(a,{gap:"200",children:[n.jsx(i,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:n.jsxs(r,{align:"space-between",children:[n.jsx(l,{variant:"bodyMd",color:"subdued",children:"Products included"}),n.jsxs(l,{variant:"bodyMd",fontWeight:"semibold",children:[v.lastProductCount||0," URLs"]})]})}),n.jsx(i,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:n.jsxs(r,{align:"space-between",children:[n.jsx(l,{variant:"bodyMd",color:"subdued",children:"File size"}),n.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:v.size?`${(v.size/1024).toFixed(2)} KB`:"Unknown"})]})}),n.jsx(i,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:n.jsxs(r,{align:"space-between",children:[n.jsx(l,{variant:"bodyMd",color:"subdued",children:"Last updated"}),n.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:v.generatedAt?new Date(v.generatedAt).toLocaleString():"Unknown"})]})})]})}),n.jsx(i,{children:n.jsx(c,{fullWidth:!0,onClick:U,children:"View Sitemap"})})]})]})}),n.jsxs(i,{paddingBlockStart:"400",children:[n.jsx(l,{variant:"headingMd",as:"h4",children:"What's included:"}),n.jsx(i,{paddingBlockStart:"200",children:n.jsxs(a,{gap:"200",children:[n.jsxs(r,{gap:"200",blockAlign:"start",children:[n.jsx(i,{minWidth:"24px",children:n.jsx(u,{source:p,tone:"positive"})}),n.jsx(l,{children:"All active products with structured URLs for AI parsing"})]}),n.jsxs(r,{gap:"200",blockAlign:"start",children:[n.jsx(i,{minWidth:"24px",children:n.jsx(u,{source:p,tone:"positive"})}),n.jsx(l,{children:"Priority rankings to help AI models understand product importance"})]}),n.jsxs(r,{gap:"200",blockAlign:"start",children:[n.jsx(i,{minWidth:"24px",children:n.jsx(u,{source:p,tone:"positive"})}),n.jsx(l,{children:"Multi-language URLs for international AI search coverage"})]}),n.jsxs(r,{gap:"200",blockAlign:"start",children:[n.jsx(i,{minWidth:"24px",children:n.jsx(u,{source:p,tone:"positive"})}),n.jsx(l,{children:"Standard XML format that AI crawlers understand"})]})]})})]}),n.jsxs(i,{paddingBlockStart:"200",children:[n.jsx(l,{variant:"headingMd",as:"h4",children:"How it helps AI models:"}),n.jsx(i,{paddingBlockStart:"200",children:n.jsxs(a,{gap:"200",children:[n.jsx(l,{children:'1. Click "Generate Sitemap" to create a structured map of your products'}),n.jsx(l,{children:"2. The sitemap is automatically saved and available to AI crawlers"}),n.jsx(l,{children:"3. AI models can discover and understand your product catalog structure"}),n.jsx(l,{children:"4. Regenerate when you add new products to keep AI models updated"})]})})]})]})}),E&&n.jsx(g,{open:E,onClose:()=>{W(!1),$(null)},title:"AI-Optimized Sitemap",primaryAction:{content:"Copy",onAction:()=>{navigator.clipboard.writeText(L),k("Copied to clipboard!")},disabled:q},secondaryActions:[{content:"Close",onAction:()=>{W(!1),$(null)}}],children:n.jsx(g.Section,{children:n.jsx(i,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:q?n.jsxs(r,{align:"center",gap:"200",children:[n.jsx(d,{size:"small"}),n.jsx(l,{variant:"bodyMd",children:"Loading sitemap XML... This may take a moment for large stores."})]}):n.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:L})})})}),w&&n.jsx(m,{content:w,onDismiss:()=>k("")})]})}export{x as default};
