import{j as e}from"./app-bridge-B_GFuTgx-1759004618997.js";import{r as c}from"./react-vendor-tAaa2TlE-1759004618997.js";import{m as E}from"./index-B4vJC-vj-1759004618997.js";import{C as M,a as r,d as h,h as P,I as i,T as t,B as v,n as u,o as j,p as W,q as G,k as _}from"./polaris-BDn9RGC4-1759004618997.js";const R=(f,n="")=>{try{return new URLSearchParams(window.location.search).get(f)||n}catch{return n}};function $({shop:f}){const n=f||R("shop",""),[a,A]=c.useState(null),[S,y]=c.useState(!1),[k,p]=c.useState(""),[s,I]=c.useState(null),m=c.useMemo(()=>E(),[]),b=c.useCallback(async()=>{if(n)try{const o=await m(`/api/sitemap/info?shop=${n}`);A(o)}catch(o){p(o.message||"Failed to load sitemap info")}},[n,m]),w=c.useCallback(async()=>{var o,x,g;if(n)try{const d=await m("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
        query PlansMe($shop:String!) {
          plansMe(shop:$shop) {
            shop
            plan
            planKey
            priceUsd
            ai_queries_used
            ai_queries_limit
            product_limit
            providersAllowed
            modelsSuggested
            autosyncCron
            trial {
              active
              ends_at
              days_left
            }
          }
        }
      `,variables:{shop:n}})});if((o=d==null?void 0:d.errors)!=null&&o.length)throw new Error(((x=d.errors[0])==null?void 0:x.message)||"GraphQL error");const C=(g=d==null?void 0:d.data)==null?void 0:g.plansMe;I(C||null)}catch{}},[n,m]),B=c.useCallback(async()=>{var o,x,g;if(n){y(!0);try{const l=await fetch(`/api/sitemap/generate?shop=${encodeURIComponent(n)}`,{method:"POST",credentials:"include",headers:{Authorization:`Bearer ${((g=(x=(o=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:o.getState())==null?void 0:x.session)==null?void 0:g.token)||""}`}});if(l.ok)p("Sitemap generated successfully!"),await b();else{const d=await l.text();p(`Sitemap generation failed: ${d}`)}}catch(l){p(l.message||"Sitemap generation failed")}finally{y(!1)}}},[n,b]);return c.useEffect(()=>{b(),w()},[b,w]),e.jsxs(M,{children:[e.jsx(r,{padding:"400",children:e.jsxs(h,{gap:"400",children:[e.jsx(P,{tone:"info",children:e.jsxs("p",{children:["Your ",(s==null?void 0:s.plan)||"Starter"," plan includes up to"," ",e.jsx("strong",{children:(s==null?void 0:s.plan)==="Starter"?100:(s==null?void 0:s.plan)==="Professional"?350:(s==null?void 0:s.plan)==="Growth"?1e3:(s==null?void 0:s.plan)==="Growth Extra"?2500:(s==null?void 0:s.plan)==="Enterprise"?6e3:100})," ","URLs in the sitemap.",(a==null?void 0:a.productCount)&&a.productCount>((s==null?void 0:s.plan)==="Starter"?100:(s==null?void 0:s.plan)==="Professional"?350:(s==null?void 0:s.plan)==="Growth"?1e3:(s==null?void 0:s.plan)==="Growth Extra"?2500:(s==null?void 0:s.plan)==="Enterprise"?6e3:100)&&e.jsxs(e.Fragment,{children:[" You have ",a.productCount," products, so only the first"," ",(s==null?void 0:s.plan)==="Starter"?100:(s==null?void 0:s.plan)==="Professional"?350:(s==null?void 0:s.plan)==="Growth"?1e3:(s==null?void 0:s.plan)==="Growth Extra"?2500:(s==null?void 0:s.plan)==="Enterprise"?6e3:100," will be included."]})]})}),e.jsxs(i,{align:"space-between",blockAlign:"center",children:[e.jsxs(r,{children:[e.jsx(t,{variant:"headingMd",as:"h3",children:"Sitemap Generator"}),e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Generate structured sitemap for AI models to discover and index your products"})]}),e.jsx(v,{primary:!0,onClick:B,loading:S,disabled:S,children:S?"Generating...":"Generate Sitemap"})]}),a&&e.jsx(r,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(h,{gap:"300",children:[e.jsx(i,{gap:"200",blockAlign:"center",children:a.generated?e.jsxs(e.Fragment,{children:[e.jsx(u,{source:j,tone:"success"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:"Sitemap Active"})]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{source:W}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"No Sitemap Found"})]})}),a.generated&&e.jsxs(h,{gap:"400",children:[e.jsx(r,{children:e.jsxs(h,{gap:"200",children:[e.jsx(r,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(i,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Products included"}),e.jsxs(t,{variant:"bodyMd",fontWeight:"semibold",children:[a.lastProductCount||0," URLs"]})]})}),e.jsx(r,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(i,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"File size"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:a.size?`${(a.size/1024).toFixed(2)} KB`:"Unknown"})]})}),e.jsx(r,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(i,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Last updated"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:a.generatedAt?new Date(a.generatedAt).toLocaleString():"Unknown"})]})}),e.jsx(r,{paddingBlockEnd:"200",children:e.jsxs(i,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Sitemap URL"}),e.jsxs(t,{variant:"bodyMd",fontWeight:"semibold",breakWord:!0,children:["/api/sitemap/generate?shop=",n]})]})})]})}),e.jsx(r,{children:e.jsx(v,{fullWidth:!0,external:!0,url:`/api/sitemap/generate?shop=${encodeURIComponent(n)}`,icon:G,children:"View Sitemap"})})]})]})}),e.jsxs(r,{paddingBlockStart:"400",children:[e.jsx(t,{variant:"headingMd",as:"h4",children:"What's included:"}),e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(h,{gap:"200",children:[e.jsxs(i,{gap:"200",blockAlign:"start",children:[e.jsx(r,{minWidth:"24px",children:e.jsx(u,{source:j,tone:"positive"})}),e.jsx(t,{children:"All active products with structured URLs for AI parsing"})]}),e.jsxs(i,{gap:"200",blockAlign:"start",children:[e.jsx(r,{minWidth:"24px",children:e.jsx(u,{source:j,tone:"positive"})}),e.jsx(t,{children:"Priority rankings to help AI models understand product importance"})]}),e.jsxs(i,{gap:"200",blockAlign:"start",children:[e.jsx(r,{minWidth:"24px",children:e.jsx(u,{source:j,tone:"positive"})}),e.jsx(t,{children:"Multi-language URLs for international AI search coverage"})]}),e.jsxs(i,{gap:"200",blockAlign:"start",children:[e.jsx(r,{minWidth:"24px",children:e.jsx(u,{source:j,tone:"positive"})}),e.jsx(t,{children:"Standard XML format that AI crawlers understand"})]})]})})]}),e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(t,{variant:"headingMd",as:"h4",children:"How it helps AI models:"}),e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(h,{gap:"200",children:[e.jsx(t,{children:'1. Click "Generate Sitemap" to create a structured map of your products'}),e.jsx(t,{children:"2. The sitemap is automatically saved and available to AI crawlers"}),e.jsx(t,{children:"3. AI models can discover and understand your product catalog structure"}),e.jsx(t,{children:"4. Regenerate when you add new products to keep AI models updated"})]})})]})]})}),k&&e.jsx(_,{content:k,onDismiss:()=>p("")})]})}export{$ as default};
