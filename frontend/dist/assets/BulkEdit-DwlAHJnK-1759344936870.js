import{j as e}from"./app-bridge-Cze-Vavb-1759344936870.js";import{r as o}from"./react-vendor-tAaa2TlE-1759344936870.js";import{u as zt}from"./index-DwaI3fhx-1759344936870.js";import{U as Ot}from"./UpgradeModal-iavQkL9b-1759344936870.js";import{M as E,d as M,T as r,e as Je,a as d,I as j,f as Ee,B as U,D as Mt,g as Q,C as Xe,h as Ze,i as Kt,S as $t,P as Le,j as Ie,R as Wt,k as Nt,l as et,m as Rt,E as Gt}from"./polaris-Bh95OftP-1759344936870.js";const Ht=(y,p="")=>{try{return new URLSearchParams(window.location.search).get(y)||p}catch{return p}},re=y=>{if(!y)return y;const p=String(y).trim();return p.startsWith("gid://")?p:`gid://shopify/Product/${p}`},Ft=y=>{if(!y)return"";const p=String(y).match(/\/(\d+)$/);return p?p[1]:y},H=y=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(y==null?void 0:y.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(y==null?void 0:y.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}};function Xt({shop:y}){const{api:p,shop:tt}=zt(),i=y||tt||Ht("shop","");o.useEffect(()=>{console.log("[BULK-EDIT] Component mounted"),console.log("[BULK-EDIT] Shop:",i),console.log("[BULK-EDIT] API function available:",typeof p=="function")},[i,p]);const[w,q]=o.useState([]),[Z,ce]=o.useState(!1),[st,Oe]=o.useState(1),[nt,Ae]=o.useState(!0),[_,Me]=o.useState(0),[f,ee]=o.useState([]),[T,de]=o.useState(!1),[V,Ke]=o.useState(""),[z,ue]=o.useState("all"),[k,te]=o.useState(""),[ge,qt]=o.useState("createdAt"),[Y,ot]=o.useState("desc"),[K,pe]=o.useState([]),[at,lt]=o.useState([]),[$e,we]=o.useState(!1),[We,Pe]=o.useState(!1),[Ne,Te]=o.useState(!1),[Re,De]=o.useState(!1),[Ge,it]=o.useState(""),[He,rt]=o.useState([]),[W,he]=o.useState([]),[D,Fe]=o.useState([]),[Ce,J]=o.useState(!1),[me,N]=o.useState({current:0,total:0,percent:0}),[qe,X]=o.useState(""),[fe,se]=o.useState([]),[ne,_e]=o.useState({}),[ct,ve]=o.useState(!1),[dt,Se]=o.useState(!1),[ut,oe]=o.useState(!1),[R,ae]=o.useState([]),[gt,xe]=o.useState(!1),[Ve,L]=o.useState(""),[Be,Ue]=o.useState(!1),[I,le]=o.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[P,pt]=o.useState(null),[ht,je]=o.useState(!1),[ye,mt]=o.useState(localStorage.getItem("hasVisitedProducts")==="true"),[ft,ke]=o.useState(!1),[St,xt]=o.useState("starter");o.useEffect(()=>{if(!i)return;p("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          modelsSuggested
        }
      }
    `,variables:{shop:i}})}).then(s=>{var c,m,g;if((c=s==null?void 0:s.errors)!=null&&c.length)throw new Error(((m=s.errors[0])==null?void 0:m.message)||"GraphQL error");const n=(g=s==null?void 0:s.data)==null?void 0:g.plansMe,h=(n==null?void 0:n.modelsSuggested)||["anthropic/claude-3.5-sonnet"];rt(h.map(a=>({label:a,value:a}))),it(h[0]),pt((n==null?void 0:n.plan)||"starter")}).catch(s=>console.error("[BULK-EDIT] GraphQL plansMe failed:",s))},[i,p]),o.useEffect(()=>{if(console.log("[BULK-EDIT] Languages useEffect triggered",{shop:i,api:!!p}),!i){console.log("[BULK-EDIT] No shop, skipping languages load");return}console.log("[BULK-EDIT] Making languages API call to:",`/api/languages/shop/${i}`),console.log("[BULK-EDIT] About to call api() function");const t=new Promise((s,n)=>{setTimeout(()=>n(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([p(`/api/languages/shop/${i}`),t]).then(s=>{console.log("[BULK-EDIT] Languages API response:",s);const n=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];console.log("[BULK-EDIT] Setting available languages to:",n.includes("en")?n:["en",...n]),Fe(n.includes("en")?n:["en",...n])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),console.error("[BULK-EDIT] Error details:",s.message,s.stack),Fe(["en"])})},[i,p]),o.useEffect(()=>{i&&p("/api/products/tags/list",{shop:i}).then(t=>lt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[i,p]);const F=o.useCallback(async(t=1,s=!1,n=null)=>{var h,c,m,g;console.log(`[BULK-EDIT-LOAD] loadProducts called with pageNum: ${t}, append: ${s}, timestamp: ${n}`),console.log("[BULK-EDIT-LOAD] Current products state:",w.length),ce(!0);try{const a=new URLSearchParams({shop:i,page:t,limit:50,...z!=="all"&&{optimized:z},...V&&{search:V},...k&&{languageFilter:k},...K.length>0&&{tags:K.join(",")},sortBy:ge,sortOrder:Y,...n&&{_t:n}}),l=await p(`/api/products/list?${a}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log(`[BULK-EDIT-LOAD] API returned ${((h=l.products)==null?void 0:h.length)||0} products`),((c=l.products)==null?void 0:c.length)>0&&console.log("[BULK-EDIT-LOAD] First product data:",{id:l.products[0].id,_id:l.products[0]._id,title:l.products[0].title,optimizationSummary:l.products[0].optimizationSummary,allKeys:Object.keys(l.products[0])}),q(s?b=>[...b,...l.products]:l.products||[]),Oe(t),Ae(((m=l.pagination)==null?void 0:m.hasNext)||!1),Me(((g=l.pagination)==null?void 0:g.total)||0)}catch(a){q(s?w:[]),Ae(!1),L(`Error loading products: ${a.message}`)}finally{ce(!1)}},[i,z,V,k,K,ge,Y]);o.useEffect(()=>{i&&F(1,!1,null)},[i,F,z,k,K,ge,Y]),o.useEffect(()=>{!ye&&i&&(localStorage.setItem("hasVisitedProducts","true"),mt(!0))},[ye,i]),o.useEffect(()=>{w.length===0&&!Z&&i&&!ye&&je(!0)},[w.length,Z,i,ye]);const Qe=o.useCallback(t=>{Ke(t)},[]);o.useEffect(()=>{const t=setTimeout(()=>{i&&F(1,!1,null)},500);return()=>clearTimeout(t)},[V]);const jt=o.useCallback(t=>{ee(t),t.length===0&&de(!1)},[]),Ye=o.useCallback(t=>{de(t),ee(t?w.map(s=>s.id):[])},[w]),yt=()=>{if(f.length===0&&!T){L("Please select products first");return}Se(!0)},bt=()=>{if(f.length===0&&!T){L("Please select products first");return}ae([]),oe(!0)},Et=()=>{const s=w.filter(c=>f.includes(c.id)).filter(c=>{var m,g;return((g=(m=c.optimizationSummary)==null?void 0:m.optimizedLanguages)==null?void 0:g.length)>0}),n=async()=>{var m;if(console.log("üîç [AI-ENHANCE] handleStartEnhancement called with products:",s),P&&!["Growth Extra","Enterprise"].includes(P)){xt(P),Ue(!1),ke(!0);return}le({processing:!0,current:0,total:s.length,currentItem:"",results:null});const c={successful:0,failed:0,skipped:0,skippedDueToPlan:0};for(let g=0;g<s.length;g++){const a=s[g];le(l=>({...l,current:g,currentItem:a.title}));try{if(!(await p("/ai-enhance/check-eligibility",{method:"POST",shop:i,body:{shop:i}})).eligible){c.skipped++,c.skippedDueToPlan++;continue}const b=await p("/ai-enhance/product",{method:"POST",shop:i,body:{shop:i,productId:a.gid||re(a.id),languages:a.optimizationSummary.optimizedLanguages}});if(console.log(`üîç [AI-ENHANCE] Product ${a.id} enhance data:`,b),b.results&&b.results.length>0){const v={shop:i,productId:a.gid||re(a.id),results:b.results.filter(u=>u.bullets&&u.faq).map(u=>{console.log(`üîç [AI-ENHANCE] Language ${u.language} - AI bullets:`,u.bullets),console.log(`üîç [AI-ENHANCE] Language ${u.language} - AI FAQ:`,u.faq),console.log(`üîç [AI-ENHANCE] Language ${u.language} - updatedSeo from AI:`,u.updatedSeo);const C={language:u.language,seo:{...u.updatedSeo,bullets:u.bullets||[],faq:u.faq||[]}};return console.log(`üîç [AI-ENHANCE] Language ${u.language} - final seo result:`,JSON.stringify(C.seo,null,2)),C}),options:{updateBullets:!0,updateFaq:!0}};console.log(`üîç [AI-ENHANCE] Applying data for product ${a.id}:`,v),console.log("üîç [AI-ENHANCE] First result SEO object:",JSON.stringify((m=v.results[0])==null?void 0:m.seo,null,2));const S=await p("/api/seo/apply-multi",{method:"POST",shop:i,body:v});console.log(`üîç [AI-ENHANCE] Apply result for product ${a.id}:`,S),c.successful++}else console.log(`üîç [AI-ENHANCE] No valid results for product ${a.id}:`,b),c.failed++}catch(l){console.error("Enhancement error:",l),c.failed++}le(l=>({...l,current:g+1}))}le(g=>({...g,processing:!1,results:c})),L(`AI enhancement complete! ${c.successful} products enhanced.`)},h=()=>{Ue(!1),le({processing:!1,current:0,total:0,currentItem:"",results:null}),I.results&&I.results.successful>0&&F(1,!1,null)};return!I.processing&&!I.results?e.jsx(E,{open:Be,title:"AI Enhanced add-ons for AI Search",onClose:h,primaryAction:{content:"Start AI Enhancement",onAction:n},secondaryActions:[{content:"Cancel",onAction:h}],children:e.jsx(E.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["AI enhancement will improve bullets and FAQ for ",s.length," products."]}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI enhancement is only available for Growth Extra and Enterprise plans."})]})})}):I.processing?e.jsx(E,{open:Be,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(E.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",I.currentItem]}),e.jsx(Je,{progress:I.current/I.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[I.current," of ",I.total," products (",Math.round(I.current/I.total*100),"%)"]})]})})}):I.results!==null?e.jsx(E,{open:Be,title:"AI Enhancement Results",onClose:h,primaryAction:{content:"Done",onAction:h},children:e.jsx(E.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(j,{gap:"400",children:[e.jsxs(d,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:I.results.successful})]}),e.jsxs(d,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:I.results.failed})]}),e.jsxs(d,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:I.results.skipped})]})]}),I.results.skippedDueToPlan>0&&e.jsx(d,{paddingBlockStart:"300",children:e.jsx(r,{variant:"bodySm",tone:"subdued",children:"AI enhancement is only available for Growth Extra and Enterprise plans."})})]})})}):null},Lt=async()=>{var s;if(console.log("[BULK-EDIT/DEBUG] ===== GENERATE SEO START ====="),console.log("[BULK-EDIT/DEBUG] selectedLanguages:",W),console.log("[BULK-EDIT/DEBUG] model:",Ge),console.log("[BULK-EDIT/DEBUG] modelOptions:",He),!W.length){L("Please select at least one language");return}let t=Ge;(!t||!t.trim())&&(console.log("[BULK-EDIT/DEBUG] Model is empty, using fallback"),t=((s=He[0])==null?void 0:s.value)||"anthropic/claude-3.5-sonnet",console.log("[BULK-EDIT/DEBUG] Using fallback model:",t)),Se(!1),J(!0),N({current:0,total:0,percent:0}),se([]),_e({});try{let n=[];T?n=(await p(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:n=w.filter(u=>f.includes(u.id));const h=H(P),c=n.length;n=n.slice(0,h);const m=n.length,g=c-m;N({current:0,total:m,percent:0});const a=5,l={};for(let u=0;u<n.length;u+=a){const O=n.slice(u,Math.min(u+a,n.length)).map(async x=>{var $;X(x.title||x.handle||"Product");try{const G=x.gid||re(x.productId||x.id),ie=(($=x.optimizationSummary)==null?void 0:$.optimizedLanguages)||[],be=W.filter(kt=>!ie.includes(kt));if(be.length===0){l[x.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}console.log("[BULK-EDIT/DEBUG] Making API call with:"),console.log("[BULK-EDIT/DEBUG] - productId:",G),console.log("[BULK-EDIT/DEBUG] - model:",t),console.log("[BULK-EDIT/DEBUG] - languages:",be);const Ut=await p("/api/seo/generate-multi",{method:"POST",shop:i,body:{shop:i,productId:G,model:t,languages:be}});l[x.id]={success:!0,data:Ut,languages:be}}catch(G){l[x.id]={success:!1,error:G.message},se(ie=>[...ie,{product:x.title,error:G.message}])}});await Promise.all(O);const A=Math.min(u+a,n.length),B=Math.round(A/m*100);N({current:A,total:m,percent:B})}_e(l),ve(!0);const b=Object.keys(l).filter(u=>l[u].success&&!l[u].skipped).length,v=Object.keys(l).filter(u=>l[u].skipped).length;let S=`Generated Optimization for AI Search for ${b} products`;v>0&&(S+=` (${v} already optimised)`),g>0&&(S+=` (${g} skipped due to plan limit)`),L(S)}catch(n){L(`Error: ${n.message}`)}finally{J(!1),X("")}},It=async()=>{var t,s,n,h;J(!0),N({current:0,total:0,percent:0});try{const c=Object.entries(ne).filter(([l,b])=>b.success&&!b.skipped),m=c.length;N({current:0,total:m,percent:0});for(let l=0;l<c.length;l++){const[b,v]=c[l],S=w.find(O=>O.id===b);if(!S)continue;X(S.title||"Product");try{const O=S.gid||re(S.productId||S.id),A=await p("/api/seo/apply-multi",{method:"POST",shop:i,body:{shop:i,productId:O,results:v.data.results.filter(B=>B==null?void 0:B.seo).map(B=>({language:B.language,seo:B.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});A.appliedLanguages&&A.appliedLanguages.length>0&&(console.log(`[BULK-EDIT] Optimistic update for product ${b}, languages:`,A.appliedLanguages),q(B=>B.map(x=>{var $;if(x.id===b){const G=(($=x.optimizationSummary)==null?void 0:$.optimizedLanguages)||[],ie=[...new Set([...G,...A.appliedLanguages])];return{...x,optimizationSummary:{...x.optimizationSummary,optimizedLanguages:ie,optimized:!0,lastOptimized:new Date().toISOString()}}}return x})))}catch(O){se(A=>[...A,{product:S.title,error:`Apply failed: ${O.message}`}])}const u=l+1,C=Math.round(u/m*100);N({current:u,total:m,percent:C})}L("AI Search Optimisation applied successfully!"),ve(!1),ee([]),de(!1),console.log("[BULK-EDIT] Waiting for database propagation..."),await new Promise(l=>setTimeout(l,1e3)),console.log("[BULK-EDIT] Clearing products state before reload..."),q([]),console.log("[BULK-EDIT] Reloading products with cache bypass...");const g=new URLSearchParams({shop:i,page:1,limit:50,...z!=="all"&&{optimized:z},...V&&{search:V},...k&&{languageFilter:k},...K.length>0&&{tags:K.join(",")},sortBy:ge,sortOrder:Y,_t:Date.now()}),a=await p(`/api/products/list?${g}`,{shop:i,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log("[BULK-EDIT] Products reloaded, first product:",(t=a.products[0])==null?void 0:t.title),console.log("[BULK-EDIT] First product optimization summary:",(s=a.products[0])==null?void 0:s.optimizationSummary),q(a.products||[]),Oe(1),Ae(((n=a.pagination)==null?void 0:n.hasNext)||!1),Me(((h=a.pagination)==null?void 0:h.total)||0)}catch(c){L(`Error applying AI Search Optimisation: ${c.message}`)}finally{J(!1),X("")}},At=async()=>{var t,s;if(!R.length){L("Please select at least one language to delete");return}oe(!1),xe(!1),J(!0),N({current:0,total:0,percent:0}),se([]);try{let n=[];T?n=(await p(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:n=w.filter(g=>f.includes(g.id));const h=n.length;N({current:0,total:h,percent:0});let c=0,m=0;for(let g=0;g<n.length;g++){const a=n[g];X(a.title||a.handle||"Product");try{const v=a.gid||re(a.productId||a.id),S=((t=a.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],u=R.filter(O=>S&&S.length>0&&S.includes(O));if(console.log("[BULK-DELETE] Product optimized languages:",S),console.log("[BULK-DELETE] Languages to delete:",u),u.length===0){m++;continue}const C=await p("/api/seo/delete-multi",{method:"POST",shop:i,body:{shop:i,productId:v,languages:u}});console.log("[BULK-DELETE] Delete response:",C),console.log("[BULK-DELETE] Deleted languages:",C.deletedLanguages),C.deletedLanguages&&C.deletedLanguages.length>0&&(console.log("[BULK-DELETE] Before optimistic update, product:",a),console.log("[BULK-DELETE] Current optimized languages:",(s=a.optimizationSummary)==null?void 0:s.optimizedLanguages),q(O=>O.map(A=>{var B;if(A.id===a.id){const x=((B=A.optimizationSummary)==null?void 0:B.optimizedLanguages)||[],$=x.filter(G=>!C.deletedLanguages.includes(G));return console.log("[BULK-DELETE] Updating product:",A.id),console.log("[BULK-DELETE] Languages before:",x),console.log("[BULK-DELETE] Languages after:",$),{...A,optimizationSummary:{...A.optimizationSummary,optimizedLanguages:$,optimized:$.length>0,lastOptimized:$.length>0?A.optimizationSummary.lastOptimized:null}}}return A})),console.log("[BULK-DELETE] State updated, checking first product:",w[0])),c++,C.deletedLanguages&&C.deletedLanguages.length>0&&await p("/api/products/verify-after-delete",{method:"POST",shop:i,body:{shop:i,productIds:[v],deletedLanguages:C.deletedLanguages}})}catch(v){se(S=>[...S,{product:a.title,error:v.message}])}const l=g+1,b=Math.round(l/h*100);N({current:l,total:h,percent:b})}ee([]),de(!1),m>0?L(`Deleted Optimization for AI Search from ${c} products (${m} had no optimisation to delete)`):L(`Deleted Optimization for AI Search from ${c} products`),console.log("[BULK-DELETE] Operation successful!"),setTimeout(()=>{console.log("[BULK-DELETE] Triggering reload with timestamp");const g=Date.now();F(1,!1,g)},500)}catch(n){L(`Error: ${n.message}`)}finally{J(!1),X("")}},wt=t=>{var m,g;const s=t,n=Ft(s.productId||s.id),h=((m=s.optimizationSummary)==null?void 0:m.optimizedLanguages)||[];console.log(`[BULK-EDIT] Rendering product: "${s.title}"`),console.log("[BULK-EDIT] optimizationSummary:",s.optimizationSummary),console.log("[BULK-EDIT] optimizedLanguages:",h),console.log("[BULK-EDIT] availableLanguages:",D);const c=(g=s.images)!=null&&g[0]?e.jsx(et,{source:s.images[0].url||s.images[0].src||s.images[0],alt:s.title,size:"small"}):s.imageUrl?e.jsx(et,{source:s.imageUrl,alt:s.title,size:"small"}):e.jsx(d,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Rt,{id:s.id,url:"",media:c,accessibilityLabel:`View details for ${s.title}`,children:e.jsxs(j,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(d,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:s.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["ID: ",n]})]}),e.jsx(d,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(j,{gap:"100",children:(console.log(`[BULK-EDIT] Rendering badges for "${s.title}"`),console.log("[BULK-EDIT] availableLanguages.length:",D.length),console.log("[BULK-EDIT] availableLanguages:",D),console.log("[BULK-EDIT] optimizedLanguages:",h),D.length>0?(console.log("[BULK-EDIT] Using availableLanguages.map"),D.map(a=>{const l=h.includes(a);return console.log(`[BULK-EDIT] Language ${a}: optimized=${l}`),e.jsx(Q,{tone:l?"success":"subdued",size:"small",children:a.toUpperCase()},a)})):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),h.map(a=>e.jsx(Q,{tone:"success",size:"small",children:a.toUpperCase()},a))))})}),e.jsx(d,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(Q,{tone:"success",children:"Active"})})]})})},Pt=Ce&&e.jsx(E,{open:Ce,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(E.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:qe?`Processing: ${qe}`:"Preparing..."}),e.jsx(Je,{progress:me.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[me.current," of ",me.total," products (",me.percent,"%)"]})]})})}),Tt=e.jsx(E,{open:dt,title:"Select Languages",onClose:()=>{Se(!1),he([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Lt,disabled:W.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{Se(!1),he([])}}],children:e.jsx(E.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",T?"all":f.length," selected products:"]}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(j,{gap:"200",wrap:!0,children:D.map(t=>e.jsx(Ee,{label:t.toUpperCase(),checked:W.includes(t),onChange:s=>{he(s?[...W,t]:W.filter(n=>n!==t))}},t))})}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(U,{plain:!0,onClick:()=>{he(W.length===D.length?[]:[...D])},children:W.length===D.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Dt=e.jsx(E,{open:ct&&!Ce,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:It,disabled:!Object.values(ne).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>ve(!1)}],children:e.jsx(E.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(j,{gap:"400",children:[e.jsxs(d,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(ne).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(d,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(ne).filter(t=>t.skipped).length})]}),e.jsxs(d,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(ne).filter(t=>!t.success).length})]})]}),fe.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Mt,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(d,{maxHeight:"200px",overflowY:"scroll",children:[fe.slice(0,10).map((t,s)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),fe.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",fe.length-10," more errors"]})]})]})]})})}),Ct=e.jsx(E,{open:ut,title:"Delete Optimization for AI Search",onClose:()=>{oe(!1),ae([])},primaryAction:{content:"Continue",onAction:()=>{oe(!1),xe(!0)},disabled:R.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{oe(!1),ae([])}}],children:e.jsx(E.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",T?"all":f.length," selected products:"]}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(j,{gap:"200",wrap:!0,children:D.map(t=>e.jsx(Ee,{label:t.toUpperCase(),checked:R.includes(t),onChange:s=>{ae(s?[...R,t]:R.filter(n=>n!==t))}},t))})}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(U,{plain:!0,onClick:()=>{ae(R.length===D.length?[]:[...D])},children:R.length===D.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),vt=e.jsx(E,{open:gt,title:"Confirm Deletion",onClose:()=>{xe(!1)},primaryAction:{content:"Delete",onAction:At,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>xe(!1)}],children:e.jsx(E.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(d,{paddingBlock:"200",children:e.jsx(j,{gap:"100",children:R.map(t=>e.jsx(Q,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",T?"ALL":f.length," selected products."]}),e.jsx(r,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),ze=async()=>{try{ce(!0),L("Syncing products from Shopify...");const t=await p("/api/products/sync",{method:"POST",shop:i});if(t.success){const s=t.productsCount||t.synced||0;L(`‚úÖ Synced ${s} products successfully!`),setTimeout(()=>{F(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),L(`‚ùå Sync failed: ${t.message}`)}finally{ce(!1)}},Bt=e.jsx(Gt,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Ke(""),ue("all"),te(""),pe([]),F(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:ze},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Xe,{children:e.jsxs(d,{padding:"400",children:[e.jsxs(M,{gap:"300",children:[P&&e.jsx(Ze,{tone:"info",children:e.jsxs(j,{gap:"200",align:"space-between",children:[e.jsxs(r,{children:["Your ",e.jsx("strong",{children:P})," plan includes up to"," ",e.jsx("strong",{children:H(P)})," products for SEO optimization.",_>H(P)&&e.jsxs(e.Fragment,{children:[" You have ",_," products, so only the first ",H(P)," will be processed."]})]}),(f.length>0||T)&&e.jsxs(r,{children:["Selected: ",T?Math.min(_,H(P)):f.length,"/",H(P)]})]})}),P&&(f.length>H(P)||T&&_>H(P))&&e.jsx(Ze,{tone:"warning",children:e.jsxs(j,{gap:"200",align:"space-between",children:[e.jsxs(r,{children:[e.jsx("strong",{children:"Plan Limit Exceeded:"})," You've selected more products than your ",P," plan allows. Only the first ",H(P)," products will be processed."]}),e.jsx(U,{size:"micro",onClick:()=>ke(!0),children:"Upgrade Plan"})]})}),e.jsxs(j,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(d,{minWidth:"400px",children:e.jsx(Kt,{label:"",placeholder:"Search by product ID, name, or details...",value:V,onChange:Qe,prefix:e.jsx($t,{}),clearButton:!0,onClearButtonClick:()=>Qe("")})}),e.jsx(d,{width:"320px",children:e.jsx(U,{primary:!0,onClick:yt,disabled:f.length===0&&!T,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(j,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(U,{onClick:ze,disabled:Z,size:"medium",children:"Sync Products"}),e.jsx(d,{width:"320px",children:e.jsxs(M,{gap:"200",align:"end",children:[f.length===0&&!T||!w.filter(n=>f.includes(n.id)).some(n=>{var h,c;return((c=(h=n.optimizationSummary)==null?void 0:h.optimizedLanguages)==null?void 0:c.length)>0})?null:e.jsx(U,{onClick:()=>Ue(!0),disabled:f.length===0&&!T,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(U,{onClick:bt,disabled:f.length===0&&!T||!w.filter(n=>f.includes(n.id)).some(n=>{var h,c;return((c=(h=n.optimizationSummary)==null?void 0:h.optimizedLanguages)==null?void 0:c.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),_>0&&e.jsx(d,{paddingBlockStart:"300",children:e.jsx(Ee,{label:`Select all ${_} products in your store`,checked:T,onChange:Ye})})]})}),e.jsx(d,{paddingBlockStart:"400",children:e.jsxs(Xe,{children:[e.jsxs(d,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(j,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(j,{gap:"200",wrap:!0,children:[e.jsx(Le,{active:$e,activator:e.jsx(U,{disclosure:"down",onClick:()=>we(!$e),removeUnderline:!0,children:e.jsxs(j,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),z!=="all"&&e.jsx(d,{onClick:t=>{t.stopPropagation(),ue("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>we(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(Ie,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[z],onChange:t=>{ue(t[0]),te(""),we(!1)}})})}),e.jsx(Le,{active:We,activator:e.jsx(U,{disclosure:"down",onClick:()=>Pe(!We),removeUnderline:!0,children:e.jsxs(j,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),k&&e.jsx(d,{onClick:t=>{t.stopPropagation(),te("")},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>Pe(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(Ie,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...D.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...D.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:k?[k]:[],onChange:t=>{te(t[0]||""),Pe(!1)}})})}),e.jsx(Le,{active:Ne,activator:e.jsx(U,{disclosure:"down",onClick:()=>Te(!Ne),removeUnderline:!0,children:e.jsxs(j,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),K.length>0&&e.jsx(d,{onClick:t=>{t.stopPropagation(),pe([])},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>Te(!1),children:e.jsxs(d,{padding:"300",minWidth:"200px",children:[e.jsx(Ie,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:at.map(t=>({label:t,value:t})),selected:K,onChange:t=>{pe(t)}}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(U,{size:"slim",onClick:()=>Te(!1),children:"Apply"})})]})})]}),e.jsx(Le,{active:Re,activator:e.jsx(U,{disclosure:"down",onClick:()=>De(!Re),removeUnderline:!0,children:e.jsx(j,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:Y==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>De(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(Ie,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[Y],onChange:t=>{ot(t[0]),De(!1)}})})})]}),(z!=="all"||k||K.length>0)&&e.jsx(d,{paddingBlockStart:"200",children:e.jsxs(j,{gap:"100",wrap:!0,children:[z!=="all"&&e.jsx(Q,{onRemove:()=>ue("all"),children:z==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),k&&e.jsx(Q,{onRemove:()=>te(""),children:k.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),K.map(t=>e.jsxs(Q,{onRemove:()=>pe(s=>s.filter(n=>n!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(d,{children:[e.jsx(d,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(j,{gap:"200",align:"start",children:[e.jsx(Ee,{checked:f.length===w.length&&w.length>0,onChange:Ye,label:""}),e.jsxs(r,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",f.length>0&&` (${f.length} selected products)`]})]})}),e.jsx(Wt,{resourceName:{singular:"product",plural:"products"},items:w,renderItem:wt,selectedItems:f,onSelectionChange:jt,selectable:!0,loading:Z,totalItemsCount:_,emptyState:Bt,showHeader:!1})]}),nt&&!Z&&e.jsx(d,{padding:"400",textAlign:"center",children:e.jsx(U,{onClick:()=>F(st+1,!0,null),children:"Load more"})})]})}),Pt,Tt,Dt,Ct,vt,Et(),e.jsx(E,{open:ht,onClose:()=>je(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{je(!1),ze()}},secondaryActions:[{content:"Skip for now",onAction:()=>je(!1)}],children:e.jsx(E.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(r,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Ot,{open:ft,onClose:()=>ke(!1),featureName:"AI Enhancement",currentPlan:St}),Ve&&e.jsx(Nt,{content:Ve,onDismiss:()=>L("")})]})}export{Xt as default};
