import{j as e}from"./app-bridge-BiK3i8-w-1761107213393.js";import{r as i}from"./react-vendor-tAaa2TlE-1761107213393.js";import{m as W}from"./sessionFetch-CJepNHo3-1761107213393.js";import{C as G,a as n,e as p,d as F,I as d,T as t,B as C,o as g,p as j,q as R,r as T,s as U,l as _}from"./polaris-DIe8XXmQ-1761107213393.js";const L=(f,r="")=>{try{return new URLSearchParams(window.location.search).get(f)||r}catch{return r}};function O({shop:f}){const r=f||L("shop",""),[a,I]=i.useState(null),[S,k]=i.useState(!1),[w,y]=i.useState(!1),[v,l]=i.useState(""),[s,B]=i.useState(null),m=i.useMemo(()=>W(),[]),b=i.useCallback(async()=>{if(r)try{const o=await m(`/api/sitemap/info?shop=${r}`);I(o)}catch(o){l(o.message||"Failed to load sitemap info")}},[r,m]),A=i.useCallback(async()=>{var o,u,x;if(r)try{const c=await m("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
        query PlansMe($shop:String!) {
          plansMe(shop:$shop) {
            shop
            plan
            planKey
            priceUsd
            product_limit
            providersAllowed
            modelsSuggested
            autosyncCron
            trial {
              active
              ends_at
              days_left
            }
          }
        }
      `,variables:{shop:r}})});if((o=c==null?void 0:c.errors)!=null&&o.length)throw new Error(((u=c.errors[0])==null?void 0:u.message)||"GraphQL error");const P=(x=c==null?void 0:c.data)==null?void 0:x.plansMe;B(P||null)}catch{}},[r,m]),E=i.useCallback(async()=>{var o,u,x;if(r){k(!0);try{const h=await fetch(`/api/sitemap/generate?shop=${encodeURIComponent(r)}`,{method:"POST",credentials:"include",headers:{Authorization:`Bearer ${((x=(u=(o=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:o.getState())==null?void 0:u.session)==null?void 0:x.token)||""}`}});if(h.ok)l("Sitemap generated successfully!"),await b();else{const c=await h.text();l(`Sitemap generation failed: ${c}`)}}catch(h){l(h.message||"Sitemap generation failed")}finally{k(!1)}}},[r,b]),M=i.useCallback(async()=>{if(r){y(!0);try{const o=`/api/sitemap/generate?shop=${encodeURIComponent(r)}&force=true&t=${Date.now()}`,u=window.open(o,"_blank");setTimeout(()=>{y(!1)},2e3)}catch{y(!1),l("Failed to open sitemap")}}},[r]);return i.useEffect(()=>{b(),A()},[b,A]),e.jsxs(G,{children:[e.jsx(n,{padding:"400",children:e.jsxs(p,{gap:"400",children:[e.jsx(F,{tone:"info",children:e.jsxs("p",{children:["Your ",(s==null?void 0:s.plan)||"Starter"," plan includes up to"," ",e.jsx("strong",{children:(s==null?void 0:s.plan)==="Starter"?"100 products in 1 language":(s==null?void 0:s.plan)==="Professional"?"250 products in up to 2 languages":(s==null?void 0:s.plan)==="Growth"?"700 products in up to 3 languages":(s==null?void 0:s.plan)==="Growth Extra"?"1,000 products in up to 6 languages":(s==null?void 0:s.plan)==="Enterprise"?"2,500 products in up to 10 languages":"100 products in 1 language"}),".",(a==null?void 0:a.productCount)&&a.productCount>((s==null?void 0:s.plan)==="Starter"?100:(s==null?void 0:s.plan)==="Professional"?250:(s==null?void 0:s.plan)==="Growth"?700:(s==null?void 0:s.plan)==="Growth Extra"?1e3:(s==null?void 0:s.plan)==="Enterprise"?2500:100)&&e.jsxs(e.Fragment,{children:[" You have ",a.productCount," products, so only the first"," ",(s==null?void 0:s.plan)==="Starter"?100:(s==null?void 0:s.plan)==="Professional"?250:(s==null?void 0:s.plan)==="Growth"?700:(s==null?void 0:s.plan)==="Growth Extra"?1e3:(s==null?void 0:s.plan)==="Enterprise"?2500:100," ","will be included in the sitemap."]})]})}),e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsxs(n,{children:[e.jsx(t,{variant:"headingMd",as:"h3",children:"Sitemap Generator"}),e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Generate structured sitemap for AI models to discover and index your products"})]}),e.jsx(C,{primary:!0,onClick:E,loading:S,disabled:S,children:S?"Generating...":"Generate Sitemap"})]}),a&&e.jsx(n,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(p,{gap:"300",children:[e.jsx(d,{gap:"200",blockAlign:"center",children:a.generated?e.jsxs(e.Fragment,{children:[e.jsx(g,{source:j,tone:"success"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:"Sitemap Active"})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{source:R}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"No Sitemap Found"})]})}),a.generated&&e.jsxs(p,{gap:"400",children:[e.jsx(n,{children:e.jsxs(p,{gap:"200",children:[e.jsx(n,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(d,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Products included"}),e.jsxs(t,{variant:"bodyMd",fontWeight:"semibold",children:[a.lastProductCount||0," URLs"]})]})}),e.jsx(n,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(d,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"File size"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:a.size?`${(a.size/1024).toFixed(2)} KB`:"Unknown"})]})}),e.jsx(n,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(d,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Last updated"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:a.generatedAt?new Date(a.generatedAt).toLocaleString():"Unknown"})]})})]})}),e.jsx(n,{children:e.jsx(C,{fullWidth:!0,onClick:M,loading:w,disabled:w,icon:T,children:w?e.jsxs(d,{gap:"200",align:"center",children:[e.jsx(U,{size:"small"}),e.jsx(t,{children:"Loading sitemap..."})]}):"View Sitemap"})})]})]})}),e.jsxs(n,{paddingBlockStart:"400",children:[e.jsx(t,{variant:"headingMd",as:"h4",children:"What's included:"}),e.jsx(n,{paddingBlockStart:"200",children:e.jsxs(p,{gap:"200",children:[e.jsxs(d,{gap:"200",blockAlign:"start",children:[e.jsx(n,{minWidth:"24px",children:e.jsx(g,{source:j,tone:"positive"})}),e.jsx(t,{children:"All active products with structured URLs for AI parsing"})]}),e.jsxs(d,{gap:"200",blockAlign:"start",children:[e.jsx(n,{minWidth:"24px",children:e.jsx(g,{source:j,tone:"positive"})}),e.jsx(t,{children:"Priority rankings to help AI models understand product importance"})]}),e.jsxs(d,{gap:"200",blockAlign:"start",children:[e.jsx(n,{minWidth:"24px",children:e.jsx(g,{source:j,tone:"positive"})}),e.jsx(t,{children:"Multi-language URLs for international AI search coverage"})]}),e.jsxs(d,{gap:"200",blockAlign:"start",children:[e.jsx(n,{minWidth:"24px",children:e.jsx(g,{source:j,tone:"positive"})}),e.jsx(t,{children:"Standard XML format that AI crawlers understand"})]})]})})]}),e.jsxs(n,{paddingBlockStart:"200",children:[e.jsx(t,{variant:"headingMd",as:"h4",children:"How it helps AI models:"}),e.jsx(n,{paddingBlockStart:"200",children:e.jsxs(p,{gap:"200",children:[e.jsx(t,{children:'1. Click "Generate Sitemap" to create a structured map of your products'}),e.jsx(t,{children:"2. The sitemap is automatically saved and available to AI crawlers"}),e.jsx(t,{children:"3. AI models can discover and understand your product catalog structure"}),e.jsx(t,{children:"4. Regenerate when you add new products to keep AI models updated"})]})})]})]})}),v&&e.jsx(_,{content:v,onDismiss:()=>l("")})]})}export{O as default};
