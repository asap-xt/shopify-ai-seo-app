import{j as e}from"./app-bridge-DWjCA2El-1760718273614.js";import{r as g}from"./react-vendor-tAaa2TlE-1760718273614.js";import{m as U}from"./sessionFetch-CJepNHo3-1760718273614.js";import{L as o,C as r,a as j,T as i,d,I as l,D as O,e as P,B as c}from"./polaris-C0j5fiI--1760718273614.js";const I=(u,x="")=>{try{return new URLSearchParams(window.location.search).get(u)||x}catch{return x}};function G({shop:u}){var f,k,M,C,z,L,B,D;const x=u||I("shop",""),S=g.useMemo(()=>U(),[]),s=t=>{const h=new URLSearchParams(window.location.search),p=h.toString()?`?${h.toString()}`:"";window.location.href=`${t}${p}`},[T,w]=g.useState(!0),[n,W]=g.useState(null),[a,$]=g.useState(null),[m,R]=g.useState(null);g.useEffect(()=>{_()},[x]);const _=async()=>{try{w(!0);const[t,h]=await Promise.all([S.get(`/api/dashboard/stats?shop=${x}`),S.get(`/api/billing/tokens/balance?shop=${x}`)]);if(t.ok&&h.ok){const p=await t.json(),N=await h.json();W(p),$(p.subscription),R(N)}}catch(t){console.error("[Dashboard] Error loading data:",t)}finally{w(!1)}},b=((f=n==null?void 0:n.products)==null?void 0:f.total)>0?Math.round(n.products.optimized/n.products.total*100):0,v=((k=n==null?void 0:n.collections)==null?void 0:k.total)>0?Math.round(n.collections.optimized/n.collections.total*100):0,y=["growth","growth_extra","enterprise"].includes(a==null?void 0:a.plan),A=["professional","growth","growth_extra","enterprise"].includes(a==null?void 0:a.plan),E=(a==null?void 0:a.plan)==="enterprise";return T?e.jsx(o,{children:e.jsx(o.Section,{children:e.jsx(r,{children:e.jsx(j,{padding:"400",children:e.jsx(i,{children:"Loading dashboard..."})})})})}):e.jsxs(o,{children:[e.jsx(o.Section,{children:e.jsx(i,{variant:"headingLg",as:"h1",children:"Store Overview"})}),e.jsx(o.Section,{children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"16px"},children:[e.jsx(r,{children:e.jsxs(d,{gap:"400",children:[e.jsx(i,{variant:"headingMd",children:"Products"}),e.jsxs(d,{gap:"200",children:[e.jsxs(l,{align:"space-between",children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Total"}),e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:((M=n==null?void 0:n.products)==null?void 0:M.total)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Optimized"}),e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:((C=n==null?void 0:n.products)==null?void 0:C.optimized)||0})]}),e.jsx(O,{}),e.jsxs(j,{paddingBlockStart:"200",children:[e.jsx("div",{style:{width:"100%",height:"8px",backgroundColor:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${b}%`,height:"100%",backgroundColor:b===100?"#4caf50":"#2196f3",transition:"width 0.3s ease"}})}),e.jsx(j,{paddingBlockStart:"100",children:e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[b,"% optimized"]})})]})]})]})}),y&&e.jsx(r,{children:e.jsxs(d,{gap:"400",children:[e.jsx(i,{variant:"headingMd",children:"Collections"}),e.jsxs(d,{gap:"200",children:[e.jsxs(l,{align:"space-between",children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Total"}),e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:((z=n==null?void 0:n.collections)==null?void 0:z.total)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Optimized"}),e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:((L=n==null?void 0:n.collections)==null?void 0:L.optimized)||0})]}),e.jsx(O,{}),e.jsxs(j,{paddingBlockStart:"200",children:[e.jsx("div",{style:{width:"100%",height:"8px",backgroundColor:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${v}%`,height:"100%",backgroundColor:v===100?"#4caf50":"#2196f3",transition:"width 0.3s ease"}})}),e.jsx(j,{paddingBlockStart:"100",children:e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[v,"% optimized"]})})]})]})]})}),e.jsx(r,{children:e.jsxs(d,{gap:"400",children:[e.jsx(i,{variant:"headingMd",children:"Languages"}),e.jsx(d,{gap:"200",children:n!=null&&n.languages&&n.languages.length>0?e.jsxs(e.Fragment,{children:[n.languages.slice(0,3).map((t,h)=>e.jsxs(l,{align:"space-between",children:[e.jsxs(i,{variant:"bodyMd",tone:"subdued",children:[t.name||t.code," ",t.primary&&"â˜…"]}),e.jsx(P,{tone:t.optimizedCount>0?"success":"subdued",children:t.optimizedCount||0})]},h)),n.languages.length>3&&e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["+",n.languages.length-3," more..."]})]}):e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"No language data"})})]})})]})}),e.jsx(o.Section,{children:e.jsxs(l,{gap:"400",wrap:!0,children:[e.jsx("div",{style:{flex:"1",minWidth:"300px"},children:e.jsx(r,{children:e.jsxs(d,{gap:"300",children:[e.jsx(i,{variant:"headingMd",children:"Last Optimization"}),e.jsx(i,{variant:"bodyLg",fontWeight:"semibold",children:n!=null&&n.lastOptimization?new Date(n.lastOptimization).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}),e.jsx(c,{onClick:()=>s("/ai-seo/products"),children:"Optimize Now"})]})})}),e.jsx("div",{style:{flex:"1",minWidth:"300px"},children:e.jsx(r,{children:e.jsxs(d,{gap:"300",children:[e.jsx(i,{variant:"headingMd",children:"Token Balance"}),e.jsxs(i,{variant:"bodyLg",fontWeight:"semibold",children:[((B=m==null?void 0:m.balance)==null?void 0:B.toLocaleString())||0," tokens"]}),((a==null?void 0:a.plan)==="growth_extra"||(a==null?void 0:a.plan)==="enterprise")&&e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[(a==null?void 0:a.plan)==="growth_extra"?"100M":"300M"," included monthly"]}),e.jsx(c,{variant:"primary",onClick:()=>s("/billing"),children:"Manage Tokens"})]})})})]})}),e.jsx(o.Section,{children:e.jsx(r,{children:e.jsxs(d,{gap:"400",children:[e.jsx(i,{variant:"headingMd",children:"Quick Actions"}),e.jsxs(l,{gap:"300",wrap:!0,children:[e.jsx(c,{onClick:()=>s("/ai-seo/products"),children:"Optimize Products"}),y&&e.jsx(c,{onClick:()=>s("/ai-seo/collections"),children:"Optimize Collections"}),e.jsx(c,{onClick:()=>s("/ai-seo/sitemap"),children:"View Sitemap"}),A&&e.jsx(c,{onClick:()=>s("/ai-seo/store-metadata"),children:"Store Info"}),E&&e.jsx(c,{onClick:()=>s("/ai-seo/schema-data"),children:"Schema Data"})]})]})})}),e.jsx(o.Section,{children:e.jsx(r,{children:e.jsxs(d,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(i,{variant:"headingMd",children:"Current Plan"}),e.jsx(j,{paddingBlockStart:"100",children:e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["$",(a==null?void 0:a.price)||0,"/month"]})})]}),e.jsx(P,{tone:"info",size:"large",children:((D=a==null?void 0:a.plan)==null?void 0:D.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsx(c,{onClick:()=>s("/billing"),children:"View Plans & Billing"})]})})})]})}export{G as default};
