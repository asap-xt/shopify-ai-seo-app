import{r as P}from"./react-vendor-6uwpMgJP.js";import{a as T}from"./app-bridge-ugs9K9zh.js";function w(){const e=new URLSearchParams(window.location.search),o=e.get("shop")||void 0,n=e.get("id_token")||void 0;return async function(a,{method:p="GET",params:d,body:l,headers:m}={}){const i=new URL(a,window.location.origin),h=new URLSearchParams(d||{}),y=/\/shop\/[^/?]+/.test(i.pathname),f=i.searchParams.has("shop")||h.has("shop");!y&&!f&&o&&h.set("shop",o),[...h.keys()].length&&(i.search=(i.search?i.search+"&":"?")+h.toString());const c={...m};if(n&&(c.Authorization=`Bearer ${n}`),p!=="GET"&&!c["Content-Type"]&&(c["Content-Type"]="application/json"),!n)try{console.log("[API] Attempting to get session token...");const t=await T.getSessionToken();console.log("[API] Session token received:",t?`${t.substring(0,20)}...`:"null"),t&&(c.Authorization=`Bearer ${t}`)}catch(t){console.warn("[API] Failed to get session token (this is OK):",t.message),console.warn("[API] Error details:",t)}const s=await fetch(i.toString(),{method:p,headers:c,body:p!=="GET"&&l?JSON.stringify(l):void 0});if(!s.ok){let t;if((s.headers.get("content-type")||"").includes("application/json"))try{t=await s.json()}catch{t={error:await s.text().catch(()=>s.statusText)}}else t={error:await s.text().catch(()=>s.statusText)};if(s.status===402&&t){const u=new Error(t.error||t.message||"Payment Required");throw u.status=402,Object.assign(u,t),u}const g=new Error(t.error||t.message||s.statusText);throw g.status=s.status,g}return(s.headers.get("content-type")||"").includes("application/json")?s.json():s.text()}}async function S(e,o={}){return w()(e,o)}async function A(e,o,n={}){return w()(e,{method:"POST",body:o,...n})}const k=(e,o="")=>{try{return new URLSearchParams(window.location.search).get(e)||o}catch{return o}};function U(){const e=k("shop","");return{api:P.useMemo(()=>async(n,r={})=>{const a=new URL(n,window.location.origin);return!a.searchParams.has("shop")&&e&&a.searchParams.set("shop",e),r.method==="POST"||r.body?A(a.pathname+a.search,r.body||{},r):S(a.pathname+a.search,r)},[e]),shop:e}}export{U as u};
