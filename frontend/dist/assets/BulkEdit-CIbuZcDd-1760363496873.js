import{j as e}from"./app-bridge-Dy0y_Fwv-1760363496873.js";import{r as o}from"./react-vendor-tAaa2TlE-1760363496873.js";import{u as Ht}from"./index-LVvJpX1W-1760363496873.js";import{U as Ft,I as Kt}from"./InsufficientTokensModal-DkEQXjU5-1760363496873.js";import{M as w,d as R,T as r,e as st,f as Be,B as v,a as c,I as y,g as Pe,D as qt,h as Y,C as nt,i as Yt,S as _t,P as Ie,j as we,R as Vt,k as Qt,l as ot,m as Jt,E as Xt}from"./polaris-Beu_jsXB-1760363496873.js";const Zt=(b,g="")=>{try{return new URLSearchParams(window.location.search).get(b)||g}catch{return g}},ce=b=>{if(!b)return b;const g=String(b).trim();return g.startsWith("gid://")?g:`gid://shopify/Product/${g}`},es=b=>{if(!b)return"";const g=String(b).match(/\/(\d+)$/);return g?g[1]:b},W=b=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(b==null?void 0:b.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(b==null?void 0:b.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}};function rs({shop:b}){const{api:g,shop:at}=Ht(),i=b||at||Zt("shop","");o.useEffect(()=>{},[i,g]);const[x,H]=o.useState([]),[ee,de]=o.useState(!1),[lt,Ne]=o.useState(1),[rt,Ee]=o.useState(!0),[F,We]=o.useState(0),[f,te]=o.useState([]),[E,ue]=o.useState(!1),[K,Ge]=o.useState(""),[M,he]=o.useState("all"),[T,se]=o.useState(""),[ge,ts]=o.useState("createdAt"),[_,it]=o.useState("desc"),[U,pe]=o.useState([]),[ct,dt]=o.useState([]),[He,Ae]=o.useState(!1),[Fe,Oe]=o.useState(!1),[Ke,Le]=o.useState(!1),[qe,ve]=o.useState(!1),[ut,ht]=o.useState(""),[gt,pt]=o.useState([]),[z,V]=o.useState([]),[A,Ye]=o.useState([]),[ke,Q]=o.useState(!1),[me,B]=o.useState({current:0,total:0,percent:0}),[_e,J]=o.useState(""),[fe,ne]=o.useState([]),[oe,Ve]=o.useState({}),[mt,Te]=o.useState(!1),[ft,Se]=o.useState(!1),[St,ae]=o.useState(!1),[N,le]=o.useState([]),[xt,xe]=o.useState(!1),[Qe,C]=o.useState(""),[Je,jt]=o.useState(!1),[O,X]=o.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[L,yt]=o.useState(null),[re,bt]=o.useState(1),[Ct,je]=o.useState(!1),[ye,Pt]=o.useState(localStorage.getItem("hasVisitedProducts")==="true"),[It,Me]=o.useState(!1),[wt,Xe]=o.useState(!1),[q,ze]=o.useState(null),[be,Ze]=o.useState("starter");o.useEffect(()=>{if(!i)return;g("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
        }
      }
    `,variables:{shop:i}})}).then(n=>{var p,d,h;if((p=n==null?void 0:n.errors)!=null&&p.length)throw new Error(((d=n.errors[0])==null?void 0:d.message)||"GraphQL error");const s=(h=n==null?void 0:n.data)==null?void 0:h.plansMe,a=(s==null?void 0:s.modelsSuggested)||["anthropic/claude-3.5-sonnet"];pt(a.map(S=>({label:S,value:S}))),ht(a[0]),yt((s==null?void 0:s.plan)||"starter"),Ze((s==null?void 0:s.planKey)||"starter");const u=((s==null?void 0:s.planKey)||"starter").toLowerCase();bt({starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[u]||1)}).catch(n=>console.error("[BULK-EDIT] GraphQL plansMe failed:",n))},[i,g]),o.useEffect(()=>{if(!i)return;const t=new Promise((n,s)=>{setTimeout(()=>s(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([g(`/api/languages/shop/${i}`),t]).then(n=>{const s=Array.isArray(n==null?void 0:n.shopLanguages)&&n.shopLanguages.length?n.shopLanguages:["en"];Ye(s.includes("en")?s:["en",...s])}).catch(n=>{console.error("[BULK-EDIT] Languages API error:",n),Ye(["en"])})},[i,g]),o.useEffect(()=>{i&&g("/api/products/tags/list",{shop:i}).then(t=>dt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[i,g]);const G=o.useCallback(async(t=1,n=!1,s=null)=>{var a,u,l,p,d;de(!0);try{const h=new URLSearchParams({shop:i,page:t,limit:50,...M!=="all"&&{optimized:M},...K&&{search:K},...T&&{languageFilter:T},...U.length>0&&{tags:U.join(",")},sortBy:ge,sortOrder:_,...s&&{_t:s}}),S=await g(`/api/products/list?${h}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((a=S.products)==null?void 0:a.length)>0,console.log("[LOAD-PRODUCTS] ===== PRODUCTS LOADED ====="),console.log("[LOAD-PRODUCTS] Total products:",(u=S.products)==null?void 0:u.length),((l=S.products)==null?void 0:l.length)>0&&S.products.forEach((j,$)=>{var m,k;console.log(`[LOAD-PRODUCTS] Product ${$}: ID=${j.id} (type: ${typeof j.id}), _id=${j._id}, title="${j.title}", has SEO: ${!!((k=(m=j.optimizationSummary)==null?void 0:m.optimizedLanguages)!=null&&k.length)}`)}),H(n?j=>[...j,...S.products]:S.products||[]),Ne(t),Ee(((p=S.pagination)==null?void 0:p.hasNext)||!1),We(((d=S.pagination)==null?void 0:d.total)||0)}catch(h){H(n?x:[]),Ee(!1),C(`Error loading products: ${h.message}`)}finally{de(!1)}},[i,M,K,T,U,ge,_]);o.useEffect(()=>{i&&G(1,!1,null)},[i,G,M,T,U,ge,_]),o.useEffect(()=>{!ye&&i&&(localStorage.setItem("hasVisitedProducts","true"),Pt(!0))},[ye,i]),o.useEffect(()=>{x.length===0&&!ee&&i&&!ye&&je(!0)},[x.length,ee,i,ye]),o.useEffect(()=>{console.log("[DEBUG-MONITOR] ===== STATE CHANGED ====="),console.log("[DEBUG-MONITOR] Products count:",x.length),console.log("[DEBUG-MONITOR] Selected items count:",f.length),console.log("[DEBUG-MONITOR] Products:",x.map(t=>({id:t.id,title:t.title}))),console.log("[DEBUG-MONITOR] Selected items:",f)},[x,f]);const et=o.useCallback(t=>{Ge(t)},[]);o.useEffect(()=>{const t=setTimeout(()=>{i&&G(1,!1,null)},500);return()=>clearTimeout(t)},[K]);const Et=o.useCallback(t=>{console.log("[SELECTION-CHANGE] ===== SELECTION CHANGED ====="),console.log("[SELECTION-CHANGE] New selected items:",t),console.log("[SELECTION-CHANGE] Item count:",t.length),console.log("[SELECTION-CHANGE] Item types:",t.map(n=>typeof n)),console.log("[SELECTION-CHANGE] Current products count:",x.length),console.log("[SELECTION-CHANGE] Current products IDs:",x.map(n=>n.id)),te(t),t.length===0&&ue(!1)},[x]),tt=o.useCallback(t=>{ue(t),te(t?x.map(n=>n.id):[])},[x]),At=()=>{if(f.length===0&&!E){C("Please select products first");return}Se(!0)},Ot=()=>{if(f.length===0&&!E){C("Please select products first");return}le([]),ae(!0)},Lt=async()=>{const n=x.filter(a=>f.includes(a.id)).filter(a=>{var u,l;return((l=(u=a.optimizationSummary)==null?void 0:u.optimizedLanguages)==null?void 0:l.length)>0});X({processing:!0,current:0,total:n.length,currentItem:"",results:null});const s={successful:0,failed:0,skipped:0};for(let a=0;a<n.length;a++){const u=n[a];X(l=>({...l,current:a,currentItem:u.title}));try{const l=await g("/ai-enhance/product",{method:"POST",shop:i,body:{shop:i,productId:u.gid||ce(u.id),languages:u.optimizationSummary.optimizedLanguages}});if(l.results&&l.results.length>0){const p={shop:i,productId:u.gid||ce(u.id),results:l.results.filter(h=>h.bullets&&h.faq).map(h=>({language:h.language,seo:{...h.updatedSeo,bullets:h.bullets||[],faq:h.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},d=await g("/api/seo/apply-multi",{method:"POST",shop:i,body:p});s.successful++}else s.failed++}catch(l){if(console.error("Enhancement error:",l),l.status===402||l.requiresPurchase||l.trialRestriction){X({processing:!1,current:0,total:0,currentItem:"",results:null}),ze(l),Ze(l.currentPlan||L||"starter"),l.trialRestriction?Me(!0):Xe(!0);return}s.failed++}X(l=>({...l,current:a+1}))}X(a=>({...a,processing:!1,results:s})),C(`AI enhancement complete! ${s.successful} products enhanced.`)},De=()=>{jt(!1),X({processing:!1,current:0,total:0,currentItem:"",results:null}),O.results&&O.results.successful>0&&G(1,!1,null)},vt=()=>O.processing?e.jsx(w,{open:Je,title:"Processing AI Enhancement",onClose:De,noScroll:!0,children:e.jsx(w.Section,{children:e.jsxs(R,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",O.currentItem]}),e.jsx(st,{progress:O.current/O.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[O.current," of ",O.total," products (",Math.round(O.current/O.total*100),"%)"]})]})})}):O.results!==null?e.jsx(w,{open:Je,title:"AI Enhancement Results",onClose:De,primaryAction:{content:"Done",onAction:De},children:e.jsx(w.Section,{children:e.jsx(R,{gap:"300",children:e.jsxs(y,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:O.results.successful})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:O.results.failed})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:O.results.skipped})]})]})})})}):null,kt=async()=>{var n;if(!z.length){C("Please select at least one language");return}let t=ut;(!t||!t.trim())&&(t=((n=gt[0])==null?void 0:n.value)||"anthropic/claude-3.5-sonnet"),Se(!1),Q(!0),B({current:0,total:0,percent:0}),ne([]),Ve({});try{let s=[];E?s=(await g(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:s=x.filter(m=>f.includes(m.id));const a=W(L),u=s.length;s=s.slice(0,a);const l=s.length,p=u-l;B({current:0,total:l,percent:0});const d=5,h={};for(let m=0;m<s.length;m+=d){const P=s.slice(m,Math.min(m+d,s.length)).map(async I=>{var Z;J(I.title||I.handle||"Product");try{const Ce=I.gid||ce(I.productId||I.id),Ue=((Z=I.optimizationSummary)==null?void 0:Z.optimizedLanguages)||[],$e=z.filter(Gt=>!Ue.includes(Gt));if($e.length===0){h[I.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Wt=await g("/api/seo/generate-multi",{method:"POST",shop:i,body:{shop:i,productId:Ce,model:t,languages:$e}});h[I.id]={success:!0,data:Wt,languages:$e}}catch(Ce){h[I.id]={success:!1,error:Ce.message},ne(Ue=>[...Ue,{product:I.title,error:Ce.message}])}});await Promise.all(P);const D=Math.min(m+d,s.length),ie=Math.round(D/l*100);B({current:D,total:l,percent:ie})}Ve(h),Te(!0);const S=Object.keys(h).filter(m=>h[m].success&&!h[m].skipped).length,j=Object.keys(h).filter(m=>h[m].skipped).length;let $=`Generated Optimization for AI Search for ${S} products`;j>0&&($+=` (${j} already optimised)`),p>0&&($+=` (${p} skipped due to plan limit)`),C($)}catch(s){C(`Error: ${s.message}`)}finally{Q(!1),J("")}},Tt=async()=>{var t,n;Q(!0),B({current:0,total:0,percent:0});try{const s=Object.entries(oe).filter(([p,d])=>d.success&&!d.skipped),a=s.length;B({current:0,total:a,percent:0});for(let p=0;p<s.length;p++){const[d,h]=s[p],S=x.find(m=>m.id===d);if(!S)continue;J(S.title||"Product");try{const m=S.gid||ce(S.productId||S.id),k=await g("/api/seo/apply-multi",{method:"POST",shop:i,body:{shop:i,productId:m,results:h.data.results.filter(P=>P==null?void 0:P.seo).map(P=>({language:P.language,seo:P.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});k.appliedLanguages&&k.appliedLanguages.length>0&&H(P=>P.map(D=>{var ie;if(D.id===d){const I=((ie=D.optimizationSummary)==null?void 0:ie.optimizedLanguages)||[],Z=[...new Set([...I,...k.appliedLanguages])];return{...D,optimizationSummary:{...D.optimizationSummary,optimizedLanguages:Z,optimized:!0,lastOptimized:new Date().toISOString()}}}return D}))}catch(m){ne(k=>[...k,{product:S.title,error:`Apply failed: ${m.message}`}])}const j=p+1,$=Math.round(j/a*100);B({current:j,total:a,percent:$})}C("AI Search Optimisation applied successfully!"),Te(!1),console.log("[APPLY-SEO] ===== CLEARING SELECTION ====="),console.log("[APPLY-SEO] Selected items BEFORE clear:",f),te([]),ue(!1),console.log("[APPLY-SEO] Selected items cleared"),console.log("[APPLY-SEO] Waiting for database propagation..."),await new Promise(p=>setTimeout(p,1e3)),console.log("[APPLY-SEO] Clearing products state before reload..."),H([]);const u=new URLSearchParams({shop:i,page:1,limit:50,...M!=="all"&&{optimized:M},...K&&{search:K},...T&&{languageFilter:T},...U.length>0&&{tags:U.join(",")},sortBy:ge,sortOrder:_,_t:Date.now()}),l=await g(`/api/products/list?${u}`,{shop:i,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});H(l.products||[]),Ne(1),Ee(((t=l.pagination)==null?void 0:t.hasNext)||!1),We(((n=l.pagination)==null?void 0:n.total)||0)}catch(s){C(`Error applying AI Search Optimisation: ${s.message}`)}finally{Q(!1),J("")}},Mt=async()=>{var t;if(!N.length){C("Please select at least one language to delete");return}ae(!1),xe(!1),Q(!0),B({current:0,total:0,percent:0}),ne([]);try{let n=[];E?n=(await g(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:n=x.filter(l=>f.includes(l.id));const s=n.length;B({current:0,total:s,percent:0});let a=0,u=0;for(let l=0;l<n.length;l++){const p=n[l];J(p.title||p.handle||"Product");try{const S=p.gid||ce(p.productId||p.id),j=((t=p.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],$=N.filter(k=>j&&j.length>0&&j.includes(k));if($.length===0){u++;continue}const m=await g("/api/seo/delete-multi",{method:"POST",shop:i,body:{shop:i,productId:S,languages:$}});m.deletedLanguages&&m.deletedLanguages.length>0&&H(k=>k.map(P=>{var D;if(P.id===p.id){const I=(((D=P.optimizationSummary)==null?void 0:D.optimizedLanguages)||[]).filter(Z=>!m.deletedLanguages.includes(Z));return{...P,optimizationSummary:{...P.optimizationSummary,optimizedLanguages:I,optimized:I.length>0,lastOptimized:I.length>0?P.optimizationSummary.lastOptimized:null}}}return P})),a++,m.deletedLanguages&&m.deletedLanguages.length>0&&await g("/api/products/verify-after-delete",{method:"POST",shop:i,body:{shop:i,productIds:[S],deletedLanguages:m.deletedLanguages}})}catch(S){ne(j=>[...j,{product:p.title,error:S.message}])}const d=l+1,h=Math.round(d/s*100);B({current:d,total:s,percent:h})}te([]),ue(!1),u>0?C(`Deleted Optimization for AI Search from ${a} products (${u} had no optimisation to delete)`):C(`Deleted Optimization for AI Search from ${a} products`),setTimeout(()=>{const l=Date.now();G(1,!1,l)},500)}catch(n){C(`Error: ${n.message}`)}finally{Q(!1),J("")}},zt=t=>{var n,s;try{const a=t,u=es(a.productId||a.id),l=((n=a.optimizationSummary)==null?void 0:n.optimizedLanguages)||[];console.log(`[BULK-EDIT-RENDER] Product: "${a.title}", ID: ${a.id}, Type: ${typeof a.id}`),console.log("[BULK-EDIT-RENDER] Optimized Languages:",l),console.log("[BULK-EDIT-RENDER] Selected Items:",f),console.log("[BULK-EDIT-RENDER] Is Selected:",f.includes(a.id));const p=(s=a.images)!=null&&s[0]?e.jsx(ot,{source:a.images[0].url||a.images[0].src||a.images[0],alt:a.title,size:"small"}):a.imageUrl?e.jsx(ot,{source:a.imageUrl,alt:a.title,size:"small"}):e.jsx(c,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Jt,{id:a.id,media:p,accessibilityLabel:`View details for ${a.title}`,onClick:d=>{console.log("[ResourceItem] ===== CLICK ON RESOURCE ITEM ====="),console.log("[ResourceItem] e.target:",d.target),console.log("[ResourceItem] e.target.tagName:",d.target.tagName),console.log('[ResourceItem] e.target.closest("input"):',d.target.closest("input")),console.log('[ResourceItem] e.target.closest("a"):',d.target.closest("a")),console.log("[ResourceItem] Event bubbling up...")},children:e.jsxs(y,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(c,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:a.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["ID: ",u]})]}),e.jsx(c,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(y,{gap:"100",children:A.length>0?A.map(d=>{const h=l.includes(d);return e.jsx(Y,{tone:h?"success":"subdued",size:"small",children:d.toUpperCase()},d)}):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),l.map(d=>e.jsx(Y,{tone:"success",size:"small",children:d.toUpperCase()},d)))})}),e.jsx(c,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(Y,{tone:"success",children:"Active"})})]})})}catch(a){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",a),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},Dt=ke&&e.jsx(w,{open:ke,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(w.Section,{children:e.jsxs(R,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:_e?`Processing: ${_e}`:"Preparing..."}),e.jsx(st,{progress:me.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[me.current," of ",me.total," products (",me.percent,"%)"]})]})})}),Rt=e.jsx(w,{open:ft,title:"Select Languages",onClose:()=>{Se(!1),V([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:kt,disabled:z.length===0||z.length>re},secondaryActions:[{content:"Cancel",onAction:()=>{Se(!1),V([])}}],children:e.jsx(w.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",E?"all":f.length," selected products:"]}),z.length>re&&e.jsx(Be,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(R,{gap:"200",children:[e.jsxs(r,{variant:"bodyMd",children:["Your ",be," plan supports only ",re," language(s), but you selected ",z.length,"."]}),e.jsx(r,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan:"}),e.jsx(v,{variant:"primary",onClick:()=>{var t;window.location.href=`/billing?shop=${encodeURIComponent(i)}&host=${encodeURIComponent(((t=window.location.search.split("host=")[1])==null?void 0:t.split("&")[0])||"")}`},children:"Upgrade Plan"})]})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:A.map(t=>e.jsx(Pe,{label:t.toUpperCase(),checked:z.includes(t),onChange:n=>{V(n?[...z,t]:z.filter(s=>s!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(v,{plain:!0,onClick:()=>{z.length===A.length?V([]):A.length>re?(V([...A]),C(`You selected ${A.length} languages. Your ${be} plan supports ${re}. Please deselect or upgrade.`)):V([...A])},children:z.length===A.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Ut=e.jsx(w,{open:mt&&!ke,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:Tt,disabled:!Object.values(oe).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Te(!1)}],children:e.jsx(w.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsxs(y,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(oe).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(oe).filter(t=>t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(oe).filter(t=>!t.success).length})]})]}),fe.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(qt,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(c,{maxHeight:"200px",overflowY:"scroll",children:[fe.slice(0,10).map((t,n)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},n)),fe.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",fe.length-10," more errors"]})]})]})]})})}),$t=e.jsx(w,{open:St,title:"Delete Optimization for AI Search",onClose:()=>{ae(!1),le([])},primaryAction:{content:"Continue",onAction:()=>{ae(!1),xe(!0)},disabled:N.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{ae(!1),le([])}}],children:e.jsx(w.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",E?"all":f.length," selected products:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:A.map(t=>e.jsx(Pe,{label:t.toUpperCase(),checked:N.includes(t),onChange:n=>{le(n?[...N,t]:N.filter(s=>s!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(v,{plain:!0,onClick:()=>{le(N.length===A.length?[]:[...A])},children:N.length===A.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Bt=e.jsx(w,{open:xt,title:"Confirm Deletion",onClose:()=>{xe(!1)},primaryAction:{content:"Delete",onAction:Mt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>xe(!1)}],children:e.jsx(w.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(c,{paddingBlock:"200",children:e.jsx(y,{gap:"100",children:N.map(t=>e.jsx(Y,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",E?"ALL":f.length," selected products."]}),e.jsx(r,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Re=async()=>{try{de(!0),C("Syncing products from Shopify...");const t=await g("/api/products/sync",{method:"POST",shop:i});if(t.success){const n=t.productsCount||t.synced||0;C(`✅ Synced ${n} products successfully!`),setTimeout(()=>{G(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),C(`❌ Sync failed: ${t.message}`)}finally{de(!1)}},Nt=e.jsx(Xt,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Ge(""),he("all"),se(""),pe([]),G(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Re},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(nt,{children:e.jsxs(c,{padding:"400",children:[e.jsxs(R,{gap:"300",children:[L&&e.jsx(Be,{tone:"info",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(r,{children:["Your ",e.jsx("strong",{children:L})," plan includes up to"," ",e.jsx("strong",{children:W(L)})," products for SEO optimization.",F>W(L)&&e.jsxs(e.Fragment,{children:[" You have ",F," products, so only the first ",W(L)," will be processed."]})]}),(f.length>0||E)&&e.jsxs(r,{children:["Selected: ",E?Math.min(F,W(L)):f.length,"/",W(L)]})]})}),L&&(f.length>W(L)||E&&F>W(L))&&e.jsx(Be,{tone:"warning",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(r,{children:[e.jsx("strong",{children:"Plan Limit Exceeded:"})," You've selected more products than your ",L," plan allows. Only the first ",W(L)," products will be processed."]}),e.jsx(v,{size:"micro",onClick:()=>Me(!0),children:"Upgrade Plan"})]})}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(c,{minWidth:"400px",children:e.jsx(Yt,{label:"",placeholder:"Search by product ID, name, or details...",value:K,onChange:et,prefix:e.jsx(_t,{}),clearButton:!0,onClearButtonClick:()=>et("")})}),e.jsx(c,{width:"320px",children:e.jsx(v,{primary:!0,onClick:At,disabled:f.length===0&&!E,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(v,{onClick:Re,disabled:ee,size:"medium",children:"Sync Products"}),e.jsx(c,{width:"320px",children:e.jsxs(R,{gap:"200",align:"end",children:[f.length===0&&!E||!x.filter(s=>f.includes(s.id)).some(s=>{var a,u;return((u=(a=s.optimizationSummary)==null?void 0:a.optimizedLanguages)==null?void 0:u.length)>0})?null:e.jsx(v,{onClick:Lt,disabled:f.length===0&&!E,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(v,{onClick:Ot,disabled:f.length===0&&!E||!x.filter(s=>f.includes(s.id)).some(s=>{var a,u;return((u=(a=s.optimizationSummary)==null?void 0:a.optimizedLanguages)==null?void 0:u.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),F>0&&e.jsx(c,{paddingBlockStart:"300",children:e.jsx(Pe,{label:`Select all ${F} products in your store`,checked:E,onChange:tt})})]})}),e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(nt,{children:[e.jsxs(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(y,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(y,{gap:"200",wrap:!0,children:[e.jsx(Ie,{active:He,activator:e.jsx(v,{disclosure:"down",onClick:()=>Ae(!He),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),M!=="all"&&e.jsx(c,{onClick:t=>{t.stopPropagation(),he("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Ae(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(we,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[M],onChange:t=>{he(t[0]),se(""),Ae(!1)}})})}),e.jsx(Ie,{active:Fe,activator:e.jsx(v,{disclosure:"down",onClick:()=>Oe(!Fe),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),T&&e.jsx(c,{onClick:t=>{t.stopPropagation(),se("")},children:e.jsx(r,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Oe(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(we,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...A.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...A.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:T?[T]:[],onChange:t=>{se(t[0]||""),Oe(!1)}})})}),e.jsx(Ie,{active:Ke,activator:e.jsx(v,{disclosure:"down",onClick:()=>Le(!Ke),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),U.length>0&&e.jsx(c,{onClick:t=>{t.stopPropagation(),pe([])},children:e.jsx(r,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Le(!1),children:e.jsxs(c,{padding:"300",minWidth:"200px",children:[e.jsx(we,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:ct.map(t=>({label:t,value:t})),selected:U,onChange:t=>{pe(t)}}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(v,{size:"slim",onClick:()=>Le(!1),children:"Apply"})})]})})]}),e.jsx(Ie,{active:qe,activator:e.jsx(v,{disclosure:"down",onClick:()=>ve(!qe),removeUnderline:!0,children:e.jsx(y,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:_==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>ve(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(we,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[_],onChange:t=>{it(t[0]),ve(!1)}})})})]}),(M!=="all"||T||U.length>0)&&e.jsx(c,{paddingBlockStart:"200",children:e.jsxs(y,{gap:"100",wrap:!0,children:[M!=="all"&&e.jsx(Y,{onRemove:()=>he("all"),children:M==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),T&&e.jsx(Y,{onRemove:()=>se(""),children:T.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),U.map(t=>e.jsxs(Y,{onRemove:()=>pe(n=>n.filter(s=>s!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(c,{children:[e.jsx(c,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(y,{gap:"200",align:"start",children:[e.jsx(Pe,{checked:f.length===x.length&&x.length>0,onChange:tt,label:""}),e.jsxs(r,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",f.length>0&&` (${f.length} selected products)`]})]})}),e.jsx(Vt,{resourceName:{singular:"product",plural:"products"},items:x,renderItem:zt,selectedItems:f,onSelectionChange:Et,selectable:!0,loading:ee,totalItemsCount:F,emptyState:Nt,showHeader:!1},`products-${x.length}-${f.length}`)]}),rt&&!ee&&e.jsx(c,{padding:"400",textAlign:"center",children:e.jsx(v,{onClick:()=>G(lt+1,!0,null),children:"Load more"})})]})}),Dt,Rt,Ut,$t,Bt,vt(),e.jsx(w,{open:Ct,onClose:()=>je(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{je(!1),Re()}},secondaryActions:[{content:"Skip for now",onAction:()=>je(!1)}],children:e.jsx(w.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(r,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Ft,{open:It,onClose:()=>{Me(!1),ze(null)},featureName:"AI Enhancement",currentPlan:be}),q&&e.jsx(Kt,{open:wt,onClose:()=>{Xe(!1),ze(null)},tokensRequired:q.tokensRequired||0,tokensAvailable:q.tokensAvailable||0,tokensNeeded:q.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:i,needsUpgrade:q.needsUpgrade||!1,minimumPlan:q.minimumPlanForFeature||null,currentPlan:q.currentPlan||be}),Qe&&e.jsx(Qt,{content:Qe,onDismiss:()=>C("")})]})}export{rs as default};
