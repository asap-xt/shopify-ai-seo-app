import{j as t}from"./app-bridge-DTE91Ko9-1759207090686.js";import{r as g}from"./react-vendor-tAaa2TlE-1759207090686.js";import{m as Q}from"./index-CFnK_KSE-1759207090686.js";import{C as x,a as p,T as y,h as Z,L as M,s as f,i as l,D as aa,f as _,I as J,t as ea,B as w,k as ta}from"./polaris-BrE7Wu1T-1759207090686.js";const na=(j,h="")=>{try{return new URLSearchParams(window.location.search).get(j)||h}catch{return h}};function ra({shop:j}){var E,v,R,P,$;const h=j||na("shop",""),[F,z]=g.useState(!1),[V,T]=g.useState(!1),[k,S]=g.useState(""),[u,G]=g.useState(null),b=g.useMemo(()=>Q({}),[]),[H,B]=g.useState(!1),[X,A]=g.useState(!1),[o,s]=g.useState({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}});g.useEffect(()=>{h&&K()},[h,b]);async function K(){var e;z(!0);try{const a=`/api/store/generate?shop=${encodeURIComponent(h)}`;console.log("[StoreMeta] GET",a);const i=await b(a,{headers:{"X-Shop":h}});if(console.log("[StoreMeta] GET ok",{url:a,keys:Object.keys(i||{})}),console.log("[StoreMeta] storeData.features:",i.features),console.log("[StoreMeta] organizationSchema available:",(e=i.features)==null?void 0:e.organizationSchema),G(i),i.existingMetadata){const n=i.existingMetadata;s(d=>{var r,c,m,O,I,L,D,N,U,q;return{...d,seo:{...d.seo,...((r=n.seo_metadata)==null?void 0:r.value)||{},keywords:Array.isArray((m=(c=n.seo_metadata)==null?void 0:c.value)==null?void 0:m.keywords)?n.seo_metadata.value.keywords.join(", "):((I=(O=n.seo_metadata)==null?void 0:O.value)==null?void 0:I.keywords)||d.seo.keywords||""},aiMetadata:((L=n.ai_metadata)==null?void 0:L.value)||d.aiMetadata,organizationSchema:{...d.organizationSchema,...((D=n.organization_schema)==null?void 0:D.value)||{},enabled:((U=(N=n.organization_schema)==null?void 0:N.value)==null?void 0:U.enabled)===!0},localBusinessSchema:((q=n.local_business_schema)==null?void 0:q.value)||d.localBusinessSchema}})}i.shopInfo&&s(n=>{var d,r,c;return{...n,seo:{...n.seo,title:n.seo.title||i.shopInfo.name,metaDescription:n.seo.metaDescription||i.shopInfo.description},organizationSchema:{...n.organizationSchema,name:n.organizationSchema.name||i.shopInfo.name,email:n.organizationSchema.email||i.shopInfo.email},aiMetadata:{...n.aiMetadata,languages:((d=n.aiMetadata.languages)==null?void 0:d.length)>0?n.aiMetadata.languages:(i.shopInfo.locales||[]).filter(m=>m.published).map(m=>m.locale),supportedCurrencies:((r=n.aiMetadata.supportedCurrencies)==null?void 0:r.length)>0?n.aiMetadata.supportedCurrencies:i.shopInfo.currencies||["EUR"],shippingRegions:((c=n.aiMetadata.shippingRegions)==null?void 0:c.length)>0?n.aiMetadata.shippingRegions:(i.shopInfo.markets||[]).map(m=>m.name)}}})}catch(a){console.error("[StoreMeta] GET error",(a==null?void 0:a.debug)||a,a),S(`Load failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{z(!1)}}async function C(){T(!0);try{const e=`/api/store/apply?shop=${encodeURIComponent(h)}`;console.log("[StoreMeta] SAVE",e);const a=await b(e,{method:"POST",headers:{"X-Shop":h},body:{metadata:o,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:o.organizationSchema.enabled,updateLocalBusiness:o.localBusinessSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:e,ok:a==null?void 0:a.ok}),S("Metadata saved successfully!")}catch(e){console.error("[StoreMeta] SAVE error",(e==null?void 0:e.debug)||e,e),S(`Save failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{T(!1)}}async function W(){var e;B(!0);try{await C();const i=await b("/graphql",{method:"POST",headers:{"X-Shop":h},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            seoMetadata
            aiMetadata
            organizationSchema
            localBusinessSchema
          }
        }
      `,variables:{shop:h}}});if(i.error)throw new Error(i.error);const n=(e=i.data)==null?void 0:e.storeMetadata;if(n){const d=window.open("","_blank");console.log("[STORE-METADATA] Raw preview data:",n),console.log("[STORE-METADATA] seoMetadata raw:",n.seoMetadata),console.log("[STORE-METADATA] aiMetadata raw:",n.aiMetadata),console.log("[STORE-METADATA] organizationSchema raw:",n.organizationSchema);const r={shopName:n.shopName,description:n.description,seoMetadata:n.seoMetadata?(()=>{try{return JSON.parse(n.seoMetadata)}catch(c){return console.error("Error parsing seoMetadata:",c),n.seoMetadata}})():null,aiMetadata:n.aiMetadata?(()=>{try{return JSON.parse(n.aiMetadata)}catch(c){return console.error("Error parsing aiMetadata:",c),n.aiMetadata}})():null,organizationSchema:n.organizationSchema?(()=>{try{return JSON.parse(n.organizationSchema)}catch(c){return console.error("Error parsing organizationSchema:",c),n.organizationSchema}})():null,localBusinessSchema:n.localBusinessSchema?(()=>{try{return JSON.parse(n.localBusinessSchema)}catch(c){return console.error("Error parsing localBusinessSchema:",c),n.localBusinessSchema}})():null};d.document.write(`
          <html>
            <head>
              <title>Store Metadata Preview</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
                h1 { color: #333; }
                .section { margin: 20px 0; }
                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
              </style>
            </head>
            <body>
              <h1>Store Metadata Preview</h1>
              <div class="section">
                <h2>Basic Info</h2>
                <p><strong>Shop Name:</strong> ${r.shopName||"Not set"}</p>
                <p><strong>Description:</strong> ${r.description||"Not set"}</p>
              </div>
              
              <div class="section">
                <h2>SEO Metadata</h2>
                <pre>${JSON.stringify(r.seoMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>AI Metadata</h2>
                <pre>${JSON.stringify(r.aiMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Organization Schema</h2>
                <pre>${JSON.stringify(r.organizationSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Local Business Schema</h2>
                <pre>${JSON.stringify(r.localBusinessSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Raw Data</h2>
                <pre>${JSON.stringify(r,null,2)}</pre>
              </div>
            </body>
          </html>
        `),d.document.close()}else throw new Error("No preview data available")}catch(a){S(`Preview failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{B(!1)}}async function Y(){A(!0);try{s({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}}),await C(),S("Metadata cleared successfully!")}catch(e){S(`Clear failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{A(!1)}}return F&&!u?t.jsx(x,{children:t.jsx(p,{padding:"400",children:t.jsx(y,{children:"Loading store data..."})})}):(u==null?void 0:u.plan)==="Starter"?t.jsx(Z,{status:"warning",children:t.jsx(y,{children:"Store metadata features are available starting from the Professional plan."})}):t.jsxs(M,{children:[t.jsx(M.Section,{children:t.jsx(x,{title:"Basic Store Information",children:t.jsx(p,{padding:"400",children:t.jsxs(f,{children:[t.jsx(l,{label:"Store Title",value:o.seo.title,onChange:e=>s(a=>({...a,seo:{...a.seo,title:e}})),helpText:"Short & appealing, max 100 characters (auto-filled from shop name)",maxLength:100}),t.jsx(l,{label:"Store Description",value:o.seo.metaDescription,onChange:e=>s(a=>({...a,seo:{...a.seo,metaDescription:e}})),helpText:"Tell briefly what best describes your business, max 300 chars (auto-filled from shop description)",maxLength:300,multiline:3}),t.jsx(l,{label:"Keywords",value:o.seo.keywords,onChange:e=>s(a=>({...a,seo:{...a.seo,keywords:e}})),helpText:"Comma-separated keywords, max 10 keywords, max 3 words each"})]})})})}),t.jsx(M.Section,{children:t.jsx(x,{title:"AI Metadata",children:t.jsx(p,{padding:"400",children:t.jsxs(f,{children:[t.jsxs(f.Group,{children:[t.jsx(l,{label:"Business Type",value:o.aiMetadata.businessType,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,businessType:e}})),placeholder:"e.g., Fashion Retailer, Electronics Store",helpText:"Max 3 words"}),t.jsx(l,{label:"Target Audience",value:o.aiMetadata.targetAudience,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,targetAudience:e}})),placeholder:"e.g., Young professionals, Parents"})]}),t.jsx(l,{label:"Unique Selling Points",value:o.aiMetadata.uniqueSellingPoints,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,uniqueSellingPoints:e}})),helpText:"Comma-separated list",multiline:2}),t.jsx(l,{label:"Brand Voice",value:o.aiMetadata.brandVoice,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,brandVoice:e}})),placeholder:"e.g., Professional, Friendly, Casual"}),t.jsx(l,{label:"Primary Categories",value:o.aiMetadata.primaryCategories,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,primaryCategories:e}})),helpText:"Main product categories, comma-separated"}),t.jsx(l,{label:"Shipping Information",value:o.aiMetadata.shippingInfo,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,shippingInfo:e}})),helpText:"Shipping costs, delivery times, free shipping thresholds (e.g., Free shipping over $50, 2-3 business days)",multiline:2}),t.jsx(l,{label:"Return Policy",value:o.aiMetadata.returnPolicy,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,returnPolicy:e}})),multiline:2}),t.jsx(aa,{}),t.jsx(y,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),t.jsx(y,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),t.jsx(l,{label:"Supported Languages",value:((E=o.aiMetadata.languages)==null?void 0:E.join(", "))||"",onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,languages:e.split(",").map(i=>i.trim()).filter(i=>i)}})),helpText:"Comma-separated language codes (e.g., en, de, es, fr)",multiline:2}),t.jsx(l,{label:"Supported Currencies",value:((v=o.aiMetadata.supportedCurrencies)==null?void 0:v.join(", "))||"",onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,supportedCurrencies:e.split(",").map(i=>i.trim()).filter(i=>i)}})),helpText:"Comma-separated currency codes (e.g., EUR, USD, GBP)"}),t.jsx(l,{label:"Shipping Regions",value:((R=o.aiMetadata.shippingRegions)==null?void 0:R.join(", "))||"",onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,shippingRegions:e.split(",").map(i=>i.trim()).filter(i=>i)}})),helpText:"Comma-separated regions (e.g., EU, USA, UK, Canada)",multiline:2}),t.jsx(l,{label:"Cultural Considerations",value:o.aiMetadata.culturalConsiderations||"",onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,culturalConsiderations:e}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),((P=u==null?void 0:u.features)==null?void 0:P.organizationSchema)&&t.jsx(M.Section,{children:t.jsx(x,{title:"Organization Schema",children:t.jsxs(p,{padding:"400",children:[t.jsx(_,{label:"Enable Organization Schema",checked:o.organizationSchema.enabled,onChange:e=>s(a=>({...a,organizationSchema:{...a.organizationSchema,enabled:e}}))}),o.organizationSchema.enabled&&t.jsx(p,{paddingBlockStart:"400",children:t.jsxs(f,{children:[t.jsxs(f.Group,{children:[t.jsx(l,{label:"Organization Name",value:o.organizationSchema.name,onChange:e=>s(a=>({...a,organizationSchema:{...a.organizationSchema,name:e}}))}),t.jsx(l,{label:"Contact Email",value:o.organizationSchema.email,onChange:e=>s(a=>({...a,organizationSchema:{...a.organizationSchema,email:e}})),type:"email"})]}),t.jsx(l,{label:"Phone",value:o.organizationSchema.phone,onChange:e=>s(a=>({...a,organizationSchema:{...a.organizationSchema,phone:e}})),type:"tel"}),t.jsx(l,{label:"Logo URL",value:o.organizationSchema.logo,onChange:e=>s(a=>({...a,organizationSchema:{...a.organizationSchema,logo:e}})),type:"url"}),t.jsx(l,{label:"Social Media Links",value:o.organizationSchema.sameAs,onChange:e=>s(a=>({...a,organizationSchema:{...a.organizationSchema,sameAs:e}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}),(($=u==null?void 0:u.features)==null?void 0:$.localBusinessSchema)&&t.jsx(M.Section,{children:t.jsx(x,{title:"Local Business Schema",children:t.jsxs(p,{padding:"400",children:[t.jsxs(J,{align:"start",gap:"200",children:[t.jsx(_,{label:"Enable Local Business Schema",checked:o.localBusinessSchema.enabled,onChange:e=>s(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,enabled:e}}))}),t.jsx(ea,{content:"Optional - only enable if you have physical stores/locations",children:t.jsx(y,{variant:"bodyMd",color:"subdued",children:"ℹ️"})})]}),o.localBusinessSchema.enabled&&t.jsx(p,{paddingBlockStart:"400",children:t.jsxs(f,{children:[t.jsx(l,{label:"Price Range",value:o.localBusinessSchema.priceRange,onChange:e=>s(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,priceRange:e}})),helpText:"e.g., $, $$, $$$, $$$$"}),t.jsx(l,{label:"Opening Hours",value:o.localBusinessSchema.openingHours,onChange:e=>s(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,openingHours:e}})),helpText:"e.g., Mo-Fr 09:00-18:00, Sa 10:00-16:00",multiline:2})]})})]})})}),t.jsx(M.Section,{children:t.jsx(x,{children:t.jsx(p,{padding:"400",children:t.jsxs(J,{gap:"300",children:[t.jsx(w,{onClick:C,loading:V,primary:!0,children:"Save Metadata"}),t.jsx(w,{onClick:W,loading:H,children:"Preview Metadata"}),t.jsx(w,{onClick:Y,loading:X,destructive:!0,children:"Clear Metadata"})]})})})}),k&&t.jsx(ta,{content:k,onDismiss:()=>S("")})]})}export{ra as default};
