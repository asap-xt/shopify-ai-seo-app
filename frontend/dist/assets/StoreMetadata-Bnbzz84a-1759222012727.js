import{j as a}from"./app-bridge-CHcrOpzw-1759222012727.js";import{r as u}from"./react-vendor-tAaa2TlE-1759222012727.js";import{m as _e}from"./index-BSlQ8Xfn-1759222012727.js";import{C as M,a as d,T as m,h as Ce,L as j,B as T,s as b,i as o,D as Ie,f as ve,I as we,t as Ue,k as Fe}from"./polaris-Bn30mESX-1759222012727.js";const qe=(z,h="")=>{try{return new URLSearchParams(window.location.search).get(z)||h}catch{return h}};function We({shop:z}){var I,U,F,q,J;const h=z||qe("shop",""),[De,P]=u.useState(!1),[Te,E]=u.useState(!1),[R,f]=u.useState(""),[p,ze]=u.useState(null),D=u.useMemo(()=>_e({}),[]),[Be,$]=u.useState(!1),[ke,L]=u.useState(!1),[x,Ne]=u.useState({storeName:"",homePageTitle:"",metaDescription:""}),[Ae,O]=u.useState(!1),[s,i]=u.useState({seo:{storeName:"",shortDescription:"",fullDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}});u.useEffect(()=>{h&&_()},[h,D]);async function _(){var t,e,r,n,C,g,S,V,H,G,W,X;P(!0);try{const y=`/api/store/generate?shop=${encodeURIComponent(h)}`,c=await D(y,{headers:{"X-Shop":h}});ze(c),Ne({storeName:((t=c.shopifyDefaults)==null?void 0:t.storeName)||"",homePageTitle:((e=c.shopifyDefaults)==null?void 0:e.homePageTitle)||"",metaDescription:((r=c.shopifyDefaults)==null?void 0:r.metaDescription)||""});const l=c.existingMetadata||{},k=((C=(n=l.seo_metadata)==null?void 0:n.value)==null?void 0:C.storeName)||"",N=((S=(g=l.seo_metadata)==null?void 0:g.value)==null?void 0:S.shortDescription)||"",A=((H=(V=l.seo_metadata)==null?void 0:V.value)==null?void 0:H.fullDescription)||"",$e=k&&k!==((G=c.shopifyDefaults)==null?void 0:G.storeName),Le=N&&N!==((W=c.shopifyDefaults)==null?void 0:W.homePageTitle),Oe=A&&A!==((X=c.shopifyDefaults)==null?void 0:X.metaDescription);O($e||Le||Oe),i(v=>{var K,Y,Q,Z,ee,ae,te,se,ie,ne,oe,re,le,ce,de,he,ue,me,pe,ge,Se,fe,xe,ye,Me,je,be;return{...v,seo:{...v.seo,storeName:k,shortDescription:N,fullDescription:A,keywords:Array.isArray((Y=(K=l.seo_metadata)==null?void 0:K.value)==null?void 0:Y.keywords)?l.seo_metadata.value.keywords.join(", "):((Z=(Q=l.seo_metadata)==null?void 0:Q.value)==null?void 0:Z.keywords)||""},aiMetadata:{...v.aiMetadata,...((ee=l.ai_metadata)==null?void 0:ee.value)||{},languages:((se=(te=(ae=l.ai_metadata)==null?void 0:ae.value)==null?void 0:te.languages)==null?void 0:se.length)>0?l.ai_metadata.value.languages:(((ie=c.shopInfo)==null?void 0:ie.locales)||[]).filter(w=>w.published).map(w=>w.locale),supportedCurrencies:((re=(oe=(ne=l.ai_metadata)==null?void 0:ne.value)==null?void 0:oe.supportedCurrencies)==null?void 0:re.length)>0?l.ai_metadata.value.supportedCurrencies:((le=c.shopInfo)==null?void 0:le.currencies)||["EUR"],shippingRegions:((he=(de=(ce=l.ai_metadata)==null?void 0:ce.value)==null?void 0:de.shippingRegions)==null?void 0:he.length)>0?l.ai_metadata.value.shippingRegions:(((ue=c.shopInfo)==null?void 0:ue.markets)||[]).map(w=>w.name)},organizationSchema:{...v.organizationSchema,...((me=l.organization_schema)==null?void 0:me.value)||{},enabled:((ge=(pe=l.organization_schema)==null?void 0:pe.value)==null?void 0:ge.enabled)===!0,name:((fe=(Se=l.organization_schema)==null?void 0:Se.value)==null?void 0:fe.name)||((xe=c.shopInfo)==null?void 0:xe.name)||"",email:((Me=(ye=l.organization_schema)==null?void 0:ye.value)==null?void 0:Me.email)||((je=c.shopInfo)==null?void 0:je.email)||""},localBusinessSchema:((be=l.local_business_schema)==null?void 0:be.value)||v.localBusinessSchema}})}catch(y){console.error("[StoreMeta] Load error:",y),f(`Load failed: ${(y==null?void 0:y.message)||"Unknown error"}`)}finally{P(!1)}}function Pe(){i(t=>({...t,seo:{...t.seo,storeName:"",shortDescription:"",fullDescription:""}})),O(!1),f("Synced with Shopify store settings")}async function B(){E(!0);try{const t=`/api/store/apply?shop=${encodeURIComponent(h)}`;console.log("[StoreMeta] SAVE",t);const e=await D(t,{method:"POST",headers:{"X-Shop":h},body:{metadata:s,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:s.organizationSchema.enabled,updateLocalBusiness:s.localBusinessSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:t,ok:e==null?void 0:e.ok}),f("Metadata saved successfully!"),await _()}catch(t){console.error("[StoreMeta] SAVE error",(t==null?void 0:t.debug)||t,t),f(`Save failed: ${(t==null?void 0:t.message)||"Unknown error"}`)}finally{E(!1)}}async function Ee(){var t;$(!0);try{await B();const r=await D("/graphql",{method:"POST",headers:{"X-Shop":h},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            seoMetadata
            aiMetadata
            organizationSchema
            localBusinessSchema
          }
        }
      `,variables:{shop:h}}});if(r.error)throw new Error(r.error);const n=(t=r.data)==null?void 0:t.storeMetadata;if(n){const C=window.open("","_blank");console.log("[STORE-METADATA] Raw preview data:",n),console.log("[STORE-METADATA] seoMetadata raw:",n.seoMetadata),console.log("[STORE-METADATA] aiMetadata raw:",n.aiMetadata),console.log("[STORE-METADATA] organizationSchema raw:",n.organizationSchema);const g={shopName:n.shopName,description:n.description,seoMetadata:n.seoMetadata?(()=>{try{return JSON.parse(n.seoMetadata)}catch(S){return console.error("Error parsing seoMetadata:",S),n.seoMetadata}})():null,aiMetadata:n.aiMetadata?(()=>{try{return JSON.parse(n.aiMetadata)}catch(S){return console.error("Error parsing aiMetadata:",S),n.aiMetadata}})():null,organizationSchema:n.organizationSchema?(()=>{try{return JSON.parse(n.organizationSchema)}catch(S){return console.error("Error parsing organizationSchema:",S),n.organizationSchema}})():null,localBusinessSchema:n.localBusinessSchema?(()=>{try{return JSON.parse(n.localBusinessSchema)}catch(S){return console.error("Error parsing localBusinessSchema:",S),n.localBusinessSchema}})():null};C.document.write(`
          <html>
            <head>
              <title>Store Metadata Preview</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
                h1 { color: #333; }
                .section { margin: 20px 0; }
                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
              </style>
            </head>
            <body>
              <h1>Store Metadata Preview</h1>
              <div class="section">
                <h2>Basic Info</h2>
                <p><strong>Shop Name:</strong> ${g.shopName||"Not set"}</p>
                <p><strong>Description:</strong> ${g.description||"Not set"}</p>
              </div>
              
              <div class="section">
                <h2>SEO Metadata</h2>
                <pre>${JSON.stringify(g.seoMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>AI Metadata</h2>
                <pre>${JSON.stringify(g.aiMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Organization Schema</h2>
                <pre>${JSON.stringify(g.organizationSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Local Business Schema</h2>
                <pre>${JSON.stringify(g.localBusinessSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Raw Data</h2>
                <pre>${JSON.stringify(g,null,2)}</pre>
              </div>
            </body>
          </html>
        `),C.document.close()}else throw new Error("No preview data available")}catch(e){f(`Preview failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{$(!1)}}async function Re(){L(!0);try{i({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}}),await B(),f("Metadata cleared successfully!")}catch(t){f(`Clear failed: ${(t==null?void 0:t.message)||"Unknown error"}`)}finally{L(!1)}}return De&&!p?a.jsx(M,{children:a.jsx(d,{padding:"400",children:a.jsx(m,{children:"Loading store data..."})})}):(p==null?void 0:p.plan)==="Starter"?a.jsx(Ce,{status:"warning",children:a.jsx(m,{children:"Store metadata features are available starting from the Professional plan."})}):a.jsxs(j,{children:[a.jsx(j.Section,{children:a.jsx(M,{title:"Basic Store Information",children:a.jsxs(d,{padding:"400",children:[a.jsx(Ce,{tone:"info",children:a.jsxs(d,{children:[a.jsx(m,{variant:"bodyMd",fontWeight:"semibold",children:"From Shopify Settings:"}),a.jsxs(d,{paddingBlockStart:"200",children:[a.jsxs(m,{variant:"bodySm",tone:"subdued",children:["Store name: ",a.jsx(m,{as:"span",fontWeight:"medium",children:x.storeName||"Not set"})]}),a.jsx(m,{variant:"bodySm",tone:"subdued"}),a.jsxs(m,{variant:"bodySm",tone:"subdued",children:["Meta description: ",a.jsx(m,{as:"span",fontWeight:"medium",children:x.metaDescription?x.metaDescription.substring(0,100)+(x.metaDescription.length>100?"...":""):"Not set"})]})]}),Ae&&a.jsx(d,{paddingBlockStart:"300",children:a.jsx(T,{size:"slim",onClick:Pe,children:"Sync from Shopify"})})]})}),a.jsx(d,{paddingBlockStart:"400",children:a.jsxs(b,{children:[a.jsx(o,{label:"Store Name",value:s.seo.storeName,onChange:t=>i(e=>({...e,seo:{...e.seo,storeName:t}})),placeholder:x.storeName,helpText:"Leave empty to use Shopify store name",maxLength:100}),a.jsx(o,{label:"Short Store Description",value:s.seo.shortDescription,onChange:t=>i(e=>({...e,seo:{...e.seo,shortDescription:t}})),helpText:"Въведи кратко описание на магазина - макс 100 знака",maxLength:100}),a.jsx(o,{label:"Full Store Description",value:s.seo.fullDescription,onChange:t=>i(e=>({...e,seo:{...e.seo,fullDescription:t}})),placeholder:x.metaDescription,helpText:"Leave empty to use Shopify meta description",maxLength:300,multiline:3}),a.jsx(o,{label:"Keywords",value:s.seo.keywords,onChange:t=>i(e=>({...e,seo:{...e.seo,keywords:t}})),helpText:"Comma-separated keywords (optional)"})]})})]})})}),a.jsx(j.Section,{children:a.jsx(M,{title:"AI Metadata",children:a.jsx(d,{padding:"400",children:a.jsxs(b,{children:[a.jsxs(b.Group,{children:[a.jsx(o,{label:"Business Type",value:s.aiMetadata.businessType,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,businessType:t}})),placeholder:"e.g., Fashion Retailer, Electronics Store",helpText:"Max 3 words"}),a.jsx(o,{label:"Target Audience",value:s.aiMetadata.targetAudience,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,targetAudience:t}})),placeholder:"e.g., Young professionals, Parents"})]}),a.jsx(o,{label:"Unique Selling Points",value:s.aiMetadata.uniqueSellingPoints,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,uniqueSellingPoints:t}})),helpText:"Comma-separated list",multiline:2}),a.jsx(o,{label:"Brand Voice",value:s.aiMetadata.brandVoice,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,brandVoice:t}})),placeholder:"e.g., Professional, Friendly, Casual"}),a.jsx(o,{label:"Primary Categories",value:s.aiMetadata.primaryCategories,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,primaryCategories:t}})),helpText:"Main product categories, comma-separated"}),a.jsx(o,{label:"Shipping Information",value:s.aiMetadata.shippingInfo,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,shippingInfo:t}})),helpText:"Shipping costs, delivery times, free shipping thresholds (e.g., Free shipping over $50, 2-3 business days)",multiline:2}),a.jsx(o,{label:"Return Policy",value:s.aiMetadata.returnPolicy,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,returnPolicy:t}})),multiline:2}),a.jsx(Ie,{}),a.jsx(m,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),a.jsx(m,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),a.jsx(o,{label:"Supported Languages",value:((I=s.aiMetadata.languages)==null?void 0:I.join(", "))||"",onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,languages:t.split(",").map(r=>r.trim()).filter(r=>r)}})),helpText:"Comma-separated language codes (e.g., en, de, es, fr)",multiline:2}),a.jsx(o,{label:"Supported Currencies",value:((U=s.aiMetadata.supportedCurrencies)==null?void 0:U.join(", "))||"",onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,supportedCurrencies:t.split(",").map(r=>r.trim()).filter(r=>r)}})),helpText:"Comma-separated currency codes (e.g., EUR, USD, GBP)"}),a.jsx(o,{label:"Shipping Regions",value:((F=s.aiMetadata.shippingRegions)==null?void 0:F.join(", "))||"",onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,shippingRegions:t.split(",").map(r=>r.trim()).filter(r=>r)}})),helpText:"Comma-separated regions (e.g., EU, USA, UK, Canada)",multiline:2}),a.jsx(o,{label:"Cultural Considerations",value:s.aiMetadata.culturalConsiderations||"",onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,culturalConsiderations:t}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),((q=p==null?void 0:p.features)==null?void 0:q.organizationSchema)&&a.jsx(j.Section,{children:a.jsx(M,{title:"Organization Schema",children:a.jsxs(d,{padding:"400",children:[a.jsx(ve,{label:"Enable Organization Schema",checked:s.organizationSchema.enabled,onChange:t=>i(e=>({...e,organizationSchema:{...e.organizationSchema,enabled:t}}))}),s.organizationSchema.enabled&&a.jsx(d,{paddingBlockStart:"400",children:a.jsxs(b,{children:[a.jsxs(b.Group,{children:[a.jsx(o,{label:"Organization Name",value:s.organizationSchema.name,onChange:t=>i(e=>({...e,organizationSchema:{...e.organizationSchema,name:t}}))}),a.jsx(o,{label:"Contact Email",value:s.organizationSchema.email,onChange:t=>i(e=>({...e,organizationSchema:{...e.organizationSchema,email:t}})),type:"email"})]}),a.jsx(o,{label:"Phone",value:s.organizationSchema.phone,onChange:t=>i(e=>({...e,organizationSchema:{...e.organizationSchema,phone:t}})),type:"tel"}),a.jsx(o,{label:"Logo URL",value:s.organizationSchema.logo,onChange:t=>i(e=>({...e,organizationSchema:{...e.organizationSchema,logo:t}})),type:"url"}),a.jsx(o,{label:"Social Media Links",value:s.organizationSchema.sameAs,onChange:t=>i(e=>({...e,organizationSchema:{...e.organizationSchema,sameAs:t}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}),((J=p==null?void 0:p.features)==null?void 0:J.localBusinessSchema)&&a.jsx(j.Section,{children:a.jsx(M,{title:"Local Business Schema",children:a.jsxs(d,{padding:"400",children:[a.jsxs(we,{align:"start",gap:"200",children:[a.jsx(ve,{label:"Enable Local Business Schema",checked:s.localBusinessSchema.enabled,onChange:t=>i(e=>({...e,localBusinessSchema:{...e.localBusinessSchema,enabled:t}}))}),a.jsx(Ue,{content:"Optional - only enable if you have physical stores/locations",children:a.jsx(m,{variant:"bodyMd",color:"subdued",children:"ℹ️"})})]}),s.localBusinessSchema.enabled&&a.jsx(d,{paddingBlockStart:"400",children:a.jsxs(b,{children:[a.jsx(o,{label:"Price Range",value:s.localBusinessSchema.priceRange,onChange:t=>i(e=>({...e,localBusinessSchema:{...e.localBusinessSchema,priceRange:t}})),helpText:"e.g., $, $$, $$$, $$$$"}),a.jsx(o,{label:"Opening Hours",value:s.localBusinessSchema.openingHours,onChange:t=>i(e=>({...e,localBusinessSchema:{...e.localBusinessSchema,openingHours:t}})),helpText:"e.g., Mo-Fr 09:00-18:00, Sa 10:00-16:00",multiline:2})]})})]})})}),a.jsx(j.Section,{children:a.jsx(M,{children:a.jsx(d,{padding:"400",children:a.jsxs(we,{gap:"300",children:[a.jsx(T,{onClick:B,loading:Te,primary:!0,children:"Save Metadata"}),a.jsx(T,{onClick:Ee,loading:Be,children:"Preview Metadata"}),a.jsx(T,{onClick:Re,loading:ke,destructive:!0,children:"Clear Metadata"})]})})})}),R&&a.jsx(Fe,{content:R,onDismiss:()=>f("")})]})}export{We as default};
