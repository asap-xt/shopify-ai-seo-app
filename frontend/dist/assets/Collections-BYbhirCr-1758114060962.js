import{j as e}from"./app-bridge-DLGMIr5Y-1758114060962.js";import{r as s}from"./react-vendor-tAaa2TlE-1758114060962.js";import{m as lt}from"./index-bDwthlbJ-1758114060962.js";import{U as ot}from"./UpgradeModal-BRcfIsqS-1758114060962.js";import{M as p,d as M,T as r,e as xe,a as h,I as w,f as je,B as O,D as at,g as Y,C as ye,h as it,S as rt,P as ct,i as dt,R as ht,j as ut,l as gt,E as pt}from"./polaris-BEx6doc_-1758114060962.js";const ft=(_,c="")=>{try{return new URLSearchParams(window.location.search).get(_)||c}catch{return c}};function Pt({shop:_}){const c=_||ft("shop",""),x=s.useMemo(()=>lt(),[]),[m,be]=s.useState([]),[we,le]=s.useState(!1),[R,Ce]=s.useState(0),[S,$]=s.useState([]),[j,K]=s.useState(!1),[mt,ve]=s.useState(""),[I,X]=s.useState(""),[y,F]=s.useState("all"),[oe,Z]=s.useState(!1),[Ae,ke]=s.useState(""),[St,Ee]=s.useState([]),[A,H]=s.useState([]),[k,ae]=s.useState([]),[ee,P]=s.useState(!1),[E,C]=s.useState({current:0,total:0,percent:0}),[ie,L]=s.useState(""),[W,re]=s.useState([]),[xt,jt]=s.useState(!1),[yt,bt]=s.useState(null),[wt,Ct]=s.useState(!1),[vt,Me]=s.useState(""),[Oe,G]=s.useState(!1),[z,T]=s.useState([]),[ce,de]=s.useState(!1),[Ie,U]=s.useState(!1),[De,J]=s.useState(!1),[he,V]=s.useState([]),[D,q]=s.useState({}),[Pe,Q]=s.useState(!1),[Le,te]=s.useState(!1),[ue,At]=s.useState({}),[ze,se]=s.useState(!1),[ge,ne]=s.useState(null),[Te,pe]=s.useState(!1),[fe,f]=s.useState(""),[Be,N]=s.useState(!1),[Re,me]=s.useState(!1),[$e,We]=s.useState("starter"),[Ue,kt]=s.useState({processing:!1,current:0,total:0,currentItem:"",results:null});s.useEffect(()=>{c&&x("/plans/me",{shop:c}).then(t=>{const l=(t==null?void 0:t.modelsSuggested)||["google/gemini-1.5-flash"];Ee(l.map(n=>({label:n,value:n}))),ke(l[0])}).catch(t=>f(`Error loading models: ${t.message}`))},[c,x]),s.useEffect(()=>{c&&x(`/api/languages/shop/${c}`).then(t=>{const l=(t==null?void 0:t.shopLanguages)||["en"];ae(l),H([])}).catch(()=>{ae(["en"]),H([])})},[c,x]);const B=s.useCallback(async()=>{le(!0);try{const t=new URLSearchParams({shop:c,...I&&{search:I},...y!=="all"&&{optimized:y}});let n=(await x(`/collections/list?${t}`)).collections||[];if(I){const a=I.toLowerCase();n=n.filter(d=>d.title.toLowerCase().includes(a)||d.handle.toLowerCase().includes(a))}y!=="all"&&(n=n.filter(a=>y==="true"?a.hasSeoData:!a.hasSeoData)),be(n),Ce(n.length)}catch(t){f(`Error loading collections: ${t.message}`)}finally{le(!1)}},[c,I,y,x]);s.useEffect(()=>{c&&(B(),U(!1))},[c,y]),s.useEffect(()=>{const t=setTimeout(()=>{c&&B()},500);return()=>clearTimeout(t)},[I]);const Ne=s.useCallback(t=>{$(t);const l=t.some(n=>{const a=m.find(d=>d.id===n);return a==null?void 0:a.hasSeoData});U(l),t.length===0&&K(!1)},[m]),Fe=s.useCallback(t=>{if(K(t),t){$(m.map(n=>n.id));const l=m.some(n=>n.hasSeoData);U(l)}else $([]),U(!1)},[m]),He=async t=>{pe(!0);try{const l=`/collections/${t.split("/").pop()}/seo-data?shop=${encodeURIComponent(c)}`,n=await x(l);ne(n),se(!0)}catch(l){f((l==null?void 0:l.status)===404?"No SEO data found for this collection":"Failed to load SEO data")}finally{pe(!1)}},Ge=()=>{if(S.length===0&&!j){f("Please select collections first");return}te(!0)},Je=async()=>{try{P(!0),ve("Checking eligibility...");const t=await x("/ai-enhance/check-eligibility",{method:"POST",shop:c,body:{shop:c}});if(!t.eligible){We(t.currentPlan||"starter"),N(!1),me(!0);return}N(!1);const l=m.filter(o=>{var i;return S.includes(o.id)&&((i=o.optimizedLanguages)==null?void 0:i.length)>0}),n=l.length;C({current:0,total:n,percent:0});const a={};for(let o=0;o<l.length;o++){const i=l[o];L(i.title);try{const b=i.optimizedLanguages||[];if(b.length===0){console.log(`No optimized languages for ${i.title}, skipping`),a[i.id]={success:!1,skipped:!0,error:"No optimized languages"};continue}console.log(`Enhancing ${i.title} for languages:`,b);const g=await x(`/ai-enhance/collection/${encodeURIComponent(i.id)}`,{method:"POST",shop:c,body:{shop:c,languages:b}});a[i.id]={success:g.ok,skipped:!1,data:g,error:g.ok?null:g.error||"Enhancement failed"}}catch(b){console.error("Error enhancing collection:",i.id,b),a[i.id]={success:!1,skipped:!1,error:b.message}}const u=o+1,v=Math.round(u/n*100);C({current:u,total:n,percent:v})}q(a),Q(!0);const d=Object.values(a).filter(o=>o.success).length;f(`Enhanced ${d} collections`),await B()}catch(t){console.error("AI Enhance error:",t),f("Failed to enhance collections")}finally{P(!1),L("")}},Ve=async()=>{if(!A.length){f("Please select at least one language");return}te(!1),P(!0),C({current:0,total:0,percent:0}),re([]),q({});try{const t=j?m:m.filter(d=>S.includes(d.id)),l=t.length;C({current:0,total:l,percent:0});const n={};for(let d=0;d<t.length;d++){const o=t[d];L(o.title);try{const v=await x("/seo/generate-collection-multi",{method:"POST",shop:c,body:{shop:c,collectionId:o.id,model:Ae,languages:A}});n[o.id]={success:!0,data:v}}catch(v){n[o.id]={success:!1,error:v.message},re(b=>[...b,{collection:o.title,error:v.message}])}const i=d+1,u=Math.round(i/l*100);C({current:i,total:l,percent:u})}q(n),Q(!0);const a=Object.values(n).filter(d=>d.success).length;f(`Generated optimization for ${a} collections`)}catch(t){f(`Error: ${t.message}`)}finally{P(!1),L("")}},qe=async()=>{var t,l;P(!0),C({current:0,total:0,percent:0});try{const n=Object.entries(D).filter(([d,o])=>o.success),a=n.length;C({current:0,total:a,percent:0});for(let d=0;d<n.length;d++){const[o,i]=n[d],u=m.find(g=>g.id===o);if(!u)continue;L(u.title);try{if(console.log("Applying SEO for collection:",o),console.log("Result data:",i.data),console.log("Results array:",(t=i.data)==null?void 0:t.results),!((l=i.data)!=null&&l.results)||!Array.isArray(i.data.results))throw new Error("Invalid results structure");const g=await x("/seo/apply-collection-multi",{method:"POST",shop:c,body:{shop:c,collectionId:o,results:i.data.results.map(Se=>({language:Se.language,seo:Se.data})),options:{updateTitle:!0,updateDescription:!0,updateSeo:!0,updateMetafields:!0}}});if(!(g!=null&&g.ok))throw new Error((g==null?void 0:g.error)||"Apply failed")}catch(g){console.error("Apply error for collection:",o,g),W.push({id:u.id,title:u.title,message:g.message})}const v=d+1,b=Math.round(v/a*100);C({current:v,total:a,percent:b})}f("Optimization applied successfully!"),Q(!1),q({}),$([]),await B()}catch(n){f(`Error applying optimization: ${n.message}`)}finally{P(!1),L("")}},Qe=async(t=[])=>{de(!0),Me("");try{const l=j?m:m.filter(o=>S.includes(o.id)),n=l.length*t.length;let a=0;const d=[];for(const o of l)for(const i of t)try{await x("/collections/delete-seo",{method:"DELETE",shop:c,body:{shop:c,collectionId:o.id,language:i}})}catch(u){console.error(`Failed to delete ${i} for ${o.title}:`,u),d.push({id:o.id,title:o.title,message:u.message})}finally{a++,C({current:a,total:n,percent:Math.round(a/n*100)})}f(`Deleted optimization for ${t.join(", ").toUpperCase()}`),setTimeout(async()=>{await B(),$([]),K(!1),U(!1)},100)}catch(l){f(`Delete error: ${l.message}`)}finally{de(!1),V([]),T([])}},Ye=t=>{var o,i;const l=((o=D[t.id])==null?void 0:o.success)||ue[t.id],n=((i=D[t.id])==null?void 0:i.data)||ue[t.id],a=t.optimizedLanguages||[],d=e.jsx(h,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(gt,{id:t.id,url:"",media:d,accessibilityLabel:`View details for ${t.title}`,children:e.jsxs(w,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(h,{style:{flex:"1 1 30%",minWidth:"200px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:t.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Handle: ",t.handle]})]}),e.jsx(h,{style:{flex:"0 0 15%",minWidth:"100px",textAlign:"center"},children:e.jsxs(r,{variant:"bodyMd",children:[t.productsCount," products"]})}),e.jsx(h,{style:{flex:"0 0 25%",minWidth:"160px"},children:t.hasSeoData?e.jsx(w,{gap:"100",children:k.map(u=>e.jsx(Y,{tone:a.includes(u)?"success":"subdued",size:"small",children:u.toUpperCase()},u))}):e.jsx(Y,{tone:"subdued",children:"No AI Search Optimisation"})}),e.jsxs(h,{style:{flex:"0 0 15%",minWidth:"120px"},children:[l&&e.jsx(O,{size:"slim",onClick:()=>{ne(n),se(!0)},children:"Preview JSON"}),!l&&t.hasSeoData&&e.jsx(O,{size:"slim",loading:Te,onClick:()=>He(t.id),children:"Preview JSON"})]})]})})},_e=ee&&!Ue.processing&&e.jsx(p,{open:ee,title:"Processing Collections",onClose:()=>{},noScroll:!0,children:e.jsx(p.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:ie?`Processing: ${ie}`:"Preparing..."}),e.jsx(xe,{progress:E.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[E.current," of ",E.total," collections (",E.percent,"%)"]})]})})}),Ke=e.jsx(p,{open:Le,title:"Select Languages",primaryAction:{content:"Generate Optimization for AI Search",onAction:Ve,disabled:A.length===0},secondaryActions:[{content:"Cancel",onAction:()=>te(!1)}],children:e.jsx(p.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",j?"all":S.length," selected collections:"]}),e.jsx(h,{paddingBlockStart:"200",children:e.jsx(w,{gap:"200",wrap:!0,children:k.map(t=>e.jsx(je,{label:t.toUpperCase(),checked:A.includes(t),onChange:l=>{H(l?[...A,t]:A.filter(n=>n!==t))}},t))})}),e.jsx(h,{paddingBlockStart:"200",children:e.jsx(O,{plain:!0,onClick:()=>{H(A.length===k.length?[]:[...k])},children:A.length===k.length?"Deselect all":"Select all"})})]})})}),Xe=e.jsx(p,{open:Pe&&!ee,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:qe,disabled:!Object.values(D).some(t=>t.success)},secondaryActions:[{content:"Cancel",onAction:()=>Q(!1)}],children:e.jsx(p.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(w,{gap:"400",children:[e.jsxs(h,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(D).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(h,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(D).filter(t=>t.skipped).length})]}),e.jsxs(h,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(D).filter(t=>!t.success&&!t.skipped).length})]})]}),W.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(at,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(h,{maxHeight:"200px",overflowY:"scroll",children:[W.slice(0,10).map((t,l)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.collection,": ",t.error]},l)),W.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",W.length-10," more errors"]})]})]})]})})}),Ze=e.jsx(p,{open:ze,title:"SEO Data Preview",secondaryActions:[{content:"Close",onAction:()=>{se(!1),ne(null)}}],children:e.jsx(p.Section,{children:e.jsx(h,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",backgroundColor:"#f6f6f7",padding:"12px",borderRadius:"4px",maxHeight:"400px",overflow:"auto"},children:ge?JSON.stringify(ge,null,2):""})})})}),et=e.jsx(p,{open:Oe,title:"Delete Optimization for AI Search",onClose:()=>{G(!1),T([])},primaryAction:{content:"Continue",onAction:()=>{V(z),G(!1),J(!0)},disabled:z.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{G(!1),T([])}}],children:e.jsx(p.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",j?R:S.length," selected collections:"]}),e.jsx(h,{paddingBlockStart:"200",children:e.jsx(w,{gap:"400",wrap:!1,children:k.map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[e.jsx("input",{type:"checkbox",checked:z.includes(t),onChange:l=>{T(l.target.checked?[...z,t]:z.filter(n=>n!==t))},style:{marginRight:"8px",width:"18px",height:"18px",cursor:"pointer"}}),e.jsx(r,{variant:"bodyMd",children:t.toUpperCase()})]},t))})}),e.jsx(h,{children:e.jsx(O,{plain:!0,onClick:()=>{T(z.length===k.length?[]:[...k])},children:"Select all"})}),e.jsx(h,{paddingBlockStart:"300",children:e.jsx(r,{variant:"bodySm",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})})]})})}),tt=e.jsx(p,{open:De,title:"Confirm Deletion",onClose:()=>{J(!1),V([])},primaryAction:{content:"Delete",destructive:!0,onAction:async()=>{J(!1),setTimeout(()=>{Qe(he)},100)}},secondaryActions:[{content:"Cancel",onAction:()=>{J(!1),V([]),T([])}}],children:e.jsx(p.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(h,{paddingBlockStart:"200",children:e.jsx(w,{gap:"200",children:he.map(t=>e.jsx(Y,{tone:"warning",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",j?R:S.length," selected collections."]}),e.jsx(h,{paddingBlockStart:"200",children:e.jsx(r,{variant:"bodySm",tone:"critical",children:"This action cannot be undone."})})]})})}),st=ce&&e.jsx(p,{open:ce,title:"Deleting SEO Data",onClose:()=>{},noScroll:!0,children:e.jsx(p.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:"Deleting selected languages..."}),e.jsx(xe,{progress:E.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[E.current," of ",E.total," operations (",E.percent,"%)"]})]})})}),nt=e.jsx(pt,{heading:"No collections found",action:{content:"Clear filters",onAction:()=>{X(""),F("all"),B()}},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms"})});return e.jsxs(e.Fragment,{children:[e.jsx(ye,{children:e.jsxs(h,{padding:"400",children:[e.jsxs(w,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(h,{minWidth:"400px",maxWidth:"600px",children:e.jsx(it,{label:"",placeholder:"Search by collection name...",value:I,onChange:X,prefix:e.jsx(rt,{}),clearButton:!0,onClearButtonClick:()=>X("")})}),e.jsxs(M,{gap:"200",children:[e.jsx(O,{primary:!0,onClick:Ge,disabled:S.length===0&&!j,children:"Generate Optimization for AI Search"}),S.length===0&&!j||!m.filter(n=>S.includes(n.id)).some(n=>{var a;return((a=n.optimizedLanguages)==null?void 0:a.length)>0})?null:e.jsx(O,{onClick:()=>N(!0),disabled:S.length===0&&!j,children:"AI Enhanced add-ons for AI Search"}),e.jsx(O,{outline:!0,destructive:!0,onClick:()=>G(!0),disabled:S.length===0||!Ie,children:"Delete Optimization for AI Search"})]})]}),R>0&&e.jsx(h,{paddingBlockStart:"300",children:e.jsx(je,{label:`Select all ${R} collections`,checked:j,onChange:Fe})})]})}),e.jsx(h,{paddingBlockStart:"400",children:e.jsxs(ye,{children:[e.jsxs(h,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsx(w,{gap:"200",wrap:!0,children:e.jsx(ct,{active:oe,activator:e.jsx(O,{disclosure:"down",onClick:()=>Z(!oe),removeUnderline:!0,children:e.jsxs(w,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),y!=="all"&&e.jsx(h,{onClick:t=>{t.stopPropagation(),F("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Z(!1),children:e.jsx(h,{padding:"300",minWidth:"200px",children:e.jsx(dt,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All collections",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[y],onChange:t=>{F(t[0]),Z(!1)}})})})}),y!=="all"&&e.jsx(h,{paddingBlockStart:"200",children:e.jsx(w,{gap:"100",wrap:!0,children:e.jsx(Y,{onRemove:()=>F("all"),children:y==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"})})})]}),e.jsx(ht,{resourceName:{singular:"collection",plural:"collections"},items:m,renderItem:Ye,selectedItems:S,onSelectionChange:Ne,selectable:!0,loading:we,totalItemsCount:R,emptyState:nt,showHeader:!1})]})}),_e,Ke,Xe,Ze,et,tt,st,e.jsx(p,{open:Be,onClose:()=>N(!1),title:"AI Enhanced add-ons for AI Search",primaryAction:{content:"Start AI Enhancement",onAction:Je},secondaryActions:[{content:"Cancel",onAction:()=>N(!1)}],children:e.jsx(p.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["AI enhancement will improve bullets and FAQ for ",selectedWithSEO.length," collections."]}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI enhancement is only available for Growth Extra and Enterprise plans."})]})})}),e.jsx(ot,{open:Re,onClose:()=>me(!1),featureName:"AI Enhancement",currentPlan:$e}),fe&&e.jsx(ut,{content:fe,onDismiss:()=>f("")})]})}export{Pt as default};
