import{j as e}from"./app-bridge-ByQiO0Zz-1760709914444.js";import{r as j}from"./react-vendor-tAaa2TlE-1760709914444.js";import{m as Q}from"./sessionFetch-CJepNHo3-1760709914444.js";import{L as d,C as p,a as R,T as i,I as r,d as l,e as s,f as G,B as x,D as W,g as H}from"./polaris-CCG9_6jC-1760709914444.js";const h=(u,a="")=>{try{return new URLSearchParams(window.location.search).get(u)||a}catch{return a}};function Z({shop:u}){var M,C,$,A,z,D,L,B,T,O,P,E,I;const a=u||h("shop",""),c=o=>{window.location.href=o},v=j.useMemo(()=>Q(),[]),[N,w]=j.useState(!0),[n,F]=j.useState(null),[t,U]=j.useState(null),[S,V]=j.useState(null);j.useEffect(()=>{a&&q()},[a]);const q=async()=>{try{w(!0);const o=await v(`/api/billing/info?shop=${a}`,{method:"GET",headers:{"Content-Type":"application/json"}});U(o.subscription),V(o.tokens);const b=await v(`/api/dashboard/stats?shop=${a}`,{method:"GET",headers:{"Content-Type":"application/json"}});F(b)}catch(o){console.error("[Dashboard] Error loading data:",o)}finally{w(!1)}},g=((M=n==null?void 0:n.products)==null?void 0:M.total)>0?Math.round(n.products.optimized/n.products.total*100):0,m=((C=n==null?void 0:n.collections)==null?void 0:C.total)>0?Math.round(n.collections.optimized/n.collections.total*100):0,f=["growth","growth extra","enterprise"].includes(t==null?void 0:t.plan),y=["professional","growth","growth extra","enterprise"].includes(t==null?void 0:t.plan),k=(t==null?void 0:t.plan)==="enterprise";return N?e.jsx(d,{children:e.jsx(d.Section,{children:e.jsx(p,{children:e.jsx(R,{padding:"400",children:e.jsx(i,{children:"Loading dashboard..."})})})})}):e.jsxs(d,{children:[e.jsx(d.Section,{children:e.jsxs(r,{gap:"400",wrap:!1,children:[e.jsx("div",{style:{flex:1},children:e.jsx(p,{children:e.jsxs(l,{gap:"400",children:[e.jsxs(r,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",children:"Products"}),e.jsxs(s,{tone:g===100?"success":"attention",children:[(($=n==null?void 0:n.products)==null?void 0:$.optimized)||0," / ",((A=n==null?void 0:n.products)==null?void 0:A.total)||0]})]}),e.jsx(G,{progress:g,tone:g===100?"success":"primary"}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[g,"% optimized for AI Search"]}),((z=n==null?void 0:n.products)==null?void 0:z.lastOptimized)&&e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["Last: ",new Date(n.products.lastOptimized).toLocaleDateString()]})]})})}),f&&e.jsx("div",{style:{flex:1},children:e.jsx(p,{children:e.jsxs(l,{gap:"400",children:[e.jsxs(r,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",children:"Collections"}),e.jsxs(s,{tone:m===100?"success":"attention",children:[((D=n==null?void 0:n.collections)==null?void 0:D.optimized)||0," / ",((L=n==null?void 0:n.collections)==null?void 0:L.total)||0]})]}),e.jsx(G,{progress:m,tone:m===100?"success":"primary"}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[m,"% optimized for AI Search"]}),((B=n==null?void 0:n.collections)==null?void 0:B.lastOptimized)&&e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["Last: ",new Date(n.collections.lastOptimized).toLocaleDateString()]})]})})}),e.jsx("div",{style:{flex:1},children:e.jsx(p,{children:e.jsxs(l,{gap:"400",children:[e.jsx(i,{variant:"headingMd",children:"Token Balance"}),e.jsxs(R,{children:[e.jsx(i,{variant:"heading2xl",alignment:"center",children:((T=S==null?void 0:S.balance)==null?void 0:T.toLocaleString())||0}),e.jsx(i,{variant:"bodySm",tone:"subdued",alignment:"center",children:"tokens available"}),((t==null?void 0:t.plan)==="growth extra"||(t==null?void 0:t.plan)==="enterprise")&&e.jsxs(i,{variant:"bodySm",tone:"subdued",alignment:"center",children:["(",(t==null?void 0:t.plan)==="growth extra"?"100M":"300M"," included)"]})]}),e.jsx(x,{variant:"primary",fullWidth:!0,onClick:()=>c(`/billing?shop=${a}&host=${h("host")}&embedded=1`),children:"Manage Tokens"})]})})})]})}),e.jsx(d.Section,{children:e.jsx(p,{children:e.jsxs(l,{gap:"400",children:[e.jsx(i,{variant:"headingMd",children:"Quick Actions"}),e.jsxs(r,{gap:"300",wrap:!0,children:[e.jsx(x,{onClick:()=>c(`/products?shop=${a}&host=${h("host")}&embedded=1`),children:"Optimize Products"}),f&&e.jsx(x,{onClick:()=>c(`/collections?shop=${a}&host=${h("host")}&embedded=1`),children:"Optimize Collections"}),y&&e.jsx(x,{onClick:()=>c(`/store-metadata?shop=${a}&host=${h("host")}&embedded=1`),children:"Edit Store Metadata"}),e.jsx(x,{onClick:()=>c(`/sitemap?shop=${a}&host=${h("host")}&embedded=1`),children:"View Sitemap"}),k&&e.jsx(x,{onClick:()=>c(`/schema?shop=${a}&host=${h("host")}&embedded=1`),children:"Advanced Schema"})]})]})})}),e.jsx(d.Section,{children:e.jsx(p,{children:e.jsxs(l,{gap:"400",children:[e.jsx(i,{variant:"headingMd",children:"AI Features Status"}),e.jsx(W,{}),e.jsxs(l,{gap:"300",children:[y&&e.jsxs(r,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"bodyMd",children:"Store Metadata"}),(O=n==null?void 0:n.storeMetadata)!=null&&O.complete?e.jsx(s,{tone:"success",children:"✓ Complete"}):e.jsx(s,{tone:"warning",children:"Incomplete"})]}),e.jsxs(r,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"bodyMd",children:"Sitemap"}),(P=n==null?void 0:n.sitemap)!=null&&P.generated?e.jsx(s,{tone:"success",children:"✓ Generated"}):e.jsx(s,{tone:"attention",children:"Not yet"})]}),k&&e.jsxs(r,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"bodyMd",children:"Advanced Schema"}),(E=n==null?void 0:n.advancedSchema)!=null&&E.active?e.jsx(s,{tone:"success",children:"✓ Active"}):e.jsx(s,{tone:"attention",children:"Not set up"})]})]})]})})}),(n==null?void 0:n.alerts)&&n.alerts.length>0&&e.jsx(d.Section,{children:e.jsx(l,{gap:"300",children:n.alerts.map((o,b)=>e.jsx(H,{tone:o.type==="warning"?"warning":"info",title:o.title,action:o.action?{content:o.action.label,onAction:()=>c(o.action.url)}:void 0,children:o.message&&e.jsx("p",{children:o.message})},b))})}),e.jsx(d.Section,{children:e.jsx(p,{children:e.jsxs(l,{gap:"300",children:[e.jsxs(r,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",children:"Current Plan"}),e.jsx(s,{tone:"info",children:((I=t==null?void 0:t.plan)==null?void 0:I.toUpperCase())||"N/A"})]}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["$",(t==null?void 0:t.price)||0,"/month"]}),e.jsx(x,{onClick:()=>c(`/billing?shop=${a}&host=${h("host")}&embedded=1`),children:"View Plans & Billing"})]})})})]})}export{Z as default};
