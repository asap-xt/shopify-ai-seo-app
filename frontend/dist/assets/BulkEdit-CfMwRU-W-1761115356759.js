import{j as e}from"./app-bridge-BoFjznba-1761115356759.js";import{r as o}from"./react-vendor-tAaa2TlE-1761115356759.js";import{u as Vt,S as Qt,U as Jt,I as Xt}from"./StoreMetadataBanner-DVoWCKi5-1761115356759.js";import{M as z,e as D,T as c,f as ut,d as qe,B as T,a as g,I as w,h as Ie,D as Zt,g as ee,C as pt,j as es,S as ts,P as Le,k as Oe,R as ss,l as ns,m as ht,n as rs,E as os}from"./polaris-DlrYEGTt-1761115356759.js";import"./index-C6Yjvh21-1761115356759.js";const as=(f,j="")=>{try{return new URLSearchParams(window.location.search).get(f)||j}catch{return j}},fe=f=>{if(!f)return f;const j=String(f).trim();return j.startsWith("gid://")?j:`gid://shopify/Product/${j}`},is=f=>{if(!f)return"";const j=String(f).match(/\/(\d+)$/);return j?j[1]:f},R=f=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(f==null?void 0:f.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(f==null?void 0:f.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}},ve=f=>new URLSearchParams(window.location.search).get("debug_limits")==="true"?f<=5?"Starter":f<=10?"Growth":f<=12?"Professional":f<=15?"Growth Extra":"Enterprise":f<=100?"Starter":f<=350?"Professional":f<=1e3?"Growth":f<=2500?"Growth Extra":"Enterprise";function gs({shop:f,globalPlan:j}){var lt,ct,dt;const{api:A,shop:gt}=Vt(),u=f||gt||as("shop","");o.useEffect(()=>{},[u,A]);const[x,Q]=o.useState([]),[ae,Se]=o.useState(!1),[mt,Fe]=o.useState(1),[ft,ze]=o.useState(!0),[U,Ke]=o.useState(0),[d,te]=o.useState([]),[y,ie]=o.useState(!1),[J,Ye]=o.useState(""),[B,xe]=o.useState("all"),[$,le]=o.useState(""),[je,ls]=o.useState("createdAt"),[se,St]=o.useState("desc"),[W,ye]=o.useState([]),[xt,jt]=o.useState([]),[_e,Me]=o.useState(!1),[Ve,Te]=o.useState(!1),[Qe,Re]=o.useState(!1),[Je,ke]=o.useState(!1),[yt,Pt]=o.useState(""),[bt,Et]=o.useState([]),[N,ne]=o.useState([]),[M,Xe]=o.useState([]),[De,X]=o.useState(!1),[Pe,H]=o.useState({current:0,total:0,percent:0}),[Ze,re]=o.useState(""),[be,ce]=o.useState([]),[de,et]=o.useState({}),[wt,Ue]=o.useState(!1),[At,ue]=o.useState(!1),[Ct,pe]=o.useState(!1),[q,he]=o.useState([]),[It,Ee]=o.useState(!1),[tt,C]=o.useState(""),[st,nt]=o.useState(!1),[I,Z]=o.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[P,Lt]=o.useState(null),[K,$e]=o.useState(1),[Ot,we]=o.useState(!1),[Ae,vt]=o.useState(localStorage.getItem("hasVisitedProducts")==="true"),[Ne,Y]=o.useState(!1),[zt,rt]=o.useState(!1),[b,F]=o.useState(null),[_,ge]=o.useState("starter");o.useEffect(()=>{if(!(!j||typeof j!="object")){if(j.planKey&&j.planKey!==""){ge(j.planKey);const s={starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[j.planKey.toLowerCase()]||1;$e(s)}else if(j.plan&&j.plan!==""){const t=j.plan.toLowerCase().replace(/\s+/g,"-");ge(t);const n={starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[t]||1;$e(n)}}},[j]),o.useEffect(()=>{if(Ne&&P){const t=R(P);(y?U:d.length)<=t&&(Y(!1),F(null))}},[d.length,y,U,Ne,P]),o.useEffect(()=>{if(!u)return;A("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
        }
      }
    `,variables:{shop:u}})}).then(s=>{var i,l,r;if((i=s==null?void 0:s.errors)!=null&&i.length)throw new Error(((l=s.errors[0])==null?void 0:l.message)||"GraphQL error");const n=(r=s==null?void 0:s.data)==null?void 0:r.plansMe,a=(n==null?void 0:n.modelsSuggested)||["anthropic/claude-3.5-sonnet"];Et(a.map(S=>({label:S,value:S}))),Pt(a[0]),Lt((n==null?void 0:n.plan)||"starter"),ge((n==null?void 0:n.planKey)||"starter");const m=((n==null?void 0:n.planKey)||"starter").toLowerCase();$e({starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[m]||1)}).catch(s=>console.error("[BULK-EDIT] GraphQL plansMe failed:",s))},[u,A]),o.useEffect(()=>{if(!u)return;const t=new Promise((s,n)=>{setTimeout(()=>n(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([A(`/api/languages/shop/${u}`),t]).then(s=>{const n=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];Xe(n.includes("en")?n:["en",...n])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),Xe(["en"])})},[u,A]),o.useEffect(()=>{u&&A("/api/products/tags/list",{shop:u}).then(t=>jt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[u,A]);const V=o.useCallback(async(t=1,s=!1,n=null)=>{var a,m,h,i,l;Se(!0);try{const r=new URLSearchParams({shop:u,page:t,limit:50,...B!=="all"&&{optimized:B},...J&&{search:J},...$&&{languageFilter:$},...W.length>0&&{tags:W.join(",")},sortBy:je,sortOrder:se,...n&&{_t:n}}),S=await A(`/api/products/list?${r}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((a=S.products)==null?void 0:a.length)>0,console.log("[LOAD-PRODUCTS] ===== PRODUCTS LOADED ====="),console.log("[LOAD-PRODUCTS] Total products:",(m=S.products)==null?void 0:m.length),((h=S.products)==null?void 0:h.length)>0&&S.products.forEach((E,L)=>{var p,k;console.log(`[LOAD-PRODUCTS] Product ${L}: ID=${E.id} (type: ${typeof E.id}), _id=${E._id}, title="${E.title}", has SEO: ${!!((k=(p=E.optimizationSummary)==null?void 0:p.optimizedLanguages)!=null&&k.length)}`)}),Q(s?E=>[...E,...S.products]:S.products||[]),Fe(t),ze(((i=S.pagination)==null?void 0:i.hasNext)||!1),Ke(((l=S.pagination)==null?void 0:l.total)||0)}catch(r){Q(s?x:[]),ze(!1),C(`Error loading products: ${r.message}`)}finally{Se(!1)}},[u,B,J,$,W,je,se]);o.useEffect(()=>{u&&V(1,!1,null)},[u,V,B,$,W,je,se]),o.useEffect(()=>{!Ae&&u&&(localStorage.setItem("hasVisitedProducts","true"),vt(!0))},[Ae,u]),o.useEffect(()=>{x.length===0&&!ae&&u&&!Ae&&we(!0)},[x.length,ae,u,Ae]),o.useEffect(()=>{console.log("[DEBUG-MONITOR] ===== STATE CHANGED ====="),console.log("[DEBUG-MONITOR] Products count:",x.length),console.log("[DEBUG-MONITOR] Selected items count:",d.length),console.log("[DEBUG-MONITOR] Products:",x.map(t=>({id:t.id,title:t.title}))),console.log("[DEBUG-MONITOR] Selected items:",d)},[x,d]);const ot=o.useCallback(t=>{Ye(t)},[]);o.useEffect(()=>{const t=setTimeout(()=>{u&&V(1,!1,null)},500);return()=>clearTimeout(t)},[J]);const Mt=o.useCallback(t=>{console.log("[SELECTION-CHANGE] ===== SELECTION CHANGED ====="),console.log("[SELECTION-CHANGE] New selected items:",t),console.log("[SELECTION-CHANGE] Item count:",t.length),console.log("[SELECTION-CHANGE] Item types:",t.map(s=>typeof s)),console.log("[SELECTION-CHANGE] Current products count:",x.length),console.log("[SELECTION-CHANGE] Current products IDs:",x.map(s=>s.id)),te(t),t.length===0&&ie(!1)},[x]),at=o.useCallback(t=>{ie(t),te(t?x.map(s=>s.id):[])},[x]),it=o.useMemo(()=>{var s;if(y)return N.length>K;const t=x.filter(n=>d.includes(n.id));if(t.length===0)return N.length>K;for(const n of t){const a=((s=n.optimizationSummary)==null?void 0:s.optimizedLanguages)||[],m=N.filter(i=>!a.includes(i));if(a.length+m.length>K)return!0}return!1},[x,d,y,K,N]),Tt=()=>{if(d.length===0&&!y){C("Please select products first");return}ue(!0)},Rt=()=>{if(d.length===0&&!y){C("Please select products first");return}he([]),pe(!0)},kt=async()=>{const t=x.filter(i=>d.includes(i.id)),s=t.filter(i=>{var l,r;return((r=(l=i.optimizationSummary)==null?void 0:l.optimizedLanguages)==null?void 0:r.length)>0}),n=t.filter(i=>{var l,r;return!((r=(l=i.optimizationSummary)==null?void 0:l.optimizedLanguages)!=null&&r.length)}),a=R(P),m=s.length;if(m>a){const i=ve(m);F({error:"Product limit exceeded",message:`Your ${P} plan supports up to ${a} products for AI Enhancement. You have selected ${m} products with Basic SEO.`,minimumPlanRequired:i,currentPlan:P,features:[`Optimize up to ${R(i)} products`,"All features from your current plan",i==="Growth Extra"||i==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",i==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),Y(!0);return}nt(!0),Z({processing:!0,current:0,total:s.length,currentItem:"",results:null});const h={successful:0,failed:0,skipped:n.length,skipReasons:n.length>0?[`${n.length} product(s): No Basic Optimization`]:[]};for(let i=0;i<s.length;i++){const l=s[i];Z(r=>({...r,current:i,currentItem:l.title}));try{const r=await A("/ai-enhance/product",{method:"POST",shop:u,body:{shop:u,productId:l.gid||fe(l.id),languages:l.optimizationSummary.optimizedLanguages}});if(r.results&&r.results.length>0){const S={shop:u,productId:l.gid||fe(l.id),results:r.results.filter(L=>L.bullets&&L.faq).map(L=>({language:L.language,seo:{...L.updatedSeo,bullets:L.bullets||[],faq:L.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},E=await A("/api/seo/apply-multi",{method:"POST",shop:u,body:S});h.successful++}else h.failed++}catch(r){if(console.error("âŒ [AI-ENHANCE] Enhancement error:",r),console.error("ðŸ” [AI-ENHANCE DEBUG] Error type:",typeof r),console.error("ðŸ” [AI-ENHANCE DEBUG] Error.status:",r.status,"Type:",typeof r.status),console.error("ðŸ” [AI-ENHANCE DEBUG] Error.requiresPurchase:",r.requiresPurchase),console.error("ðŸ” [AI-ENHANCE DEBUG] Error.trialRestriction:",r.trialRestriction),console.error("ðŸ” [AI-ENHANCE DEBUG] Full error object:",JSON.stringify(r,Object.getOwnPropertyNames(r))),console.error("ðŸ” [AI-ENHANCE DEBUG] Error details:",{status:r.status,trialRestriction:r.trialRestriction,needsUpgrade:r.needsUpgrade,requiresPurchase:r.requiresPurchase,message:r.message,currentPlan:r.currentPlan}),r.status===403){Z({processing:!1,current:0,total:0,currentItem:"",results:null}),F({...r,message:r.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),ge(r.currentPlan||_),Y(!0);return}if(r.status===402||r.requiresPurchase||r.trialRestriction){Z({processing:!1,current:0,total:0,currentItem:"",results:null}),F(r),ge(r.currentPlan||P||"starter"),r.trialRestriction?Y(!0):rt(!0);return}h.failed++}Z(r=>({...r,current:i+1}))}Z(i=>({...i,processing:!1,results:h})),C(`AI enhancement complete! ${h.successful} products enhanced.`)},Be=()=>{nt(!1),Z({processing:!1,current:0,total:0,currentItem:"",results:null}),I.results&&I.results.successful>0&&V(1,!1,null)},Dt=()=>I.processing?e.jsx(z,{open:st,title:"Processing AI Enhancement",onClose:Be,noScroll:!0,children:e.jsx(z.Section,{children:e.jsxs(D,{gap:"400",children:[e.jsxs(c,{variant:"bodyMd",children:["Processing: ",I.currentItem]}),e.jsx(ut,{progress:I.current/I.total*100}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:[I.current," of ",I.total," products (",Math.round(I.current/I.total*100),"%)"]})]})})}):I.results!==null?e.jsx(z,{open:st,title:"AI Enhancement Results",onClose:Be,primaryAction:{content:"Done",onAction:Be},children:e.jsx(z.Section,{children:e.jsxs(D,{gap:"400",children:[e.jsxs(w,{gap:"400",children:[e.jsxs(g,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:I.results.successful})]}),e.jsxs(g,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:I.results.failed})]}),e.jsxs(g,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:I.results.skipped})]})]}),I.results.skipReasons&&I.results.skipReasons.length>0&&e.jsxs(D,{gap:"200",children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped products:"}),I.results.skipReasons.map((t,s)=>e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["â€¢ ",t]},s))]})]})})}):null,Ut=async()=>{var s;if(!N.length){C("Please select at least one language");return}let t=yt;(!t||!t.trim())&&(t=((s=bt[0])==null?void 0:s.value)||"anthropic/claude-3.5-sonnet"),X(!0),H({current:0,total:0,percent:0}),ce([]),et({});try{let n=[];y?n=(await A(`/api/products/list?shop=${encodeURIComponent(u)}&limit=1000&fields=id`)).products||[]:n=x.filter(p=>d.includes(p.id));const a=R(P),m=n.length;if(m>a){X(!1),H({current:0,total:0,percent:0}),ue(!1);const p=ve(m);F({error:"Product limit exceeded",message:`Your ${_} plan supports up to ${a} products for SEO optimization. You have selected ${m} products.`,minimumPlanRequired:p,currentPlan:_,features:[`Optimize up to ${R(p)} products`,"All features from your current plan",p==="Growth Extra"||p==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",p==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),Y(!0);return}ue(!1);const h=m,i=0;H({current:0,total:h,percent:0});const l=5,r={};for(let p=0;p<n.length;p+=l){const O=n.slice(p,Math.min(p+l,n.length)).map(async v=>{var oe;re(v.title||v.handle||"Product");try{const Ce=v.gid||fe(v.productId||v.id),We=((oe=v.optimizationSummary)==null?void 0:oe.optimizedLanguages)||[],He=N.filter(_t=>!We.includes(_t));if(He.length===0){r[v.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Yt=await A("/api/seo/generate-multi",{method:"POST",shop:u,body:{shop:u,productId:Ce,model:t,languages:He}});r[v.id]={success:!0,data:Yt,languages:He}}catch(Ce){r[v.id]={success:!1,error:Ce.message},ce(We=>[...We,{product:v.title,error:Ce.message}])}});await Promise.all(O);const G=Math.min(p+l,n.length),me=Math.round(G/h*100);H({current:G,total:h,percent:me})}et(r),Ue(!0);const S=Object.keys(r).filter(p=>r[p].success&&!r[p].skipped).length,E=Object.keys(r).filter(p=>r[p].skipped).length;let L=`Generated Optimization for AI Search for ${S} products`;E>0&&(L+=` (${E} already optimised)`),i>0,C(L)}catch(n){C(`Error: ${n.message}`)}finally{X(!1),re("")}},$t=async()=>{var t,s;X(!0),H({current:0,total:0,percent:0});try{const n=Object.entries(de).filter(([i,l])=>l.success&&!l.skipped),a=n.length;H({current:0,total:a,percent:0});for(let i=0;i<n.length;i++){const[l,r]=n[i],S=x.find(p=>p.id===l);if(!S)continue;re(S.title||"Product");try{const p=S.gid||fe(S.productId||S.id),k=await A("/api/seo/apply-multi",{method:"POST",shop:u,body:{shop:u,productId:p,results:r.data.results.filter(O=>O==null?void 0:O.seo).map(O=>({language:O.language,seo:O.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});k.appliedLanguages&&k.appliedLanguages.length>0&&Q(O=>O.map(G=>{var me;if(G.id===l){const v=((me=G.optimizationSummary)==null?void 0:me.optimizedLanguages)||[],oe=[...new Set([...v,...k.appliedLanguages])];return{...G,optimizationSummary:{...G.optimizationSummary,optimizedLanguages:oe,optimized:!0,lastOptimized:new Date().toISOString()}}}return G}))}catch(p){ce(k=>[...k,{product:S.title,error:`Apply failed: ${p.message}`}])}const E=i+1,L=Math.round(E/a*100);H({current:E,total:a,percent:L})}C("AI Search Optimisation applied successfully!"),Ue(!1),console.log("[APPLY-SEO] ===== CLEARING SELECTION ====="),console.log("[APPLY-SEO] Selected items BEFORE clear:",d),te([]),ie(!1),console.log("[APPLY-SEO] Selected items cleared"),console.log("[APPLY-SEO] Waiting for database propagation..."),await new Promise(i=>setTimeout(i,1e3)),console.log("[APPLY-SEO] Clearing products state before reload..."),Q([]);const m=new URLSearchParams({shop:u,page:1,limit:50,...B!=="all"&&{optimized:B},...J&&{search:J},...$&&{languageFilter:$},...W.length>0&&{tags:W.join(",")},sortBy:je,sortOrder:se,_t:Date.now()}),h=await A(`/api/products/list?${m}`,{shop:u,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});Q(h.products||[]),Fe(1),ze(((t=h.pagination)==null?void 0:t.hasNext)||!1),Ke(((s=h.pagination)==null?void 0:s.total)||0)}catch(n){C(`Error applying AI Search Optimisation: ${n.message}`)}finally{X(!1),re("")}},Nt=async()=>{var t;if(!q.length){C("Please select at least one language to delete");return}pe(!1),Ee(!1),X(!0),H({current:0,total:0,percent:0}),ce([]);try{let s=[];y?s=(await A(`/api/products/list?shop=${encodeURIComponent(u)}&limit=1000&fields=id`)).products||[]:s=x.filter(h=>d.includes(h.id));const n=s.length;H({current:0,total:n,percent:0});let a=0,m=0;for(let h=0;h<s.length;h++){const i=s[h];re(i.title||i.handle||"Product");try{const S=i.gid||fe(i.productId||i.id),E=((t=i.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],L=q.filter(k=>E&&E.length>0&&E.includes(k));if(L.length===0){m++;continue}const p=await A("/api/seo/delete-multi",{method:"POST",shop:u,body:{shop:u,productId:S,languages:L}});p.deletedLanguages&&p.deletedLanguages.length>0&&Q(k=>k.map(O=>{var G;if(O.id===i.id){const v=(((G=O.optimizationSummary)==null?void 0:G.optimizedLanguages)||[]).filter(oe=>!p.deletedLanguages.includes(oe));return{...O,optimizationSummary:{...O.optimizationSummary,optimizedLanguages:v,optimized:v.length>0,lastOptimized:v.length>0?O.optimizationSummary.lastOptimized:null}}}return O})),a++,p.deletedLanguages&&p.deletedLanguages.length>0&&await A("/api/products/verify-after-delete",{method:"POST",shop:u,body:{shop:u,productIds:[S],deletedLanguages:p.deletedLanguages}})}catch(S){ce(E=>[...E,{product:i.title,error:S.message}])}const l=h+1,r=Math.round(l/n*100);H({current:l,total:n,percent:r})}te([]),ie(!1),m>0?C(`Deleted Optimization for AI Search from ${a} products (${m} had no optimisation to delete)`):C(`Deleted Optimization for AI Search from ${a} products`),setTimeout(()=>{const h=Date.now();V(1,!1,h)},500)}catch(s){C(`Error: ${s.message}`)}finally{X(!1),re("")}},Bt=t=>{var s,n;try{const a=t,m=is(a.productId||a.id),h=((s=a.optimizationSummary)==null?void 0:s.optimizedLanguages)||[];console.log(`[BULK-EDIT-RENDER] Product: "${a.title}", ID: ${a.id}, Type: ${typeof a.id}`),console.log("[BULK-EDIT-RENDER] Optimized Languages:",h),console.log("[BULK-EDIT-RENDER] Selected Items:",d),console.log("[BULK-EDIT-RENDER] Is Selected:",d.includes(a.id));const i=(n=a.images)!=null&&n[0]?e.jsx(ht,{source:a.images[0].url||a.images[0].src||a.images[0],alt:a.title,size:"small"}):a.imageUrl?e.jsx(ht,{source:a.imageUrl,alt:a.title,size:"small"}):e.jsx(g,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(rs,{id:a.id,media:i,accessibilityLabel:`View details for ${a.title}`,onClick:l=>{console.log("[ResourceItem] ===== CLICK ON RESOURCE ITEM ====="),console.log("[ResourceItem] e.target:",l.target),console.log("[ResourceItem] e.target.tagName:",l.target.tagName),console.log('[ResourceItem] e.target.closest("input"):',l.target.closest("input")),console.log('[ResourceItem] e.target.closest("a"):',l.target.closest("a")),console.log("[ResourceItem] Event bubbling up...")},children:e.jsxs(w,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(g,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:a.title}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["ID: ",m]})]}),e.jsx(g,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(w,{gap:"100",children:M.length>0?M.map(l=>{const r=h.includes(l);return e.jsx(ee,{tone:r?"success":"subdued",size:"small",children:l.toUpperCase()},l)}):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),h.map(l=>e.jsx(ee,{tone:"success",size:"small",children:l.toUpperCase()},l)))})}),e.jsx(g,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(ee,{tone:"success",children:"Active"})})]})})}catch(a){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",a),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},Gt=De&&e.jsx(z,{open:De,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(z.Section,{children:e.jsxs(D,{gap:"400",children:[e.jsx(c,{variant:"bodyMd",children:Ze?`Processing: ${Ze}`:"Preparing..."}),e.jsx(ut,{progress:Pe.percent}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:[Pe.current," of ",Pe.total," products (",Pe.percent,"%)"]})]})})}),Wt=e.jsx(z,{open:At,title:"Select Languages",onClose:()=>{ue(!1),ne([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Ut,disabled:N.length===0||it},secondaryActions:[{content:"Cancel",onAction:()=>{ue(!1),ne([])}}],children:e.jsx(z.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsxs(c,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",y?"all":d.length," selected products:"]}),it&&e.jsx(qe,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(D,{gap:"200",children:[e.jsxs(c,{variant:"bodyMd",children:["Your ",_," plan supports up to ",K," language",K>1?"s":""," per product.",d.length===1&&((dt=(ct=(lt=x.find(t=>t.id===d[0]))==null?void 0:lt.optimizationSummary)==null?void 0:ct.optimizedLanguages)==null?void 0:dt.length)>0&&e.jsxs(e.Fragment,{children:[" This product already has ",x.find(t=>t.id===d[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(c,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(T,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),s=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${s}`},children:"Upgrade Plan"})]})}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(w,{gap:"200",wrap:!0,children:M.map(t=>e.jsx(Ie,{label:t.toUpperCase(),checked:N.includes(t),onChange:s=>{ne(s?[...N,t]:N.filter(n=>n!==t))}},t))})}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(T,{plain:!0,onClick:()=>{N.length===M.length?ne([]):M.length>K?(ne([...M]),C(`You selected ${M.length} languages. Your ${_} plan supports ${K}. Please deselect or upgrade.`)):ne([...M])},children:N.length===M.length?"Deselect all":"Select all"})}),e.jsx(c,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Ht=e.jsx(z,{open:wt&&!De,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:$t,disabled:!Object.values(de).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Ue(!1)}],children:e.jsx(z.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsxs(w,{gap:"400",children:[e.jsxs(g,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(de).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(g,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(de).filter(t=>t.skipped).length})]}),e.jsxs(g,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(de).filter(t=>!t.success).length})]})]}),be.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Zt,{}),e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(g,{maxHeight:"200px",overflowY:"scroll",children:[be.slice(0,10).map((t,s)=>e.jsxs(c,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),be.length>10&&e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["... and ",be.length-10," more errors"]})]})]})]})})}),qt=e.jsx(z,{open:Ct,title:"Delete Optimization for AI Search",onClose:()=>{pe(!1),he([])},primaryAction:{content:"Continue",onAction:()=>{pe(!1),Ee(!0)},disabled:q.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{pe(!1),he([])}}],children:e.jsx(z.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsxs(c,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",y?"all":d.length," selected products:"]}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(w,{gap:"200",wrap:!0,children:M.map(t=>e.jsx(Ie,{label:t.toUpperCase(),checked:q.includes(t),onChange:s=>{he(s?[...q,t]:q.filter(n=>n!==t))}},t))})}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(T,{plain:!0,onClick:()=>{he(q.length===M.length?[]:[...M])},children:q.length===M.length?"Deselect all":"Select all"})}),e.jsx(c,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Ft=e.jsx(z,{open:It,title:"Confirm Deletion",onClose:()=>{Ee(!1)},primaryAction:{content:"Delete",onAction:Nt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>Ee(!1)}],children:e.jsx(z.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsx(c,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(g,{paddingBlock:"200",children:e.jsx(w,{gap:"100",children:q.map(t=>e.jsx(ee,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(c,{variant:"bodyMd",children:["This will delete optimisation from ",y?"ALL":d.length," selected products."]}),e.jsx(c,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Ge=async()=>{try{Se(!0),C("Syncing products from Shopify...");const t=await A("/api/products/sync",{method:"POST",shop:u});if(t.success){const s=t.productsCount||t.synced||0;C(`âœ… Synced ${s} products successfully!`),setTimeout(()=>{V(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),C(`âŒ Sync failed: ${t.message}`)}finally{Se(!1)}},Kt=e.jsx(os,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Ye(""),xe("all"),le(""),ye([]),V(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Ge},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Qt,{globalPlan:j}),e.jsx(pt,{children:e.jsxs(g,{padding:"400",children:[e.jsxs(D,{gap:"300",children:[P&&e.jsx(qe,{tone:"info",children:e.jsxs(w,{gap:"200",align:"space-between",children:[e.jsxs(c,{children:["Your ",e.jsx("strong",{children:P})," plan includes up to"," ",e.jsx("strong",{children:R(P)})," products for SEO optimization.",U>R(P)&&e.jsxs(e.Fragment,{children:[" You have ",U," products, so only the first ",R(P)," will be processed."]})]}),(d.length>0||y)&&e.jsxs(c,{children:["Selected: ",y?Math.min(U,R(P)):d.length,"/",R(P)]})]})}),P&&(d.length>R(P)||y&&U>R(P))&&e.jsx(qe,{tone:"critical",children:e.jsxs(D,{gap:"200",children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),e.jsxs(c,{children:["Your ",e.jsx("strong",{children:P})," plan supports up to ",e.jsx("strong",{children:R(P)})," products. You have selected ",e.jsx("strong",{children:y?U:d.length})," products."]}),e.jsx(c,{children:"Please deselect some products or upgrade your plan to continue."}),e.jsxs(w,{gap:"200",children:[e.jsx(T,{onClick:()=>{te([]),ie(!1)},children:"Clear Selection"}),e.jsx(T,{variant:"primary",onClick:()=>{F({error:"Product limit exceeded",message:`Your ${P} plan supports up to ${R(P)} products. Upgrade to ${ve(y?U:d.length)} to optimize more products.`,minimumPlanRequired:ve(y?U:d.length)}),Y(!0)},children:"Upgrade Plan"})]})]})}),e.jsxs(w,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(g,{minWidth:"400px",children:e.jsx(es,{label:"",placeholder:"Search by product ID, name, or details...",value:J,onChange:ot,prefix:e.jsx(ts,{}),clearButton:!0,onClearButtonClick:()=>ot("")})}),e.jsx(g,{width:"320px",children:e.jsx(T,{primary:!0,onClick:Tt,disabled:d.length===0&&!y,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(w,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(T,{onClick:Ge,disabled:ae,size:"medium",children:"Sync Products"}),e.jsx(g,{width:"320px",children:e.jsxs(D,{gap:"200",align:"end",children:[(()=>{if(d.length===0&&!y||!x.filter(a=>d.includes(a.id)).some(a=>{var m,h;return((h=(m=a.optimizationSummary)==null?void 0:m.optimizedLanguages)==null?void 0:h.length)>0}))return null;const n=["professional","growth","growth_extra","growth extra","enterprise"].includes(_.toLowerCase().replace(/_/g," "));return e.jsx(T,{onClick:n?kt:()=>{F({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),Y(!0)},disabled:d.length===0&&!y,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(T,{onClick:Rt,disabled:d.length===0&&!y||!x.filter(n=>d.includes(n.id)).some(n=>{var a,m;return((m=(a=n.optimizationSummary)==null?void 0:a.optimizedLanguages)==null?void 0:m.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),U>0&&e.jsx(g,{paddingBlockStart:"300",children:e.jsx(Ie,{label:`Select all ${U} products in your store`,checked:y,onChange:at})})]})}),e.jsx(g,{paddingBlockStart:"400",children:e.jsxs(pt,{children:[e.jsxs(g,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(w,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(w,{gap:"200",wrap:!0,children:[e.jsx(Le,{active:_e,activator:e.jsx(T,{disclosure:"down",onClick:()=>Me(!_e),removeUnderline:!0,children:e.jsxs(w,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),B!=="all"&&e.jsx(g,{onClick:t=>{t.stopPropagation(),xe("all")},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Me(!1),children:e.jsx(g,{padding:"300",minWidth:"200px",children:e.jsx(Oe,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[B],onChange:t=>{xe(t[0]),le(""),Me(!1)}})})}),e.jsx(Le,{active:Ve,activator:e.jsx(T,{disclosure:"down",onClick:()=>Te(!Ve),removeUnderline:!0,children:e.jsxs(w,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),$&&e.jsx(g,{onClick:t=>{t.stopPropagation(),le("")},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Te(!1),children:e.jsx(g,{padding:"300",minWidth:"200px",children:e.jsx(Oe,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...M.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...M.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:$?[$]:[],onChange:t=>{le(t[0]||""),Te(!1)}})})}),e.jsx(Le,{active:Qe,activator:e.jsx(T,{disclosure:"down",onClick:()=>Re(!Qe),removeUnderline:!0,children:e.jsxs(w,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),W.length>0&&e.jsx(g,{onClick:t=>{t.stopPropagation(),ye([])},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Re(!1),children:e.jsxs(g,{padding:"300",minWidth:"200px",children:[e.jsx(Oe,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:xt.map(t=>({label:t,value:t})),selected:W,onChange:t=>{ye(t)}}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(T,{size:"slim",onClick:()=>Re(!1),children:"Apply"})})]})})]}),e.jsx(Le,{active:Je,activator:e.jsx(T,{disclosure:"down",onClick:()=>ke(!Je),removeUnderline:!0,children:e.jsx(w,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:se==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>ke(!1),children:e.jsx(g,{padding:"300",minWidth:"200px",children:e.jsx(Oe,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[se],onChange:t=>{St(t[0]),ke(!1)}})})})]}),(B!=="all"||$||W.length>0)&&e.jsx(g,{paddingBlockStart:"200",children:e.jsxs(w,{gap:"100",wrap:!0,children:[B!=="all"&&e.jsx(ee,{onRemove:()=>xe("all"),children:B==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),$&&e.jsx(ee,{onRemove:()=>le(""),children:$.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),W.map(t=>e.jsxs(ee,{onRemove:()=>ye(s=>s.filter(n=>n!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(g,{children:[e.jsx(g,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(w,{gap:"200",align:"start",children:[e.jsx(Ie,{checked:d.length===x.length&&x.length>0,onChange:at,label:""}),e.jsxs(c,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",d.length>0&&` (${d.length} selected products)`]})]})}),e.jsx(ss,{resourceName:{singular:"product",plural:"products"},items:x,renderItem:Bt,selectedItems:d,onSelectionChange:Mt,selectable:!0,loading:ae,totalItemsCount:U,emptyState:Kt,showHeader:!1},`products-${x.length}-${d.length}`)]}),ft&&!ae&&e.jsx(g,{padding:"400",textAlign:"center",children:e.jsx(T,{onClick:()=>V(mt+1,!0,null),children:"Load more"})})]})}),Gt,Wt,Ht,qt,Ft,Dt(),e.jsx(z,{open:Ot,onClose:()=>we(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{we(!1),Ge()}},secondaryActions:[{content:"Skip for now",onAction:()=>we(!1)}],children:e.jsx(z.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsx(c,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(c,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Jt,{open:Ne,onClose:()=>{Y(!1),F(null)},featureName:(b==null?void 0:b.error)||"Feature",errorMessage:b==null?void 0:b.message,currentPlan:(b==null?void 0:b.currentPlan)||_,minimumPlanRequired:b==null?void 0:b.minimumPlanRequired,features:b==null?void 0:b.features}),b&&e.jsx(Xt,{open:zt,onClose:()=>{rt(!1),F(null)},tokensRequired:b.tokensRequired||0,tokensAvailable:b.tokensAvailable||0,tokensNeeded:b.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:u,needsUpgrade:b.needsUpgrade||!1,minimumPlan:b.minimumPlanForFeature||null,currentPlan:b.currentPlan||_}),tt&&e.jsx(ns,{content:tt,onDismiss:()=>C("")})]})}export{gs as default};
