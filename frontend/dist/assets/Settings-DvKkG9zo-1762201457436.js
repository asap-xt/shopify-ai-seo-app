import{j as e}from"./app-bridge-CyFf70bA-1762201457436.js";import{r as c}from"./react-vendor-tAaa2TlE-1762201457436.js";import{m as ve}from"./sessionFetch-CJepNHo3-1762201457436.js";import{I as ro}from"./InsufficientTokensModal-DEjlLx74-1762201457436.js";import{C as M,B as E,T as S,I as w,n as Be,a as T,f as H,d as C,D as he,g as L,b as j,u as lo,M as b,e as co,k as io}from"./polaris-BRCGHt-a-1762201457436.js";function bo(){console.log("[SETTINGS] ===== SETTINGS COMPONENT LOADED ====="),console.log("[SETTINGS] Starting component initialization...");const Re=(o,a="")=>{try{return new URLSearchParams(window.location.search).get(o)||a}catch{return a}},y=o=>(o||"starter").toLowerCase().replace(" ","_"),Ue=(o,a=null)=>{console.log(`[SETTINGS DEBUG] ${o}`,a||"")},n=Re("shop",""),[He,ue]=c.useState(!0),[Le,ge]=c.useState(!1),[t,_]=c.useState(null),[pe,oe]=c.useState(""),[Ee,te]=c.useState(!1),[F,u]=c.useState(""),[Te,Fe]=c.useState(null),[me,se]=c.useState(null),[fe,ze]=c.useState(!1),[ae,Je]=c.useState(!1),[ne,_e]=c.useState(!1),[re,$e]=c.useState(!1),[qe,We]=c.useState(!1),[Ve,Qe]=c.useState(!1),[So,ho]=c.useState(!1),[Ke,Ge]=c.useState(!1),[xe,le]=c.useState(!1),[Ie,ce]=c.useState(!1),[be,Ye]=c.useState(""),[Ne,O]=c.useState(null),[Ae,we]=c.useState(!1),[ie,de]=c.useState(null),[Ce,Xe]=c.useState(!1),[Ze,z]=c.useState(!1),[$,q]=c.useState({feature:"",tokensRequired:0,tokensAvailable:0,tokensNeeded:0}),[uo,go]=c.useState(!1),[po,Eo]=c.useState(""),[To,eo]=c.useState({enabled:!1,generating:!1,generated:!1,progress:""}),[k,f]=c.useState(!1),[D,W]=c.useState({current:0,total:0,percent:0,currentProduct:"",stats:{siteFAQ:!1,products:0,totalSchemas:0}}),[R,A]=c.useState(!1),[je,v]=c.useState(!1),[ye,B]=c.useState(null),g=c.useMemo(()=>ve(),[]);console.log("[SETTINGS] ===== SHOP EXTRACTION DEBUG ====="),console.log("[SETTINGS] Extracted shop:",n),console.log("[SETTINGS] API function created:",typeof g),console.log("[SETTINGS] makeSessionFetch function:",typeof ve),c.useEffect(()=>{if(F){console.log("[SETTINGS] Toast state changed to:",F),Te&&clearTimeout(Te);const o=setTimeout(()=>{console.log("[SETTINGS] Auto-clearing toast after 5 seconds"),u("")},5e3);Fe(o)}},[F]);const oo=()=>{console.log("[SETTINGS] Starting polling for background regeneration completion..."),me&&clearInterval(me);let o=0;const a=30,s=setInterval(async()=>{o++,console.log(`[SETTINGS] Polling attempt ${o}/${a}`);try{const r=await g(`/api/sitemap/info?shop=${n}`);if(console.log("[SETTINGS] Sitemap info:",r),r&&r.generatedAt){const h=new Date(r.generatedAt).getTime();if(Date.now()-h<12e4){console.log("[SETTINGS] Background regeneration completed!"),clearInterval(s),se(null),u("AI-Optimized Sitemap regeneration completed successfully!"),console.log("[SETTINGS] Setting showAiSitemapView to true for AI sitemap regeneration completion"),We(!0);return}}o>=a&&(console.log("[SETTINGS] Polling timeout reached"),clearInterval(s),se(null),u("Background regeneration is taking longer than expected. Please check the sitemap manually."))}catch(r){console.error("[SETTINGS] Polling error:",r)}},1e4);se(s)},V=c.useCallback(async()=>{var o,a;try{console.log("[SETTINGS DEBUG] ===== CHECKING PRODUCTS DATA ====="),console.log("[SETTINGS DEBUG] Shop:",n);const s=await g(`/api/products/list?shop=${n}&limit=10&optimized=true`);console.log("[SETTINGS DEBUG] API Result:",s),console.log("[SETTINGS DEBUG] Products length:",(o=s==null?void 0:s.products)==null?void 0:o.length),console.log("[SETTINGS DEBUG] Products:",s==null?void 0:s.products);const r=(a=s==null?void 0:s.products)==null?void 0:a.some(h=>{var i,d;return((d=(i=h==null?void 0:h.optimizationSummary)==null?void 0:i.optimizedLanguages)==null?void 0:d.length)>0});return console.log("[SETTINGS DEBUG] Has optimized products:",r),console.log("[SETTINGS DEBUG] ===== PRODUCTS CHECK COMPLETE ====="),r}catch(s){return console.error("[SETTINGS] Error checking products data:",s),!1}},[n,g]),Q=c.useCallback(async()=>{var o,a;try{console.log("[SETTINGS DEBUG] ===== CHECKING COLLECTIONS DATA ====="),console.log("[SETTINGS DEBUG] Shop:",n);const s=await g(`/collections/list-graphql?shop=${n}`);console.log("[SETTINGS DEBUG] API Result:",s),console.log("[SETTINGS DEBUG] Collections length:",(o=s==null?void 0:s.collections)==null?void 0:o.length),console.log("[SETTINGS DEBUG] Collections:",s==null?void 0:s.collections);const r=(a=s==null?void 0:s.collections)==null?void 0:a.some(h=>{var i;return((i=h==null?void 0:h.optimizedLanguages)==null?void 0:i.length)>0});return console.log("[SETTINGS DEBUG] Has optimized collections:",r),console.log("[SETTINGS DEBUG] ===== COLLECTIONS CHECK COMPLETE ====="),r}catch(s){return console.error("[SETTINGS] Error checking collections data:",s),!1}},[n,g]),K=c.useCallback(async()=>{var o,a,s,r,h;try{console.log("[SETTINGS DEBUG] ===== CHECKING STORE METADATA ====="),console.log("[SETTINGS DEBUG] Shop:",n);const i=`
        query CheckStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
          }
        }
      `;console.log("[SETTINGS DEBUG] GraphQL Query:",i),console.log("[SETTINGS DEBUG] Variables:",{shop:n});const d=await g("/graphql",{method:"POST",body:JSON.stringify({query:i,variables:{shop:n}}),shop:n});console.log("[SETTINGS DEBUG] GraphQL Result:",d),console.log("[SETTINGS DEBUG] Result data:",d==null?void 0:d.data),console.log("[SETTINGS DEBUG] Store metadata:",(o=d==null?void 0:d.data)==null?void 0:o.storeMetadata),console.log("[SETTINGS DEBUG] Shop name:",(s=(a=d==null?void 0:d.data)==null?void 0:a.storeMetadata)==null?void 0:s.shopName);const m=!!((h=(r=d==null?void 0:d.data)==null?void 0:r.storeMetadata)!=null&&h.shopName);return console.log("[SETTINGS DEBUG] Has metadata:",m),console.log("[SETTINGS DEBUG] ===== STORE METADATA CHECK COMPLETE ====="),m}catch(i){return console.error("[SETTINGS] Error checking store metadata:",i),console.error("[SETTINGS] Error details:",i==null?void 0:i.message,i==null?void 0:i.stack),!1}},[n,g]),Y=c.useCallback(async()=>{var o;try{console.log("[SETTINGS DEBUG] ===== CHECKING WELCOME PAGE ====="),console.log("[SETTINGS DEBUG] Shop:",n),console.log("[SETTINGS DEBUG] Current settings features:",t==null?void 0:t.features),console.log("[SETTINGS DEBUG] Welcome page feature enabled:",(o=t==null?void 0:t.features)==null?void 0:o.welcomePage),console.log("[SETTINGS DEBUG] Current plan:",t==null?void 0:t.plan);const a=await g(`/ai/welcome?shop=${n}`);if(console.log("[SETTINGS DEBUG] Welcome page result:",a),console.log("[SETTINGS DEBUG] Result type:",typeof a),console.log("[SETTINGS DEBUG] Result keys:",a?Object.keys(a):"null"),a!=null&&a.error&&typeof a.error=="string"&&!a.error.includes("<!DOCTYPE html>"))return console.log("[SETTINGS DEBUG] Welcome page error:",a.error),console.log("[SETTINGS DEBUG] Error debug info:",a.debug),!1;const s=typeof a=="string"&&a.includes("<!DOCTYPE html>")||(a==null?void 0:a.error)&&typeof a.error=="string"&&a.error.includes("<!DOCTYPE html>");return console.log("[SETTINGS DEBUG] Has welcome page:",s),console.log("[SETTINGS DEBUG] ===== WELCOME PAGE CHECK COMPLETE ====="),s}catch(a){return console.error("[SETTINGS] Error checking welcome page:",a),!1}},[n,g,t]),X=c.useCallback(async()=>{var o,a,s,r,h,i,d,m,l,x,I;console.log("[SETTINGS] ===== checkGeneratedData CALLED ====="),console.log("[SETTINGS] checkGeneratedData - shop:",n),console.log("[SETTINGS] checkGeneratedData - settings:",t),console.log("[SETTINGS] checkGeneratedData - settings?.features:",t==null?void 0:t.features),console.log("[SETTINGS] checkGeneratedData - Store Metadata feature:",(o=t==null?void 0:t.features)==null?void 0:o.storeMetadata),console.log("[SETTINGS] checkGeneratedData - Store Metadata type:",typeof((a=t==null?void 0:t.features)==null?void 0:a.storeMetadata)),console.log("[SETTINGS] checkGeneratedData - Store Metadata enabled:",!!((s=t==null?void 0:t.features)!=null&&s.storeMetadata));try{if(console.log("[SETTINGS] ===== CHECKING GENERATED DATA ====="),(r=t==null?void 0:t.features)!=null&&r.productsJson){console.log("[SETTINGS] ===== CHECKING PRODUCTS JSON FEATURE ====="),console.log("[SETTINGS] Products JSON feature is enabled:",(h=t==null?void 0:t.features)==null?void 0:h.productsJson);const p=await V();console.log("[SETTINGS] Setting showProductsJsonView to:",p),Je(p),console.log("[SETTINGS] Products JSON data exists:",p)}else console.log("[SETTINGS] Products JSON feature is disabled");if((i=t==null?void 0:t.features)!=null&&i.collectionsJson){console.log("[SETTINGS] ===== CHECKING COLLECTIONS JSON FEATURE ====="),console.log("[SETTINGS] Collections JSON feature is enabled:",(d=t==null?void 0:t.features)==null?void 0:d.collectionsJson);const p=await Q();console.log("[SETTINGS] Setting showCollectionsJsonView to:",p),_e(p),console.log("[SETTINGS] Collections JSON data exists:",p)}else console.log("[SETTINGS] Collections JSON feature is disabled");if((m=t==null?void 0:t.features)!=null&&m.storeMetadata){console.log("[SETTINGS] ===== CHECKING STORE METADATA IN checkGeneratedData ====="),console.log("[SETTINGS] Store Metadata feature is enabled:",(l=t==null?void 0:t.features)==null?void 0:l.storeMetadata),console.log("[SETTINGS] About to call checkStoreMetadata...");const p=await K();console.log("[SETTINGS] checkStoreMetadata returned:",p),console.log("[SETTINGS] Setting showStoreMetadataView to:",p),$e(p),console.log("[SETTINGS] Store Metadata exists:",p),console.log("[SETTINGS] ===== STORE METADATA CHECK COMPLETE =====")}else console.log("[SETTINGS] Store Metadata feature is NOT enabled:",(x=t==null?void 0:t.features)==null?void 0:x.storeMetadata);if((I=t==null?void 0:t.features)!=null&&I.welcomePage){console.log("[SETTINGS] Checking Welcome Page data...");const p=await Y();Qe(p),console.log("[SETTINGS] Welcome Page exists:",p)}console.log("[SETTINGS] ===== GENERATED DATA CHECK COMPLETE =====")}catch(p){console.error("[SETTINGS] Error checking generated data:",p)}},[t==null?void 0:t.features,V,Q,K,Y]);c.useEffect(()=>{console.log("[SETTINGS DEBUG] ===== useEffect DEPENDENCIES DEBUG ====="),console.log("[SETTINGS DEBUG] settings?.features:",t==null?void 0:t.features),console.log("[SETTINGS DEBUG] settings exists:",!!t),console.log("[SETTINGS DEBUG] settings type:",typeof t),console.log("[SETTINGS DEBUG] checkProductsData exists:",!!V),console.log("[SETTINGS DEBUG] checkCollectionsData exists:",!!Q),console.log("[SETTINGS DEBUG] checkStoreMetadata exists:",!!K),console.log("[SETTINGS DEBUG] checkWelcomePage exists:",!!Y),console.log("[SETTINGS DEBUG] ===== END useEffect DEPENDENCIES DEBUG =====")},[t==null?void 0:t.features,V,Q,K,Y]),console.log("[SETTINGS] State variables initialized successfully"),console.log("[SETTINGS] About to create useEffect hooks..."),console.log("[SETTINGS] Creating loadSettings useEffect..."),console.log("[SETTINGS] Current shop value:",n),console.log("[SETTINGS] Shop type:",typeof n),console.log("[SETTINGS] Shop length:",n==null?void 0:n.length),c.useEffect(()=>{if(console.log("[SETTINGS] ===== LOAD SETTINGS useEffect TRIGGERED ====="),console.log("[SETTINGS] Shop:",n),console.log("[SETTINGS] API function:",typeof g),console.log("[SETTINGS] useEffect dependencies - shop:",n),console.log("[SETTINGS] useEffect dependencies - api:",typeof g),!n){console.log("[SETTINGS] No shop, setting loading to false"),ue(!1);return}console.log("[SETTINGS] Shop available, calling loadSettings..."),so()},[n,g]),console.log("[SETTINGS] loadSettings useEffect created successfully"),c.useEffect(()=>{Ce&&to()},[Ce]),c.useEffect(()=>{},[t==null?void 0:t.features]);const to=async()=>{try{const o=await g(`/api/schema/status?shop=${n}`);eo({enabled:o.enabled,generating:o.generating,generated:o.hasSiteFAQ||o.productsWithSchema>0,progress:o.progress||""})}catch(o){console.error("Failed to check schema status:",o)}},G=c.useRef(!1),N=c.useRef(0),Z=c.useCallback(async()=>{if(console.log("[PROGRESS-CHECK] Starting check..."),console.log("[PROGRESS-CHECK] isGeneratingRef.current:",G.current),console.log("[PROGRESS-CHECK] checkCountRef.current:",N.current),!G.current){console.log("[PROGRESS-CHECK] Not generating (ref is false), stopping check");return}if(N.current++,N.current>30){console.log("[PROGRESS-CHECK] ‚è∞ Maximum checks reached, stopping"),G.current=!1,N.current=0,f(!1),u("Schema generation timed out. Please check if data was generated.");return}try{const o=await g(`/api/schema/status?shop=${n}`);if(console.log("[PROGRESS-CHECK] Status data:",o),o.error==="NO_OPTIMIZED_PRODUCTS"||o.error==="ONLY_BASIC_SEO"){console.log("[PROGRESS-CHECK] ‚ùå Schema error:",o.error),G.current=!1,N.current=0,f(!1),u(null),B(o.error),v(!0);return}if(o.dataReady){console.log("[PROGRESS-CHECK] ‚úÖ Data is ready! Generation complete!"),G.current=!1,N.current=0,f(!1),A(!0),W(a=>({...a,percent:100,currentProduct:"Complete!",stats:{siteFAQ:o.hasSiteFAQ||!1,products:o.productsWithSchema||0,totalSchemas:o.productsWithSchema||0}}));return}if(o.generating){console.log("[PROGRESS-CHECK] Still generating, updating progress...");let a=0;if(o.progress){const s=o.progress.match(/(\d+)%/);s&&(a=parseInt(s[1]))}W(s=>({...s,percent:Math.max(s.percent,a),currentProduct:o.currentProduct||`Processing... (${N.current}/30)`})),setTimeout(()=>{G.current&&Z()},3e3)}else{console.log("[PROGRESS-CHECK] ‚ö†Ô∏è Not generating but no data ready");try{const a=await g(`/ai/schema-data.json?shop=${n}`);if(a&&a.schemas&&a.schemas.length>0){console.log("[PROGRESS-CHECK] Found data on direct check!"),G.current=!1,N.current=0,f(!1),A(!0);const s=[...new Set(a.schemas.map(r=>{var h,i;return(i=(h=r.url)==null?void 0:h.split("/products/")[1])==null?void 0:i.split("#")[0]}))].filter(Boolean);W(r=>({...r,percent:100,currentProduct:"Complete!",stats:{siteFAQ:!!a.siteFAQ,products:s.length,totalSchemas:a.schemas.length}}))}else console.log("[PROGRESS-CHECK] No data found, generation may have failed"),G.current=!1,N.current=0,f(!1),u("Schema generation may have failed. Please try again.")}catch(a){console.error("[PROGRESS-CHECK] Error checking for final data:",a),G.current=!1,N.current=0,f(!1),u("Unable to verify schema generation status.")}}}catch(o){console.error("[PROGRESS-CHECK] ‚ùå Error:",o),N.current<5?(console.log("[PROGRESS-CHECK] Retrying after error..."),setTimeout(()=>{G.current&&Z()},5e3)):(G.current=!1,N.current=0,f(!1),u("Error checking generation status. Please refresh and try again."))}},[g,n]),so=async()=>{var o,a,s,r,h,i,d,m;try{console.log("[SETTINGS] ===== STARTING LOAD SETTINGS ====="),console.log("[SETTINGS] Shop:",n),console.log("[SETTINGS] API function:",typeof g),console.log("[SETTINGS] Calling API...");const l=await g(`/api/ai-discovery/settings?shop=${n}`);console.log("[SETTINGS] ===== SETTINGS LOADED ====="),console.log("[SETTINGS] Raw data:",l),console.log("[SETTINGS] Settings plan:",l==null?void 0:l.plan),console.log("[SETTINGS] Normalized plan:",y(l==null?void 0:l.plan)),console.log("[SETTINGS] Features:",l==null?void 0:l.features),console.log("[SETTINGS] Products JSON feature:",(o=l==null?void 0:l.features)==null?void 0:o.productsJson),console.log("[SETTINGS] Collections JSON feature:",(a=l==null?void 0:l.features)==null?void 0:a.collectionsJson),console.log("[SETTINGS] AI Sitemap feature:",(s=l==null?void 0:l.features)==null?void 0:s.aiSitemap),console.log("[SETTINGS] Welcome Page feature:",(r=l==null?void 0:l.features)==null?void 0:r.welcomePage),console.log("[SETTINGS] Store Metadata feature:",(h=l==null?void 0:l.features)==null?void 0:h.storeMetadata),console.log("[SETTINGS] Schema Data feature:",(i=l==null?void 0:l.features)==null?void 0:i.schemaData),console.log("[SETTINGS] Auto Robots Txt feature:",(d=l==null?void 0:l.features)==null?void 0:d.autoRobotsTxt);const x=Object.entries((l==null?void 0:l.features)||{}).filter(([I,p])=>p===!0);console.log("[SETTINGS] Features that are TRUE:",x),console.log("[SETTINGS] Number of true features:",x.length),console.log("[SETTINGS] Setting settings state..."),console.log("[SETTINGS] Data to set:",l),console.log("[SETTINGS] Store Metadata in data:",(m=l==null?void 0:l.features)==null?void 0:m.storeMetadata),_(l),de(l),console.log("[SETTINGS] Settings state set successfully"),Xe(l.advancedSchemaEnabled||!1),ee(l),console.log("[SETTINGS] ===== LOAD SETTINGS COMPLETE =====")}catch(l){console.error("[SETTINGS] ===== LOAD SETTINGS ERROR ====="),console.error("[SETTINGS] Failed to load settings:",l),u("Failed to load settings")}finally{ue(!1)}},ee=async(o=t)=>{console.log("[GENERATE ROBOTS] Called with shop:",n);try{const a=await g(`/api/ai-discovery/robots-txt?shop=${n}`,{responseType:"text"});console.log("[GENERATE ROBOTS] Received:",a),oe(a||`User-agent: *
Disallow: /`)}catch(a){console.error("[GENERATE ROBOTS] Error:",a),oe(`# Error generating robots.txt
# `+a.message)}};console.log("[SETTINGS DEBUG] generateRobotsTxt function exists:",typeof ee);const Se=o=>{var a;if(!((a=t==null?void 0:t.availableBots)!=null&&a.includes(o))){u(`Upgrade to ${requiredPlan} plan to enable ${t.bots[o].name}`);return}_(s=>({...s,bots:{...s.bots,[o]:{...s.bots[o],enabled:!s.bots[o].enabled}}})),Ge(!0)},Pe=async o=>{if(!ke(o)){u(`Upgrade your plan to enable ${{productsJson:"Products JSON Feed",aiSitemap:"AI-Optimized Sitemap",welcomePage:"AI Welcome Page",collectionsJson:"Collections JSON Feed",storeMetadata:"Store Metadata",schemaData:"Schema Data"}[o]||o}`);return}if(!t.features[o]&&De(o))try{const s=await g(`/api/billing/tokens/balance?shop=${n}`);if(s.balance<=0){q({feature:{aiSitemap:"ai-sitemap-optimized",schemaData:"ai-schema-advanced",welcomePage:"ai-welcome-page",collectionsJson:"ai-collections-json",storeMetadata:"ai-store-metadata"}[o]||o,tokensRequired:1e3,tokensAvailable:s.balance||0,tokensNeeded:1e3}),z(!0);return}}catch(s){console.error("[SETTINGS] Error checking token balance:",s),u("Error checking token balance");return}_(s=>({...s,features:{...s.features,[o]:!s.features[o]}}))},ao=async()=>{var o,a,s,r,h,i;console.log("[SETTINGS] ===== SAVE SETTINGS CALLED ====="),console.log("[SETTINGS] Current settings:",t),ge(!0);try{await g(`/api/ai-discovery/settings?shop=${n}`,{method:"POST",body:{shop:n,bots:t.bots,features:t.features,richAttributes:t.richAttributes}}),Ge(!1),de(t),ee();const d=y(t==null?void 0:t.plan),m=["growth_extra","growth extra","enterprise"],l=["professional_plus","professional plus","growth_plus","growth plus"],x=((o=t==null?void 0:t.tokenBalance)==null?void 0:o.available)||0,I=l.includes(d),p=m.includes(d),Oe=x>0;if(console.log("[SETTINGS] ===== AI SITEMAP REGENERATION CHECK ====="),console.log("[SETTINGS] settings.features?.aiSitemap:",(a=t.features)==null?void 0:a.aiSitemap),console.log("[SETTINGS] normalizedPlan:",d),console.log("[SETTINGS] isPlusPlan:",I),console.log("[SETTINGS] hasUnlimitedAccess:",p),console.log("[SETTINGS] currentTokenBalance:",x),console.log("[SETTINGS] hasTokens:",Oe),console.log("[SETTINGS] ===== END AI SITEMAP CHECK ====="),(s=t.features)!=null&&s.aiSitemap){if(!p&&!I){console.log("[SETTINGS] ‚ö†Ô∏è AI Sitemap requires Growth Extra+ or Plus plan"),u("AI-Optimized Sitemap requires Growth Extra+ or Plus plan");return}if(I&&!Oe){console.log("[SETTINGS] ‚ö†Ô∏è Plus plan needs tokens for AI Sitemap"),q({feature:"ai-sitemap-optimized",tokensRequired:3e3,tokensAvailable:x,tokensNeeded:3e3}),z(!0);return}try{const U=`
            mutation RegenerateSitemap($shop: String!) {
              regenerateSitemap(shop: $shop) {
                success
                message
                shop
              }
            }
          `;console.log("[SETTINGS] GraphQL mutation:",U),console.log("[SETTINGS] Variables:",{shop:n});const P=await g("/graphql",{method:"POST",body:JSON.stringify({query:U,variables:{shop:n}}),shop:n});console.log("[SETTINGS] GraphQL sitemap regeneration result:",P),(h=(r=P==null?void 0:P.data)==null?void 0:r.regenerateSitemap)!=null&&h.success?(console.log("[SETTINGS] Background regeneration started successfully"),console.log("[SETTINGS] Setting toast for AI sitemap regeneration with delay..."),u(""),setTimeout(()=>{u("Settings saved! AI-Optimized Sitemap is being regenerated in the background. This may take a few moments."),console.log("[SETTINGS] Success toast set after delay"),oo()},100)):(console.log("[SETTINGS] Background regeneration failed:",(i=P==null?void 0:P.data)==null?void 0:i.regenerateSitemap),console.log("[SETTINGS] Setting toast for failed regeneration..."),u(""),setTimeout(()=>{u("Settings saved, but sitemap regeneration failed"),console.log("[SETTINGS] Error toast set after delay")},100)),console.log("[SETTINGS] ===== AI SITEMAP BACKGROUND REGENERATION END =====")}catch(U){console.error("[SETTINGS] Failed to start sitemap regeneration:",U),u("Settings saved, but sitemap regeneration failed")}}else console.log("[SETTINGS] AI Sitemap disabled, skipping background regeneration"),console.log("[SETTINGS] Setting toast for basic save with delay..."),u(""),setTimeout(()=>{const U=Object.values((t==null?void 0:t.bots)||{}).some(P=>P.enabled);u(U?"Settings saved! Scroll down to configure robots.txt (REQUIRED for AI Discovery).":"Settings saved successfully"),console.log("[SETTINGS] Basic success toast set after delay"),console.log("[SETTINGS] Basic save completed, not showing View buttons")},100)}catch(d){console.error("Failed to save settings:",d),u("Failed to save settings")}finally{ge(!1)}},ke=o=>{var r;const a=y(t==null?void 0:t.plan);return((r={productsJson:["starter","professional","professional_plus","growth","growth_plus","growth_extra","enterprise"],storeMetadata:["professional","professional_plus","growth","growth_plus","growth_extra","enterprise"],welcomePage:["professional_plus","growth","growth_plus","growth_extra","enterprise"],collectionsJson:["professional_plus","growth","growth_plus","growth_extra","enterprise"],aiSitemap:["professional_plus","growth_plus","growth_extra","enterprise"],schemaData:["professional_plus","growth_plus","enterprise"]}[o])==null?void 0:r.includes(a))||!1},no=o=>{var r;const a=y(t==null?void 0:t.plan);return((r={storeMetadata:{starter:"Available in Professional or higher"},welcomePage:{starter:"Available in Professional Plus (pay-per-use tokens) or Growth+",professional:"Available in Professional Plus (pay-per-use tokens) or Growth+"},collectionsJson:{starter:"Available in Professional Plus (pay-per-use tokens) or Growth+",professional:"Available in Professional Plus (pay-per-use tokens) or Growth+"},aiSitemap:{starter:"Available in Professional Plus (pay-per-use tokens) or Growth Extra+",professional:"Available in Professional Plus (pay-per-use tokens) or Growth Extra+",growth:"Available in Growth Plus (pay-per-use tokens) or Growth Extra+"},schemaData:{starter:"Available in Professional Plus (pay-per-use tokens), Growth Plus (pay-per-use tokens) or Enterprise",professional:"Available in Professional Plus (pay-per-use tokens), Growth Plus (pay-per-use tokens) or Enterprise",growth:"Available in Growth Plus (pay-per-use tokens) or Enterprise",growth_extra:"Available in Enterprise"}}[o])==null?void 0:r[a])||"Upgrade to enable this feature"},De=o=>{var r;const a=y(t==null?void 0:t.plan);return((r={professional_plus:["welcomePage","collectionsJson","aiSitemap","schemaData"],growth_plus:["aiSitemap","schemaData"]}[a])==null?void 0:r.includes(o))||!1},Me=async o=>{if(!De(o))return!0;try{const a=await g(`/api/billing/tokens/balance?shop=${n}`);return a.balance<=0?(q({feature:{aiSitemap:"ai-sitemap-optimized",schemaData:"ai-schema-advanced",welcomePage:"ai-welcome-page",collectionsJson:"ai-collections-json",storeMetadata:"ai-store-metadata"}[o]||o,tokensRequired:1e3,tokensAvailable:a.balance||0,tokensNeeded:1e3}),z(!0),!1):!0}catch(a){return console.error("[SETTINGS] Error checking token balance:",a),u("Error checking token balance"),!1}},J=async(o,a)=>{var r,h,i,d,m,l;if(await Me(o)){Ye(a),ce(!0),we(!0),O(null);try{const x={productsJson:`/ai/products.json?shop=${n}`,collectionsJson:`/ai/collections-feed.json?shop=${n}`,storeMetadata:`/ai/store-metadata.json?shop=${n}`,schemaData:`/ai/schema-data.json?shop=${n}`,aiSitemap:`/api/sitemap/generate?shop=${n}&force=true`,welcomePage:`/ai/welcome?shop=${n}`};if(o==="aiSitemap"){console.log("[SETTINGS] Loading AI Sitemap XML...");const I=await fetch(x[o],{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${((i=(h=(r=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:r.getState())==null?void 0:h.session)==null?void 0:i.token)||""}`}});if(I.ok){console.log("[SETTINGS] AI Sitemap XML loaded successfully");const p=await I.text();O(p)}else throw new Error(`HTTP ${I.status}: ${I.statusText}`)}else if(o==="welcomePage"){console.log("[SETTINGS] Loading AI Welcome Page HTML...");const I=await fetch(x[o],{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${((l=(m=(d=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:d.getState())==null?void 0:m.session)==null?void 0:l.token)||""}`}});if(I.ok){console.log("[SETTINGS] AI Welcome Page HTML loaded successfully");const p=await I.text();O(p)}else throw new Error(`HTTP ${I.status}: ${I.statusText}`)}else{const I=await g(x[o]);O(JSON.stringify(I,null,2))}}catch(x){console.error("[SETTINGS] Error loading data:",x),O(`Error loading data: ${x.message}`)}finally{we(!1)}}};c.useEffect(()=>{console.log("[SETTINGS] showViewButtons state changed to:",fe)},[fe]),c.useEffect(()=>{console.log("[SETTINGS] Resetting showViewButtons on component mount"),ze(!1),console.log("[SETTINGS] Resetting schema generation states on component mount"),f(!1),A(!1),console.log("[SETTINGS] Resetting refs to prevent infinite loops"),G.current=!1,N.current=0},[]),console.log("[SETTINGS] Creating checkGeneratedData useEffect..."),console.log("[SETTINGS] Current settings:",t),console.log("[SETTINGS] Current settings features:",t==null?void 0:t.features),c.useEffect(()=>{console.log("[SETTINGS DEBUG] ===== useEffect TRIGGERED ====="),console.log("[SETTINGS DEBUG] Settings:",t),console.log("[SETTINGS DEBUG] Settings features:",t==null?void 0:t.features),console.log("[SETTINGS DEBUG] Shop:",n),console.log("[SETTINGS DEBUG] Conditions check:"),console.log("[SETTINGS DEBUG] - settings?.features exists:",!!(t!=null&&t.features)),console.log("[SETTINGS DEBUG] - shop exists:",!!n),console.log("[SETTINGS DEBUG] - Both conditions met:",!!(t!=null&&t.features&&n)),t!=null&&t.features&&n?(console.log("[SETTINGS] Checking for generated data..."),X()):console.log("[SETTINGS] Skipping checkGeneratedData - conditions not met")},[t==null?void 0:t.features,n,X]),console.log("[SETTINGS] checkGeneratedData useEffect created successfully"),c.useEffect(()=>{console.log("[SETTINGS] ===== FORCE CHECK ON MOUNT ====="),console.log("[SETTINGS] Shop:",n),console.log("[SETTINGS] Settings:",t),console.log("[SETTINGS] Settings features:",t==null?void 0:t.features),console.log("[SETTINGS] checkGeneratedData function:",typeof X),console.log("[SETTINGS] isGeneratingRef.current:",G.current),G.current&&!k&&(console.log("[SETTINGS] ‚ö†Ô∏è Found stale generating state, resetting..."),G.current=!1,N.current=0),n&&(t!=null&&t.features)?(console.log("[SETTINGS] Both shop and settings available, calling checkGeneratedData..."),X()):(console.log("[SETTINGS] Missing shop or settings, skipping checkGeneratedData"),console.log("[SETTINGS] - shop exists:",!!n),console.log("[SETTINGS] - settings?.features exists:",!!(t!=null&&t.features)))},[]);try{return n?He?e.jsx(M,{children:e.jsx(E,{padding:"400",children:e.jsxs(w,{align:"center",children:[e.jsx(Be,{size:"small"}),e.jsx(S,{children:"Loading settings..."})]})})}):e.jsxs(T,{gap:"600",children:[e.jsx(M,{children:e.jsx(E,{padding:"400",children:e.jsxs(T,{gap:"400",children:[e.jsxs(w,{align:"space-between",children:[e.jsx(S,{as:"h2",variant:"headingMd",children:"AI Bot Access Control"}),(t==null?void 0:t.plan)&&e.jsxs(H,{tone:"info",children:[t.plan.charAt(0).toUpperCase()+t.plan.slice(1)," Plan"]})]}),e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Choose which AI bots can access your store's structured data"}),e.jsx(C,{status:"info",children:e.jsxs(T,{gap:"200",children:[e.jsx(S,{variant:"bodyMd",fontWeight:"semibold",children:"How it works:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginBottom:0},children:[e.jsx("li",{children:"Select AI bots below"}),e.jsx("li",{children:"Configure AI Discovery Features below"}),e.jsx("li",{children:'Click "Save Settings" at the bottom'}),e.jsx("li",{children:"Configure robots.txt (instructions will appear)"})]})]})}),e.jsx(he,{}),e.jsxs(T,{gap:"300",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["meta","anthropic"].map(o=>{var m,l,x;const a=(m=t==null?void 0:t.bots)==null?void 0:m[o];if(!a)return null;const s={starter:["meta","anthropic"],professional:["meta","anthropic","google"],growth:["meta","anthropic","google","openai"],growth_extra:["meta","anthropic","google","openai","perplexity"],enterprise:["meta","anthropic","google","openai","perplexity","others"]},r=y(t==null?void 0:t.plan),i=(s[r]||s.starter).includes(o),d=o==="google"?"Professional":o==="openai"?"Growth":o==="perplexity"?"Growth Extra":o==="others"?"Enterprise":null;return e.jsx(E,{padding:"200",background:i?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(T,{gap:"100",children:e.jsx(L,{label:e.jsxs(w,{gap:"200",align:"center",children:[e.jsx(S,{variant:i?"bodyMd":"bodySm",tone:i?"base":"subdued",children:a.name||o}),!i&&d&&e.jsxs(H,{tone:"info",size:"small",children:[d,"+"]})]}),checked:!!((x=(l=t==null?void 0:t.bots)==null?void 0:l[o])!=null&&x.enabled),onChange:()=>Se(o),disabled:!i,helpText:i?o==="meta"?"Meta AI platforms":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="openai"?"ChatGPT":o==="perplexity"?"AI-powered search":o==="others"?"Deepseek, Bytespider & others":"":`Upgrade to ${d} plan to enable this AI bot`})})},o)})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["google","openai"].map(o=>{var h,i,d,m;const a=(h=t==null?void 0:t.bots)==null?void 0:h[o];if(!a)return null;const s=(i=t==null?void 0:t.availableBots)==null?void 0:i.includes(o),r=o==="google"?"Professional":o==="openai"?"Growth":o==="perplexity"?"Growth Extra":o==="others"?"Enterprise":null;return e.jsx(E,{padding:"200",background:s?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(T,{gap:"100",children:e.jsx(L,{label:e.jsxs(w,{gap:"200",align:"center",children:[e.jsx(S,{variant:s?"bodyMd":"bodySm",tone:s?"base":"subdued",children:a.name||o}),!s&&r&&e.jsxs(H,{tone:"info",size:"small",children:[r,"+"]})]}),checked:!!((m=(d=t==null?void 0:t.bots)==null?void 0:d[o])!=null&&m.enabled),onChange:()=>Se(o),disabled:!s,helpText:s?o==="meta"?"Meta AI platforms":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="openai"?"ChatGPT":o==="perplexity"?"AI-powered search":o==="others"?"Deepseek, Bytespider & others":"":`Upgrade to ${r} plan to enable this AI bot`})})},o)})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["perplexity","others"].map(o=>{var h,i,d,m;const a=(h=t==null?void 0:t.bots)==null?void 0:h[o];if(!a)return null;const s=(i=t==null?void 0:t.availableBots)==null?void 0:i.includes(o),r=o==="google"?"Professional":o==="openai"?"Growth":o==="perplexity"?"Growth Extra":o==="others"?"Enterprise":null;return e.jsx(E,{padding:"200",background:s?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(T,{gap:"100",children:e.jsx(L,{label:e.jsxs(w,{gap:"200",align:"center",children:[e.jsx(S,{variant:s?"bodyMd":"bodySm",tone:s?"base":"subdued",children:a.name||o}),!s&&r&&e.jsxs(H,{tone:"info",size:"small",children:[r,"+"]})]}),checked:!!((m=(d=t==null?void 0:t.bots)==null?void 0:d[o])!=null&&m.enabled),onChange:()=>Se(o),disabled:!s,helpText:s?o==="meta"?"Meta AI platforms":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="openai"?"ChatGPT":o==="perplexity"?"AI-powered search":o==="others"?"Deepseek, Bytespider & others":"":`Upgrade to ${r} plan to enable this AI bot`})})},o)})})]})]})})}),e.jsx(M,{children:e.jsx(E,{padding:"400",children:e.jsxs(T,{gap:"400",children:[e.jsx(S,{as:"h2",variant:"headingMd",children:"AI Discovery Features"}),e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Select the features you want to enable for AI bots to consume your store data."}),e.jsx(C,{status:"info",children:`Don't forget to click "Save Settings" after making changes.`}),e.jsx(he,{}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1rem"},children:[{key:"productsJson",name:"Products JSON Feed",description:"Bulk product data for AI consumption",requiredPlan:"Starter"},{key:"storeMetadata",name:"Store Metadata for AI Search",description:"Organization schema & AI metadata",requiredPlan:"Professional"},{key:"welcomePage",name:"AI Welcome Page",description:"Landing page for AI bots",requiredPlan:"Growth"},{key:"collectionsJson",name:"Collections JSON Feed",description:"Category data for better AI understanding",requiredPlan:"Growth"},{key:"aiSitemap",name:"AI-Optimized Sitemap",description:"Enhanced sitemap with AI hints",requiredPlan:"Growth Extra"},{key:"schemaData",name:"Advanced Schema Data",description:"BreadcrumbList, FAQPage & more",requiredPlan:"Enterprise"}].map(o=>{var r,h;const a=ke(o.key),s=!!((r=t==null?void 0:t.features)!=null&&r[o.key]);return console.log(`[SETTINGS DEBUG] Feature ${o.key}:`,{isAvailable:a,isEnabled:s,rawValue:(h=t==null?void 0:t.features)==null?void 0:h[o.key],plan:t==null?void 0:t.plan,normalizedPlan:y(t==null?void 0:t.plan)}),e.jsx(E,{padding:"200",background:a?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:a?e.jsxs(w,{align:"space-between",blockAlign:"center",children:[e.jsx(E,{flexGrow:1,children:e.jsx(L,{label:o.name,checked:s,onChange:()=>Pe(o.key),helpText:o.description})}),o.key==="aiSitemap"&&qe&&e.jsx(j,{size:"slim",onClick:()=>J(o.key,o.name),children:"View"}),o.key==="productsJson"&&(console.log("[SETTINGS DEBUG] Products JSON button check:"),console.log("[SETTINGS DEBUG] - feature.key === productsJson:",o.key==="productsJson"),console.log("[SETTINGS DEBUG] - showProductsJsonView:",ae),console.log("[SETTINGS DEBUG] - Should show button:",o.key==="productsJson"&&ae),o.key==="productsJson"&&ae)&&e.jsx(j,{size:"slim",onClick:()=>J(o.key,o.name),children:"View"}),o.key==="collectionsJson"&&(console.log("[SETTINGS DEBUG] Collections JSON button check:"),console.log("[SETTINGS DEBUG] - feature.key === collectionsJson:",o.key==="collectionsJson"),console.log("[SETTINGS DEBUG] - showCollectionsJsonView:",ne),console.log("[SETTINGS DEBUG] - Should show button:",o.key==="collectionsJson"&&ne),o.key==="collectionsJson"&&ne)&&e.jsx(j,{size:"slim",onClick:()=>J(o.key,o.name),children:"View"}),o.key==="storeMetadata"&&(console.log("[SETTINGS DEBUG] ===== STORE METADATA BUTTON RENDER ====="),console.log("[SETTINGS DEBUG] feature.key === storeMetadata:",o.key==="storeMetadata"),console.log("[SETTINGS DEBUG] isEnabled:",s),console.log("[SETTINGS DEBUG] showStoreMetadataView:",re),console.log("[SETTINGS DEBUG] Should show button:",o.key==="storeMetadata"&&s),console.log("[SETTINGS DEBUG] Button type:",re?"View":"Configure"),console.log("[SETTINGS DEBUG] ===== END STORE METADATA BUTTON DEBUG ====="),o.key==="storeMetadata"&&s)&&(re?e.jsx(j,{size:"slim",onClick:()=>J(o.key,o.name),children:"View"}):e.jsx(j,{size:"slim",variant:"primary",onClick:async()=>{if(console.log("[SETTINGS DEBUG] Configure button clicked!"),!await Me("storeMetadata"))return;const d=`/ai-seo/store-metadata?shop=${n}`;console.log("[SETTINGS DEBUG] Opening URL:",d),window.open(d,"_blank")},children:"Configure"})),o.key==="welcomePage"&&Ve&&e.jsx(j,{size:"slim",onClick:()=>J(o.key,o.name),children:"View"})]}):e.jsx(L,{label:e.jsxs(w,{gap:"200",align:"center",children:[e.jsx(S,{variant:"bodySm",tone:"subdued",children:o.name}),o.requiredPlan&&e.jsxs(H,{tone:"info",size:"small",children:[o.requiredPlan,o.requiredPlan!=="Enterprise"&&"+"]})]}),checked:!1,onChange:()=>Pe(o.key),disabled:!0,helpText:no(o.key)})},o.key)})})]})})}),(()=>{var i,d;const o=y(t==null?void 0:t.plan),s=["professional_plus","growth_plus","enterprise"].includes(o),r=(i=t==null?void 0:t.features)==null?void 0:i.schemaData,h=(d=ie==null?void 0:ie.features)==null?void 0:d.schemaData;return console.log("[SCHEMA-DEBUG] Advanced Schema Management visibility check:"),console.log("[SCHEMA-DEBUG] - Plan:",o),console.log("[SCHEMA-DEBUG] - Plan check (Plus/Enterprise):",s),console.log("[SCHEMA-DEBUG] - Settings schemaData:",r),console.log("[SCHEMA-DEBUG] - Original schemaData:",h),console.log("[SCHEMA-DEBUG] - All conditions met:",s&&r&&h),s&&r&&h})()&&e.jsx(M,{children:e.jsx(E,{padding:"400",children:e.jsxs(T,{gap:"400",children:[e.jsx(S,{as:"h2",variant:"headingMd",children:"Advanced Schema Data Management"}),e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Generate and manage structured data for your products"}),e.jsxs(w,{gap:"300",children:[e.jsx(j,{primary:!0,onClick:async()=>{if(console.log("[SCHEMA-GEN] Button clicked!"),G.current){console.log("[SCHEMA-GEN] Already generating, ignoring click");return}try{console.log("[SCHEMA-GEN] Checking for existing data...");const o=await g(`/ai/schema-data.json?shop=${n}`);if(console.log("[SCHEMA-GEN] Existing data:",o),o.schemas&&o.schemas.length>0&&(console.log("[SCHEMA-GEN] Found existing schemas, asking for confirmation..."),!confirm("This will replace existing schema data. Continue?"))){console.log("[SCHEMA-GEN] User cancelled");return}console.log("[SCHEMA-GEN] Starting generation..."),console.log("[SCHEMA-GEN] ‚ö†Ô∏è BEFORE setState - schemaGenerating:",k),G.current=!0,N.current=0,console.log("[SCHEMA-GEN] üîµ Set isGeneratingRef.current = true"),f(!0),console.log("[SCHEMA-GEN] üîµ Set schemaGenerating state = true"),A(!1),W({current:0,total:0,percent:10,currentProduct:"Initializing...",stats:{siteFAQ:!1,products:0,totalSchemas:0}}),console.log("[SCHEMA-GEN] ‚úÖ AFTER setState - should be true now"),console.log("[SCHEMA-GEN] About to call api() function..."),console.log("[SCHEMA-GEN] api function exists:",typeof g),console.log("[SCHEMA-GEN] shop value:",n),console.log("[SCHEMA-GEN] Calling POST /api/schema/generate-all...");let a;try{a=await g(`/api/schema/generate-all?shop=${n}`,{method:"POST",shop:n,body:{shop:n}}),console.log("[SCHEMA-GEN] ‚úÖ API call successful!")}catch(s){if(console.error("[SCHEMA-GEN] ‚ùå API call failed:",s),console.error("[SCHEMA-GEN] ‚ùå API error message:",s.message),console.error("[SCHEMA-GEN] ‚ùå Full error object:",s),s.requiresPurchase){console.log("[SCHEMA-GEN] üí∞ Insufficient tokens - showing modal"),q({feature:s.feature||"ai-schema-advanced",tokensRequired:s.tokensRequired||0,tokensAvailable:s.tokensAvailable||0,tokensNeeded:s.tokensNeeded||0,needsUpgrade:s.needsUpgrade||!1,currentPlan:s.currentPlan||"",minimumPlanForFeature:s.minimumPlanForFeature||null}),z(!0),f(!1);return}throw s}console.log("[SCHEMA-GEN] POST response:",a),console.log("[SCHEMA-GEN] üïê Scheduling progress check in 2 seconds..."),console.log("[SCHEMA-GEN] üïê Current schemaGenerating value:",k),setTimeout(()=>{console.log("[SCHEMA-GEN] ‚è∞ setTimeout fired! Calling checkGenerationProgress..."),Z()},3e3)}catch(o){console.error("[SCHEMA-GEN] Error:",o),u("Failed to generate schema: "+(o.message||"Unknown error")),f(!1)}},children:"Generate/Update Schema Data"}),e.jsx(j,{onClick:()=>{window.open(`/ai/schema-data.json?shop=${n}`,"_blank")},children:"View Generated Schema"}),e.jsx(j,{destructive:!0,onClick:async()=>{if(confirm("This will delete all advanced schema data. Are you sure?"))try{await g(`/api/schema/delete?shop=${n}`,{method:"DELETE",shop:n,body:{shop:n}}),u("Schema data deleted successfully")}catch{u("Failed to delete schema data")}},children:"Delete Schema Data"})]}),e.jsx(M,{children:e.jsx(E,{padding:"300",children:e.jsxs(T,{gap:"300",children:[e.jsx(S,{as:"h3",variant:"headingSm",children:"Rich Product Attributes"}),e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Select which AI-generated attributes to include in product schemas"}),e.jsx(lo,{columns:2,gap:"400",children:[{key:"material",label:"Material",description:"Product material (cotton, leather, metal, etc.)"},{key:"color",label:"Color",description:"Product color information"},{key:"size",label:"Size",description:"Product size or dimensions"},{key:"weight",label:"Weight",description:"Product weight information"},{key:"dimensions",label:"Dimensions",description:"Product measurements"},{key:"category",label:"Category",description:"Product category classification"},{key:"audience",label:"Target Audience",description:"Intended user group (men, women, kids, etc.)"},{key:"reviews",label:"Review Schemas",description:"AI-generated product reviews for schema.org"},{key:"ratings",label:"Rating Schemas",description:"AI-generated ratings and aggregate ratings"},{key:"enhancedDescription",label:"Enhanced Descriptions",description:"AI-enhanced product descriptions"},{key:"organization",label:"Organization Schema",description:"Brand organization information"}].map(o=>{var a;return e.jsx(L,{label:o.label,helpText:o.description,checked:((a=t==null?void 0:t.richAttributes)==null?void 0:a[o.key])||!1,onChange:s=>{_(r=>({...r,richAttributes:{...r.richAttributes,[o.key]:s}}))}},o.key)})})]})})}),e.jsx(C,{status:"info",tone:"subdued",children:e.jsx("p",{children:"Generation creates BreadcrumbList, FAQPage, WebPage and more schemas for each product. These structured schemas help AI bots understand your product hierarchy, answer customer questions automatically, and improve your store's visibility in AI-powered search results."})})]})})}),e.jsxs(w,{gap:"200",align:"end",children:[e.jsx(j,{tone:"critical",onClick:async()=>{if(window.confirm("Are you sure you want to reset all AI Discovery settings to defaults?"))try{await g(`/api/ai-discovery/settings?shop=${n}`,{method:"DELETE",shop:n}),u("Settings reset successfully"),de(null),setTimeout(()=>{window.location.reload()},1e3)}catch(o){console.error("Failed to reset:",o),u("Failed to reset settings")}},children:"Reset to Defaults"}),e.jsx(j,{primary:!0,size:"large",loading:Le,onClick:ao,disabled:!t,children:"Save Settings"})]}),!Ke&&Object.values((t==null?void 0:t.bots)||{}).some(o=>o.enabled)&&e.jsx(M,{children:e.jsx(E,{padding:"400",children:e.jsxs(T,{gap:"400",children:[e.jsxs(w,{align:"space-between",children:[e.jsx(S,{as:"h2",variant:"headingMd",children:"üìã robots.txt Configuration"}),e.jsx(H,{tone:"critical",children:"REQUIRED"})]}),e.jsx(C,{status:"critical",title:"‚ö†Ô∏è IMPORTANT: AI Discovery will NOT work without this step!",children:e.jsxs(T,{gap:"300",children:[e.jsx("p",{children:e.jsx("strong",{children:"Your AI bot settings are saved, but they can't access your store yet."})}),e.jsx("p",{children:"You must manually add robots.txt to your theme for AI bots to discover your products."}),e.jsx("p",{children:"Click the button below to see your custom robots.txt code and installation instructions."})]})}),e.jsx(j,{primary:!0,size:"large",onClick:async()=>{console.log("[GENERATE ROBOTS] Starting..."),console.log("[GENERATE ROBOTS] Settings:",t);try{const o=Object.values((t==null?void 0:t.bots)||{}).some(a=>a.enabled);console.log("[GENERATE ROBOTS] Has selected bots:",o),o?(console.log("[GENERATE ROBOTS] Calling generateRobotsTxt..."),await ee(),console.log("[GENERATE ROBOTS] Robots.txt generated, showing modal"),te(!0)):(console.log("[GENERATE ROBOTS] No bots, showing modal"),le(!0))}catch(o){console.error("[GENERATE ROBOTS] Error:",o),u("Error generating robots.txt: "+o.message)}},children:"üìã View & Copy robots.txt Code"}),e.jsx(he,{}),e.jsxs(T,{gap:"300",children:[e.jsx(S,{variant:"headingMd",children:"Installation Instructions:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px",lineHeight:"1.8"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Generate & Copy:"})," Click the button above to see your custom robots.txt code, then copy it"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Open Theme Editor:"})," Go to ",e.jsx("strong",{children:"Online Store ‚Üí Themes"})," in Shopify admin"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Edit Code:"})," Click ",e.jsx("strong",{children:"Actions ‚Üí Edit code"})," on your active theme"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Create New File:"})," In the left sidebar, click ",e.jsx("strong",{children:"Add a new file"})," (top right corner)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Select Location:"})," Choose ",e.jsx("strong",{children:'"Create a new template"'})," from the dropdown"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Name the File:"})," Select template type ",e.jsx("strong",{children:'"robots"'})," and it will automatically create ",e.jsx("code",{children:"templates/robots.txt.liquid"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Paste Content:"})," Delete any existing content and paste your copied robots.txt code"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Save:"})," Click the green ",e.jsx("strong",{children:"Save"})," button (top right)"]})]}),e.jsxs(C,{tone:"info",children:[e.jsx("p",{children:e.jsx("strong",{children:`üìç Can't find "Create a new template"?`})}),e.jsxs("p",{children:["Alternative method: Click ",e.jsx("strong",{children:"Add a new file"}),", then manually type: ",e.jsx("code",{children:"templates/robots.txt.liquid"})," and click Create file."]})]})]}),e.jsx(C,{status:"info",children:e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:"Why this matters:"})," The robots.txt file tells AI bots (OpenAI, Anthropic, Google, etc.) which pages and endpoints they can access to properly understand and index your products for AI search results and recommendations."]})})]})})}),Ee&&e.jsx(b,{open:Ee,onClose:()=>te(!1),title:"robots.txt Configuration",primaryAction:{content:"Copy to clipboard",onAction:()=>{navigator.clipboard.writeText(pe),u("Copied to clipboard!")}},secondaryActions:[{content:"Close",onAction:()=>te(!1)}],children:e.jsx(b.Section,{children:e.jsxs(T,{gap:"400",children:[!["growth","growth_extra","enterprise"].includes(y(t==null?void 0:t.plan))&&e.jsx(C,{status:"info",title:"Manual Configuration Steps",children:e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:"Copy the robots.txt content below"}),e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Online Store ‚Üí Themes"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Actions ‚Üí Edit code"})," on your active theme"]}),e.jsxs("li",{children:["In the file browser, look for ",e.jsx("strong",{children:"robots.txt.liquid"})]}),e.jsxs("li",{children:["If it doesn't exist, click ",e.jsx("strong",{children:"Add a new template"}),' ‚Üí Select "robots" ‚Üí Create']}),e.jsx("li",{children:"Replace the content with what you copied"}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Save"})]})]})}),e.jsx(E,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:pe})})]})})}),xe&&e.jsx(b,{open:xe,onClose:()=>le(!1),title:"No AI Bots Selected",primaryAction:{content:"Got it",onAction:()=>le(!1)},children:e.jsx(b.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsx(C,{status:"warning",children:e.jsx("p",{children:"You haven't selected any AI bots yet."})}),e.jsx(S,{children:"To configure robots.txt:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:'Select AI bots from the "AI Bot Access Control" section above'}),e.jsx("li",{children:'Click "Save Settings" to save your selections'}),e.jsx("li",{children:'Then click "Generate robots.txt" to configure'})]})]})})}),Ie&&e.jsx(b,{open:Ie,onClose:()=>{ce(!1),O(null)},title:be,primaryAction:{content:"Copy",onAction:()=>{navigator.clipboard.writeText(Ne),u("Copied to clipboard!")},disabled:Ae},secondaryActions:[{content:"Close",onAction:()=>{ce(!1),O(null)}}],children:e.jsx(b.Section,{children:e.jsx(E,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:Ae?e.jsxs(w,{align:"center",gap:"200",children:[e.jsx(Be,{size:"small"}),e.jsx(S,{variant:"bodyMd",children:be==="AI-Optimized Sitemap"?"Loading sitemap XML... This may take a moment for large stores.":"Loading..."})]}):e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:Ne})})})}),Ue("Modal states",{schemaGenerating:k,schemaComplete:R,modalShouldShow:k&&!R}),k&&!R&&e.jsx(b,{open:k,title:"Generating Advanced Schema Data",onClose:()=>{console.log("[SCHEMA-MODAL] ‚ùå Close button clicked"),G.current=!1,f(!1),A(!1),console.log("[SCHEMA-MODAL] States and ref reset to false")},children:e.jsx(b.Section,{children:e.jsxs(S,{children:["Modal is showing! Progress: ",D.percent,"%"]})})}),R&&e.jsx(b,{open:!0,title:"Schema Generation Complete",onClose:()=>{f(!1),A(!1)},primaryAction:{content:"View Generated Schemas",onAction:()=>{window.open(`/ai/schema-data.json?shop=${n}`,"_blank"),f(!1),A(!1)}},secondaryActions:[{content:"Close",onAction:()=>{f(!1),A(!1)}}],children:e.jsx(b.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsx(C,{status:"success",title:"Generation successful!",children:e.jsx("p",{children:"Advanced schema data has been generated for your products."})}),e.jsx(S,{variant:"headingMd",children:"Generation Statistics"}),e.jsxs(w,{gap:"600",wrap:!0,children:[e.jsxs(E,{children:[e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Site FAQ"}),e.jsx(S,{variant:"headingLg",fontWeight:"bold",children:D.stats.siteFAQ?"‚úì":"‚Äî"})]}),e.jsxs(E,{children:[e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Products Processed"}),e.jsx(S,{variant:"headingLg",fontWeight:"bold",children:D.stats.products})]}),e.jsxs(E,{children:[e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Total Schemas"}),e.jsx(S,{variant:"headingLg",fontWeight:"bold",children:D.stats.totalSchemas})]})]}),e.jsx(E,{paddingBlockStart:"200",children:e.jsx(S,{variant:"bodySm",tone:"subdued",children:"Structured schemas are now generated and help AI bots better understand your products."})})]})})}),k&&!R&&e.jsx(b,{open:!0,title:"Generating Advanced Schema Data",onClose:()=>{console.log("[SCHEMA-MODAL] Closing modal..."),G.current=!1,N.current=0,f(!1),A(!1)},noScroll:!0,children:e.jsx(b.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsx(S,{variant:"bodyMd",children:"Generating schemas for your products..."}),e.jsx(co,{progress:D.percent,size:"small"}),e.jsx(S,{variant:"bodySm",tone:"subdued",children:"This process may take 1-2 minutes depending on the number of products."})]})})}),R&&e.jsx(b,{open:!0,title:"Schema Generation Complete",onClose:()=>{f(!1),A(!1)},primaryAction:{content:"View Generated Schemas",onAction:()=>{window.open(`/ai/schema-data.json?shop=${n}`,"_blank"),f(!1),A(!1)}},secondaryActions:[{content:"Close",onAction:()=>{f(!1),A(!1)}}],children:e.jsx(b.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsx(C,{status:"success",title:"Generation successful!",children:e.jsx("p",{children:"Advanced schema data has been generated for your products."})}),e.jsx(S,{variant:"headingMd",children:"Generation Statistics"}),e.jsxs(w,{gap:"600",wrap:!0,children:[e.jsxs(E,{children:[e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Site FAQ"}),e.jsx(S,{variant:"headingLg",fontWeight:"bold",children:D.stats.siteFAQ?"‚úì":"‚Äî"})]}),e.jsxs(E,{children:[e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Products Processed"}),e.jsx(S,{variant:"headingLg",fontWeight:"bold",children:D.stats.products})]}),e.jsxs(E,{children:[e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Total Schemas"}),e.jsx(S,{variant:"headingLg",fontWeight:"bold",children:D.stats.totalSchemas})]})]}),e.jsx(E,{paddingBlockStart:"200",children:e.jsx(S,{variant:"bodySm",tone:"subdued",children:"Structured schemas are now generated and help AI bots better understand your products."})})]})})}),je&&ye==="NO_OPTIMIZED_PRODUCTS"&&e.jsx(b,{open:!0,title:"No Optimized Products Found",onClose:()=>{v(!1),B(null)},primaryAction:{content:"Go to Search Optimization",onAction:()=>{v(!1),B(null);const o=new URLSearchParams(window.location.search),a=o.toString()?`?${o.toString()}`:"";window.location.href=`/ai-seo${a}`}},secondaryActions:[{content:"Cancel",onAction:()=>{v(!1),B(null)}}],children:e.jsx(b.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsx(C,{status:"warning",children:e.jsx("p",{children:"No optimized products were found in your store."})}),e.jsx(S,{children:"Advanced Schema Data requires at least basic AISEO optimization on your products. Please run AISEO optimization first, then try generating schemas again."}),e.jsx(S,{variant:"bodyMd",fontWeight:"semibold",children:"You can choose:"}),e.jsxs(T,{gap:"200",children:[e.jsxs(S,{children:["‚Ä¢ ",e.jsx("strong",{children:"Basic AISEO"})," - Free AISEO optimization"]}),e.jsxs(S,{children:["‚Ä¢ ",e.jsx("strong",{children:"AI-Enhanced AISEO"})," - Advanced optimization (requires tokens)"]})]})]})})}),je&&ye==="ONLY_BASIC_SEO"&&e.jsx(b,{open:!0,title:"AI-Enhanced Optimization Recommended",onClose:()=>{v(!1),B(null)},primaryAction:{content:"Generate AI-Enhanced Add-ons",onAction:()=>{v(!1),B(null);const o=new URLSearchParams(window.location.search),a=o.toString()?`?${o.toString()}`:"";window.location.href=`/ai-seo${a}`}},secondaryActions:[{content:"Proceed with Basic AISEO",onAction:async()=>{v(!1),B(null);try{f(!0),A(!1),G.current=!0,N.current=0,await g(`/api/schema/generate-all?shop=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({forceBasicSeo:!0})}),setTimeout(()=>{Z()},3e3)}catch(o){console.error("[SCHEMA-GEN] Error:",o),u("Failed to generate schema: "+(o.message||"Unknown error")),f(!1)}}}],children:e.jsx(b.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsx(C,{status:"info",children:e.jsx("p",{children:"Only basic AISEO optimization was found on your products."})}),e.jsx(S,{children:"For best results with Advanced Schema Data, we recommend running AI-Enhanced AISEO optimization first. This will provide richer product data for schema generation."}),e.jsx(S,{variant:"bodyMd",fontWeight:"semibold",children:"What would you like to do?"}),e.jsxs(T,{gap:"200",children:[e.jsxs(S,{children:["‚Ä¢ ",e.jsx("strong",{children:"Generate AI-Enhanced Add-ons"})," - Get the best results (requires tokens)"]}),e.jsxs(S,{children:["‚Ä¢ ",e.jsx("strong",{children:"Proceed with Basic AISEO"})," - Continue with current basic AISEO"]})]})]})})}),F&&e.jsx(io,{content:F,onDismiss:()=>u("")}),e.jsx(ro,{open:Ze,onClose:()=>z(!1),feature:$.feature,tokensRequired:$.tokensRequired,tokensAvailable:$.tokensAvailable,tokensNeeded:$.tokensNeeded,shop:n,needsUpgrade:!1,minimumPlan:null,currentPlan:(t==null?void 0:t.plan)||"starter"})]}):e.jsx(M,{children:e.jsx(E,{padding:"400",children:e.jsx(S,{tone:"critical",children:"Missing shop parameter"})})})}catch(o){return console.error("[SETTINGS] Component render error:",o),e.jsx(T,{gap:"400",children:e.jsx(M,{children:e.jsxs(E,{padding:"400",children:[e.jsx(S,{variant:"headingMd",children:"Settings Error"}),e.jsx(E,{paddingBlockStart:"200",children:e.jsxs(S,{children:["Failed to load settings: ",o.message]})})]})})})}}export{bo as default};
