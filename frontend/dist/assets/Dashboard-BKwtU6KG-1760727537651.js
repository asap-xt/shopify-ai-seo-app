import{j as e}from"./app-bridge-BLE6m1rj-1760727537651.js";import{r as l}from"./react-vendor-tAaa2TlE-1760727537651.js";import{m as ne}from"./sessionFetch-CJepNHo3-1760727537651.js";import{L as h,C as p,a as r,T as n,d as ae,e as s,f as O,I as g,B as d,D as y,g as te,h as _,i as ie}from"./polaris-BxYmHmZS-1760727537651.js";const se=(f,x="")=>{try{return new URLSearchParams(window.location.search).get(f)||x}catch{return x}};function le({shop:f}){var W,I,T,R,$,N,F,V;const x=f||se("shop",""),m=l.useMemo(()=>ne(),[]),u=i=>{const o=new URLSearchParams(window.location.search),j=o.toString()?`?${o.toString()}`:"";window.location.href=`${i}${j}`},[G,D]=l.useState(!0),[a,U]=l.useState(null),[t,q]=l.useState(null),[k,Q]=l.useState(null),[c,w]=l.useState(null),[b,M]=l.useState(!1),[Y,P]=l.useState(!1),[S,H]=l.useState(!1);l.useEffect(()=>{E(),J()},[x]),l.useEffect(()=>{c&&c.autoSyncEnabled&&!c.synced&&z()},[c]);const E=async()=>{try{D(!0);const[i,o]=await Promise.all([m.get(`/api/dashboard/stats?shop=${x}`),m.get(`/api/billing/tokens/balance?shop=${x}`)]);if(i.ok&&o.ok){const j=await i.json(),v=await o.json();U(j),q(j.subscription),Q(v)}}catch(i){console.error("[Dashboard] Error loading data:",i)}finally{D(!1)}},J=async()=>{try{const i=await m.get(`/api/dashboard/sync-status?shop=${x}`);if(i.ok){const o=await i.json();w(o),P(o.autoSyncEnabled||!1)}}catch(i){console.error("[Dashboard] Error loading sync status:",i)}},z=async()=>{try{if(M(!0),(await m.post(`/api/dashboard/sync?shop=${x}`,{})).ok){const o=setInterval(async()=>{const j=await m.get(`/api/dashboard/sync-status?shop=${x}`);if(j.ok){const v=await j.json();w(v),v.inProgress||(clearInterval(o),M(!1),E())}},2e3)}}catch(i){console.error("[Dashboard] Error syncing:",i),M(!1)}},K=async i=>{try{(await m.post(`/api/dashboard/auto-sync?shop=${x}`,{enabled:i})).ok&&(P(i),w({...c,autoSyncEnabled:i}))}catch(o){console.error("[Dashboard] Error toggling auto-sync:",o)}},C=((W=a==null?void 0:a.products)==null?void 0:W.total)>0?Math.round(a.products.optimized/a.products.total*100):0,B=((I=a==null?void 0:a.collections)==null?void 0:I.total)>0?Math.round(a.collections.optimized/a.collections.total*100):0,L=["growth","growth_extra","enterprise"].includes(t==null?void 0:t.plan),X=["professional","growth","growth_extra","enterprise"].includes(t==null?void 0:t.plan),Z=(t==null?void 0:t.plan)==="enterprise",ee=["growth_extra","enterprise"].includes(t==null?void 0:t.plan);if(G)return e.jsx(h,{children:e.jsx(h.Section,{children:e.jsx(p,{children:e.jsx(r,{padding:"400",children:e.jsx(n,{children:"Loading dashboard..."})})})})});const A=!(c!=null&&c.synced);return e.jsxs(h,{children:[e.jsx(h.Section,{children:e.jsx(n,{variant:"headingLg",as:"h1",children:"Store Overview"})}),A&&e.jsx(h.Section,{children:e.jsx(ae,{title:"Sync your store",tone:"info",action:{content:b?"Syncing...":"Sync Now",onAction:z,loading:b},children:e.jsxs(s,{gap:"200",children:[e.jsx(n,{children:"Sync products, collections, languages, and markets to get started with AI optimization."}),b&&e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(O,{progress:50,size:"small",tone:"highlight"}),e.jsx(r,{paddingBlockStart:"100",children:e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Fetching store data..."})})]})]})})}),!A&&c&&e.jsx(h.Section,{children:e.jsx(p,{children:e.jsxs(s,{gap:"300",children:[e.jsxs(g,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"Store Sync"}),e.jsx(r,{paddingBlockStart:"050",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["Last synced: ",c.lastSyncDate?new Date(c.lastSyncDate).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"]})})]}),e.jsx(d,{onClick:z,loading:b,children:"Sync Now"})]}),e.jsx(y,{}),e.jsx(te,{label:"Auto-sync on load",checked:Y,onChange:K,helpText:"Automatically sync store data when you open the dashboard"})]})})}),e.jsx(h.Section,{children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"16px"},children:[e.jsx(p,{children:e.jsxs(s,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Products"}),e.jsxs(s,{gap:"200",children:[e.jsxs(g,{align:"space-between",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Total"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:((T=a==null?void 0:a.products)==null?void 0:T.total)||0})]}),e.jsxs(g,{align:"space-between",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Optimized"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:((R=a==null?void 0:a.products)==null?void 0:R.optimized)||0})]}),e.jsx(y,{}),e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(O,{progress:C,size:"small",tone:C===100?"success":"primary"}),e.jsx(r,{paddingBlockStart:"100",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[C,"% optimized"]})})]})]})]})}),L&&e.jsx(p,{children:e.jsxs(s,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Collections"}),e.jsxs(s,{gap:"200",children:[e.jsxs(g,{align:"space-between",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Total"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:(($=a==null?void 0:a.collections)==null?void 0:$.total)||0})]}),e.jsxs(g,{align:"space-between",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Optimized"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:((N=a==null?void 0:a.collections)==null?void 0:N.optimized)||0})]}),e.jsx(y,{}),e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(O,{progress:B,size:"small",tone:B===100?"success":"primary"}),e.jsx(r,{paddingBlockStart:"100",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[B,"% optimized"]})})]})]})]})}),e.jsx(p,{children:e.jsxs(s,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Languages"}),e.jsx(s,{gap:"200",children:a!=null&&a.languages&&a.languages.length>0?e.jsxs(e.Fragment,{children:[a.languages.slice(0,3).map((i,o)=>e.jsxs(g,{align:"space-between",children:[e.jsxs(n,{variant:"bodyMd",tone:"subdued",children:[i.name||i.code," ",i.primary&&"â˜…"]}),e.jsx(_,{tone:i.optimizedCount>0?"success":"subdued",children:i.optimizedCount||0})]},o)),a.languages.length>3&&e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["+",a.languages.length-3," more..."]})]}):e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"No language data"})})]})})]})}),e.jsx(h.Section,{children:e.jsxs(g,{gap:"400",wrap:!0,children:[e.jsx("div",{style:{flex:"1",minWidth:"300px"},children:e.jsx(p,{children:e.jsxs(s,{gap:"300",children:[e.jsx(n,{variant:"headingMd",children:"Last Optimization"}),e.jsx(n,{variant:"bodyLg",fontWeight:"semibold",children:a!=null&&a.lastOptimization?new Date(a.lastOptimization).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}),e.jsx(d,{onClick:()=>u("/ai-seo/products"),children:"Optimize Now"})]})})}),e.jsx("div",{style:{flex:"1",minWidth:"300px"},children:e.jsx(p,{children:e.jsxs(s,{gap:"300",children:[e.jsx(n,{variant:"headingMd",children:"Token Balance"}),e.jsxs(n,{variant:"bodyLg",fontWeight:"semibold",children:[((F=k==null?void 0:k.balance)==null?void 0:F.toLocaleString())||0," tokens"]}),((t==null?void 0:t.plan)==="growth_extra"||(t==null?void 0:t.plan)==="enterprise")&&e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[(t==null?void 0:t.plan)==="growth_extra"?"100M":"300M"," included monthly"]}),e.jsx(d,{variant:"primary",onClick:()=>u("/billing"),children:"Manage Tokens"})]})})})]})}),e.jsx(h.Section,{children:e.jsx(p,{children:e.jsxs(s,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Quick Actions"}),e.jsxs(g,{gap:"300",wrap:!0,children:[e.jsx(d,{onClick:()=>u("/ai-seo/products"),children:"Optimize Products"}),L&&e.jsx(d,{onClick:()=>u("/ai-seo/collections"),children:"Optimize Collections"}),!A&&e.jsxs(e.Fragment,{children:[e.jsx(d,{onClick:()=>u("/ai-seo/sitemap"),children:ee?"Regenerate Sitemap":"View Sitemap"}),Z&&e.jsx(d,{onClick:()=>u("/ai-seo/schema-data"),children:"Regenerate Schemas"})]}),X&&e.jsx(d,{onClick:()=>u("/ai-seo/store-metadata"),children:"Store Info"})]})]})})}),e.jsx(h.Section,{children:e.jsx(p,{children:e.jsxs(s,{gap:"300",children:[e.jsxs(g,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(n,{variant:"headingMd",children:"Current Plan"}),e.jsx(r,{paddingBlockStart:"100",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["$",(t==null?void 0:t.price)||0,"/month"]})})]}),e.jsx(_,{tone:"info",size:"large",children:((V=t==null?void 0:t.plan)==null?void 0:V.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsx(d,{onClick:()=>u("/billing"),children:"View Plans & Billing"})]})})}),e.jsx(h.Section,{children:e.jsx(p,{children:e.jsxs(s,{gap:"300",children:[e.jsxs(g,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{variant:"headingMd",children:"Getting Started"}),e.jsxs(d,{onClick:()=>H(!S),disclosure:S?"up":"down",children:[S?"Hide":"Show"," Guide"]})]}),e.jsx(ie,{open:S,id:"onboarding-collapsible",transition:{duration:"200ms",timingFunction:"ease-in-out"},children:e.jsx(r,{paddingBlockStart:"300",children:e.jsxs(s,{gap:"400",children:[e.jsx(y,{}),e.jsxs(s,{gap:"300",children:[e.jsx(n,{variant:"headingMd",as:"h3",children:"Quick Start Guide"}),e.jsxs(s,{gap:"200",children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"1. Sync Your Store"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:'Click "Sync Now" to fetch your products, collections, and languages from Shopify. This is required before you can start optimizing.'}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"2. Choose a Plan"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Visit Plans & Billing to select the plan that fits your store size. Each plan includes different limits for products, languages, and features."}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"3. Optimize Your Products"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:'Go to "Search Optimization for AI" â†’ Products tab. Select products and click "AI Enhance" to generate SEO-optimized titles, descriptions, and metadata.'}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"4. Generate AI Sitemap"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Navigate to Sitemap tab and generate your AI-optimized sitemap. This helps AI search engines discover and index your products."}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"5. Monitor & Improve"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Return to Dashboard regularly to track optimization progress and token usage. Enable auto-sync to keep your data fresh."})]})]}),e.jsx(y,{}),e.jsxs(s,{gap:"200",children:[e.jsx(n,{variant:"headingMd",as:"h3",children:"Video Tutorial"}),e.jsx(r,{padding:"400",background:"bg-surface-secondary",borderRadius:"200",children:e.jsxs(s,{gap:"200",inlineAlign:"center",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",alignment:"center",children:"Video tutorial coming soon"}),e.jsx(n,{variant:"bodySm",tone:"subdued",alignment:"center",children:"[Embedded video will be added here]"})]})})]}),e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(g,{gap:"200",children:[e.jsx(d,{variant:"primary",onClick:()=>u("/ai-seo/products"),children:"Start Optimizing"}),e.jsx(d,{onClick:()=>u("/billing"),children:"View Plans"})]})})]})})})]})})})]})}export{le as default};
