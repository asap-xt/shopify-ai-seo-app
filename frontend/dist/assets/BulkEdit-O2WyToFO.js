import{r as e,j as t}from"./react-vendor-BXVC7v0l.js";import{u as n}from"./useShopApi-BPGAW5iN.js";import{S as s,U as i}from"./StoreMetadataBanner-Cnf5DXyn.js";import{I as a}from"./InsufficientTokensModal-D0S-AnP8.js";import{T as r}from"./TrialActivationModal-BmJSzwDA.js";import{M as l,a as o,T as d,e as c,d as u,b as p,B as h,I as g,g as m,D as f,f as x,C as j,h as S,S as y,i as v,j as b,R as A,k as w,l as C,m as P,E as k}from"./polaris-DIPq0--Z.js";import"./app-bridge-DUY42B6P.js";import"./vendor-Cs_VgJ2r.js";const I=e=>{if(!e)return e;const t=String(e).trim();return t.startsWith("gid://")?t:`gid://shopify/Product/${t}`},z=e=>e<=70?"Starter":e<=200?"Professional":e<=450?"Growth":e<=750?"Growth Extra":"Enterprise";function $({shop:$,globalPlan:O}){var L,E,R;const{api:T,shop:M}=n(),U=$||M||((e,t="")=>{try{return new URLSearchParams(window.location.search).get(e)||t}catch{return t}})("shop","");e.useEffect(()=>{},[U,T]);const[W,q]=e.useState([]),[D,B]=e.useState(!1),[F,_]=e.useState(1),[N,Y]=e.useState(!0),[H,G]=e.useState(0),[K,V]=e.useState([]),[J,Q]=e.useState(!1),[X,Z]=e.useState(""),[ee,te]=e.useState("all"),[ne,se]=e.useState(""),[ie,ae]=e.useState("createdAt"),[re,le]=e.useState("desc"),[oe,de]=e.useState([]),[ce,ue]=e.useState([]),[pe,he]=e.useState(!1),[ge,me]=e.useState(!1),[fe,xe]=e.useState(!1),[je,Se]=e.useState(!1),[ye,ve]=e.useState(""),[be,Ae]=e.useState([]),[we,Ce]=e.useState([]),[Pe,ke]=e.useState([]),[Ie,ze]=e.useState(!1),[$e,Oe]=e.useState({current:0,total:0,percent:0}),[Le,Ee]=e.useState(""),[Re,Te]=e.useState([]),[Me,Ue]=e.useState({}),[We,qe]=e.useState(!1),[De,Be]=e.useState(!1),[Fe,_e]=e.useState(!1),[Ne,Ye]=e.useState([]),[He,Ge]=e.useState(!1),[Ke,Ve]=e.useState(""),[Je,Qe]=e.useState(!1),[Xe,Ze]=e.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[et,tt]=e.useState(null),[nt,st]=e.useState(70),[it,at]=e.useState(1),[rt,lt]=e.useState(!1),[ot,dt]=e.useState("true"===localStorage.getItem("hasVisitedProducts")),[ct,ut]=e.useState(!1),[pt,ht]=e.useState(!1),[gt,mt]=e.useState(!1),[ft,xt]=e.useState(null),[jt,St]=e.useState("starter"),[yt,vt]=e.useState(!1);e.useEffect(()=>{if(O&&"object"==typeof O&&!yt&&"starter"===jt)if(O.planKey&&""!==O.planKey){St(O.planKey);const e=O.language_limit||1;at(e)}else if(O.plan&&""!==O.plan){const e=O.plan.toLowerCase().replace(/\s+/g,"-");St(e);const t=O.language_limit||1;at(t)}},[O,jt,yt]),e.useEffect(()=>{if(ct&&et){(J?H:K.length)<=nt&&(ut(!1),xt(null))}},[K.length,J,H,ct,et]),e.useEffect(()=>{if(!U)return;T("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n      query PlansMe($shop:String!) {\n        plansMe(shop:$shop) {\n          plan\n          planKey\n          modelsSuggested\n          product_limit\n          language_limit\n        }\n      }\n    ",variables:{shop:U}})}).then(e=>{var t,n,s;if(null==(t=null==e?void 0:e.errors)?void 0:t.length)throw new Error((null==(n=e.errors[0])?void 0:n.message)||"GraphQL error");const i=null==(s=null==e?void 0:e.data)?void 0:s.plansMe,a=(null==i?void 0:i.modelsSuggested)||["anthropic/claude-3.5-sonnet"];Ae(a.map(e=>({label:e,value:e}))),ve(a[0]),tt((null==i?void 0:i.plan)||"starter"),St((null==i?void 0:i.planKey)||"starter");const r=(null==i?void 0:i.product_limit)||70,l=(null==i?void 0:i.language_limit)||1;st(r),at(l),vt(!0)}).catch(e=>{vt(!0)})},[U,T]),e.useEffect(()=>{if(!U)return;const e=new Promise((e,t)=>{setTimeout(()=>t(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([T(`/api/languages/shop/${U}`),e]).then(e=>{const t=Array.isArray(null==e?void 0:e.shopLanguages)&&e.shopLanguages.length?e.shopLanguages:["en"];ke(t.includes("en")?t:["en",...t])}).catch(e=>{ke(["en"])})},[U,T]),e.useEffect(()=>{U&&T("/api/products/tags/list",{shop:U}).then(e=>ue((null==e?void 0:e.tags)||[])).catch(e=>{})},[U,T]);const bt=e.useCallback(async(e=1,t=!1,n=null)=>{var s,i,a,r;B(!0);try{const l=new URLSearchParams({shop:U,page:e,limit:50,..."all"!==ee&&{optimized:ee},...X&&{search:X},...ne&&{languageFilter:ne},...oe.length>0&&{tags:oe.join(",")},sortBy:ie,sortOrder:re,...n&&{_t:n}}),o=await T(`/api/products/list?${l}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});null==(s=o.products)||s.length,(null==(i=o.products)?void 0:i.length)>0&&o.products.forEach((e,t)=>{}),q(t?e=>[...e,...o.products]:o.products||[]),_(e),Y((null==(a=o.pagination)?void 0:a.hasNext)||!1),G((null==(r=o.pagination)?void 0:r.total)||0)}catch(l){q(t?W:[]),Y(!1),Ve(`Error loading products: ${l.message}`)}finally{B(!1)}},[U,ee,X,ne,oe,ie,re]);e.useEffect(()=>{U&&bt(1,!1,null)},[U,ee,ne,oe,ie,re]),e.useEffect(()=>{!ot&&U&&(localStorage.setItem("hasVisitedProducts","true"),dt(!0))},[ot,U]),e.useEffect(()=>{0!==W.length||D||!U||ot||lt(!0)},[W.length,D,U,ot]),e.useEffect(()=>{},[W,K]);const At=e.useCallback(e=>{Z(e)},[]);e.useEffect(()=>{const e=setTimeout(()=>{U&&bt(1,!1,null)},500);return()=>clearTimeout(e)},[X]);const wt=e.useCallback(e=>{V(e),0===e.length&&Q(!1)},[]),Ct=e.useCallback(e=>{Q(e),V(e?W.map(e=>e.id):[])},[W]),Pt=e.useMemo(()=>{var e;if(J)return we.length>it;const t=W.filter(e=>K.includes(e.id));if(0===t.length)return we.length>it;for(const n of t){const t=(null==(e=n.optimizationSummary)?void 0:e.optimizedLanguages)||[],s=we.filter(e=>!t.includes(e));if(t.length+s.length>it)return!0}return!1},[W,K,J,it,we]),kt=async()=>{const e=W.filter(e=>K.includes(e.id)),t=e.filter(e=>{var t,n;return(null==(n=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:n.length)>0}),n=e.filter(e=>{var t,n;return!(null==(n=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:n.length)}),s=t.length;if(s>nt){const e=z(s);return xt({error:"Product limit exceeded",message:`Your ${et} plan supports up to ${nt} products for AI Enhancement. You have selected ${s} products with Basic SEO.`,minimumPlanRequired:e,currentPlan:et,features:[`Optimize up to ${nt} products`,"All features from your current plan","Growth Extra"===e||"Enterprise"===e?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons","Enterprise"===e?"Advanced Schema Data":null].filter(Boolean)}),void ut(!0)}Qe(!0),Ze({processing:!0,current:0,total:t.length,currentItem:"",results:null});const i={successful:0,failed:0,skipped:n.length,skipReasons:n.length>0?[`${n.length} product(s): No Basic Optimization`]:[]};for(let r=0;r<t.length;r++){const e=t[r];Ze(t=>({...t,current:r,currentItem:e.title}));try{const t=e.gid||I(e.id);if(!t){i.failed++;continue}const n=await T("/ai-enhance/product",{method:"POST",shop:U,body:{shop:U,productId:t,languages:e.optimizationSummary.optimizedLanguages}});if(n.results&&n.results.length>0){const t={shop:U,productId:e.gid||I(e.id),results:n.results.filter(e=>e.bullets&&e.faq).map(e=>({language:e.language,seo:{...e.updatedSeo,bullets:e.bullets||[],faq:e.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}};await T("/api/seo/apply-multi",{method:"POST",shop:U,body:t});i.successful++}else i.failed++}catch(a){if(403===a.status)return Ze({processing:!1,current:0,total:0,currentItem:"",results:null}),xt({...a,message:a.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),St(a.currentPlan||jt),void(!1===a.needsUpgrade&&a.requiresPurchase?ht(!0):ut(!0));if(402===a.status||a.requiresPurchase||a.trialRestriction)return Ze({processing:!1,current:0,total:0,currentItem:"",results:null}),xt(a),St(a.currentPlan||et||"starter"),void(a.trialRestriction&&a.requiresActivation?mt(!0):a.trialRestriction?ut(!0):ht(!0));i.failed++}Ze(e=>({...e,current:r+1}))}Ze(e=>({...e,processing:!1,results:i})),Ve(`AI enhancement complete! ${i.successful} products enhanced.`)},It=()=>{const e=Xe.results;Qe(!1),Ze({processing:!1,current:0,total:0,currentItem:"",results:null}),e&&e.successful>0&&setTimeout(()=>{q([]),bt(1,!1,Date.now())},1500)},zt=Ie&&t.jsx(l,{open:Ie,title:"Processing Products",onClose:()=>{},noScroll:!0,children:t.jsx(l.Section,{children:t.jsxs(o,{gap:"400",children:[t.jsx(d,{variant:"bodyMd",children:Le?`Processing: ${Le}`:"Preparing..."}),t.jsx(c,{progress:$e.percent}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:[$e.current," of ",$e.total," products (",$e.percent,"%)"]})]})})}),$t=t.jsx(l,{open:De,title:"Select Languages",onClose:()=>{Be(!1),Ce([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:async()=>{var e;if(!we.length)return void Ve("Please select at least one language");let t=ye;t&&t.trim()||(t=(null==(e=be[0])?void 0:e.value)||"anthropic/claude-3.5-sonnet"),ze(!0),Oe({current:0,total:0,percent:0}),Te([]),Ue({});try{let e=[];if(J){e=(await T(`/api/products/list?shop=${encodeURIComponent(U)}&limit=1000&fields=id`)).products||[]}else e=W.filter(e=>K.includes(e.id));const n=e.length;if(n>nt){ze(!1),Oe({current:0,total:0,percent:0}),Be(!1);const e=z(n);return xt({error:"Product limit exceeded",message:`Your ${jt} plan supports up to ${nt} products for SEO optimization. You have selected ${n} products.`,minimumPlanRequired:e,currentPlan:jt,features:["Optimize more products","All features from your current plan","Growth Extra"===e||"Enterprise"===e?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons","Enterprise"===e?"Advanced Schema Data":null].filter(Boolean)}),void ut(!0)}Be(!1);const s=n;Oe({current:0,total:s,percent:0});const i=5,a={};for(let d=0;d<e.length;d+=i){const n=e.slice(d,Math.min(d+i,e.length)).map(async e=>{var n;Ee(e.title||e.handle||"Product");try{const s=e.gid||I(e.productId||e.id),i=(null==(n=e.optimizationSummary)?void 0:n.optimizedLanguages)||[],r=we.filter(e=>!i.includes(e));if(0===r.length)return void(a[e.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"});const l=await T("/api/seo/generate-multi",{method:"POST",shop:U,body:{shop:U,productId:s,model:t,languages:r}});a[e.id]={success:!0,data:l,languages:r}}catch(s){a[e.id]={success:!1,error:s.message},Te(t=>[...t,{product:e.title,error:s.message}])}});await Promise.all(n);const r=Math.min(d+i,e.length),l=Math.round(r/s*100);Oe({current:r,total:s,percent:l})}Ue(a),qe(!0);const r=Object.keys(a).filter(e=>a[e].success&&!a[e].skipped).length,l=Object.keys(a).filter(e=>a[e].skipped).length;let o=`Generated Optimization for AI Search for ${r} products`;l>0&&(o+=` (${l} already optimised)`),Ve(o)}catch(n){Ve(`Error: ${n.message}`)}finally{ze(!1),Ee("")}},disabled:0===we.length||Pt},secondaryActions:[{content:"Cancel",onAction:()=>{Be(!1),Ce([])}}],children:t.jsx(l.Section,{children:t.jsxs(o,{gap:"300",children:[t.jsxs(d,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",J?"all":K.length," selected products:"]}),Pt&&t.jsx(u,{tone:"warning",title:"Language limit exceeded",children:t.jsxs(o,{gap:"200",children:[t.jsxs(d,{variant:"bodyMd",children:["Your ",jt," plan supports up to ",it," language",it>1?"s":""," per product.",1===K.length&&(null==(R=null==(E=null==(L=W.find(e=>e.id===K[0]))?void 0:L.optimizationSummary)?void 0:E.optimizedLanguages)?void 0:R.length)>0&&t.jsxs(t.Fragment,{children:[" This product already has ",W.find(e=>e.id===K[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),t.jsx(d,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),t.jsx(p,{variant:"primary",onClick:()=>{const e=new URLSearchParams(window.location.search),t=e.toString()?`?${e.toString()}`:"";window.location.href=`/billing${t}`},children:"Upgrade Plan"})]})}),t.jsx(h,{paddingBlockStart:"200",children:t.jsx(g,{gap:"200",wrap:!0,children:Pe.map(e=>t.jsx(m,{label:e.toUpperCase(),checked:we.includes(e),onChange:t=>{Ce(t?[...we,e]:we.filter(t=>t!==e))}},e))})}),t.jsx(h,{paddingBlockStart:"200",children:t.jsx(p,{plain:!0,onClick:()=>{we.length===Pe.length?Ce([]):Pe.length>it?(Ce([...Pe]),Ve(`You selected ${Pe.length} languages. Your ${jt} plan supports ${it}. Please deselect or upgrade.`)):Ce([...Pe])},children:we.length===Pe.length?"Deselect all":"Select all"})}),t.jsx(d,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Ot=t.jsx(l,{open:We&&!Ie,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:async()=>{var e,t;ze(!0),Oe({current:0,total:0,percent:0});try{const s=Object.entries(Me).filter(([e,t])=>t.success&&!t.skipped),i=s.length;Oe({current:0,total:i,percent:0});for(let e=0;e<s.length;e++){const[t,a]=s[e],r=W.find(e=>e.id===t);if(!r)continue;Ee(r.title||"Product");try{const e=r.gid||I(r.productId||r.id),n=await T("/api/seo/apply-multi",{method:"POST",shop:U,body:{shop:U,productId:e,results:a.data.results.filter(e=>null==e?void 0:e.seo).map(e=>({language:e.language,seo:e.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});n.appliedLanguages&&n.appliedLanguages.length>0&&q(e=>e.map(e=>{var s;if(e.id===t){const t=(null==(s=e.optimizationSummary)?void 0:s.optimizedLanguages)||[],i=[...new Set([...t,...n.appliedLanguages])];return{...e,optimizationSummary:{...e.optimizationSummary,optimizedLanguages:i,optimized:!0,lastOptimized:(new Date).toISOString()}}}return e}))}catch(n){Te(e=>[...e,{product:r.title,error:`Apply failed: ${n.message}`}])}const l=e+1,o=Math.round(l/i*100);Oe({current:l,total:i,percent:o})}Ve("AI Search Optimisation applied successfully!"),qe(!1),V([]),Q(!1),await new Promise(e=>setTimeout(e,1e3)),q([]);const a=new URLSearchParams({shop:U,page:1,limit:50,..."all"!==ee&&{optimized:ee},...X&&{search:X},...ne&&{languageFilter:ne},...oe.length>0&&{tags:oe.join(",")},sortBy:ie,sortOrder:re,_t:Date.now()}),r=await T(`/api/products/list?${a}`,{shop:U,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});q(r.products||[]),_(1),Y((null==(e=r.pagination)?void 0:e.hasNext)||!1),G((null==(t=r.pagination)?void 0:t.total)||0)}catch(n){Ve(`Error applying AI Search Optimisation: ${n.message}`)}finally{ze(!1),Ee("")}},disabled:!Object.values(Me).some(e=>e.success&&!e.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>qe(!1)}],children:t.jsx(l.Section,{children:t.jsxs(o,{gap:"300",children:[t.jsxs(g,{gap:"400",children:[t.jsxs(h,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(Me).filter(e=>e.success&&!e.skipped).length})]}),t.jsxs(h,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(Me).filter(e=>e.skipped).length})]}),t.jsxs(h,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(Me).filter(e=>!e.success).length})]})]}),Re.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(f,{}),t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),t.jsxs(h,{maxHeight:"200px",overflowY:"scroll",children:[Re.slice(0,10).map((e,n)=>t.jsxs(d,{variant:"bodySm",tone:"critical",children:[e.product,": ",e.error]},n)),Re.length>10&&t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["... and ",Re.length-10," more errors"]})]})]})]})})}),Lt=t.jsx(l,{open:Fe,title:"Delete Optimization for AI Search",onClose:()=>{_e(!1),Ye([])},primaryAction:{content:"Continue",onAction:()=>{_e(!1),Ge(!0)},disabled:0===Ne.length,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{_e(!1),Ye([])}}],children:t.jsx(l.Section,{children:t.jsxs(o,{gap:"300",children:[t.jsxs(d,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",J?"all":K.length," selected products:"]}),t.jsx(h,{paddingBlockStart:"200",children:t.jsx(g,{gap:"200",wrap:!0,children:Pe.map(e=>t.jsx(m,{label:e.toUpperCase(),checked:Ne.includes(e),onChange:t=>{Ye(t?[...Ne,e]:Ne.filter(t=>t!==e))}},e))})}),t.jsx(h,{paddingBlockStart:"200",children:t.jsx(p,{plain:!0,onClick:()=>{Ye(Ne.length===Pe.length?[]:[...Pe])},children:Ne.length===Pe.length?"Deselect all":"Select all"})}),t.jsx(d,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Et=t.jsx(l,{open:He,title:"Confirm Deletion",onClose:()=>{Ge(!1)},primaryAction:{content:"Delete",onAction:async()=>{var e;if(Ne.length){_e(!1),Ge(!1),ze(!0),Oe({current:0,total:0,percent:0}),Te([]);try{let n=[];if(J){n=(await T(`/api/products/list?shop=${encodeURIComponent(U)}&limit=1000&fields=id`)).products||[]}else n=W.filter(e=>K.includes(e.id));const s=n.length;Oe({current:0,total:s,percent:0});let i=0,a=0;for(let r=0;r<n.length;r++){const l=n[r];Ee(l.title||l.handle||"Product");try{const t=l.gid||I(l.productId||l.id),n=(null==(e=l.optimizationSummary)?void 0:e.optimizedLanguages)||[],s=Ne.filter(e=>n&&n.length>0&&n.includes(e));if(0===s.length){a++;continue}const r=await T("/api/seo/delete-multi",{method:"POST",shop:U,body:{shop:U,productId:t,languages:s}});r.deletedLanguages&&r.deletedLanguages.length>0&&q(e=>e.map(e=>{var t;if(e.id===l.id){const n=((null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)||[]).filter(e=>!r.deletedLanguages.includes(e));return{...e,optimizationSummary:{...e.optimizationSummary,optimizedLanguages:n,optimized:n.length>0,aiEnhanced:n.length>0&&e.optimizationSummary.aiEnhanced,lastOptimized:n.length>0?e.optimizationSummary.lastOptimized:null}}}return e})),i++,r.deletedLanguages&&r.deletedLanguages.length>0&&await T("/api/products/verify-after-delete",{method:"POST",shop:U,body:{shop:U,productIds:[t],deletedLanguages:r.deletedLanguages}})}catch(t){Te(e=>[...e,{product:l.title,error:t.message}])}const o=r+1,d=Math.round(o/s*100);Oe({current:o,total:s,percent:d})}V([]),Q(!1),Ve(a>0?`Deleted Optimization for AI Search from ${i} products (${a} had no optimisation to delete)`:`Deleted Optimization for AI Search from ${i} products`),setTimeout(()=>{const e=Date.now();bt(1,!1,e)},500)}catch(t){Ve(`Error: ${t.message}`)}finally{ze(!1),Ee("")}}else Ve("Please select at least one language to delete")},destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>Ge(!1)}],children:t.jsx(l.Section,{children:t.jsxs(o,{gap:"300",children:[t.jsx(d,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),t.jsx(h,{paddingBlock:"200",children:t.jsx(g,{gap:"100",children:Ne.map(e=>t.jsx(x,{tone:"critical",children:e.toUpperCase()},e))})}),t.jsxs(d,{variant:"bodyMd",children:["This will delete optimisation from ",J?"ALL":K.length," selected products."]}),t.jsx(d,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Rt=async()=>{try{B(!0),Ve("Syncing products from Shopify...");const e=await T("/api/products/sync",{method:"POST",shop:U});if(!e.success)throw new Error(e.error||"Sync failed");{const t=e.productsCount||e.synced||0;Ve(`✅ Synced ${t} products successfully!`),setTimeout(()=>{bt(1,!1,Date.now())},1e3)}}catch(e){Ve(`❌ Sync failed: ${e.message}`)}finally{B(!1)}},Tt=t.jsx(k,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Z(""),te("all"),se(""),de([]),bt(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Rt},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:t.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return t.jsxs(t.Fragment,{children:[t.jsx(s,{globalPlan:O}),t.jsx(j,{children:t.jsxs(h,{padding:"400",children:[t.jsxs(o,{gap:"300",children:[et&&t.jsx(u,{tone:"info",children:t.jsxs(g,{gap:"200",align:"space-between",children:[t.jsxs(d,{children:["Your ",t.jsx("strong",{children:et})," plan includes up to"," ",t.jsx("strong",{children:nt})," products for SEO optimization.",H>nt&&t.jsxs(t.Fragment,{children:[" You have ",H," products, so only the first ",nt," will be processed."]})]}),(K.length>0||J)&&t.jsxs(d,{children:["Selected: ",J?Math.min(H,nt):K.length,"/",nt]})]})}),et&&(K.length>nt||J&&H>nt)&&t.jsx(u,{tone:"critical",children:t.jsxs(o,{gap:"200",children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),t.jsxs(d,{children:["Your ",t.jsx("strong",{children:et})," plan supports up to ",t.jsx("strong",{children:nt})," products. You have selected ",t.jsx("strong",{children:J?H:K.length})," products."]}),t.jsx(d,{children:"Please deselect some products or upgrade your plan to continue."}),t.jsxs(g,{gap:"200",children:[t.jsx(p,{onClick:()=>{V([]),Q(!1)},children:"Clear Selection"}),t.jsx(p,{variant:"primary",onClick:()=>{xt({error:"Product limit exceeded",message:`Your ${et} plan supports up to ${nt} products. Upgrade to ${z(J?H:K.length)} to optimize more products.`,minimumPlanRequired:z(J?H:K.length)}),ut(!0)},children:"Upgrade Plan"})]})]})}),t.jsxs(g,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[t.jsx(h,{minWidth:"400px",children:t.jsx(S,{label:"",placeholder:"Search by product ID, name, or details...",value:X,onChange:At,prefix:t.jsx(y,{}),clearButton:!0,onClearButtonClick:()=>At("")})}),t.jsx(h,{width:"320px",children:t.jsx(p,{primary:!0,onClick:()=>{0!==K.length||J?Be(!0):Ve("Please select products first")},disabled:0===K.length&&!J,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),t.jsxs(g,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[t.jsx(p,{onClick:Rt,disabled:D,size:"medium",children:"Sync Products"}),t.jsx(h,{width:"320px",children:t.jsxs(o,{gap:"200",align:"end",children:[(()=>{if(0===K.length&&!J)return null;if(!W.filter(e=>K.includes(e.id)).some(e=>{var t,n;return(null==(n=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:n.length)>0}))return null;const e=["professional","professional_plus","professional plus","growth","growth_plus","growth plus","growth_extra","growth extra","enterprise"].includes(jt.toLowerCase().replace(/_/g," "));return t.jsx(p,{onClick:e?kt:()=>{xt({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),ut(!0)},disabled:0===K.length&&!J,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),t.jsx(p,{onClick:()=>{0!==K.length||J?(Ye([]),_e(!0)):Ve("Please select products first")},disabled:0===K.length&&!J||!W.filter(e=>K.includes(e.id)).some(e=>{var t,n;return(null==(n=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:n.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),H>0&&t.jsx(h,{paddingBlockStart:"300",children:t.jsx(m,{label:`Select all ${H} products in your store`,checked:J,onChange:Ct})})]})}),t.jsx(h,{paddingBlockStart:"400",children:t.jsxs(j,{children:[t.jsxs(h,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[t.jsxs(g,{gap:"200",wrap:!0,align:"space-between",children:[t.jsxs(g,{gap:"200",wrap:!0,children:[t.jsx(v,{active:pe,activator:t.jsx(p,{disclosure:"down",onClick:()=>he(!pe),removeUnderline:!0,children:t.jsxs(g,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"AI Search Status"}),"all"!==ee&&t.jsx(h,{onClick:e=>{e.stopPropagation(),te("all")},children:t.jsx(d,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>he(!1),children:t.jsx(h,{padding:"300",minWidth:"200px",children:t.jsx(b,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[ee],onChange:e=>{te(e[0]),se(""),he(!1)}})})}),t.jsx(v,{active:ge,activator:t.jsx(p,{disclosure:"down",onClick:()=>me(!ge),removeUnderline:!0,children:t.jsxs(g,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"Language Status"}),ne&&t.jsx(h,{onClick:e=>{e.stopPropagation(),se("")},children:t.jsx(d,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>me(!1),children:t.jsx(h,{padding:"300",minWidth:"200px",children:t.jsx(b,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...Pe.map(e=>({label:`Has ${e.toUpperCase()}`,value:`has_${e}`})),...Pe.map(e=>({label:`Missing ${e.toUpperCase()}`,value:`missing_${e}`}))],selected:ne?[ne]:[],onChange:e=>{se(e[0]||""),me(!1)}})})}),t.jsx(v,{active:fe,activator:t.jsx(p,{disclosure:"down",onClick:()=>xe(!fe),removeUnderline:!0,children:t.jsxs(g,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"Tags"}),oe.length>0&&t.jsx(h,{onClick:e=>{e.stopPropagation(),de([])},children:t.jsx(d,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>xe(!1),children:t.jsxs(h,{padding:"300",minWidth:"200px",children:[t.jsx(b,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:ce.map(e=>({label:e,value:e})),selected:oe,onChange:e=>{de(e)}}),t.jsx(h,{paddingBlockStart:"200",children:t.jsx(p,{size:"slim",onClick:()=>xe(!1),children:"Apply"})})]})})]}),t.jsx(v,{active:je,activator:t.jsx(p,{disclosure:"down",onClick:()=>Se(!je),removeUnderline:!0,children:t.jsx(g,{gap:"100",blockAlign:"center",children:t.jsx("span",{children:"desc"===re?"Newest first":"Oldest first"})})}),onClose:()=>Se(!1),children:t.jsx(h,{padding:"300",minWidth:"200px",children:t.jsx(b,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[re],onChange:e=>{le(e[0]),Se(!1)}})})})]}),("all"!==ee||ne||oe.length>0)&&t.jsx(h,{paddingBlockStart:"200",children:t.jsxs(g,{gap:"100",wrap:!0,children:["all"!==ee&&t.jsx(x,{onRemove:()=>te("all"),children:"true"===ee?"Has AI Search Optimisation":"No AI Search Optimisation"}),ne&&t.jsx(x,{onRemove:()=>se(""),children:ne.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())}),oe.map(e=>t.jsxs(x,{onRemove:()=>de(t=>t.filter(t=>t!==e)),children:["Tag: ",e]},e))]})})]}),t.jsxs(h,{children:[t.jsx(h,{paddingBlockEnd:"200",paddingInlineStart:"300",children:t.jsxs(g,{gap:"200",align:"start",children:[t.jsx(m,{checked:K.length===W.length&&W.length>0,onChange:Ct,label:""}),t.jsxs(d,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",K.length>0&&` (${K.length} selected products)`]})]})}),t.jsx(A,{resourceName:{singular:"product",plural:"products"},items:W,renderItem:e=>{var n,s,i;try{const a=e,r=(e=>{if(!e)return"";const t=String(e).match(/\/(\d+)$/);return t?t[1]:e})(a.productId||a.id),l=(null==(n=a.optimizationSummary)?void 0:n.optimizedLanguages)||[],o=(null==(s=a.images)?void 0:s[0])?t.jsx(C,{source:a.images[0].url||a.images[0].src||a.images[0],alt:a.title,size:"small"}):a.imageUrl?t.jsx(C,{source:a.imageUrl,alt:a.title,size:"small"}):t.jsx(h,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return t.jsx(P,{id:a.id,media:o,accessibilityLabel:`View details for ${a.title}`,onClick:e=>{},children:t.jsxs(g,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[t.jsxs(h,{style:{flex:"1 1 40%",minWidth:"250px"},children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:a.title}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["ID: ",r]})]}),t.jsx(h,{style:{flex:"0 0 25%",minWidth:"160px"},children:t.jsxs(g,{gap:"100",wrap:!0,children:[(()=>{if(Pe.length>0)return Pe.map(e=>{const n=l.includes(e),s="DRAFT"===a.status;return t.jsx(x,{tone:s?"subdued":n?"success":"subdued",size:"small",children:e.toUpperCase()},e)});{const e="DRAFT"===a.status;return l.map(n=>t.jsx(x,{tone:e?"subdued":"success",size:"small",children:n.toUpperCase()},n))}})(),(null==(i=a.optimizationSummary)?void 0:i.aiEnhanced)&&"DRAFT"!==a.status&&t.jsx(x,{tone:"info",size:"small",children:"AI✨"})]})}),t.jsx(h,{style:{flex:"0 0 20%",minWidth:"120px",textAlign:"center"},children:"ACTIVE"===a.status?t.jsx(x,{tone:"success",children:"Active"}):"DRAFT"===a.status?t.jsx(x,{children:"Draft"}):"ARCHIVED"===a.status?t.jsx(x,{tone:"warning",children:"Archived"}):t.jsx(x,{children:a.status||"Unknown"})})]})})}catch(a){return null}},selectedItems:K,onSelectionChange:wt,selectable:!0,loading:D,totalItemsCount:H,emptyState:Tt,showHeader:!1},`products-${W.length}-${K.length}`)]}),N&&!D&&t.jsx(h,{padding:"400",textAlign:"center",children:t.jsx(p,{onClick:()=>bt(F+1,!0,null),children:"Load more"})})]})}),zt,$t,Ot,Lt,Et,Xe.processing?t.jsx(l,{open:Je,title:"Processing AI Enhancement",onClose:It,noScroll:!0,children:t.jsx(l.Section,{children:t.jsxs(o,{gap:"400",children:[t.jsxs(d,{variant:"bodyMd",children:["Processing: ",Xe.currentItem]}),t.jsx(c,{progress:Xe.current/Xe.total*100}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:[Xe.current," of ",Xe.total," products (",Math.round(Xe.current/Xe.total*100),"%)"]})]})})}):null!==Xe.results?t.jsx(l,{open:Je,title:"AI Enhancement Results",onClose:It,primaryAction:{content:"Done",onAction:It},children:t.jsx(l.Section,{children:t.jsxs(o,{gap:"400",children:[t.jsxs(g,{gap:"400",children:[t.jsxs(h,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Xe.results.successful})]}),t.jsxs(h,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Xe.results.failed})]}),t.jsxs(h,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Xe.results.skipped})]})]}),Xe.results.skipReasons&&Xe.results.skipReasons.length>0&&t.jsxs(o,{gap:"200",children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped products:"}),Xe.results.skipReasons.map((e,n)=>t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["• ",e]},n))]})]})})}):null,t.jsx(l,{open:rt,onClose:()=>lt(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{lt(!1),Rt()}},secondaryActions:[{content:"Skip for now",onAction:()=>lt(!1)}],children:t.jsx(l.Section,{children:t.jsxs(o,{gap:"300",children:[t.jsx(d,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),t.jsx(d,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),t.jsx(i,{open:ct,onClose:()=>{ut(!1),xt(null)},featureName:(null==ft?void 0:ft.error)||"Feature",errorMessage:null==ft?void 0:ft.message,currentPlan:(null==ft?void 0:ft.currentPlan)||jt,minimumPlanRequired:null==ft?void 0:ft.minimumPlanRequired,features:null==ft?void 0:ft.features}),ft&&t.jsxs(t.Fragment,{children:[t.jsx(a,{open:pt,onClose:()=>{ht(!1),xt(null)},tokensRequired:ft.tokensRequired||0,tokensAvailable:ft.tokensAvailable||0,tokensNeeded:ft.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:U,needsUpgrade:ft.needsUpgrade||!1,minimumPlan:ft.minimumPlanForFeature||null,currentPlan:ft.currentPlan||jt,returnTo:"/ai-seo"}),t.jsx(r,{open:gt,onClose:()=>{mt(!1),xt(null)},feature:ft.feature||"ai-seo-product-enhanced",trialEndsAt:ft.trialEndsAt,currentPlan:ft.currentPlan||jt,tokensRequired:ft.tokensRequired||0,onActivatePlan:async()=>{try{const e=await T("/api/billing/activate",{method:"POST",body:{shop:U,endTrial:!0,returnTo:"/ai-seo"}});if(e.requiresApproval&&e.confirmationUrl)return void(window.top.location.href=e.confirmationUrl);window.location.reload()}catch(e){const t=new URLSearchParams(window.location.search),n=t.get("host"),s=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(U)}&embedded=${s}&host=${encodeURIComponent(n)}`}},onPurchaseTokens:()=>{const e=new URLSearchParams(window.location.search),t=e.get("host"),n=e.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(U)}&embedded=${n}&host=${encodeURIComponent(t)}&returnTo=${encodeURIComponent("/ai-seo")}`}})]}),Ke&&t.jsx(w,{content:Ke,onDismiss:()=>Ve("")})]})}export{$ as default};
