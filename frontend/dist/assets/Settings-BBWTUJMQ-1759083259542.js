import{j as e}from"./app-bridge-4QoF7_Lp-1759083259542.js";import{r as l}from"./react-vendor-tAaa2TlE-1759083259542.js";import{m as Qe}from"./index-B1o97hHI-1759083259542.js";import{C as E,a as p,T as i,I as b,r as me,d as S,g as O,h as j,D as xe,f as L,B as m,n as Ve,v as We,M as x,e as He,k as Ye}from"./polaris-DZnqAnwx-1759083259542.js";const Ke=(C,v="")=>{try{return new URLSearchParams(window.location.search).get(C)||v}catch{return v}},A=C=>(C||"starter").toLowerCase().replace(" ","_");function ct(){var C,v;try{console.log("[SETTINGS] ===== SETTINGS COMPONENT LOADED ====="),console.log("[SETTINGS] Starting component initialization...");const P=(t,s=null)=>{console.log(`[SETTINGS DEBUG] ${t}`,s||"")},[be,K]=l.useState(!0),[fe,X]=l.useState(!1),[o,B]=l.useState(null),[_,F]=l.useState(""),[Z,J]=l.useState(!1),[N,c]=l.useState(""),[ee,Te]=l.useState(null),[te,q]=l.useState(null),[oe,je]=l.useState(!1),[we,ye]=l.useState(!1),[Ee,Ae]=l.useState(!1),[Ce,Ge]=l.useState(!1),[Ie,ve]=l.useState(!1),[Pe,Ne]=l.useState(!1);l.useEffect(()=>{console.log("[SETTINGS] showViewButtons state changed to:",oe)},[oe]),l.useEffect(()=>{console.log("[SETTINGS] Resetting showViewButtons on component mount"),je(!1)},[]),l.useEffect(()=>{o!=null&&o.features&&r&&(console.log("[SETTINGS] Checking for generated data..."),Me())},[o==null?void 0:o.features,r]);const Me=async()=>{try{if(console.log("[SETTINGS] ===== CHECKING GENERATED DATA ====="),o.features.productsJson){console.log("[SETTINGS] Checking Products JSON data...");const t=await De();ye(t),console.log("[SETTINGS] Products JSON data exists:",t)}if(o.features.collectionsJson){console.log("[SETTINGS] Checking Collections JSON data...");const t=await ke();Ae(t),console.log("[SETTINGS] Collections JSON data exists:",t)}if(o.features.storeMetadata){console.log("[SETTINGS] Checking Store Metadata data...");const t=await Oe();Ge(t),console.log("[SETTINGS] Store Metadata exists:",t)}if(o.features.welcomePage){console.log("[SETTINGS] Checking Welcome Page data...");const t=await Le();Ne(t),console.log("[SETTINGS] Welcome Page exists:",t)}console.log("[SETTINGS] ===== GENERATED DATA CHECK COMPLETE =====")}catch(t){console.error("[SETTINGS] Error checking generated data:",t)}},De=async()=>{var t,s,a;try{const h=await u("/graphql",{method:"POST",body:JSON.stringify({query:`
        query CheckProductsData($shop: String!) {
          products(shop: $shop, first: 1) {
            edges {
              node {
                id
                title
              }
            }
          }
        }
      `,variables:{shop:r}}),shop:r});return((a=(s=(t=h==null?void 0:h.data)==null?void 0:t.products)==null?void 0:s.edges)==null?void 0:a.length)>0}catch(n){return console.error("[SETTINGS] Error checking products data:",n),!1}},ke=async()=>{var t,s,a;try{const h=await u("/graphql",{method:"POST",body:JSON.stringify({query:`
        query CheckCollectionsData($shop: String!) {
          collections(shop: $shop, first: 1) {
            edges {
              node {
                id
                title
              }
            }
          }
        }
      `,variables:{shop:r}}),shop:r});return((a=(s=(t=h==null?void 0:h.data)==null?void 0:t.collections)==null?void 0:s.edges)==null?void 0:a.length)>0}catch(n){return console.error("[SETTINGS] Error checking collections data:",n),!1}},Oe=async()=>{var t,s;try{const n=await u("/graphql",{method:"POST",body:JSON.stringify({query:`
        query CheckStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
          }
        }
      `,variables:{shop:r}}),shop:r});return(s=(t=n==null?void 0:n.data)==null?void 0:t.storeMetadata)==null?void 0:s.shopName}catch(a){return console.error("[SETTINGS] Error checking store metadata:",a),!1}},Le=async()=>{var t,s;try{const n=await u("/graphql",{method:"POST",body:JSON.stringify({query:`
        query CheckWelcomePage($shop: String!) {
          welcomePage(shop: $shop) {
            title
            content
          }
        }
      `,variables:{shop:r}}),shop:r});return(s=(t=n==null?void 0:n.data)==null?void 0:t.welcomePage)==null?void 0:s.title}catch(a){return console.error("[SETTINGS] Error checking welcome page:",a),!1}};l.useEffect(()=>{if(N){console.log("[SETTINGS] Toast state changed to:",N),ee&&clearTimeout(ee);const t=setTimeout(()=>{console.log("[SETTINGS] Auto-clearing toast after 5 seconds"),c("")},5e3);Te(t)}},[N]);const Be=()=>{console.log("[SETTINGS] Starting polling for background regeneration completion..."),te&&clearInterval(te);let t=0;const s=30,a=setInterval(async()=>{t++,console.log(`[SETTINGS] Polling attempt ${t}/${s}`);try{const n=await u(`/api/sitemap/info?shop=${r}`);if(console.log("[SETTINGS] Sitemap info:",n),n&&n.generatedAt){const h=new Date(n.generatedAt).getTime();if(Date.now()-h<12e4){console.log("[SETTINGS] Background regeneration completed!"),clearInterval(a),q(null),c("AI-Optimized Sitemap regeneration completed successfully!"),console.log("[SETTINGS] Setting showAiSitemapView to true for AI sitemap regeneration completion"),ve(!0);return}}t>=s&&(console.log("[SETTINGS] Polling timeout reached"),clearInterval(a),q(null),c("Background regeneration is taking longer than expected. Please check the sitemap manually."))}catch(n){console.error("[SETTINGS] Polling error:",n)}},1e4);q(a)},[Ue,se]=l.useState(!1),[ae,U]=l.useState(!1),[ne,$]=l.useState(!1),[re,z]=l.useState(!1),[ie,$e]=l.useState(""),[le,G]=l.useState(null),[ce,de]=l.useState(!1),[Q,V]=l.useState(null);console.log("[SETTINGS] State variables initialized successfully");const u=l.useMemo(()=>Qe(),[]),Re=async(t,s)=>{var h,d;console.log("[DEBUG] runGQL called with query:",t),console.log("[DEBUG] runGQL variables:",s);const a=JSON.stringify({query:t,variables:s});console.log("[DEBUG] runGQL body:",a);const n=await u("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:a});if(console.log("[DEBUG] runGQL response:",n),(h=n==null?void 0:n.errors)!=null&&h.length)throw console.error("[DEBUG] GraphQL errors:",n.errors),new Error(((d=n.errors[0])==null?void 0:d.message)||"GraphQL error");return n==null?void 0:n.data},[he,_e]=l.useState(!1),[Xe,Ze]=l.useState(!1),[et,tt]=l.useState(""),[ot,Fe]=l.useState({enabled:!1,generating:!1,generated:!1,progress:""}),[M,f]=l.useState(!1),[w,W]=l.useState({current:0,total:0,percent:0,currentProduct:"",stats:{siteFAQ:!1,products:0,totalSchemas:0}}),[I,y]=l.useState(!1),r=Ke("shop","");l.useEffect(()=>{if(!r){K(!1);return}qe()},[r,u]),l.useEffect(()=>{he&&Je()},[he]),l.useEffect(()=>{o&&Object.values(o.features||{}).some(t=>t)&&B(t=>({...t,enabled:!0,discoveryEnabled:!0}))},[o==null?void 0:o.features]);const Je=async()=>{try{const t=await u(`/api/schema/status?shop=${r}`);Fe({enabled:t.enabled,generating:t.generating,generated:t.hasSiteFAQ||t.productsWithSchema>0,progress:t.progress||""})}catch(t){console.error("Failed to check schema status:",t)}},H=async()=>{try{const t=await u(`/ai/schema-data.json?shop=${r}`);if(t.schemas&&t.schemas.length>0){y(!0),f(!1);const s=[...new Set(t.schemas.map(a=>{var n,h;return(h=(n=a.url)==null?void 0:n.split("/products/")[1])==null?void 0:h.split("#")[0]}))].filter(Boolean);W(a=>({...a,percent:100,stats:{siteFAQ:!!t.site_faq,products:s.length,totalSchemas:t.schemas.length}}))}else W(s=>({...s,percent:Math.min(s.percent+10,90),currentProduct:"Processing products..."})),setTimeout(H,3e3)}catch(t){console.error("Progress check error:",t),setTimeout(H,3e3)}},qe=async()=>{try{const t=await u(`/api/ai-discovery/settings?shop=${r}`);console.log("Loaded settings:",t),console.log("Settings plan:",t==null?void 0:t.plan),console.log("Normalized plan:",A(t==null?void 0:t.plan)),B(t),V(t),_e(t.advancedSchemaEnabled||!1),R(t)}catch(t){console.error("Failed to load settings:",t),c("Failed to load settings")}finally{K(!1)}},R=async(t=o)=>{console.log("[GENERATE ROBOTS] Called with shop:",r);try{const s=await u(`/api/ai-discovery/robots-txt?shop=${r}`,{responseType:"text"});console.log("[GENERATE ROBOTS] Received:",s),F(s||`User-agent: *
Disallow: /`)}catch(s){console.error("[GENERATE ROBOTS] Error:",s),F(`# Error generating robots.txt
# `+s.message)}};console.log("[SETTINGS DEBUG] generateRobotsTxt function exists:",typeof R);const Y=t=>{var s;if(!((s=o==null?void 0:o.availableBots)!=null&&s.includes(t))){c(`Upgrade to ${requiredPlan} plan to enable ${o.bots[t].name}`);return}B(a=>({...a,bots:{...a.bots,[t]:{...a.bots[t],enabled:!a.bots[t].enabled}}})),se(!0)},pe=t=>{if(!ge(t)){c(`Upgrade your plan to enable ${{productsJson:"Products JSON Feed",aiSitemap:"AI-Optimized Sitemap",welcomePage:"AI Welcome Page",collectionsJson:"Collections JSON Feed",storeMetadata:"Store Metadata",schemaData:"Schema Data"}[t]||t}`);return}B(s=>({...s,features:{...s.features,[t]:!s.features[t]}}))},ze=async()=>{var t,s,a,n,h;console.log("[SETTINGS] ===== SAVE SETTINGS CALLED ====="),console.log("[SETTINGS] Current settings:",o),X(!0);try{if(await u(`/api/ai-discovery/settings?shop=${r}`,{method:"POST",body:{shop:r,bots:o.bots,features:o.features}}),se(!1),V(o),R(),console.log("[SETTINGS] Checking AI Sitemap feature:",(t=o.features)==null?void 0:t.aiSitemap),(s=o.features)!=null&&s.aiSitemap)try{console.log("[SETTINGS] ===== AI SITEMAP BACKGROUND REGENERATION START ====="),console.log("[SETTINGS] AI Sitemap enabled, starting background regeneration..."),console.log("[SETTINGS] Shop:",r);const d=`
            mutation RegenerateSitemap($shop: String!) {
              regenerateSitemap(shop: $shop) {
                success
                message
                shop
              }
            }
          `;console.log("[SETTINGS] GraphQL mutation:",d),console.log("[SETTINGS] Variables:",{shop:r});const g=await u("/graphql",{method:"POST",body:JSON.stringify({query:d,variables:{shop:r}}),shop:r});console.log("[SETTINGS] GraphQL sitemap regeneration result:",g),(n=(a=g==null?void 0:g.data)==null?void 0:a.regenerateSitemap)!=null&&n.success?(console.log("[SETTINGS] Background regeneration started successfully"),console.log("[SETTINGS] Setting toast for AI sitemap regeneration with delay..."),c(""),setTimeout(()=>{c("Settings saved! AI-Optimized Sitemap is being regenerated in the background. This may take a few moments."),console.log("[SETTINGS] Success toast set after delay"),Be()},100)):(console.log("[SETTINGS] Background regeneration failed:",(h=g==null?void 0:g.data)==null?void 0:h.regenerateSitemap),console.log("[SETTINGS] Setting toast for failed regeneration..."),c(""),setTimeout(()=>{c("Settings saved, but sitemap regeneration failed"),console.log("[SETTINGS] Error toast set after delay")},100)),console.log("[SETTINGS] ===== AI SITEMAP BACKGROUND REGENERATION END =====")}catch(d){console.error("[SETTINGS] Failed to start sitemap regeneration:",d),c("Settings saved, but sitemap regeneration failed")}else console.log("[SETTINGS] AI Sitemap disabled, skipping background regeneration"),console.log("[SETTINGS] Setting toast for basic save with delay..."),c(""),setTimeout(()=>{c("Settings saved successfully"),console.log("[SETTINGS] Basic success toast set after delay"),console.log("[SETTINGS] Basic save completed, not showing View buttons")},100)}catch(d){console.error("Failed to save settings:",d),c("Failed to save settings")}finally{X(!1)}},st=()=>{navigator.clipboard.writeText(_),c("Copied to clipboard!")},at=async()=>{try{const t=await u(`/api/ai-discovery/apply-robots?shop=${r}`,{method:"POST",body:{shop:r}});c("robots.txt applied successfully!")}catch(t){console.error("Failed to apply robots.txt:",t),c(t.message)}},ge=t=>{var n;const s=A(o==null?void 0:o.plan);return((n={productsJson:["starter","professional","growth","growth_extra","enterprise"],aiSitemap:["starter","professional","growth","growth_extra","enterprise"],welcomePage:["professional","growth","growth_extra","enterprise"],collectionsJson:["growth","growth_extra","enterprise"],storeMetadata:["growth_extra","enterprise"],schemaData:["enterprise"]}[t])==null?void 0:n.includes(s))||!1},D=async t=>{console.log(`[DEBUG] setTestPlan called with plan: ${t}, shop: ${r}`);try{const s=`
        mutation SetPlan($shop:String!, $plan: PlanEnum) {
          setPlanOverride(shop:$shop, plan:$plan) { shop plan }
        }
      `;console.log("[DEBUG] GraphQL mutation:",s),console.log("[DEBUG] Variables:",{shop:r,plan:t});const a=await Re(s,{shop:r,plan:t});console.log("[DEBUG] GraphQL result:",a),c(`Test plan set to ${t||"actual"}`),setTimeout(()=>window.location.reload(),500)}catch(s){console.error("[DEBUG] Failed to set test plan",s),c(`Failed to set test plan: ${s.message}`)}},k=async(t,s)=>{var a,n,h;$e(s),z(!0),de(!0),G(null);try{const d={productsJson:`/ai/products.json?shop=${r}`,collectionsJson:`/ai/collections-feed.json?shop=${r}`,storeMetadata:`/ai/store-metadata.json?shop=${r}`,schemaData:`/ai/schema-data.json?shop=${r}`,aiSitemap:`/api/sitemap/generate?shop=${r}&force=true`,welcomePage:`/ai/welcome?shop=${r}`};if(t==="aiSitemap"){console.log("[SETTINGS] Loading AI Sitemap XML...");const g=await fetch(d[t],{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${((h=(n=(a=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:a.getState())==null?void 0:n.session)==null?void 0:h.token)||""}`}});if(g.ok){console.log("[SETTINGS] AI Sitemap XML loaded successfully");const T=await g.text();G(T)}else throw new Error(`HTTP ${g.status}: ${g.statusText}`)}else{const g=await u(d[t]);G(JSON.stringify(g,null,2))}}catch(d){console.error("[SETTINGS] Error loading data:",d),G(`Error loading data: ${d.message}`)}finally{de(!1)}};return r?be?e.jsx(E,{children:e.jsx(p,{padding:"400",children:e.jsxs(b,{align:"center",children:[e.jsx(me,{size:"small"}),e.jsx(i,{children:"Loading settings..."})]})})}):e.jsxs(S,{gap:"600",children:[e.jsx(E,{children:e.jsx(p,{padding:"400",children:e.jsxs(S,{gap:"400",children:[e.jsxs(b,{align:"space-between",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"AI Bot Access Control"}),(o==null?void 0:o.plan)&&e.jsxs(O,{tone:"info",children:[o.plan.charAt(0).toUpperCase()+o.plan.slice(1)," Plan"]})]}),e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Choose which AI bots can access your store's structured data"}),e.jsx(j,{status:"info",children:e.jsxs(S,{gap:"200",children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"How it works:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginBottom:0},children:[e.jsx("li",{children:"Select AI bots below"}),e.jsx("li",{children:"Save Settings"}),e.jsx("li",{children:"Generate robots.txt"})]})]})}),e.jsx(xe,{}),e.jsxs(S,{gap:"300",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["openai","perplexity"].map(t=>{var T,ue,Se;const s=(T=o==null?void 0:o.bots)==null?void 0:T[t];if(!s)return null;const a={starter:["openai","perplexity"],professional:["openai","anthropic","perplexity"],growth:["openai","anthropic","google","perplexity","meta","others"],growth_extra:["openai","anthropic","google","perplexity","meta","others"],enterprise:["openai","anthropic","google","perplexity","meta","others"]},n=A(o==null?void 0:o.plan),d=(a[n]||a.starter).includes(t),g=t==="anthropic"?"Professional":t==="google"?"Growth":["meta","others"].includes(t)?"Growth Extra":null;return e.jsx(p,{padding:"200",background:d?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(S,{gap:"100",children:e.jsx(L,{label:e.jsxs(b,{gap:"200",align:"center",children:[e.jsx(i,{variant:d?"bodyMd":"bodySm",tone:d?"base":"subdued",children:s.name||t}),!d&&g&&e.jsxs(O,{tone:"info",size:"small",children:[g,"+"]})]}),checked:!!((Se=(ue=o==null?void 0:o.bots)==null?void 0:ue[t])!=null&&Se.enabled),onChange:()=>Y(t),disabled:!d,helpText:d?t==="openai"?"Most popular AI assistant":t==="anthropic"?"Claude AI assistant":t==="google"?"Google Gemini":t==="perplexity"?"AI-powered search":t==="meta"?"Meta AI platforms":t==="others"?"Bytespider, DeepSeek, etc.":"":`Upgrade to ${g} plan to enable this AI bot`})})},t)})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["anthropic","google"].map(t=>{var h,d,g,T;const s=(h=o==null?void 0:o.bots)==null?void 0:h[t];if(!s)return null;const a=(d=o==null?void 0:o.availableBots)==null?void 0:d.includes(t),n=t==="anthropic"?"Professional":t==="google"?"Growth":["meta","others"].includes(t)?"Growth Extra":null;return e.jsx(p,{padding:"200",background:a?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(S,{gap:"100",children:e.jsx(L,{label:e.jsxs(b,{gap:"200",align:"center",children:[e.jsx(i,{variant:a?"bodyMd":"bodySm",tone:a?"base":"subdued",children:s.name||t}),!a&&n&&e.jsxs(O,{tone:"info",size:"small",children:[n,"+"]})]}),checked:!!((T=(g=o==null?void 0:o.bots)==null?void 0:g[t])!=null&&T.enabled),onChange:()=>Y(t),disabled:!a,helpText:a?t==="openai"?"Most popular AI assistant":t==="anthropic"?"Claude AI assistant":t==="google"?"Google Gemini":t==="perplexity"?"AI-powered search":t==="meta"?"Meta AI platforms":t==="others"?"Bytespider, DeepSeek, etc.":"":`Upgrade to ${n} plan to enable this AI bot`})})},t)})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["meta","others"].map(t=>{var h,d,g,T;const s=(h=o==null?void 0:o.bots)==null?void 0:h[t];if(!s)return null;const a=(d=o==null?void 0:o.availableBots)==null?void 0:d.includes(t),n=t==="anthropic"?"Professional":t==="google"?"Growth":["meta","others"].includes(t)?"Growth Extra":null;return e.jsx(p,{padding:"200",background:a?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(S,{gap:"100",children:e.jsx(L,{label:e.jsxs(b,{gap:"200",align:"center",children:[e.jsx(i,{variant:a?"bodyMd":"bodySm",tone:a?"base":"subdued",children:s.name||t}),!a&&n&&e.jsxs(O,{tone:"info",size:"small",children:[n,"+"]})]}),checked:!!((T=(g=o==null?void 0:o.bots)==null?void 0:g[t])!=null&&T.enabled),onChange:()=>Y(t),disabled:!a,helpText:a?t==="openai"?"Most popular AI assistant":t==="anthropic"?"Claude AI assistant":t==="google"?"Google Gemini":t==="perplexity"?"AI-powered search":t==="meta"?"Meta AI platforms":t==="others"?"Bytespider, DeepSeek, etc.":"":`Upgrade to ${n} plan to enable this AI bot`})})},t)})})]})]})})}),e.jsx(E,{children:e.jsx(p,{padding:"400",children:e.jsxs(S,{gap:"400",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"robots.txt Configuration"}),Ue&&e.jsx(j,{status:"warning",title:"Unsaved changes",children:e.jsx("p",{children:'You have unsaved bot selections. Please click "Save Settings" before configuring robots.txt.'})}),e.jsx(j,{children:e.jsx("p",{children:["growth","growth_extra","enterprise"].includes(A(o==null?void 0:o.plan))?"With your plan, you can apply robots.txt changes directly to your theme!":"Copy the generated rules and add them to your theme's robots.txt.liquid file."})}),e.jsxs(b,{gap:"200",children:[e.jsx(m,{onClick:async()=>{console.log("[ADD MANUAL] Starting..."),console.log("[ADD MANUAL] Settings:",o);try{const t=Object.values((o==null?void 0:o.bots)||{}).some(s=>s.enabled);console.log("[ADD MANUAL] Has selected bots:",t),t?(console.log("[ADD MANUAL] Calling generateRobotsTxt..."),await R(),console.log("[ADD MANUAL] Robots.txt generated, showing instructions"),$(!0)):(console.log("[ADD MANUAL] No bots, showing modal"),U(!0))}catch(t){console.error("[ADD MANUAL] Error:",t),c("Error generating robots.txt: "+t.message)}},children:"Add manually"}),["growth","growth_extra","enterprise"].includes(A(o==null?void 0:o.plan))&&e.jsx(m,{primary:!0,onClick:async()=>{console.log("[APPLY AUTO] Starting..."),console.log("[APPLY AUTO] Settings:",o),console.log("[APPLY AUTO] Bots:",o==null?void 0:o.bots);try{const t=Object.values((o==null?void 0:o.bots)||{}).some(a=>a.enabled);if(console.log("[APPLY AUTO] Has selected bots:",t),!t){console.log("[APPLY AUTO] No bots selected, showing modal"),U(!0);return}console.log("[APPLY AUTO] Applying robots.txt...");const s=await u(`/api/ai-discovery/apply-robots?shop=${r}`,{method:"POST",shop:r,body:{shop:r}});console.log("[APPLY AUTO] Data:",s),c(s.message||"robots.txt applied successfully!")}catch(t){console.error("[APPLY AUTO] Error:",t),c(t.message)}},children:"Apply Automatically"})]})]})})}),e.jsx(p,{paddingInlineStart:"600",paddingInlineEnd:"600",children:e.jsxs(b,{align:"center",blockAlign:"center",children:[e.jsx(p,{children:e.jsx(Ve,{source:We,color:"subdued"})}),e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Configure what data the AI bots can access"})]})}),e.jsx(E,{children:e.jsx(p,{padding:"400",children:e.jsxs(S,{gap:"400",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"AI Discovery Features"}),e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Select the features you want to enable for AI bots to consume your store data."}),e.jsx(j,{status:"info",children:`Don't forget to click "Save Settings" after making changes.`}),e.jsx(xe,{}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1rem"},children:[{key:"productsJson",name:"Products JSON Feed",description:"Bulk product data for AI consumption",requiredPlan:null},{key:"aiSitemap",name:"AI-Optimized Sitemap",description:"Enhanced sitemap with AI hints",requiredPlan:null},{key:"welcomePage",name:"AI Welcome Page",description:"Landing page for AI bots",requiredPlan:"Professional"},{key:"collectionsJson",name:"Collections JSON Feed",description:"Category data for better AI understanding",requiredPlan:"Growth"},{key:"storeMetadata",name:"Store Metadata for AI Search",description:"Organization & LocalBusiness schema",requiredPlan:"Growth Extra"},{key:"schemaData",name:"Advanced Schema Data",description:"BreadcrumbList, FAQPage & more",requiredPlan:"Enterprise"}].map(t=>{var n;const s=ge(t.key),a=!!((n=o==null?void 0:o.features)!=null&&n[t.key]);return e.jsx(p,{padding:"200",background:s?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:s?e.jsxs(b,{align:"space-between",blockAlign:"center",children:[e.jsx(p,{flexGrow:1,children:e.jsx(L,{label:t.name,checked:a,onChange:()=>pe(t.key),helpText:t.description})}),t.key==="aiSitemap"&&Ie&&e.jsx(m,{size:"slim",onClick:()=>k(t.key,t.name),children:"View"}),t.key==="productsJson"&&we&&e.jsx(m,{size:"slim",onClick:()=>k(t.key,t.name),children:"View"}),t.key==="collectionsJson"&&Ee&&e.jsx(m,{size:"slim",onClick:()=>k(t.key,t.name),children:"View"}),t.key==="storeMetadata"&&Ce&&e.jsx(m,{size:"slim",onClick:()=>k(t.key,t.name),children:"View"}),t.key==="welcomePage"&&Pe&&e.jsx(m,{size:"slim",onClick:()=>k(t.key,t.name),children:"View"})]}):e.jsx(L,{label:e.jsxs(b,{gap:"200",align:"center",children:[e.jsx(i,{variant:"bodySm",tone:"subdued",children:t.name}),t.requiredPlan&&e.jsxs(O,{tone:"info",size:"small",children:[t.requiredPlan,t.requiredPlan!=="Enterprise"&&"+"]})]}),checked:!1,onChange:()=>pe(t.key),disabled:!0,helpText:`Upgrade to ${t.requiredPlan} plan to enable`})},t.key)})})]})})}),A(o==null?void 0:o.plan)==="enterprise"&&((C=o==null?void 0:o.features)==null?void 0:C.schemaData)&&((v=Q==null?void 0:Q.features)==null?void 0:v.schemaData)&&e.jsx(E,{children:e.jsx(p,{padding:"400",children:e.jsxs(S,{gap:"400",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"Advanced Schema Data Management"}),e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Generate and manage structured data for your products"}),e.jsxs(b,{gap:"300",children:[e.jsx(m,{primary:!0,onClick:async()=>{const t=await u(`/ai/schema-data.json?shop=${r}`);if(!(t.schemas&&t.schemas.length>0&&!confirm("This will replace existing schema data. Continue?"))){f(!0),y(!1),W({current:0,total:0,percent:0,currentProduct:"Initializing...",stats:{siteFAQ:!1,products:0,totalSchemas:0}});try{const s=await u(`/api/schema/generate-all?shop=${r}`,{method:"POST",shop:r,body:{shop:r}});setTimeout(H,2e3)}catch(s){console.error("Error:",s),c("Failed to generate schema"),f(!1)}}},children:"Generate/Update Schema Data"}),e.jsx(m,{onClick:()=>{window.open(`/ai/schema-data.json?shop=${r}`,"_blank")},children:"View Generated Schema"}),e.jsx(m,{destructive:!0,onClick:async()=>{if(confirm("This will delete all advanced schema data. Are you sure?"))try{await u(`/api/schema/delete?shop=${r}`,{method:"DELETE",shop:r,body:{shop:r}}),c("Schema data deleted successfully")}catch{c("Failed to delete schema data")}},children:"Delete Schema Data"})]}),e.jsx(j,{status:"info",tone:"subdued",children:e.jsxs("p",{children:["Generation creates BreadcrumbList, FAQPage, WebPage and more schemas for each product. AI can access them at ",e.jsx("code",{children:"/ai/product/[handle]/schemas.json"})]})})]})})}),e.jsxs(b,{gap:"200",align:"end",children:[e.jsx(m,{tone:"critical",onClick:async()=>{if(window.confirm("Are you sure you want to reset all AI Discovery settings to defaults?"))try{await u(`/api/ai-discovery/settings?shop=${r}`,{method:"DELETE",shop:r}),c("Settings reset successfully"),V(null),setTimeout(()=>{window.location.reload()},1e3)}catch(t){console.error("Failed to reset:",t),c("Failed to reset settings")}},children:"Reset to Defaults"}),e.jsx(m,{primary:!0,size:"large",loading:fe,onClick:ze,disabled:!o,children:"Save Settings"})]}),Z&&e.jsx(x,{open:Z,onClose:()=>J(!1),title:"robots.txt Configuration",primaryAction:{content:"Copy to clipboard",onAction:()=>{navigator.clipboard.writeText(_),c("Copied to clipboard!")}},secondaryActions:[{content:"Close",onAction:()=>J(!1)}],children:e.jsx(x.Section,{children:e.jsxs(S,{gap:"400",children:[!["growth","growth_extra","enterprise"].includes(A(o==null?void 0:o.plan))&&e.jsx(j,{status:"info",title:"Manual Configuration Steps",children:e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:"Copy the robots.txt content below"}),e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Online Store → Themes"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Actions → Edit code"})," on your active theme"]}),e.jsxs("li",{children:["In the file browser, look for ",e.jsx("strong",{children:"robots.txt.liquid"})]}),e.jsxs("li",{children:["If it doesn't exist, click ",e.jsx("strong",{children:"Add a new template"}),' → Select "robots" → Create']}),e.jsx("li",{children:"Replace the content with what you copied"}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Save"})]})]})}),e.jsx(p,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:_})})]})})}),ae&&e.jsx(x,{open:ae,onClose:()=>U(!1),title:"No AI Bots Selected",primaryAction:{content:"Got it",onAction:()=>U(!1)},children:e.jsx(x.Section,{children:e.jsxs(S,{gap:"400",children:[e.jsx(j,{status:"warning",children:e.jsx("p",{children:"You haven't selected any AI bots yet."})}),e.jsx(i,{children:"To configure robots.txt:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:'Select AI bots from the "AI Bot Access Control" section above'}),e.jsx("li",{children:'Click "Save Settings" to save your selections'}),e.jsx("li",{children:'Then click "Apply Automatically" to configure robots.txt'})]})]})})}),ne&&e.jsx(x,{open:ne,onClose:()=>$(!1),title:"Manual robots.txt Configuration",primaryAction:{content:"Continue",onAction:()=>{$(!1),J(!0)}},secondaryActions:[{content:"Cancel",onAction:()=>$(!1)}],children:e.jsx(x.Section,{children:e.jsxs(S,{gap:"400",children:[e.jsx(i,{variant:"headingMd",children:"How to add robots.txt manually:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:'Click "Continue" to see your custom robots.txt content'}),e.jsx("li",{children:"Copy the generated content"}),e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Online Store → Themes"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Actions → Edit code"})," on your active theme"]}),e.jsxs("li",{children:["Find or create ",e.jsx("strong",{children:"robots.txt.liquid"})," file"]}),e.jsx("li",{children:"Paste the content and save"})]}),e.jsx(j,{status:"info",children:e.jsx("p",{children:"This allows AI bots to discover and properly index your products."})})]})})}),e.jsx(E,{children:e.jsx(p,{padding:"400",children:e.jsxs(S,{gap:"400",children:[e.jsx(i,{as:"h2",variant:"headingMd",children:"Test Plan Switcher (Dev Only)"}),e.jsxs(b,{gap:"200",children:[e.jsx(m,{onClick:()=>D("starter"),children:"Starter"}),e.jsx(m,{onClick:()=>D("professional"),children:"Professional"}),e.jsx(m,{onClick:()=>D("growth"),children:"Growth"}),e.jsx(m,{onClick:()=>D("growth_extra"),children:"Growth Extra"}),e.jsx(m,{onClick:()=>D("enterprise"),children:"Enterprise"})]})]})})}),re&&e.jsx(x,{open:re,onClose:()=>{z(!1),G(null)},title:ie,primaryAction:{content:"Copy",onAction:()=>{navigator.clipboard.writeText(le),c("Copied to clipboard!")},disabled:ce},secondaryActions:[{content:"Close",onAction:()=>{z(!1),G(null)}}],children:e.jsx(x.Section,{children:e.jsx(p,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:ce?e.jsxs(b,{align:"center",gap:"200",children:[e.jsx(me,{size:"small"}),e.jsx(i,{variant:"bodyMd",children:ie==="AI-Optimized Sitemap"?"Loading sitemap XML... This may take a moment for large stores.":"Loading..."})]}):e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:le})})})}),P("Modal states",{schemaGenerating:M,schemaComplete:I,modalShouldShow:M&&!I}),M&&!I&&e.jsx(x,{open:M,title:"Generating Advanced Schema Data",onClose:()=>{P("Modal close clicked"),f(!1)},children:e.jsx(x.Section,{children:e.jsxs(i,{children:["Modal is showing! Progress: ",w.percent,"%"]})})}),I&&e.jsx(x,{open:!0,title:"Schema Generation Complete",onClose:()=>{f(!1),y(!1)},primaryAction:{content:"View Generated Schemas",onAction:()=>{window.open(`/ai/schema-data.json?shop=${r}`,"_blank"),f(!1),y(!1)}},secondaryActions:[{content:"Close",onAction:()=>{f(!1),y(!1)}}],children:e.jsx(x.Section,{children:e.jsxs(S,{gap:"400",children:[e.jsx(j,{status:"success",title:"Generation successful!",children:e.jsx("p",{children:"Advanced schema data has been generated for your products."})}),e.jsx(i,{variant:"headingMd",children:"Generation Statistics"}),e.jsxs(b,{gap:"600",wrap:!0,children:[e.jsxs(p,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Site FAQ"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:w.stats.siteFAQ?"✓":"—"})]}),e.jsxs(p,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Products Processed"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:w.stats.products})]}),e.jsxs(p,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Total Schemas"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:w.stats.totalSchemas})]})]}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Schemas are now available at /ai/product/[handle]/schemas.json"})})]})})}),M&&!I&&e.jsx(x,{open:!0,title:"Generating Advanced Schema Data",onClose:()=>{},noScroll:!0,children:e.jsx(x.Section,{children:e.jsxs(S,{gap:"400",children:[e.jsx(i,{variant:"bodyMd",children:"Generating schemas for your products..."}),e.jsx(He,{progress:w.percent,size:"small"}),e.jsx(i,{variant:"bodySm",tone:"subdued",children:"This process may take 1-2 minutes depending on the number of products."})]})})}),I&&e.jsx(x,{open:!0,title:"Schema Generation Complete",onClose:()=>{f(!1),y(!1)},primaryAction:{content:"View Generated Schemas",onAction:()=>{window.open(`/ai/schema-data.json?shop=${r}`,"_blank"),f(!1),y(!1)}},secondaryActions:[{content:"Close",onAction:()=>{f(!1),y(!1)}}],children:e.jsx(x.Section,{children:e.jsxs(S,{gap:"400",children:[e.jsx(j,{status:"success",title:"Generation successful!",children:e.jsx("p",{children:"Advanced schema data has been generated for your products."})}),e.jsx(i,{variant:"headingMd",children:"Generation Statistics"}),e.jsxs(b,{gap:"600",wrap:!0,children:[e.jsxs(p,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Site FAQ"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:w.stats.siteFAQ?"✓":"—"})]}),e.jsxs(p,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Products Processed"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:w.stats.products})]}),e.jsxs(p,{children:[e.jsx(i,{variant:"bodyMd",tone:"subdued",children:"Total Schemas"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",children:w.stats.totalSchemas})]})]}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Schemas are now available at /ai/product/[handle]/schemas.json"})})]})})}),N&&e.jsx(Ye,{content:N,onDismiss:()=>c("")})]}):e.jsx(E,{children:e.jsx(p,{padding:"400",children:e.jsx(i,{tone:"critical",children:"Missing shop parameter"})})})}catch(P){return console.error("[SETTINGS] Component initialization error:",P),e.jsx(S,{gap:"400",children:e.jsx(E,{children:e.jsxs(p,{padding:"400",children:[e.jsx(i,{variant:"headingMd",children:"Settings Error"}),e.jsx(p,{paddingBlockStart:"200",children:e.jsxs(i,{children:["Failed to load settings: ",P.message]})})]})})})}}export{ct as default};
