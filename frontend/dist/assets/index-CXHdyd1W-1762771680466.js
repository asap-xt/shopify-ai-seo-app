const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-C0EfImu9-1762771680466.js","assets/app-bridge-FLWQfiB0-1762771680466.js","assets/react-vendor-tAaa2TlE-1762771680466.js","assets/sessionFetch-CJepNHo3-1762771680466.js","assets/polaris-CgwCyutd-1762771680466.js","assets/BulkEdit-CLaLnQuN-1762771680466.js","assets/useShopApi-BLzyVV-c-1762771680466.js","assets/StoreMetadataBanner-C0_MSXY6-1762771680466.js","assets/InsufficientTokensModal-XtPv6ORu-1762771680466.js","assets/Collections-B2Rrb2RJ-1762771680466.js","assets/Sitemap-C9F_58_t-1762771680466.js","assets/StoreMetadata-DBvHvPVq-1762771680466.js","assets/SchemaData-Dqu4UAVq-1762771680466.js","assets/Settings--eGAFxBJ-1762771680466.js","assets/AiTesting-DmMtha6l-1762771680466.js","assets/Billing-KPW1Btx1-1762771680466.js","assets/CleanUninstall-CfOD0t7c-1762771680466.js","assets/ContactSupport-cM_R8317-1762771680466.js"])))=>i.map(i=>d[i]);
import{j as e}from"./app-bridge-FLWQfiB0-1762771680466.js";import{a as q,r as d,R as h}from"./react-vendor-tAaa2TlE-1762771680466.js";import{B as x,I as z,T as E,C as B,A as N,F as O,P as k}from"./polaris-CgwCyutd-1762771680466.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const t of n)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function i(n){const t={};return n.integrity&&(t.integrity=n.integrity),n.referrerPolicy&&(t.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?t.credentials="include":n.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(n){if(n.ep)return;n.ep=!0;const t=i(n);fetch(n.href,t)}})();var V,C=q;V=C.createRoot,C.hydrateRoot;const H="modulepreload",J=function(o){return"/"+o},D={},u=function(s,i,a){let n=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));n=Promise.allSettled(i.map(c=>{if(c=J(c),c in D)return;D[c]=!0;const p=c.endsWith(".css"),y=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${y}`))return;const g=document.createElement("link");if(g.rel=p?"stylesheet":H,p||(g.as="script"),g.crossOrigin="",g.href=c,l&&g.setAttribute("nonce",l),document.head.appendChild(g),p)return new Promise((j,b)=>{g.addEventListener("load",j),g.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${c}`)))})}))}function t(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return n.then(r=>{for(const l of r||[])l.status==="rejected"&&t(l.reason);return s().catch(t)})},Q=()=>{if(typeof window>"u"||!window.gtag){console.warn("[ANALYTICS] GA4 not loaded");return}console.log("[ANALYTICS] GA4 initialized")},X=()=>{if(typeof window>"u"||!window.fbq){console.warn("[ANALYTICS] Meta Pixel not loaded");return}console.log("[ANALYTICS] Meta Pixel initialized")},M=(o,s="")=>{if(typeof window>"u"||!window.gtag){console.warn("[ANALYTICS] GA4 not available, skipping page view:",o);return}try{window.gtag("event","page_view",{page_path:o,page_title:s||document.title,page_location:window.location.href}),console.log("[ANALYTICS] Page view tracked:",o)}catch(i){console.error("[ANALYTICS] Error tracking page view:",i)}};function Z({sectionTitle:o,lang:s,setLang:i,t:a}){return e.jsx(x,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",background:"bg",children:e.jsx(z,{align:"space-between",blockAlign:"center",children:e.jsx(E,{as:"h1",variant:"headingLg",children:o})})})}const U="en",L={en:()=>u(()=>import("./en-DY--Skhq-1762771680466.js"),[]),de:()=>u(()=>import("./de-BYtsvH6H-1762771680466.js"),[]),es:()=>u(()=>import("./es-Cshzw9pa-1762771680466.js"),[]),fr:()=>u(()=>import("./fr-DGTXCiho-1762771680466.js"),[])},W=Object.keys(L);function ee(){try{const o=localStorage.getItem("app_lang");return W.includes(o)?o:null}catch{return null}}function te(o){try{localStorage.setItem("app_lang",o)}catch{}}function oe(){const[o,s]=d.useState(()=>ee()||U),[i,a]=d.useState({});d.useEffect(()=>{let t=!1;async function r(){const c=await(L[o]||L[U])();t||a(c.default||c)}return r(),te(o),()=>{t=!0}},[o]);const n=d.useMemo(()=>(t,r="")=>{const l=t==null?void 0:t.split(".").reduce((c,p)=>c&&c[p]!==void 0?c[p]:void 0,i);return l!=null?String(l):r||t},[i]);return{lang:o,setLang:s,t:n,dict:i,langs:W}}const ne=h.lazy(()=>u(()=>import("./Dashboard-C0EfImu9-1762771680466.js"),__vite__mapDeps([0,1,2,3,4]))),re=h.lazy(()=>u(()=>import("./BulkEdit-CLaLnQuN-1762771680466.js"),__vite__mapDeps([5,1,2,6,7,4,8]))),se=h.lazy(()=>u(()=>import("./Collections-B2Rrb2RJ-1762771680466.js"),__vite__mapDeps([9,1,2,3,7,4,8]))),ie=h.lazy(()=>u(()=>import("./Sitemap-C9F_58_t-1762771680466.js"),__vite__mapDeps([10,1,2,3,4]))),ae=h.lazy(()=>u(()=>import("./StoreMetadata-DBvHvPVq-1762771680466.js"),__vite__mapDeps([11,1,2,3,4]))),ce=h.lazy(()=>u(()=>import("./SchemaData-Dqu4UAVq-1762771680466.js"),__vite__mapDeps([12,1,2,3,4]))),le=h.lazy(()=>(console.log("[APP] ===== LOADING SETTINGS COMPONENT ====="),u(()=>import("./Settings--eGAFxBJ-1762771680466.js"),__vite__mapDeps([13,1,2,3,8,4])))),de=h.lazy(()=>u(()=>import("./AiTesting-DmMtha6l-1762771680466.js"),__vite__mapDeps([14,1,2,3,4]))),G=h.lazy(()=>u(()=>import("./Billing-KPW1Btx1-1762771680466.js"),__vite__mapDeps([15,1,2,4]))),ue=h.lazy(()=>u(()=>import("./CleanUninstall-CfOD0t7c-1762771680466.js"),__vite__mapDeps([16,1,2,3,4]))),pe=h.lazy(()=>u(()=>import("./ContactSupport-cM_R8317-1762771680466.js"),__vite__mapDeps([17,1,2,6,4]))),Y={Polaris:{ResourceList:{sortingLabel:"Sort by"}}},F=(o,s="")=>{try{return new URLSearchParams(window.location.search).get(o)||s}catch{return s}};function he(){const o=a=>a.replace(/^\/apps\/[^/]+/,"")||"/",[s,i]=d.useState(()=>o(window.location.pathname));return d.useEffect(()=>{const a=()=>{const r=o(window.location.pathname);console.log("[useRoute] Location changed to:",r),i(r),M(r)};window.addEventListener("popstate",a);let n=window.location.pathname;const t=setInterval(()=>{window.location.pathname!==n&&(n=window.location.pathname,a())},50);return()=>{window.removeEventListener("popstate",a),clearInterval(t)}},[]),d.useEffect(()=>{Q(),X(),M(s)},[]),{path:s}}function fe({active:o,shop:s}){o==="/"||o.startsWith("/dashboard"),o.startsWith("/ai-seo"),o.startsWith("/billing"),o.startsWith("/settings");const a=new URLSearchParams(window.location.search).get("host"),n=new URLSearchParams;s&&n.set("shop",s),a&&n.set("host",a);const t=n.toString()?`?${n.toString()}`:"";return e.jsxs("ui-nav-menu",{children:[e.jsx("a",{href:`/${t}`,rel:"home",children:"Home"}),e.jsx("a",{href:`/dashboard${t}`,children:"Dashboard"}),e.jsx("a",{href:`/ai-seo${t}`,children:"Search Optimization for AI"}),e.jsx("a",{href:`/settings${t}`,children:"Settings"}),e.jsx("a",{href:`/ai-testing${t}`,children:"AI Testing"}),e.jsx("a",{href:`/billing${t}`,children:"Plans & Billing"}),e.jsx("a",{href:`/clean-uninstall${t}`,children:"Clean & Uninstall"}),e.jsx("a",{href:`/contact-support${t}`,children:"Contact Support"})]})}const ge=h.memo(({shop:o,plan:s})=>{const i=o||F("shop",""),a=window.location.pathname,t=a==="/ai-seo"||a==="/ai-seo/products"?"products":a==="/ai-seo/collections"?"collections":a==="/ai-seo/sitemap"?"sitemap":a==="/ai-seo/store-metadata"?"store-metadata":a==="/ai-seo/schema-data"?"schema-data":"products",r=l=>{const c=new URLSearchParams(window.location.search),p=c.toString()?`?${c.toString()}`:"";return l==="products"?`/ai-seo${p}`:`/ai-seo/${l}${p}`};return e.jsxs("div",{children:[e.jsx(x,{paddingBlockEnd:"400",children:e.jsx(B,{children:e.jsx(x,{padding:"200",children:e.jsxs(z,{gap:"100",children:[e.jsx("a",{href:r("products"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:t==="products"?"#008060":"#f6f6f7",color:t==="products"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Products"}),e.jsx("a",{href:r("collections"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:t==="collections"?"#008060":"#f6f6f7",color:t==="collections"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Collections"}),e.jsx("a",{href:r("sitemap"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:t==="sitemap"?"#008060":"#f6f6f7",color:t==="sitemap"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Sitemap"}),e.jsx("a",{href:r("store-metadata"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:t==="store-metadata"?"#008060":"#f6f6f7",color:t==="store-metadata"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Store metadata"}),e.jsx("a",{href:r("schema-data"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:t==="schema-data"?"#008060":"#f6f6f7",color:t==="schema-data"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Schema Data"})]})})})}),e.jsxs("div",{children:[t==="products"&&e.jsx(re,{shop:i,globalPlan:s}),t==="collections"&&e.jsx(se,{shop:i,globalPlan:s}),t==="sitemap"&&e.jsx(ie,{shop:i}),t==="store-metadata"&&e.jsx(ae,{shop:i}),t==="schema-data"&&e.jsx(ce,{shop:i})]})]})});function me(){const{path:o}=he(),{lang:s,setLang:i,t:a}=oe(),n=!!new URLSearchParams(window.location.search).get("host"),t=F("shop",""),[r,l]=d.useState(null),[c,p]=d.useState(!1),[y,g]=d.useState(!0);d.useEffect(()=>{const K=async()=>{const w=new URLSearchParams(window.location.search),m=w.get("shop"),A=w.get("id_token");if(m&&A)try{console.log("[APP] Performing initial token exchange for shop:",m);const f=await fetch("/token-exchange",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:m,id_token:A})});if(!f.ok){const R=await f.json();console.error("[APP] Token exchange failed:",R);return}const S=await f.json();console.log("[APP] Token exchange successful:",S);const P=new URL(window.location);P.searchParams.delete("id_token"),window.history.replaceState({},"",P),await T(m)}catch(f){console.error("[APP] Token exchange error:",f)}else m&&await T(m)},T=async w=>{var m;try{const f=await fetch("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
          query PlansMe($shop:String!) {
            plansMe(shop:$shop) {
              shop
              plan
              planKey
              priceUsd
              product_limit
              providersAllowed
              modelsSuggested
              subscriptionStatus
              trial {
                active
                ends_at
                days_left
              }
            }
          }
        `,variables:{shop:w}})});if(f.status===202&&(await f.json()).error==="token_exchange_required"){console.log("[APP] Token exchange required, but no id_token available"),window.location.href=`/auth?shop=${encodeURIComponent(w)}`;return}if(!f.ok){console.error("[APP] Failed to load plans:",await f.text());return}const S=await f.json(),P=(m=S==null?void 0:S.data)==null?void 0:m.plansMe;P&&(l(P),P.subscriptionStatus==="pending"&&(console.log("[APP] Subscription pending, forcing billing page..."),p(!0)))}catch(A){console.error("[APP] Error loading initial data:",A)}finally{g(!1)}};K()},[]);const j=d.useMemo(()=>o.startsWith("/ai-seo")?"Search Optimization for AI":o.startsWith("/billing")?"Plans & Billing":o.startsWith("/settings")?"Settings":o.startsWith("/ai-testing")?"AI Testing":o.startsWith("/clean-uninstall")?"Clean & Uninstall":o.startsWith("/contact-support")?"Contact Support":"Dashboard",[o]),b=()=>c?e.jsx(G,{shop:t}):o==="/"||o==="/dashboard"?e.jsx(ne,{shop:t}):o.startsWith("/ai-seo")?e.jsx(ge,{shop:t,plan:r}):o==="/billing"?e.jsx(G,{shop:t}):o==="/settings"?(console.log("[APP] ===== RENDERING SETTINGS PAGE ====="),e.jsx(le,{shop:t})):o==="/contact-support"?(console.log("[APP] ===== RENDERING CONTACT SUPPORT PAGE ====="),e.jsx(pe,{shop:t})):o==="/ai-testing"?(console.log("[APP] ===== RENDERING AI TESTING PAGE ====="),console.log("[APP] Path:",o),console.log("[APP] Shop:",t),e.jsx(de,{shop:t})):o==="/clean-uninstall"?e.jsx(ue,{shop:t}):e.jsx(B,{children:e.jsxs(x,{padding:"400",children:[e.jsx(E,{variant:"headingMd",children:"Page not found"}),e.jsx(x,{paddingBlockStart:"200",children:e.jsxs(E,{children:['The page "',o,'" does not exist.']})})]})});return y&&!r?e.jsx(N,{i18n:Y,children:e.jsx(O,{children:e.jsx(k,{children:e.jsx(x,{padding:"400",children:e.jsx(E,{children:"Loading..."})})})})}):e.jsxs(N,{i18n:Y,children:[n&&e.jsx(fe,{active:o,shop:t}),e.jsx(O,{children:e.jsxs(k,{children:[e.jsx(Z,{sectionTitle:j,lang:s,setLang:i,t:a,shop:t}),b()]})})]})}const v=new URLSearchParams(window.location.search),I=v.get("host"),_=v.get("shop"),$=v.get("embedded")==="1";console.log("[MAIN] Public App - Host:",I,"Shop:",_);console.log("[MAIN] Full URL:",window.location.href);function _e(){const[o,s]=d.useState(!1),i=d.useMemo(()=>(console.log("[MAIN] Checking for API key..."),console.log("[MAIN] window.__SHOPIFY_API_KEY:",window.__SHOPIFY_API_KEY),console.log("[MAIN] import.meta.env.VITE_SHOPIFY_API_KEY:","2749a2f6d38ff5796ed256b5c9dc70a1"),window.__SHOPIFY_API_KEY?(console.log("[MAIN] Using injected API key:",window.__SHOPIFY_API_KEY),window.__SHOPIFY_API_KEY):(console.log("[MAIN] Using env API key:","2749a2f6d38ff5796ed256b5c9dc70a1"),"2749a2f6d38ff5796ed256b5c9dc70a1")),[]);return d.useEffect(()=>{setTimeout(()=>s(!0),100)},[]),!$||!I||!_?(console.log("[MAIN] Not embedded or missing params"),e.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[e.jsx("h1",{children:"Error: App must be loaded from Shopify Admin"}),e.jsxs("p",{children:["Shop: ",_||"Missing"]}),e.jsxs("p",{children:["Host: ",I||"Missing"]}),e.jsxs("p",{children:["Embedded: ",$?"Yes":"No"]}),e.jsx("a",{href:`https://admin.shopify.com/store/${_==null?void 0:_.replace(".myshopify.com","")}/apps`,children:"Go to Shopify Admin"})]})):i?(console.log("[MAIN] App config:",{apiKey:i?"SET":"MISSING",host:I?"SET":"MISSING",shop:_?"SET":"MISSING"}),o?e.jsx(me,{}):e.jsx("div",{children:"Loading..."})):e.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[e.jsx("h1",{children:"Configuration Error"}),e.jsx("p",{children:"Shopify API key is not configured."}),e.jsx("p",{children:"Please contact support."})]})}V(document.getElementById("root")).render(e.jsx(_e,{}));
