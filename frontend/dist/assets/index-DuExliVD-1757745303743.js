const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CQTYkB7a-1757745303743.js","assets/react-vendor-tAaa2TlE-1757745303743.js","assets/index-CQz0VSBv-1757745303743.js","assets/index-Bqj_nbKF-1757745303743.js","assets/BulkEdit-RKCXCEPC-1757745303743.js","assets/app-bridge-ColYhAdH-1757745303743.js","assets/polaris-5c_qu2R2-1757745303743.js","assets/Collections-DRIaI6DI-1757745303743.js","assets/Sitemap-BEg2AdDT-1757745303743.js","assets/StoreMetadata-Dv2Xgpkw-1757745303743.js","assets/SchemaData-IQzAqAvo-1757745303743.js","assets/Settings-Cpoom0ZN-1757745303743.js"])))=>i.map(i=>d[i]);
import{j as t}from"./app-bridge-ColYhAdH-1757745303743.js";import{a as V,r as p,R as E}from"./react-vendor-tAaa2TlE-1757745303743.js";import{P as U,A as H,B as G,I as R,T as h,a as f,C as j,b as $,F as M,c as W}from"./polaris-5c_qu2R2-1757745303743.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function i(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=i(o);fetch(o.href,r)}})();var C,L=V;C=L.createRoot,L.hydrateRoot;const z="modulepreload",q=function(e){return"/"+e},D={},g=function(n,i,s){let o=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=Promise.allSettled(i.map(c=>{if(c=q(c),c in D)return;D[c]=!0;const u=c.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":z,u||(d.as="script"),d.crossOrigin="",d.href=c,l&&d.setAttribute("nonce",l),document.head.appendChild(d),u)return new Promise((_,y)=>{d.addEventListener("load",_),d.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return o.then(a=>{for(const l of a||[])l.status==="rejected"&&r(l.reason);return n().catch(r)})},k=p.createContext(null);function K(){const e=p.useContext(k);return e||console.warn("[useAppBridge] No App Bridge instance in context"),e}function Y({children:e}){const[n,i]=p.useState(null),[s,o]=p.useState(!0),[r,a]=p.useState(null),l=new URLSearchParams(window.location.search),c=l.get("host"),u=l.get("shop"),m="2749a2f6d38ff5796ed256b5c9dc70a1";return console.log("[APP-BRIDGE-PROVIDER] Public App - Initializing with:",{host:c?"Present":"Missing",shop:u?"Present":"Missing",apiKey:"Present"}),p.useEffect(()=>{c||console.warn("[APP-BRIDGE-PROVIDER] No host parameter - app may not be embedded"),g(async()=>{const{createApp:d}=await import("./index-CQTYkB7a-1757745303743.js").then(_=>_.i);return{createApp:d}},__vite__mapDeps([0,1,2])).then(({createApp:d})=>{const _=d({apiKey:m,host:c||u,forceRedirect:!1});console.log("[APP-BRIDGE-PROVIDER] Public App - App instance created"),i(_),window.__SHOPIFY_APP_BRIDGE__=_,o(!1)}).catch(d=>{console.error("[APP-BRIDGE-PROVIDER] Failed to create app:",d),a(d.message),o(!1)})},[m,c,u]),s?t.jsx("div",{children:"Loading..."}):(r&&console.warn("[APP-BRIDGE-PROVIDER] App Bridge initialization failed:",r),t.jsx(k.Provider,{value:n,children:e}))}const J={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_NAME:"NEW AI SEO",VITE_SHOPIFY_API_KEY:"2749a2f6d38ff5796ed256b5c9dc70a1"};let S=null;async function Q(e=!1){var n;if(S)return S;if(window.__SHOPIFY_APP_BRIDGE__)return S=window.__SHOPIFY_APP_BRIDGE__,e&&console.log("[SFETCH] Using global App Bridge instance"),S;try{const i=await g(()=>import("./index-CQTYkB7a-1757745303743.js").then(c=>c.i),__vite__mapDeps([0,1,2])),s=i&&(i.default||i);if(!s)return e&&console.error("[SFETCH] App Bridge module not available"),null;const o=new URLSearchParams(window.location.search).get("host"),r=new URLSearchParams(window.location.search).get("shop"),a=window.__SHOPIFY_API_KEY||import.meta&&J&&"2749a2f6d38ff5796ed256b5c9dc70a1"||((n=document.querySelector('meta[name="shopify-api-key"]'))==null?void 0:n.getAttribute("content"))||null;if(!a)return e&&console.error("[SFETCH] Missing API key for public app"),null;const l=o||r;return l?(S=s({apiKey:a,host:l,forceRedirect:!1}),e&&console.log("[SFETCH] Public App - AppBridge created"),S):(e&&console.warn("[SFETCH] No host or shop parameter - may not be embedded"),null)}catch(i){return e&&console.error("[SFETCH] AppBridge creation failed:",i),null}}async function X(e,n=!1){try{n&&console.log("[SFETCH] Getting token from App Bridge...",{app:!!e});const i=await g(()=>import("./index-Bqj_nbKF-1757745303743.js").then(r=>r.i),__vite__mapDeps([3,1,2])),s=i&&i.getSessionToken;if(!s||!e)return n&&console.log("[SFETCH] No getSessionToken or app:",{getSessionToken:!!s,app:!!e}),null;n&&console.log("[SFETCH] Calling getSessionToken...");const o=await s(e);return n&&console.log("[SFETCH] Got session token?",!!o,o?`(len=${o.length}, head=${o.slice(0,10)}...)`:""),o||null}catch(i){return n&&console.error("[SFETCH] Token fetch failed:",i),null}}function Z({debug:e}={}){const i=e??!1;return async function(o,{method:r="GET",headers:a={},body:l,shop:c}={}){const u=c?`${o}${o.includes("?")?"&":"?"}shop=${encodeURIComponent(c)}`:o,m=await Q(i),d=m?await X(m,i):null;i&&console.log("[SFETCH] Public App →",{url:u,method:r,shopParam:c,hasToken:!!d,tokenHead:d?d.slice(0,10):null}),i&&console.log("[SFETCH] App Bridge details:",{app:!!m,token:!!d,tokenLength:d?d.length:0});const _={method:r,headers:{"Content-Type":"application/json",...a},credentials:"include",body:l?JSON.stringify(l):void 0},y=d?{..._,headers:{..._.headers,Authorization:`Bearer ${d}`}}:_,A=await fetch(u,y);i&&console.log("[SFETCH] Public App ← response",A.status,A.statusText,"for",u);const w=await A.text();let x;try{x=w?JSON.parse(w):null}catch{x={error:(w==null?void 0:w.slice(0,500))||"Non-JSON response"}}if(!A.ok){const N=(x==null?void 0:x.error)||(x==null?void 0:x.message)||`HTTP ${A.status}`,P=new Error(N);throw P.status=A.status,P.body=x,P.debug={url:u,method:r,shopParam:c,hasAuthHeader:!!y.headers.Authorization,tokenHead:d?d.slice(0,10):null},i&&console.error("[SFETCH] ! error",P),P}return x}}const ee=(e,n="")=>{try{return new URLSearchParams(window.location.search).get(e)||n}catch{return n}};function te(){const e=p.useMemo(()=>Z(),[]),n=ee("shop","");return{api:e,shop:n}}const b=["en","de","es","fr"],T={en:"🇬🇧",de:"🇩🇪",es:"🇪🇸",fr:"🇫🇷"},B={en:"English",de:"Deutsch",es:"Español",fr:"Français"};function ne({lang:e="en",setLang:n,t:i}){const[s,o]=p.useState(!1);p.useEffect(()=>{if(!b.includes(e)){try{localStorage.setItem("app_lang","en")}catch{}typeof n=="function"&&n("en")}},[e,n]);const r=b.includes(e)?e:"en",a=t.jsx(G,{onClick:()=>o(c=>!c),disclosure:!0,children:t.jsxs(R,{gap:"200",blockAlign:"center",children:[t.jsx("span",{"aria-hidden":!0,children:T[r]}),t.jsx(h,{as:"span",variant:"bodyMd",children:B[r]})]})}),l=p.useMemo(()=>b.map(c=>({content:`${T[c]} ${B[c]}`,active:c===r,onAction:()=>{try{localStorage.setItem("app_lang",c)}catch{}typeof n=="function"&&n(c),o(!1)}})),[r,n]);return t.jsx(U,{active:s,activator:a,onClose:()=>o(!1),autofocusTarget:"first-node",children:t.jsx(H,{items:l})})}function oe({sectionTitle:e,lang:n,setLang:i,t:s}){return t.jsx(f,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",background:"bg",children:t.jsxs(R,{align:"space-between",blockAlign:"center",children:[t.jsx(h,{as:"h1",variant:"headingLg",children:e}),t.jsx(ne,{lang:n,setLang:i,t:s})]})})}const O="en",v={en:()=>g(()=>import("./en-DY--Skhq-1757745303743.js"),[]),de:()=>g(()=>import("./de-BYtsvH6H-1757745303743.js"),[]),es:()=>g(()=>import("./es-Cshzw9pa-1757745303743.js"),[]),fr:()=>g(()=>import("./fr-DGTXCiho-1757745303743.js"),[])},F=Object.keys(v);function re(){try{const e=localStorage.getItem("app_lang");return F.includes(e)?e:null}catch{return null}}function se(e){try{localStorage.setItem("app_lang",e)}catch{}}function ie(){const[e,n]=p.useState(()=>re()||O),[i,s]=p.useState({});p.useEffect(()=>{let r=!1;async function a(){const c=await(v[e]||v[O])();r||s(c.default||c)}return a(),se(e),()=>{r=!0}},[e]);const o=p.useMemo(()=>(r,a="")=>{const l=r==null?void 0:r.split(".").reduce((c,u)=>c&&c[u]!==void 0?c[u]:void 0,i);return l!=null?String(l):a||r},[i]);return{lang:e,setLang:n,t:o,dict:i,langs:F}}const ae=E.lazy(()=>g(()=>import("./BulkEdit-RKCXCEPC-1757745303743.js"),__vite__mapDeps([4,5,1,6]))),ce=E.lazy(()=>g(()=>import("./Collections-DRIaI6DI-1757745303743.js"),__vite__mapDeps([7,5,1,6]))),le=E.lazy(()=>g(()=>import("./Sitemap-BEg2AdDT-1757745303743.js"),__vite__mapDeps([8,5,1,6]))),de=E.lazy(()=>g(()=>import("./StoreMetadata-Dv2Xgpkw-1757745303743.js"),__vite__mapDeps([9,5,1,6]))),pe=E.lazy(()=>g(()=>import("./SchemaData-IQzAqAvo-1757745303743.js"),__vite__mapDeps([10,5,1,6]))),ue=E.lazy(()=>g(()=>import("./Settings-Cpoom0ZN-1757745303743.js"),__vite__mapDeps([11,5,1,6]))),he={Polaris:{ResourceList:{sortingLabel:"Sort by"}}},I=(e,n="")=>{try{return new URLSearchParams(window.location.search).get(e)||n}catch{return n}};function fe(){const[e,n]=p.useState(window.location.pathname);return p.useEffect(()=>{const i=()=>n(window.location.pathname);return window.addEventListener("popstate",i),()=>window.removeEventListener("popstate",i)},[]),{path:e}}function ge({active:e,shop:n}){e==="/"||e.startsWith("/dashboard"),e.startsWith("/ai-seo"),e.startsWith("/billing"),e.startsWith("/settings");const s=new URLSearchParams(window.location.search).get("host"),o=new URLSearchParams;n&&o.set("shop",n),s&&o.set("host",s);const r=o.toString()?`?${o.toString()}`:"";return t.jsxs("ui-nav-menu",{children:[t.jsx("a",{href:`/${r}`,rel:"home",children:"Home"}),t.jsx("a",{href:`/dashboard${r}`,children:"Dashboard"}),t.jsx("a",{href:`/ai-seo${r}`,children:"Search Optimization for AI"}),t.jsx("a",{href:`/billing${r}`,children:"Billing"}),t.jsx("a",{href:`/settings${r}`,children:"Settings"})]})}const me=E.memo(({shop:e})=>{var r;const[n,i]=p.useState(null),{api:s}=te(),o=e||I("shop","");return p.useEffect(()=>{o&&s("/plans/me",{shop:o}).then(a=>{a&&!a.error&&i(a)}).catch(a=>console.error("Failed to load plan:",a))},[o,s]),p.useEffect(()=>{o&&s("/collections/check-definitions",{shop:o}).then(a=>{const l=(a.definitions||[]).map(m=>m.key),u=["en","bg","fr"].filter(m=>!l.includes(`seo__${m}`));if(u.length>0)return s("/collections/create-definitions",{method:"POST",shop:o,body:{shop:o,languages:u}})}).catch(a=>console.error("Definitions error:",a))},[o,s]),n?t.jsx(j,{title:"Dashboard",children:t.jsxs(f,{padding:"400",children:[t.jsxs(R,{gap:"800",wrap:!1,children:[t.jsxs(f,{children:[t.jsx(h,{variant:"headingMd",as:"h3",children:"Current plan"}),t.jsx(h,{children:n.plan||"Free"})]}),t.jsxs(f,{children:[t.jsx(h,{variant:"headingMd",as:"h3",children:"Shop"}),t.jsx(h,{children:n.shop||"â€”"})]}),t.jsxs(f,{children:[t.jsx(h,{variant:"headingMd",as:"h3",children:"AI queries"}),t.jsxs(h,{children:[n.ai_queries_used||0," / ",n.ai_queries_limit||0]})]}),t.jsxs(f,{children:[t.jsx(h,{variant:"headingMd",as:"h3",children:"Product limit"}),t.jsx(h,{children:n.product_limit||0})]})]}),t.jsxs(f,{paddingBlockStart:"400",children:[t.jsx(h,{variant:"headingMd",as:"h3",children:"Allowed AI providers"}),t.jsx(h,{children:((r=n.providersAllowed)==null?void 0:r.join(", "))||"None"})]}),n.trial_ends_at&&t.jsxs(f,{paddingBlockStart:"400",children:[t.jsx(h,{variant:"headingMd",as:"h3",children:"Trial ends at"}),t.jsx(h,{children:new Date(n.trial_ends_at).toLocaleDateString()})]})]})}):t.jsx(j,{children:t.jsx(f,{padding:"400",children:t.jsx(h,{children:"Loading plan info..."})})})}),_e=E.memo(()=>{const e=I("shop",""),n=window.location.pathname,s=n==="/ai-seo"||n==="/ai-seo/products"?"products":n==="/ai-seo/collections"?"collections":n==="/ai-seo/sitemap"?"sitemap":n==="/ai-seo/store-metadata"?"store-metadata":n==="/ai-seo/schema-data"?"schema-data":"products",o=r=>{const a=new URLSearchParams(window.location.search),l=a.toString()?`?${a.toString()}`:"";return r==="products"?`/ai-seo${l}`:`/ai-seo/${r}${l}`};return t.jsxs("div",{children:[t.jsx(f,{paddingBlockEnd:"400",children:t.jsx(j,{children:t.jsx(f,{padding:"200",children:t.jsxs(R,{gap:"100",children:[t.jsx("a",{href:o("products"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:s==="products"?"#008060":"#f6f6f7",color:s==="products"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Products"}),t.jsx("a",{href:o("collections"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:s==="collections"?"#008060":"#f6f6f7",color:s==="collections"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Collections"}),t.jsx("a",{href:o("sitemap"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:s==="sitemap"?"#008060":"#f6f6f7",color:s==="sitemap"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Sitemap"}),t.jsx("a",{href:o("store-metadata"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:s==="store-metadata"?"#008060":"#f6f6f7",color:s==="store-metadata"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Store metadata"}),t.jsx("a",{href:o("schema-data"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:s==="schema-data"?"#008060":"#f6f6f7",color:s==="schema-data"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Schema Data"})]})})})}),t.jsxs("div",{children:[s==="products"&&t.jsx(ae,{shop:e}),s==="collections"&&t.jsx(ce,{shop:e}),s==="sitemap"&&t.jsx(le,{shop:e}),s==="store-metadata"&&t.jsx(de,{shop:e}),s==="schema-data"&&t.jsx(pe,{shop:e})]})]})});function xe(){K();const{path:e}=fe(),{lang:n,setLang:i,t:s}=ie(),o=!!new URLSearchParams(window.location.search).get("host"),r=I("shop",""),a=p.useMemo(()=>e.startsWith("/ai-seo")?"Search Optimization for AI":e.startsWith("/billing")?"Billing":e.startsWith("/settings")?"Settings":"Dashboard",[e]);console.log("[NAV DEBUG] ========= NAVIGATION DEBUG ========="),console.log("[NAV DEBUG] isEmbedded:",o),console.log("[NAV DEBUG] window.top !== window.self:",window.top!==window.self),console.log("[NAV DEBUG] host param:",new URLSearchParams(window.location.search).get("host")),console.log("[NAV DEBUG] shop:",r),console.log("[NAV DEBUG] path:",e),console.log("[NAV DEBUG] Full URL:",window.location.href),console.log("[NAV DEBUG] window.shopify exists:",!!window.shopify),console.log("[NAV DEBUG] =====================================");const l=()=>e==="/"||e==="/dashboard"?t.jsx(me,{shop:r}):e.startsWith("/ai-seo")?t.jsx(_e,{shop:r}):e==="/billing"?t.jsx(j,{children:t.jsx(f,{padding:"400",children:t.jsx(h,{children:"Billing page"})})}):e==="/settings"?t.jsx(ue,{shop:r}):t.jsx(j,{children:t.jsxs(f,{padding:"400",children:[t.jsx(h,{variant:"headingMd",children:"Page not found"}),t.jsx(f,{paddingBlockStart:"200",children:t.jsxs(h,{children:['The page "',e,'" does not exist.']})})]})});return t.jsxs($,{i18n:he,children:[t.jsx(ge,{active:e,shop:r}),t.jsx(M,{children:t.jsxs(W,{children:[t.jsx(oe,{sectionTitle:a,lang:n,setLang:i,t:s,shop:r}),l()]})})]})}function Ee(){const e=new URLSearchParams(window.location.search),n=e.get("host"),i=e.get("shop");return console.log("[MAIN] Public App - Host:",n,"Shop:",i),console.log("[MAIN] Full URL:",window.location.href),console.log("[MAIN] Rendering with AppBridgeProvider (Public App)"),t.jsx(Y,{children:t.jsx(xe,{})})}C(document.getElementById("root")).render(t.jsx(Ee,{}));export{Z as m,te as u};
