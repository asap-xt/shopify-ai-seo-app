import{j as e}from"./app-bridge-DQuzKKB1-1763497324642.js";import{r as o}from"./react-vendor-tAaa2TlE-1763497324642.js";import{L as d,C as p,B as j,a as s,n as re,T as r,v as ie,w as E,x as H,d as f,I as v,f as oe,D as U,b as I,M as S,y as se,h as le}from"./polaris-CkgGEBWL-1763497324642.js";const B=[10,20,50,100];function ge({shop:h}){var z,G,N;const[Y,D]=o.useState(!0),[g,q]=o.useState(null),[y,R]=o.useState(null),[J,b]=o.useState(!1),[_,T]=o.useState(!1),[K,A]=o.useState(!1),[w,k]=o.useState(""),[P,C]=o.useState(B[0]),[M,m]=o.useState(!1),[F,c]=o.useState(null),[W,L]=o.useState(!1),[V,$]=o.useState(!1),[Q,X]=o.useState(!1),O=o.useCallback(async()=>{var t;try{D(!0),c(null);const a=await fetch(`/api/billing/info?shop=${h}`,{headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP ${a.status}`);const i=await a.json();q(i),(((t=i.subscription)==null?void 0:t.status)==="pending"||!i.subscription)&&$(!0)}catch(a){console.error("[Billing] Error fetching info:",a),c("Failed to load billing information")}finally{D(!1)}},[h]);o.useEffect(()=>{const t=new URLSearchParams(window.location.search);if(t.get("success")==="true"){const a=t.get("host"),i=t.get("embedded");if(X(!0),a&&i){const u=`/dashboard?shop=${encodeURIComponent(h)}&embedded=${i}&host=${encodeURIComponent(a)}`;window.location.href=u}}else O()},[O,h]);const Z=async t=>{try{m(!0),c(null),$(!1);const a=await fetch("/api/billing/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:h,plan:t,endTrial:W})}),i=await a.json();if(!a.ok)throw new Error(i.error||"Failed to create subscription");i.confirmationUrl&&(window.top.location.href=i.confirmationUrl)}catch(a){console.error("[Billing] Subscribe error:",a),c(a.message)}finally{m(!1),b(!1),L(!1)}},ee=async t=>{try{m(!0),c(null);const i=new URLSearchParams(window.location.search).get("returnTo")||"/billing",u=await fetch("/api/billing/tokens/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:h,amount:parseFloat(t),returnTo:i})}),l=await u.json();if(!u.ok)throw new Error(l.error||"Failed to purchase tokens");l.confirmationUrl&&(window.top.location.href=l.confirmationUrl)}catch(a){console.error("[Billing] Purchase error:",a),c(a.message)}finally{m(!1),T(!1)}},ne=t=>{const u=t*.3/.16;return Math.floor(u*1e6)};if(Q)return e.jsx(d,{children:e.jsx(d.Section,{children:e.jsx(p,{children:e.jsx(j,{padding:"800",children:e.jsxs(s,{gap:"400",align:"center",children:[e.jsx(re,{size:"large"}),e.jsx(r,{variant:"headingMd",alignment:"center",children:"Plan Activated Successfully! ðŸŽ‰"}),e.jsx(r,{variant:"bodyMd",tone:"subdued",alignment:"center",children:"Redirecting to your Dashboard..."})]})})})})});if(Y)return e.jsx(ie,{title:"Plans & Billing",primaryAction:!0,children:e.jsxs(d,{children:[e.jsx(d.Section,{children:e.jsx(p,{children:e.jsxs(s,{gap:"400",children:[e.jsx(E,{size:"small"}),e.jsx(H,{lines:3})]})})}),e.jsx(d.Section,{children:e.jsx(p,{children:e.jsxs(s,{gap:"400",children:[e.jsx(E,{size:"medium"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},children:[1,2,3,4].map(t=>e.jsx(p,{children:e.jsxs(s,{gap:"200",children:[e.jsx(E,{size:"small"}),e.jsx(H,{lines:5})]})},t))})]})})})]})});const n=g==null?void 0:g.subscription,x=g==null?void 0:g.tokens,te=((g==null?void 0:g.plans)||[]).filter(t=>!["starter","growth"].includes(t.key));return e.jsxs(e.Fragment,{children:[e.jsxs(d,{children:[F&&e.jsx(d.Section,{children:e.jsx(f,{title:"Error",tone:"critical",onDismiss:()=>c(null),children:e.jsx("p",{children:F})})}),V&&e.jsx(d.Section,{children:e.jsx(f,{title:"ðŸ¤– Future-Proof Your Product Discovery",tone:"success",onDismiss:()=>$(!1),children:e.jsxs(s,{gap:"200",children:[e.jsx("p",{children:"Traditional SEO isn't enough anymore. AI assistants like ChatGPT, Gemini & Perplexity need structured data to recommend your products."}),e.jsx("p",{children:"indexAIze transforms your product data into structured formats optimized for AI search engines, making it easy for ChatGPT, Gemini, Perplexity and others to find and recommend your products."}),e.jsxs("p",{children:[e.jsx("strong",{children:"âœ… Smart approach:"})," Start with a smaller plan to test optimization. Upgrade anytime to scale across your entire catalog."]})]})})}),n&&n.pendingActivation&&!n.pendingPlan&&e.jsx(d.Section,{children:e.jsx(f,{title:"Plan Activation Pending",tone:"warning",action:{content:"Complete Activation",onAction:async()=>{try{m(!0),c(null);const t=await fetch("/api/billing/activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:h,endTrial:!0})}),a=await t.json();if(!t.ok)throw new Error(a.error||"Failed to activate plan");if(a.requiresApproval&&a.confirmationUrl){window.top.location.href=a.confirmationUrl;return}const i=Date.now();window.location.href=`/billing?shop=${encodeURIComponent(h)}&_t=${i}&embedded=${new URLSearchParams(window.location.search).get("embedded")}&host=${encodeURIComponent(new URLSearchParams(window.location.search).get("host")||"")}`}catch(t){console.error("[Billing] Activation error:",t),c(t.message)}finally{m(!1)}}},children:e.jsxs("p",{children:["Your ",n.plan," plan activation is pending. Complete the activation to start using all features."]})})}),(n==null?void 0:n.inTrial)&&!(n!=null&&n.pendingActivation)&&e.jsx(d.Section,{children:e.jsx(f,{title:"Trial Period Active",tone:"info",action:{content:"Activate Plan",onAction:async()=>{try{m(!0),c(null);const t=await fetch("/api/billing/activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:h,endTrial:!0})}),a=await t.json();if(!t.ok)throw new Error(a.error||"Failed to activate plan");if(a.requiresApproval&&a.confirmationUrl){window.top.location.href=a.confirmationUrl;return}const i=Date.now();window.location.href=`/billing?shop=${encodeURIComponent(h)}&_t=${i}&embedded=${new URLSearchParams(window.location.search).get("embedded")}&host=${encodeURIComponent(new URLSearchParams(window.location.search).get("host")||"")}`}catch(t){console.error("[Billing] Activation error:",t),c(t.message)}finally{m(!1)}}},children:e.jsxs("p",{children:["Trial ends on ",new Date(n.trialEndsAt).toLocaleDateString(),". Advanced AI features are locked during trial. Activate your ",n.plan," plan to use them now."]})})}),e.jsx(d.Section,{children:e.jsx(p,{children:e.jsx(s,{gap:"400",children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px",alignItems:"stretch"},children:te.map(t=>{var a;return e.jsx(p,{style:{display:"flex",flexDirection:"column",minHeight:"100%"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 auto",gap:"12px",minHeight:0},children:[e.jsxs(v,{align:"space-between",blockAlign:"center",children:[e.jsx(r,{variant:"headingMd",children:t.name}),(n==null?void 0:n.plan)===t.key&&(n==null?void 0:n.status)==="active"&&((n==null?void 0:n.activatedAt)||(n==null?void 0:n.inTrial))&&e.jsx(oe,{tone:"success",children:"Current"})]}),t.badge&&e.jsx(r,{variant:"bodySm",tone:"subdued",fontWeight:"medium",children:t.badge}),e.jsxs(r,{variant:"heading2xl",children:["$",t.price]}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"per month"}),e.jsx(U,{}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Optimize up to ",e.jsx("strong",{children:((a=t.productLimit)==null?void 0:a.toLocaleString())||"N/A"})," products in up to ",e.jsx("strong",{children:t.languageLimit||1})," ",t.languageLimit===1?"language":"languages"]}),t.features&&t.features.length>0&&e.jsxs(j,{children:[e.jsx(r,{variant:"bodySm",fontWeight:"semibold",children:"Features:"}),e.jsx(s,{gap:"100",children:t.features.map((i,u)=>{const l=i.includes("ðŸ”“")?i.replace(/^âœ“\s*/,"").trim():i,ae=l.startsWith("All from")||l.startsWith("âœ“")||l.includes("ðŸ”“")?l:`âœ“ ${l}`;return e.jsx(r,{variant:"bodySm",tone:"subdued",children:ae},u)})})]}),e.jsx("div",{style:{flexGrow:1,flexShrink:0,minHeight:"20px"}}),e.jsx("div",{style:{marginTop:"auto",flexShrink:0},children:(n==null?void 0:n.plan)===t.key&&(n==null?void 0:n.status)==="active"&&(n!=null&&n.activatedAt||n!=null&&n.inTrial)?e.jsx(j,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:e.jsxs(r,{variant:"bodySm",alignment:"center",tone:"subdued",fontWeight:"medium",children:["Current Plan",n!=null&&n.inTrial?" (Trial)":""]})}):(n==null?void 0:n.plan)===t.key&&(n==null?void 0:n.status)==="active"&&!(n!=null&&n.activatedAt)&&!(n!=null&&n.inTrial)?e.jsx(j,{background:"bg-surface-warning-subdued",padding:"300",borderRadius:"200",children:e.jsx(r,{variant:"bodySm",alignment:"center",tone:"warning",fontWeight:"medium",children:"Activation Pending"})}):e.jsx(I,{variant:"primary",fullWidth:!0,onClick:()=>{R(t),b(!0)},children:"Select Plan"})})]})},t.key)})})})})}),e.jsx(d.Section,{variant:"oneThird",children:e.jsx(p,{children:e.jsxs(s,{gap:"400",children:[e.jsx(r,{variant:"headingMd",children:"Token Balance"}),e.jsx(U,{}),e.jsxs(s,{gap:"300",children:[e.jsxs(j,{children:[e.jsx(r,{variant:"heading2xl",alignment:"center",children:((z=x==null?void 0:x.balance)==null?void 0:z.toLocaleString())||0}),e.jsx(r,{variant:"bodySm",tone:"subdued",alignment:"center",children:"tokens available"}),(()=>{var l;const t=(l=n==null?void 0:n.plan)==null?void 0:l.toLowerCase().trim(),a=t==="growth extra";if(!a&&!(t==="enterprise"))return null;const u=a?"100M":"300M";return e.jsxs(r,{variant:"bodySm",tone:"subdued",alignment:"center",fontWeight:"medium",children:["(",u," included this cycle)"]})})()]}),e.jsxs(v,{align:"space-between",children:[e.jsx(r,{variant:"bodySm",tone:"subdued",children:(()=>{var a;const t=(a=n==null?void 0:n.plan)==null?void 0:a.toLowerCase().trim();return t==="growth extra"||t==="enterprise"?"Additional Purchased":"Purchased"})()}),e.jsx(r,{variant:"bodySm",children:((G=x==null?void 0:x.totalPurchased)==null?void 0:G.toLocaleString())||0})]}),e.jsxs(v,{align:"space-between",children:[e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Used"}),e.jsx(r,{variant:"bodySm",children:((N=x==null?void 0:x.totalUsed)==null?void 0:N.toLocaleString())||0})]}),e.jsx(U,{}),e.jsx(I,{variant:"primary",fullWidth:!0,onClick:()=>{(n==null?void 0:n.plan)==="starter"?A(!0):T(!0)},children:"Buy Tokens"}),e.jsx(j,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:e.jsxs(s,{gap:"100",children:[e.jsx(r,{variant:"bodySm",tone:"subdued",children:"ðŸ’¡ Tokens enable AI features"}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"â™»ï¸ Never expire, roll over monthly"})]})})]})]})})})]}),e.jsx(S,{open:J,onClose:()=>{b(!1),R(null),L(!1)},title:"Confirm Plan Selection",primaryAction:{content:M?"Processing...":"Confirm",loading:M,onAction:()=>Z((y==null?void 0:y.key)||(n==null?void 0:n.plan))},secondaryActions:[{content:"Cancel",onAction:()=>{b(!1),R(null),L(!1)}}],children:e.jsx(S.Section,{children:e.jsxs(s,{gap:"400",children:[e.jsxs(r,{children:["You are about to subscribe to the ",e.jsx("strong",{children:(y==null?void 0:y.name)||(n==null?void 0:n.plan)})," plan."]}),(n==null?void 0:n.inTrial)&&W&&e.jsx(f,{tone:"warning",children:e.jsx("p",{children:"This will end your trial period and start billing immediately."})})]})})}),e.jsx(S,{open:_,onClose:()=>{T(!1),k(""),C(B[0])},title:"Purchase Tokens",primaryAction:{content:M?"Processing...":"Purchase",loading:M,onAction:()=>ee(w||P)},secondaryActions:[{content:"Cancel",onAction:()=>{T(!1),k(""),C(B[0])}}],children:e.jsx(S.Section,{children:e.jsxs(s,{gap:"400",children:[e.jsx(r,{variant:"headingMd",children:"Select Amount"}),e.jsx(se,{variant:"segmented",children:B.map(t=>e.jsxs(I,{pressed:P===t&&!w,onClick:()=>{C(t),k("")},children:["$",t]},t))}),e.jsx(r,{variant:"bodyMd",tone:"subdued",children:"Or enter a custom amount (multiples of $5)"}),e.jsx(le,{type:"number",value:w,onChange:t=>{k(t),C(null)},placeholder:"Enter amount",prefix:"$",min:5,step:5,autoComplete:"off"}),e.jsx(j,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(s,{gap:"200",children:[e.jsxs(v,{align:"space-between",children:[e.jsx(r,{variant:"bodyMd",children:"Amount"}),e.jsxs(r,{variant:"bodyMd",fontWeight:"semibold",children:["$",w||P]})]}),e.jsxs(v,{align:"space-between",children:[e.jsx(r,{variant:"bodyMd",children:"Tokens"}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:ne(parseFloat(w||P)).toLocaleString()})]}),e.jsx(U,{}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Tokens never expire and roll over indefinitely"})]})}),(n==null?void 0:n.inTrial)&&e.jsx(f,{tone:"info",children:e.jsx("p",{children:"Your trial will continue after purchasing tokens."})})]})})}),e.jsx(S,{open:K,onClose:()=>A(!1),title:"Upgrade Required",primaryAction:{content:"View Plans",onAction:()=>{A(!1),window.scrollTo({top:0,behavior:"smooth"})}},secondaryActions:[{content:"Cancel",onAction:()=>A(!1)}],children:e.jsx(S.Section,{children:e.jsxs(s,{gap:"400",children:[e.jsxs(r,{variant:"bodyLg",children:["Token purchases require ",e.jsx("strong",{children:"Professional"})," plan or higher."]}),e.jsxs(r,{variant:"bodyMd",tone:"subdued",children:["Your current plan: ",e.jsx("strong",{children:"Starter"})]}),e.jsx(j,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(s,{gap:"200",children:[e.jsx(r,{variant:"headingSm",children:"Upgrade to unlock:"}),e.jsx(r,{variant:"bodyMd",children:"âœ“ Token purchases"}),e.jsx(r,{variant:"bodyMd",children:"âœ“ AI-enhanced optimization"}),e.jsx(r,{variant:"bodyMd",children:"âœ“ Store Metadata for AI Search"}),e.jsx(r,{variant:"bodyMd",children:"âœ“ More AI bot access"}),e.jsx(r,{variant:"bodyMd",children:"âœ“ Higher product limits"})]})}),e.jsx(f,{tone:"info",children:e.jsx("p",{children:"Professional plan starts at $15.99/month with up to 250 products."})})]})})})]})}export{ge as default};
