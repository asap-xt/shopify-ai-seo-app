import{r as p,j as a}from"./react-vendor-6uwpMgJP.js";import{e as R}from"./vendor-BC2YhXnC.js";import{u as T}from"./useShopApi-C5prSg4i.js";import{B as c,a as b,T as d,d as D,C as y,I as v,h as x,z as P,b as U}from"./polaris-B96_d87K.js";import"./app-bridge-ugs9K9zh.js";const w=[{label:"Bug Report",value:"bug_report"},{label:"Feature Request",value:"feature_request"},{label:"Billing Issue",value:"billing_issue"},{label:"General Question",value:"general_question"},{label:"Technical Support",value:"technical_support"}];function O({shop:C}){const{api:_}=T(),[s,g]=p.useState({name:"",email:"",subject:"general_question",message:"",file:null}),[l,j]=p.useState(!1),[S,i]=p.useState(null),[B,o]=p.useState(""),[n,F]=p.useState(null),h=C||((e,r="")=>{try{return new URLSearchParams(window.location.search).get(e)||r}catch{return r}})("shop","");p.useEffect(()=>{E()},[h]);const E=async()=>{try{const e=await _(`/api/shop/info?shop=${encodeURIComponent(h)}`);F(e),g(r=>({...r,name:(e==null?void 0:e.name)||"",email:(e==null?void 0:e.email)||""}))}catch(e){console.error("[ContactSupport] Error loading shop info:",e)}},f=(e,r)=>{g(t=>({...t,[e]:r}))},q=e=>{if(e.length>0){const r=e[0];if(r.size>500*1024){i("error"),o("File size must be less than 500KB");return}g(t=>({...t,file:r}))}},M=e=>new Promise((r,t)=>{const m=new FileReader;m.readAsDataURL(e),m.onload=()=>r(m.result),m.onerror=u=>t(u)}),k=()=>s.name.trim()?s.email.trim()?s.message.trim()?!0:(i("error"),o("Please enter your message"),!1):(i("error"),o("Please enter your email"),!1):(i("error"),o("Please enter your name"),!1),z=async e=>{var r;if(e.preventDefault(),!!k()){j(!0),i(null),o("");try{let t={name:s.name,email:s.email,subject:((r=w.find(u=>u.value===s.subject))==null?void 0:r.label)||s.subject,message:s.message,shop_name:(n==null?void 0:n.name)||h,shop_url:`https://${h}`,time:new Date().toLocaleString()};if(s.file)try{const u=await M(s.file);t.file_name=s.file.name,t.file_size=`${(s.file.size/1024).toFixed(1)} KB`,t.file_type=s.file.type,t.file_data=u}catch(u){console.error("[ContactSupport] Error converting file to base64:",u),t.message+=`

ðŸ“Ž ATTACHED FILE (conversion failed):
Name: ${s.file.name}
Size: ${(s.file.size/1024).toFixed(1)} KB
Type: ${s.file.type}`}console.log("[ContactSupport] Sending email with params:",t);const m=await R.send("service_c8j657n","template_zrftkfg",t,"-0N7g1SCh9fSknb6q");console.log("[ContactSupport] Email sent successfully:",m),i("success"),o("Message sent successfully! We'll get back to you within 24 hours."),g({name:(n==null?void 0:n.name)||"",email:(n==null?void 0:n.email)||"",subject:"general_question",message:"",file:null})}catch(t){console.error("[ContactSupport] Error sending email:",t),console.error("[ContactSupport] Error details:",{message:t.message,status:t.status,text:t.text,stack:t.stack}),i("error"),o(`Failed to send message: ${t.message||"Unknown error"}`)}finally{j(!1)}}};return a.jsx(c,{padding:"400",children:a.jsxs(b,{gap:"400",children:[a.jsx(d,{variant:"bodyMd",tone:"subdued",children:"Need help? Send us a message and we'll get back to you within 24 hours."}),S&&a.jsx(D,{tone:S==="success"?"success":"critical",children:B}),a.jsx(y,{children:a.jsx(c,{padding:"400",children:a.jsx("form",{onSubmit:z,children:a.jsxs(b,{gap:"400",children:[a.jsxs(v,{gap:"400",wrap:!0,children:[a.jsx(c,{flexGrow:1,children:a.jsx(x,{label:"Name",value:s.name,onChange:e=>f("name",e),placeholder:"Your name",required:!0,disabled:l})}),a.jsx(c,{flexGrow:1,children:a.jsx(x,{label:"Email",type:"email",value:s.email,onChange:e=>f("email",e),placeholder:"your@email.com",required:!0,disabled:l})})]}),a.jsx(P,{label:"Subject",options:w,value:s.subject,onChange:e=>f("subject",e),disabled:l}),a.jsx(x,{label:"Message",value:s.message,onChange:e=>f("message",e),multiline:4,placeholder:"Describe your issue or question...",required:!0,disabled:l}),a.jsxs(c,{children:[a.jsx(d,{as:"label",variant:"bodyMd",fontWeight:"medium",children:"Attach File (Optional)"}),a.jsx(c,{paddingBlockStart:"100",children:a.jsx("input",{type:"file",onChange:e=>q(e.target.files),disabled:l,style:{padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"14px",width:"100%"}})}),a.jsx(d,{variant:"bodySm",tone:"subdued",children:"Any file type allowed â€¢ Maximum file size: 500KB"})]}),a.jsx(v,{gap:"200",align:"end",children:a.jsx(U,{variant:"primary",submit:!0,loading:l,disabled:l,children:l?"Sending...":"Send Message"})})]})})})}),a.jsx(y,{children:a.jsx(c,{padding:"400",children:a.jsxs(b,{gap:"200",children:[a.jsx(d,{as:"h3",variant:"headingMd",children:"Other Ways to Reach Us"}),a.jsx(d,{variant:"bodyMd",tone:"subdued",children:"â€¢ Email: indexaize@gmail.com"}),a.jsx(d,{variant:"bodyMd",tone:"subdued",children:"â€¢ Response time: Within 24 hours"}),a.jsxs(d,{variant:"bodyMd",tone:"subdued",children:["â€¢ Include your shop name: ",h]})]})})})]})})}export{O as default};
