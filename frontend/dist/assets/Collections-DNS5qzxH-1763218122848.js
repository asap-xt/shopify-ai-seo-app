import{j as e}from"./app-bridge-BOWO_dBq-1763218122848.js";import{r as o}from"./react-vendor-tAaa2TlE-1763218122848.js";import{m as Pt}from"./sessionFetch-CJepNHo3-1763218122848.js";import{S as kt,U as Et}from"./StoreMetadataBanner-D0tzwckt-1763218122848.js";import{I as Tt}from"./InsufficientTokensModal-3swiFM-e-1763218122848.js";import{T as Dt}from"./TrialActivationModal-CeGYtyMC-1763218122848.js";import{M as x,a as O,T as r,e as Se,d as zt,b as I,B as c,I as C,g as Fe,D as Rt,f as X,C as Ke,h as $t,S as Nt,i as Ge,j as He,R as Ut,k as Bt,m as Wt,E as _t}from"./polaris-DK8JpoCT-1763218122848.js";const qt=(le,g="")=>{try{return new URLSearchParams(window.location.search).get(le)||g}catch{return g}};function xs({shop:le,globalPlan:g}){var We,_e,qe;const d=le||qt("shop",""),w=o.useMemo(()=>Pt(),[]),[m,xe]=o.useState([]),[je,ye]=o.useState(!1),[K,Qe]=o.useState(0),[p,G]=o.useState([]),[b,ee]=o.useState(!1),[Ft,Kt]=o.useState(""),[z,ae]=o.useState(""),[M,te]=o.useState("all"),[Gt,Ht]=o.useState(""),[Qt,Jt]=o.useState([]),[Yt,Zt]=o.useState([]),[Ce,ie]=o.useState(!1),[Vt,Xt]=o.useState(!1),[es,ts]=o.useState(!1),[we,re]=o.useState(!1),[P,Je]=o.useState("updatedAt"),[k,Ye]=o.useState("desc"),[Ze,Ve]=o.useState(""),[ss,Xe]=o.useState([]),[v,B]=o.useState([]),[A,be]=o.useState([]),[ce,H]=o.useState(!1),[E,R]=o.useState({current:0,total:0,percent:0}),[ve,Q]=o.useState(""),[J,Le]=o.useState([]),[ns,os]=o.useState(!1),[ls,as]=o.useState(null),[is,rs]=o.useState(!1),[cs,et]=o.useState(""),[tt,se]=o.useState(!1),[W,_]=o.useState([]),[Ae,Oe]=o.useState(!1),[st,Y]=o.useState(!1),[Ie,Me]=o.useState(!1),[nt,ne]=o.useState(!1),[Pe,oe]=o.useState([]),[$,de]=o.useState({}),[ot,ue]=o.useState(!1),[lt,he]=o.useState(!1),[ke,ds]=o.useState({}),[at,ge]=o.useState(!1),[Ee,pe]=o.useState(null),[it,Te]=o.useState(!1),[De,S]=o.useState(""),[ze,Re]=o.useState(!1),[rt,Z]=o.useState(!1),[ct,$e]=o.useState(!1),[dt,Ne]=o.useState(!1),[f,q]=o.useState(null),[L,V]=o.useState("starter"),[T,fe]=o.useState(1),[me,Ue]=o.useState(!1);o.useEffect(()=>{if(!(!g||typeof g!="object"))if(!me&&L==="starter"){if(g.planKey&&g.planKey!==""){console.log("[COLLECTIONS] Using globalPlan as fallback (GraphQL not loaded yet):",{planKey:g.planKey,language_limit:g.language_limit}),V(g.planKey);const t=g.language_limit||1;fe(t)}else if(g.plan&&g.plan!==""){const t=g.plan.toLowerCase().replace(/\s+/g,"-");console.log("[COLLECTIONS] Using globalPlan.plan as fallback (GraphQL not loaded yet):",{plan:g.plan,derivedPlanKey:t,language_limit:g.language_limit}),V(t);const n=g.language_limit||1;fe(n)}}else me&&console.log("[COLLECTIONS] Skipping globalPlan update - GraphQL data already loaded:",{currentPlan:L,globalPlanPlanKey:g.planKey,globalPlanLanguageLimit:g.language_limit})},[g,L,me]);const[y,N]=o.useState({processing:!1,current:0,total:0,currentItem:"",results:null});o.useEffect(()=>{if(!d)return;w("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          language_limit
          product_limit
        }
      }
    `,variables:{shop:d}})}).then(n=>{var a,u,j,F,h;if((a=n==null?void 0:n.errors)!=null&&a.length)throw new Error(((u=n.errors[0])==null?void 0:u.message)||"GraphQL error");const s=(j=n==null?void 0:n.data)==null?void 0:j.plansMe;((F=s==null?void 0:s.planKey)!=null&&F.includes("growth")||(h=s==null?void 0:s.plan)!=null&&h.toLowerCase().includes("growth"))&&console.log("[COLLECTIONS] GraphQL plansMe response:",{plan:s==null?void 0:s.plan,planKey:s==null?void 0:s.planKey,language_limit:s==null?void 0:s.language_limit,product_limit:s==null?void 0:s.product_limit});const l=(s==null?void 0:s.modelsSuggested)||["google/gemini-1.5-flash"];Xe(l.map(U=>({label:U,value:U}))),Ve(l[0]),V((s==null?void 0:s.planKey)||"starter");const i=(s==null?void 0:s.language_limit)||1;console.log("[COLLECTIONS] Setting limits from GraphQL:",{languageLimit:i,planKey:s==null?void 0:s.planKey}),fe(i),Ue(!0)}).catch(n=>{console.error("[COLLECTIONS] GraphQL plansMe failed:",n),S(`Error loading models: ${n.message}`),Ue(!0)})},[d,w]),o.useEffect(()=>{d&&w(`/api/languages/shop/${d}?shop=${d}`).then(t=>{const n=(t==null?void 0:t.shopLanguages)||["en"];be(n),B([])}).catch(t=>{console.error("[COLLECTIONS] Languages API error:",t),be(["en"]),B([])})},[d,w]);const ut=async()=>{try{Me(!0);const t=await w(`/api/collections/sync?shop=${d}`,{method:"POST"});t!=null&&t.success?(S("Collections synced successfully!"),await D()):(console.error("[COLLECTIONS] Sync failed:",t),S("Failed to sync collections"))}catch(t){console.error("[COLLECTIONS] Sync error:",t),S("Error syncing collections")}finally{Me(!1)}},D=o.useCallback(async()=>{ye(!0);try{const n=`/collections/list-graphql?${new URLSearchParams({shop:d,...z&&{search:z},...M!=="all"&&{optimized:M},sortBy:P,sortOrder:k})}`;let l=(await w(n)).collections||[];if(z){const i=z.toLowerCase();l=l.filter(a=>a.title.toLowerCase().includes(i)||a.handle.toLowerCase().includes(i))}M!=="all"&&(l=l.filter(i=>M==="true"?i.hasSeoData:!i.hasSeoData)),xe(l),Qe(l.length)}catch(t){S(`Error loading collections: ${t.message}`)}finally{ye(!1)}},[d,z,M,P,k,w]);o.useEffect(()=>{d&&(D(),Y(!1))},[d,M,P,k,D]),o.useEffect(()=>{const t=setTimeout(()=>{d&&D()},500);return()=>clearTimeout(t)},[z]);const ht=o.useCallback(t=>{G(t);const n=t.some(s=>{const l=m.find(i=>i.id===s);return l==null?void 0:l.hasSeoData});Y(n),t.length===0&&ee(!1)},[m]),gt=o.useCallback(t=>{if(ee(t),t){G(m.map(s=>s.id));const n=m.some(s=>s.hasSeoData);Y(n)}else G([]),Y(!1)},[m]),pt=async t=>{Te(!0);try{const n=`/collections/${t.split("/").pop()}/seo-data?shop=${encodeURIComponent(d)}`,s=await w(n);pe(s),ge(!0)}catch(n){S((n==null?void 0:n.status)===404?"No SEO data found for this collection":"Failed to load SEO data")}finally{Te(!1)}},Be=o.useMemo(()=>{var n;if(b)return v.length>T;const t=m.filter(s=>p.includes(s.id));if(t.length===0)return v.length>T;for(const s of t){const l=((n=s.optimizationSummary)==null?void 0:n.optimizedLanguages)||[],i=v.filter(u=>!l.includes(u));if(l.length+i.length>T)return!0}return!1},[m,p,b,T,v]),ft=()=>{if(p.length===0&&!b){S("Please select collections first");return}he(!0)},mt=async()=>{const n=m.filter(l=>p.includes(l.id)).filter(l=>{var i;return((i=l.optimizedLanguages)==null?void 0:i.length)>0});if(n.length===0){S("Please select collections with Basic SEO optimization");return}Re(!0),N({processing:!0,current:0,total:n.length,currentItem:"",results:null});const s={successful:0,failed:0,skipped:0};for(let l=0;l<n.length;l++){const i=n[l];N(a=>({...a,current:l,currentItem:i.title}));try{const a=i.optimizedLanguages||[];if(a.length===0){s.skipped++;continue}const u=await w(`/ai-enhance/collection/${encodeURIComponent(i.id)}`,{method:"POST",shop:d,body:{shop:d,languages:a}});u&&u.ok?s.successful++:s.failed++}catch(a){if(a.status===403){N({processing:!1,current:0,total:0,currentItem:"",results:null}),q(a),V(a.currentPlan||L||"starter"),Z(!0);return}if(a.status===402||a.requiresPurchase||a.trialRestriction){N({processing:!1,current:0,total:0,currentItem:"",results:null}),q(a),V(a.currentPlan||L||"starter"),a.trialRestriction&&a.requiresActivation?Ne(!0):a.trialRestriction?Z(!0):$e(!0);return}s.failed++}N(a=>({...a,current:l+1}))}N(l=>({...l,processing:!1,results:s})),S(`AI enhancement complete! ${s.successful} collections enhanced.`)},St=()=>{m.filter(s=>p.includes(s.id)).filter(s=>{var l;return((l=s.optimizedLanguages)==null?void 0:l.length)>0});const n=()=>{const s=y.results;Re(!1),N({processing:!1,current:0,total:0,currentItem:"",results:null}),s&&s.successful>0&&setTimeout(()=>{xe([]),D()},1500)};return y.processing?e.jsx(x,{open:ze,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",y.currentItem]}),e.jsx(Se,{progress:y.current/y.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[y.current," of ",y.total," collections (",Math.round(y.current/y.total*100),"%)"]})]})})}):y.results!==null?e.jsx(x,{open:ze,title:"AI Enhancement Results",onClose:n,primaryAction:{content:"Done",onAction:n},children:e.jsx(x.Section,{children:e.jsx(O,{gap:"300",children:e.jsxs(C,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:y.results.successful})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:y.results.failed})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:y.results.skipped})]})]})})})}):null},xt=async()=>{var t;if(!v.length){S("Please select at least one language");return}he(!1),H(!0),R({current:0,total:0,percent:0}),Le([]),de({});try{const n=b?m:m.filter(a=>p.includes(a.id)),s=n.length;R({current:0,total:s,percent:0});const l={};for(let a=0;a<n.length;a++){const u=n[a];Q(u.title);try{const h=await w("/seo/generate-collection-multi",{method:"POST",shop:d,body:JSON.stringify({shop:d,collectionId:u.id,model:Ze,languages:v})});l[u.id]={success:!0,data:h}}catch(h){if(h.status===403||(t=h.message)!=null&&t.includes("requires Professional plan")){H(!1),Q(""),q({error:h.message||"Collections SEO requires Professional plan or higher",currentPlan:h.currentPlan||L||"starter",upgradeMessage:h.upgradeMessage||"Upgrade to Professional plan to optimize collections for AI search"}),Z(!0);return}l[u.id]={success:!1,error:h.message},Le(U=>[...U,{collection:u.title,error:h.message}])}const j=a+1,F=Math.round(j/s*100);R({current:j,total:s,percent:F})}de(l),ue(!0);const i=Object.values(l).filter(a=>a.success).length;S(`Generated optimization for ${i} collections`)}catch(n){S(`Error: ${n.message}`)}finally{H(!1),Q("")}},jt=async()=>{var t;H(!0),R({current:0,total:0,percent:0});try{const n=Object.entries($).filter(([l,i])=>i.success),s=n.length;R({current:0,total:s,percent:0});for(let l=0;l<n.length;l++){const[i,a]=n[l],u=m.find(h=>h.id===i);if(!u)continue;Q(u.title);try{if(!((t=a.data)!=null&&t.results)||!Array.isArray(a.data.results))throw new Error("Invalid results structure");const h=await w("/seo/apply-collection-multi",{method:"POST",shop:d,body:{shop:d,collectionId:i,results:a.data.results.map(U=>({language:U.language,seo:U.data})),options:{updateTitle:!0,updateDescription:!0,updateSeo:!0,updateMetafields:!0}}});if(!(h!=null&&h.ok))throw new Error((h==null?void 0:h.error)||"Apply failed")}catch(h){console.error("Apply error for collection:",i,h),J.push({id:u.id,title:u.title,message:h.message})}const j=l+1,F=Math.round(j/s*100);R({current:j,total:s,percent:F})}S("Optimization applied successfully!"),ue(!1),de({}),G([]),await D(),ee(!1)}catch(n){S(`Error applying optimization: ${n.message}`)}finally{H(!1),Q("")}},yt=async(t=[])=>{Oe(!0),et("");try{const n=b?m:m.filter(a=>p.includes(a.id)),s=n.length*t.length;let l=0;const i=[];for(const a of n)for(const u of t)try{const j=await w("/collections/delete-seo",{method:"DELETE",shop:d,body:{shop:d,collectionId:a.id,language:u}})}catch(j){console.error(`[DELETE-SEO-BULK] Failed to delete ${u} for ${a.title}:`,j),i.push({id:a.id,title:a.title,message:j.message})}finally{l++,R({current:l,total:s,percent:Math.round(l/s*100)})}S(`Deleted optimization for ${t.join(", ").toUpperCase()}`),setTimeout(async()=>{await D(),G([]),ee(!1),Y(!1)},100)}catch(n){console.error("[DELETE-SEO-BULK] Error:",n),S(`Delete error: ${n.message}`)}finally{Oe(!1),oe([]),_([])}},Ct=t=>{var a,u;const n=((a=$[t.id])==null?void 0:a.success)||ke[t.id],s=((u=$[t.id])==null?void 0:u.data)||ke[t.id],l=t.optimizedLanguages||[],i=e.jsx(c,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Wt,{id:t.id,media:i,accessibilityLabel:`View details for ${t.title}`,children:e.jsxs(C,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(c,{style:{flex:"1 1 30%",minWidth:"200px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:t.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Handle: ",t.handle]})]}),e.jsx(c,{style:{flex:"0 0 15%",minWidth:"100px",textAlign:"center"},children:e.jsxs(r,{variant:"bodyMd",children:[t.productsCount," products"]})}),e.jsx(c,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(C,{gap:"100",wrap:!0,children:t.hasSeoData?e.jsxs(e.Fragment,{children:[A.map(j=>e.jsx(X,{tone:l.includes(j)?"success":"subdued",size:"small",children:j.toUpperCase()},j)),t.aiEnhanced&&e.jsx(X,{tone:"info",size:"small",children:"AIâœ¨"})]}):e.jsx(X,{tone:"subdued",children:"No AI Search Optimisation"})})}),e.jsxs(c,{style:{flex:"0 0 15%",minWidth:"120px"},children:[n&&e.jsx(I,{size:"slim",onClick:()=>{pe(s),ge(!0)},children:"Preview JSON"}),!n&&t.hasSeoData&&e.jsx(I,{size:"slim",loading:it,onClick:()=>pt(t.id),children:"Preview JSON"})]})]})})},wt=ce&&!y.processing&&e.jsx(x,{open:ce,title:"Processing Collections",onClose:()=>{},noScroll:!0,children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:ve?`Processing: ${ve}`:"Preparing..."}),e.jsx(Se,{progress:E.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[E.current," of ",E.total," collections (",E.percent,"%)"]})]})})}),bt=e.jsx(x,{open:lt,title:"Select Languages",primaryAction:{content:"Generate Optimization for AI Search",onAction:xt,disabled:v.length===0||Be},secondaryActions:[{content:"Cancel",onAction:()=>he(!1)}],children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",b?"all":p.length," selected collections:"]}),Be&&e.jsx(zt,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(O,{gap:"200",children:[e.jsxs(r,{variant:"bodyMd",children:["Your ",L," plan supports up to ",T," language",T>1?"s":""," per collection.",p.length===1&&((qe=(_e=(We=m.find(t=>t.id===p[0]))==null?void 0:We.optimizationSummary)==null?void 0:_e.optimizedLanguages)==null?void 0:qe.length)>0&&e.jsxs(e.Fragment,{children:[" This collection already has ",m.find(t=>t.id===p[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(r,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(I,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),n=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${n}`},children:"Upgrade Plan"})]})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(C,{gap:"200",wrap:!0,children:A.map(t=>e.jsx(Fe,{label:t.toUpperCase(),checked:v.includes(t),onChange:n=>{B(n?[...v,t]:v.filter(s=>s!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(I,{plain:!0,onClick:()=>{v.length===A.length?B([]):A.length>T?(B([...A]),S(`You selected ${A.length} languages. Your ${L} plan supports ${T}. Please deselect or upgrade.`)):B([...A])},children:v.length===A.length?"Deselect all":"Select all"})})]})})}),vt=e.jsx(x,{open:ot&&!ce,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:jt,disabled:!Object.values($).some(t=>t.success)},secondaryActions:[{content:"Cancel",onAction:()=>ue(!1)}],children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsxs(C,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values($).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values($).filter(t=>t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values($).filter(t=>!t.success&&!t.skipped).length})]})]}),J.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Rt,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(c,{maxHeight:"200px",overflowY:"scroll",children:[J.slice(0,10).map((t,n)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.collection,": ",t.error]},n)),J.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",J.length-10," more errors"]})]})]})]})})}),Lt=e.jsx(x,{open:at,title:"SEO Data Preview",secondaryActions:[{content:"Close",onAction:()=>{ge(!1),pe(null)}}],children:e.jsx(x.Section,{children:e.jsx(c,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",backgroundColor:"#f6f6f7",padding:"12px",borderRadius:"4px",maxHeight:"400px",overflow:"auto"},children:Ee?JSON.stringify(Ee,null,2):""})})})}),At=e.jsx(x,{open:tt,title:"Delete Optimization for AI Search",onClose:()=>{se(!1),_([])},primaryAction:{content:"Continue",onAction:()=>{oe(W),se(!1),ne(!0)},disabled:W.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{se(!1),_([])}}],children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",b?K:p.length," selected collections:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(C,{gap:"400",wrap:!1,children:A.map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[e.jsx("input",{type:"checkbox",checked:W.includes(t),onChange:n=>{_(n.target.checked?[...W,t]:W.filter(s=>s!==t))},style:{marginRight:"8px",width:"18px",height:"18px",cursor:"pointer"}}),e.jsx(r,{variant:"bodyMd",children:t.toUpperCase()})]},t))})}),e.jsx(c,{children:e.jsx(I,{plain:!0,onClick:()=>{_(W.length===A.length?[]:[...A])},children:"Select all"})}),e.jsx(c,{paddingBlockStart:"300",children:e.jsx(r,{variant:"bodySm",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})})]})})}),Ot=e.jsx(x,{open:nt,title:"Confirm Deletion",onClose:()=>{ne(!1),oe([])},primaryAction:{content:"Delete",destructive:!0,onAction:async()=>{ne(!1),setTimeout(()=>{yt(Pe)},100)}},secondaryActions:[{content:"Cancel",onAction:()=>{ne(!1),oe([]),_([])}}],children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(C,{gap:"200",children:Pe.map(t=>e.jsx(X,{tone:"warning",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",b?K:p.length," selected collections."]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(r,{variant:"bodySm",tone:"critical",children:"This action cannot be undone."})})]})})}),It=Ae&&e.jsx(x,{open:Ae,title:"Deleting SEO Data",onClose:()=>{},noScroll:!0,children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:"Deleting selected languages..."}),e.jsx(Se,{progress:E.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[E.current," of ",E.total," operations (",E.percent,"%)"]})]})})}),Mt=e.jsx(_t,{heading:"No collections found",action:{content:"Clear filters",onAction:()=>{ae(""),te("all"),D()}},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms"})});return e.jsxs(e.Fragment,{children:[e.jsx(kt,{globalPlan:g}),e.jsx(Ke,{children:e.jsx(c,{padding:"400",children:e.jsxs(O,{gap:"300",children:[e.jsxs(C,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(c,{minWidth:"400px",children:e.jsx($t,{label:"",placeholder:"Search by collection name...",value:z,onChange:ae,prefix:e.jsx(Nt,{}),clearButton:!0,onClearButtonClick:()=>ae("")})}),e.jsx(c,{width:"320px",children:e.jsx(I,{primary:!0,onClick:ft,disabled:p.length===0&&!b,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(C,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(I,{onClick:ut,disabled:Ie||je,size:"medium",children:Ie?"Syncing...":"Sync Collections"}),e.jsx(c,{width:"320px",children:e.jsxs(O,{gap:"200",align:"end",children:[(()=>{if(p.length===0&&!b||!m.filter(l=>p.includes(l.id)).some(l=>{var i;return((i=l.optimizedLanguages)==null?void 0:i.length)>0}))return null;const s=L.toLowerCase().replace(/_/g," ")==="starter";return e.jsx(I,{onClick:s?()=>{q({error:"Collections require Professional plan or higher",message:"Upgrade to Professional plan to access Collections optimization",minimumPlanRequired:"Professional"}),Z(!0)}:mt,disabled:p.length===0&&!b,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(I,{outline:!0,destructive:!0,onClick:()=>se(!0),disabled:p.length===0||!st,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]})})}),e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(Ke,{children:[e.jsxs(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(C,{gap:"200",wrap:!0,align:"space-between",children:[e.jsx(C,{gap:"200",wrap:!0,children:e.jsx(Ge,{active:Ce,activator:e.jsx(I,{disclosure:"down",onClick:()=>ie(!Ce),removeUnderline:!0,children:e.jsxs(C,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),M!=="all"&&e.jsx(c,{onClick:t=>{t.stopPropagation(),te("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>ie(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(He,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All collections",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[M],onChange:t=>{te(t[0]),ie(!1)}})})})}),e.jsx(Ge,{active:we,activator:e.jsx(I,{disclosure:"down",onClick:()=>re(!we),removeUnderline:!0,children:e.jsx(C,{gap:"100",blockAlign:"center",children:e.jsxs("span",{children:[P==="updatedAt"&&k==="desc"&&"Newest first",P==="updatedAt"&&k==="asc"&&"Oldest first",P==="title"&&k==="asc"&&"Name A-Z",P==="title"&&k==="desc"&&"Name Z-A",P==="productsCount"&&k==="desc"&&"Most products",P==="productsCount"&&k==="asc"&&"Least products"]})})}),onClose:()=>re(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(He,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"updatedAt_desc"},{label:"Oldest first",value:"updatedAt_asc"},{label:"Name A-Z",value:"title_asc"},{label:"Name Z-A",value:"title_desc"},{label:"Most products",value:"productsCount_desc"},{label:"Least products",value:"productsCount_asc"}],selected:[`${P}_${k}`],onChange:t=>{const[n,s]=t[0].split("_");Je(n),Ye(s),re(!1)}})})})]}),M!=="all"&&e.jsx(c,{paddingBlockStart:"200",children:e.jsx(C,{gap:"100",wrap:!0,children:e.jsx(X,{onRemove:()=>te("all"),children:M==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"})})})]}),K>0&&e.jsx(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:e.jsx(Fe,{label:`Select all ${K} collections`,checked:b,onChange:gt})}),e.jsx(Ut,{resourceName:{singular:"collection",plural:"collections"},items:m,renderItem:Ct,selectedItems:p,onSelectionChange:ht,selectable:!0,loading:je,totalItemsCount:K,emptyState:Mt,showHeader:!1},`collections-${m.length}-${p.length}`)]})}),wt,bt,vt,Lt,At,Ot,It,St(),e.jsx(Et,{open:rt,onClose:()=>Z(!1),featureName:"Collections AI Enhancement",currentPlan:L,errorMessage:(f==null?void 0:f.error)||(f==null?void 0:f.message),minimumPlanRequired:f==null?void 0:f.minimumPlanRequired}),f&&e.jsxs(e.Fragment,{children:[e.jsx(Tt,{open:ct,onClose:()=>{$e(!1),q(null)},tokensRequired:f.tokensRequired||0,tokensAvailable:f.tokensAvailable||0,tokensNeeded:f.tokensNeeded||0,feature:"ai-seo-collection",shop:d,needsUpgrade:f.needsUpgrade||!1,minimumPlan:f.minimumPlanForFeature||null,currentPlan:f.currentPlan||L,returnTo:"/ai-seo/collections"}),e.jsx(Dt,{open:dt,onClose:()=>{Ne(!1),q(null)},feature:f.feature||"ai-seo-collection",trialEndsAt:f.trialEndsAt,currentPlan:f.currentPlan||L,tokensRequired:f.tokensRequired||0,onActivatePlan:async()=>{try{console.log("[COLLECTIONS] ðŸ”“ Activating plan directly...");const t=await w("/api/billing/activate",{method:"POST",body:JSON.stringify({shop:d,endTrial:!0,returnTo:"/ai-seo/collections"})});if(console.log("[COLLECTIONS] âœ… Activation response:",t),t.requiresApproval&&t.confirmationUrl){console.log("[COLLECTIONS] ðŸ” Redirecting to Shopify approval..."),window.top.location.href=t.confirmationUrl;return}console.log("[COLLECTIONS] âœ… Plan activated, reloading page..."),window.location.reload()}catch(t){console.error("[COLLECTIONS] âŒ Activation failed:",t);const n=new URLSearchParams(window.location.search),s=n.get("host"),l=n.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${l}&host=${encodeURIComponent(s)}`}},onPurchaseTokens:()=>{const t=new URLSearchParams(window.location.search),n=t.get("host"),s=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${s}&host=${encodeURIComponent(n)}&returnTo=${encodeURIComponent("/ai-seo/collections")}`}})]}),De&&e.jsx(Bt,{content:De,onDismiss:()=>S("")})]})}export{xs as default};
