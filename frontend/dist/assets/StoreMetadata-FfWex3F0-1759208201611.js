import{j as t}from"./app-bridge-C0avqfWD-1759208201611.js";import{r as u}from"./react-vendor-tAaa2TlE-1759208201611.js";import{m as aa}from"./index-B7S-P4BZ-1759208201611.js";import{C as M,a as p,T as C,h as ea,L as f,s as x,i as r,D as ta,f as J,I as V,t as oa,B as k,k as na}from"./polaris-D4kDmL2z-1759208201611.js";const sa=(z,h="")=>{try{return new URLSearchParams(window.location.search).get(z)||h}catch{return h}};function da({shop:z}){var P,R,D,$,O;const h=z||sa("shop",""),[G,B]=u.useState(!1),[H,A]=u.useState(!1),[E,S]=u.useState(""),[g,X]=u.useState(null),w=u.useMemo(()=>aa({}),[]),[K,v]=u.useState(!1),[W,I]=u.useState(!1),[s,i]=u.useState({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}});u.useEffect(()=>{h&&Y()},[h,w]);async function Y(){var e,a,d;B(!0);try{const n=`/api/store/generate?shop=${encodeURIComponent(h)}`;console.log("[StoreMeta] GET",n);const l=await w(n,{headers:{"X-Shop":h}});if(console.log("[StoreMeta] GET ok",{url:n,keys:Object.keys(l||{})}),console.log("[StoreMeta] storeData.features:",l.features),console.log("[StoreMeta] organizationSchema available:",(e=l.features)==null?void 0:e.organizationSchema),console.log("[StoreMeta] shopInfo:",l.shopInfo),console.log("[StoreMeta] shopInfo.name:",(a=l.shopInfo)==null?void 0:a.name),console.log("[StoreMeta] shopInfo.description:",(d=l.shopInfo)==null?void 0:d.description),X(l),l.existingMetadata){const o=l.existingMetadata;i(c=>{var y,b,j,m,N,L,U,q,_,F;return{...c,seo:{...c.seo,...((y=o.seo_metadata)==null?void 0:y.value)||{},keywords:Array.isArray((j=(b=o.seo_metadata)==null?void 0:b.value)==null?void 0:j.keywords)?o.seo_metadata.value.keywords.join(", "):((N=(m=o.seo_metadata)==null?void 0:m.value)==null?void 0:N.keywords)||c.seo.keywords||""},aiMetadata:((L=o.ai_metadata)==null?void 0:L.value)||c.aiMetadata,organizationSchema:{...c.organizationSchema,...((U=o.organization_schema)==null?void 0:U.value)||{},enabled:((_=(q=o.organization_schema)==null?void 0:q.value)==null?void 0:_.enabled)===!0},localBusinessSchema:((F=o.local_business_schema)==null?void 0:F.value)||c.localBusinessSchema}})}l.shopInfo&&(console.log("[StoreMeta] Setting shop info defaults..."),console.log("[StoreMeta] Shop name:",l.shopInfo.name),console.log("[StoreMeta] Shop description:",l.shopInfo.description),i(o=>{var y,b,j;console.log("[StoreMeta] Previous formData:",o),console.log("[StoreMeta] Previous title:",o.seo.title),console.log("[StoreMeta] Previous metaDescription:",o.seo.metaDescription);const c={...o,seo:{...o.seo,title:o.seo.title||l.shopInfo.name,metaDescription:o.seo.metaDescription||l.shopInfo.description},organizationSchema:{...o.organizationSchema,name:o.organizationSchema.name||l.shopInfo.name,email:o.organizationSchema.email||l.shopInfo.email},aiMetadata:{...o.aiMetadata,languages:((y=o.aiMetadata.languages)==null?void 0:y.length)>0?o.aiMetadata.languages:(l.shopInfo.locales||[]).filter(m=>m.published).map(m=>m.locale),supportedCurrencies:((b=o.aiMetadata.supportedCurrencies)==null?void 0:b.length)>0?o.aiMetadata.supportedCurrencies:l.shopInfo.currencies||["EUR"],shippingRegions:((j=o.aiMetadata.shippingRegions)==null?void 0:j.length)>0?o.aiMetadata.shippingRegions:(l.shopInfo.markets||[]).map(m=>m.name)}};return console.log("[StoreMeta] New formData:",c),console.log("[StoreMeta] New title:",c.seo.title),console.log("[StoreMeta] New metaDescription:",c.seo.metaDescription),c}))}catch(n){console.error("[StoreMeta] GET error",(n==null?void 0:n.debug)||n,n),S(`Load failed: ${(n==null?void 0:n.message)||"Unknown error"}`)}finally{B(!1)}}async function T(){A(!0);try{const e=`/api/store/apply?shop=${encodeURIComponent(h)}`;console.log("[StoreMeta] SAVE",e);const a=await w(e,{method:"POST",headers:{"X-Shop":h},body:{metadata:s,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:s.organizationSchema.enabled,updateLocalBusiness:s.localBusinessSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:e,ok:a==null?void 0:a.ok}),S("Metadata saved successfully!")}catch(e){console.error("[StoreMeta] SAVE error",(e==null?void 0:e.debug)||e,e),S(`Save failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{A(!1)}}async function Q(){var e;v(!0);try{await T();const d=await w("/graphql",{method:"POST",headers:{"X-Shop":h},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            seoMetadata
            aiMetadata
            organizationSchema
            localBusinessSchema
          }
        }
      `,variables:{shop:h}}});if(d.error)throw new Error(d.error);const n=(e=d.data)==null?void 0:e.storeMetadata;if(n){const l=window.open("","_blank");console.log("[STORE-METADATA] Raw preview data:",n),console.log("[STORE-METADATA] seoMetadata raw:",n.seoMetadata),console.log("[STORE-METADATA] aiMetadata raw:",n.aiMetadata),console.log("[STORE-METADATA] organizationSchema raw:",n.organizationSchema);const o={shopName:n.shopName,description:n.description,seoMetadata:n.seoMetadata?(()=>{try{return JSON.parse(n.seoMetadata)}catch(c){return console.error("Error parsing seoMetadata:",c),n.seoMetadata}})():null,aiMetadata:n.aiMetadata?(()=>{try{return JSON.parse(n.aiMetadata)}catch(c){return console.error("Error parsing aiMetadata:",c),n.aiMetadata}})():null,organizationSchema:n.organizationSchema?(()=>{try{return JSON.parse(n.organizationSchema)}catch(c){return console.error("Error parsing organizationSchema:",c),n.organizationSchema}})():null,localBusinessSchema:n.localBusinessSchema?(()=>{try{return JSON.parse(n.localBusinessSchema)}catch(c){return console.error("Error parsing localBusinessSchema:",c),n.localBusinessSchema}})():null};l.document.write(`
          <html>
            <head>
              <title>Store Metadata Preview</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
                h1 { color: #333; }
                .section { margin: 20px 0; }
                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
              </style>
            </head>
            <body>
              <h1>Store Metadata Preview</h1>
              <div class="section">
                <h2>Basic Info</h2>
                <p><strong>Shop Name:</strong> ${o.shopName||"Not set"}</p>
                <p><strong>Description:</strong> ${o.description||"Not set"}</p>
              </div>
              
              <div class="section">
                <h2>SEO Metadata</h2>
                <pre>${JSON.stringify(o.seoMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>AI Metadata</h2>
                <pre>${JSON.stringify(o.aiMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Organization Schema</h2>
                <pre>${JSON.stringify(o.organizationSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Local Business Schema</h2>
                <pre>${JSON.stringify(o.localBusinessSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Raw Data</h2>
                <pre>${JSON.stringify(o,null,2)}</pre>
              </div>
            </body>
          </html>
        `),l.document.close()}else throw new Error("No preview data available")}catch(a){S(`Preview failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{v(!1)}}async function Z(){I(!0);try{i({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}}),await T(),S("Metadata cleared successfully!")}catch(e){S(`Clear failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{I(!1)}}return G&&!g?t.jsx(M,{children:t.jsx(p,{padding:"400",children:t.jsx(C,{children:"Loading store data..."})})}):(g==null?void 0:g.plan)==="Starter"?t.jsx(ea,{status:"warning",children:t.jsx(C,{children:"Store metadata features are available starting from the Professional plan."})}):t.jsxs(f,{children:[t.jsx(f.Section,{children:t.jsx(M,{title:"Basic Store Information",children:t.jsx(p,{padding:"400",children:t.jsxs(x,{children:[t.jsx(r,{label:"Store Title",value:s.seo.title,onChange:e=>i(a=>({...a,seo:{...a.seo,title:e}})),helpText:"Short & appealing, max 100 characters (auto-filled from shop name)",maxLength:100}),t.jsx(r,{label:"Store Description",value:s.seo.metaDescription,onChange:e=>i(a=>({...a,seo:{...a.seo,metaDescription:e}})),helpText:"Tell briefly what best describes your business, max 300 chars (auto-filled from shop description)",maxLength:300,multiline:3}),t.jsx(r,{label:"Keywords",value:s.seo.keywords,onChange:e=>i(a=>({...a,seo:{...a.seo,keywords:e}})),helpText:"Comma-separated keywords, max 10 keywords, max 3 words each"})]})})})}),t.jsx(f.Section,{children:t.jsx(M,{title:"AI Metadata",children:t.jsx(p,{padding:"400",children:t.jsxs(x,{children:[t.jsxs(x.Group,{children:[t.jsx(r,{label:"Business Type",value:s.aiMetadata.businessType,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,businessType:e}})),placeholder:"e.g., Fashion Retailer, Electronics Store",helpText:"Max 3 words"}),t.jsx(r,{label:"Target Audience",value:s.aiMetadata.targetAudience,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,targetAudience:e}})),placeholder:"e.g., Young professionals, Parents"})]}),t.jsx(r,{label:"Unique Selling Points",value:s.aiMetadata.uniqueSellingPoints,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,uniqueSellingPoints:e}})),helpText:"Comma-separated list",multiline:2}),t.jsx(r,{label:"Brand Voice",value:s.aiMetadata.brandVoice,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,brandVoice:e}})),placeholder:"e.g., Professional, Friendly, Casual"}),t.jsx(r,{label:"Primary Categories",value:s.aiMetadata.primaryCategories,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,primaryCategories:e}})),helpText:"Main product categories, comma-separated"}),t.jsx(r,{label:"Shipping Information",value:s.aiMetadata.shippingInfo,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,shippingInfo:e}})),helpText:"Shipping costs, delivery times, free shipping thresholds (e.g., Free shipping over $50, 2-3 business days)",multiline:2}),t.jsx(r,{label:"Return Policy",value:s.aiMetadata.returnPolicy,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,returnPolicy:e}})),multiline:2}),t.jsx(ta,{}),t.jsx(C,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),t.jsx(C,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),t.jsx(r,{label:"Supported Languages",value:((P=s.aiMetadata.languages)==null?void 0:P.join(", "))||"",onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,languages:e.split(",").map(d=>d.trim()).filter(d=>d)}})),helpText:"Comma-separated language codes (e.g., en, de, es, fr)",multiline:2}),t.jsx(r,{label:"Supported Currencies",value:((R=s.aiMetadata.supportedCurrencies)==null?void 0:R.join(", "))||"",onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,supportedCurrencies:e.split(",").map(d=>d.trim()).filter(d=>d)}})),helpText:"Comma-separated currency codes (e.g., EUR, USD, GBP)"}),t.jsx(r,{label:"Shipping Regions",value:((D=s.aiMetadata.shippingRegions)==null?void 0:D.join(", "))||"",onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,shippingRegions:e.split(",").map(d=>d.trim()).filter(d=>d)}})),helpText:"Comma-separated regions (e.g., EU, USA, UK, Canada)",multiline:2}),t.jsx(r,{label:"Cultural Considerations",value:s.aiMetadata.culturalConsiderations||"",onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,culturalConsiderations:e}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),(($=g==null?void 0:g.features)==null?void 0:$.organizationSchema)&&t.jsx(f.Section,{children:t.jsx(M,{title:"Organization Schema",children:t.jsxs(p,{padding:"400",children:[t.jsx(J,{label:"Enable Organization Schema",checked:s.organizationSchema.enabled,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,enabled:e}}))}),s.organizationSchema.enabled&&t.jsx(p,{paddingBlockStart:"400",children:t.jsxs(x,{children:[t.jsxs(x.Group,{children:[t.jsx(r,{label:"Organization Name",value:s.organizationSchema.name,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,name:e}}))}),t.jsx(r,{label:"Contact Email",value:s.organizationSchema.email,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,email:e}})),type:"email"})]}),t.jsx(r,{label:"Phone",value:s.organizationSchema.phone,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,phone:e}})),type:"tel"}),t.jsx(r,{label:"Logo URL",value:s.organizationSchema.logo,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,logo:e}})),type:"url"}),t.jsx(r,{label:"Social Media Links",value:s.organizationSchema.sameAs,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,sameAs:e}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}),((O=g==null?void 0:g.features)==null?void 0:O.localBusinessSchema)&&t.jsx(f.Section,{children:t.jsx(M,{title:"Local Business Schema",children:t.jsxs(p,{padding:"400",children:[t.jsxs(V,{align:"start",gap:"200",children:[t.jsx(J,{label:"Enable Local Business Schema",checked:s.localBusinessSchema.enabled,onChange:e=>i(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,enabled:e}}))}),t.jsx(oa,{content:"Optional - only enable if you have physical stores/locations",children:t.jsx(C,{variant:"bodyMd",color:"subdued",children:"ℹ️"})})]}),s.localBusinessSchema.enabled&&t.jsx(p,{paddingBlockStart:"400",children:t.jsxs(x,{children:[t.jsx(r,{label:"Price Range",value:s.localBusinessSchema.priceRange,onChange:e=>i(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,priceRange:e}})),helpText:"e.g., $, $$, $$$, $$$$"}),t.jsx(r,{label:"Opening Hours",value:s.localBusinessSchema.openingHours,onChange:e=>i(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,openingHours:e}})),helpText:"e.g., Mo-Fr 09:00-18:00, Sa 10:00-16:00",multiline:2})]})})]})})}),t.jsx(f.Section,{children:t.jsx(M,{children:t.jsx(p,{padding:"400",children:t.jsxs(V,{gap:"300",children:[t.jsx(k,{onClick:T,loading:H,primary:!0,children:"Save Metadata"}),t.jsx(k,{onClick:Q,loading:K,children:"Preview Metadata"}),t.jsx(k,{onClick:Z,loading:W,destructive:!0,children:"Clear Metadata"})]})})})}),E&&t.jsx(na,{content:E,onDismiss:()=>S("")})]})}export{da as default};
