const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-qHUbOhs_-1757705500013.js","assets/react-vendor-tAaa2TlE-1757705500013.js","assets/index-BaEj9OXy-1757705500013.js","assets/index-BKYVtEqf-1757705500013.js","assets/BulkEdit-Du4Vadl6-1757705500013.js","assets/app-bridge-SIeEAfyW-1757705500013.js","assets/polaris-CuklULjg-1757705500013.js","assets/Collections-BiSKgSec-1757705500013.js","assets/Sitemap-CjNMre8R-1757705500013.js","assets/StoreMetadata-Dp2z_mw4-1757705500013.js","assets/SchemaData-DJQnWsL0-1757705500013.js","assets/Settings-IwAHDBQS-1757705500013.js"])))=>i.map(i=>d[i]);
import{j as t}from"./app-bridge-SIeEAfyW-1757705500013.js";import{a as $,r as h,R as S}from"./react-vendor-tAaa2TlE-1757705500013.js";import{P as M,A as U,B as A,I as R,T as p,a as m,C as y,b as W,F as G,c as q}from"./polaris-CuklULjg-1757705500013.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();var k,b=$;k=b.createRoot,b.hydrateRoot;const z="modulepreload",K=function(e){return"/"+e},D={},f=function(n,o,c){let r=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.allSettled(o.map(a=>{if(a=K(a),a in D)return;D[a]=!0;const u=a.endsWith(".css"),g=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${g}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":z,u||(d.as="script"),d.crossOrigin="",d.href=a,l&&d.setAttribute("nonce",l),document.head.appendChild(d),u)return new Promise((_,v)=>{d.addEventListener("load",_),d.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${a}`)))})}))}function s(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return r.then(i=>{for(const l of i||[])l.status==="rejected"&&s(l.reason);return n().catch(s)})},H=h.createContext(null);function Y(){const e=h.useContext(H);return e||console.warn("[useAppBridge] No App Bridge instance in context"),e}function J({children:e}){const[n,o]=h.useState(null),[c,r]=h.useState(!0),[s,i]=h.useState(null),l=new URLSearchParams(window.location.search),a=l.get("host"),u=l.get("shop"),g="2749a2f6d38ff5796ed256b5c9dc70a1";return console.log("[APP-BRIDGE-PROVIDER] Public App - Initializing with:",{host:a?"Present":"Missing",shop:u?"Present":"Missing",apiKey:"Present"}),h.useEffect(()=>{a||console.warn("[APP-BRIDGE-PROVIDER] No host parameter - app may not be embedded"),f(async()=>{const{createApp:d}=await import("./index-qHUbOhs_-1757705500013.js").then(_=>_.i);return{createApp:d}},__vite__mapDeps([0,1,2])).then(({createApp:d})=>{const _=d({apiKey:g,host:a||u,forceRedirect:!1});console.log("[APP-BRIDGE-PROVIDER] Public App - App instance created"),o(_),window.__SHOPIFY_APP_BRIDGE__=_,r(!1)}).catch(d=>{console.error("[APP-BRIDGE-PROVIDER] Failed to create app:",d),i(d.message),r(!1)})},[g,a,u]),c?t.jsx("div",{children:"Loading..."}):(s&&console.warn("[APP-BRIDGE-PROVIDER] App Bridge initialization failed:",s),t.jsx(H.Provider,{value:n,children:e}))}const Q={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_NAME:"NEW AI SEO",VITE_SHOPIFY_API_KEY:"2749a2f6d38ff5796ed256b5c9dc70a1"};let x=null;async function X(e=!1){var n;if(x)return x;if(window.__SHOPIFY_APP_BRIDGE__)return x=window.__SHOPIFY_APP_BRIDGE__,e&&console.log("[SFETCH] Using global App Bridge instance"),x;try{const o=await f(()=>import("./index-qHUbOhs_-1757705500013.js").then(a=>a.i),__vite__mapDeps([0,1,2])),c=o&&(o.default||o);if(!c)return e&&console.error("[SFETCH] App Bridge module not available"),null;const r=new URLSearchParams(window.location.search).get("host"),s=new URLSearchParams(window.location.search).get("shop"),i=window.__SHOPIFY_API_KEY||import.meta&&Q&&"2749a2f6d38ff5796ed256b5c9dc70a1"||((n=document.querySelector('meta[name="shopify-api-key"]'))==null?void 0:n.getAttribute("content"))||null;if(!i)return e&&console.error("[SFETCH] Missing API key for public app"),null;const l=r||s;return l?(x=c({apiKey:i,host:l,forceRedirect:!1}),e&&console.log("[SFETCH] Public App - AppBridge created"),x):(e&&console.warn("[SFETCH] No host or shop parameter - may not be embedded"),null)}catch(o){return e&&console.error("[SFETCH] AppBridge creation failed:",o),null}}async function Z(e,n=!1){try{n&&console.log("[SFETCH] Getting token from App Bridge...",{app:!!e});const o=await f(()=>import("./index-BKYVtEqf-1757705500013.js").then(s=>s.i),__vite__mapDeps([3,1,2])),c=o&&o.getSessionToken;if(!c||!e)return n&&console.log("[SFETCH] No getSessionToken or app:",{getSessionToken:!!c,app:!!e}),null;n&&console.log("[SFETCH] Calling getSessionToken...");const r=await c(e);return n&&console.log("[SFETCH] Got session token?",!!r,r?`(len=${r.length}, head=${r.slice(0,10)}...)`:""),r||null}catch(o){return n&&console.error("[SFETCH] Token fetch failed:",o),null}}function ee({debug:e}={}){const o=e??!1;return async function(r,{method:s="GET",headers:i={},body:l,shop:a}={}){const u=a?`${r}${r.includes("?")?"&":"?"}shop=${encodeURIComponent(a)}`:r,g=await X(o),d=g?await Z(g,o):null;o&&console.log("[SFETCH] Public App â†’",{url:u,method:s,shopParam:a,hasToken:!!d,tokenHead:d?d.slice(0,10):null}),o&&console.log("[SFETCH] App Bridge details:",{app:!!g,token:!!d,tokenLength:d?d.length:0});const _={method:s,headers:{"Content-Type":"application/json",...i},credentials:"include",body:l?JSON.stringify(l):void 0},v=d?{..._,headers:{..._.headers,Authorization:`Bearer ${d}`}}:_,P=await fetch(u,v);o&&console.log("[SFETCH] Public App â† response",P.status,P.statusText,"for",u);const j=await P.text();let E;try{E=j?JSON.parse(j):null}catch{E={error:(j==null?void 0:j.slice(0,500))||"Non-JSON response"}}if(!P.ok){const V=(E==null?void 0:E.error)||(E==null?void 0:E.message)||`HTTP ${P.status}`,w=new Error(V);throw w.status=P.status,w.body=E,w.debug={url:u,method:s,shopParam:a,hasAuthHeader:!!v.headers.Authorization,tokenHead:d?d.slice(0,10):null},o&&console.error("[SFETCH] ! error",w),w}return E}}const te=(e,n="")=>{try{return new URLSearchParams(window.location.search).get(e)||n}catch{return n}};function ne(){const e=h.useMemo(()=>ee(),[]),n=te("shop","");return{api:e,shop:n}}const I=["en","de","es","fr"],O={en:"ðŸ‡¬ðŸ‡§",de:"ðŸ‡©ðŸ‡ª",es:"ðŸ‡ªðŸ‡¸",fr:"ðŸ‡«ðŸ‡·"},B={en:"English",de:"Deutsch",es:"EspaÃ±ol",fr:"FranÃ§ais"};function re({lang:e="en",setLang:n,t:o}){const[c,r]=h.useState(!1);h.useEffect(()=>{if(!I.includes(e)){try{localStorage.setItem("app_lang","en")}catch{}typeof n=="function"&&n("en")}},[e,n]);const s=I.includes(e)?e:"en",i=t.jsx(A,{onClick:()=>r(a=>!a),disclosure:!0,children:t.jsxs(R,{gap:"200",blockAlign:"center",children:[t.jsx("span",{"aria-hidden":!0,children:O[s]}),t.jsx(p,{as:"span",variant:"bodyMd",children:B[s]})]})}),l=h.useMemo(()=>I.map(a=>({content:`${O[a]} ${B[a]}`,active:a===s,onAction:()=>{try{localStorage.setItem("app_lang",a)}catch{}typeof n=="function"&&n(a),r(!1)}})),[s,n]);return t.jsx(M,{active:c,activator:i,onClose:()=>r(!1),autofocusTarget:"first-node",children:t.jsx(U,{items:l})})}function oe({sectionTitle:e,lang:n,setLang:o,t:c}){return t.jsx(m,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",background:"bg",children:t.jsxs(R,{align:"space-between",blockAlign:"center",children:[t.jsx(p,{as:"h1",variant:"headingLg",children:e}),t.jsx(re,{lang:n,setLang:o,t:c})]})})}const C="en",L={en:()=>f(()=>import("./en-DY--Skhq-1757705500013.js"),[]),de:()=>f(()=>import("./de-BYtsvH6H-1757705500013.js"),[]),es:()=>f(()=>import("./es-Cshzw9pa-1757705500013.js"),[]),fr:()=>f(()=>import("./fr-DGTXCiho-1757705500013.js"),[])},N=Object.keys(L);function se(){try{const e=localStorage.getItem("app_lang");return N.includes(e)?e:null}catch{return null}}function ie(e){try{localStorage.setItem("app_lang",e)}catch{}}function ae(){const[e,n]=h.useState(()=>se()||C),[o,c]=h.useState({});h.useEffect(()=>{let s=!1;async function i(){const a=await(L[e]||L[C])();s||c(a.default||a)}return i(),ie(e),()=>{s=!0}},[e]);const r=h.useMemo(()=>(s,i="")=>{const l=s==null?void 0:s.split(".").reduce((a,u)=>a&&a[u]!==void 0?a[u]:void 0,o);return l!=null?String(l):i||s},[o]);return{lang:e,setLang:n,t:r,dict:o,langs:N}}const F=S.lazy(()=>f(()=>import("./BulkEdit-Du4Vadl6-1757705500013.js"),__vite__mapDeps([4,5,1,6]))),ce=S.lazy(()=>f(()=>import("./Collections-BiSKgSec-1757705500013.js"),__vite__mapDeps([7,5,1,6]))),le=S.lazy(()=>f(()=>import("./Sitemap-CjNMre8R-1757705500013.js"),__vite__mapDeps([8,5,1,6]))),de=S.lazy(()=>f(()=>import("./StoreMetadata-Dp2z_mw4-1757705500013.js"),__vite__mapDeps([9,5,1,6]))),ue=S.lazy(()=>f(()=>import("./SchemaData-DJQnWsL0-1757705500013.js"),__vite__mapDeps([10,5,1,6]))),he=S.lazy(()=>f(()=>import("./Settings-IwAHDBQS-1757705500013.js"),__vite__mapDeps([11,5,1,6]))),pe={Polaris:{ResourceList:{sortingLabel:"Sort by"}}},T=(e,n="")=>{try{return new URLSearchParams(window.location.search).get(e)||n}catch{return n}};function fe(){const[e,n]=h.useState(window.location.pathname);return h.useEffect(()=>{const o=()=>n(window.location.pathname);return window.addEventListener("popstate",o),()=>window.removeEventListener("popstate",o)},[]),{path:e}}function ge({active:e,shop:n}){const o=e==="/"||e.startsWith("/dashboard"),c=e.startsWith("/ai-seo"),r=e.startsWith("/billing"),s=e.startsWith("/settings"),l=new URLSearchParams(window.location.search).get("host"),a=new URLSearchParams;n&&a.set("shop",n),l&&a.set("host",l);const u=a.toString()?`?${a.toString()}`:"";return t.jsxs("ui-nav-menu",{children:[t.jsx("a",{href:`/${u}`,rel:"home",children:"Home"}),t.jsx("a",{href:`/dashboard${u}`,"data-active":o?"true":void 0,children:"Dashboard"}),t.jsx("a",{href:`/ai-seo${u}`,"data-active":c?"true":void 0,children:"AI SEO"}),t.jsx("a",{href:`/billing${u}`,"data-active":r?"true":void 0,children:"Billing"}),t.jsx("a",{href:`/settings${u}`,"data-active":s?"true":void 0,children:"Settings"})]})}const me=S.memo(({shop:e})=>{var s;const[n,o]=h.useState(null),{api:c}=ne(),r=e||T("shop","");return h.useEffect(()=>{r&&c("/plans/me",{shop:r}).then(i=>{i&&!i.error&&o(i)}).catch(i=>console.error("Failed to load plan:",i))},[r,c]),h.useEffect(()=>{r&&c("/collections/check-definitions",{shop:r}).then(i=>{const l=(i.definitions||[]).map(g=>g.key),u=["en","bg","fr"].filter(g=>!l.includes(`seo__${g}`));if(u.length>0)return c("/collections/create-definitions",{method:"POST",shop:r,body:{shop:r,languages:u}})}).catch(i=>console.error("Definitions error:",i))},[r,c]),n?t.jsx(y,{title:"Dashboard",children:t.jsxs(m,{padding:"400",children:[t.jsxs(R,{gap:"800",wrap:!1,children:[t.jsxs(m,{children:[t.jsx(p,{variant:"headingMd",as:"h3",children:"Current plan"}),t.jsx(p,{children:n.plan||"Free"})]}),t.jsxs(m,{children:[t.jsx(p,{variant:"headingMd",as:"h3",children:"Shop"}),t.jsx(p,{children:n.shop||"Ã¢â‚¬â€"})]}),t.jsxs(m,{children:[t.jsx(p,{variant:"headingMd",as:"h3",children:"AI queries"}),t.jsxs(p,{children:[n.ai_queries_used||0," / ",n.ai_queries_limit||0]})]}),t.jsxs(m,{children:[t.jsx(p,{variant:"headingMd",as:"h3",children:"Product limit"}),t.jsx(p,{children:n.product_limit||0})]})]}),t.jsxs(m,{paddingBlockStart:"400",children:[t.jsx(p,{variant:"headingMd",as:"h3",children:"Allowed AI providers"}),t.jsx(p,{children:((s=n.providersAllowed)==null?void 0:s.join(", "))||"None"})]}),n.trial_ends_at&&t.jsxs(m,{paddingBlockStart:"400",children:[t.jsx(p,{variant:"headingMd",as:"h3",children:"Trial ends at"}),t.jsx(p,{children:new Date(n.trial_ends_at).toLocaleDateString()})]})]})}):t.jsx(y,{children:t.jsx(m,{padding:"400",children:t.jsx(p,{children:"Loading plan info..."})})})}),_e=S.memo(()=>{const e=T("shop",""),[n,o]=h.useState(0),c=()=>{switch(n){case 0:return t.jsx(F,{shop:e});case 1:return t.jsx(ce,{shop:e});case 2:return t.jsx(le,{shop:e});case 3:return t.jsx(de,{shop:e});case 4:return t.jsx(ue,{shop:e});default:return t.jsx(F,{shop:e})}};return t.jsxs("div",{children:[t.jsx("div",{style:{borderBottom:"1px solid #e1e3e5",marginBottom:"16px"},children:t.jsxs(R,{gap:"0",children:[t.jsx(A,{primary:n===0,onClick:()=>o(0),children:"Products"}),t.jsx(A,{primary:n===1,onClick:()=>o(1),children:"Collections"}),t.jsx(A,{primary:n===2,onClick:()=>o(2),children:"Sitemap"}),t.jsx(A,{primary:n===3,onClick:()=>o(3),children:"Store metadata"}),t.jsx(A,{primary:n===4,onClick:()=>o(4),children:"Schema Data"})]})}),t.jsx("div",{children:c()})]})});function Ee(){Y();const{path:e}=fe(),{lang:n,setLang:o,t:c}=ae(),r=!!new URLSearchParams(window.location.search).get("host"),s=T("shop",""),i=h.useMemo(()=>e.startsWith("/ai-seo")?"AI SEO":e.startsWith("/billing")?"Billing":e.startsWith("/settings")?"Settings":"Dashboard",[e]);return t.jsxs(W,{i18n:pe,children:[r&&t.jsx(ge,{active:e,shop:s}),t.jsx(G,{children:t.jsxs(q,{children:[t.jsx(oe,{sectionTitle:i,lang:n,setLang:o,t:c,shop:s}),e==="/"||e.startsWith("/dashboard")?t.jsx(me,{shop:s}):e.startsWith("/ai-seo")?t.jsx(_e,{shop:s}):e.startsWith("/billing")?t.jsx(y,{children:t.jsx(m,{padding:"400",children:t.jsx(p,{children:"Billing page"})})}):e.startsWith("/settings")?t.jsx(he,{shop:s}):t.jsx(y,{children:t.jsx(m,{padding:"400",children:t.jsxs(p,{children:["Page not found: ",e]})})})]})})]})}function Se(){const e=new URLSearchParams(window.location.search),n=e.get("host"),o=e.get("shop");return console.log("[MAIN] Public App - Host:",n,"Shop:",o),console.log("[MAIN] Full URL:",window.location.href),console.log("[MAIN] Rendering with AppBridgeProvider (Public App)"),t.jsx(J,{children:t.jsx(Ee,{})})}k(document.getElementById("root")).render(t.jsx(Se,{}));export{ee as m,ne as u};
