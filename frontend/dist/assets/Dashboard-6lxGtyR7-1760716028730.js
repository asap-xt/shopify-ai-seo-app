import{j as e}from"./app-bridge-BsgOorIr-1760716028730.js";import{r as d}from"./react-vendor-tAaa2TlE-1760716028730.js";import{m as q}from"./sessionFetch-CJepNHo3-1760716028730.js";import{L as r,C as h,a as T,T as i,I as x,d as p,e as S,f as D,B as c,g as F}from"./polaris-D588Z-7S-1760716028730.js";const N=(m,s="")=>{try{return new URLSearchParams(window.location.search).get(m)||s}catch{return s}};function K({shop:m}){var y,b,k,C,z,M,L,A,P,B;const s=m||N("shop",""),w=d.useMemo(()=>q(),[]),o=t=>{const l=new URLSearchParams(window.location.search),V=l.toString()?`?${l.toString()}`:"";window.location.href=`${t}${V}`},[O,f]=d.useState(!0),[n,E]=d.useState(null),[a,$]=d.useState(null),[u,R]=d.useState(null);d.useEffect(()=>{s&&I()},[s]);const I=async()=>{try{f(!0);const t=await w(`/api/billing/info?shop=${s}`,{method:"GET",headers:{"Content-Type":"application/json"}});$(t.subscription),R(t.tokens);const l=await w(`/api/dashboard/stats?shop=${s}`,{method:"GET",headers:{"Content-Type":"application/json"}});E(l)}catch(t){console.error("[Dashboard] Error loading data:",t)}finally{f(!1)}},j=((y=n==null?void 0:n.products)==null?void 0:y.total)>0?Math.round(n.products.optimized/n.products.total*100):0,g=((b=n==null?void 0:n.collections)==null?void 0:b.total)>0?Math.round(n.collections.optimized/n.collections.total*100):0,v=["growth","growth extra","enterprise"].includes(a==null?void 0:a.plan),U=["professional","growth","growth extra","enterprise"].includes(a==null?void 0:a.plan),G=(a==null?void 0:a.plan)==="enterprise";return O?e.jsx(r,{children:e.jsx(r.Section,{children:e.jsx(h,{children:e.jsx(T,{padding:"400",children:e.jsx(i,{children:"Loading dashboard..."})})})})}):e.jsxs(r,{children:[e.jsx(r.Section,{children:e.jsxs(x,{gap:"400",wrap:!1,children:[e.jsx("div",{style:{flex:1},children:e.jsx(h,{children:e.jsxs(p,{gap:"400",children:[e.jsxs(x,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",children:"Products"}),e.jsxs(S,{tone:j===100?"success":"attention",children:[((k=n==null?void 0:n.products)==null?void 0:k.optimized)||0," / ",((C=n==null?void 0:n.products)==null?void 0:C.total)||0]})]}),e.jsx(D,{progress:j,tone:j===100?"success":"primary"}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[j,"% optimized for AI Search"]}),((z=n==null?void 0:n.products)==null?void 0:z.lastOptimized)&&e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["Last: ",new Date(n.products.lastOptimized).toLocaleDateString()]})]})})}),v&&e.jsx("div",{style:{flex:1},children:e.jsx(h,{children:e.jsxs(p,{gap:"400",children:[e.jsxs(x,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",children:"Collections"}),e.jsxs(S,{tone:g===100?"success":"attention",children:[((M=n==null?void 0:n.collections)==null?void 0:M.optimized)||0," / ",((L=n==null?void 0:n.collections)==null?void 0:L.total)||0]})]}),e.jsx(D,{progress:g,tone:g===100?"success":"primary"}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[g,"% optimized for AI Search"]}),((A=n==null?void 0:n.collections)==null?void 0:A.lastOptimized)&&e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["Last: ",new Date(n.collections.lastOptimized).toLocaleDateString()]})]})})}),e.jsx("div",{style:{flex:1},children:e.jsx(h,{children:e.jsxs(p,{gap:"400",children:[e.jsx(i,{variant:"headingMd",children:"Token Balance"}),e.jsxs(T,{children:[e.jsx(i,{variant:"heading2xl",alignment:"center",children:((P=u==null?void 0:u.balance)==null?void 0:P.toLocaleString())||0}),e.jsx(i,{variant:"bodySm",tone:"subdued",alignment:"center",children:"tokens available"}),((a==null?void 0:a.plan)==="growth extra"||(a==null?void 0:a.plan)==="enterprise")&&e.jsxs(i,{variant:"bodySm",tone:"subdued",alignment:"center",children:["(",(a==null?void 0:a.plan)==="growth extra"?"100M":"300M"," included)"]})]}),e.jsx(c,{variant:"primary",fullWidth:!0,onClick:()=>o("/billing"),children:"Manage Tokens"})]})})})]})}),e.jsx(r.Section,{children:e.jsx(h,{children:e.jsxs(p,{gap:"400",children:[e.jsx(i,{variant:"headingMd",children:"Quick Actions"}),e.jsxs(x,{gap:"300",wrap:!0,children:[e.jsx(c,{onClick:()=>o("/ai-seo/products"),children:"Optimize Products"}),v&&e.jsx(c,{onClick:()=>o("/ai-seo/collections"),children:"Optimize Collections"}),U&&e.jsx(c,{onClick:()=>o("/ai-seo/store-metadata"),children:"Edit Store Metadata"}),e.jsx(c,{onClick:()=>o("/ai-seo/sitemap"),children:"View Sitemap"}),G&&e.jsx(c,{onClick:()=>o("/ai-seo/schema-data"),children:"Advanced Schema"})]})]})})}),(n==null?void 0:n.alerts)&&n.alerts.length>0&&e.jsx(r.Section,{children:e.jsx(p,{gap:"300",children:n.alerts.slice(0,2).map((t,l)=>e.jsx(F,{tone:t.type==="warning"?"warning":"info",title:t.title,action:t.action?{content:t.action.label,onAction:()=>o(t.action.url)}:void 0,children:t.message&&e.jsx("p",{children:t.message})},l))})}),e.jsx(r.Section,{children:e.jsx(h,{children:e.jsxs(p,{gap:"300",children:[e.jsxs(x,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",children:"Current Plan"}),e.jsx(S,{tone:"info",children:((B=a==null?void 0:a.plan)==null?void 0:B.toUpperCase())||"N/A"})]}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["$",(a==null?void 0:a.price)||0,"/month"]}),e.jsx(c,{onClick:()=>o("/billing"),children:"View Plans & Billing"})]})})})]})}export{K as default};
