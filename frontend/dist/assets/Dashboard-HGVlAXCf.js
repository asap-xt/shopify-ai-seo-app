import{r as e,j as t}from"./react-vendor-BLtYaay5.js";import{m as n}from"./sessionFetch-CFui2CFn.js";import{g as i}from"./usePlanHierarchy-CpsbOjPs.js";import{d as o}from"./index-DWKtrpRB.js";import{A as s}from"./AIEOScoreCard-Djd0Y563.js";import{T as a}from"./TokenPurchaseModal-CeRUCjk8.js";import{L as r,C as d,B as l,T as c,a as u,I as h,b as p,c as g,D as m,d as x,e as y,f as b,g as j}from"./polaris-DLzuUptG.js";import"./app-bridge-DUY42B6P.js";import"./vendor-L4_WdQez.js";function v({shop:v}){var S,f,w,k,M,I,A,C,z,P,T,$;const D=v||((e,t="")=>{try{return new URLSearchParams(window.location.search).get(e)||t}catch{return t}})("shop",""),O=e.useMemo(()=>n(),[]),E=e=>{const t=new URLSearchParams(window.location.search),n=t.toString()?`?${t.toString()}`:"";window.location.href=`${e}${n}`},[L,_]=e.useState(!0),[B,W]=e.useState(null),[R,N]=e.useState(null),[G,U]=e.useState(null),[F,V]=e.useState([]),[q,J]=e.useState({}),[Y,H]=e.useState({}),[Q,K]=e.useState(null),[X,Z]=e.useState(!1),[ee,te]=e.useState(!1),[ne,ie]=e.useState(()=>{try{const e=localStorage.getItem(`syncCardExpanded_${D}`);return null===e||"true"===e}catch{return!0}}),oe=e.useRef(null),se=e.useRef(!1),ae=e.useRef(null),[re,de]=e.useState(()=>{try{return!("true"===localStorage.getItem(`gettingStartedSeenOnce_${D}`))}catch{return!1}}),[le,ce]=e.useState(()=>{try{return"true"===localStorage.getItem(`dismissedUpgradeBanner_${D}`)}catch{return!1}}),[ue,he]=e.useState(()=>{try{return"true"===localStorage.getItem(`dismissedTokenBanner_${D}`)}catch{return!1}}),[pe,ge]=e.useState(()=>{try{return"true"===localStorage.getItem(`dismissedReviewBanner_${D}`)}catch{return!1}}),[me,xe]=e.useState(()=>{try{return"true"===localStorage.getItem(`clickedReviewRate_${D}`)}catch{return!1}}),[ye,be]=e.useState(!1),je=e.useRef(null);e.useEffect(()=>(ve(!0),Se(),(()=>{try{const e=localStorage.getItem(`ai-test-results-${D}`);if(e){const t=JSON.parse(e);t.results&&J(t.results)}const t=localStorage.getItem(`ai-validation-results-${D}`);if(t){const e=JSON.parse(t);e.results&&H(e.results)}const n=localStorage.getItem(`dashboard-stats-${D}`);n&&JSON.parse(n)}catch(e){}})(),()=>{oe.current&&(clearInterval(oe.current),oe.current=null),je.current&&clearTimeout(je.current),ae.current&&(clearTimeout(ae.current),ae.current=null)}),[D]),e.useEffect(()=>{if(!L&&(null==R?void 0:R.plan)&&re)try{"true"===localStorage.getItem(`gettingStartedSeenOnce_${D}`)||ae.current||(ae.current=setTimeout(()=>{try{localStorage.setItem(`gettingStartedSeenOnce_${D}`,"true")}catch(e){}},1e4))}catch(e){}return()=>{ae.current&&(clearTimeout(ae.current),ae.current=null)}},[L,null==R?void 0:R.plan,re,D]),e.useEffect(()=>{Q&&Q.autoSyncEnabled&&!X&&!se.current&&(o("[Dashboard] Auto-sync is enabled, triggering sync..."),se.current=!0,fe())},[null==Q?void 0:Q.autoSyncEnabled]);const ve=async(e=!1)=>(!e&&je.current&&clearTimeout(je.current),new Promise(t=>{je.current=setTimeout(async()=>{var e,n,i,o;try{_(!0);const[a,r,d]=await Promise.all([O(`/api/dashboard/stats?shop=${D}`),O(`/api/billing/tokens/balance?shop=${D}`),O(`/api/billing/info?shop=${D}`)]);if(a){W(a),N(a.subscription);try{const t={totalProducts:(null==(e=null==a?void 0:a.products)?void 0:e.total)||0,optimizedProducts:(null==(n=null==a?void 0:a.products)?void 0:n.optimized)||0,totalCollections:(null==(i=null==a?void 0:a.collections)?void 0:i.total)||0,optimizedCollections:(null==(o=null==a?void 0:a.collections)?void 0:o.optimized)||0,timestamp:(new Date).toISOString()};localStorage.setItem(`dashboard-stats-${D}`,JSON.stringify(t))}catch(s){}}(null==d?void 0:d.plans)&&V(d.plans),r&&U(r),t()}catch(a){t()}finally{_(!1)}},e?0:500)})),Se=async()=>{try{const e=await O(`/api/dashboard/sync-status?shop=${D}`);e&&(K(e),te(e.autoSyncEnabled||!1),Z(!!e.inProgress))}catch(e){}},fe=async()=>{try{Z(!0);const e=await O(`/api/dashboard/sync?shop=${D}`,{method:"POST"});o("[Dashboard] Sync start response:",e),(null==e?void 0:e.success)||(null==e?void 0:e.inProgress)?(oe.current&&clearInterval(oe.current),oe.current=setInterval(async()=>{try{const e=await O(`/api/dashboard/sync-status?shop=${D}`);e&&(K(e),e.inProgress||(oe.current&&(clearInterval(oe.current),oe.current=null),Z(!1),ve()))}catch(e){}},2e3)):Z(!1)}catch(e){Z(!1)}},we=(null==(S=null==B?void 0:B.products)?void 0:S.total)>0?Math.round(B.products.optimized/B.products.total*100):0,ke=(null==(f=null==B?void 0:B.collections)?void 0:f.total)>0?Math.round(B.collections.optimized/B.collections.total*100):0;i(null==R?void 0:R.plan);const Me=e=>{const t=null==e?void 0:e.toLowerCase().replace(/_/g," "),n=F.find(n=>n.key===t||n.key===e);return(null==n?void 0:n.price)||0},Ie=(null==R?void 0:R.price)&&R.price>0?R.price:(null==R?void 0:R.plan)?Me(R.plan):void 0,Ae=e=>({starter:1,professional:2,professional_plus:2.5,"professional plus":2.5,growth:3,growth_plus:3.5,"growth plus":3.5,growth_extra:4,"growth extra":4,enterprise:5}[e]||0),Ce=()=>{var e,t;if(!B||0===F.length)return null;const n=(null==(e=B.products)?void 0:e.total)||0,i=(null==(t=B.languages)?void 0:t.length)||1,o=(null==R?void 0:R.plan)||"starter",s=Ae(o),a=["growth"];let r=null,d=null;for(const u of F)if(!a.includes(u.key)&&n<=u.productLimit&&i<=u.languageLimit){r=u.key,d=u;break}r||(d=F.find(e=>"enterprise"===e.key),r="enterprise");if(Ae(r)<=s)return null;const l=(e=>{const t=null==e?void 0:e.toLowerCase().replace(/_/g," "),n=F.find(n=>n.key===t||n.key===e);return n?{products:n.productLimit||0,languages:n.languageLimit||1}:{products:0,languages:0}})(o);let c="";return n>l.products?c=`Your store has ${n} products, exceeding the ${l.products}-product limit of your current plan.`:i>l.languages&&(c=`Your store has ${i} language(s), exceeding the ${l.languages}-language limit of your current plan.`),{plan:r,planName:(null==d?void 0:d.name)||r.replace("_"," ").toUpperCase(),price:(null==d?void 0:d.price)||Me(r),productLimit:(null==d?void 0:d.productLimit)||0,languageLimit:(null==d?void 0:d.languageLimit)||1,reason:c}},ze=e.useMemo(()=>Ce(),[B,R,F]),Pe=e.useMemo(()=>{if(!(null==R?void 0:R.plan))return!1;const e=R.plan;if(!["professional","professional_plus","professional plus","growth","growth_plus","growth plus"].includes(e))return!1;return!(((null==G?void 0:G.balance)||0)>=1e3)},[R,G]),Te=e.useMemo(()=>{if(!(null==R?void 0:R.activatedAt))return!1;if(pe||me)return!1;const e=new Date(R.activatedAt),t=new Date;return Math.floor((t-e)/864e5)>=6},[R,pe,me]);if(L)return t.jsx(r,{children:t.jsx(r.Section,{children:t.jsx(d,{children:t.jsx(l,{padding:"400",children:t.jsx(c,{children:"Loading dashboard..."})})})})});const $e=!(null==Q?void 0:Q.synced);return t.jsxs(r,{children:[t.jsx(r.Section,{children:t.jsx(d,{children:t.jsxs(u,{gap:"300",children:[t.jsxs(h,{align:"space-between",blockAlign:"center",children:[t.jsx(c,{variant:"headingMd",children:"Getting Started"}),t.jsxs(p,{onClick:()=>{const e=!re;if(de(e),re&&!e)try{localStorage.setItem(`gettingStartedSeenOnce_${D}`,"true"),ae.current&&(clearTimeout(ae.current),ae.current=null)}catch(t){}},disclosure:re?"up":"down",children:[re?"Hide":"Show"," Guide"]})]}),t.jsx(g,{open:re,id:"onboarding-collapsible",transition:{duration:"200ms",timingFunction:"ease-in-out"},children:t.jsx(l,{paddingBlockStart:"300",children:t.jsxs(u,{gap:"400",children:[t.jsx(m,{}),t.jsxs(u,{gap:"300",children:[t.jsx(c,{variant:"headingMd",as:"h3",children:"What This App Does"}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:["This app helps optimize your Shopify store for ",t.jsx("strong",{children:"AI search engines"})," (like ChatGPT, Claude, Perplexity) by structuring your existing product data in a format that AI bots can easily understand and reference."]}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:[t.jsx("strong",{children:"Important:"})," This app primarily ",t.jsx("strong",{children:"structures"})," your existing data rather than creating new content. AI-enhanced features are supplementary and require additional tokens (unless you're on Growth Extra or Enterprise plans)."]})]}),t.jsx(m,{}),t.jsxs(u,{gap:"200",children:[t.jsx(c,{variant:"headingMd",as:"h3",children:"Video Tutorial"}),t.jsx(l,{padding:"400",background:"bg-surface-secondary",borderRadius:"200",children:t.jsx("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",borderRadius:"8px"},children:t.jsx("iframe",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"},src:"https://www.youtube-nocookie.com/embed/v253h9ucKNk?origin=https://admin.shopify.com",title:"Video Tutorial",referrerPolicy:"no-referrer-when-downgrade",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})})]}),t.jsx(m,{}),t.jsxs(u,{gap:"300",children:[t.jsx(c,{variant:"headingMd",as:"h3",children:"Quick Start Guide"}),t.jsxs(u,{gap:"200",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"1. Sync Your Store Data"}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:'Click "Sync Now" to fetch your products, collections, languages, and markets from Shopify. This is required before you can start optimizing. Enable "Auto-sync on load" to keep your data fresh.'}),t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"2. Token Management"}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:'AI-enhanced features (AI SEO, Advanced Schema, AI Sitemap) require tokens. Purchase tokens from "Plans & Billing" or upgrade to Growth Extra/Enterprise for included monthly allowances.'}),t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"3. Structure Your Product Data"}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:['Go to "Store Optimization for AI" → Products tab. First, create ',t.jsx("strong",{children:"basic optimization"})," by structuring existing titles, descriptions, and metadata for better AI consumption. Data is saved to Shopify metafields (seo_ai namespace). This is essential - without basic optimization, AI-enhanced features cannot be applied."]}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:["Also optimize your ",t.jsx("strong",{children:"Collections"})," to help AI bots understand your product categories and relationships."]}),t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"4. Generate Sitemaps"}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:['Navigate to "Store Optimization for AI" → Sitemap tab to generate your ',t.jsx("strong",{children:"standard sitemap"})," for search engines. AI-Optimized Sitemap with structured data for AI search engines is available in the same tab (Growth Extra+ plans or with tokens)."]}),t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"5. Configure Store Metadata"}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:'Go to "Store Optimization for AI" → Store Metadata tab to configure store description, keywords, business information, and contact details (Professional+ plans). Some data is automatically synced from Shopify but can be manually edited. This helps AI bots understand your brand and business context.'}),t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"6. Schema Data & Advanced Features"}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:'Go to "Store Optimization for AI" → Schema Data tab:'}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:"• Copy basic schema Liquid code to your theme (reads from metafields)"}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:["• ",t.jsx("strong",{children:"Advanced Schema Data:"})," Generate rich AI-enhanced structured data markup (Plus plans: Professional Plus, Growth Plus, Growth Extra, Enterprise)"]}),t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"7. Configure AI Discovery Settings"}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:'Visit "AI Discovery Features" to configure:'}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:["• ",t.jsx("strong",{children:"AI Bot Access Control:"})," Select which AI bots (OpenAI, Claude, Google, etc.) can access your store's structured data"]}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:["• ",t.jsx("strong",{children:"AI Discovery Features:"})," Enable Products JSON Feed, Collections JSON Feed, Store Metadata, AI Welcome Page"]}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:["• Click ",t.jsx("strong",{children:'"Save Settings"'})," to save your configuration"]}),t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"8. Install robots.txt (REQUIRED)"}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:[t.jsx("strong",{children:"Critical:"})," After saving Settings, you must manually install robots.txt in your theme for AI bots to access your endpoints:"]}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:['• In AI Discovery Features, scroll to "robots.txt Configuration" section and click ',t.jsx("strong",{children:'"View & Copy robots.txt Code"'})]}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:"• Copy the generated robots.txt content"}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:["• Go to ",t.jsx("strong",{children:"Online Store → Themes"})," → ",t.jsx("strong",{children:"Actions → Edit code"})," on your active theme"]}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:["• Click ",t.jsx("strong",{children:'"Add a new file"'})," and type: ",t.jsx("code",{children:"templates/robots.txt.liquid"})]}),t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:["• Paste the copied content and click ",t.jsx("strong",{children:"Save"})]}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:t.jsx("strong",{children:"Without this step, AI bots cannot discover your store's endpoints!"})}),t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"9. AI Testing"}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:'Go to "AI Testing" to validate your optimization:'}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:"• Run Basic Tests to check endpoint availability"}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:"• Run AI-Powered Validation for detailed analysis (requires tokens)"}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:"• Check your AIEO Score breakdown"}),t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"10. Monitor & Improve"}),t.jsx(c,{variant:"bodyMd",tone:"subdued",children:"Return to Dashboard regularly to track optimization progress and AIEO Score. Re-optimize when adding new products or editing existing ones to keep AI-structured data current."})]})]}),t.jsx(l,{paddingBlockStart:"200",children:t.jsxs(h,{gap:"200",children:[t.jsx(p,{variant:"primary",onClick:()=>E("/ai-seo/products"),children:"Start Optimizing"}),t.jsx(p,{onClick:()=>E("/billing"),children:"View Plans"})]})})]})})})]})})}),$e&&t.jsx(r.Section,{children:t.jsx(x,{title:"Sync your store",tone:"info",action:{content:X?"Syncing...":"Sync Now",onAction:fe,loading:X},children:t.jsxs(u,{gap:"200",children:[t.jsx(c,{children:"Sync products, collections, languages, and markets to get started with AI optimization."}),X&&t.jsxs(l,{paddingBlockStart:"200",children:[t.jsx(y,{progress:50,size:"small",tone:"highlight"}),t.jsx(l,{paddingBlockStart:"100",children:t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Fetching store data..."})})]})]})})}),!$e&&Q&&t.jsx(r.Section,{children:t.jsx(d,{children:ne?t.jsxs(u,{gap:"300",children:[t.jsxs(h,{align:"space-between",blockAlign:"center",children:[t.jsxs("div",{children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Store Sync"}),t.jsx(l,{paddingBlockStart:"050",children:t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["Last synced: ",Q.lastSyncDate?new Date(Q.lastSyncDate).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"]})})]}),t.jsxs(h,{gap:"200",children:[t.jsx(p,{onClick:fe,loading:X,children:"Sync Now"}),t.jsx(p,{onClick:()=>{ie(!1);try{localStorage.setItem(`syncCardExpanded_${D}`,"false")}catch(e){}},variant:"plain",children:"Close"})]})]}),t.jsx(m,{}),t.jsx(j,{label:"Auto-sync on load",checked:ee,onChange:async e=>{try{o("[Dashboard] Toggling auto-sync to:",e),te(e);const t=await O(`/api/dashboard/auto-sync?shop=${D}`,{method:"POST",body:{enabled:e}});o("[Dashboard] Auto-sync toggle response:",t),(null==t?void 0:t.success)&&(te(!!t.autoSyncEnabled),K({...Q||{},autoSyncEnabled:!!t.autoSyncEnabled}))}catch(t){te(!e)}},helpText:"Automatically sync store data when you open the dashboard"})]}):t.jsxs(h,{align:"space-between",blockAlign:"center",gap:"400",children:[t.jsxs(h,{gap:"200",blockAlign:"center",children:[ee&&t.jsx(b,{tone:"success",children:"Auto-sync enabled"}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["Last synced: ",Q.lastSyncDate?new Date(Q.lastSyncDate).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"]})]}),t.jsxs(h,{gap:"200",children:[t.jsx(p,{onClick:fe,loading:X,size:"slim",children:"Sync Now"}),t.jsx(p,{onClick:()=>{ie(!0);try{localStorage.setItem(`syncCardExpanded_${D}`,"true")}catch(e){}},size:"slim",variant:"plain",children:"Expand"})]})]})})}),ze&&!le&&t.jsx(r.Section,{children:t.jsx(x,{title:`Upgrade to ${ze.planName} Plan`,tone:"warning",action:{content:"View Plans",onAction:()=>E("/billing")},onDismiss:()=>{try{localStorage.setItem(`dismissedUpgradeBanner_${D}`,"true"),ce(!0)}catch(e){}},children:t.jsxs(u,{gap:"200",children:[t.jsx(c,{children:ze.reason}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["The ",ze.planName," plan supports up to ",ze.productLimit," products in ",ze.languageLimit," language",ze.languageLimit>1?"s":""," for $",ze.price,"/month."]})]})})}),Pe&&!ue&&t.jsx(r.Section,{children:t.jsx(x,{title:"Buy Tokens to Unlock AI Features",tone:"info",action:{content:"Buy Tokens",onAction:()=>be(!0)},onDismiss:()=>{try{localStorage.setItem(`dismissedTokenBanner_${D}`,"true"),he(!0)}catch(e){}},children:t.jsx(c,{children:"Purchase tokens to access AI-enhanced optimization features like AEO generation, AI Discovery and more."})})}),Te&&t.jsx(r.Section,{children:t.jsx(x,{title:"Enjoying indexAIze? ⭐",tone:"success",action:{content:"Rate Us",onAction:()=>{try{localStorage.setItem(`clickedReviewRate_${D}`,"true"),xe(!0),window.open("https://apps.shopify.com/indexaize#modal-show=ReviewListingModal","_blank")}catch(e){}}},onDismiss:()=>{try{localStorage.setItem(`dismissedReviewBanner_${D}`,"true"),ge(!0)}catch(e){}},children:t.jsx(c,{children:"Your feedback helps other merchants discover indexAIze. If you're finding value in our app, we'd love a quick review!"})})}),t.jsx(r.Section,{children:t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:"16px"},children:[t.jsx("div",{style:{display:"grid",gap:16},children:t.jsx(d,{children:t.jsxs(u,{gap:"400",children:[t.jsx(c,{variant:"headingMd",children:"Products & Collections"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[t.jsxs(u,{gap:"150",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Products"}),t.jsxs(h,{align:"space-between",children:[t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Total"}),t.jsx(c,{variant:"bodySm",fontWeight:"semibold",children:(null==(w=null==B?void 0:B.products)?void 0:w.total)||0})]}),t.jsxs(h,{align:"space-between",children:[t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Optimized"}),t.jsx(c,{variant:"bodySm",fontWeight:"semibold",tone:"success",children:(null==(k=null==B?void 0:B.products)?void 0:k.optimized)||0})]}),t.jsxs(h,{align:"space-between",children:[t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Unoptimized"}),t.jsx(c,{variant:"bodySm",fontWeight:"semibold",children:Math.max(((null==(M=null==B?void 0:B.products)?void 0:M.total)||0)-((null==(I=null==B?void 0:B.products)?void 0:I.optimized)||0),0)})]}),t.jsxs(l,{paddingBlockStart:"100",children:[t.jsx(y,{progress:we,size:"small",tone:100===we?"success":"primary"}),t.jsx(l,{paddingBlockStart:"050",children:t.jsxs(c,{variant:"bodySm",tone:"subdued",children:[we,"% optimized"]})})]})]}),t.jsxs(u,{gap:"150",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Collections"}),t.jsxs(h,{align:"space-between",children:[t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Total"}),t.jsx(c,{variant:"bodySm",fontWeight:"semibold",children:(null==(A=null==B?void 0:B.collections)?void 0:A.total)||0})]}),t.jsxs(h,{align:"space-between",children:[t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Optimized"}),t.jsx(c,{variant:"bodySm",fontWeight:"semibold",tone:"success",children:(null==(C=null==B?void 0:B.collections)?void 0:C.optimized)||0})]}),t.jsxs(h,{align:"space-between",children:[t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Unoptimized"}),t.jsx(c,{variant:"bodySm",fontWeight:"semibold",children:Math.max(((null==(z=null==B?void 0:B.collections)?void 0:z.total)||0)-((null==(P=null==B?void 0:B.collections)?void 0:P.optimized)||0),0)})]}),t.jsxs(l,{paddingBlockStart:"100",children:[t.jsx(y,{progress:ke,size:"small",tone:100===ke?"success":"primary"}),t.jsx(l,{paddingBlockStart:"050",children:t.jsxs(c,{variant:"bodySm",tone:"subdued",children:[ke,"% optimized"]})})]})]})]}),t.jsx(m,{}),t.jsx(h,{align:"space-between",children:t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["Last synced: ",(null==Q?void 0:Q.lastSyncDate)?new Date(Q.lastSyncDate).toLocaleString():"Never"]})})]})})}),t.jsxs("div",{style:{display:"grid",gap:16},children:[t.jsx(d,{children:t.jsxs(u,{gap:"400",children:[t.jsx(c,{variant:"headingMd",children:"Languages & Markets"}),t.jsx(u,{gap:"200",children:(null==B?void 0:B.languages)&&B.languages.length>0?t.jsxs(t.Fragment,{children:[B.languages.slice().sort((e,t)=>(t.primary?1:0)-(e.primary?1:0)||(t.totalCount||0)-(e.totalCount||0)).slice(0,3).map((e,n)=>{const i=e.totalCount>0?Math.round(e.optimizedCount/e.totalCount*100):0;return t.jsxs(u,{gap:"050",children:[t.jsxs(h,{align:"space-between",children:[t.jsxs(c,{variant:"bodyMd",tone:"subdued",children:[e.name||e.code," ",e.primary?"★":""]}),t.jsxs(c,{variant:"bodySm",fontWeight:"semibold",children:[e.optimizedCount||0,"/",e.totalCount||0]})]}),t.jsx(y,{progress:i,size:"small",tone:100===i?"success":"primary"})]},n)}),B.languages.length>3&&t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["+",B.languages.length-3," more..."]})]}):t.jsx(c,{variant:"bodyMd",tone:"subdued",children:"No language data"})}),(null==B?void 0:B.storeMarkets)&&B.storeMarkets.length>0&&t.jsxs(l,{paddingBlockStart:"200",children:[t.jsx(m,{}),t.jsx(l,{paddingBlockStart:"200",children:t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["Markets: ",B.storeMarkets.slice(0,2).map(e=>e.name).join(", "),B.storeMarkets.length>2?" +"+(B.storeMarkets.length-2):""]})})]})]})}),t.jsx(d,{children:t.jsxs(u,{gap:"300",children:[t.jsx(c,{variant:"headingMd",children:"Last Optimization"}),t.jsx(c,{variant:"bodyLg",fontWeight:"semibold",children:(null==B?void 0:B.lastOptimization)?new Date(B.lastOptimization).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}),t.jsx(p,{onClick:()=>E("/ai-seo/products"),children:"Optimize Now"})]})})]})]})}),t.jsx(r.Section,{children:t.jsx(s,{testResults:q,aiTestResults:Y,stats:(()=>{var e,t,n,i;if(B)return{totalProducts:(null==(e=null==B?void 0:B.products)?void 0:e.total)||0,optimizedProducts:(null==(t=null==B?void 0:B.products)?void 0:t.optimized)||0,totalCollections:(null==(n=null==B?void 0:B.collections)?void 0:n.total)||0,optimizedCollections:(null==(i=null==B?void 0:B.collections)?void 0:i.optimized)||0};try{const e=localStorage.getItem(`dashboard-stats-${D}`);if(e){const t=JSON.parse(e);return{totalProducts:t.totalProducts||0,optimizedProducts:t.optimizedProducts||0,totalCollections:t.totalCollections||0,optimizedCollections:t.optimizedCollections||0}}}catch(o){}return{totalProducts:0,optimizedProducts:0,totalCollections:0,optimizedCollections:0}})(),shop:D,api:O,onTestsComplete:e=>{J(e),ve(!0)}})}),t.jsx(r.Section,{children:t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:"16px"},children:[t.jsx(d,{style:{height:220,minHeight:220},children:t.jsxs(u,{gap:"300",children:[t.jsxs(h,{align:"space-between",blockAlign:"center",children:[t.jsxs("div",{children:[t.jsx(c,{variant:"headingMd",children:"Current Plan"}),t.jsx(l,{paddingBlockStart:"100",children:t.jsxs(c,{variant:"bodySm",tone:"subdued",children:[Ie?`$${Ie.toFixed(2)}`:"—","/month"]})})]}),t.jsx(b,{tone:"info",size:"large",children:(null==(T=null==R?void 0:R.plan)?void 0:T.replace("_"," ").toUpperCase())||"N/A"})]}),t.jsx(p,{onClick:()=>E("/billing"),children:"View Plans & Billing"})]})}),t.jsx(d,{style:{height:220,minHeight:220},children:t.jsxs(u,{gap:"300",children:[t.jsx(c,{variant:"headingMd",children:"Token Balance"}),t.jsxs(c,{variant:"bodyLg",fontWeight:"semibold",children:[(null==($=null==G?void 0:G.balance)?void 0:$.toLocaleString())||0," tokens"]}),("growth_extra"===(null==R?void 0:R.plan)||"enterprise"===(null==R?void 0:R.plan))&&t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["growth_extra"===(null==R?void 0:R.plan)?"100M":"300M"," included monthly"]}),t.jsx(p,{onClick:()=>E("/billing"),children:"Manage Tokens"})]})})]})}),t.jsx(a,{open:ye,onClose:()=>be(!1),shop:D,returnTo:"/dashboard",onPurchaseComplete:()=>{be(!1),ve(!0)}})]})}export{v as default};
