import{r as e,j as t}from"./react-vendor-BLtYaay5.js";import{u as s}from"./useShopApi-Dxe2kUKp.js";import{U as n}from"./UpgradeModal-DoXPQzna.js";import{I as r,T as a}from"./TrialActivationModal-eTt0mMV6.js";import{T as i}from"./TokenPurchaseModal-CeRUCjk8.js";import{S as l}from"./StoreMetadataBanner-3fUD1Drv.js";import{M as o,a as d,T as c,e as u,d as p,b as h,B as g,I as m,g as f,f as x,C as j,h as v,S,i as P,j as b,k as y,R as k,l as A,m as w,n as C,E as $}from"./polaris-DLzuUptG.js";import"./app-bridge-DUY42B6P.js";import"./vendor-L4_WdQez.js";const I=e=>{if(!e)return e;const t=String(e).trim();return t.startsWith("gid://")?t:`gid://shopify/Product/${t}`},z=e=>e<=70?"Starter":e<=200?"Professional":e<=450?"Growth":e<=750?"Growth Extra":"Enterprise";function E({shop:E,globalPlan:R}){var T,O,M;const{api:U,shop:D}=s(),L=E||D||((e,t="")=>{try{return new URLSearchParams(window.location.search).get(e)||t}catch{return t}})("shop","");e.useEffect(()=>{},[L,U]);const[B,q]=e.useState([]),[W,F]=e.useState(!1),[_,N]=e.useState(1),[Y,G]=e.useState(!0),[H,V]=e.useState(0),[K,J]=e.useState([]),[Q,X]=e.useState(!1),[Z,ee]=e.useState(""),[te,se]=e.useState("all"),[ne,re]=e.useState(""),[ae,ie]=e.useState("createdAt"),[le,oe]=e.useState("desc"),[de,ce]=e.useState([]),[ue,pe]=e.useState([]),[he,ge]=e.useState(!1),[me,fe]=e.useState(!1),[xe,je]=e.useState(!1),[ve,Se]=e.useState(!1),[Pe,be]=e.useState(""),[ye,ke]=e.useState([]),[Ae,we]=e.useState([]),[Ce,$e]=e.useState([]),[Ie,ze]=e.useState(!1),[Ee,Re]=e.useState({current:0,total:0,percent:0}),[Te,Oe]=e.useState(""),[Me,Ue]=e.useState([]),[De,Le]=e.useState(!1),[Be,qe]=e.useState(!1),[We,Fe]=e.useState([]),[_e,Ne]=e.useState(!1),[Ye,Ge]=e.useState(!1),[He,Ve]=e.useState("skipped"),[Ke,Je]=e.useState([]),[Qe,Xe]=e.useState(""),[Ze,et]=e.useState({inProgress:!1,status:"idle",message:null,totalProducts:0,processedProducts:0,successfulProducts:0,failedProducts:0,skippedProducts:0,completedAt:null}),tt=e.useRef(null),[st,nt]=e.useState({inProgress:!1,status:"idle",phase:null,message:null,totalProducts:0,processedProducts:0,successfulProducts:0,failedProducts:0,skippedProducts:0}),rt=e.useRef(null),[at,it]=e.useState({inProgress:!1,status:"idle",message:null,totalProducts:0,processedProducts:0,deletedProducts:0,failedProducts:0,completedAt:null}),[lt,ot]=e.useState(null),[dt,ct]=e.useState(70),[ut,pt]=e.useState(1),[ht,gt]=e.useState(!1),[mt,ft]=e.useState("true"===localStorage.getItem("hasVisitedProducts")),[xt,jt]=e.useState(!1),[vt,St]=e.useState(!1),[Pt,bt]=e.useState(!1),[yt,kt]=e.useState(!1),[At,wt]=e.useState(null),[Ct,$t]=e.useState("starter"),[It,zt]=e.useState(!1),Et=e.useCallback(async()=>{try{const e=await U(`/api/seo/job-status?shop=${L}`);return nt(t=>{if(t.inProgress&&!e.inProgress&&("completed"===e.status||"failed"===e.status)){if(rt.current&&(clearInterval(rt.current),rt.current=null),"completed"===e.status){const t=`Applied AIEO to ${e.successfulProducts} product${1!==e.successfulProducts?"s":""}`+(e.skippedProducts>0?` (${e.skippedProducts} skipped)`:"")+(e.failedProducts>0?` (${e.failedProducts} failed)`:"");Xe(t)}else Xe(`AIEO optimization failed: ${e.message||"Unknown error"}`);const t=new URLSearchParams({shop:L,page:1,limit:50,..."all"!==te&&{optimized:te},...Z&&{search:Z},sortBy:ae,sortOrder:le,_t:Date.now()});U(`/api/products/list?${t}`,{shop:L}).then(e=>{var t,s;q(e.products||[]),N(1),G((null==(t=e.pagination)?void 0:t.hasNext)||!1),V((null==(s=e.pagination)?void 0:s.total)||0)})}return e}),e}catch(e){}},[L,U,te,Z,ae,le]),Rt=e.useCallback(()=>{rt.current&&clearInterval(rt.current),nt(e=>({...e,inProgress:!0})),Et(),rt.current=setInterval(()=>{Et()},5e3)},[Et]);e.useEffect(()=>()=>{rt.current&&clearInterval(rt.current)},[]),e.useEffect(()=>{L&&U&&Et().then(e=>{(null==e?void 0:e.inProgress)&&Rt()})},[L]),e.useEffect(()=>{if(R&&"object"==typeof R&&!It&&"starter"===Ct)if(R.planKey&&""!==R.planKey){$t(R.planKey);const e=R.language_limit||1;pt(e)}else if(R.plan&&""!==R.plan){const e=R.plan.toLowerCase().replace(/\s+/g,"-");$t(e);const t=R.language_limit||1;pt(t)}},[R,Ct,It]),e.useEffect(()=>{if(xt&&lt){(Q?H:K.length)<=dt&&(jt(!1),wt(null))}},[K.length,Q,H,xt,lt]),e.useEffect(()=>{if(!L)return;U("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n      query PlansMe($shop:String!) {\n        plansMe(shop:$shop) {\n          plan\n          planKey\n          modelsSuggested\n          product_limit\n          language_limit\n        }\n      }\n    ",variables:{shop:L}})}).then(e=>{var t,s,n;if(null==(t=null==e?void 0:e.errors)?void 0:t.length)throw new Error((null==(s=e.errors[0])?void 0:s.message)||"GraphQL error");const r=null==(n=null==e?void 0:e.data)?void 0:n.plansMe,a=(null==r?void 0:r.modelsSuggested)||["anthropic/claude-3.5-sonnet"];ke(a.map(e=>({label:e,value:e}))),be(a[0]),ot((null==r?void 0:r.plan)||"starter"),$t((null==r?void 0:r.planKey)||"starter");const i=(null==r?void 0:r.product_limit)||70,l=(null==r?void 0:r.language_limit)||1;ct(i),pt(l),zt(!0)}).catch(e=>{zt(!0)})},[L,U]),e.useEffect(()=>{if(!L)return;const e=new Promise((e,t)=>{setTimeout(()=>t(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([U(`/api/languages/shop/${L}`),e]).then(e=>{const t=Array.isArray(null==e?void 0:e.shopLanguages)&&e.shopLanguages.length?e.shopLanguages:["en"];$e(t.includes("en")?t:["en",...t])}).catch(e=>{$e(["en"])})},[L,U]),e.useEffect(()=>{L&&U("/api/products/tags/list",{shop:L}).then(e=>pe((null==e?void 0:e.tags)||[])).catch(e=>{})},[L,U]);const Tt=e.useCallback(async(e=1,t=!1,s=null)=>{var n,r,a,i;F(!0);try{const l=new URLSearchParams({shop:L,page:e,limit:50,..."all"!==te&&{optimized:te},...Z&&{search:Z},...ne&&{languageFilter:ne},...de.length>0&&{tags:de.join(",")},sortBy:ae,sortOrder:le,...s&&{_t:s}}),o=await U(`/api/products/list?${l}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});null==(n=o.products)||n.length,(null==(r=o.products)?void 0:r.length)>0&&o.products.forEach((e,t)=>{}),q(t?e=>[...e,...o.products]:o.products||[]),N(e),G((null==(a=o.pagination)?void 0:a.hasNext)||!1),V((null==(i=o.pagination)?void 0:i.total)||0)}catch(l){q(t?B:[]),G(!1),Xe(`Error loading products: ${l.message}`)}finally{F(!1)}},[L,te,Z,ne,de,ae,le]);e.useEffect(()=>{L&&Tt(1,!1,null)},[L,te,ne,de,ae,le]),e.useEffect(()=>{!mt&&L&&(localStorage.setItem("hasVisitedProducts","true"),ft(!0))},[mt,L]),e.useEffect(()=>{0!==B.length||W||!L||mt||gt(!0)},[B.length,W,L,mt]),e.useEffect(()=>{},[B,K]);const Ot=e.useCallback(e=>{ee(e)},[]);e.useEffect(()=>{const e=setTimeout(()=>{L&&Tt(1,!1,null)},500);return()=>clearTimeout(e)},[Z]);const Mt=e.useCallback(e=>{J(e),(0===e.length||Q&&e.length<B.length)&&X(!1)},[Q,B.length]),Ut=e.useCallback(e=>{X(e),J(e?B.map(e=>e.id):[])},[B]),Dt=e.useMemo(()=>{var e;if(Q)return Ae.length>ut;const t=B.filter(e=>K.includes(e.id));if(0===t.length)return Ae.length>ut;for(const s of t){const t=(null==(e=s.optimizationSummary)?void 0:e.optimizedLanguages)||[],n=Ae.filter(e=>!t.includes(e));if(t.length+n.length>ut)return!0}return!1},[B,K,Q,ut,Ae]),Lt=e.useCallback(async()=>{try{const e=await U(`/ai-enhance/job-status?shop=${L}`);return et(t=>{if(t.inProgress&&!e.inProgress&&("completed"===e.status||"failed"===e.status)){if(tt.current&&(clearInterval(tt.current),tt.current=null),"completed"===e.status){const t=`AI Enhanced ${e.successfulProducts} product${1!==e.successfulProducts?"s":""}`+(e.skippedProducts>0?` (${e.skippedProducts} skipped)`:"")+(e.failedProducts>0?` (${e.failedProducts} failed)`:"");Xe(t)}else"failed"===e.status&&Xe(`AI Enhancement failed: ${e.message||"Unknown error"}`);Tt(1,!1,Date.now())}return e}),e}catch(e){}},[L,U,Tt]),Bt=e.useCallback(()=>{tt.current&&clearInterval(tt.current),Lt(),tt.current=setInterval(()=>{Lt()},5e3)},[Lt]);e.useEffect(()=>()=>{tt.current&&clearInterval(tt.current)},[]),e.useEffect(()=>{L&&Lt().then(e=>{(null==e?void 0:e.inProgress)&&Bt()})},[L,Lt,Bt]);const qt=async()=>{const e=B.filter(e=>K.includes(e.id)),t=e.filter(e=>{var t,s;return(null==(s=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:s.length)>0}),s=e.filter(e=>{var t,s;return!(null==(s=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:s.length)});if(0===t.length)return void(s.length>0?Xe(`${s.length} product(s) have no Basic SEO. Generate Basic SEO first.`):Xe("Please select products with Basic SEO"));const n=t.length;if(n>dt){const e=z(n);return wt({error:"Product limit exceeded",message:`Your ${lt} plan supports up to ${dt} products for AI Enhancement. You have selected ${n} products with Basic SEO.`,minimumPlanRequired:e,currentPlan:lt,features:[`Optimize up to ${dt} products`,"All features from your current plan","Growth Extra"===e||"Enterprise"===e?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons","Enterprise"===e?"Advanced Schema Data":null].filter(Boolean)}),void jt(!0)}const r=t.map(e=>({productId:e.gid||I(e.id),languages:e.optimizationSummary.optimizedLanguages,title:e.title}));try{const e=await U("/ai-enhance/batch",{method:"POST",shop:L,body:{products:r}});e.queued?(Xe(`Enhancing ${r.length} products in background...`),J([]),X(!1),Bt()):Xe(e.message||"Failed to queue AI Enhancement job")}catch(a){if(403===a.status)return wt({...a,message:a.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),$t(a.currentPlan||Ct),void(!1===a.needsUpgrade&&a.requiresPurchase?St(!0):jt(!0));if(402===a.status||a.requiresPurchase||a.trialRestriction)return wt(a),$t(a.currentPlan||lt||"starter"),void(a.trialRestriction&&a.requiresActivation?bt(!0):a.trialRestriction?jt(!0):St(!0));Xe(`Error: ${a.message||"Failed to start AI Enhancement"}`)}},Wt=e=>{if(!e)return"";const t=Math.floor((new Date-new Date(e))/1e3);if(t<60)return"just now";const s=Math.floor(t/60);if(s<60)return`${s}m ago`;const n=Math.floor(s/60);if(n<24)return`${n}h ago`;return`${Math.floor(n/24)}d ago`},Ft=Ie&&t.jsx(o,{open:Ie,title:"Processing Products",onClose:()=>{},noScroll:!0,children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"400",children:[t.jsx(c,{variant:"bodyMd",children:Te?`Processing: ${Te}`:"Preparing..."}),t.jsx(u,{progress:Ee.percent}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:[Ee.current," of ",Ee.total," products (",Ee.percent,"%)"]})]})})}),_t=t.jsx(o,{open:De,title:"Select Languages",onClose:()=>{Le(!1),we([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:async()=>{var e;if(!Ae.length)return void Xe("Please select at least one language");let t=Pe;t&&t.trim()||(t=(null==(e=ye[0])?void 0:e.value)||"anthropic/claude-3.5-sonnet");try{let e=[];if(Q){e=(await U(`/api/products/list?shop=${encodeURIComponent(L)}&limit=1000&fields=id`)).products||[]}else e=B.filter(e=>K.includes(e.id));const s=e.length;if(s>dt){Le(!1);const e=z(s);return wt({error:"Product limit exceeded",message:`Your ${Ct} plan supports up to ${dt} products for SEO optimization. You have selected ${s} products.`,minimumPlanRequired:e,currentPlan:Ct,features:["Optimize more products","All features from your current plan","Growth Extra"===e||"Enterprise"===e?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons","Enterprise"===e?"Advanced Schema Data":null].filter(Boolean)}),void jt(!0)}Le(!1);const n=e.map(e=>{var t;return{productId:e.gid||I(e.productId||e.id),title:e.title||"Unknown product",languages:Ae,existingLanguages:(null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)||[]}}),r=await U("/api/seo/generate-apply-batch",{method:"POST",shop:L,body:{shop:L,products:n,model:t}});r.queued?(J([]),X(!1),Xe(`Optimizing ${n.length} products in background...`),Rt()):Xe(r.message||"Failed to queue optimization job")}catch(s){Xe(`Error: ${s.message}`)}},disabled:0===Ae.length||Dt},secondaryActions:[{content:"Cancel",onAction:()=>{Le(!1),we([])}}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsxs(c,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",Q?"all":K.length," selected products:"]}),Dt&&t.jsx(p,{tone:"warning",title:"Language limit exceeded",children:t.jsxs(d,{gap:"200",children:[t.jsxs(c,{variant:"bodyMd",children:["Your ",Ct," plan supports up to ",ut," language",ut>1?"s":""," per product.",1===K.length&&(null==(M=null==(O=null==(T=B.find(e=>e.id===K[0]))?void 0:T.optimizationSummary)?void 0:O.optimizedLanguages)?void 0:M.length)>0&&t.jsxs(t.Fragment,{children:[" This product already has ",B.find(e=>e.id===K[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),t.jsx(c,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),t.jsx(h,{variant:"primary",onClick:()=>{const e=new URLSearchParams(window.location.search),t=e.toString()?`?${e.toString()}`:"";window.location.href=`/billing${t}`},children:"Upgrade Plan"})]})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"200",wrap:!0,children:Ce.map(e=>t.jsx(f,{label:e.toUpperCase(),checked:Ae.includes(e),onChange:t=>{we(t?[...Ae,e]:Ae.filter(t=>t!==e))}},e))})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(h,{plain:!0,onClick:()=>{Ae.length===Ce.length?we([]):Ce.length>ut?(we([...Ce]),Xe(`You selected ${Ce.length} languages. Your ${Ct} plan supports ${ut}. Please deselect or upgrade.`)):we([...Ce])},children:Ae.length===Ce.length?"Deselect all":"Select all"})}),t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Nt=t.jsx(o,{open:Be,title:"Delete Optimization for AI Search",onClose:()=>{qe(!1),Fe([])},primaryAction:{content:"Continue",onAction:()=>{qe(!1),Ne(!0)},disabled:0===We.length,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{qe(!1),Fe([])}}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsxs(c,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",Q?"all":K.length," selected products:"]}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"200",wrap:!0,children:Ce.map(e=>t.jsx(f,{label:e.toUpperCase(),checked:We.includes(e),onChange:t=>{Fe(t?[...We,e]:We.filter(t=>t!==e))}},e))})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(h,{plain:!0,onClick:()=>{Fe(We.length===Ce.length?[]:[...Ce])},children:We.length===Ce.length?"Deselect all":"Select all"})}),t.jsx(c,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Yt=t.jsx(o,{open:_e,title:"Confirm Deletion",onClose:()=>{Ne(!1)},primaryAction:{content:"Delete",onAction:async()=>{var e;if(We.length){qe(!1),Ne(!1);try{let t=[];if(Q){t=(await U(`/api/products/list?shop=${encodeURIComponent(L)}&limit=1000&fields=id`)).products||[]}else t=B.filter(e=>K.includes(e.id));const s=[];let n=0;for(const l of t){const t=l.gid||I(l.productId||l.id),r=(null==(e=l.optimizationSummary)?void 0:e.optimizedLanguages)||[],a=We.filter(e=>r&&r.length>0&&r.includes(e));if(0!==a.length)for(const e of a)s.push({productId:t,language:e});else n++}if(0===s.length)return void Xe("No optimized products found to delete");const r=[...new Set(s.map(e=>e.productId))].length;it({inProgress:!0,status:"processing",message:`Deleting 0/${r} products...`,totalProducts:r,processedProducts:0,deletedProducts:0,failedProducts:0,completedAt:null}),await U("/seo/bulk-delete-batch",{method:"POST",shop:L,body:{items:s}});const a=async()=>{try{const e=await U(`/seo/delete-job-status?shop=${encodeURIComponent(L)}&_t=${Date.now()}`);if(e.inProgress){const t=e.processedProducts||e.deletedProducts||0;return it({inProgress:!0,status:"processing",message:`Deleting ${t}/${r} products...`,totalProducts:r,processedProducts:t,deletedProducts:e.deletedProducts||0,failedProducts:e.failedProducts||0,completedAt:null}),!1}if("completed"===e.status){const t=e.deletedProducts||0,s=e.failedProducts||0;return q(e=>e.map(e=>{var t,s;const n=((null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)||[]).filter(e=>!We.includes(e));return{...e,optimizationSummary:{...e.optimizationSummary,optimizedLanguages:n,optimized:n.length>0,aiEnhanced:n.length>0&&(null==(s=e.optimizationSummary)?void 0:s.aiEnhanced)}}})),J([]),X(!1),nt({inProgress:!1,status:"idle",message:null}),it({inProgress:!1,status:"completed",message:`Deleted ${t} product${1!==t?"s":""}${s>0?` (${s} failed)`:""}${n>0?` (${n} skipped)`:""}`,totalProducts:r,processedProducts:t+s,deletedProducts:t,failedProducts:s,completedAt:(new Date).toISOString()}),!0}return!1}catch(e){return!1}},i=setInterval(async()=>{await a()&&clearInterval(i)},500);return setTimeout(async()=>{await a()&&clearInterval(i)},200),void setTimeout(()=>{clearInterval(i),at.inProgress&&it(e=>({...e,inProgress:!1,status:"failed",message:"Timeout - please refresh to check status"}))},3e5)}catch(t){Xe(`Error: ${t.message}`),it({inProgress:!1,status:"failed",message:t.message,totalProducts:0,processedProducts:0,deletedProducts:0,failedProducts:0,completedAt:null})}}else Xe("Please select at least one language to delete")},destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>Ne(!1)}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsx(c,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),t.jsx(g,{paddingBlock:"200",children:t.jsx(m,{gap:"100",children:We.map(e=>t.jsx(x,{tone:"critical",children:e.toUpperCase()},e))})}),t.jsxs(c,{variant:"bodyMd",children:["This will delete optimisation from ",Q?"ALL":K.length," selected products."]}),t.jsx(c,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Gt=async()=>{try{F(!0),Xe("Syncing products from Shopify...");const e=await U("/api/products/sync",{method:"POST",shop:L});if(!e.success)throw new Error(e.error||"Sync failed");{const t=e.productsCount||e.synced||0;Xe(`✅ Synced ${t} products successfully!`),setTimeout(()=>{Tt(1,!1,Date.now())},1e3)}}catch(e){Xe(`❌ Sync failed: ${e.message}`)}finally{F(!1)}},Ht=t.jsx($,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{ee(""),se("all"),re(""),ce([]),Tt(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Gt},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:t.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return t.jsxs(t.Fragment,{children:[t.jsx(l,{globalPlan:R}),t.jsx(j,{children:t.jsxs(g,{padding:"400",children:[t.jsxs(d,{gap:"300",children:[lt&&t.jsx(p,{tone:"info",children:t.jsxs(m,{gap:"200",align:"space-between",children:[t.jsxs(c,{children:["Your ",t.jsx("strong",{children:lt})," plan includes up to"," ",t.jsx("strong",{children:dt})," products for SEO optimization.",H>dt&&t.jsxs(t.Fragment,{children:[" You have ",H," products, so only the first ",dt," will be processed."]})]}),(K.length>0||Q)&&t.jsxs(c,{children:["Selected: ",Q?Math.min(H,dt):K.length,"/",dt]})]})}),lt&&(K.length>dt||Q&&H>dt)&&t.jsx(p,{tone:"critical",children:t.jsxs(d,{gap:"200",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),t.jsxs(c,{children:["Your ",t.jsx("strong",{children:lt})," plan supports up to ",t.jsx("strong",{children:dt})," products. You have selected ",t.jsx("strong",{children:Q?H:K.length})," products."]}),t.jsx(c,{children:"Please deselect some products or upgrade your plan to continue."}),t.jsxs(m,{gap:"200",children:[t.jsx(h,{onClick:()=>{J([]),X(!1)},children:"Clear Selection"}),t.jsx(h,{variant:"primary",onClick:()=>{wt({error:"Product limit exceeded",message:`Your ${lt} plan supports up to ${dt} products. Upgrade to ${z(Q?H:K.length)} to optimize more products.`,minimumPlanRequired:z(Q?H:K.length)}),jt(!0)},children:"Upgrade Plan"})]})]})}),t.jsxs(m,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[t.jsx(g,{minWidth:"400px",children:t.jsx(v,{label:"",placeholder:"Search by product ID, name, or details...",value:Z,onChange:Ot,prefix:t.jsx(S,{}),clearButton:!0,onClearButtonClick:()=>Ot("")})}),t.jsx(g,{width:"320px",children:t.jsx(h,{primary:!0,onClick:()=>{0!==K.length||Q?Le(!0):Xe("Please select products first")},disabled:0===K.length&&!Q,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),t.jsxs(m,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[t.jsx(h,{onClick:Gt,disabled:W,size:"medium",children:"Sync Products"}),t.jsx(g,{width:"320px",children:t.jsxs(d,{gap:"200",align:"end",children:[(()=>{if(0===K.length&&!Q)return null;if(!B.filter(e=>K.includes(e.id)).some(e=>{var t,s;return(null==(s=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:s.length)>0}))return null;const e=["professional","professional_plus","professional plus","growth","growth_plus","growth plus","growth_extra","growth extra","enterprise"].includes(Ct.toLowerCase().replace(/_/g," "));return t.jsx(h,{onClick:e?qt:()=>{wt({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),jt(!0)},disabled:0===K.length&&!Q,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),t.jsx(h,{onClick:()=>{0!==K.length||Q?(Fe([]),qe(!0)):Xe("Please select products first")},disabled:0===K.length&&!Q||!B.filter(e=>K.includes(e.id)).some(e=>{var t,s;return(null==(s=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:s.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),H>0&&t.jsx(g,{paddingBlockStart:"300",children:t.jsx(f,{label:`Select all ${H} products in your store`,checked:Q,onChange:Ut})})]})}),(()=>{var e,s,n,r,a,i,l,o,p,f;const v=Ze.inProgress||"completed"===Ze.status||"failed"===Ze.status,S=st.inProgress||"completed"===st.status||"failed"===st.status;return v?t.jsx(g,{paddingBlockStart:"400",children:t.jsx(j,{children:t.jsx(g,{padding:"400",children:Ze.inProgress?t.jsxs(m,{gap:"300",align:"start",blockAlign:"center",children:[t.jsx(P,{size:"small"}),t.jsxs(d,{gap:"100",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"AI Enhancing Products..."}),t.jsx(c,{variant:"bodySm",tone:"subdued",children:Ze.message||`Processing ${Ze.processedProducts}/${Ze.totalProducts} products`}),Ze.totalProducts>0&&t.jsx(g,{paddingBlockStart:"100",children:t.jsx(u,{progress:Ze.processedProducts/Ze.totalProducts*100,size:"small"})})]})]}):"completed"===Ze.status?t.jsx(d,{gap:"100",children:t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"success",children:"AI Enhanced"}),t.jsxs(c,{variant:"bodyMd",children:["Enhanced ",Ze.successfulProducts," product",1!==Ze.successfulProducts?"s":""]}),Ze.skippedProducts>0&&(null==(e=Ze.skipReasons)?void 0:e.length)>0&&t.jsx(h,{variant:"plain",onClick:()=>{Ve("skipped"),Je(Ze.skipReasons),Ge(!0)},children:t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["(",Ze.skippedProducts," skipped)"]})}),Ze.skippedProducts>0&&!(null==(s=Ze.skipReasons)?void 0:s.length)&&t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["(",Ze.skippedProducts," skipped)"]}),Ze.failedProducts>0&&(null==(n=Ze.failReasons)?void 0:n.length)>0&&t.jsx(h,{variant:"plain",onClick:()=>{Ve("failed"),Je(Ze.failReasons),Ge(!0)},children:t.jsxs(c,{variant:"bodySm",tone:"critical",children:["(",Ze.failedProducts," failed)"]})}),Ze.failedProducts>0&&!(null==(r=Ze.failReasons)?void 0:r.length)&&t.jsxs(c,{variant:"bodySm",tone:"critical",children:["(",Ze.failedProducts," failed)"]}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["· ",Wt(Ze.completedAt)]})]})}):t.jsx(d,{gap:"100",children:t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"critical",children:"AI Enhancement Failed"}),t.jsx(c,{variant:"bodyMd",tone:"critical",children:Ze.message||"Enhancement failed"}),Ze.successfulProducts>0&&t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["· ",Ze.successfulProducts," succeeded before failure"]}),(null==(a=Ze.failReasons)?void 0:a.length)>0&&t.jsx(h,{variant:"plain",onClick:()=>{Ve("failed"),Je(Ze.failReasons),Ge(!0)},children:t.jsxs(c,{variant:"bodySm",tone:"critical",children:["View ",Ze.failReasons.length," errors"]})})]})})})})}):S?t.jsx(g,{paddingBlockStart:"400",children:t.jsx(j,{children:t.jsx(g,{padding:"400",children:st.inProgress?t.jsxs(m,{gap:"300",align:"start",blockAlign:"center",children:[t.jsx(P,{size:"small"}),t.jsxs(d,{gap:"100",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"generate"===st.phase?"Generating AIEO...":"Applying AIEO..."}),t.jsx(c,{variant:"bodySm",tone:"subdued",children:st.message||`Processing ${st.processedProducts}/${st.totalProducts} products`}),st.totalProducts>0&&t.jsx(g,{paddingBlockStart:"100",children:t.jsx(u,{progress:st.processedProducts/st.totalProducts*100,size:"small"})})]})]}):"completed"===st.status?t.jsx(d,{gap:"100",children:t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"success",children:"Completed"}),t.jsxs(c,{variant:"bodyMd",children:["Applied AIEO to ",st.successfulProducts," product",1!==st.successfulProducts?"s":""]}),st.skippedProducts>0&&(null==(i=st.skipReasons)?void 0:i.length)>0&&t.jsx(h,{variant:"plain",onClick:()=>{Ve("skipped"),Je(st.skipReasons),Ge(!0)},children:t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["(",st.skippedProducts," skipped)"]})}),st.skippedProducts>0&&!(null==(l=st.skipReasons)?void 0:l.length)&&t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["(",st.skippedProducts," skipped)"]}),st.failedProducts>0&&(null==(o=st.failReasons)?void 0:o.length)>0&&t.jsx(h,{variant:"plain",onClick:()=>{Ve("failed"),Je(st.failReasons),Ge(!0)},children:t.jsxs(c,{variant:"bodySm",tone:"critical",children:["(",st.failedProducts," failed)"]})}),st.failedProducts>0&&!(null==(p=st.failReasons)?void 0:p.length)&&t.jsxs(c,{variant:"bodySm",tone:"critical",children:["(",st.failedProducts," failed)"]}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["· ",Wt(st.completedAt)]})]})}):t.jsx(d,{gap:"100",children:t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"critical",children:"Failed"}),t.jsx(c,{variant:"bodyMd",tone:"critical",children:st.message||"Optimization failed"}),st.successfulProducts>0&&t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["· ",st.successfulProducts," succeeded before failure"]}),(null==(f=st.failReasons)?void 0:f.length)>0&&t.jsx(h,{variant:"plain",onClick:()=>{Ve("failed"),Je(st.failReasons),Ge(!0)},children:t.jsxs(c,{variant:"bodySm",tone:"critical",children:["View ",st.failReasons.length," errors"]})})]})})})})}):null})(),(at.inProgress||"completed"===at.status||"failed"===at.status)&&t.jsx(g,{paddingBlockStart:"400",children:t.jsx(j,{children:t.jsx(g,{padding:"400",children:at.inProgress?t.jsxs(m,{gap:"300",align:"start",blockAlign:"center",children:[t.jsx(P,{size:"small"}),t.jsxs(d,{gap:"100",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Deleting Optimization Data..."}),t.jsx(c,{variant:"bodySm",tone:"subdued",children:at.message||`Processing ${at.processedProducts}/${at.totalProducts} products`}),at.totalProducts>0&&t.jsx(g,{paddingBlockStart:"100",children:t.jsx(u,{progress:at.processedProducts/at.totalProducts*100,size:"small"})})]})]}):"completed"===at.status?t.jsx(d,{gap:"100",children:t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"info",children:"Deleted"}),t.jsx(c,{variant:"bodyMd",children:at.message}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["· ",Wt(at.completedAt)]}),t.jsx(h,{variant:"plain",onClick:()=>it({inProgress:!1,status:"idle",message:null}),children:t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Dismiss"})})]})}):t.jsx(d,{gap:"100",children:t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"critical",children:"Delete Failed"}),t.jsx(c,{variant:"bodyMd",tone:"critical",children:at.message||"Delete operation failed"}),t.jsx(h,{variant:"plain",onClick:()=>it({inProgress:!1,status:"idle",message:null}),children:t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Dismiss"})})]})})})})}),t.jsx(g,{paddingBlockStart:"400",children:t.jsxs(j,{children:[t.jsxs(g,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[t.jsxs(m,{gap:"200",wrap:!0,align:"space-between",children:[t.jsxs(m,{gap:"200",wrap:!0,children:[t.jsx(b,{active:he,activator:t.jsx(h,{disclosure:"down",onClick:()=>ge(!he),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"AI Search Status"}),"all"!==te&&t.jsx(g,{onClick:e=>{e.stopPropagation(),se("all")},children:t.jsx(c,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ge(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(y,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[te],onChange:e=>{se(e[0]),re(""),ge(!1)}})})}),t.jsx(b,{active:me,activator:t.jsx(h,{disclosure:"down",onClick:()=>fe(!me),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"Language Status"}),ne&&t.jsx(g,{onClick:e=>{e.stopPropagation(),re("")},children:t.jsx(c,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>fe(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(y,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...Ce.map(e=>({label:`Has ${e.toUpperCase()}`,value:`has_${e}`})),...Ce.map(e=>({label:`Missing ${e.toUpperCase()}`,value:`missing_${e}`}))],selected:ne?[ne]:[],onChange:e=>{re(e[0]||""),fe(!1)}})})}),t.jsx(b,{active:xe,activator:t.jsx(h,{disclosure:"down",onClick:()=>je(!xe),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"Tags"}),de.length>0&&t.jsx(g,{onClick:e=>{e.stopPropagation(),ce([])},children:t.jsx(c,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>je(!1),children:t.jsxs(g,{padding:"300",minWidth:"200px",children:[t.jsx(y,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:ue.map(e=>({label:e,value:e})),selected:de,onChange:e=>{ce(e)}}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(h,{size:"slim",onClick:()=>je(!1),children:"Apply"})})]})})]}),t.jsx(b,{active:ve,activator:t.jsx(h,{disclosure:"down",onClick:()=>Se(!ve),removeUnderline:!0,children:t.jsx(m,{gap:"100",blockAlign:"center",children:t.jsx("span",{children:"desc"===le?"Newest first":"Oldest first"})})}),onClose:()=>Se(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(y,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[le],onChange:e=>{oe(e[0]),Se(!1)}})})})]}),("all"!==te||ne||de.length>0)&&t.jsx(g,{paddingBlockStart:"200",children:t.jsxs(m,{gap:"100",wrap:!0,children:["all"!==te&&t.jsx(x,{onRemove:()=>se("all"),children:"true"===te?"Has AI Search Optimisation":"No AI Search Optimisation"}),ne&&t.jsx(x,{onRemove:()=>re(""),children:ne.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())}),de.map(e=>t.jsxs(x,{onRemove:()=>ce(t=>t.filter(t=>t!==e)),children:["Tag: ",e]},e))]})})]}),t.jsxs(g,{children:[t.jsx(g,{paddingBlockEnd:"200",paddingInlineStart:"300",children:t.jsxs(m,{gap:"200",align:"start",children:[t.jsx(f,{checked:K.length===B.length&&B.length>0,onChange:Ut,label:""}),t.jsxs(c,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",K.length>0&&` (${K.length} selected products)`]})]})}),t.jsx(k,{resourceName:{singular:"product",plural:"products"},items:B,renderItem:e=>{var s,n,r;try{const a=e,i=(e=>{if(!e)return"";const t=String(e).match(/\/(\d+)$/);return t?t[1]:e})(a.productId||a.id),l=(null==(s=a.optimizationSummary)?void 0:s.optimizedLanguages)||[],o=(null==(n=a.images)?void 0:n[0])?t.jsx(w,{source:a.images[0].url||a.images[0].src||a.images[0],alt:a.title,size:"small"}):a.imageUrl?t.jsx(w,{source:a.imageUrl,alt:a.title,size:"small"}):t.jsx(g,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return t.jsx(C,{id:a.id,media:o,accessibilityLabel:`View details for ${a.title}`,onClick:e=>{},children:t.jsxs(m,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[t.jsxs(g,{style:{flex:"1 1 40%",minWidth:"250px"},children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:a.title}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["ID: ",i]})]}),t.jsx(g,{style:{flex:"0 0 25%",minWidth:"160px"},children:t.jsxs(m,{gap:"100",wrap:!0,children:[(()=>{if(Ce.length>0)return Ce.map(e=>{const s=l.includes(e),n="DRAFT"===a.status;return t.jsx(x,{tone:n?"subdued":s?"success":"subdued",size:"small",children:e.toUpperCase()},e)});{const e="DRAFT"===a.status;return l.map(s=>t.jsx(x,{tone:e?"subdued":"success",size:"small",children:s.toUpperCase()},s))}})(),(null==(r=a.optimizationSummary)?void 0:r.aiEnhanced)&&"DRAFT"!==a.status&&t.jsx(x,{tone:"info",size:"small",children:"AI✨"})]})}),t.jsx(g,{style:{flex:"0 0 20%",minWidth:"120px",textAlign:"center"},children:"ACTIVE"===a.status?t.jsx(x,{tone:"success",children:"Active"}):"DRAFT"===a.status?t.jsx(x,{children:"Draft"}):"ARCHIVED"===a.status?t.jsx(x,{tone:"warning",children:"Archived"}):t.jsx(x,{children:a.status||"Unknown"})})]})})}catch(a){return null}},selectedItems:K,onSelectionChange:Mt,selectable:!0,loading:W,totalItemsCount:H,emptyState:Ht,showHeader:!1},`products-${B.length}-${K.length}`)]}),Y&&!W&&t.jsx(g,{padding:"400",textAlign:"center",children:t.jsx(h,{onClick:()=>Tt(_+1,!0,null),children:"Load more"})})]})}),Ft,_t,Nt,Yt,t.jsx(o,{open:Ye,onClose:()=>Ge(!1),title:"skipped"===He?"Skipped Products":"Failed Products",primaryAction:{content:"Close",onAction:()=>Ge(!1)},secondaryActions:[{content:"Copy to Clipboard",onAction:async()=>{const e=Ke.join("\n");try{await navigator.clipboard.writeText(e),Xe("Copied to clipboard")}catch(t){const s=document.createElement("textarea");s.value=e,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),Xe("Copied to clipboard")}}}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsx(c,{variant:"bodyMd",tone:"subdued",children:"skipped"===He?"These products were skipped because they are already optimized for the selected languages:":"These products failed to optimize:"}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(d,{gap:"200",children:Ke.map((e,s)=>t.jsx(g,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:t.jsx(c,{variant:"bodySm",tone:"failed"===He?"critical":"subdued",children:e})},s))})})]})})}),t.jsx(o,{open:ht,onClose:()=>gt(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{gt(!1),Gt()}},secondaryActions:[{content:"Skip for now",onAction:()=>gt(!1)}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsx(c,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),t.jsx(c,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),t.jsx(n,{open:xt,onClose:()=>{jt(!1),wt(null)},featureName:(null==At?void 0:At.error)||"Feature",errorMessage:null==At?void 0:At.message,currentPlan:(null==At?void 0:At.currentPlan)||Ct,minimumPlanRequired:null==At?void 0:At.minimumPlanRequired,features:null==At?void 0:At.features}),At&&t.jsxs(t.Fragment,{children:[t.jsx(r,{open:vt,onClose:()=>{St(!1),wt(null)},tokensRequired:At.tokensRequired||0,tokensAvailable:At.tokensAvailable||0,tokensNeeded:At.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:L,needsUpgrade:At.needsUpgrade||!1,minimumPlan:At.minimumPlanForFeature||null,currentPlan:At.currentPlan||Ct,returnTo:"/ai-seo",onBuyTokens:()=>{St(!1),kt(!0)}}),t.jsx(a,{open:Pt,onClose:()=>{bt(!1),wt(null)},feature:At.feature||"ai-seo-product-enhanced",trialEndsAt:At.trialEndsAt,currentPlan:At.currentPlan||Ct,tokensRequired:At.tokensRequired||0,onActivatePlan:async()=>{try{const e=await U("/api/billing/activate",{method:"POST",body:{shop:L,endTrial:!0,returnTo:"/ai-seo"}});if(e.requiresApproval&&e.confirmationUrl)return void(window.top.location.href=e.confirmationUrl);window.location.reload()}catch(e){const t=new URLSearchParams(window.location.search),s=t.get("host"),n=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(L)}&embedded=${n}&host=${encodeURIComponent(s)}`}},onPurchaseTokens:()=>{bt(!1),kt(!0)}})]}),t.jsx(i,{open:yt,onClose:()=>{kt(!1),wt(null)},shop:L,returnTo:"/ai-seo",inTrial:!!(null==At?void 0:At.trialEndsAt)}),Qe&&t.jsx(A,{content:Qe,onDismiss:()=>Xe("")})]})}export{E as default};
