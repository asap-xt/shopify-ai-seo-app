import{j as e}from"./app-bridge-CK5IfaAu-1760335168697.js";import{r as a}from"./react-vendor-tAaa2TlE-1760335168697.js";import{u as Ft}from"./index-zA686Upo-1760335168697.js";import{U as Ht,I as Gt}from"./InsufficientTokensModal-QdrSjsU9-1760335168697.js";import{M as P,d as $,T as o,e as Xe,f as Ee,B as I,a as r,I as x,g as ye,D as _t,h as K,C as Ze,i as qt,S as Kt,P as be,j as we,R as Vt,k as Yt,l as et,m as Qt,E as Nt}from"./polaris-BHbk6lHt-1760335168697.js";const Jt=(S,d="")=>{try{return new URLSearchParams(window.location.search).get(S)||d}catch{return d}},$e=S=>{if(!S)return S;const d=String(S).trim();return d.startsWith("gid://")?d:`gid://shopify/Product/${d}`},Xt=S=>{if(!S)return"";const d=String(S).match(/\/(\d+)$/);return d?d[1]:S},R=S=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(S==null?void 0:S.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(S==null?void 0:S.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}};function os({shop:S}){const{api:d,shop:tt}=Ft(),i=S||tt||Jt("shop","");a.useEffect(()=>{},[i,d]);const[C,G]=a.useState([]),[Z,le]=a.useState(!1),[st,Ue]=a.useState(1),[nt,Pe]=a.useState(!0),[_,De]=a.useState(0),[m,ee]=a.useState([]),[v,ce]=a.useState(!1),[q,We]=a.useState(""),[M,de]=a.useState("all"),[z,te]=a.useState(""),[ue,Zt]=a.useState("createdAt"),[V,at]=a.useState("desc"),[U,he]=a.useState([]),[ot,rt]=a.useState([]),[Be,Ce]=a.useState(!1),[Re,ve]=a.useState(!1),[Fe,Ae]=a.useState(!1),[He,ke]=a.useState(!1),[it,lt]=a.useState(""),[ct,dt]=a.useState([]),[O,Y]=a.useState([]),[A,Ge]=a.useState([]),[Ie,Q]=a.useState(!1),[pe,W]=a.useState({current:0,total:0,percent:0}),[_e,N]=a.useState(""),[ge,se]=a.useState([]),[ne,qe]=a.useState({}),[ut,Le]=a.useState(!1),[ht,me]=a.useState(!1),[pt,ae]=a.useState(!1),[B,oe]=a.useState([]),[gt,fe]=a.useState(!1),[Ke,j]=a.useState(""),[Ve,mt]=a.useState(!1),[k,ft]=a.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[L,xt]=a.useState(null),[re,St]=a.useState(1),[jt,xe]=a.useState(!1),[Se,yt]=a.useState(localStorage.getItem("hasVisitedProducts")==="true"),[bt,Ye]=a.useState(!1),[wt,Pt]=a.useState(!1),[J,Qe]=a.useState(null),[ze,Ct]=a.useState("starter");a.useEffect(()=>{if(!i)return;d("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
        }
      }
    `,variables:{shop:i}})}).then(s=>{var l,c,f;if((l=s==null?void 0:s.errors)!=null&&l.length)throw new Error(((c=s.errors[0])==null?void 0:c.message)||"GraphQL error");const n=(f=s==null?void 0:s.data)==null?void 0:f.plansMe,u=(n==null?void 0:n.modelsSuggested)||["anthropic/claude-3.5-sonnet"];dt(u.map(b=>({label:b,value:b}))),lt(u[0]),xt((n==null?void 0:n.plan)||"starter"),Ct((n==null?void 0:n.planKey)||"starter");const g=((n==null?void 0:n.planKey)||"starter").toLowerCase();St({starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[g]||1)}).catch(s=>console.error("[BULK-EDIT] GraphQL plansMe failed:",s))},[i,d]),a.useEffect(()=>{if(!i)return;const t=new Promise((s,n)=>{setTimeout(()=>n(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([d(`/api/languages/shop/${i}`),t]).then(s=>{const n=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];Ge(n.includes("en")?n:["en",...n])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),Ge(["en"])})},[i,d]),a.useEffect(()=>{i&&d("/api/products/tags/list",{shop:i}).then(t=>rt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[i,d]);const F=a.useCallback(async(t=1,s=!1,n=null)=>{var u,g,p;le(!0);try{const l=new URLSearchParams({shop:i,page:t,limit:50,...M!=="all"&&{optimized:M},...q&&{search:q},...z&&{languageFilter:z},...U.length>0&&{tags:U.join(",")},sortBy:ue,sortOrder:V,...n&&{_t:n}}),c=await d(`/api/products/list?${l}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((u=c.products)==null?void 0:u.length)>0,G(s?f=>[...f,...c.products]:c.products||[]),Ue(t),Pe(((g=c.pagination)==null?void 0:g.hasNext)||!1),De(((p=c.pagination)==null?void 0:p.total)||0)}catch(l){G(s?C:[]),Pe(!1),j(`Error loading products: ${l.message}`)}finally{le(!1)}},[i,M,q,z,U,ue,V]);a.useEffect(()=>{i&&F(1,!1,null)},[i,F,M,z,U,ue,V]),a.useEffect(()=>{!Se&&i&&(localStorage.setItem("hasVisitedProducts","true"),yt(!0))},[Se,i]),a.useEffect(()=>{C.length===0&&!Z&&i&&!Se&&xe(!0)},[C.length,Z,i,Se]);const Ne=a.useCallback(t=>{We(t)},[]);a.useEffect(()=>{const t=setTimeout(()=>{i&&F(1,!1,null)},500);return()=>clearTimeout(t)},[q]);const vt=a.useCallback(t=>{ee(t),t.length===0&&ce(!1)},[]),Je=a.useCallback(t=>{ce(t),ee(t?C.map(s=>s.id):[])},[C]),At=()=>{if(m.length===0&&!v){j("Please select products first");return}me(!0)},kt=()=>{if(m.length===0&&!v){j("Please select products first");return}oe([]),ae(!0)},It=()=>{C.filter(n=>m.includes(n.id)).filter(n=>{var u,g;return((g=(u=n.optimizationSummary)==null?void 0:u.optimizedLanguages)==null?void 0:g.length)>0});const s=()=>{mt(!1),ft({processing:!1,current:0,total:0,currentItem:"",results:null}),k.results&&k.results.successful>0&&F(1,!1,null)};return k.processing?e.jsx(P,{open:Ve,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(P.Section,{children:e.jsxs($,{gap:"400",children:[e.jsxs(o,{variant:"bodyMd",children:["Processing: ",k.currentItem]}),e.jsx(Xe,{progress:k.current/k.total*100}),e.jsxs(o,{variant:"bodySm",tone:"subdued",children:[k.current," of ",k.total," products (",Math.round(k.current/k.total*100),"%)"]})]})})}):k.results!==null?e.jsx(P,{open:Ve,title:"AI Enhancement Results",onClose:s,primaryAction:{content:"Done",onAction:s},children:e.jsx(P.Section,{children:e.jsx($,{gap:"300",children:e.jsxs(x,{gap:"400",children:[e.jsxs(r,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"success",children:k.results.successful})]}),e.jsxs(r,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:k.results.failed})]}),e.jsxs(r,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"info",children:k.results.skipped})]})]})})})}):null},Lt=async()=>{var s;if(!O.length){j("Please select at least one language");return}let t=it;(!t||!t.trim())&&(t=((s=ct[0])==null?void 0:s.value)||"anthropic/claude-3.5-sonnet"),me(!1),Q(!0),W({current:0,total:0,percent:0}),se([]),qe({});try{let n=[];v?n=(await d(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:n=C.filter(h=>m.includes(h.id));const u=R(L),g=n.length;n=n.slice(0,u);const p=n.length,l=g-p;W({current:0,total:p,percent:0});const c=5,f={};for(let h=0;h<n.length;h+=c){const y=n.slice(h,Math.min(h+c,n.length)).map(async w=>{var X;N(w.title||w.handle||"Product");try{const je=w.gid||$e(w.productId||w.id),Oe=((X=w.optimizationSummary)==null?void 0:X.optimizedLanguages)||[],Te=O.filter(Rt=>!Oe.includes(Rt));if(Te.length===0){f[w.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Bt=await d("/api/seo/generate-multi",{method:"POST",shop:i,body:{shop:i,productId:je,model:t,languages:Te}});f[w.id]={success:!0,data:Bt,languages:Te}}catch(je){f[w.id]={success:!1,error:je.message},se(Oe=>[...Oe,{product:w.title,error:je.message}])}});await Promise.all(y);const E=Math.min(h+c,n.length),ie=Math.round(E/p*100);W({current:E,total:p,percent:ie})}qe(f),Le(!0);const b=Object.keys(f).filter(h=>f[h].success&&!f[h].skipped).length,T=Object.keys(f).filter(h=>f[h].skipped).length;let H=`Generated Optimization for AI Search for ${b} products`;T>0&&(H+=` (${T} already optimised)`),l>0&&(H+=` (${l} skipped due to plan limit)`),j(H)}catch(n){j(`Error: ${n.message}`)}finally{Q(!1),N("")}},zt=async()=>{var t,s;Q(!0),W({current:0,total:0,percent:0});try{const n=Object.entries(ne).filter(([l,c])=>c.success&&!c.skipped),u=n.length;W({current:0,total:u,percent:0});for(let l=0;l<n.length;l++){const[c,f]=n[l],b=C.find(h=>h.id===c);if(!b)continue;N(b.title||"Product");try{const h=b.gid||$e(b.productId||b.id),D=await d("/api/seo/apply-multi",{method:"POST",shop:i,body:{shop:i,productId:h,results:f.data.results.filter(y=>y==null?void 0:y.seo).map(y=>({language:y.language,seo:y.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});D.appliedLanguages&&D.appliedLanguages.length>0&&G(y=>y.map(E=>{var ie;if(E.id===c){const w=((ie=E.optimizationSummary)==null?void 0:ie.optimizedLanguages)||[],X=[...new Set([...w,...D.appliedLanguages])];return{...E,optimizationSummary:{...E.optimizationSummary,optimizedLanguages:X,optimized:!0,lastOptimized:new Date().toISOString()}}}return E}))}catch(h){se(D=>[...D,{product:b.title,error:`Apply failed: ${h.message}`}])}const T=l+1,H=Math.round(T/u*100);W({current:T,total:u,percent:H})}j("AI Search Optimisation applied successfully!"),Le(!1),ee([]),ce(!1),await new Promise(l=>setTimeout(l,1e3)),G([]);const g=new URLSearchParams({shop:i,page:1,limit:50,...M!=="all"&&{optimized:M},...q&&{search:q},...z&&{languageFilter:z},...U.length>0&&{tags:U.join(",")},sortBy:ue,sortOrder:V,_t:Date.now()}),p=await d(`/api/products/list?${g}`,{shop:i,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});G(p.products||[]),Ue(1),Pe(((t=p.pagination)==null?void 0:t.hasNext)||!1),De(((s=p.pagination)==null?void 0:s.total)||0)}catch(n){j(`Error applying AI Search Optimisation: ${n.message}`)}finally{Q(!1),N("")}},Mt=async()=>{var t;if(!B.length){j("Please select at least one language to delete");return}ae(!1),fe(!1),Q(!0),W({current:0,total:0,percent:0}),se([]);try{let s=[];v?s=(await d(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:s=C.filter(p=>m.includes(p.id));const n=s.length;W({current:0,total:n,percent:0});let u=0,g=0;for(let p=0;p<s.length;p++){const l=s[p];N(l.title||l.handle||"Product");try{const b=l.gid||$e(l.productId||l.id),T=((t=l.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],H=B.filter(D=>T&&T.length>0&&T.includes(D));if(H.length===0){g++;continue}const h=await d("/api/seo/delete-multi",{method:"POST",shop:i,body:{shop:i,productId:b,languages:H}});h.deletedLanguages&&h.deletedLanguages.length>0&&G(D=>D.map(y=>{var E;if(y.id===l.id){const w=(((E=y.optimizationSummary)==null?void 0:E.optimizedLanguages)||[]).filter(X=>!h.deletedLanguages.includes(X));return{...y,optimizationSummary:{...y.optimizationSummary,optimizedLanguages:w,optimized:w.length>0,lastOptimized:w.length>0?y.optimizationSummary.lastOptimized:null}}}return y})),u++,h.deletedLanguages&&h.deletedLanguages.length>0&&await d("/api/products/verify-after-delete",{method:"POST",shop:i,body:{shop:i,productIds:[b],deletedLanguages:h.deletedLanguages}})}catch(b){se(T=>[...T,{product:l.title,error:b.message}])}const c=p+1,f=Math.round(c/n*100);W({current:c,total:n,percent:f})}ee([]),ce(!1),g>0?j(`Deleted Optimization for AI Search from ${u} products (${g} had no optimisation to delete)`):j(`Deleted Optimization for AI Search from ${u} products`),setTimeout(()=>{const p=Date.now();F(1,!1,p)},500)}catch(s){j(`Error: ${s.message}`)}finally{Q(!1),N("")}},Ot=t=>{var p,l;const s=t,n=Xt(s.productId||s.id),u=((p=s.optimizationSummary)==null?void 0:p.optimizedLanguages)||[],g=(l=s.images)!=null&&l[0]?e.jsx(et,{source:s.images[0].url||s.images[0].src||s.images[0],alt:s.title,size:"small"}):s.imageUrl?e.jsx(et,{source:s.imageUrl,alt:s.title,size:"small"}):e.jsx(r,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Qt,{id:s.id,url:"",media:g,accessibilityLabel:`View details for ${s.title}`,children:e.jsxs(x,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(r,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:s.title}),e.jsxs(o,{variant:"bodySm",tone:"subdued",children:["ID: ",n]})]}),e.jsx(r,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(x,{gap:"100",children:A.length>0?A.map(c=>{const f=u.includes(c);return e.jsx(K,{tone:f?"success":"subdued",size:"small",children:c.toUpperCase()},c)}):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),u.map(c=>e.jsx(K,{tone:"success",size:"small",children:c.toUpperCase()},c)))})}),e.jsx(r,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(K,{tone:"success",children:"Active"})})]})})},Tt=Ie&&e.jsx(P,{open:Ie,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(P.Section,{children:e.jsxs($,{gap:"400",children:[e.jsx(o,{variant:"bodyMd",children:_e?`Processing: ${_e}`:"Preparing..."}),e.jsx(Xe,{progress:pe.percent}),e.jsxs(o,{variant:"bodySm",tone:"subdued",children:[pe.current," of ",pe.total," products (",pe.percent,"%)"]})]})})}),Et=e.jsx(P,{open:ht,title:"Select Languages",onClose:()=>{me(!1),Y([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Lt,disabled:O.length===0||O.length>re},secondaryActions:[{content:"Cancel",onAction:()=>{me(!1),Y([])}}],children:e.jsx(P.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(o,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",v?"all":m.length," selected products:"]}),O.length>re&&e.jsx(Ee,{tone:"warning",title:"Language limit exceeded",children:e.jsxs($,{gap:"200",children:[e.jsxs(o,{variant:"bodyMd",children:["Your ",ze," plan supports only ",re," language(s), but you selected ",O.length,"."]}),e.jsx(o,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan:"}),e.jsx(I,{variant:"primary",onClick:()=>{var t;window.location.href=`/billing?shop=${encodeURIComponent(i)}&host=${encodeURIComponent(((t=window.location.search.split("host=")[1])==null?void 0:t.split("&")[0])||"")}`},children:"Upgrade Plan"})]})}),e.jsx(r,{paddingBlockStart:"200",children:e.jsx(x,{gap:"200",wrap:!0,children:A.map(t=>e.jsx(ye,{label:t.toUpperCase(),checked:O.includes(t),onChange:s=>{Y(s?[...O,t]:O.filter(n=>n!==t))}},t))})}),e.jsx(r,{paddingBlockStart:"200",children:e.jsx(I,{plain:!0,onClick:()=>{O.length===A.length?Y([]):A.length>re?(Y([...A]),j(`You selected ${A.length} languages. Your ${ze} plan supports ${re}. Please deselect or upgrade.`)):Y([...A])},children:O.length===A.length?"Deselect all":"Select all"})}),e.jsx(o,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),$t=e.jsx(P,{open:ut&&!Ie,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:zt,disabled:!Object.values(ne).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Le(!1)}],children:e.jsx(P.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(x,{gap:"400",children:[e.jsxs(r,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(ne).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(r,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(ne).filter(t=>t.skipped).length})]}),e.jsxs(r,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(ne).filter(t=>!t.success).length})]})]}),ge.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(_t,{}),e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(r,{maxHeight:"200px",overflowY:"scroll",children:[ge.slice(0,10).map((t,s)=>e.jsxs(o,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),ge.length>10&&e.jsxs(o,{variant:"bodySm",tone:"subdued",children:["... and ",ge.length-10," more errors"]})]})]})]})})}),Ut=e.jsx(P,{open:pt,title:"Delete Optimization for AI Search",onClose:()=>{ae(!1),oe([])},primaryAction:{content:"Continue",onAction:()=>{ae(!1),fe(!0)},disabled:B.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{ae(!1),oe([])}}],children:e.jsx(P.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(o,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",v?"all":m.length," selected products:"]}),e.jsx(r,{paddingBlockStart:"200",children:e.jsx(x,{gap:"200",wrap:!0,children:A.map(t=>e.jsx(ye,{label:t.toUpperCase(),checked:B.includes(t),onChange:s=>{oe(s?[...B,t]:B.filter(n=>n!==t))}},t))})}),e.jsx(r,{paddingBlockStart:"200",children:e.jsx(I,{plain:!0,onClick:()=>{oe(B.length===A.length?[]:[...A])},children:B.length===A.length?"Deselect all":"Select all"})}),e.jsx(o,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Dt=e.jsx(P,{open:gt,title:"Confirm Deletion",onClose:()=>{fe(!1)},primaryAction:{content:"Delete",onAction:Mt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>fe(!1)}],children:e.jsx(P.Section,{children:e.jsxs($,{gap:"300",children:[e.jsx(o,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(r,{paddingBlock:"200",children:e.jsx(x,{gap:"100",children:B.map(t=>e.jsx(K,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(o,{variant:"bodyMd",children:["This will delete optimisation from ",v?"ALL":m.length," selected products."]}),e.jsx(o,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Me=async()=>{try{le(!0),j("Syncing products from Shopify...");const t=await d("/api/products/sync",{method:"POST",shop:i});if(t.success){const s=t.productsCount||t.synced||0;j(`✅ Synced ${s} products successfully!`),setTimeout(()=>{F(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),j(`❌ Sync failed: ${t.message}`)}finally{le(!1)}},Wt=e.jsx(Nt,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{We(""),de("all"),te(""),he([]),F(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Me},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{children:e.jsxs(r,{padding:"400",children:[e.jsxs($,{gap:"300",children:[L&&e.jsx(Ee,{tone:"info",children:e.jsxs(x,{gap:"200",align:"space-between",children:[e.jsxs(o,{children:["Your ",e.jsx("strong",{children:L})," plan includes up to"," ",e.jsx("strong",{children:R(L)})," products for SEO optimization.",_>R(L)&&e.jsxs(e.Fragment,{children:[" You have ",_," products, so only the first ",R(L)," will be processed."]})]}),(m.length>0||v)&&e.jsxs(o,{children:["Selected: ",v?Math.min(_,R(L)):m.length,"/",R(L)]})]})}),L&&(m.length>R(L)||v&&_>R(L))&&e.jsx(Ee,{tone:"warning",children:e.jsxs(x,{gap:"200",align:"space-between",children:[e.jsxs(o,{children:[e.jsx("strong",{children:"Plan Limit Exceeded:"})," You've selected more products than your ",L," plan allows. Only the first ",R(L)," products will be processed."]}),e.jsx(I,{size:"micro",onClick:()=>Ye(!0),children:"Upgrade Plan"})]})}),e.jsxs(x,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(r,{minWidth:"400px",children:e.jsx(qt,{label:"",placeholder:"Search by product ID, name, or details...",value:q,onChange:Ne,prefix:e.jsx(Kt,{}),clearButton:!0,onClearButtonClick:()=>Ne("")})}),e.jsx(r,{width:"320px",children:e.jsx(I,{primary:!0,onClick:At,disabled:m.length===0&&!v,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(x,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(I,{onClick:Me,disabled:Z,size:"medium",children:"Sync Products"}),e.jsx(r,{width:"320px",children:e.jsxs($,{gap:"200",align:"end",children:[m.length===0&&!v||!C.filter(n=>m.includes(n.id)).some(n=>{var u,g;return((g=(u=n.optimizationSummary)==null?void 0:u.optimizedLanguages)==null?void 0:g.length)>0})?null:e.jsx(I,{onClick:handleStartEnhancement,disabled:m.length===0&&!v,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(I,{onClick:kt,disabled:m.length===0&&!v||!C.filter(n=>m.includes(n.id)).some(n=>{var u,g;return((g=(u=n.optimizationSummary)==null?void 0:u.optimizedLanguages)==null?void 0:g.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),_>0&&e.jsx(r,{paddingBlockStart:"300",children:e.jsx(ye,{label:`Select all ${_} products in your store`,checked:v,onChange:Je})})]})}),e.jsx(r,{paddingBlockStart:"400",children:e.jsxs(Ze,{children:[e.jsxs(r,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(x,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(x,{gap:"200",wrap:!0,children:[e.jsx(be,{active:Be,activator:e.jsx(I,{disclosure:"down",onClick:()=>Ce(!Be),removeUnderline:!0,children:e.jsxs(x,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),M!=="all"&&e.jsx(r,{onClick:t=>{t.stopPropagation(),de("all")},children:e.jsx(o,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Ce(!1),children:e.jsx(r,{padding:"300",minWidth:"200px",children:e.jsx(we,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[M],onChange:t=>{de(t[0]),te(""),Ce(!1)}})})}),e.jsx(be,{active:Re,activator:e.jsx(I,{disclosure:"down",onClick:()=>ve(!Re),removeUnderline:!0,children:e.jsxs(x,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),z&&e.jsx(r,{onClick:t=>{t.stopPropagation(),te("")},children:e.jsx(o,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ve(!1),children:e.jsx(r,{padding:"300",minWidth:"200px",children:e.jsx(we,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...A.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...A.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:z?[z]:[],onChange:t=>{te(t[0]||""),ve(!1)}})})}),e.jsx(be,{active:Fe,activator:e.jsx(I,{disclosure:"down",onClick:()=>Ae(!Fe),removeUnderline:!0,children:e.jsxs(x,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),U.length>0&&e.jsx(r,{onClick:t=>{t.stopPropagation(),he([])},children:e.jsx(o,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Ae(!1),children:e.jsxs(r,{padding:"300",minWidth:"200px",children:[e.jsx(we,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:ot.map(t=>({label:t,value:t})),selected:U,onChange:t=>{he(t)}}),e.jsx(r,{paddingBlockStart:"200",children:e.jsx(I,{size:"slim",onClick:()=>Ae(!1),children:"Apply"})})]})})]}),e.jsx(be,{active:He,activator:e.jsx(I,{disclosure:"down",onClick:()=>ke(!He),removeUnderline:!0,children:e.jsx(x,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:V==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>ke(!1),children:e.jsx(r,{padding:"300",minWidth:"200px",children:e.jsx(we,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[V],onChange:t=>{at(t[0]),ke(!1)}})})})]}),(M!=="all"||z||U.length>0)&&e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(x,{gap:"100",wrap:!0,children:[M!=="all"&&e.jsx(K,{onRemove:()=>de("all"),children:M==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),z&&e.jsx(K,{onRemove:()=>te(""),children:z.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),U.map(t=>e.jsxs(K,{onRemove:()=>he(s=>s.filter(n=>n!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(r,{children:[e.jsx(r,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(x,{gap:"200",align:"start",children:[e.jsx(ye,{checked:m.length===C.length&&C.length>0,onChange:Je,label:""}),e.jsxs(o,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",m.length>0&&` (${m.length} selected products)`]})]})}),e.jsx(Vt,{resourceName:{singular:"product",plural:"products"},items:C,renderItem:Ot,selectedItems:m,onSelectionChange:vt,selectable:!0,loading:Z,totalItemsCount:_,emptyState:Wt,showHeader:!1},`products-${C.length}-${m.length}`)]}),nt&&!Z&&e.jsx(r,{padding:"400",textAlign:"center",children:e.jsx(I,{onClick:()=>F(st+1,!0,null),children:"Load more"})})]})}),Tt,Et,$t,Ut,Dt,It(),e.jsx(P,{open:jt,onClose:()=>xe(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{xe(!1),Me()}},secondaryActions:[{content:"Skip for now",onAction:()=>xe(!1)}],children:e.jsx(P.Section,{children:e.jsxs($,{gap:"300",children:[e.jsx(o,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(o,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Ht,{open:bt,onClose:()=>{Ye(!1),Qe(null)},featureName:"AI Enhancement",currentPlan:ze}),J&&e.jsx(Gt,{open:wt,onClose:()=>{Pt(!1),Qe(null)},tokensRequired:J.tokensRequired,tokensAvailable:J.tokensAvailable,feature:"AI-Enhanced Products",shop:i,needsUpgrade:J.needsUpgrade,minimumPlan:J.minimumPlanForFeature,currentPlan:J.currentPlan}),Ke&&e.jsx(Yt,{content:Ke,onDismiss:()=>j("")})]})}export{os as default};
