import{j as e}from"./app-bridge-B48DT27Y-1762013444502.js";import{r as a}from"./react-vendor-tAaa2TlE-1762013444502.js";import{u as Vt}from"./useShopApi-6oTmpMx9-1762013444502.js";import{S as Qt,U as Jt,I as Xt}from"./StoreMetadataBanner-MB5JoZ7a-1762013444502.js";import{M as E,b as R,T as l,c as ut,a as _e,e as k,B as u,I as P,f as Ie,D as Zt,d as ee,C as pt,h as es,S as ts,i as Le,j as Ee,R as ss,k as ns,l as ht,m as rs,E as as}from"./polaris-ByySqubp-1762013444502.js";const os=(f,x="")=>{try{return new URLSearchParams(window.location.search).get(f)||x}catch{return x}},fe=f=>{if(!f)return f;const x=String(f).trim();return x.startsWith("gid://")?x:`gid://shopify/Product/${x}`},is=f=>{if(!f)return"";const x=String(f).match(/\/(\d+)$/);return x?x[1]:f},M=f=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(f==null?void 0:f.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(f==null?void 0:f.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}},ze=f=>new URLSearchParams(window.location.search).get("debug_limits")==="true"?f<=5?"Starter":f<=10?"Growth":f<=12?"Professional":f<=15?"Growth Extra":"Enterprise":f<=100?"Starter":f<=350?"Professional":f<=1e3?"Growth":f<=2500?"Growth Extra":"Enterprise";function gs({shop:f,globalPlan:x}){var lt,ct,dt;const{api:A,shop:gt}=Vt(),d=f||gt||os("shop","");a.useEffect(()=>{},[d,A]);const[w,V]=a.useState([]),[oe,xe]=a.useState(!1),[mt,He]=a.useState(1),[ft,Oe]=a.useState(!0),[$,Fe]=a.useState(0),[h,te]=a.useState([]),[S,ie]=a.useState(!1),[Q,Ke]=a.useState(""),[B,Se]=a.useState("all"),[D,le]=a.useState(""),[je,ls]=a.useState("createdAt"),[se,xt]=a.useState("desc"),[q,ye]=a.useState([]),[St,jt]=a.useState([]),[Ye,ke]=a.useState(!1),[Ve,Me]=a.useState(!1),[Qe,Te]=a.useState(!1),[Je,Re]=a.useState(!1),[yt,wt]=a.useState(""),[bt,Pt]=a.useState([]),[U,ne]=a.useState([]),[z,Xe]=a.useState([]),[$e,J]=a.useState(!1),[we,N]=a.useState({current:0,total:0,percent:0}),[Ze,re]=a.useState(""),[be,ce]=a.useState([]),[de,et]=a.useState({}),[At,De]=a.useState(!1),[Ct,ue]=a.useState(!1),[vt,pe]=a.useState(!1),[_,he]=a.useState([]),[It,Pe]=a.useState(!1),[tt,C]=a.useState(""),[st,nt]=a.useState(!1),[v,X]=a.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[j,Lt]=a.useState(null),[F,Ue]=a.useState(1),[Et,Ae]=a.useState(!1),[Ce,zt]=a.useState(localStorage.getItem("hasVisitedProducts")==="true"),[Be,K]=a.useState(!1),[Ot,rt]=a.useState(!1),[y,H]=a.useState(null),[Y,ge]=a.useState("starter");a.useEffect(()=>{if(!(!x||typeof x!="object")){if(x.planKey&&x.planKey!==""){ge(x.planKey);const s={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[x.planKey.toLowerCase()]||1;Ue(s)}else if(x.plan&&x.plan!==""){const t=x.plan.toLowerCase().replace(/\s+/g,"-");ge(t);const n={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[t]||1;Ue(n)}}},[x]),a.useEffect(()=>{if(Be&&j){const t=M(j);(S?$:h.length)<=t&&(K(!1),H(null))}},[h.length,S,$,Be,j]),a.useEffect(()=>{if(!d)return;A("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
        }
      }
    `,variables:{shop:d}})}).then(s=>{var o,c,r;if((o=s==null?void 0:s.errors)!=null&&o.length)throw new Error(((c=s.errors[0])==null?void 0:c.message)||"GraphQL error");const n=(r=s==null?void 0:s.data)==null?void 0:r.plansMe,i=(n==null?void 0:n.modelsSuggested)||["anthropic/claude-3.5-sonnet"];Pt(i.map(b=>({label:b,value:b}))),wt(i[0]),Lt((n==null?void 0:n.plan)||"starter"),ge((n==null?void 0:n.planKey)||"starter");const m=((n==null?void 0:n.planKey)||"starter").toLowerCase();Ue({starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[m]||1)}).catch(s=>console.error("[BULK-EDIT] GraphQL plansMe failed:",s))},[d,A]),a.useEffect(()=>{if(!d)return;const t=new Promise((s,n)=>{setTimeout(()=>n(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([A(`/api/languages/shop/${d}`),t]).then(s=>{const n=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];Xe(n.includes("en")?n:["en",...n])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),Xe(["en"])})},[d,A]),a.useEffect(()=>{d&&A("/api/products/tags/list",{shop:d}).then(t=>jt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[d,A]);const Z=a.useCallback(async(t=1,s=!1,n=null)=>{var i,m,p,o;xe(!0);try{const c=new URLSearchParams({shop:d,page:t,limit:50,...B!=="all"&&{optimized:B},...Q&&{search:Q},...D&&{languageFilter:D},...q.length>0&&{tags:q.join(",")},sortBy:je,sortOrder:se,...n&&{_t:n}}),r=await A(`/api/products/list?${c}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((i=r.products)==null?void 0:i.length)>0,((m=r.products)==null?void 0:m.length)>0&&r.products.forEach((b,T)=>{}),V(s?b=>[...b,...r.products]:r.products||[]),He(t),Oe(((p=r.pagination)==null?void 0:p.hasNext)||!1),Fe(((o=r.pagination)==null?void 0:o.total)||0)}catch(c){V(s?w:[]),Oe(!1),C(`Error loading products: ${c.message}`)}finally{xe(!1)}},[d,B,Q,D,q,je,se]);a.useEffect(()=>{d&&Z(1,!1,null)},[d,B,D,q,je,se]),a.useEffect(()=>{!Ce&&d&&(localStorage.setItem("hasVisitedProducts","true"),zt(!0))},[Ce,d]),a.useEffect(()=>{w.length===0&&!oe&&d&&!Ce&&Ae(!0)},[w.length,oe,d,Ce]),a.useEffect(()=>{},[w,h]);const at=a.useCallback(t=>{Ke(t)},[]);a.useEffect(()=>{const t=setTimeout(()=>{d&&Z(1,!1,null)},500);return()=>clearTimeout(t)},[Q]);const kt=a.useCallback(t=>{te(t),t.length===0&&ie(!1)},[w]),ot=a.useCallback(t=>{ie(t),te(t?w.map(s=>s.id):[])},[w]),it=a.useMemo(()=>{var s;if(S)return U.length>F;const t=w.filter(n=>h.includes(n.id));if(t.length===0)return U.length>F;for(const n of t){const i=((s=n.optimizationSummary)==null?void 0:s.optimizedLanguages)||[],m=U.filter(o=>!i.includes(o));if(i.length+m.length>F)return!0}return!1},[w,h,S,F,U]),Mt=()=>{if(h.length===0&&!S){C("Please select products first");return}ue(!0)},Tt=()=>{if(h.length===0&&!S){C("Please select products first");return}he([]),pe(!0)},Rt=async()=>{const t=w.filter(o=>h.includes(o.id)),s=t.filter(o=>{var c,r;return((r=(c=o.optimizationSummary)==null?void 0:c.optimizedLanguages)==null?void 0:r.length)>0}),n=t.filter(o=>{var c,r;return!((r=(c=o.optimizationSummary)==null?void 0:c.optimizedLanguages)!=null&&r.length)}),i=M(j),m=s.length;if(m>i){const o=ze(m);H({error:"Product limit exceeded",message:`Your ${j} plan supports up to ${i} products for AI Enhancement. You have selected ${m} products with Basic SEO.`,minimumPlanRequired:o,currentPlan:j,features:[`Optimize up to ${M(o)} products`,"All features from your current plan",o==="Growth Extra"||o==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",o==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),K(!0);return}nt(!0),X({processing:!0,current:0,total:s.length,currentItem:"",results:null});const p={successful:0,failed:0,skipped:n.length,skipReasons:n.length>0?[`${n.length} product(s): No Basic Optimization`]:[]};for(let o=0;o<s.length;o++){const c=s[o];X(r=>({...r,current:o,currentItem:c.title}));try{const r=await A("/ai-enhance/product",{method:"POST",shop:d,body:{shop:d,productId:c.gid||fe(c.id),languages:c.optimizationSummary.optimizedLanguages}});if(r.results&&r.results.length>0){const b={shop:d,productId:c.gid||fe(c.id),results:r.results.filter(O=>O.bullets&&O.faq).map(O=>({language:O.language,seo:{...O.updatedSeo,bullets:O.bullets||[],faq:O.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},T=await A("/api/seo/apply-multi",{method:"POST",shop:d,body:b});p.successful++}else p.failed++}catch(r){if(console.error("❌ [AI-ENHANCE] Enhancement error:",r),console.error("🔍 [AI-ENHANCE DEBUG] Error type:",typeof r),console.error("🔍 [AI-ENHANCE DEBUG] Error.status:",r.status,"Type:",typeof r.status),console.error("🔍 [AI-ENHANCE DEBUG] Error.requiresPurchase:",r.requiresPurchase),console.error("🔍 [AI-ENHANCE DEBUG] Error.trialRestriction:",r.trialRestriction),console.error("🔍 [AI-ENHANCE DEBUG] Full error object:",JSON.stringify(r,Object.getOwnPropertyNames(r))),console.error("🔍 [AI-ENHANCE DEBUG] Error details:",{status:r.status,trialRestriction:r.trialRestriction,needsUpgrade:r.needsUpgrade,requiresPurchase:r.requiresPurchase,message:r.message,currentPlan:r.currentPlan}),r.status===403){X({processing:!1,current:0,total:0,currentItem:"",results:null}),H({...r,message:r.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),ge(r.currentPlan||Y),K(!0);return}if(r.status===402||r.requiresPurchase||r.trialRestriction){X({processing:!1,current:0,total:0,currentItem:"",results:null}),H(r),ge(r.currentPlan||j||"starter"),r.trialRestriction?K(!0):rt(!0);return}p.failed++}X(r=>({...r,current:o+1}))}X(o=>({...o,processing:!1,results:p})),C(`AI enhancement complete! ${p.successful} products enhanced.`)},We=()=>{nt(!1),X({processing:!1,current:0,total:0,currentItem:"",results:null}),v.results&&v.results.successful>0&&Z(1,!1,null)},$t=()=>v.processing?e.jsx(E,{open:st,title:"Processing AI Enhancement",onClose:We,noScroll:!0,children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"400",children:[e.jsxs(l,{variant:"bodyMd",children:["Processing: ",v.currentItem]}),e.jsx(ut,{progress:v.current/v.total*100}),e.jsxs(l,{variant:"bodySm",tone:"subdued",children:[v.current," of ",v.total," products (",Math.round(v.current/v.total*100),"%)"]})]})})}):v.results!==null?e.jsx(E,{open:st,title:"AI Enhancement Results",onClose:We,primaryAction:{content:"Done",onAction:We},children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"400",children:[e.jsxs(P,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"success",children:v.results.successful})]}),e.jsxs(u,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:v.results.failed})]}),e.jsxs(u,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"info",children:v.results.skipped})]})]}),v.results.skipReasons&&v.results.skipReasons.length>0&&e.jsxs(R,{gap:"200",children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped products:"}),v.results.skipReasons.map((t,s)=>e.jsxs(l,{variant:"bodySm",tone:"subdued",children:["• ",t]},s))]})]})})}):null,Dt=async()=>{var s;if(!U.length){C("Please select at least one language");return}let t=yt;(!t||!t.trim())&&(t=((s=bt[0])==null?void 0:s.value)||"anthropic/claude-3.5-sonnet"),J(!0),N({current:0,total:0,percent:0}),ce([]),et({});try{let n=[];S?n=(await A(`/api/products/list?shop=${encodeURIComponent(d)}&limit=1000&fields=id`)).products||[]:n=w.filter(g=>h.includes(g.id));const i=M(j),m=n.length;if(m>i){J(!1),N({current:0,total:0,percent:0}),ue(!1);const g=ze(m);H({error:"Product limit exceeded",message:`Your ${Y} plan supports up to ${i} products for SEO optimization. You have selected ${m} products.`,minimumPlanRequired:g,currentPlan:Y,features:[`Optimize up to ${M(g)} products`,"All features from your current plan",g==="Growth Extra"||g==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",g==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),K(!0);return}ue(!1);const p=m,o=0;N({current:0,total:p,percent:0});const c=5,r={};for(let g=0;g<n.length;g+=c){const I=n.slice(g,Math.min(g+c,n.length)).map(async L=>{var ae;re(L.title||L.handle||"Product");try{const ve=L.gid||fe(L.productId||L.id),Ne=((ae=L.optimizationSummary)==null?void 0:ae.optimizedLanguages)||[],Ge=U.filter(Yt=>!Ne.includes(Yt));if(Ge.length===0){r[L.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Kt=await A("/api/seo/generate-multi",{method:"POST",shop:d,body:{shop:d,productId:ve,model:t,languages:Ge}});r[L.id]={success:!0,data:Kt,languages:Ge}}catch(ve){r[L.id]={success:!1,error:ve.message},ce(Ne=>[...Ne,{product:L.title,error:ve.message}])}});await Promise.all(I);const W=Math.min(g+c,n.length),me=Math.round(W/p*100);N({current:W,total:p,percent:me})}et(r),De(!0);const b=Object.keys(r).filter(g=>r[g].success&&!r[g].skipped).length,T=Object.keys(r).filter(g=>r[g].skipped).length;let O=`Generated Optimization for AI Search for ${b} products`;T>0&&(O+=` (${T} already optimised)`),o>0,C(O)}catch(n){C(`Error: ${n.message}`)}finally{J(!1),re("")}},Ut=async()=>{var t,s;J(!0),N({current:0,total:0,percent:0});try{const n=Object.entries(de).filter(([o,c])=>c.success&&!c.skipped),i=n.length;N({current:0,total:i,percent:0});for(let o=0;o<n.length;o++){const[c,r]=n[o],b=w.find(g=>g.id===c);if(!b)continue;re(b.title||"Product");try{const g=b.gid||fe(b.productId||b.id),G=await A("/api/seo/apply-multi",{method:"POST",shop:d,body:{shop:d,productId:g,results:r.data.results.filter(I=>I==null?void 0:I.seo).map(I=>({language:I.language,seo:I.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});G.appliedLanguages&&G.appliedLanguages.length>0&&V(I=>I.map(W=>{var me;if(W.id===c){const L=((me=W.optimizationSummary)==null?void 0:me.optimizedLanguages)||[],ae=[...new Set([...L,...G.appliedLanguages])];return{...W,optimizationSummary:{...W.optimizationSummary,optimizedLanguages:ae,optimized:!0,lastOptimized:new Date().toISOString()}}}return W}))}catch(g){ce(G=>[...G,{product:b.title,error:`Apply failed: ${g.message}`}])}const T=o+1,O=Math.round(T/i*100);N({current:T,total:i,percent:O})}C("AI Search Optimisation applied successfully!"),De(!1),te([]),ie(!1),await new Promise(o=>setTimeout(o,1e3)),V([]);const m=new URLSearchParams({shop:d,page:1,limit:50,...B!=="all"&&{optimized:B},...Q&&{search:Q},...D&&{languageFilter:D},...q.length>0&&{tags:q.join(",")},sortBy:je,sortOrder:se,_t:Date.now()}),p=await A(`/api/products/list?${m}`,{shop:d,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});V(p.products||[]),He(1),Oe(((t=p.pagination)==null?void 0:t.hasNext)||!1),Fe(((s=p.pagination)==null?void 0:s.total)||0)}catch(n){C(`Error applying AI Search Optimisation: ${n.message}`)}finally{J(!1),re("")}},Bt=async()=>{var t;if(!_.length){C("Please select at least one language to delete");return}pe(!1),Pe(!1),J(!0),N({current:0,total:0,percent:0}),ce([]);try{let s=[];S?s=(await A(`/api/products/list?shop=${encodeURIComponent(d)}&limit=1000&fields=id`)).products||[]:s=w.filter(p=>h.includes(p.id));const n=s.length;N({current:0,total:n,percent:0});let i=0,m=0;for(let p=0;p<s.length;p++){const o=s[p];re(o.title||o.handle||"Product");try{const b=o.gid||fe(o.productId||o.id),T=((t=o.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],O=_.filter(G=>T&&T.length>0&&T.includes(G));if(O.length===0){m++;continue}const g=await A("/api/seo/delete-multi",{method:"POST",shop:d,body:{shop:d,productId:b,languages:O}});g.deletedLanguages&&g.deletedLanguages.length>0&&V(G=>G.map(I=>{var W;if(I.id===o.id){const L=(((W=I.optimizationSummary)==null?void 0:W.optimizedLanguages)||[]).filter(ae=>!g.deletedLanguages.includes(ae));return{...I,optimizationSummary:{...I.optimizationSummary,optimizedLanguages:L,optimized:L.length>0,lastOptimized:L.length>0?I.optimizationSummary.lastOptimized:null}}}return I})),i++,g.deletedLanguages&&g.deletedLanguages.length>0&&await A("/api/products/verify-after-delete",{method:"POST",shop:d,body:{shop:d,productIds:[b],deletedLanguages:g.deletedLanguages}})}catch(b){ce(T=>[...T,{product:o.title,error:b.message}])}const c=p+1,r=Math.round(c/n*100);N({current:c,total:n,percent:r})}te([]),ie(!1),m>0?C(`Deleted Optimization for AI Search from ${i} products (${m} had no optimisation to delete)`):C(`Deleted Optimization for AI Search from ${i} products`),setTimeout(()=>{const p=Date.now();Z(1,!1,p)},500)}catch(s){C(`Error: ${s.message}`)}finally{J(!1),re("")}},Wt=t=>{var s,n;try{const i=t,m=is(i.productId||i.id),p=((s=i.optimizationSummary)==null?void 0:s.optimizedLanguages)||[],o=(n=i.images)!=null&&n[0]?e.jsx(ht,{source:i.images[0].url||i.images[0].src||i.images[0],alt:i.title,size:"small"}):i.imageUrl?e.jsx(ht,{source:i.imageUrl,alt:i.title,size:"small"}):e.jsx(u,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(rs,{id:i.id,media:o,accessibilityLabel:`View details for ${i.title}`,onClick:c=>{},children:e.jsxs(P,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(u,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:i.title}),e.jsxs(l,{variant:"bodySm",tone:"subdued",children:["ID: ",m]})]}),e.jsx(u,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(P,{gap:"100",children:z.length>0?z.map(c=>{const r=p.includes(c);return e.jsx(ee,{tone:r?"success":"subdued",size:"small",children:c.toUpperCase()},c)}):p.map(c=>e.jsx(ee,{tone:"success",size:"small",children:c.toUpperCase()},c))})}),e.jsx(u,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(ee,{tone:"success",children:"Active"})})]})})}catch(i){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",i),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},qt=$e&&e.jsx(E,{open:$e,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"400",children:[e.jsx(l,{variant:"bodyMd",children:Ze?`Processing: ${Ze}`:"Preparing..."}),e.jsx(ut,{progress:we.percent}),e.jsxs(l,{variant:"bodySm",tone:"subdued",children:[we.current," of ",we.total," products (",we.percent,"%)"]})]})})}),Nt=e.jsx(E,{open:Ct,title:"Select Languages",onClose:()=>{ue(!1),ne([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Dt,disabled:U.length===0||it},secondaryActions:[{content:"Cancel",onAction:()=>{ue(!1),ne([])}}],children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsxs(l,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",S?"all":h.length," selected products:"]}),it&&e.jsx(_e,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(R,{gap:"200",children:[e.jsxs(l,{variant:"bodyMd",children:["Your ",Y," plan supports up to ",F," language",F>1?"s":""," per product.",h.length===1&&((dt=(ct=(lt=w.find(t=>t.id===h[0]))==null?void 0:lt.optimizationSummary)==null?void 0:ct.optimizedLanguages)==null?void 0:dt.length)>0&&e.jsxs(e.Fragment,{children:[" This product already has ",w.find(t=>t.id===h[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(l,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(k,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),s=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${s}`},children:"Upgrade Plan"})]})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(P,{gap:"200",wrap:!0,children:z.map(t=>e.jsx(Ie,{label:t.toUpperCase(),checked:U.includes(t),onChange:s=>{ne(s?[...U,t]:U.filter(n=>n!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{U.length===z.length?ne([]):z.length>F?(ne([...z]),C(`You selected ${z.length} languages. Your ${Y} plan supports ${F}. Please deselect or upgrade.`)):ne([...z])},children:U.length===z.length?"Deselect all":"Select all"})}),e.jsx(l,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Gt=e.jsx(E,{open:At&&!$e,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:Ut,disabled:!Object.values(de).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>De(!1)}],children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsxs(P,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(de).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(de).filter(t=>t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(de).filter(t=>!t.success).length})]})]}),be.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Zt,{}),e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(u,{maxHeight:"200px",overflowY:"scroll",children:[be.slice(0,10).map((t,s)=>e.jsxs(l,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),be.length>10&&e.jsxs(l,{variant:"bodySm",tone:"subdued",children:["... and ",be.length-10," more errors"]})]})]})]})})}),_t=e.jsx(E,{open:vt,title:"Delete Optimization for AI Search",onClose:()=>{pe(!1),he([])},primaryAction:{content:"Continue",onAction:()=>{pe(!1),Pe(!0)},disabled:_.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{pe(!1),he([])}}],children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsxs(l,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",S?"all":h.length," selected products:"]}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(P,{gap:"200",wrap:!0,children:z.map(t=>e.jsx(Ie,{label:t.toUpperCase(),checked:_.includes(t),onChange:s=>{he(s?[..._,t]:_.filter(n=>n!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{he(_.length===z.length?[]:[...z])},children:_.length===z.length?"Deselect all":"Select all"})}),e.jsx(l,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Ht=e.jsx(E,{open:It,title:"Confirm Deletion",onClose:()=>{Pe(!1)},primaryAction:{content:"Delete",onAction:Bt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>Pe(!1)}],children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsx(l,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(u,{paddingBlock:"200",children:e.jsx(P,{gap:"100",children:_.map(t=>e.jsx(ee,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(l,{variant:"bodyMd",children:["This will delete optimisation from ",S?"ALL":h.length," selected products."]}),e.jsx(l,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),qe=async()=>{try{xe(!0),C("Syncing products from Shopify...");const t=await A("/api/products/sync",{method:"POST",shop:d});if(t.success){const s=t.productsCount||t.synced||0;C(`✅ Synced ${s} products successfully!`),setTimeout(()=>{Z(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),C(`❌ Sync failed: ${t.message}`)}finally{xe(!1)}},Ft=e.jsx(as,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Ke(""),Se("all"),le(""),ye([]),Z(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:qe},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Qt,{globalPlan:x}),e.jsx(pt,{children:e.jsxs(u,{padding:"400",children:[e.jsxs(R,{gap:"300",children:[j&&e.jsx(_e,{tone:"info",children:e.jsxs(P,{gap:"200",align:"space-between",children:[e.jsxs(l,{children:["Your ",e.jsx("strong",{children:j})," plan includes up to"," ",e.jsx("strong",{children:M(j)})," products for SEO optimization.",$>M(j)&&e.jsxs(e.Fragment,{children:[" You have ",$," products, so only the first ",M(j)," will be processed."]})]}),(h.length>0||S)&&e.jsxs(l,{children:["Selected: ",S?Math.min($,M(j)):h.length,"/",M(j)]})]})}),j&&(h.length>M(j)||S&&$>M(j))&&e.jsx(_e,{tone:"critical",children:e.jsxs(R,{gap:"200",children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),e.jsxs(l,{children:["Your ",e.jsx("strong",{children:j})," plan supports up to ",e.jsx("strong",{children:M(j)})," products. You have selected ",e.jsx("strong",{children:S?$:h.length})," products."]}),e.jsx(l,{children:"Please deselect some products or upgrade your plan to continue."}),e.jsxs(P,{gap:"200",children:[e.jsx(k,{onClick:()=>{te([]),ie(!1)},children:"Clear Selection"}),e.jsx(k,{variant:"primary",onClick:()=>{H({error:"Product limit exceeded",message:`Your ${j} plan supports up to ${M(j)} products. Upgrade to ${ze(S?$:h.length)} to optimize more products.`,minimumPlanRequired:ze(S?$:h.length)}),K(!0)},children:"Upgrade Plan"})]})]})}),e.jsxs(P,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(u,{minWidth:"400px",children:e.jsx(es,{label:"",placeholder:"Search by product ID, name, or details...",value:Q,onChange:at,prefix:e.jsx(ts,{}),clearButton:!0,onClearButtonClick:()=>at("")})}),e.jsx(u,{width:"320px",children:e.jsx(k,{primary:!0,onClick:Mt,disabled:h.length===0&&!S,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(P,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(k,{onClick:qe,disabled:oe,size:"medium",children:"Sync Products"}),e.jsx(u,{width:"320px",children:e.jsxs(R,{gap:"200",align:"end",children:[(()=>{if(h.length===0&&!S||!w.filter(i=>h.includes(i.id)).some(i=>{var m,p;return((p=(m=i.optimizationSummary)==null?void 0:m.optimizedLanguages)==null?void 0:p.length)>0}))return null;const n=["professional","growth","growth_extra","growth extra","enterprise"].includes(Y.toLowerCase().replace(/_/g," "));return e.jsx(k,{onClick:n?Rt:()=>{H({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),K(!0)},disabled:h.length===0&&!S,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(k,{onClick:Tt,disabled:h.length===0&&!S||!w.filter(n=>h.includes(n.id)).some(n=>{var i,m;return((m=(i=n.optimizationSummary)==null?void 0:i.optimizedLanguages)==null?void 0:m.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),$>0&&e.jsx(u,{paddingBlockStart:"300",children:e.jsx(Ie,{label:`Select all ${$} products in your store`,checked:S,onChange:ot})})]})}),e.jsx(u,{paddingBlockStart:"400",children:e.jsxs(pt,{children:[e.jsxs(u,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(P,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(P,{gap:"200",wrap:!0,children:[e.jsx(Le,{active:Ye,activator:e.jsx(k,{disclosure:"down",onClick:()=>ke(!Ye),removeUnderline:!0,children:e.jsxs(P,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),B!=="all"&&e.jsx(u,{onClick:t=>{t.stopPropagation(),Se("all")},children:e.jsx(l,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ke(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(Ee,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[B],onChange:t=>{Se(t[0]),le(""),ke(!1)}})})}),e.jsx(Le,{active:Ve,activator:e.jsx(k,{disclosure:"down",onClick:()=>Me(!Ve),removeUnderline:!0,children:e.jsxs(P,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),D&&e.jsx(u,{onClick:t=>{t.stopPropagation(),le("")},children:e.jsx(l,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Me(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(Ee,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...z.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...z.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:D?[D]:[],onChange:t=>{le(t[0]||""),Me(!1)}})})}),e.jsx(Le,{active:Qe,activator:e.jsx(k,{disclosure:"down",onClick:()=>Te(!Qe),removeUnderline:!0,children:e.jsxs(P,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),q.length>0&&e.jsx(u,{onClick:t=>{t.stopPropagation(),ye([])},children:e.jsx(l,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Te(!1),children:e.jsxs(u,{padding:"300",minWidth:"200px",children:[e.jsx(Ee,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:St.map(t=>({label:t,value:t})),selected:q,onChange:t=>{ye(t)}}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(k,{size:"slim",onClick:()=>Te(!1),children:"Apply"})})]})})]}),e.jsx(Le,{active:Je,activator:e.jsx(k,{disclosure:"down",onClick:()=>Re(!Je),removeUnderline:!0,children:e.jsx(P,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:se==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Re(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(Ee,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[se],onChange:t=>{xt(t[0]),Re(!1)}})})})]}),(B!=="all"||D||q.length>0)&&e.jsx(u,{paddingBlockStart:"200",children:e.jsxs(P,{gap:"100",wrap:!0,children:[B!=="all"&&e.jsx(ee,{onRemove:()=>Se("all"),children:B==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),D&&e.jsx(ee,{onRemove:()=>le(""),children:D.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),q.map(t=>e.jsxs(ee,{onRemove:()=>ye(s=>s.filter(n=>n!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(u,{children:[e.jsx(u,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(P,{gap:"200",align:"start",children:[e.jsx(Ie,{checked:h.length===w.length&&w.length>0,onChange:ot,label:""}),e.jsxs(l,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",h.length>0&&` (${h.length} selected products)`]})]})}),e.jsx(ss,{resourceName:{singular:"product",plural:"products"},items:w,renderItem:Wt,selectedItems:h,onSelectionChange:kt,selectable:!0,loading:oe,totalItemsCount:$,emptyState:Ft,showHeader:!1},`products-${w.length}-${h.length}`)]}),ft&&!oe&&e.jsx(u,{padding:"400",textAlign:"center",children:e.jsx(k,{onClick:()=>Z(mt+1,!0,null),children:"Load more"})})]})}),qt,Nt,Gt,_t,Ht,$t(),e.jsx(E,{open:Et,onClose:()=>Ae(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Ae(!1),qe()}},secondaryActions:[{content:"Skip for now",onAction:()=>Ae(!1)}],children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsx(l,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(l,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Jt,{open:Be,onClose:()=>{K(!1),H(null)},featureName:(y==null?void 0:y.error)||"Feature",errorMessage:y==null?void 0:y.message,currentPlan:(y==null?void 0:y.currentPlan)||Y,minimumPlanRequired:y==null?void 0:y.minimumPlanRequired,features:y==null?void 0:y.features}),y&&e.jsx(Xt,{open:Ot,onClose:()=>{rt(!1),H(null)},tokensRequired:y.tokensRequired||0,tokensAvailable:y.tokensAvailable||0,tokensNeeded:y.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:d,needsUpgrade:y.needsUpgrade||!1,minimumPlan:y.minimumPlanForFeature||null,currentPlan:y.currentPlan||Y}),tt&&e.jsx(ns,{content:tt,onDismiss:()=>C("")})]})}export{gs as default};
