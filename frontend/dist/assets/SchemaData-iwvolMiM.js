import{r as e,j as a}from"./react-vendor-BXVC7v0l.js";import{m as n}from"./sessionFetch-C15_aTvp.js";import"./usePlanHierarchy-fXt-6sDq.js";import{T as s,I as t,a as i}from"./TokenPurchaseModal-DtlNlPTu.js";import{U as o}from"./UpgradeModal-Cnm_AVJ5.js";import{e as r}from"./tokenEstimates-Dgf19ZiR.js";import{C as c,B as d,a as l,i as h,T as u,d as p,t as m,I as g,f as S,D as j,b as v,u as f,g as y,v as x,l as _,M as b}from"./polaris-5g7ljj7S.js";import"./app-bridge-DUY42B6P.js";import"./vendor-Cs_VgJ2r.js";import"./index-DzhQu9Mc.js";const O=(e,a="")=>{try{return new URLSearchParams(window.location.search).get(e)||a}catch{return a}},w=e=>(e||"starter").toLowerCase().replace(/\s+/g,"_");function A({shop:A}){const P=A||O("shop","");O("shop","");const[k,I]=e.useState(0),[E,C]=e.useState(!0),[T,D]=e.useState({organization:null,website:null,products:[]}),[N,q]=e.useState(""),R=e.useMemo(()=>n(),[]),[L,M]=e.useState(""),[$,U]=e.useState(null),[B,z]=e.useState(null),[F,Y]=e.useState(null),[G,Z]=e.useState(0),[J,W]=e.useState({inProgress:!1,status:"idle",message:null,position:null,estimatedTime:null,generatedAt:null,schemaCount:0}),[V,Q]=e.useState(null),[X,H]=e.useState(!1),[K,ee]=e.useState(!1),[ae,ne]=e.useState({}),[se,te]=e.useState(!1),[ie,oe]=e.useState(!1),[re,ce]=e.useState(!1),[de,le]=e.useState(null),[he,ue]=e.useState(!1),[pe,me]=e.useState(null),[ge,Se]=e.useState({material:!1,color:!1,size:!1,weight:!1,dimensions:!1,category:!1,audience:!1,reviews:!1,ratings:!0,enhancedDescription:!1,organization:!1}),[je,ve]=e.useState(!1);e.useEffect(()=>{P&&(be(),fe(),ye())},[P,R]),e.useEffect(()=>()=>{V&&clearInterval(V)},[V]);const fe=async()=>{var e;try{const n=await R(`/api/ai-discovery/settings?shop=${P}`);U(null==n?void 0:n.plan),z(w(null==n?void 0:n.plan)),Z((null==n?void 0:n.productCount)||0),(null==n?void 0:n.richAttributes)&&Se(e=>({...e,...n.richAttributes}));try{const a="\n          query PlansMe($shop:String!) {\n            plansMe(shop:$shop) {\n              shop\n              plan\n              planKey\n              trialEndsAt\n              activatedAt\n            }\n          }\n        ",n=await R("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:a,variables:{shop:P}})});Y(null==(e=null==n?void 0:n.data)?void 0:e.plansMe)}catch(a){}}catch(n){}},ye=e.useCallback(async()=>{var e,a,n,s,t;try{const i=await R(`/api/schema/status?shop=${P}`);return W({inProgress:i.inProgress||!1,status:i.status||"idle",message:i.message||null,position:(null==(e=i.queue)?void 0:e.position)||null,estimatedTime:(null==(a=i.queue)?void 0:a.estimatedTime)||null,generatedAt:(null==(n=i.schema)?void 0:n.generatedAt)||null,schemaCount:(null==(s=i.schema)?void 0:s.schemaCount)||0}),"completed"!==i.status||i.inProgress||(V&&(clearInterval(V),Q(null)),J.inProgress&&q(`Advanced Schema Data generated! (${(null==(t=i.schema)?void 0:t.schemaCount)||0} schemas)`)),"failed"===i.status&&(V&&(clearInterval(V),Q(null)),"NO_OPTIMIZED_PRODUCTS"===i.message?(me("NO_OPTIMIZED_PRODUCTS"),ue(!0)):"ONLY_BASIC_SEO"===i.message&&(me("ONLY_BASIC_SEO"),ue(!0))),i}catch(i){}},[P,R,V,J.inProgress]),xe=e.useCallback(()=>{V&&clearInterval(V),ye();const e=setInterval(()=>{ye()},1e4);Q(e)},[ye,V]),_e=async(e=!1)=>{H(!0);try{const n=w($),s=["professional_plus","growth_plus","starter_plus"],t=["growth_extra","enterprise"].includes(n),i=s.includes(n),o=r("ai-schema-advanced",{productCount:G||0}).withMargin;if(!t&&!i)return ne({feature:"Advanced Schema Data",currentPlan:$,requiredPlan:"Professional Plus, Growth Plus, Growth Extra, or Enterprise",tokensRequired:o}),ee(!0),void H(!1);if(i)try{const e=await R(`/api/billing/tokens/balance?shop=${P}`),a=(null==e?void 0:e.balance)||0;if(a<o)return le({feature:"ai-schema-advanced",tokensRequired:o,tokensAvailable:a,tokensNeeded:o-a}),oe(!0),void H(!1)}catch(a){}const c=await R(`/api/schema/generate-all?shop=${P}`,{method:"POST",body:{shop:P,forceBasicSeo:e}});c.queued?(q("Advanced Schema generation started..."),xe()):c.error&&("NO_OPTIMIZED_PRODUCTS"===c.error?(me("NO_OPTIMIZED_PRODUCTS"),ue(!0)):"ONLY_BASIC_SEO"===c.error?(me("ONLY_BASIC_SEO"),ue(!0)):q(`Error: ${c.error}`))}catch(n){402===n.status?n.trialRestriction&&n.requiresActivation?(le(n),te(!0)):n.requiresPurchase?(le(n),oe(!0)):q(n.message||"Payment required"):403===n.status?(ne({feature:"Advanced Schema Data",currentPlan:$,requiredPlan:"Professional Plus, Growth Plus, Growth Extra, or Enterprise"}),ee(!0)):400===n.status?"NO_OPTIMIZED_PRODUCTS"===n.error?(me("NO_OPTIMIZED_PRODUCTS"),ue(!0)):"ONLY_BASIC_SEO"===n.error?(me("ONLY_BASIC_SEO"),ue(!0)):q(n.message||"Error generating schema"):q(`Error: ${n.message}`)}finally{H(!1)}},be=async()=>{C(!0);try{const e=`/api/schema/preview?shop=${encodeURIComponent(P)}`,a=await R(e,{headers:{"X-Shop":P}});a.ok?(D(a.schemas),Oe(a.schemas)):q(`Error: ${a.error}`)}catch(e){q(`Failed to load schemas: ${e.message}`)}finally{C(!1)}},Oe=e=>{const a=[];e.organization&&a.push(e.organization),e.website&&a.push(e.website);const n=`<script type="application/ld+json">\n${JSON.stringify(a,null,2)}\n<\/script>`;M(n)};return E?a.jsx(c,{children:a.jsx(d,{padding:"400",children:a.jsxs(l,{gap:"400",align:"center",children:[a.jsx(h,{}),a.jsx(u,{children:"Loading schema data..."})]})})}):a.jsxs(a.Fragment,{children:[a.jsx(c,{children:a.jsx(d,{padding:"400",children:a.jsxs(l,{gap:"400",children:[a.jsx(u,{as:"h3",variant:"headingMd",children:"Schema.org Structured Data"}),a.jsx(p,{tone:"info",children:a.jsx(u,{children:"Schema.org structured data helps AI models understand your store content better, improving your visibility and search results."})}),a.jsxs(m,{tabs:[{id:"overview",content:"Overview",accessibilityLabel:"Overview"},{id:"installation",content:"Installation",accessibilityLabel:"Installation"}],selected:k,onSelect:I,children:[0===k&&a.jsx(d,{paddingBlockStart:"400",children:a.jsxs(l,{gap:"400",children:[a.jsx(c,{children:a.jsx(d,{padding:"300",children:a.jsxs(l,{gap:"300",children:[a.jsxs(g,{align:"space-between",children:[a.jsx(u,{as:"h4",variant:"headingSm",children:"Organization Schema"}),a.jsx(S,{tone:T.organization?"success":"warning",children:T.organization?"Active":"Not configured"})]}),!T.organization&&a.jsx(u,{as:"p",tone:"subdued",children:"Configure organization details in Store Metadata to enable this schema."})]})})}),a.jsx(c,{children:a.jsx(d,{padding:"300",children:a.jsxs(l,{gap:"300",children:[a.jsxs(g,{align:"space-between",children:[a.jsx(u,{as:"h4",variant:"headingSm",children:"WebSite Schema"}),a.jsx(S,{tone:T.website?"success":"warning",children:T.website?"Active":"Not configured"})]}),!T.website&&a.jsx(u,{as:"p",tone:"subdued",children:"Website schema is automatically generated from your store information."})]})})}),a.jsx(c,{children:a.jsx(d,{padding:"300",children:a.jsxs(l,{gap:"300",children:[a.jsxs(g,{align:"space-between",children:[a.jsx(u,{as:"h4",variant:"headingSm",children:"Product Schemas"}),a.jsx(S,{tone:"success",children:"Auto-generated"})]}),a.jsxs(u,{tone:"subdued",children:["Product schemas are automatically generated from your AI Optimisation data when pages load.",T.products.length>0&&` ${T.products.length} products have SEO data.`]})]})})}),a.jsx(j,{}),a.jsx(c,{children:a.jsx(d,{padding:"400",children:a.jsxs(l,{gap:"400",children:[a.jsx(u,{as:"h2",variant:"headingMd",children:"Advanced Schema Data Management"}),a.jsx(u,{variant:"bodyMd",tone:"subdued",children:"Generate and manage structured data for your products"}),a.jsxs(g,{gap:"300",children:[a.jsx(v,{onClick:async()=>{var e,a,n,s;try{const e=await R(`/ai/schema-data.json?shop=${P}`);if(e.schemas&&e.schemas.length>0&&!confirm("This will replace existing schema data. Continue?"))return;await R(`/api/schema/generate-all?shop=${P}`,{method:"POST",body:{shop:P}});q("Advanced Schema Data generation started in background. You can navigate away - it will continue processing."),xe()}catch(t){if(402===t.status)return le(t),void(t.trialRestriction&&t.requiresActivation?te(!0):t.requiresPurchase?oe(!0):q("Advanced Schema Data requires activation or token purchase."));if((null==(e=t.message)?void 0:e.includes("NO_OPTIMIZED_PRODUCTS"))||(null==(a=t.error)?void 0:a.includes("NO_OPTIMIZED_PRODUCTS")))return me("NO_OPTIMIZED_PRODUCTS"),void ue(!0);if((null==(n=t.message)?void 0:n.includes("ONLY_BASIC_SEO"))||(null==(s=t.error)?void 0:s.includes("ONLY_BASIC_SEO")))return me("ONLY_BASIC_SEO"),void ue(!0);q("Failed to generate schema: "+(t.message||"Unknown error"))}},children:"Generate/Update Schema Data"}),a.jsx(v,{onClick:()=>{window.open(`/ai/schema-data.json?shop=${P}`,"_blank")},children:"View Generated Schema"}),a.jsx(v,{tone:"critical",onClick:async()=>{if(confirm("This will delete all advanced schema data. Are you sure?"))try{await R(`/api/schema/delete?shop=${P}`,{method:"DELETE",body:{shop:P}}),q("Schema data deleted successfully")}catch(e){q("Failed to delete schema data")}},children:"Delete Schema Data"})]}),a.jsx(c,{children:a.jsx(d,{padding:"300",children:a.jsxs(l,{gap:"300",children:[a.jsxs(g,{align:"space-between",blockAlign:"center",children:[a.jsxs(l,{gap:"100",children:[a.jsx(u,{as:"h3",variant:"headingSm",children:"Rich Product Attributes"}),a.jsx(u,{variant:"bodyMd",tone:"subdued",children:"Select which AI-generated attributes to include in product schemas"})]}),a.jsx(v,{size:"slim",onClick:async()=>{ve(!0);try{const e=await R(`/api/ai-discovery/settings?shop=${P}`);await R(`/api/ai-discovery/settings?shop=${P}`,{method:"POST",body:{shop:P,bots:e.bots,features:e.features,richAttributes:ge}}),q("Rich attributes saved!")}catch(e){q("Failed to save attributes: "+(e.message||"Unknown error"))}finally{ve(!1)}},loading:je,children:"Save Attributes"})]}),a.jsx(f,{columns:2,gap:"400",children:[{key:"material",label:"Material",description:"Product material (cotton, leather, metal, etc.)"},{key:"color",label:"Color",description:"Product color information"},{key:"size",label:"Size",description:"Product size or dimensions"},{key:"weight",label:"Weight",description:"Product weight information"},{key:"dimensions",label:"Dimensions",description:"Product measurements"},{key:"category",label:"Category",description:"Product category classification"},{key:"audience",label:"Target Audience",description:"Intended user group (men, women, kids, etc.)"},{key:"reviews",label:"Review Schemas",description:"AI-generated product reviews for schema.org"},{key:"ratings",label:"Rating Schemas",description:"AI-generated ratings and aggregate ratings"},{key:"enhancedDescription",label:"Enhanced Descriptions",description:"AI-enhanced product descriptions"},{key:"organization",label:"Organization Schema",description:"Brand organization information"}].map(e=>a.jsx(y,{label:e.label,helpText:e.description,checked:ge[e.key]||!1,onChange:a=>{Se(n=>({...n,[e.key]:a}))}},e.key))})]})})}),a.jsx(p,{tone:"info",children:a.jsx("p",{children:"Generation creates BreadcrumbList, FAQPage, WebPage and more schemas for each product. These structured schemas help AI bots understand your product hierarchy, answer customer questions automatically, and improve your store's visibility in AI-powered search results."})})]})})}),a.jsxs(g,{gap:"300",children:[a.jsx(v,{onClick:async()=>{C(!0);try{const e=`/api/schema/generate?shop=${encodeURIComponent(P)}`,a=await R(e,{method:"POST",headers:{"X-Shop":P},body:{shop:P}});a.ok?(q("Schemas regenerated successfully!"),be()):q(`Error: ${a.error}`)}catch(e){q(`Failed to regenerate: ${e.message}`)}finally{C(!1)}},loading:E,children:"Regenerate Basic Schemas"}),a.jsx(v,{variant:"plain",url:"https://developers.google.com/search/docs/appearance/structured-data",children:"Learn about Schema.org"})]})]})}),1===k&&a.jsx(d,{paddingBlockStart:"400",children:a.jsxs(l,{gap:"400",children:[a.jsx(p,{tone:"info",children:a.jsxs(l,{gap:"300",children:[a.jsx(u,{as:"h4",variant:"headingSm",children:"Theme Installation"}),a.jsxs(x,{type:"number",children:[a.jsx(x.Item,{children:"Go to your Shopify Admin → Online Store → Themes"}),a.jsx(x.Item,{children:'Click "Actions" → "Edit code" on your current theme'}),a.jsxs(x.Item,{children:["Open the file: ",a.jsx("code",{children:"layout/theme.liquid"})]}),a.jsxs(x.Item,{children:["Add this code before the closing ",a.jsx("code",{children:"</head>"})," tag:"]})]})]})}),a.jsx(c,{children:a.jsx(d,{padding:"300",children:a.jsxs(l,{gap:"300",children:[a.jsx(u,{as:"h4",variant:"headingSm",children:"Code to Install"}),a.jsx(d,{background:"bg-surface-secondary",padding:"200",borderRadius:"200",children:a.jsx("pre",{style:{fontSize:"12px",overflow:"auto",whiteSpace:"pre-wrap"},children:'{%- comment -%} Advanced Schema Data - Auto-generated by indexAIze - Unlock AI Search {%- endcomment -%}\n\n{%- comment -%} Organization & WebSite Schema (site-wide) {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.shop_schemas -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.shop_schemas.value }}\n  <\/script>\n{%- endif -%}\n\n{%- comment -%} Product Schema (product pages only) {%- endcomment -%}\n{%- if product -%}\n  {%- comment -%} Try Advanced Schema first (requires tokens/Enterprise plan) {%- endcomment -%}\n  {%- assign schema_key = \'schemas_\' | append: request.locale.iso_code -%}\n  {%- assign schemas_json = product.metafields.advanced_schema[schema_key].value -%}\n  {%- if schemas_json -%}\n    <script type="application/ld+json">\n{{ schemas_json }}\n    <\/script>\n  {%- else -%}\n    {%- comment -%} Fallback to basic SEO JSON-LD (available for all plans) {%- endcomment -%}\n    {%- assign seo_key = \'seo__\' | append: request.locale.iso_code -%}\n    {%- assign seo_data_json = product.metafields.seo_ai[seo_key].value | default: product.metafields.seo_ai.seo__en.value -%}\n    {%- if seo_data_json -%}\n      <script type="application/ld+json" id="seo-basic-jsonld-{{ product.id }}">\n      <\/script>\n      <script>\n        (function() {\n          try {\n            var seoData = JSON.parse({{ seo_data_json | json }});\n            if (seoData && seoData.jsonLd) {\n              var scriptTag = document.getElementById(\'seo-basic-jsonld-{{ product.id }}\');\n              if (scriptTag) {\n                scriptTag.textContent = JSON.stringify(seoData.jsonLd);\n              }\n            }\n          } catch(e) {\n            console.error(\'Failed to parse SEO JSON-LD:\', e);\n          }\n        })();\n      <\/script>\n    {%- endif -%}\n  {%- endif -%}\n{%- endif -%}\n\n{%- comment -%} Site-wide FAQ Schema {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.site_faq -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.site_faq.value }}\n  <\/script>\n{%- endif -%}'})}),a.jsx(g,{align:"end",children:a.jsx(v,{onClick:()=>{navigator.clipboard.writeText('{%- comment -%} Advanced Schema Data - Auto-generated by indexAIze - Unlock AI Search {%- endcomment -%}\n\n{%- comment -%} Organization & WebSite Schema (site-wide) {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.shop_schemas -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.shop_schemas.value }}\n  <\/script>\n{%- endif -%}\n\n{%- comment -%} Product Schema (product pages only) {%- endcomment -%}\n{%- if product -%}\n  {%- comment -%} Try Advanced Schema first (requires tokens/Enterprise plan) {%- endcomment -%}\n  {%- assign schema_key = \'schemas_\' | append: request.locale.iso_code -%}\n  {%- assign schemas_json = product.metafields.advanced_schema[schema_key].value -%}\n  {%- if schemas_json -%}\n    <script type="application/ld+json">\n{{ schemas_json }}\n    <\/script>\n  {%- else -%}\n    {%- comment -%} Fallback to basic SEO JSON-LD (available for all plans) {%- endcomment -%}\n    {%- assign seo_key = \'seo__\' | append: request.locale.iso_code -%}\n    {%- assign seo_data_json = product.metafields.seo_ai[seo_key].value | default: product.metafields.seo_ai.seo__en.value -%}\n    {%- if seo_data_json -%}\n      <script type="application/ld+json" id="seo-basic-jsonld-{{ product.id }}">\n      <\/script>\n      <script>\n        (function() {\n          try {\n            var seoData = JSON.parse({{ seo_data_json | json }});\n            if (seoData && seoData.jsonLd) {\n              var scriptTag = document.getElementById(\'seo-basic-jsonld-{{ product.id }}\');\n              if (scriptTag) {\n                scriptTag.textContent = JSON.stringify(seoData.jsonLd);\n              }\n            }\n          } catch(e) {\n            console.error(\'Failed to parse SEO JSON-LD:\', e);\n          }\n        })();\n      <\/script>\n    {%- endif -%}\n  {%- endif -%}\n{%- endif -%}\n\n{%- comment -%} Site-wide FAQ Schema {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.site_faq -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.site_faq.value }}\n  <\/script>\n{%- endif -%}'),q("Code copied to clipboard!")},children:"Copy Code"})}),a.jsx(p,{tone:"warning",children:a.jsx(u,{children:"Always backup your theme before making changes!"})})]})})}),a.jsx(c,{children:a.jsx(d,{padding:"300",children:a.jsxs(l,{gap:"300",children:[a.jsx(u,{as:"h4",variant:"headingSm",children:"Testing Your Installation"}),a.jsxs(x,{children:[a.jsx(x.Item,{children:"After installation, visit your store's homepage and product pages"}),a.jsx(x.Item,{children:"View the page source (right-click → View Source)"}),a.jsxs(x.Item,{children:["Search for ",a.jsx("code",{children:"application/ld+json"})," to find your schemas"]}),a.jsx(x.Item,{children:"Use the Validation tab to test with Google's tools"})]})]})})})]})})]})]})})}),N&&a.jsx(_,{content:N,onDismiss:()=>q("")}),a.jsx(o,{open:K,onClose:()=>ee(!1),feature:ae.feature,currentPlan:ae.currentPlan,requiredPlan:ae.requiredPlan,returnTo:"/ai-seo/schema-data"}),a.jsx(s,{open:se,onClose:()=>te(!1),onActivatePlan:async()=>{try{const e=await R(`/api/billing/activate?shop=${P}`,{method:"POST",body:{shop:P,endTrial:!0,returnTo:window.location.pathname}});e.confirmationUrl?window.top.location.href=e.confirmationUrl:e.success&&(te(!1),q("Plan activated! You can now generate Advanced Schema Data."),setTimeout(()=>_e(),1e3))}catch(e){q("Failed to activate plan")}},onPurchaseTokens:()=>{te(!1),ce(!0)},feature:"ai-schema-advanced",trialEndsAt:(null==F?void 0:F.trialEndsAt)||(null==de?void 0:de.trialEndsAt),currentPlan:$||(null==de?void 0:de.currentPlan)||"Enterprise",tokensRequired:(null==de?void 0:de.tokensRequired)||r("ai-schema-advanced",{productCount:G}).withMargin}),a.jsx(t,{open:ie,onClose:()=>oe(!1),onPurchase:()=>{oe(!1),ce(!0)},feature:"ai-schema-advanced",tokensRequired:(null==de?void 0:de.tokensRequired)||0,tokensAvailable:(null==de?void 0:de.tokensAvailable)||0,tokensNeeded:(null==de?void 0:de.tokensNeeded)||(null==de?void 0:de.tokensRequired)||0}),a.jsx(i,{open:re,onClose:()=>ce(!1),tokensNeeded:(null==de?void 0:de.tokensNeeded)||0,returnTo:"/ai-seo/schema-data"}),a.jsx(b,{open:he,onClose:()=>ue(!1),title:"NO_OPTIMIZED_PRODUCTS"===pe?"No Optimized Products":"Only Basic SEO Found",primaryAction:"ONLY_BASIC_SEO"===pe?{content:"Generate with Basic SEO",onAction:()=>{ue(!1),_e(!0)}}:{content:"Go to Products",onAction:()=>{ue(!1);const e=new URLSearchParams(window.location.search);window.location.href=`/ai-seo/bulk-edit?shop=${P}&host=${e.get("host")}&embedded=${e.get("embedded")}`}},secondaryActions:[{content:"Cancel",onAction:()=>ue(!1)}],children:a.jsx(b.Section,{children:"NO_OPTIMIZED_PRODUCTS"===pe?a.jsx(u,{children:"Advanced Schema Data requires products with AI Search Optimisation. Please run Basic or AI Enhanced SEO on your products first."}):a.jsxs(l,{gap:"200",children:[a.jsx(u,{children:"Your products only have Basic SEO optimisation. For best results, we recommend using AI Enhanced SEO which provides richer data for schemas."}),a.jsx(u,{tone:"subdued",children:"You can still generate Advanced Schemas using Basic SEO data, but the results may be less comprehensive."})]})})})]})}export{A as default};
