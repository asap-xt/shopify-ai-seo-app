import{j as e}from"./app-bridge-B8hjyqhR-1761112058380.js";import{r as u}from"./react-vendor-tAaa2TlE-1761112058380.js";import{m as ae}from"./sessionFetch-CJepNHo3-1761112058380.js";import{C as F,a as j,e as l,d as b,T as s,I as a,B as d,f as ie,g as h,D as w,j as re,l as oe,M as S}from"./polaris-BZ6i6_0M-1761112058380.js";const ce=(q,i="")=>{try{return new URLSearchParams(window.location.search).get(q)||i}catch{return i}};function me({shop:q}){var K,U,Y;const i=q||ce("shop",""),[D,A]=u.useState(""),R=u.useMemo(()=>ae(),[]),[J,H]=u.useState(null),[G,P]=u.useState(""),[Q,E]=u.useState(!1),[m,V]=u.useState(null),[M,X]=u.useState(""),[Z,$]=u.useState(!1),[_,z]=u.useState(!1),[p,W]=u.useState(null),[ee,B]=u.useState(!1),[g,le]=u.useState(null),[t,O]=u.useState({}),[v,L]=u.useState(!1),[se,N]=u.useState(0);u.useEffect(()=>{i&&te()},[i,R]);const te=async()=>{var r,o;try{const c=await R("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
        query PlansMe($shop:String!) {
          plansMe(shop:$shop) {
            shop
            plan
            planKey
          }
        }
      `,variables:{shop:i}})});console.log("[AI-TESTING] Plan data:",c),H((o=(r=c==null?void 0:c.data)==null?void 0:r.plansMe)==null?void 0:o.plan)}catch(n){console.error("[AI-TESTING] Error loading plan:",n)}},y=r=>{if(!J)return!1;const n=["Starter","Professional","Growth","Growth Extra","Enterprise"].indexOf(J);switch(r){case"productsJson":return n>=0;case"storeMetadata":return n>=1;case"welcomePage":case"collectionsJson":return n>=2;case"aiSitemap":return n>=3;case"schemaData":return n>=4;case"meta":return n>=0;case"claude":return n>=0;case"gemini":return n>=1;case"chatgpt":return n>=2;case"perplexity":return n>=3;case"deepseek":return n>=4;default:return!1}},f=r=>{switch(r){case"storeMetadata":return"Professional";case"welcomePage":case"collectionsJson":return"Growth";case"aiSitemap":return"Growth Extra";case"schemaData":return"Enterprise";case"gemini":return"Professional";case"chatgpt":return"Growth";case"perplexity":return"Growth Extra";case"deepseek":return"Enterprise";default:return"Professional"}},I=(r,o)=>{V({name:r,url:o}),E(!0)},ne=async()=>{L(!0),N(0),O({});const r=[{key:"productsJson",name:"Products JSON Feed",url:`https://${i}/apps/new-ai-seo/ai/products.json?shop=${i}`,requiredPlan:null},{key:"storeMetadata",name:"Store Metadata",url:`https://${i}/apps/new-ai-seo/ai/store-metadata.json?shop=${i}`,requiredPlan:"Professional"},{key:"welcomePage",name:"AI Welcome Page",url:`https://${i}/apps/new-ai-seo/ai/welcome?shop=${i}`,requiredPlan:"Growth"},{key:"collectionsJson",name:"Collections JSON Feed",url:`https://${i}/apps/new-ai-seo/ai/collections-feed.json?shop=${i}`,requiredPlan:"Growth"},{key:"aiSitemap",name:"AI-Enhanced Sitemap",url:`https://${i}/apps/new-ai-seo/ai/sitemap.xml?shop=${i}`,requiredPlan:"Growth Extra"},{key:"schemaData",name:"Advanced Schema Data",url:`https://${i}/apps/new-ai-seo/ai/schema-data.json?shop=${i}`,requiredPlan:"Enterprise"}],o={};for(let n=0;n<r.length;n++){const c=r[n];if(N((n+1)/r.length*100),!y(c.key)){o[c.key]={status:"locked",message:`Requires ${c.requiredPlan} plan`,name:c.name};continue}try{const x=await fetch(c.url);if(x.ok){const k=x.headers.get("content-type");let C=null;k&&k.includes("application/json")?C=await x.json():k&&k.includes("text/html")?C=await x.text():k&&k.includes("xml")&&(C=await x.text()),o[c.key]={status:"success",message:"Endpoint is working correctly",name:c.name,dataSize:JSON.stringify(C).length}}else x.status===403||x.status===402?o[c.key]={status:"locked",message:`Requires ${c.requiredPlan} plan`,name:c.name}:o[c.key]={status:"error",message:`HTTP ${x.status}: ${x.statusText}`,name:c.name}}catch(x){o[c.key]={status:"error",message:x.message||"Failed to fetch endpoint",name:c.name}}await new Promise(x=>setTimeout(x,200))}O(o),L(!1),A("Testing completed!")},T=async(r,o=null)=>{try{P("Generating AI response...");let n=`/api/ai-discovery/simulate?shop=${i}&type=${r}`;o&&(n+=`&question=${encodeURIComponent(o)}`);const c=await R(n,{method:"GET"});P(c.response||"No response generated")}catch(n){if(console.error("[AI-TESTING] Simulation error:",n),console.log("[AI-TESTING] Error status:",n.status),console.log("[AI-TESTING] Error requiresUpgrade:",n.requiresUpgrade),console.log("[AI-TESTING] Error requiresPurchase:",n.requiresPurchase),n.status===402){if(n.requiresUpgrade){W(n),$(!0),P("");return}if(n.requiresPurchase){W(n),z(!0),P("");return}}P("Error generating response. Please try again."),A("Failed to simulate AI response")}};return e.jsxs(e.Fragment,{children:[e.jsx(F,{children:e.jsx(j,{padding:"400",children:e.jsxs(l,{gap:"400",children:[e.jsx(b,{tone:"info",children:e.jsx(s,{children:"Test how AI models discover and understand your store content. Check if your structured data and AI Discovery features are working correctly."})}),e.jsx(F,{children:e.jsx(j,{padding:"300",children:e.jsxs(l,{gap:"400",children:[e.jsxs(a,{align:"space-between",blockAlign:"center",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"AI Discovery Endpoints"}),e.jsx(d,{onClick:ne,loading:v,disabled:v,children:v?"Testing...":"Run All Tests"})]}),e.jsx(s,{variant:"bodyMd",tone:"subdued",children:"Automated tests to verify that your AI Discovery endpoints are working correctly."}),v&&e.jsx(j,{children:e.jsxs(l,{gap:"200",children:[e.jsx(s,{variant:"bodySm",children:"Testing endpoints..."}),e.jsx(ie,{progress:se,size:"small"})]})}),Object.keys(t).length>0&&e.jsxs(l,{gap:"300",children:[t.productsJson&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(l,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Products JSON Feed"}),t.productsJson.status==="success"&&e.jsx(h,{tone:"success",children:"âœ“ OK"}),t.productsJson.status==="error"&&e.jsx(h,{tone:"critical",children:"âœ— Failed"}),t.productsJson.status==="locked"&&e.jsx(h,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[t.productsJson.message,t.productsJson.dataSize&&` (${(t.productsJson.dataSize/1024).toFixed(1)} KB)`]})]})}),e.jsx(w,{})]}),t.storeMetadata&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(l,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Store Metadata"}),t.storeMetadata.status==="success"&&e.jsx(h,{tone:"success",children:"âœ“ OK"}),t.storeMetadata.status==="error"&&e.jsx(h,{tone:"critical",children:"âœ— Failed"}),t.storeMetadata.status==="locked"&&e.jsx(h,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[t.storeMetadata.message,t.storeMetadata.dataSize&&` (${(t.storeMetadata.dataSize/1024).toFixed(1)} KB)`]})]})}),e.jsx(w,{})]}),t.welcomePage&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(l,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"AI Welcome Page"}),t.welcomePage.status==="success"&&e.jsx(h,{tone:"success",children:"âœ“ OK"}),t.welcomePage.status==="error"&&e.jsx(h,{tone:"critical",children:"âœ— Failed"}),t.welcomePage.status==="locked"&&e.jsx(h,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[t.welcomePage.message,t.welcomePage.dataSize&&` (${(t.welcomePage.dataSize/1024).toFixed(1)} KB)`]})]})}),e.jsx(w,{})]}),t.collectionsJson&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(l,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Collections JSON Feed"}),t.collectionsJson.status==="success"&&e.jsx(h,{tone:"success",children:"âœ“ OK"}),t.collectionsJson.status==="error"&&e.jsx(h,{tone:"critical",children:"âœ— Failed"}),t.collectionsJson.status==="locked"&&e.jsx(h,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[t.collectionsJson.message,t.collectionsJson.dataSize&&` (${(t.collectionsJson.dataSize/1024).toFixed(1)} KB)`]})]})}),e.jsx(w,{})]}),t.aiSitemap&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(l,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"AI-Enhanced Sitemap"}),t.aiSitemap.status==="success"&&e.jsx(h,{tone:"success",children:"âœ“ OK"}),t.aiSitemap.status==="error"&&e.jsx(h,{tone:"critical",children:"âœ— Failed"}),t.aiSitemap.status==="locked"&&e.jsx(h,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[t.aiSitemap.message,t.aiSitemap.dataSize&&` (${(t.aiSitemap.dataSize/1024).toFixed(1)} KB)`]})]})}),e.jsx(w,{})]}),t.schemaData&&e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(l,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Advanced Schema Data"}),t.schemaData.status==="success"&&e.jsx(h,{tone:"success",children:"âœ“ OK"}),t.schemaData.status==="error"&&e.jsx(h,{tone:"critical",children:"âœ— Failed"}),t.schemaData.status==="locked"&&e.jsx(h,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[t.schemaData.message,t.schemaData.dataSize&&` (${(t.schemaData.dataSize/1024).toFixed(1)} KB)`]})]})})]}),Object.keys(t).length===0&&!v&&e.jsx(b,{tone:"info",children:e.jsx(s,{children:'Click "Run All Tests" to check if your AI Discovery endpoints are configured correctly.'})}),e.jsx(w,{}),e.jsxs(l,{gap:"200",children:[e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Meta AI Search"}),y("meta")?e.jsx(d,{onClick:()=>I("Meta AI","https://www.meta.ai/"),size:"slim",children:"Test"}):e.jsxs(d,{disabled:!0,size:"slim",children:[f("meta"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Claude AI Search"}),y("claude")?e.jsx(d,{onClick:()=>I("Claude AI","https://claude.ai/"),size:"slim",children:"Test"}):e.jsxs(d,{disabled:!0,size:"slim",children:[f("claude"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Gemini AI Search"}),y("gemini")?e.jsx(d,{onClick:()=>I("Gemini AI","https://gemini.google.com/"),size:"slim",children:"Test"}):e.jsxs(d,{disabled:!0,size:"slim",children:[f("gemini"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"ChatGPT Web Search"}),y("chatgpt")?e.jsx(d,{url:`https://chat.openai.com/?q=What+products+does+${i}+sell%3F+Tell+me+about+this+business+and+what+they+offer`,external:!0,size:"slim",children:"Test"}):e.jsxs(d,{disabled:!0,size:"slim",children:[f("chatgpt"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Perplexity AI Search"}),y("perplexity")?e.jsx(d,{url:`https://www.perplexity.ai/search?q=What+products+does+${i}+sell%3F+Tell+me+about+this+business+and+what+they+offer`,external:!0,size:"slim",children:"Test"}):e.jsxs(d,{disabled:!0,size:"slim",children:[f("perplexity"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"DeepSeek AI Search"}),y("deepseek")?e.jsx(d,{onClick:()=>I("DeepSeek AI","https://chat.deepseek.com/"),size:"slim",children:"Test"}):e.jsxs(d,{disabled:!0,size:"slim",children:[f("deepseek"),"+ Required"]})]})]}),e.jsx(b,{tone:"info",children:e.jsxs(s,{children:[e.jsx("strong",{children:"How to test with AI bots:"}),e.jsx("br",{}),"â€¢ ",e.jsx("strong",{children:"Perplexity & ChatGPT:"}),' Click "Test" - they support URL parameters',e.jsx("br",{}),"â€¢ ",e.jsx("strong",{children:"Meta AI, Claude, Gemini, DeepSeek:"}),' Click "Test" to open a modal with the prompt to copy']})})]})})}),e.jsx(F,{children:e.jsx(j,{padding:"300",children:e.jsxs(l,{gap:"300",children:[e.jsx(s,{as:"h4",variant:"headingSm",children:"AI Search Simulation"}),e.jsx(s,{variant:"bodyMd",tone:"subdued",children:"Test how AI bots would respond to questions about your store based on your structured data."}),e.jsx(b,{tone:"info",children:e.jsxs(l,{gap:"100",children:[e.jsx(s,{variant:"bodySm",fontWeight:"semibold",children:"Simulation Details:"}),e.jsxs(s,{variant:"bodySm",children:["â€¢ ",e.jsx("strong",{children:"Data Source:"})," Your store's products, collections, and metadata"]}),e.jsxs(s,{variant:"bodySm",children:["â€¢ ",e.jsx("strong",{children:"Response Style:"})," Concise (2-3 sentences), natural language"]}),e.jsxs(s,{variant:"bodySm",children:["â€¢ ",e.jsx("strong",{children:"Best For:"})," General store info, products, categories, contact details"]}),e.jsxs(s,{variant:"bodySm",children:["â€¢ ",e.jsx("strong",{children:"Limitations:"})," May not have real-time data (current stock, active promotions, exact shipping times)"]})]})}),e.jsxs(l,{gap:"200",children:[e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"What products does this store sell?"}),e.jsx(d,{onClick:()=>T("products"),size:"slim",children:"Simulate Response"})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Tell me about this business"}),e.jsx(d,{onClick:()=>T("business"),size:"slim",children:"Simulate Response"})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"What categories does this store have?"}),e.jsx(d,{onClick:()=>T("categories"),size:"slim",children:"Simulate Response"})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"What is this store's contact information?"}),e.jsx(d,{onClick:()=>T("contact"),size:"slim",children:"Simulate Response"})]})]}),e.jsx(w,{}),e.jsxs(l,{gap:"200",children:[e.jsx(s,{variant:"headingSm",children:"Ask Your Own Question"}),e.jsx(re,{label:"",value:M,onChange:X,placeholder:"e.g., What are your return policies? Do you ship internationally?",autoComplete:"off",connectedRight:e.jsx(d,{onClick:()=>{M.trim()?T("custom",M):A("Please enter a question")},disabled:!M.trim(),children:"Ask AI"})})]}),G&&e.jsxs(j,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"AI Bot Response:"}),e.jsx(j,{paddingBlockStart:"200",children:e.jsx(s,{variant:"bodyMd",children:G})})]})]})})})]})})}),D&&e.jsx(oe,{content:D,onDismiss:()=>A("")}),e.jsx(S,{open:Q,onClose:()=>E(!1),title:`Test with ${m==null?void 0:m.name}`,primaryAction:{content:"Open AI Bot",url:m==null?void 0:m.url,external:!0},secondaryActions:[{content:"Copy Prompt",onAction:()=>{navigator.clipboard.writeText(`What products does ${i} sell? Tell me about this business and what they offer.`),A("Prompt copied to clipboard!")}}],children:e.jsx(S.Section,{children:e.jsxs(l,{gap:"300",children:[e.jsx(s,{variant:"bodyMd",children:'1. Click "Copy Prompt" (left button)'}),e.jsxs(s,{variant:"bodyMd",children:['2. Click "Open AI Bot" (right button) to visit ',m==null?void 0:m.name]}),e.jsx(s,{variant:"bodyMd",children:"3. Paste the prompt and send"}),e.jsxs(j,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Prompt to test:"}),e.jsx(j,{paddingBlockStart:"200",children:e.jsxs(s,{variant:"bodyMd",as:"p",children:["What products does ",i," sell? Tell me about this business and what they offer."]})})]}),e.jsx(b,{tone:"info",children:e.jsx(s,{children:"The AI bot will search the web and use your store's structured data to answer."})})]})})}),e.jsx(S,{open:ee,onClose:()=>B(!1),title:"Upgrade Required",primaryAction:{content:"View Plans",onAction:()=>{const r=new URLSearchParams(window.location.search),o=r.toString()?`?${r.toString()}`:"";window.location.href=`/billing${o}`}},secondaryActions:[{content:"Cancel",onAction:()=>B(!1)}],children:e.jsx(S.Section,{children:e.jsxs(l,{gap:"300",children:[e.jsxs(s,{variant:"bodyMd",children:[e.jsx("strong",{children:g==null?void 0:g.endpoint})," requires ",e.jsx("strong",{children:g==null?void 0:g.requiredPlan})," plan or higher."]}),e.jsxs(s,{variant:"bodyMd",tone:"subdued",children:["Your current plan: ",e.jsx("strong",{children:g==null?void 0:g.currentPlan})]}),e.jsx(b,{tone:"info",children:e.jsx(s,{children:"Upgrade to access this advanced AI Discovery feature."})})]})})}),e.jsx(S,{open:Z,onClose:()=>$(!1),title:"Upgrade Required",primaryAction:{content:"View Plans",onAction:()=>{const r=new URLSearchParams(window.location.search),o=r.toString()?`?${r.toString()}`:"";window.location.href=`/billing${o}`}},secondaryActions:[{content:"Cancel",onAction:()=>$(!1)}],children:e.jsx(S.Section,{children:e.jsxs(l,{gap:"300",children:[e.jsxs(s,{variant:"bodyMd",children:["AI Testing requires ",e.jsx("strong",{children:(p==null?void 0:p.minimumPlan)||"Professional"})," plan or higher."]}),e.jsxs(s,{variant:"bodyMd",tone:"subdued",children:["Your current plan: ",e.jsx("strong",{children:(p==null?void 0:p.currentPlan)||"Starter"})]}),e.jsx(b,{tone:"info",children:e.jsx(s,{children:"Upgrade to test AI responses with real store data."})})]})})}),e.jsx(S,{open:_,onClose:()=>z(!1),title:"Insufficient Tokens",primaryAction:{content:"Buy Tokens",onAction:()=>{const r=new URLSearchParams(window.location.search),o=r.toString()?`?${r.toString()}`:"";window.location.href=`/billing${o}`}},secondaryActions:[{content:"Cancel",onAction:()=>z(!1)}],children:e.jsx(S.Section,{children:e.jsxs(l,{gap:"300",children:[e.jsx(s,{variant:"bodyMd",children:"You need more tokens to use AI Testing."}),e.jsx(j,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:e.jsxs(l,{gap:"200",children:[e.jsxs(a,{align:"space-between",children:[e.jsx(s,{variant:"bodySm",children:"Required:"}),e.jsxs(s,{variant:"bodySm",fontWeight:"semibold",children:[((K=p==null?void 0:p.tokensRequired)==null?void 0:K.toLocaleString())||0," tokens"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{variant:"bodySm",children:"Available:"}),e.jsxs(s,{variant:"bodySm",children:[((U=p==null?void 0:p.tokensAvailable)==null?void 0:U.toLocaleString())||0," tokens"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{variant:"bodySm",children:"Needed:"}),e.jsxs(s,{variant:"bodySm",fontWeight:"semibold",tone:"critical",children:[((Y=p==null?void 0:p.tokensNeeded)==null?void 0:Y.toLocaleString())||0," tokens"]})]})]})}),e.jsx(b,{tone:"info",children:e.jsx(s,{children:"Purchase tokens to continue using AI features. Tokens never expire."})})]})})})]})}export{me as default};
