import{j as e}from"./app-bridge-BSmXwsqW-1760335677935.js";import{r as o}from"./react-vendor-tAaa2TlE-1760335677935.js";import{u as Wt}from"./index-Cxy8_lvH-1760335677935.js";import{U as Gt,I as Ht}from"./InsufficientTokensModal-e3P2V0FJ-1760335677935.js";import{M as A,d as R,T as l,e as Xe,f as ze,B as O,a as r,I as y,g as ye,D as Ft,h as Y,C as Ze,i as Kt,S as Yt,P as be,j as Pe,R as _t,k as qt,l as et,m as Vt,E as Qt}from"./polaris-CsWINYdr-1760335677935.js";const Jt=(b,u="")=>{try{return new URLSearchParams(window.location.search).get(b)||u}catch{return u}},De=b=>{if(!b)return b;const u=String(b).trim();return u.startsWith("gid://")?u:`gid://shopify/Product/${u}`},Xt=b=>{if(!b)return"";const u=String(b).match(/\/(\d+)$/);return u?u[1]:b},W=b=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(b==null?void 0:b.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(b==null?void 0:b.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}};function as({shop:b}){const{api:u,shop:tt}=Wt(),i=b||tt||Jt("shop","");o.useEffect(()=>{},[i,u]);const[x,H]=o.useState([]),[Z,ie]=o.useState(!1),[st,Re]=o.useState(1),[nt,Ce]=o.useState(!0),[F,Ue]=o.useState(0),[d,ee]=o.useState([]),[E,ce]=o.useState(!1),[K,$e]=o.useState(""),[M,de]=o.useState("all"),[T,te]=o.useState(""),[ue,Zt]=o.useState("createdAt"),[_,ot]=o.useState("desc"),[U,he]=o.useState([]),[at,lt]=o.useState([]),[Be,we]=o.useState(!1),[Ne,Ae]=o.useState(!1),[We,Ee]=o.useState(!1),[Ge,Ie]=o.useState(!1),[rt,it]=o.useState(""),[ct,dt]=o.useState([]),[z,q]=o.useState([]),[I,He]=o.useState([]),[Le,V]=o.useState(!1),[ge,B]=o.useState({current:0,total:0,percent:0}),[Fe,Q]=o.useState(""),[pe,se]=o.useState([]),[ne,Ke]=o.useState({}),[ut,Oe]=o.useState(!1),[ht,me]=o.useState(!1),[gt,oe]=o.useState(!1),[N,ae]=o.useState([]),[pt,fe]=o.useState(!1),[Ye,P]=o.useState(""),[_e,mt]=o.useState(!1),[L,ft]=o.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[v,St]=o.useState(null),[le,xt]=o.useState(1),[jt,Se]=o.useState(!1),[xe,yt]=o.useState(localStorage.getItem("hasVisitedProducts")==="true"),[bt,qe]=o.useState(!1),[Pt,Ct]=o.useState(!1),[J,Ve]=o.useState(null),[ve,wt]=o.useState("starter");o.useEffect(()=>{if(!i)return;u("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
        }
      }
    `,variables:{shop:i}})}).then(n=>{var h,p,S;if((h=n==null?void 0:n.errors)!=null&&h.length)throw new Error(((p=n.errors[0])==null?void 0:p.message)||"GraphQL error");const s=(S=n==null?void 0:n.data)==null?void 0:S.plansMe,a=(s==null?void 0:s.modelsSuggested)||["anthropic/claude-3.5-sonnet"];dt(a.map(m=>({label:m,value:m}))),it(a[0]),St((s==null?void 0:s.plan)||"starter"),wt((s==null?void 0:s.planKey)||"starter");const f=((s==null?void 0:s.planKey)||"starter").toLowerCase();xt({starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[f]||1)}).catch(n=>console.error("[BULK-EDIT] GraphQL plansMe failed:",n))},[i,u]),o.useEffect(()=>{if(!i)return;const t=new Promise((n,s)=>{setTimeout(()=>s(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([u(`/api/languages/shop/${i}`),t]).then(n=>{const s=Array.isArray(n==null?void 0:n.shopLanguages)&&n.shopLanguages.length?n.shopLanguages:["en"];He(s.includes("en")?s:["en",...s])}).catch(n=>{console.error("[BULK-EDIT] Languages API error:",n),He(["en"])})},[i,u]),o.useEffect(()=>{i&&u("/api/products/tags/list",{shop:i}).then(t=>lt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[i,u]);const G=o.useCallback(async(t=1,n=!1,s=null)=>{var a,f,g,h,p;ie(!0);try{const S=new URLSearchParams({shop:i,page:t,limit:50,...M!=="all"&&{optimized:M},...K&&{search:K},...T&&{languageFilter:T},...U.length>0&&{tags:U.join(",")},sortBy:ue,sortOrder:_,...s&&{_t:s}}),m=await u(`/api/products/list?${S}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((a=m.products)==null?void 0:a.length)>0,console.log("[LOAD-PRODUCTS] ===== PRODUCTS LOADED ====="),console.log("[LOAD-PRODUCTS] Total products:",(f=m.products)==null?void 0:f.length),((g=m.products)==null?void 0:g.length)>0&&m.products.forEach((j,$)=>{var c,k;console.log(`[LOAD-PRODUCTS] Product ${$}: ID=${j.id} (type: ${typeof j.id}), _id=${j._id}, title="${j.title}", has SEO: ${!!((k=(c=j.optimizationSummary)==null?void 0:c.optimizedLanguages)!=null&&k.length)}`)}),H(n?j=>[...j,...m.products]:m.products||[]),Re(t),Ce(((h=m.pagination)==null?void 0:h.hasNext)||!1),Ue(((p=m.pagination)==null?void 0:p.total)||0)}catch(S){H(n?x:[]),Ce(!1),P(`Error loading products: ${S.message}`)}finally{ie(!1)}},[i,M,K,T,U,ue,_]);o.useEffect(()=>{i&&G(1,!1,null)},[i,G,M,T,U,ue,_]),o.useEffect(()=>{!xe&&i&&(localStorage.setItem("hasVisitedProducts","true"),yt(!0))},[xe,i]),o.useEffect(()=>{x.length===0&&!Z&&i&&!xe&&Se(!0)},[x.length,Z,i,xe]),o.useEffect(()=>{console.log("[DEBUG-MONITOR] ===== STATE CHANGED ====="),console.log("[DEBUG-MONITOR] Products count:",x.length),console.log("[DEBUG-MONITOR] Selected items count:",d.length),console.log("[DEBUG-MONITOR] Products:",x.map(t=>({id:t.id,title:t.title}))),console.log("[DEBUG-MONITOR] Selected items:",d)},[x,d]);const Qe=o.useCallback(t=>{$e(t)},[]);o.useEffect(()=>{const t=setTimeout(()=>{i&&G(1,!1,null)},500);return()=>clearTimeout(t)},[K]);const At=o.useCallback(t=>{console.log("[SELECTION-CHANGE] ===== SELECTION CHANGED ====="),console.log("[SELECTION-CHANGE] New selected items:",t),console.log("[SELECTION-CHANGE] Item count:",t.length),console.log("[SELECTION-CHANGE] Item types:",t.map(n=>typeof n)),console.log("[SELECTION-CHANGE] Current products count:",x.length),console.log("[SELECTION-CHANGE] Current products IDs:",x.map(n=>n.id)),ee(t),t.length===0&&ce(!1)},[x]),Je=o.useCallback(t=>{ce(t),ee(t?x.map(n=>n.id):[])},[x]),Et=()=>{if(d.length===0&&!E){P("Please select products first");return}me(!0)},It=()=>{if(d.length===0&&!E){P("Please select products first");return}ae([]),oe(!0)},Lt=()=>{x.filter(s=>d.includes(s.id)).filter(s=>{var a,f;return((f=(a=s.optimizationSummary)==null?void 0:a.optimizedLanguages)==null?void 0:f.length)>0});const n=()=>{mt(!1),ft({processing:!1,current:0,total:0,currentItem:"",results:null}),L.results&&L.results.successful>0&&G(1,!1,null)};return L.processing?e.jsx(A,{open:_e,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(A.Section,{children:e.jsxs(R,{gap:"400",children:[e.jsxs(l,{variant:"bodyMd",children:["Processing: ",L.currentItem]}),e.jsx(Xe,{progress:L.current/L.total*100}),e.jsxs(l,{variant:"bodySm",tone:"subdued",children:[L.current," of ",L.total," products (",Math.round(L.current/L.total*100),"%)"]})]})})}):L.results!==null?e.jsx(A,{open:_e,title:"AI Enhancement Results",onClose:n,primaryAction:{content:"Done",onAction:n},children:e.jsx(A.Section,{children:e.jsx(R,{gap:"300",children:e.jsxs(y,{gap:"400",children:[e.jsxs(r,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"success",children:L.results.successful})]}),e.jsxs(r,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:L.results.failed})]}),e.jsxs(r,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"info",children:L.results.skipped})]})]})})})}):null},Ot=async()=>{var n;if(!z.length){P("Please select at least one language");return}let t=rt;(!t||!t.trim())&&(t=((n=ct[0])==null?void 0:n.value)||"anthropic/claude-3.5-sonnet"),me(!1),V(!0),B({current:0,total:0,percent:0}),se([]),Ke({});try{let s=[];E?s=(await u(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:s=x.filter(c=>d.includes(c.id));const a=W(v),f=s.length;s=s.slice(0,a);const g=s.length,h=f-g;B({current:0,total:g,percent:0});const p=5,S={};for(let c=0;c<s.length;c+=p){const C=s.slice(c,Math.min(c+p,s.length)).map(async w=>{var X;Q(w.title||w.handle||"Product");try{const je=w.gid||De(w.productId||w.id),Te=((X=w.optimizationSummary)==null?void 0:X.optimizedLanguages)||[],Me=z.filter(Nt=>!Te.includes(Nt));if(Me.length===0){S[w.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Bt=await u("/api/seo/generate-multi",{method:"POST",shop:i,body:{shop:i,productId:je,model:t,languages:Me}});S[w.id]={success:!0,data:Bt,languages:Me}}catch(je){S[w.id]={success:!1,error:je.message},se(Te=>[...Te,{product:w.title,error:je.message}])}});await Promise.all(C);const D=Math.min(c+p,s.length),re=Math.round(D/g*100);B({current:D,total:g,percent:re})}Ke(S),Oe(!0);const m=Object.keys(S).filter(c=>S[c].success&&!S[c].skipped).length,j=Object.keys(S).filter(c=>S[c].skipped).length;let $=`Generated Optimization for AI Search for ${m} products`;j>0&&($+=` (${j} already optimised)`),h>0&&($+=` (${h} skipped due to plan limit)`),P($)}catch(s){P(`Error: ${s.message}`)}finally{V(!1),Q("")}},vt=async()=>{var t,n;V(!0),B({current:0,total:0,percent:0});try{const s=Object.entries(ne).filter(([h,p])=>p.success&&!p.skipped),a=s.length;B({current:0,total:a,percent:0});for(let h=0;h<s.length;h++){const[p,S]=s[h],m=x.find(c=>c.id===p);if(!m)continue;Q(m.title||"Product");try{const c=m.gid||De(m.productId||m.id),k=await u("/api/seo/apply-multi",{method:"POST",shop:i,body:{shop:i,productId:c,results:S.data.results.filter(C=>C==null?void 0:C.seo).map(C=>({language:C.language,seo:C.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});k.appliedLanguages&&k.appliedLanguages.length>0&&H(C=>C.map(D=>{var re;if(D.id===p){const w=((re=D.optimizationSummary)==null?void 0:re.optimizedLanguages)||[],X=[...new Set([...w,...k.appliedLanguages])];return{...D,optimizationSummary:{...D.optimizationSummary,optimizedLanguages:X,optimized:!0,lastOptimized:new Date().toISOString()}}}return D}))}catch(c){se(k=>[...k,{product:m.title,error:`Apply failed: ${c.message}`}])}const j=h+1,$=Math.round(j/a*100);B({current:j,total:a,percent:$})}P("AI Search Optimisation applied successfully!"),Oe(!1),console.log("[APPLY-SEO] ===== CLEARING SELECTION ====="),console.log("[APPLY-SEO] Selected items BEFORE clear:",d),ee([]),ce(!1),console.log("[APPLY-SEO] Selected items cleared"),console.log("[APPLY-SEO] Waiting for database propagation..."),await new Promise(h=>setTimeout(h,1e3)),console.log("[APPLY-SEO] Clearing products state before reload..."),H([]);const f=new URLSearchParams({shop:i,page:1,limit:50,...M!=="all"&&{optimized:M},...K&&{search:K},...T&&{languageFilter:T},...U.length>0&&{tags:U.join(",")},sortBy:ue,sortOrder:_,_t:Date.now()}),g=await u(`/api/products/list?${f}`,{shop:i,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});H(g.products||[]),Re(1),Ce(((t=g.pagination)==null?void 0:t.hasNext)||!1),Ue(((n=g.pagination)==null?void 0:n.total)||0)}catch(s){P(`Error applying AI Search Optimisation: ${s.message}`)}finally{V(!1),Q("")}},kt=async()=>{var t;if(!N.length){P("Please select at least one language to delete");return}oe(!1),fe(!1),V(!0),B({current:0,total:0,percent:0}),se([]);try{let n=[];E?n=(await u(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:n=x.filter(g=>d.includes(g.id));const s=n.length;B({current:0,total:s,percent:0});let a=0,f=0;for(let g=0;g<n.length;g++){const h=n[g];Q(h.title||h.handle||"Product");try{const m=h.gid||De(h.productId||h.id),j=((t=h.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],$=N.filter(k=>j&&j.length>0&&j.includes(k));if($.length===0){f++;continue}const c=await u("/api/seo/delete-multi",{method:"POST",shop:i,body:{shop:i,productId:m,languages:$}});c.deletedLanguages&&c.deletedLanguages.length>0&&H(k=>k.map(C=>{var D;if(C.id===h.id){const w=(((D=C.optimizationSummary)==null?void 0:D.optimizedLanguages)||[]).filter(X=>!c.deletedLanguages.includes(X));return{...C,optimizationSummary:{...C.optimizationSummary,optimizedLanguages:w,optimized:w.length>0,lastOptimized:w.length>0?C.optimizationSummary.lastOptimized:null}}}return C})),a++,c.deletedLanguages&&c.deletedLanguages.length>0&&await u("/api/products/verify-after-delete",{method:"POST",shop:i,body:{shop:i,productIds:[m],deletedLanguages:c.deletedLanguages}})}catch(m){se(j=>[...j,{product:h.title,error:m.message}])}const p=g+1,S=Math.round(p/s*100);B({current:p,total:s,percent:S})}ee([]),ce(!1),f>0?P(`Deleted Optimization for AI Search from ${a} products (${f} had no optimisation to delete)`):P(`Deleted Optimization for AI Search from ${a} products`),setTimeout(()=>{const g=Date.now();G(1,!1,g)},500)}catch(n){P(`Error: ${n.message}`)}finally{V(!1),Q("")}},Tt=t=>{var n,s;try{const a=t,f=Xt(a.productId||a.id),g=((n=a.optimizationSummary)==null?void 0:n.optimizedLanguages)||[];console.log(`[BULK-EDIT-RENDER] Product: "${a.title}", ID: ${a.id}, Type: ${typeof a.id}`),console.log("[BULK-EDIT-RENDER] Optimized Languages:",g),console.log("[BULK-EDIT-RENDER] Selected Items:",d),console.log("[BULK-EDIT-RENDER] Is Selected:",d.includes(a.id));const h=(s=a.images)!=null&&s[0]?e.jsx(et,{source:a.images[0].url||a.images[0].src||a.images[0],alt:a.title,size:"small"}):a.imageUrl?e.jsx(et,{source:a.imageUrl,alt:a.title,size:"small"}):e.jsx(r,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Vt,{id:a.id,url:"",media:h,accessibilityLabel:`View details for ${a.title}`,children:e.jsxs(y,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(r,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:a.title}),e.jsxs(l,{variant:"bodySm",tone:"subdued",children:["ID: ",f]})]}),e.jsx(r,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(y,{gap:"100",children:I.length>0?I.map(p=>{const S=g.includes(p);return e.jsx(Y,{tone:S?"success":"subdued",size:"small",children:p.toUpperCase()},p)}):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),g.map(p=>e.jsx(Y,{tone:"success",size:"small",children:p.toUpperCase()},p)))})}),e.jsx(r,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(Y,{tone:"success",children:"Active"})})]})})}catch(a){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",a),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},Mt=Le&&e.jsx(A,{open:Le,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(A.Section,{children:e.jsxs(R,{gap:"400",children:[e.jsx(l,{variant:"bodyMd",children:Fe?`Processing: ${Fe}`:"Preparing..."}),e.jsx(Xe,{progress:ge.percent}),e.jsxs(l,{variant:"bodySm",tone:"subdued",children:[ge.current," of ",ge.total," products (",ge.percent,"%)"]})]})})}),zt=e.jsx(A,{open:ht,title:"Select Languages",onClose:()=>{me(!1),q([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Ot,disabled:z.length===0||z.length>le},secondaryActions:[{content:"Cancel",onAction:()=>{me(!1),q([])}}],children:e.jsx(A.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsxs(l,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",E?"all":d.length," selected products:"]}),z.length>le&&e.jsx(ze,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(R,{gap:"200",children:[e.jsxs(l,{variant:"bodyMd",children:["Your ",ve," plan supports only ",le," language(s), but you selected ",z.length,"."]}),e.jsx(l,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan:"}),e.jsx(O,{variant:"primary",onClick:()=>{var t;window.location.href=`/billing?shop=${encodeURIComponent(i)}&host=${encodeURIComponent(((t=window.location.search.split("host=")[1])==null?void 0:t.split("&")[0])||"")}`},children:"Upgrade Plan"})]})}),e.jsx(r,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:I.map(t=>e.jsx(ye,{label:t.toUpperCase(),checked:z.includes(t),onChange:n=>{q(n?[...z,t]:z.filter(s=>s!==t))}},t))})}),e.jsx(r,{paddingBlockStart:"200",children:e.jsx(O,{plain:!0,onClick:()=>{z.length===I.length?q([]):I.length>le?(q([...I]),P(`You selected ${I.length} languages. Your ${ve} plan supports ${le}. Please deselect or upgrade.`)):q([...I])},children:z.length===I.length?"Deselect all":"Select all"})}),e.jsx(l,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Dt=e.jsx(A,{open:ut&&!Le,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:vt,disabled:!Object.values(ne).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Oe(!1)}],children:e.jsx(A.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsxs(y,{gap:"400",children:[e.jsxs(r,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(ne).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(r,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(ne).filter(t=>t.skipped).length})]}),e.jsxs(r,{children:[e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(l,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(ne).filter(t=>!t.success).length})]})]}),pe.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ft,{}),e.jsx(l,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(r,{maxHeight:"200px",overflowY:"scroll",children:[pe.slice(0,10).map((t,n)=>e.jsxs(l,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},n)),pe.length>10&&e.jsxs(l,{variant:"bodySm",tone:"subdued",children:["... and ",pe.length-10," more errors"]})]})]})]})})}),Rt=e.jsx(A,{open:gt,title:"Delete Optimization for AI Search",onClose:()=>{oe(!1),ae([])},primaryAction:{content:"Continue",onAction:()=>{oe(!1),fe(!0)},disabled:N.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{oe(!1),ae([])}}],children:e.jsx(A.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsxs(l,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",E?"all":d.length," selected products:"]}),e.jsx(r,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:I.map(t=>e.jsx(ye,{label:t.toUpperCase(),checked:N.includes(t),onChange:n=>{ae(n?[...N,t]:N.filter(s=>s!==t))}},t))})}),e.jsx(r,{paddingBlockStart:"200",children:e.jsx(O,{plain:!0,onClick:()=>{ae(N.length===I.length?[]:[...I])},children:N.length===I.length?"Deselect all":"Select all"})}),e.jsx(l,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Ut=e.jsx(A,{open:pt,title:"Confirm Deletion",onClose:()=>{fe(!1)},primaryAction:{content:"Delete",onAction:kt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>fe(!1)}],children:e.jsx(A.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsx(l,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(r,{paddingBlock:"200",children:e.jsx(y,{gap:"100",children:N.map(t=>e.jsx(Y,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(l,{variant:"bodyMd",children:["This will delete optimisation from ",E?"ALL":d.length," selected products."]}),e.jsx(l,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),ke=async()=>{try{ie(!0),P("Syncing products from Shopify...");const t=await u("/api/products/sync",{method:"POST",shop:i});if(t.success){const n=t.productsCount||t.synced||0;P(`✅ Synced ${n} products successfully!`),setTimeout(()=>{G(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),P(`❌ Sync failed: ${t.message}`)}finally{ie(!1)}},$t=e.jsx(Qt,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{$e(""),de("all"),te(""),he([]),G(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:ke},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{children:e.jsxs(r,{padding:"400",children:[e.jsxs(R,{gap:"300",children:[v&&e.jsx(ze,{tone:"info",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(l,{children:["Your ",e.jsx("strong",{children:v})," plan includes up to"," ",e.jsx("strong",{children:W(v)})," products for SEO optimization.",F>W(v)&&e.jsxs(e.Fragment,{children:[" You have ",F," products, so only the first ",W(v)," will be processed."]})]}),(d.length>0||E)&&e.jsxs(l,{children:["Selected: ",E?Math.min(F,W(v)):d.length,"/",W(v)]})]})}),v&&(d.length>W(v)||E&&F>W(v))&&e.jsx(ze,{tone:"warning",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(l,{children:[e.jsx("strong",{children:"Plan Limit Exceeded:"})," You've selected more products than your ",v," plan allows. Only the first ",W(v)," products will be processed."]}),e.jsx(O,{size:"micro",onClick:()=>qe(!0),children:"Upgrade Plan"})]})}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(r,{minWidth:"400px",children:e.jsx(Kt,{label:"",placeholder:"Search by product ID, name, or details...",value:K,onChange:Qe,prefix:e.jsx(Yt,{}),clearButton:!0,onClearButtonClick:()=>Qe("")})}),e.jsx(r,{width:"320px",children:e.jsx(O,{primary:!0,onClick:Et,disabled:d.length===0&&!E,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(O,{onClick:ke,disabled:Z,size:"medium",children:"Sync Products"}),e.jsx(r,{width:"320px",children:e.jsxs(R,{gap:"200",align:"end",children:[d.length===0&&!E||!x.filter(s=>d.includes(s.id)).some(s=>{var a,f;return((f=(a=s.optimizationSummary)==null?void 0:a.optimizedLanguages)==null?void 0:f.length)>0})?null:e.jsx(O,{onClick:handleStartEnhancement,disabled:d.length===0&&!E,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(O,{onClick:It,disabled:d.length===0&&!E||!x.filter(s=>d.includes(s.id)).some(s=>{var a,f;return((f=(a=s.optimizationSummary)==null?void 0:a.optimizedLanguages)==null?void 0:f.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),F>0&&e.jsx(r,{paddingBlockStart:"300",children:e.jsx(ye,{label:`Select all ${F} products in your store`,checked:E,onChange:Je})})]})}),e.jsx(r,{paddingBlockStart:"400",children:e.jsxs(Ze,{children:[e.jsxs(r,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(y,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(y,{gap:"200",wrap:!0,children:[e.jsx(be,{active:Be,activator:e.jsx(O,{disclosure:"down",onClick:()=>we(!Be),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),M!=="all"&&e.jsx(r,{onClick:t=>{t.stopPropagation(),de("all")},children:e.jsx(l,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>we(!1),children:e.jsx(r,{padding:"300",minWidth:"200px",children:e.jsx(Pe,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[M],onChange:t=>{de(t[0]),te(""),we(!1)}})})}),e.jsx(be,{active:Ne,activator:e.jsx(O,{disclosure:"down",onClick:()=>Ae(!Ne),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),T&&e.jsx(r,{onClick:t=>{t.stopPropagation(),te("")},children:e.jsx(l,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Ae(!1),children:e.jsx(r,{padding:"300",minWidth:"200px",children:e.jsx(Pe,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...I.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...I.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:T?[T]:[],onChange:t=>{te(t[0]||""),Ae(!1)}})})}),e.jsx(be,{active:We,activator:e.jsx(O,{disclosure:"down",onClick:()=>Ee(!We),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),U.length>0&&e.jsx(r,{onClick:t=>{t.stopPropagation(),he([])},children:e.jsx(l,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Ee(!1),children:e.jsxs(r,{padding:"300",minWidth:"200px",children:[e.jsx(Pe,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:at.map(t=>({label:t,value:t})),selected:U,onChange:t=>{he(t)}}),e.jsx(r,{paddingBlockStart:"200",children:e.jsx(O,{size:"slim",onClick:()=>Ee(!1),children:"Apply"})})]})})]}),e.jsx(be,{active:Ge,activator:e.jsx(O,{disclosure:"down",onClick:()=>Ie(!Ge),removeUnderline:!0,children:e.jsx(y,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:_==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Ie(!1),children:e.jsx(r,{padding:"300",minWidth:"200px",children:e.jsx(Pe,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[_],onChange:t=>{ot(t[0]),Ie(!1)}})})})]}),(M!=="all"||T||U.length>0)&&e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(y,{gap:"100",wrap:!0,children:[M!=="all"&&e.jsx(Y,{onRemove:()=>de("all"),children:M==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),T&&e.jsx(Y,{onRemove:()=>te(""),children:T.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),U.map(t=>e.jsxs(Y,{onRemove:()=>he(n=>n.filter(s=>s!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(r,{children:[e.jsx(r,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(y,{gap:"200",align:"start",children:[e.jsx(ye,{checked:d.length===x.length&&x.length>0,onChange:Je,label:""}),e.jsxs(l,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",d.length>0&&` (${d.length} selected products)`]})]})}),e.jsx(_t,{resourceName:{singular:"product",plural:"products"},items:x,renderItem:Tt,selectedItems:d,onSelectionChange:At,selectable:!0,loading:Z,totalItemsCount:F,emptyState:$t,showHeader:!1},`products-${x.length}-${d.length}`)]}),nt&&!Z&&e.jsx(r,{padding:"400",textAlign:"center",children:e.jsx(O,{onClick:()=>G(st+1,!0,null),children:"Load more"})})]})}),Mt,zt,Dt,Rt,Ut,Lt(),e.jsx(A,{open:jt,onClose:()=>Se(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Se(!1),ke()}},secondaryActions:[{content:"Skip for now",onAction:()=>Se(!1)}],children:e.jsx(A.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsx(l,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(l,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Gt,{open:bt,onClose:()=>{qe(!1),Ve(null)},featureName:"AI Enhancement",currentPlan:ve}),J&&e.jsx(Ht,{open:Pt,onClose:()=>{Ct(!1),Ve(null)},tokensRequired:J.tokensRequired,tokensAvailable:J.tokensAvailable,feature:"AI-Enhanced Products",shop:i,needsUpgrade:J.needsUpgrade,minimumPlan:J.minimumPlanForFeature,currentPlan:J.currentPlan}),Ye&&e.jsx(qt,{content:Ye,onDismiss:()=>P("")})]})}export{as as default};
