import{j as e}from"./app-bridge-CT3LeeEF-1760732331121.js";import{r as c}from"./react-vendor-tAaa2TlE-1760732331121.js";import{m as ae}from"./sessionFetch-CJepNHo3-1760732331121.js";import{L as u,C as j,a as d,T as t,d as se,e as r,f as w,I as l,B as h,D as y,g as re,h as oe,i as de}from"./polaris-Y0KTRq6a-1760732331121.js";const le=(M,g="")=>{try{return new URLSearchParams(window.location.search).get(M)||g}catch{return g}};function xe({shop:M}){var E,W,T,I,N,$,R,U,F,V,_,G;const g=M||le("shop",""),m=c.useMemo(()=>ae(),[]),x=i=>{const s=new URLSearchParams(window.location.search),k=s.toString()?`?${s.toString()}`:"";window.location.href=`${i}${k}`},[q,L]=c.useState(!0),[n,Q]=c.useState(null),[a,Y]=c.useState(null),[z,H]=c.useState(null),[o,S]=c.useState(null),[v,b]=c.useState(!1),[J,C]=c.useState(!1),p=c.useRef(null),[f,K]=c.useState(!1);c.useEffect(()=>(A(),X(),()=>{p.current&&(clearInterval(p.current),p.current=null)}),[g]),c.useEffect(()=>{o&&o.autoSyncEnabled&&!o.synced&&D()},[o]);const A=async()=>{try{L(!0);const[i,s]=await Promise.all([m(`/api/dashboard/stats?shop=${g}`),m(`/api/billing/tokens/balance?shop=${g}`)]);i&&(Q(i),Y(i.subscription)),s&&H(s)}catch(i){console.error("[Dashboard] Error loading data:",i)}finally{L(!1)}},X=async()=>{try{const i=await m(`/api/dashboard/sync-status?shop=${g}`);i&&(S(i),C(i.autoSyncEnabled||!1),b(!!i.inProgress))}catch(i){console.error("[Dashboard] Error loading sync status:",i)}},D=async()=>{try{b(!0);const i=await m(`/api/dashboard/sync?shop=${g}`,{method:"POST"});console.log("[Dashboard] Sync start response:",i),i!=null&&i.success||i!=null&&i.inProgress?(p.current&&clearInterval(p.current),p.current=setInterval(async()=>{try{const s=await m(`/api/dashboard/sync-status?shop=${g}`);s&&(S(s),s.inProgress||(p.current&&(clearInterval(p.current),p.current=null),b(!1),A()))}catch(s){console.error("[Dashboard] Poll error:",s)}},2e3)):b(!1)}catch(i){console.error("[Dashboard] Error syncing:",i),b(!1)}},Z=async i=>{try{const s=await m(`/api/dashboard/auto-sync?shop=${g}`,{method:"POST",body:{enabled:i}});s!=null&&s.success?(C(!!s.autoSyncEnabled),S({...o||{},autoSyncEnabled:!!s.autoSyncEnabled})):(C(i),S({...o||{},autoSyncEnabled:i}))}catch(s){console.error("[Dashboard] Error toggling auto-sync:",s)}},P=((E=n==null?void 0:n.products)==null?void 0:E.total)>0?Math.round(n.products.optimized/n.products.total*100):0,B=((W=n==null?void 0:n.collections)==null?void 0:W.total)>0?Math.round(n.collections.optimized/n.collections.total*100):0,ee=["growth","growth_extra","enterprise"].includes(a==null?void 0:a.plan),ne=["professional","growth","growth_extra","enterprise"].includes(a==null?void 0:a.plan),te=(a==null?void 0:a.plan)==="enterprise",ie=["growth_extra","enterprise"].includes(a==null?void 0:a.plan);if(q)return e.jsx(u,{children:e.jsx(u.Section,{children:e.jsx(j,{children:e.jsx(d,{padding:"400",children:e.jsx(t,{children:"Loading dashboard..."})})})})});const O=!(o!=null&&o.synced);return e.jsxs(u,{children:[e.jsx(u.Section,{children:e.jsx(t,{variant:"headingLg",as:"h1",children:"Store Overview"})}),O&&e.jsx(u.Section,{children:e.jsx(se,{title:"Sync your store",tone:"info",action:{content:v?"Syncing...":"Sync Now",onAction:D,loading:v},children:e.jsxs(r,{gap:"200",children:[e.jsx(t,{children:"Sync products, collections, languages, and markets to get started with AI optimization."}),v&&e.jsxs(d,{paddingBlockStart:"200",children:[e.jsx(w,{progress:50,size:"small",tone:"highlight"}),e.jsx(d,{paddingBlockStart:"100",children:e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Fetching store data..."})})]})]})})}),!O&&o&&e.jsx(u.Section,{children:e.jsx(j,{children:e.jsxs(r,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"Store Sync"}),e.jsx(d,{paddingBlockStart:"050",children:e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Last synced: ",o.lastSyncDate?new Date(o.lastSyncDate).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"]})})]}),e.jsx(h,{onClick:D,loading:v,children:"Sync Now"})]}),e.jsx(y,{}),e.jsx(re,{label:"Auto-sync on load",checked:J,onChange:Z,helpText:"Automatically sync store data when you open the dashboard"})]})})}),e.jsx(u.Section,{children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"16px"},children:[e.jsx(j,{children:e.jsxs(r,{gap:"400",children:[e.jsx(t,{variant:"headingMd",children:"Products & Collections"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs(r,{gap:"150",children:[e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"Products"}),e.jsxs(l,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Total"}),e.jsx(t,{variant:"bodySm",fontWeight:"semibold",children:((T=n==null?void 0:n.products)==null?void 0:T.total)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Optimized"}),e.jsx(t,{variant:"bodySm",fontWeight:"semibold",tone:"success",children:((I=n==null?void 0:n.products)==null?void 0:I.optimized)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Unoptimized"}),e.jsx(t,{variant:"bodySm",fontWeight:"semibold",children:Math.max((((N=n==null?void 0:n.products)==null?void 0:N.total)||0)-((($=n==null?void 0:n.products)==null?void 0:$.optimized)||0),0)})]}),e.jsxs(d,{paddingBlockStart:"100",children:[e.jsx(w,{progress:P,size:"small",tone:P===100?"success":"primary"}),e.jsx(d,{paddingBlockStart:"050",children:e.jsxs(t,{variant:"bodySm",tone:"subdued",children:[P,"% optimized"]})})]})]}),e.jsxs(r,{gap:"150",children:[e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"Collections"}),e.jsxs(l,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Total"}),e.jsx(t,{variant:"bodySm",fontWeight:"semibold",children:((R=n==null?void 0:n.collections)==null?void 0:R.total)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Optimized"}),e.jsx(t,{variant:"bodySm",fontWeight:"semibold",tone:"success",children:((U=n==null?void 0:n.collections)==null?void 0:U.optimized)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Unoptimized"}),e.jsx(t,{variant:"bodySm",fontWeight:"semibold",children:Math.max((((F=n==null?void 0:n.collections)==null?void 0:F.total)||0)-(((V=n==null?void 0:n.collections)==null?void 0:V.optimized)||0),0)})]}),e.jsxs(d,{paddingBlockStart:"100",children:[e.jsx(w,{progress:B,size:"small",tone:B===100?"success":"primary"}),e.jsx(d,{paddingBlockStart:"050",children:e.jsxs(t,{variant:"bodySm",tone:"subdued",children:[B,"% optimized"]})})]})]})]}),e.jsx(y,{}),e.jsxs(l,{align:"space-between",children:[e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Last synced: ",o!=null&&o.lastSyncDate?new Date(o.lastSyncDate).toLocaleString():"Never"]}),e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Last optimized: ",n!=null&&n.lastOptimization?new Date(n.lastOptimization).toLocaleString():"Never"]})]})]})}),e.jsx(j,{children:e.jsxs(r,{gap:"400",children:[e.jsx(t,{variant:"headingMd",children:"Languages & Markets"}),e.jsx(r,{gap:"200",children:n!=null&&n.languages&&n.languages.length>0?e.jsxs(e.Fragment,{children:[n.languages.slice().sort((i,s)=>(s.primary?1:0)-(i.primary?1:0)||(s.totalCount||0)-(i.totalCount||0)).slice(0,3).map((i,s)=>{const k=i.totalCount>0?Math.round(i.optimizedCount/i.totalCount*100):0;return e.jsxs(r,{gap:"050",children:[e.jsxs(l,{align:"space-between",children:[e.jsxs(t,{variant:"bodyMd",tone:"subdued",children:[i.name||i.code," ",i.primary?"★":""]}),e.jsxs(t,{variant:"bodySm",fontWeight:"semibold",children:[i.optimizedCount||0,"/",i.totalCount||0]})]}),e.jsx(w,{progress:k,size:"small",tone:k===100?"success":"primary"})]},s)}),n.languages.length>3&&e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["+",n.languages.length-3," more..."]})]}):e.jsx(t,{variant:"bodyMd",tone:"subdued",children:"No language data"})}),(n==null?void 0:n.storeMarkets)&&n.storeMarkets.length>0&&e.jsxs(d,{paddingBlockStart:"200",children:[e.jsx(y,{}),e.jsx(d,{paddingBlockStart:"200",children:e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Markets: ",n.storeMarkets.slice(0,2).map(i=>i.name).join(", "),n.storeMarkets.length>2?` +${n.storeMarkets.length-2}`:""]})})]})]})})]})}),e.jsx(u.Section,{children:e.jsxs(l,{gap:"400",wrap:!0,children:[e.jsx("div",{style:{flex:"1",minWidth:"300px"},children:e.jsx(j,{children:e.jsxs(r,{gap:"300",children:[e.jsx(t,{variant:"headingMd",children:"Last Optimization"}),e.jsx(t,{variant:"bodyLg",fontWeight:"semibold",children:n!=null&&n.lastOptimization?new Date(n.lastOptimization).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}),e.jsx(h,{onClick:()=>x("/ai-seo/products"),children:"Optimize Now"})]})})}),e.jsx("div",{style:{flex:"1",minWidth:"300px"},children:e.jsx(j,{children:e.jsxs(r,{gap:"300",children:[e.jsx(t,{variant:"headingMd",children:"Token Balance"}),e.jsxs(t,{variant:"bodyLg",fontWeight:"semibold",children:[((_=z==null?void 0:z.balance)==null?void 0:_.toLocaleString())||0," tokens"]}),((a==null?void 0:a.plan)==="growth_extra"||(a==null?void 0:a.plan)==="enterprise")&&e.jsxs(t,{variant:"bodySm",tone:"subdued",children:[(a==null?void 0:a.plan)==="growth_extra"?"100M":"300M"," included monthly"]}),e.jsx(h,{variant:"primary",onClick:()=>x("/billing"),children:"Manage Tokens"})]})})})]})}),e.jsx(u.Section,{children:e.jsx(j,{children:e.jsxs(r,{gap:"400",children:[e.jsx(t,{variant:"headingMd",children:"Quick Actions"}),e.jsxs(l,{gap:"300",wrap:!0,children:[e.jsx(h,{onClick:()=>x("/ai-seo/products"),children:"Optimize Products"}),ee&&e.jsx(h,{onClick:()=>x("/ai-seo/collections"),children:"Optimize Collections"}),!O&&e.jsxs(e.Fragment,{children:[e.jsx(h,{onClick:()=>x("/ai-seo/sitemap"),children:ie?"Regenerate Sitemap":"View Sitemap"}),te&&e.jsx(h,{onClick:()=>x("/ai-seo/schema-data"),children:"Regenerate Schemas"})]}),ne&&e.jsx(h,{onClick:()=>x("/ai-seo/store-metadata"),children:"Store Info"})]})]})})}),e.jsx(u.Section,{children:e.jsx(j,{children:e.jsxs(r,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(t,{variant:"headingMd",children:"Current Plan"}),e.jsx(d,{paddingBlockStart:"100",children:e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["$",(a==null?void 0:a.price)||0,"/month"]})})]}),e.jsx(oe,{tone:"info",size:"large",children:((G=a==null?void 0:a.plan)==null?void 0:G.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsx(h,{onClick:()=>x("/billing"),children:"View Plans & Billing"})]})})}),e.jsx(u.Section,{children:e.jsx(j,{children:e.jsxs(r,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsx(t,{variant:"headingMd",children:"Getting Started"}),e.jsxs(h,{onClick:()=>K(!f),disclosure:f?"up":"down",children:[f?"Hide":"Show"," Guide"]})]}),e.jsx(de,{open:f,id:"onboarding-collapsible",transition:{duration:"200ms",timingFunction:"ease-in-out"},children:e.jsx(d,{paddingBlockStart:"300",children:e.jsxs(r,{gap:"400",children:[e.jsx(y,{}),e.jsxs(r,{gap:"300",children:[e.jsx(t,{variant:"headingMd",as:"h3",children:"Quick Start Guide"}),e.jsxs(r,{gap:"200",children:[e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"1. Sync Your Store"}),e.jsx(t,{variant:"bodyMd",tone:"subdued",children:'Click "Sync Now" to fetch your products, collections, and languages from Shopify. This is required before you can start optimizing.'}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"2. Choose a Plan"}),e.jsx(t,{variant:"bodyMd",tone:"subdued",children:"Visit Plans & Billing to select the plan that fits your store size. Each plan includes different limits for products, languages, and features."}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"3. Optimize Your Products"}),e.jsx(t,{variant:"bodyMd",tone:"subdued",children:'Go to "Search Optimization for AI" → Products tab. Select products and click "AI Enhance" to generate SEO-optimized titles, descriptions, and metadata.'}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"4. Generate AI Sitemap"}),e.jsx(t,{variant:"bodyMd",tone:"subdued",children:"Navigate to Sitemap tab and generate your AI-optimized sitemap. This helps AI search engines discover and index your products."}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"5. Monitor & Improve"}),e.jsx(t,{variant:"bodyMd",tone:"subdued",children:"Return to Dashboard regularly to track optimization progress and token usage. Enable auto-sync to keep your data fresh."})]})]}),e.jsx(y,{}),e.jsxs(r,{gap:"200",children:[e.jsx(t,{variant:"headingMd",as:"h3",children:"Video Tutorial"}),e.jsx(d,{padding:"400",background:"bg-surface-secondary",borderRadius:"200",children:e.jsxs(r,{gap:"200",inlineAlign:"center",children:[e.jsx(t,{variant:"bodyMd",tone:"subdued",alignment:"center",children:"Video tutorial coming soon"}),e.jsx(t,{variant:"bodySm",tone:"subdued",alignment:"center",children:"[Embedded video will be added here]"})]})})]}),e.jsx(d,{paddingBlockStart:"200",children:e.jsxs(l,{gap:"200",children:[e.jsx(h,{variant:"primary",onClick:()=>x("/ai-seo/products"),children:"Start Optimizing"}),e.jsx(h,{onClick:()=>x("/billing"),children:"View Plans"})]})})]})})})]})})})]})}export{xe as default};
