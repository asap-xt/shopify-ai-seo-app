import{j as e}from"./app-bridge-OHDGbKuE-1760647331317.js";import{r as l}from"./react-vendor-tAaa2TlE-1760647331317.js";import{L as u,C as T,a as g,I as d,r as K,T as a,f as A,d as c,h as R,D as P,B as L,M as C,w as Q,i as V}from"./polaris-BEf6jRnV-1760647331317.js";const M=[10,20,50,100];function ne({shop:y}){var D,U,$,O;const[N,E]=l.useState(!0),[i,Y]=l.useState(null),[x,B]=l.useState(null),[J,m]=l.useState(!1),[z,S]=l.useState(!1),[f,p]=l.useState(""),[b,v]=l.useState(M[0]),[k,w]=l.useState(!1),[F,h]=l.useState(null),W=l.useCallback(async()=>{try{E(!0),h(null);const t=await fetch(`/api/billing/info?shop=${y}`,{headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP ${t.status}`);const r=await t.json();Y(r)}catch(t){console.error("[Billing] Error fetching info:",t),h("Failed to load billing information")}finally{E(!1)}},[y]);l.useEffect(()=>{W()},[W]);const G=async t=>{var r;try{w(!0),h(null);const o=await fetch("/api/billing/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:y,plan:t,endTrial:((r=i==null?void 0:i.subscription)==null?void 0:r.inTrial)||!1})}),j=await o.json();if(!o.ok)throw new Error(j.error||"Failed to create subscription");j.confirmationUrl&&(window.top.location.href=j.confirmationUrl)}catch(o){console.error("[Billing] Subscribe error:",o),h(o.message)}finally{w(!1),m(!1)}},H=async t=>{try{w(!0),h(null);const r=await fetch("/api/billing/tokens/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:y,amount:parseFloat(t)})}),o=await r.json();if(!r.ok)throw new Error(o.error||"Failed to purchase tokens");o.confirmationUrl&&(window.top.location.href=o.confirmationUrl)}catch(r){console.error("[Billing] Purchase error:",r),h(r.message)}finally{w(!1),S(!1)}},_=t=>{const r=t*.6;return Math.floor(r/.1*1e6)};if(N)return e.jsx(e.Fragment,{children:e.jsx(u,{children:e.jsx(u.Section,{children:e.jsx(T,{children:e.jsx(g,{padding:"800",children:e.jsxs(d,{align:"center",blockAlign:"center",children:[e.jsx(K,{size:"large"}),e.jsx(a,{variant:"bodyMd",children:"Loading billing information..."})]})})})})})});const n=i==null?void 0:i.subscription,s=i==null?void 0:i.tokens,q=(i==null?void 0:i.plans)||[];return e.jsxs(e.Fragment,{children:[e.jsxs(u,{children:[F&&e.jsx(u.Section,{children:e.jsx(A,{title:"Error",tone:"critical",onDismiss:()=>h(null),children:e.jsx("p",{children:F})})}),(n==null?void 0:n.inTrial)&&e.jsx(u.Section,{children:e.jsx(A,{title:"Trial Period Active",tone:"info",action:{content:"Activate Plan",onAction:()=>m(!0)},children:e.jsxs("p",{children:["Your trial ends on ",new Date(n.trialEndsAt).toLocaleDateString(),". Activate a plan to continue using all features after ",new Date(n.trialEndsAt).toLocaleDateString(),"."]})})}),e.jsx(u.Section,{children:e.jsx(T,{children:e.jsx(c,{gap:"400",children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},children:q.map(t=>{var r;return e.jsx(T,{children:e.jsxs(c,{gap:"300",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsx(a,{variant:"headingMd",children:t.name}),(n==null?void 0:n.plan)===t.key&&e.jsx(R,{tone:"success",children:"Current"})]}),e.jsxs(a,{variant:"heading2xl",children:["$",t.price]}),e.jsx(a,{variant:"bodySm",tone:"subdued",children:"per month"}),e.jsx(P,{}),e.jsxs(d,{align:"space-between",children:[e.jsx(a,{variant:"bodySm",tone:"subdued",children:"Products"}),e.jsxs(a,{variant:"bodySm",fontWeight:"semibold",children:["up to ",((r=t.productLimit)==null?void 0:r.toLocaleString())||"N/A"]})]}),e.jsxs(d,{align:"space-between",children:[e.jsx(a,{variant:"bodySm",tone:"subdued",children:"Supported languages"}),e.jsx(a,{variant:"bodySm",fontWeight:"semibold",children:t.languageLimit||1})]}),t.includedTokens>0&&!["growth extra","enterprise"].includes(t.key)&&e.jsxs(R,{tone:"info",children:["+",t.includedTokens.toLocaleString()," tokens/month"]}),t.features&&t.features.length>0&&e.jsxs(g,{children:[e.jsx(a,{variant:"bodySm",fontWeight:"semibold",children:"Features:"}),e.jsxs(c,{gap:"100",children:[t.features.slice(0,5).map((o,j)=>e.jsxs(a,{variant:"bodySm",tone:"subdued",children:["✓ ",o]},j)),t.features.length>5&&e.jsxs(a,{variant:"bodySm",tone:"subdued",children:["+ ",t.features.length-5," more..."]})]})]}),e.jsx(L,{variant:(n==null?void 0:n.plan)===t.key?"plain":"primary",fullWidth:!0,disabled:(n==null?void 0:n.plan)===t.key,onClick:()=>{B(t),m(!0)},children:(n==null?void 0:n.plan)===t.key?"Current Plan":"Select Plan"})]})},t.key)})})})})}),e.jsx(u.Section,{variant:"oneThird",children:e.jsx(T,{children:e.jsxs(c,{gap:"400",children:[e.jsx(a,{variant:"headingMd",children:"Token Balance"}),e.jsx(P,{}),e.jsxs(c,{gap:"300",children:[(n==null?void 0:n.plan)==="growth extra"||(n==null?void 0:n.plan)==="enterprise"?e.jsxs(e.Fragment,{children:[e.jsxs(g,{children:[e.jsx(a,{variant:"heading2xl",alignment:"center",children:(n==null?void 0:n.plan)==="growth extra"?"100,000,000":"300,000,000"}),e.jsx(a,{variant:"bodySm",tone:"subdued",alignment:"center",children:"tokens available"}),e.jsxs(a,{variant:"bodySm",tone:"magic",alignment:"center",fontWeight:"semibold",children:["(",(n==null?void 0:n.plan)==="growth extra"?"100M":"300M"," included this cycle)"]})]}),e.jsxs(d,{align:"space-between",children:[e.jsx(a,{variant:"bodySm",tone:"subdued",children:"Additional Purchased"}),e.jsx(a,{variant:"bodySm",children:((D=s==null?void 0:s.totalPurchased)==null?void 0:D.toLocaleString())||0})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(g,{children:[e.jsx(a,{variant:"heading2xl",alignment:"center",children:((U=s==null?void 0:s.balance)==null?void 0:U.toLocaleString())||0}),e.jsx(a,{variant:"bodySm",tone:"subdued",alignment:"center",children:"tokens available"})]}),e.jsxs(d,{align:"space-between",children:[e.jsx(a,{variant:"bodySm",tone:"subdued",children:"Purchased"}),e.jsx(a,{variant:"bodySm",children:(($=s==null?void 0:s.totalPurchased)==null?void 0:$.toLocaleString())||0})]})]}),e.jsxs(d,{align:"space-between",children:[e.jsx(a,{variant:"bodySm",tone:"subdued",children:"Used"}),e.jsx(a,{variant:"bodySm",children:((O=s==null?void 0:s.totalUsed)==null?void 0:O.toLocaleString())||0})]}),e.jsx(P,{}),e.jsx(L,{variant:"primary",fullWidth:!0,onClick:()=>S(!0),children:"Buy Tokens"}),e.jsx(g,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:e.jsxs(c,{gap:"100",children:[e.jsx(a,{variant:"bodySm",tone:"subdued",children:"💡 Tokens enable AI features"}),e.jsx(a,{variant:"bodySm",tone:"subdued",children:"♻️ Never expire, roll over monthly"})]})})]})]})})})]}),e.jsx(C,{open:J,onClose:()=>{m(!1),B(null)},title:"Confirm Plan Selection",primaryAction:{content:k?"Processing...":"Confirm",loading:k,onAction:()=>G((x==null?void 0:x.key)||(n==null?void 0:n.plan))},secondaryActions:[{content:"Cancel",onAction:()=>{m(!1),B(null)}}],children:e.jsx(C.Section,{children:e.jsxs(c,{gap:"400",children:[e.jsxs(a,{children:["You are about to subscribe to the ",e.jsx("strong",{children:(x==null?void 0:x.name)||(n==null?void 0:n.plan)})," plan."]}),(n==null?void 0:n.inTrial)&&e.jsx(A,{tone:"warning",children:e.jsx("p",{children:"This will end your trial period and start billing immediately."})})]})})}),e.jsx(C,{open:z,onClose:()=>{S(!1),p(""),v(M[0])},title:"Purchase Tokens",primaryAction:{content:k?"Processing...":"Purchase",loading:k,onAction:()=>H(f||b)},secondaryActions:[{content:"Cancel",onAction:()=>{S(!1),p(""),v(M[0])}}],children:e.jsx(C.Section,{children:e.jsxs(c,{gap:"400",children:[e.jsx(a,{variant:"headingMd",children:"Select Amount"}),e.jsx(Q,{variant:"segmented",children:M.map(t=>e.jsxs(L,{pressed:b===t&&!f,onClick:()=>{v(t),p("")},children:["$",t]},t))}),e.jsx(a,{variant:"bodyMd",tone:"subdued",children:"Or enter a custom amount (multiples of $5)"}),e.jsx(V,{type:"number",value:f,onChange:t=>{p(t),v(null)},placeholder:"Enter amount",prefix:"$",min:5,step:5,autoComplete:"off"}),e.jsx(g,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(c,{gap:"200",children:[e.jsxs(d,{align:"space-between",children:[e.jsx(a,{variant:"bodyMd",children:"Amount"}),e.jsxs(a,{variant:"bodyMd",fontWeight:"semibold",children:["$",f||b]})]}),e.jsxs(d,{align:"space-between",children:[e.jsx(a,{variant:"bodyMd",children:"Tokens"}),e.jsx(a,{variant:"bodyMd",fontWeight:"semibold",children:_(parseFloat(f||b)).toLocaleString()})]}),e.jsx(P,{}),e.jsx(a,{variant:"bodySm",tone:"subdued",children:"Tokens never expire and roll over indefinitely"})]})}),(n==null?void 0:n.inTrial)&&e.jsx(A,{tone:"info",children:e.jsx("p",{children:"Your trial will continue after purchasing tokens."})})]})})})]})}export{ne as default};
