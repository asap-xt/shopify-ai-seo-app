import{j as e}from"./app-bridge-CP0rgvbF-1761407972089.js";import{r as i}from"./react-vendor-tAaa2TlE-1761407972089.js";import{m as _}from"./sessionFetch-CJepNHo3-1761407972089.js";import{C as $,a as o,e as p,d as T,I as l,o as W,T as t,B as G,p as j,q as f,r as z,s as q,l as Q}from"./polaris-D60uck2t-1761407972089.js";const D=(y,a="")=>{try{return new URLSearchParams(window.location.search).get(y)||a}catch{return a}};function N({shop:y}){const a=y||D("shop",""),[c,L]=i.useState(null),[k,C]=i.useState(!1),[v,A]=i.useState(!1),[E,h]=i.useState(""),[s,F]=i.useState(null),[r,I]=i.useState(null),[g,P]=i.useState(!1),x=i.useMemo(()=>_(),[]),S=i.useCallback(async()=>{if(a)try{const n=await x(`/api/sitemap/info?shop=${a}`);L(n)}catch(n){h(n.message||"Failed to load sitemap info")}},[a,x]),M=i.useCallback(async()=>{var n,m,b;if(a)try{const d=await x("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
        query PlansMe($shop:String!) {
          plansMe(shop:$shop) {
            shop
            plan
            planKey
            priceUsd
            product_limit
            providersAllowed
            modelsSuggested
            autosyncCron
            trial {
              active
              ends_at
              days_left
            }
          }
        }
      `,variables:{shop:a}})});if((n=d==null?void 0:d.errors)!=null&&n.length)throw new Error(((m=d.errors[0])==null?void 0:m.message)||"GraphQL error");const u=(b=d==null?void 0:d.data)==null?void 0:b.plansMe;F(u||null)}catch{}},[a,x]),R=i.useCallback(async()=>{var n,m,b,w;if(a){C(!0),I(null);try{const d=await fetch(`/api/sitemap/generate?shop=${encodeURIComponent(a)}`,{method:"POST",credentials:"include",headers:{Authorization:`Bearer ${((b=(m=(n=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:n.getState())==null?void 0:m.session)==null?void 0:b.token)||""}`,"Content-Type":"application/json"}});if(d.ok){const u=await d.json();console.log("[SITEMAP] Generation response:",u),u.success?(h(u.message||"Sitemap generation started!"),I(u.job),(w=u.job)!=null&&w.queued&&P(!0)):h(u.message||"Sitemap generation failed")}else{const u=await d.text();h(`Sitemap generation failed: ${u}`)}}catch(d){console.error("[SITEMAP] Generation error:",d),h(d.message||"Sitemap generation failed")}finally{C(!1)}}},[a]),B=i.useCallback(async()=>{if(!(!a||!g))try{const n=await x(`/api/sitemap/status?shop=${a}`);console.log("[SITEMAP] Status:",n),I(n.queue),(n.queue.status==="completed"||n.queue.status==="failed"||n.queue.status==="idle")&&(P(!1),h(n.queue.message||"Sitemap generation completed!"),await S())}catch(n){console.error("[SITEMAP] Status check error:",n)}},[a,g,x,S]);i.useEffect(()=>{if(g){const n=setInterval(B,3e3);return()=>clearInterval(n)}},[g,B]);const U=i.useCallback(async()=>{if(a){A(!0);try{const n=`/api/sitemap/generate?shop=${encodeURIComponent(a)}&force=true&t=${Date.now()}`,m=window.open(n,"_blank");setTimeout(()=>{A(!1)},2e3)}catch{A(!1),h("Failed to open sitemap")}}},[a]);return i.useEffect(()=>{S(),M()},[S,M]),e.jsxs($,{children:[e.jsx(o,{padding:"400",children:e.jsxs(p,{gap:"400",children:[e.jsx(T,{tone:"info",children:e.jsxs("p",{children:["Your ",(s==null?void 0:s.plan)||"Starter"," plan includes up to"," ",e.jsx("strong",{children:(s==null?void 0:s.plan)==="Starter"?"100 products in 1 language":(s==null?void 0:s.plan)==="Professional"?"250 products in up to 2 languages":(s==null?void 0:s.plan)==="Growth"?"700 products in up to 3 languages":(s==null?void 0:s.plan)==="Growth Extra"?"1,000 products in up to 6 languages":(s==null?void 0:s.plan)==="Enterprise"?"2,500 products in up to 10 languages":"100 products in 1 language"}),".",(c==null?void 0:c.productCount)&&c.productCount>((s==null?void 0:s.plan)==="Starter"?100:(s==null?void 0:s.plan)==="Professional"?250:(s==null?void 0:s.plan)==="Growth"?700:(s==null?void 0:s.plan)==="Growth Extra"?1e3:(s==null?void 0:s.plan)==="Enterprise"?2500:100)&&e.jsxs(e.Fragment,{children:[" You have ",c.productCount," products, so only the first"," ",(s==null?void 0:s.plan)==="Starter"?100:(s==null?void 0:s.plan)==="Professional"?250:(s==null?void 0:s.plan)==="Growth"?700:(s==null?void 0:s.plan)==="Growth Extra"?1e3:(s==null?void 0:s.plan)==="Enterprise"?2500:100," ","will be included in the sitemap."]})]})}),(g||r)&&e.jsx(T,{tone:(r==null?void 0:r.status)==="processing"?"info":(r==null?void 0:r.status)==="failed"?"critical":"success",children:e.jsxs(p,{gap:"200",children:[e.jsxs(l,{gap:"200",blockAlign:"center",children:[g&&e.jsx(W,{size:"small"}),e.jsx(t,{variant:"bodyMd",fontWeight:"medium",children:(r==null?void 0:r.message)||"Processing..."})]}),(r==null?void 0:r.position)>0&&e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Position in queue: ",r.position," | Estimated time: ~",r.estimatedTime,"s"]}),(r==null?void 0:r.queueLength)>0&&e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Queue length: ",r.queueLength," job(s)"]})]})}),e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs(o,{children:[e.jsx(t,{variant:"headingMd",as:"h3",children:"Sitemap Generator"}),e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Generate structured sitemap for AI models to discover and index your products"})]}),e.jsx(G,{primary:!0,onClick:R,loading:k,disabled:k,children:k?"Generating...":"Generate Sitemap"})]}),c&&e.jsx(o,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(p,{gap:"300",children:[e.jsx(l,{gap:"200",blockAlign:"center",children:c.generated?e.jsxs(e.Fragment,{children:[e.jsx(j,{source:f,tone:"success"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:"Sitemap Active"})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{source:z}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"No Sitemap Found"})]})}),c.generated&&e.jsxs(p,{gap:"400",children:[e.jsx(o,{children:e.jsxs(p,{gap:"200",children:[e.jsx(o,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(l,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Products included"}),e.jsxs(t,{variant:"bodyMd",fontWeight:"semibold",children:[c.lastProductCount||0," URLs"]})]})}),e.jsx(o,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(l,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"File size"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:c.size?`${(c.size/1024).toFixed(2)} KB`:"Unknown"})]})}),e.jsx(o,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(l,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Last updated"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:c.generatedAt?new Date(c.generatedAt).toLocaleString():"Unknown"})]})})]})}),e.jsx(o,{children:e.jsx(G,{fullWidth:!0,onClick:U,loading:v,disabled:v,icon:q,children:v?e.jsxs(l,{gap:"200",align:"center",children:[e.jsx(W,{size:"small"}),e.jsx(t,{children:"Loading sitemap..."})]}):"View Sitemap"})})]})]})}),e.jsxs(o,{paddingBlockStart:"400",children:[e.jsx(t,{variant:"headingMd",as:"h4",children:"What's included:"}),e.jsx(o,{paddingBlockStart:"200",children:e.jsxs(p,{gap:"200",children:[e.jsxs(l,{gap:"200",blockAlign:"start",children:[e.jsx(o,{minWidth:"24px",children:e.jsx(j,{source:f,tone:"positive"})}),e.jsx(t,{children:"All active products with structured URLs for AI parsing"})]}),e.jsxs(l,{gap:"200",blockAlign:"start",children:[e.jsx(o,{minWidth:"24px",children:e.jsx(j,{source:f,tone:"positive"})}),e.jsx(t,{children:"Priority rankings to help AI models understand product importance"})]}),e.jsxs(l,{gap:"200",blockAlign:"start",children:[e.jsx(o,{minWidth:"24px",children:e.jsx(j,{source:f,tone:"positive"})}),e.jsx(t,{children:"Multi-language URLs for international AI search coverage"})]}),e.jsxs(l,{gap:"200",blockAlign:"start",children:[e.jsx(o,{minWidth:"24px",children:e.jsx(j,{source:f,tone:"positive"})}),e.jsx(t,{children:"Standard XML format that AI crawlers understand"})]})]})})]}),e.jsxs(o,{paddingBlockStart:"200",children:[e.jsx(t,{variant:"headingMd",as:"h4",children:"How it helps AI models:"}),e.jsx(o,{paddingBlockStart:"200",children:e.jsxs(p,{gap:"200",children:[e.jsx(t,{children:'1. Click "Generate Sitemap" to create a structured map of your products'}),e.jsx(t,{children:"2. The sitemap is automatically saved and available to AI crawlers"}),e.jsx(t,{children:"3. AI models can discover and understand your product catalog structure"}),e.jsx(t,{children:"4. Regenerate when you add new products to keep AI models updated"})]})})]})]})}),E&&e.jsx(Q,{content:E,onDismiss:()=>h("")})]})}export{N as default};
