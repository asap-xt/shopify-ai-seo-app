import{j as e}from"./app-bridge-Dd3VNKom-1759469460032.js";import{r as a}from"./react-vendor-tAaa2TlE-1759469460032.js";import{u as Dt}from"./index-DD_mDVi3-1759469460032.js";import{U as Bt}from"./UpgradeModal-Dj_YoLKl-1759469460032.js";import{M as j,d as D,T as i,e as Ke,a as c,I as x,f as ye,B as L,D as Wt,g as V,C as Ne,h as Je,i as $t,S as Ut,P as be,j as we,R as Rt,k as Ft,l as Xe,m as Gt,E as Ht}from"./polaris-CJ3DkBZu-1759469460032.js";const qt=(S,h="")=>{try{return new URLSearchParams(window.location.search).get(S)||h}catch{return h}},re=S=>{if(!S)return S;const h=String(S).trim();return h.startsWith("gid://")?h:`gid://shopify/Product/${h}`},_t=S=>{if(!S)return"";const h=String(S).match(/\/(\d+)$/);return h?h[1]:S},R=S=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(S==null?void 0:S.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(S==null?void 0:S.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}};function Xt({shop:S}){const{api:h,shop:Ze}=Dt(),o=S||Ze||qt("shop","");a.useEffect(()=>{},[o,h]);const[k,H]=a.useState([]),[J,oe]=a.useState(!1),[et,Be]=a.useState(1),[tt,Ae]=a.useState(!0),[q,We]=a.useState(0),[m,X]=a.useState([]),[C,le]=a.useState(!1),[_,$e]=a.useState(""),[E,ce]=a.useState("all"),[z,Z]=a.useState(""),[de,Vt]=a.useState("createdAt"),[Q,st]=a.useState("desc"),[B,ue]=a.useState([]),[nt,at]=a.useState([]),[Ue,Pe]=a.useState(!1),[Re,ve]=a.useState(!1),[Fe,Ce]=a.useState(!1),[Ge,Ie]=a.useState(!1),[it,rt]=a.useState(""),[ot,lt]=a.useState([]),[F,he]=a.useState([]),[O,He]=a.useState([]),[ke,Y]=a.useState(!1),[pe,$]=a.useState({current:0,total:0,percent:0}),[qe,K]=a.useState(""),[ge,ee]=a.useState([]),[te,_e]=a.useState({}),[ct,Le]=a.useState(!1),[dt,me]=a.useState(!1),[ut,se]=a.useState(!1),[U,ne]=a.useState([]),[ht,fe]=a.useState(!1),[Ve,y]=a.useState(""),[ze,Oe]=a.useState(!1),[b,ae]=a.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[A,pt]=a.useState(null),[gt,xe]=a.useState(!1),[Se,mt]=a.useState(localStorage.getItem("hasVisitedProducts")==="true"),[ft,Me]=a.useState(!1),[xt,St]=a.useState("starter");a.useEffect(()=>{if(!o)return;h("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          modelsSuggested
        }
      }
    `,variables:{shop:o}})}).then(s=>{var u,l,r;if((u=s==null?void 0:s.errors)!=null&&u.length)throw new Error(((l=s.errors[0])==null?void 0:l.message)||"GraphQL error");const n=(r=s==null?void 0:s.data)==null?void 0:r.plansMe,p=(n==null?void 0:n.modelsSuggested)||["anthropic/claude-3.5-sonnet"];lt(p.map(d=>({label:d,value:d}))),rt(p[0]),pt((n==null?void 0:n.plan)||"starter")}).catch(s=>console.error("[BULK-EDIT] GraphQL plansMe failed:",s))},[o,h]),a.useEffect(()=>{if(!o)return;const t=new Promise((s,n)=>{setTimeout(()=>n(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([h(`/api/languages/shop/${o}`),t]).then(s=>{const n=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];He(n.includes("en")?n:["en",...n])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),He(["en"])})},[o,h]),a.useEffect(()=>{o&&h("/api/products/tags/list",{shop:o}).then(t=>at((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[o,h]);const G=a.useCallback(async(t=1,s=!1,n=null)=>{var p,u,l;oe(!0);try{const r=new URLSearchParams({shop:o,page:t,limit:50,...E!=="all"&&{optimized:E},..._&&{search:_},...z&&{languageFilter:z},...B.length>0&&{tags:B.join(",")},sortBy:de,sortOrder:Q,...n&&{_t:n}}),d=await h(`/api/products/list?${r}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((p=d.products)==null?void 0:p.length)>0,H(s?f=>[...f,...d.products]:d.products||[]),Be(t),Ae(((u=d.pagination)==null?void 0:u.hasNext)||!1),We(((l=d.pagination)==null?void 0:l.total)||0)}catch(r){H(s?k:[]),Ae(!1),y(`Error loading products: ${r.message}`)}finally{oe(!1)}},[o,E,_,z,B,de,Q]);a.useEffect(()=>{o&&G(1,!1,null)},[o,G,E,z,B,de,Q]),a.useEffect(()=>{!Se&&o&&(localStorage.setItem("hasVisitedProducts","true"),mt(!0))},[Se,o]),a.useEffect(()=>{k.length===0&&!J&&o&&!Se&&xe(!0)},[k.length,J,o,Se]);const Qe=a.useCallback(t=>{$e(t)},[]);a.useEffect(()=>{const t=setTimeout(()=>{o&&G(1,!1,null)},500);return()=>clearTimeout(t)},[_]);const jt=a.useCallback(t=>{X(t),t.length===0&&le(!1)},[]),Ye=a.useCallback(t=>{le(t),X(t?k.map(s=>s.id):[])},[k]),yt=()=>{if(m.length===0&&!C){y("Please select products first");return}me(!0)},bt=()=>{if(m.length===0&&!C){y("Please select products first");return}ne([]),se(!0)},wt=()=>{const s=k.filter(u=>m.includes(u.id)).filter(u=>{var l,r;return((r=(l=u.optimizationSummary)==null?void 0:l.optimizedLanguages)==null?void 0:r.length)>0}),n=async()=>{if(A&&!["Growth Extra","Enterprise"].includes(A)){St(A),Oe(!1),Me(!0);return}ae({processing:!0,current:0,total:s.length,currentItem:"",results:null});const u={successful:0,failed:0,skipped:0,skippedDueToPlan:0};for(let l=0;l<s.length;l++){const r=s[l];ae(d=>({...d,current:l,currentItem:r.title}));try{if(!(await h("/ai-enhance/check-eligibility",{method:"POST",shop:o,body:{shop:o}})).eligible){u.skipped++,u.skippedDueToPlan++;continue}const f=await h("/ai-enhance/product",{method:"POST",shop:o,body:{shop:o,productId:r.gid||re(r.id),languages:r.optimizationSummary.optimizedLanguages}});if(f.results&&f.results.length>0){const I={shop:o,productId:r.gid||re(r.id),results:f.results.filter(P=>P.bullets&&P.faq).map(P=>({language:P.language,seo:{...P.updatedSeo,bullets:P.bullets||[],faq:P.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},M=await h("/api/seo/apply-multi",{method:"POST",shop:o,body:I});u.successful++}else u.failed++}catch(d){console.error("Enhancement error:",d),u.failed++}ae(d=>({...d,current:l+1}))}ae(l=>({...l,processing:!1,results:u})),y(`AI enhancement complete! ${u.successful} products enhanced.`)},p=()=>{Oe(!1),ae({processing:!1,current:0,total:0,currentItem:"",results:null}),b.results&&b.results.successful>0&&G(1,!1,null)};return!b.processing&&!b.results?e.jsx(j,{open:ze,title:"AI Enhanced add-ons for AI Search",onClose:p,primaryAction:{content:"Start AI Enhancement",onAction:n},secondaryActions:[{content:"Cancel",onAction:p}],children:e.jsx(j.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsxs(i,{variant:"bodyMd",children:["AI enhancement will improve bullets and FAQ for ",s.length," products."]}),e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Note: AI enhancement is only available for Growth Extra and Enterprise plans."})]})})}):b.processing?e.jsx(j,{open:ze,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(j.Section,{children:e.jsxs(D,{gap:"400",children:[e.jsxs(i,{variant:"bodyMd",children:["Processing: ",b.currentItem]}),e.jsx(Ke,{progress:b.current/b.total*100}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[b.current," of ",b.total," products (",Math.round(b.current/b.total*100),"%)"]})]})})}):b.results!==null?e.jsx(j,{open:ze,title:"AI Enhancement Results",onClose:p,primaryAction:{content:"Done",onAction:p},children:e.jsx(j.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsxs(x,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"success",children:b.results.successful})]}),e.jsxs(c,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:b.results.failed})]}),e.jsxs(c,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"info",children:b.results.skipped})]})]}),b.results.skippedDueToPlan>0&&e.jsx(c,{paddingBlockStart:"300",children:e.jsx(i,{variant:"bodySm",tone:"subdued",children:"AI enhancement is only available for Growth Extra and Enterprise plans."})})]})})}):null},At=async()=>{var s;if(!F.length){y("Please select at least one language");return}let t=it;(!t||!t.trim())&&(t=((s=ot[0])==null?void 0:s.value)||"anthropic/claude-3.5-sonnet"),me(!1),Y(!0),$({current:0,total:0,percent:0}),ee([]),_e({});try{let n=[];C?n=(await h(`/api/products/list?shop=${encodeURIComponent(o)}&limit=1000&fields=id`)).products||[]:n=k.filter(g=>m.includes(g.id));const p=R(A),u=n.length;n=n.slice(0,p);const l=n.length,r=u-l;$({current:0,total:l,percent:0});const d=5,f={};for(let g=0;g<n.length;g+=d){const w=n.slice(g,Math.min(g+d,n.length)).map(async v=>{var N;K(v.title||v.handle||"Product");try{const je=v.gid||re(v.productId||v.id),Te=((N=v.optimizationSummary)==null?void 0:N.optimizedLanguages)||[],De=F.filter(Tt=>!Te.includes(Tt));if(De.length===0){f[v.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Et=await h("/api/seo/generate-multi",{method:"POST",shop:o,body:{shop:o,productId:je,model:t,languages:De}});f[v.id]={success:!0,data:Et,languages:De}}catch(je){f[v.id]={success:!1,error:je.message},ee(Te=>[...Te,{product:v.title,error:je.message}])}});await Promise.all(w);const T=Math.min(g+d,n.length),ie=Math.round(T/l*100);$({current:T,total:l,percent:ie})}_e(f),Le(!0);const I=Object.keys(f).filter(g=>f[g].success&&!f[g].skipped).length,M=Object.keys(f).filter(g=>f[g].skipped).length;let P=`Generated Optimization for AI Search for ${I} products`;M>0&&(P+=` (${M} already optimised)`),r>0&&(P+=` (${r} skipped due to plan limit)`),y(P)}catch(n){y(`Error: ${n.message}`)}finally{Y(!1),K("")}},Pt=async()=>{var t,s;Y(!0),$({current:0,total:0,percent:0});try{const n=Object.entries(te).filter(([r,d])=>d.success&&!d.skipped),p=n.length;$({current:0,total:p,percent:0});for(let r=0;r<n.length;r++){const[d,f]=n[r],I=k.find(g=>g.id===d);if(!I)continue;K(I.title||"Product");try{const g=I.gid||re(I.productId||I.id),W=await h("/api/seo/apply-multi",{method:"POST",shop:o,body:{shop:o,productId:g,results:f.data.results.filter(w=>w==null?void 0:w.seo).map(w=>({language:w.language,seo:w.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});W.appliedLanguages&&W.appliedLanguages.length>0&&H(w=>w.map(T=>{var ie;if(T.id===d){const v=((ie=T.optimizationSummary)==null?void 0:ie.optimizedLanguages)||[],N=[...new Set([...v,...W.appliedLanguages])];return{...T,optimizationSummary:{...T.optimizationSummary,optimizedLanguages:N,optimized:!0,lastOptimized:new Date().toISOString()}}}return T}))}catch(g){ee(W=>[...W,{product:I.title,error:`Apply failed: ${g.message}`}])}const M=r+1,P=Math.round(M/p*100);$({current:M,total:p,percent:P})}y("AI Search Optimisation applied successfully!"),Le(!1),X([]),le(!1),await new Promise(r=>setTimeout(r,1e3)),H([]);const u=new URLSearchParams({shop:o,page:1,limit:50,...E!=="all"&&{optimized:E},..._&&{search:_},...z&&{languageFilter:z},...B.length>0&&{tags:B.join(",")},sortBy:de,sortOrder:Q,_t:Date.now()}),l=await h(`/api/products/list?${u}`,{shop:o,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});H(l.products||[]),Be(1),Ae(((t=l.pagination)==null?void 0:t.hasNext)||!1),We(((s=l.pagination)==null?void 0:s.total)||0)}catch(n){y(`Error applying AI Search Optimisation: ${n.message}`)}finally{Y(!1),K("")}},vt=async()=>{var t;if(!U.length){y("Please select at least one language to delete");return}se(!1),fe(!1),Y(!0),$({current:0,total:0,percent:0}),ee([]);try{let s=[];C?s=(await h(`/api/products/list?shop=${encodeURIComponent(o)}&limit=1000&fields=id`)).products||[]:s=k.filter(l=>m.includes(l.id));const n=s.length;$({current:0,total:n,percent:0});let p=0,u=0;for(let l=0;l<s.length;l++){const r=s[l];K(r.title||r.handle||"Product");try{const I=r.gid||re(r.productId||r.id),M=((t=r.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],P=U.filter(W=>M&&M.length>0&&M.includes(W));if(P.length===0){u++;continue}const g=await h("/api/seo/delete-multi",{method:"POST",shop:o,body:{shop:o,productId:I,languages:P}});g.deletedLanguages&&g.deletedLanguages.length>0&&H(W=>W.map(w=>{var T;if(w.id===r.id){const v=(((T=w.optimizationSummary)==null?void 0:T.optimizedLanguages)||[]).filter(N=>!g.deletedLanguages.includes(N));return{...w,optimizationSummary:{...w.optimizationSummary,optimizedLanguages:v,optimized:v.length>0,lastOptimized:v.length>0?w.optimizationSummary.lastOptimized:null}}}return w})),p++,g.deletedLanguages&&g.deletedLanguages.length>0&&await h("/api/products/verify-after-delete",{method:"POST",shop:o,body:{shop:o,productIds:[I],deletedLanguages:g.deletedLanguages}})}catch(I){ee(M=>[...M,{product:r.title,error:I.message}])}const d=l+1,f=Math.round(d/n*100);$({current:d,total:n,percent:f})}X([]),le(!1),u>0?y(`Deleted Optimization for AI Search from ${p} products (${u} had no optimisation to delete)`):y(`Deleted Optimization for AI Search from ${p} products`),setTimeout(()=>{const l=Date.now();G(1,!1,l)},500)}catch(s){y(`Error: ${s.message}`)}finally{Y(!1),K("")}},Ct=t=>{var l,r;const s=t,n=_t(s.productId||s.id),p=((l=s.optimizationSummary)==null?void 0:l.optimizedLanguages)||[],u=(r=s.images)!=null&&r[0]?e.jsx(Xe,{source:s.images[0].url||s.images[0].src||s.images[0],alt:s.title,size:"small"}):s.imageUrl?e.jsx(Xe,{source:s.imageUrl,alt:s.title,size:"small"}):e.jsx(c,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Gt,{id:s.id,url:"",media:u,accessibilityLabel:`View details for ${s.title}`,children:e.jsxs(x,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(c,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:s.title}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["ID: ",n]})]}),e.jsx(c,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(x,{gap:"100",children:O.length>0?O.map(d=>{const f=p.includes(d);return e.jsx(V,{tone:f?"success":"subdued",size:"small",children:d.toUpperCase()},d)}):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),p.map(d=>e.jsx(V,{tone:"success",size:"small",children:d.toUpperCase()},d)))})}),e.jsx(c,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(V,{tone:"success",children:"Active"})})]})})},It=ke&&e.jsx(j,{open:ke,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(j.Section,{children:e.jsxs(D,{gap:"400",children:[e.jsx(i,{variant:"bodyMd",children:qe?`Processing: ${qe}`:"Preparing..."}),e.jsx(Ke,{progress:pe.percent}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[pe.current," of ",pe.total," products (",pe.percent,"%)"]})]})})}),kt=e.jsx(j,{open:dt,title:"Select Languages",onClose:()=>{me(!1),he([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:At,disabled:F.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{me(!1),he([])}}],children:e.jsx(j.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsxs(i,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",C?"all":m.length," selected products:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(x,{gap:"200",wrap:!0,children:O.map(t=>e.jsx(ye,{label:t.toUpperCase(),checked:F.includes(t),onChange:s=>{he(s?[...F,t]:F.filter(n=>n!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(L,{plain:!0,onClick:()=>{he(F.length===O.length?[]:[...O])},children:F.length===O.length?"Deselect all":"Select all"})}),e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Lt=e.jsx(j,{open:ct&&!ke,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:Pt,disabled:!Object.values(te).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Le(!1)}],children:e.jsx(j.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsxs(x,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(te).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(te).filter(t=>t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(te).filter(t=>!t.success).length})]})]}),ge.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Wt,{}),e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(c,{maxHeight:"200px",overflowY:"scroll",children:[ge.slice(0,10).map((t,s)=>e.jsxs(i,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),ge.length>10&&e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["... and ",ge.length-10," more errors"]})]})]})]})})}),zt=e.jsx(j,{open:ut,title:"Delete Optimization for AI Search",onClose:()=>{se(!1),ne([])},primaryAction:{content:"Continue",onAction:()=>{se(!1),fe(!0)},disabled:U.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{se(!1),ne([])}}],children:e.jsx(j.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsxs(i,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",C?"all":m.length," selected products:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(x,{gap:"200",wrap:!0,children:O.map(t=>e.jsx(ye,{label:t.toUpperCase(),checked:U.includes(t),onChange:s=>{ne(s?[...U,t]:U.filter(n=>n!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(L,{plain:!0,onClick:()=>{ne(U.length===O.length?[]:[...O])},children:U.length===O.length?"Deselect all":"Select all"})}),e.jsx(i,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Ot=e.jsx(j,{open:ht,title:"Confirm Deletion",onClose:()=>{fe(!1)},primaryAction:{content:"Delete",onAction:vt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>fe(!1)}],children:e.jsx(j.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsx(i,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(c,{paddingBlock:"200",children:e.jsx(x,{gap:"100",children:U.map(t=>e.jsx(V,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(i,{variant:"bodyMd",children:["This will delete optimisation from ",C?"ALL":m.length," selected products."]}),e.jsx(i,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Ee=async()=>{try{oe(!0),y("Syncing products from Shopify...");const t=await h("/api/products/sync",{method:"POST",shop:o});if(t.success){const s=t.productsCount||t.synced||0;y(`✅ Synced ${s} products successfully!`),setTimeout(()=>{G(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),y(`❌ Sync failed: ${t.message}`)}finally{oe(!1)}},Mt=e.jsx(Ht,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{$e(""),ce("all"),Z(""),ue([]),G(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Ee},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{children:e.jsxs(c,{padding:"400",children:[e.jsxs(D,{gap:"300",children:[A&&e.jsx(Je,{tone:"info",children:e.jsxs(x,{gap:"200",align:"space-between",children:[e.jsxs(i,{children:["Your ",e.jsx("strong",{children:A})," plan includes up to"," ",e.jsx("strong",{children:R(A)})," products for SEO optimization.",q>R(A)&&e.jsxs(e.Fragment,{children:[" You have ",q," products, so only the first ",R(A)," will be processed."]})]}),(m.length>0||C)&&e.jsxs(i,{children:["Selected: ",C?Math.min(q,R(A)):m.length,"/",R(A)]})]})}),A&&(m.length>R(A)||C&&q>R(A))&&e.jsx(Je,{tone:"warning",children:e.jsxs(x,{gap:"200",align:"space-between",children:[e.jsxs(i,{children:[e.jsx("strong",{children:"Plan Limit Exceeded:"})," You've selected more products than your ",A," plan allows. Only the first ",R(A)," products will be processed."]}),e.jsx(L,{size:"micro",onClick:()=>Me(!0),children:"Upgrade Plan"})]})}),e.jsxs(x,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(c,{minWidth:"400px",children:e.jsx($t,{label:"",placeholder:"Search by product ID, name, or details...",value:_,onChange:Qe,prefix:e.jsx(Ut,{}),clearButton:!0,onClearButtonClick:()=>Qe("")})}),e.jsx(c,{width:"320px",children:e.jsx(L,{primary:!0,onClick:yt,disabled:m.length===0&&!C,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(x,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(L,{onClick:Ee,disabled:J,size:"medium",children:"Sync Products"}),e.jsx(c,{width:"320px",children:e.jsxs(D,{gap:"200",align:"end",children:[m.length===0&&!C||!k.filter(n=>m.includes(n.id)).some(n=>{var p,u;return((u=(p=n.optimizationSummary)==null?void 0:p.optimizedLanguages)==null?void 0:u.length)>0})?null:e.jsx(L,{onClick:()=>Oe(!0),disabled:m.length===0&&!C,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(L,{onClick:bt,disabled:m.length===0&&!C||!k.filter(n=>m.includes(n.id)).some(n=>{var p,u;return((u=(p=n.optimizationSummary)==null?void 0:p.optimizedLanguages)==null?void 0:u.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),q>0&&e.jsx(c,{paddingBlockStart:"300",children:e.jsx(ye,{label:`Select all ${q} products in your store`,checked:C,onChange:Ye})})]})}),e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(Ne,{children:[e.jsxs(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(x,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(x,{gap:"200",wrap:!0,children:[e.jsx(be,{active:Ue,activator:e.jsx(L,{disclosure:"down",onClick:()=>Pe(!Ue),removeUnderline:!0,children:e.jsxs(x,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),E!=="all"&&e.jsx(c,{onClick:t=>{t.stopPropagation(),ce("all")},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Pe(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(we,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[E],onChange:t=>{ce(t[0]),Z(""),Pe(!1)}})})}),e.jsx(be,{active:Re,activator:e.jsx(L,{disclosure:"down",onClick:()=>ve(!Re),removeUnderline:!0,children:e.jsxs(x,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),z&&e.jsx(c,{onClick:t=>{t.stopPropagation(),Z("")},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ve(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(we,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...O.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...O.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:z?[z]:[],onChange:t=>{Z(t[0]||""),ve(!1)}})})}),e.jsx(be,{active:Fe,activator:e.jsx(L,{disclosure:"down",onClick:()=>Ce(!Fe),removeUnderline:!0,children:e.jsxs(x,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),B.length>0&&e.jsx(c,{onClick:t=>{t.stopPropagation(),ue([])},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Ce(!1),children:e.jsxs(c,{padding:"300",minWidth:"200px",children:[e.jsx(we,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:nt.map(t=>({label:t,value:t})),selected:B,onChange:t=>{ue(t)}}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(L,{size:"slim",onClick:()=>Ce(!1),children:"Apply"})})]})})]}),e.jsx(be,{active:Ge,activator:e.jsx(L,{disclosure:"down",onClick:()=>Ie(!Ge),removeUnderline:!0,children:e.jsx(x,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:Q==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Ie(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(we,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[Q],onChange:t=>{st(t[0]),Ie(!1)}})})})]}),(E!=="all"||z||B.length>0)&&e.jsx(c,{paddingBlockStart:"200",children:e.jsxs(x,{gap:"100",wrap:!0,children:[E!=="all"&&e.jsx(V,{onRemove:()=>ce("all"),children:E==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),z&&e.jsx(V,{onRemove:()=>Z(""),children:z.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),B.map(t=>e.jsxs(V,{onRemove:()=>ue(s=>s.filter(n=>n!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(c,{children:[e.jsx(c,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(x,{gap:"200",align:"start",children:[e.jsx(ye,{checked:m.length===k.length&&k.length>0,onChange:Ye,label:""}),e.jsxs(i,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",m.length>0&&` (${m.length} selected products)`]})]})}),e.jsx(Rt,{resourceName:{singular:"product",plural:"products"},items:k,renderItem:Ct,selectedItems:m,onSelectionChange:jt,selectable:!0,loading:J,totalItemsCount:q,emptyState:Mt,showHeader:!1})]}),tt&&!J&&e.jsx(c,{padding:"400",textAlign:"center",children:e.jsx(L,{onClick:()=>G(et+1,!0,null),children:"Load more"})})]})}),It,kt,Lt,zt,Ot,wt(),e.jsx(j,{open:gt,onClose:()=>xe(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{xe(!1),Ee()}},secondaryActions:[{content:"Skip for now",onAction:()=>xe(!1)}],children:e.jsx(j.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsx(i,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(i,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Bt,{open:ft,onClose:()=>Me(!1),featureName:"AI Enhancement",currentPlan:xt}),Ve&&e.jsx(Ft,{content:Ve,onDismiss:()=>y("")})]})}export{Xt as default};
