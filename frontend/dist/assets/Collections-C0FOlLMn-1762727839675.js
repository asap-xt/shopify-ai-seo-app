import{j as e}from"./app-bridge-HcLXILnp-1762727839675.js";import{r as o}from"./react-vendor-tAaa2TlE-1762727839675.js";import{m as At}from"./sessionFetch-CJepNHo3-1762727839675.js";import{S as vt,U as It}from"./StoreMetadataBanner-B2bi0Ssv-1762727839675.js";import{I as Tt}from"./InsufficientTokensModal-CVLt-zyV-1762727839675.js";import{M as m,a as A,T as i,e as me,d as Mt,b as v,B as c,I as E,g as Fe,D as kt,f as ee,C as Ke,h as Pt,S as Dt,i as _e,j as He,R as Nt,k as zt,m as $t,E as Bt}from"./polaris-r7WU2i5Y-1762727839675.js";const Rt=(_,x="")=>{try{return new URLSearchParams(window.location.search).get(_)||x}catch{return x}};function hs({shop:_,globalPlan:x}){var Be,Re,Ue;const u=_||Rt("shop","");console.log("[COLLECTIONS] Component initialized with shop:",u,"shopProp:",_);const w=o.useMemo(()=>At(),[]),[p,Se]=o.useState([]),[xe,Ce]=o.useState(!1),[H,qe]=o.useState(0),[h,q]=o.useState([]),[y,te]=o.useState(!1),[Ut,Wt]=o.useState(""),[z,ae]=o.useState(""),[I,se]=o.useState("all"),[Ft,Kt]=o.useState(""),[_t,Ht]=o.useState([]),[qt,Gt]=o.useState([]),[je,re]=o.useState(!1),[Jt,Qt]=o.useState(!1),[Yt,Zt]=o.useState(!1),[Ee,ie]=o.useState(!1),[T,Ge]=o.useState("updatedAt"),[M,Je]=o.useState("desc"),[Qe,Ye]=o.useState(""),[Vt,Ze]=o.useState([]),[O,W]=o.useState([]),[b,ye]=o.useState([]),[ce,G]=o.useState(!1),[k,$]=o.useState({current:0,total:0,percent:0}),[Le,J]=o.useState(""),[Q,we]=o.useState([]),[Xt,es]=o.useState(!1),[ts,ss]=o.useState(null),[ns,os]=o.useState(!1),[ls,Ve]=o.useState(""),[Xe,ne]=o.useState(!1),[F,K]=o.useState([]),[Oe,be]=o.useState(!1),[et,Y]=o.useState(!1),[Ae,ve]=o.useState(!1),[tt,oe]=o.useState(!1),[Ie,le]=o.useState([]),[B,de]=o.useState({}),[st,ue]=o.useState(!1),[nt,ge]=o.useState(!1),[Te,as]=o.useState({}),[ot,he]=o.useState(!1),[Me,pe]=o.useState(null),[lt,ke]=o.useState(!1),[Pe,f]=o.useState(""),[De,Ne]=o.useState(!1),[at,Z]=o.useState(!1),[rt,ze]=o.useState(!1),[S,V]=o.useState(null),[P,X]=o.useState("starter"),[D,fe]=o.useState(1);o.useEffect(()=>{if(!(!x||typeof x!="object")){if(x.planKey&&x.planKey!==""){X(x.planKey);const s={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[x.planKey.toLowerCase()]||1;fe(s)}else if(x.plan&&x.plan!==""){const t=x.plan.toLowerCase().replace(/\s+/g,"-");X(t);const n={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[t]||1;fe(n)}}},[x]);const[C,R]=o.useState({processing:!1,current:0,total:0,currentItem:"",results:null});o.useEffect(()=>{if(!u)return;w("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
        }
      }
    `,variables:{shop:u}})}).then(s=>{var d,g,U;if((d=s==null?void 0:s.errors)!=null&&d.length)throw new Error(((g=s.errors[0])==null?void 0:g.message)||"GraphQL error");const n=(U=s==null?void 0:s.data)==null?void 0:U.plansMe,a=(n==null?void 0:n.modelsSuggested)||["google/gemini-1.5-flash"];Ze(a.map(j=>({label:j,value:j}))),Ye(a[0]),X((n==null?void 0:n.planKey)||"starter");const r=((n==null?void 0:n.planKey)||"starter").toLowerCase();fe({starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[r]||1)}).catch(s=>f(`Error loading models: ${s.message}`))},[u,w]),o.useEffect(()=>{u&&(console.log("[COLLECTIONS] Loading languages for shop:",u),w(`/api/languages/shop/${u}?shop=${u}`).then(t=>{console.log("[COLLECTIONS] Languages API data:",t);const s=(t==null?void 0:t.shopLanguages)||["en"];console.log("[COLLECTIONS] Extracted languages:",s),ye(s),W([])}).catch(t=>{console.error("[COLLECTIONS] Languages API error:",t),ye(["en"]),W([])}))},[u,w]);const it=async()=>{try{ve(!0),console.log("[COLLECTIONS] Starting collections sync...");const t=await w(`/api/collections/sync?shop=${u}`,{method:"POST"});t!=null&&t.success?(console.log("[COLLECTIONS] Sync successful:",t),f("Collections synced successfully!"),await N()):(console.error("[COLLECTIONS] Sync failed:",t),f("Failed to sync collections"))}catch(t){console.error("[COLLECTIONS] Sync error:",t),f("Error syncing collections")}finally{ve(!1)}},N=o.useCallback(async()=>{var t;Ce(!0);try{console.log("[COLLECTIONS] Shop value:",u),console.log("[COLLECTIONS] Shop prop:",_),console.log("[COLLECTIONS] URL search params:",window.location.search);const n=`/collections/list-graphql?${new URLSearchParams({shop:u,...z&&{search:z},...I!=="all"&&{optimized:I},sortBy:T,sortOrder:M})}`;console.log("[COLLECTIONS] Using GraphQL endpoint:",n);const a=await w(n);console.log("[COLLECTIONS] API Response data:",a),((t=a==null?void 0:a.collections)==null?void 0:t.length)>0&&(console.log("[COLLECTIONS] First collection optimizedLanguages:",a.collections[0].optimizedLanguages),console.log("[COLLECTIONS] First collection full data:",a.collections[0]));let r=a.collections||[];if(z){const l=z.toLowerCase();r=r.filter(d=>d.title.toLowerCase().includes(l)||d.handle.toLowerCase().includes(l))}I!=="all"&&(r=r.filter(l=>I==="true"?l.hasSeoData:!l.hasSeoData)),Se(r),qe(r.length)}catch(s){f(`Error loading collections: ${s.message}`)}finally{Ce(!1)}},[u,z,I,T,M,w]);o.useEffect(()=>{u&&(N(),Y(!1))},[u,I,T,M,N]),o.useEffect(()=>{const t=setTimeout(()=>{u&&N()},500);return()=>clearTimeout(t)},[z]);const ct=o.useCallback(t=>{q(t);const s=t.some(n=>{const a=p.find(r=>r.id===n);return a==null?void 0:a.hasSeoData});Y(s),t.length===0&&te(!1)},[p]),dt=o.useCallback(t=>{if(te(t),t){q(p.map(n=>n.id));const s=p.some(n=>n.hasSeoData);Y(s)}else q([]),Y(!1)},[p]),ut=async t=>{ke(!0);try{const s=`/collections/${t.split("/").pop()}/seo-data?shop=${encodeURIComponent(u)}`,n=await w(s);pe(n),he(!0)}catch(s){f((s==null?void 0:s.status)===404?"No SEO data found for this collection":"Failed to load SEO data")}finally{ke(!1)}},$e=o.useMemo(()=>{var s;if(y)return O.length>D;const t=p.filter(n=>h.includes(n.id));if(t.length===0)return O.length>D;for(const n of t){const a=((s=n.optimizationSummary)==null?void 0:s.optimizedLanguages)||[],r=O.filter(d=>!a.includes(d));if(a.length+r.length>D)return!0}return!1},[p,h,y,D,O]),gt=()=>{if(h.length===0&&!y){f("Please select collections first");return}ge(!0)},ht=async()=>{console.log("[AI-ENHANCE] Starting enhancement...");const s=p.filter(a=>h.includes(a.id)).filter(a=>{var r;return((r=a.optimizedLanguages)==null?void 0:r.length)>0});if(s.length===0){f("Please select collections with Basic SEO optimization");return}console.log("[AI-ENHANCE] Collections to enhance:",s.length),Ne(!0),R({processing:!0,current:0,total:s.length,currentItem:"",results:null});const n={successful:0,failed:0,skipped:0};for(let a=0;a<s.length;a++){const r=s[a];R(l=>({...l,current:a,currentItem:r.title}));try{const l=r.optimizedLanguages||[];if(l.length===0){console.log(`[AI-ENHANCE] No languages for ${r.title}, skipping`),n.skipped++;continue}console.log(`[AI-ENHANCE] Enhancing ${r.title} for languages:`,l);const d=await w(`/ai-enhance/collection/${encodeURIComponent(r.id)}`,{method:"POST",shop:u,body:{shop:u,languages:l}});d&&d.ok?(n.successful++,console.log(`[AI-ENHANCE] Success for ${r.title}`)):(n.failed++,console.log(`[AI-ENHANCE] Failed for ${r.title}`))}catch(l){if(console.error("[AI-ENHANCE] Error:",l),l.status===403){R({processing:!1,current:0,total:0,currentItem:"",results:null}),V(l),X(l.currentPlan||P||"starter"),Z(!0);return}if(l.status===402||l.requiresPurchase||l.trialRestriction){R({processing:!1,current:0,total:0,currentItem:"",results:null}),V(l),X(l.currentPlan||P||"starter"),l.trialRestriction?Z(!0):ze(!0);return}n.failed++}R(l=>({...l,current:a+1}))}R(a=>({...a,processing:!1,results:n})),f(`AI enhancement complete! ${n.successful} collections enhanced.`)},pt=()=>{p.filter(n=>h.includes(n.id)).filter(n=>{var a;return((a=n.optimizedLanguages)==null?void 0:a.length)>0});const s=()=>{const n=C.results;console.log("[COLLECTIONS-CLOSE] handleClose called, results:",n),Ne(!1),R({processing:!1,current:0,total:0,currentItem:"",results:null}),n&&n.successful>0?(console.log("[COLLECTIONS-CLOSE] Scheduling refresh in 1.5s..."),setTimeout(()=>{console.log("[COLLECTIONS-CLOSE] Executing refresh now!"),Se([]),N()},1500)):console.log("[COLLECTIONS-CLOSE] Skipping refresh, no successful results")};return C.processing?e.jsx(m,{open:De,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(m.Section,{children:e.jsxs(A,{gap:"400",children:[e.jsxs(i,{variant:"bodyMd",children:["Processing: ",C.currentItem]}),e.jsx(me,{progress:C.current/C.total*100}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[C.current," of ",C.total," collections (",Math.round(C.current/C.total*100),"%)"]})]})})}):C.results!==null?e.jsx(m,{open:De,title:"AI Enhancement Results",onClose:s,primaryAction:{content:"Done",onAction:s},children:e.jsx(m.Section,{children:e.jsx(A,{gap:"300",children:e.jsxs(E,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"success",children:C.results.successful})]}),e.jsxs(c,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:C.results.failed})]}),e.jsxs(c,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"info",children:C.results.skipped})]})]})})})}):null},ft=async()=>{var t;if(!O.length){f("Please select at least one language");return}ge(!1),G(!0),$({current:0,total:0,percent:0}),we([]),de({});try{const s=y?p:p.filter(l=>h.includes(l.id)),n=s.length;$({current:0,total:n,percent:0});const a={};for(let l=0;l<s.length;l++){const d=s[l];J(d.title);try{const j=await w("/seo/generate-collection-multi",{method:"POST",shop:u,body:JSON.stringify({shop:u,collectionId:d.id,model:Qe,languages:O})});a[d.id]={success:!0,data:j}}catch(j){if(j.status===403||(t=j.message)!=null&&t.includes("requires Professional plan")){G(!1),J(""),V({error:j.message||"Collections SEO requires Professional plan or higher",currentPlan:j.currentPlan||P||"starter",upgradeMessage:j.upgradeMessage||"Upgrade to Professional plan to optimize collections for AI search"}),Z(!0);return}a[d.id]={success:!1,error:j.message},we(L=>[...L,{collection:d.title,error:j.message}])}const g=l+1,U=Math.round(g/n*100);$({current:g,total:n,percent:U})}de(a),ue(!0);const r=Object.values(a).filter(l=>l.success).length;f(`Generated optimization for ${r} collections`)}catch(s){f(`Error: ${s.message}`)}finally{G(!1),J("")}},mt=async()=>{var t,s;G(!0),$({current:0,total:0,percent:0});try{const n=Object.entries(B).filter(([r,l])=>l.success),a=n.length;$({current:0,total:a,percent:0});for(let r=0;r<n.length;r++){const[l,d]=n[r],g=p.find(L=>L.id===l);if(!g)continue;J(g.title);try{if(console.log("Applying SEO for collection:",l),console.log("Result data:",d.data),console.log("Results array:",(t=d.data)==null?void 0:t.results),!((s=d.data)!=null&&s.results)||!Array.isArray(d.data.results))throw new Error("Invalid results structure");const L=await w("/seo/apply-collection-multi",{method:"POST",shop:u,body:{shop:u,collectionId:l,results:d.data.results.map(We=>({language:We.language,seo:We.data})),options:{updateTitle:!0,updateDescription:!0,updateSeo:!0,updateMetafields:!0}}});if(!(L!=null&&L.ok))throw new Error((L==null?void 0:L.error)||"Apply failed")}catch(L){console.error("Apply error for collection:",l,L),Q.push({id:g.id,title:g.title,message:L.message})}const U=r+1,j=Math.round(U/a*100);$({current:U,total:a,percent:j})}f("Optimization applied successfully!"),ue(!1),de({}),q([]),await N(),te(!1)}catch(n){f(`Error applying optimization: ${n.message}`)}finally{G(!1),J("")}},St=async(t=[])=>{console.log("[DELETE-SEO-BULK] ===== BULK DELETE START ====="),console.log("[DELETE-SEO-BULK] Languages to delete:",t),console.log("[DELETE-SEO-BULK] Selected items:",h),console.log("[DELETE-SEO-BULK] Select all pages:",y),be(!0),Ve("");try{const s=y?p:p.filter(l=>h.includes(l.id)),n=s.length*t.length;let a=0;const r=[];for(const l of s)for(const d of t)try{console.log(`[DELETE-SEO-BULK] Deleting ${d} for ${l.title} (${l.id})`);const g=await w("/collections/delete-seo",{method:"DELETE",shop:u,body:{shop:u,collectionId:l.id,language:d}});console.log(`[DELETE-SEO-BULK] Success for ${l.title} - ${d}:`,g)}catch(g){console.error(`[DELETE-SEO-BULK] Failed to delete ${d} for ${l.title}:`,g),r.push({id:l.id,title:l.title,message:g.message})}finally{a++,$({current:a,total:n,percent:Math.round(a/n*100)})}f(`Deleted optimization for ${t.join(", ").toUpperCase()}`),setTimeout(async()=>{await N(),q([]),te(!1),Y(!1)},100)}catch(s){console.error("[DELETE-SEO-BULK] Error:",s),f(`Delete error: ${s.message}`)}finally{console.log("[DELETE-SEO-BULK] ===== BULK DELETE END ====="),be(!1),le([]),K([])}},xt=t=>{var l,d;const s=((l=B[t.id])==null?void 0:l.success)||Te[t.id],n=((d=B[t.id])==null?void 0:d.data)||Te[t.id],a=t.optimizedLanguages||[];console.log(`[COLLECTIONS] Rendering collection "${t.title}":`,{optimizedLanguages:a,availableLanguages:b,hasSeoData:t.hasSeoData,aiEnhanced:t.aiEnhanced});const r=e.jsx(c,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx($t,{id:t.id,media:r,accessibilityLabel:`View details for ${t.title}`,onClick:g=>{console.log("[Collections-ResourceItem] ===== CLICK ON RESOURCE ITEM ====="),console.log("[Collections-ResourceItem] e.target:",g.target),console.log("[Collections-ResourceItem] e.target.tagName:",g.target.tagName),console.log('[Collections-ResourceItem] e.target.closest("input"):',g.target.closest("input")),console.log('[Collections-ResourceItem] e.target.closest("a"):',g.target.closest("a")),console.log("[Collections-ResourceItem] Event bubbling up...")},children:e.jsxs(E,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(c,{style:{flex:"1 1 30%",minWidth:"200px"},children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:t.title}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["Handle: ",t.handle]})]}),e.jsx(c,{style:{flex:"0 0 15%",minWidth:"100px",textAlign:"center"},children:e.jsxs(i,{variant:"bodyMd",children:[t.productsCount," products"]})}),e.jsx(c,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(E,{gap:"100",wrap:!0,children:t.hasSeoData?e.jsxs(e.Fragment,{children:[b.map(g=>e.jsx(ee,{tone:a.includes(g)?"success":"subdued",size:"small",children:g.toUpperCase()},g)),(t.aiEnhanced&&console.log(`[COLLECTIONS-BADGE] Collection "${t.title}" has aiEnhanced:`,t.aiEnhanced),t.aiEnhanced&&e.jsx(ee,{tone:"info",size:"small",children:"AI✨"}))]}):e.jsx(ee,{tone:"subdued",children:"No AI Search Optimisation"})})}),e.jsxs(c,{style:{flex:"0 0 15%",minWidth:"120px"},children:[s&&e.jsx(v,{size:"slim",onClick:()=>{pe(n),he(!0)},children:"Preview JSON"}),!s&&t.hasSeoData&&e.jsx(v,{size:"slim",loading:lt,onClick:()=>ut(t.id),children:"Preview JSON"})]})]})})},Ct=ce&&!C.processing&&e.jsx(m,{open:ce,title:"Processing Collections",onClose:()=>{},noScroll:!0,children:e.jsx(m.Section,{children:e.jsxs(A,{gap:"400",children:[e.jsx(i,{variant:"bodyMd",children:Le?`Processing: ${Le}`:"Preparing..."}),e.jsx(me,{progress:k.percent}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[k.current," of ",k.total," collections (",k.percent,"%)"]})]})})}),jt=e.jsx(m,{open:nt,title:"Select Languages",primaryAction:{content:"Generate Optimization for AI Search",onAction:ft,disabled:O.length===0||$e},secondaryActions:[{content:"Cancel",onAction:()=>ge(!1)}],children:e.jsx(m.Section,{children:e.jsxs(A,{gap:"300",children:[e.jsxs(i,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",y?"all":h.length," selected collections:"]}),$e&&e.jsx(Mt,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(A,{gap:"200",children:[e.jsxs(i,{variant:"bodyMd",children:["Your ",P," plan supports up to ",D," language",D>1?"s":""," per collection.",h.length===1&&((Ue=(Re=(Be=p.find(t=>t.id===h[0]))==null?void 0:Be.optimizationSummary)==null?void 0:Re.optimizedLanguages)==null?void 0:Ue.length)>0&&e.jsxs(e.Fragment,{children:[" This collection already has ",p.find(t=>t.id===h[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(i,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(v,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),s=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${s}`},children:"Upgrade Plan"})]})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(E,{gap:"200",wrap:!0,children:b.map(t=>e.jsx(Fe,{label:t.toUpperCase(),checked:O.includes(t),onChange:s=>{W(s?[...O,t]:O.filter(n=>n!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(v,{plain:!0,onClick:()=>{O.length===b.length?W([]):b.length>D?(W([...b]),f(`You selected ${b.length} languages. Your ${P} plan supports ${D}. Please deselect or upgrade.`)):W([...b])},children:O.length===b.length?"Deselect all":"Select all"})})]})})}),Et=e.jsx(m,{open:st&&!ce,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:mt,disabled:!Object.values(B).some(t=>t.success)},secondaryActions:[{content:"Cancel",onAction:()=>ue(!1)}],children:e.jsx(m.Section,{children:e.jsxs(A,{gap:"300",children:[e.jsxs(E,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(B).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(B).filter(t=>t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(B).filter(t=>!t.success&&!t.skipped).length})]})]}),Q.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(kt,{}),e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(c,{maxHeight:"200px",overflowY:"scroll",children:[Q.slice(0,10).map((t,s)=>e.jsxs(i,{variant:"bodySm",tone:"critical",children:[t.collection,": ",t.error]},s)),Q.length>10&&e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["... and ",Q.length-10," more errors"]})]})]})]})})}),yt=e.jsx(m,{open:ot,title:"SEO Data Preview",secondaryActions:[{content:"Close",onAction:()=>{he(!1),pe(null)}}],children:e.jsx(m.Section,{children:e.jsx(c,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",backgroundColor:"#f6f6f7",padding:"12px",borderRadius:"4px",maxHeight:"400px",overflow:"auto"},children:Me?JSON.stringify(Me,null,2):""})})})}),Lt=e.jsx(m,{open:Xe,title:"Delete Optimization for AI Search",onClose:()=>{ne(!1),K([])},primaryAction:{content:"Continue",onAction:()=>{le(F),ne(!1),oe(!0)},disabled:F.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{ne(!1),K([])}}],children:e.jsx(m.Section,{children:e.jsxs(A,{gap:"400",children:[e.jsxs(i,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",y?H:h.length," selected collections:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(E,{gap:"400",wrap:!1,children:b.map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[e.jsx("input",{type:"checkbox",checked:F.includes(t),onChange:s=>{K(s.target.checked?[...F,t]:F.filter(n=>n!==t))},style:{marginRight:"8px",width:"18px",height:"18px",cursor:"pointer"}}),e.jsx(i,{variant:"bodyMd",children:t.toUpperCase()})]},t))})}),e.jsx(c,{children:e.jsx(v,{plain:!0,onClick:()=>{K(F.length===b.length?[]:[...b])},children:"Select all"})}),e.jsx(c,{paddingBlockStart:"300",children:e.jsx(i,{variant:"bodySm",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})})]})})}),wt=e.jsx(m,{open:tt,title:"Confirm Deletion",onClose:()=>{oe(!1),le([])},primaryAction:{content:"Delete",destructive:!0,onAction:async()=>{oe(!1),setTimeout(()=>{St(Ie)},100)}},secondaryActions:[{content:"Cancel",onAction:()=>{oe(!1),le([]),K([])}}],children:e.jsx(m.Section,{children:e.jsxs(A,{gap:"400",children:[e.jsx(i,{variant:"bodyMd",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(E,{gap:"200",children:Ie.map(t=>e.jsx(ee,{tone:"warning",children:t.toUpperCase()},t))})}),e.jsxs(i,{variant:"bodyMd",children:["This will delete optimisation from ",y?H:h.length," selected collections."]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(i,{variant:"bodySm",tone:"critical",children:"This action cannot be undone."})})]})})}),Ot=Oe&&e.jsx(m,{open:Oe,title:"Deleting SEO Data",onClose:()=>{},noScroll:!0,children:e.jsx(m.Section,{children:e.jsxs(A,{gap:"400",children:[e.jsx(i,{variant:"bodyMd",children:"Deleting selected languages..."}),e.jsx(me,{progress:k.percent}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[k.current," of ",k.total," operations (",k.percent,"%)"]})]})})}),bt=e.jsx(Bt,{heading:"No collections found",action:{content:"Clear filters",onAction:()=>{ae(""),se("all"),N()}},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms"})});return e.jsxs(e.Fragment,{children:[e.jsx(vt,{globalPlan:x}),e.jsx(Ke,{children:e.jsx(c,{padding:"400",children:e.jsxs(A,{gap:"300",children:[e.jsxs(E,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(c,{minWidth:"400px",children:e.jsx(Pt,{label:"",placeholder:"Search by collection name...",value:z,onChange:ae,prefix:e.jsx(Dt,{}),clearButton:!0,onClearButtonClick:()=>ae("")})}),e.jsx(c,{width:"320px",children:e.jsx(v,{primary:!0,onClick:gt,disabled:h.length===0&&!y,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(E,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(v,{onClick:it,disabled:Ae||xe,size:"medium",children:Ae?"Syncing...":"Sync Collections"}),e.jsx(c,{width:"320px",children:e.jsxs(A,{gap:"200",align:"end",children:[(()=>{if(h.length===0&&!y||!p.filter(a=>h.includes(a.id)).some(a=>{var r;return((r=a.optimizedLanguages)==null?void 0:r.length)>0}))return null;const n=P.toLowerCase().replace(/_/g," ")==="starter";return e.jsx(v,{onClick:n?()=>{V({error:"Collections require Professional plan or higher",message:"Upgrade to Professional plan to access Collections optimization",minimumPlanRequired:"Professional"}),Z(!0)}:ht,disabled:h.length===0&&!y,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(v,{outline:!0,destructive:!0,onClick:()=>ne(!0),disabled:h.length===0||!et,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]})})}),e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(Ke,{children:[e.jsxs(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(E,{gap:"200",wrap:!0,align:"space-between",children:[e.jsx(E,{gap:"200",wrap:!0,children:e.jsx(_e,{active:je,activator:e.jsx(v,{disclosure:"down",onClick:()=>re(!je),removeUnderline:!0,children:e.jsxs(E,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),I!=="all"&&e.jsx(c,{onClick:t=>{t.stopPropagation(),se("all")},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>re(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(He,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All collections",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[I],onChange:t=>{se(t[0]),re(!1)}})})})}),e.jsx(_e,{active:Ee,activator:e.jsx(v,{disclosure:"down",onClick:()=>ie(!Ee),removeUnderline:!0,children:e.jsx(E,{gap:"100",blockAlign:"center",children:e.jsxs("span",{children:[T==="updatedAt"&&M==="desc"&&"Newest first",T==="updatedAt"&&M==="asc"&&"Oldest first",T==="title"&&M==="asc"&&"Name A-Z",T==="title"&&M==="desc"&&"Name Z-A",T==="productsCount"&&M==="desc"&&"Most products",T==="productsCount"&&M==="asc"&&"Least products"]})})}),onClose:()=>ie(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(He,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"updatedAt_desc"},{label:"Oldest first",value:"updatedAt_asc"},{label:"Name A-Z",value:"title_asc"},{label:"Name Z-A",value:"title_desc"},{label:"Most products",value:"productsCount_desc"},{label:"Least products",value:"productsCount_asc"}],selected:[`${T}_${M}`],onChange:t=>{const[s,n]=t[0].split("_");Ge(s),Je(n),ie(!1)}})})})]}),I!=="all"&&e.jsx(c,{paddingBlockStart:"200",children:e.jsx(E,{gap:"100",wrap:!0,children:e.jsx(ee,{onRemove:()=>se("all"),children:I==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"})})})]}),H>0&&e.jsx(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:e.jsx(Fe,{label:`Select all ${H} collections`,checked:y,onChange:dt})}),e.jsx(Nt,{resourceName:{singular:"collection",plural:"collections"},items:p,renderItem:xt,selectedItems:h,onSelectionChange:ct,selectable:!0,loading:xe,totalItemsCount:H,emptyState:bt,showHeader:!1},`collections-${p.length}-${h.length}`)]})}),Ct,jt,Et,yt,Lt,wt,Ot,pt(),e.jsx(It,{open:at,onClose:()=>Z(!1),featureName:"Collections AI Enhancement",currentPlan:P,errorMessage:(S==null?void 0:S.error)||(S==null?void 0:S.message),minimumPlanRequired:S==null?void 0:S.minimumPlanRequired}),S&&e.jsx(Tt,{open:rt,onClose:()=>{ze(!1),V(null)},tokensRequired:S.tokensRequired||0,tokensAvailable:S.tokensAvailable||0,tokensNeeded:S.tokensNeeded||0,feature:"ai-seo-collection",shop:u,needsUpgrade:S.needsUpgrade||!1,minimumPlan:S.minimumPlanForFeature||null,currentPlan:S.currentPlan||P}),Pe&&e.jsx(zt,{content:Pe,onDismiss:()=>f("")})]})}export{hs as default};
