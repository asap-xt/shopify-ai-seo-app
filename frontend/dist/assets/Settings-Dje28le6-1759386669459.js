import{j as e}from"./app-bridge-BrwnYSOx-1759386669459.js";import{r as i}from"./react-vendor-tAaa2TlE-1759386669459.js";import{C as w,d as p,T as S,h as v,s as Ze,i as z,D as ne,B as x,v as eo,g as k,u as ve,a as E,I as A,r as Me,f as W,n as oo,w as to,M as N,e as so,k as ao}from"./polaris-Bkv1IXsg-1759386669459.js";import{m as Be}from"./index-QHX4tNip-1759386669459.js";const no=({shop:pe})=>{const[b,O]=i.useState({title:"Premium Wireless Headphones",description:"High-quality wireless headphones with noise cancellation, perfect for music lovers and professionals. Features Bluetooth connectivity and long battery life.",tags:["wireless","bluetooth","noise-cancelling","premium","electronics"],productType:"Electronics",vendor:"TechBrand"}),[n,Te]=i.useState({bullets:["Premium wireless headphones with noise cancellation","Bluetooth connectivity for seamless pairing","Long battery life up to 30 hours","Made with premium materials","ISO 9001 certified quality","30-day money back guarantee","Made in Germany with precision engineering","Free shipping worldwide","Perfect for music lovers and professionals"],faq:[{q:"How long is the battery life?",a:"These headphones offer long battery life for extended use."},{q:"What connectivity options are available?",a:"The headphones feature Bluetooth connectivity for wireless pairing."},{q:"What is your return policy?",a:"We offer 30-day money back guarantee on all products."},{q:"Where are these headphones made?",a:"Made in Germany with precision engineering and ISO certification."}]}),[m,_]=i.useState(null),[F,t]=i.useState(!1),[L,Q]=i.useState(!1),$=async()=>{t(!0);try{const d=await(await fetch("/test/test-validation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productData:b,aiResponse:n,requestedAttributes:["bullets","faq","attributes"]})})).json();_(d),Q(!0)}catch(u){console.error("Validation test failed:",u)}finally{t(!1)}},K=async()=>{t(!0);try{const d=await(await fetch("/test/test-extraction",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productData:b,requestedAttributes:["material","color","size","category","audience"]})})).json();_({...m,extraction:d})}catch(u){console.error("Extraction test failed:",u)}finally{t(!1)}},H=(u,d)=>{const M=u-d;return M===0?{status:"success",text:"All passed"}:M===u?{status:"critical",text:"All rejected"}:{status:"warning",text:`${M} rejected`}};return e.jsx(w,{children:e.jsxs(p,{gap:"400",children:[e.jsx(S,{variant:"headingLg",children:"🧪 AI Validation Tester"}),e.jsx(v,{status:"info",children:"Test AI validation with real product data. This will show you how the validation system filters out hallucinations and preserves factual content."}),e.jsxs(Ze,{children:[e.jsx(z,{label:"Product Title",value:b.title,onChange:u=>O(d=>({...d,title:u}))}),e.jsx(z,{label:"Product Description",value:b.description,onChange:u=>O(d=>({...d,description:u})),multiline:3}),e.jsx(z,{label:"Product Tags (comma-separated)",value:b.tags.join(", "),onChange:u=>O(d=>({...d,tags:u.split(",").map(M=>M.trim()).filter(Boolean)}))}),e.jsx(z,{label:"Product Type",value:b.productType,onChange:u=>O(d=>({...d,productType:u}))}),e.jsx(z,{label:"Vendor",value:b.vendor,onChange:u=>O(d=>({...d,vendor:u}))})]}),e.jsx(ne,{}),e.jsxs(p,{align:"space-between",children:[e.jsx(x,{primary:!0,onClick:$,loading:F,children:"Test Validation"}),e.jsx(x,{onClick:K,loading:F,children:"Test Attribute Extraction"})]}),m&&L&&e.jsx(eo,{open:L,id:"validation-results",transition:{duration:"200ms",timingFunction:"ease-in-out"},children:e.jsxs(p,{gap:"400",children:[e.jsx(ne,{}),e.jsx(S,{variant:"headingMd",children:"📊 Validation Results"}),e.jsxs(p,{align:"space-between",children:[e.jsx(w,{sectioned:!0,children:e.jsxs(p,{gap:"200",children:[e.jsx(S,{variant:"headingSm",children:"Bullets"}),e.jsxs(p,{align:"space-between",children:[e.jsxs(k,{status:H(m.original.bullets,m.validated.bullets).status,children:[m.original.bullets," → ",m.validated.bullets]}),e.jsxs(S,{variant:"bodySm",children:[m.rejected.bullets," rejected"]})]})]})}),e.jsx(w,{sectioned:!0,children:e.jsxs(p,{gap:"200",children:[e.jsx(S,{variant:"headingSm",children:"FAQ"}),e.jsxs(p,{align:"space-between",children:[e.jsxs(k,{status:H(m.original.faq,m.validated.faq).status,children:[m.original.faq," → ",m.validated.faq]}),e.jsxs(S,{variant:"bodySm",children:[m.rejected.faq," rejected"]})]})]})})]}),m.validatedContent&&e.jsx(w,{sectioned:!0,children:e.jsxs(p,{gap:"400",children:[e.jsx(S,{variant:"headingSm",children:"✅ Validated Content"}),m.validatedContent.bullets&&m.validatedContent.bullets.length>0&&e.jsxs(p,{gap:"200",children:[e.jsx(S,{variant:"headingXs",children:"Valid Bullets:"}),e.jsx(ve,{type:"bullet",children:m.validatedContent.bullets.map((u,d)=>e.jsx(ve.Item,{children:u},d))})]}),m.validatedContent.faq&&m.validatedContent.faq.length>0&&e.jsxs(p,{gap:"200",children:[e.jsx(S,{variant:"headingXs",children:"Valid FAQ:"}),m.validatedContent.faq.map((u,d)=>e.jsxs(p,{gap:"200",children:[e.jsxs(S,{variant:"bodySm",fontWeight:"bold",children:["Q: ",u.q]}),e.jsxs(S,{variant:"bodySm",children:["A: ",u.a]})]},d))]})]})}),m.extractedAttributes&&e.jsx(w,{sectioned:!0,children:e.jsxs(p,{gap:"400",children:[e.jsx(S,{variant:"headingSm",children:"🔍 Extracted Attributes"}),e.jsx(p,{align:"space-between",children:Object.entries(m.extractedAttributes.extractedAttributes||{}).map(([u,d])=>e.jsxs(k,{status:d?"success":"info",children:[u,": ",d||"Not found"]},u))})]})})]})})]})})};function mo(){console.log("[SETTINGS] ===== SETTINGS COMPONENT LOADED ====="),console.log("[SETTINGS] Starting component initialization...");const pe=(o,s="")=>{try{return new URLSearchParams(window.location.search).get(o)||s}catch{return s}},b=o=>(o||"starter").toLowerCase().replace(" ","_"),O=(o,s=null)=>{console.log(`[SETTINGS DEBUG] ${o}`,s||"")},n=pe("shop",""),[Te,m]=i.useState(!0),[_,F]=i.useState(!1),[t,L]=i.useState(null),[Q,$]=i.useState(""),[K,H]=i.useState(!1),[u,d]=i.useState(""),[M,ke]=i.useState(null),[Ee,le]=i.useState(null),[me,Oe]=i.useState(!1),[re,Ue]=i.useState(!1),[ce,Re]=i.useState(!1),[ie,Le]=i.useState(!1),[He,Je]=i.useState(!1),[Fe,$e]=i.useState(!1),[lo,ro]=i.useState(!1),[Ve,Ge]=i.useState(!1),[fe,Y]=i.useState(!1),[xe,X]=i.useState(!1),[Ie,de]=i.useState(!1),[be,qe]=i.useState(""),[Ne,U]=i.useState(null),[je,Ae]=i.useState(!1),[Se,he]=i.useState(null),[Ce,ze]=i.useState(!1),[co,io]=i.useState(!1),[So,ho]=i.useState(""),[go,We]=i.useState({enabled:!1,generating:!1,generated:!1,progress:""}),[D,C]=i.useState(!1),[B,ge]=i.useState({current:0,total:0,percent:0,currentProduct:"",stats:{siteFAQ:!1,products:0,totalSchemas:0}}),[J,P]=i.useState(!1),T=i.useMemo(()=>Be(),[]);console.log("[SETTINGS] ===== SHOP EXTRACTION DEBUG ====="),console.log("[SETTINGS] Extracted shop:",n),console.log("[SETTINGS] API function created:",typeof T),console.log("[SETTINGS] makeSessionFetch function:",typeof Be),i.useEffect(()=>{if(u){console.log("[SETTINGS] Toast state changed to:",u),M&&clearTimeout(M);const o=setTimeout(()=>{console.log("[SETTINGS] Auto-clearing toast after 5 seconds"),d("")},5e3);ke(o)}},[u]);const _e=()=>{console.log("[SETTINGS] Starting polling for background regeneration completion..."),Ee&&clearInterval(Ee);let o=0;const s=30,a=setInterval(async()=>{o++,console.log(`[SETTINGS] Polling attempt ${o}/${s}`);try{const l=await T(`/api/sitemap/info?shop=${n}`);if(console.log("[SETTINGS] Sitemap info:",l),l&&l.generatedAt){const g=new Date(l.generatedAt).getTime();if(Date.now()-g<12e4){console.log("[SETTINGS] Background regeneration completed!"),clearInterval(a),le(null),d("AI-Optimized Sitemap regeneration completed successfully!"),console.log("[SETTINGS] Setting showAiSitemapView to true for AI sitemap regeneration completion"),Je(!0);return}}o>=s&&(console.log("[SETTINGS] Polling timeout reached"),clearInterval(a),le(null),d("Background regeneration is taking longer than expected. Please check the sitemap manually."))}catch(l){console.error("[SETTINGS] Polling error:",l)}},1e4);le(a)},Z=i.useCallback(async()=>{var o,s;try{console.log("[SETTINGS DEBUG] ===== CHECKING PRODUCTS DATA ====="),console.log("[SETTINGS DEBUG] Shop:",n);const a=await T(`/api/products/list?shop=${n}&limit=10&optimized=true`);console.log("[SETTINGS DEBUG] API Result:",a),console.log("[SETTINGS DEBUG] Products length:",(o=a==null?void 0:a.products)==null?void 0:o.length),console.log("[SETTINGS DEBUG] Products:",a==null?void 0:a.products);const l=(s=a==null?void 0:a.products)==null?void 0:s.some(g=>{var c,h;return((h=(c=g==null?void 0:g.optimizationSummary)==null?void 0:c.optimizedLanguages)==null?void 0:h.length)>0});return console.log("[SETTINGS DEBUG] Has optimized products:",l),console.log("[SETTINGS DEBUG] ===== PRODUCTS CHECK COMPLETE ====="),l}catch(a){return console.error("[SETTINGS] Error checking products data:",a),!1}},[n,T]),ee=i.useCallback(async()=>{var o,s;try{console.log("[SETTINGS DEBUG] ===== CHECKING COLLECTIONS DATA ====="),console.log("[SETTINGS DEBUG] Shop:",n);const a=await T(`/collections/list-graphql?shop=${n}`);console.log("[SETTINGS DEBUG] API Result:",a),console.log("[SETTINGS DEBUG] Collections length:",(o=a==null?void 0:a.collections)==null?void 0:o.length),console.log("[SETTINGS DEBUG] Collections:",a==null?void 0:a.collections);const l=(s=a==null?void 0:a.collections)==null?void 0:s.some(g=>{var c;return((c=g==null?void 0:g.optimizedLanguages)==null?void 0:c.length)>0});return console.log("[SETTINGS DEBUG] Has optimized collections:",l),console.log("[SETTINGS DEBUG] ===== COLLECTIONS CHECK COMPLETE ====="),l}catch(a){return console.error("[SETTINGS] Error checking collections data:",a),!1}},[n,T]),oe=i.useCallback(async()=>{var o,s,a,l,g;try{console.log("[SETTINGS DEBUG] ===== CHECKING STORE METADATA ====="),console.log("[SETTINGS DEBUG] Shop:",n);const c=`
        query CheckStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
          }
        }
      `;console.log("[SETTINGS DEBUG] GraphQL Query:",c),console.log("[SETTINGS DEBUG] Variables:",{shop:n});const h=await T("/graphql",{method:"POST",body:JSON.stringify({query:c,variables:{shop:n}}),shop:n});console.log("[SETTINGS DEBUG] GraphQL Result:",h),console.log("[SETTINGS DEBUG] Result data:",h==null?void 0:h.data),console.log("[SETTINGS DEBUG] Store metadata:",(o=h==null?void 0:h.data)==null?void 0:o.storeMetadata),console.log("[SETTINGS DEBUG] Shop name:",(a=(s=h==null?void 0:h.data)==null?void 0:s.storeMetadata)==null?void 0:a.shopName);const G=!!((g=(l=h==null?void 0:h.data)==null?void 0:l.storeMetadata)!=null&&g.shopName);return console.log("[SETTINGS DEBUG] Has metadata:",G),console.log("[SETTINGS DEBUG] ===== STORE METADATA CHECK COMPLETE ====="),G}catch(c){return console.error("[SETTINGS] Error checking store metadata:",c),console.error("[SETTINGS] Error details:",c==null?void 0:c.message,c==null?void 0:c.stack),!1}},[n,T]),te=i.useCallback(async()=>{var o;try{console.log("[SETTINGS DEBUG] ===== CHECKING WELCOME PAGE ====="),console.log("[SETTINGS DEBUG] Shop:",n),console.log("[SETTINGS DEBUG] Current settings features:",t==null?void 0:t.features),console.log("[SETTINGS DEBUG] Welcome page feature enabled:",(o=t==null?void 0:t.features)==null?void 0:o.welcomePage),console.log("[SETTINGS DEBUG] Current plan:",t==null?void 0:t.plan);const s=await T(`/ai/welcome?shop=${n}`);if(console.log("[SETTINGS DEBUG] Welcome page result:",s),console.log("[SETTINGS DEBUG] Result type:",typeof s),console.log("[SETTINGS DEBUG] Result keys:",s?Object.keys(s):"null"),s!=null&&s.error&&typeof s.error=="string"&&!s.error.includes("<!DOCTYPE html>"))return console.log("[SETTINGS DEBUG] Welcome page error:",s.error),console.log("[SETTINGS DEBUG] Error debug info:",s.debug),!1;const a=typeof s=="string"&&s.includes("<!DOCTYPE html>")||(s==null?void 0:s.error)&&typeof s.error=="string"&&s.error.includes("<!DOCTYPE html>");return console.log("[SETTINGS DEBUG] Has welcome page:",a),console.log("[SETTINGS DEBUG] ===== WELCOME PAGE CHECK COMPLETE ====="),a}catch(s){return console.error("[SETTINGS] Error checking welcome page:",s),!1}},[n,T,t]),se=i.useCallback(async()=>{var o,s,a,l,g,c,h,G,r,f,R;console.log("[SETTINGS] ===== checkGeneratedData CALLED ====="),console.log("[SETTINGS] checkGeneratedData - shop:",n),console.log("[SETTINGS] checkGeneratedData - settings:",t),console.log("[SETTINGS] checkGeneratedData - settings?.features:",t==null?void 0:t.features),console.log("[SETTINGS] checkGeneratedData - Store Metadata feature:",(o=t==null?void 0:t.features)==null?void 0:o.storeMetadata),console.log("[SETTINGS] checkGeneratedData - Store Metadata type:",typeof((s=t==null?void 0:t.features)==null?void 0:s.storeMetadata)),console.log("[SETTINGS] checkGeneratedData - Store Metadata enabled:",!!((a=t==null?void 0:t.features)!=null&&a.storeMetadata));try{if(console.log("[SETTINGS] ===== CHECKING GENERATED DATA ====="),(l=t==null?void 0:t.features)!=null&&l.productsJson){console.log("[SETTINGS] ===== CHECKING PRODUCTS JSON FEATURE ====="),console.log("[SETTINGS] Products JSON feature is enabled:",(g=t==null?void 0:t.features)==null?void 0:g.productsJson);const I=await Z();console.log("[SETTINGS] Setting showProductsJsonView to:",I),Ue(I),console.log("[SETTINGS] Products JSON data exists:",I)}else console.log("[SETTINGS] Products JSON feature is disabled");if((c=t==null?void 0:t.features)!=null&&c.collectionsJson){console.log("[SETTINGS] ===== CHECKING COLLECTIONS JSON FEATURE ====="),console.log("[SETTINGS] Collections JSON feature is enabled:",(h=t==null?void 0:t.features)==null?void 0:h.collectionsJson);const I=await ee();console.log("[SETTINGS] Setting showCollectionsJsonView to:",I),Re(I),console.log("[SETTINGS] Collections JSON data exists:",I)}else console.log("[SETTINGS] Collections JSON feature is disabled");if((G=t==null?void 0:t.features)!=null&&G.storeMetadata){console.log("[SETTINGS] ===== CHECKING STORE METADATA IN checkGeneratedData ====="),console.log("[SETTINGS] Store Metadata feature is enabled:",(r=t==null?void 0:t.features)==null?void 0:r.storeMetadata),console.log("[SETTINGS] About to call checkStoreMetadata...");const I=await oe();console.log("[SETTINGS] checkStoreMetadata returned:",I),console.log("[SETTINGS] Setting showStoreMetadataView to:",I),Le(I),console.log("[SETTINGS] Store Metadata exists:",I),console.log("[SETTINGS] ===== STORE METADATA CHECK COMPLETE =====")}else console.log("[SETTINGS] Store Metadata feature is NOT enabled:",(f=t==null?void 0:t.features)==null?void 0:f.storeMetadata);if((R=t==null?void 0:t.features)!=null&&R.welcomePage){console.log("[SETTINGS] Checking Welcome Page data...");const I=await te();$e(I),console.log("[SETTINGS] Welcome Page exists:",I)}console.log("[SETTINGS] ===== GENERATED DATA CHECK COMPLETE =====")}catch(I){console.error("[SETTINGS] Error checking generated data:",I)}},[t==null?void 0:t.features,Z,ee,oe,te]);i.useEffect(()=>{console.log("[SETTINGS DEBUG] ===== useEffect DEPENDENCIES DEBUG ====="),console.log("[SETTINGS DEBUG] settings?.features:",t==null?void 0:t.features),console.log("[SETTINGS DEBUG] settings exists:",!!t),console.log("[SETTINGS DEBUG] settings type:",typeof t),console.log("[SETTINGS DEBUG] checkProductsData exists:",!!Z),console.log("[SETTINGS DEBUG] checkCollectionsData exists:",!!ee),console.log("[SETTINGS DEBUG] checkStoreMetadata exists:",!!oe),console.log("[SETTINGS DEBUG] checkWelcomePage exists:",!!te),console.log("[SETTINGS DEBUG] ===== END useEffect DEPENDENCIES DEBUG =====")},[t==null?void 0:t.features,Z,ee,oe,te]),console.log("[SETTINGS] State variables initialized successfully"),console.log("[SETTINGS] About to create useEffect hooks...");const Qe=async(o,s)=>{var g,c;console.log("[DEBUG] runGQL called with query:",o),console.log("[DEBUG] runGQL variables:",s);const a=JSON.stringify({query:o,variables:s});console.log("[DEBUG] runGQL body:",a);const l=await T("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:a});if(console.log("[DEBUG] runGQL response:",l),(g=l==null?void 0:l.errors)!=null&&g.length)throw console.error("[DEBUG] GraphQL errors:",l.errors),new Error(((c=l.errors[0])==null?void 0:c.message)||"GraphQL error");return l==null?void 0:l.data};console.log("[SETTINGS] Creating loadSettings useEffect..."),console.log("[SETTINGS] Current shop value:",n),console.log("[SETTINGS] Shop type:",typeof n),console.log("[SETTINGS] Shop length:",n==null?void 0:n.length),i.useEffect(()=>{if(console.log("[SETTINGS] ===== LOAD SETTINGS useEffect TRIGGERED ====="),console.log("[SETTINGS] Shop:",n),console.log("[SETTINGS] API function:",typeof T),console.log("[SETTINGS] useEffect dependencies - shop:",n),console.log("[SETTINGS] useEffect dependencies - api:",typeof T),!n){console.log("[SETTINGS] No shop, setting loading to false"),m(!1);return}console.log("[SETTINGS] Shop available, calling loadSettings..."),Ye()},[n,T]),console.log("[SETTINGS] loadSettings useEffect created successfully"),i.useEffect(()=>{Ce&&Ke()},[Ce]),i.useEffect(()=>{},[t==null?void 0:t.features]);const Ke=async()=>{try{const o=await T(`/api/schema/status?shop=${n}`);We({enabled:o.enabled,generating:o.generating,generated:o.hasSiteFAQ||o.productsWithSchema>0,progress:o.progress||""})}catch(o){console.error("Failed to check schema status:",o)}},j=i.useRef(!1),y=i.useRef(0),ye=20,we=i.useCallback(async()=>{if(console.log("[PROGRESS-CHECK] Starting check..."),console.log("[PROGRESS-CHECK] isGeneratingRef.current:",j.current),console.log("[PROGRESS-CHECK] checkCountRef.current:",y.current),console.log("[PROGRESS-CHECK] schemaGenerating state:",D),!j.current){console.log("[PROGRESS-CHECK] Not generating (ref is false), stopping check");return}if(!D&&y.current>2){console.log("[PROGRESS-CHECK] ⚠️ Ref says generating but state says not generating after multiple checks, resetting..."),j.current=!1,y.current=0;return}if(y.current++,y.current>ye){console.log("[PROGRESS-CHECK] ⏰ Timeout reached, stopping check"),j.current=!1,C(!1),d("Schema generation timed out. Please try again.");return}try{const o=await T(`/api/schema/status?shop=${n}`);if(console.log("[PROGRESS-CHECK] Status data:",o),o.generating){console.log("[PROGRESS-CHECK] Still generating, will check again...");const s=Math.min(o.progress?parseInt(o.progress.replace("%","")):y.current*5,90);console.log("[PROGRESS-CHECK] Updating progress to:",s+"%"),ge(a=>({...a,percent:s,currentProduct:o.currentProduct||`Processing products... (${y.current}/${ye})`})),setTimeout(()=>{j.current&&we()},2e3)}else{console.log("[PROGRESS-CHECK] Backend says generation complete, checking final data...");const s=await T(`/ai/schema-data.json?shop=${n}`);console.log("[PROGRESS-CHECK] Final data:",s),console.log("[PROGRESS-CHECK] ✅ Generation complete!"),j.current=!1,y.current=0,P(!0),C(!1),console.log("[PROGRESS-CHECK] 🔵 Set schemaGenerating state = false");const a=[...new Set(s.schemas.map(l=>{var g,c;return(c=(g=l.url)==null?void 0:g.split("/products/")[1])==null?void 0:c.split("#")[0]}))].filter(Boolean);ge(l=>({...l,percent:100,stats:{siteFAQ:!!s.siteFAQ,products:a.length,totalSchemas:s.schemas.length}}));return}}catch(o){console.error("[PROGRESS-CHECK] ❌ Error:",o),j.current=!1,y.current=0,d("Schema generation check failed: "+(o.message||"Unknown error")),C(!1)}},[T,n,D]),Ye=async()=>{var o,s,a,l,g,c,h,G;try{console.log("[SETTINGS] ===== STARTING LOAD SETTINGS ====="),console.log("[SETTINGS] Shop:",n),console.log("[SETTINGS] API function:",typeof T),console.log("[SETTINGS] Calling API...");const r=await T(`/api/ai-discovery/settings?shop=${n}`);console.log("[SETTINGS] ===== SETTINGS LOADED ====="),console.log("[SETTINGS] Raw data:",r),console.log("[SETTINGS] Settings plan:",r==null?void 0:r.plan),console.log("[SETTINGS] Normalized plan:",b(r==null?void 0:r.plan)),console.log("[SETTINGS] Features:",r==null?void 0:r.features),console.log("[SETTINGS] Products JSON feature:",(o=r==null?void 0:r.features)==null?void 0:o.productsJson),console.log("[SETTINGS] Collections JSON feature:",(s=r==null?void 0:r.features)==null?void 0:s.collectionsJson),console.log("[SETTINGS] AI Sitemap feature:",(a=r==null?void 0:r.features)==null?void 0:a.aiSitemap),console.log("[SETTINGS] Welcome Page feature:",(l=r==null?void 0:r.features)==null?void 0:l.welcomePage),console.log("[SETTINGS] Store Metadata feature:",(g=r==null?void 0:r.features)==null?void 0:g.storeMetadata),console.log("[SETTINGS] Schema Data feature:",(c=r==null?void 0:r.features)==null?void 0:c.schemaData),console.log("[SETTINGS] Auto Robots Txt feature:",(h=r==null?void 0:r.features)==null?void 0:h.autoRobotsTxt);const f=Object.entries((r==null?void 0:r.features)||{}).filter(([R,I])=>I===!0);console.log("[SETTINGS] Features that are TRUE:",f),console.log("[SETTINGS] Number of true features:",f.length),console.log("[SETTINGS] Setting settings state..."),console.log("[SETTINGS] Data to set:",r),console.log("[SETTINGS] Store Metadata in data:",(G=r==null?void 0:r.features)==null?void 0:G.storeMetadata),L(r),he(r),console.log("[SETTINGS] Settings state set successfully"),ze(r.advancedSchemaEnabled||!1),ae(r),console.log("[SETTINGS] ===== LOAD SETTINGS COMPLETE =====")}catch(r){console.error("[SETTINGS] ===== LOAD SETTINGS ERROR ====="),console.error("[SETTINGS] Failed to load settings:",r),d("Failed to load settings")}finally{m(!1)}},ae=async(o=t)=>{console.log("[GENERATE ROBOTS] Called with shop:",n);try{const s=await T(`/api/ai-discovery/robots-txt?shop=${n}`,{responseType:"text"});console.log("[GENERATE ROBOTS] Received:",s),$(s||`User-agent: *
Disallow: /`)}catch(s){console.error("[GENERATE ROBOTS] Error:",s),$(`# Error generating robots.txt
# `+s.message)}};console.log("[SETTINGS DEBUG] generateRobotsTxt function exists:",typeof ae);const ue=o=>{var s;if(!((s=t==null?void 0:t.availableBots)!=null&&s.includes(o))){d(`Upgrade to ${requiredPlan} plan to enable ${t.bots[o].name}`);return}L(a=>({...a,bots:{...a.bots,[o]:{...a.bots[o],enabled:!a.bots[o].enabled}}})),Ge(!0)},De=o=>{if(!Pe(o)){d(`Upgrade your plan to enable ${{productsJson:"Products JSON Feed",aiSitemap:"AI-Optimized Sitemap",welcomePage:"AI Welcome Page",collectionsJson:"Collections JSON Feed",storeMetadata:"Store Metadata",schemaData:"Schema Data"}[o]||o}`);return}L(s=>({...s,features:{...s.features,[o]:!s.features[o]}}))},Xe=async()=>{var o,s,a,l,g;console.log("[SETTINGS] ===== SAVE SETTINGS CALLED ====="),console.log("[SETTINGS] Current settings:",t),F(!0);try{if(await T(`/api/ai-discovery/settings?shop=${n}`,{method:"POST",body:{shop:n,bots:t.bots,features:t.features}}),Ge(!1),he(t),ae(),console.log("[SETTINGS] Checking AI Sitemap feature:",(o=t.features)==null?void 0:o.aiSitemap),(s=t.features)!=null&&s.aiSitemap)try{console.log("[SETTINGS] ===== AI SITEMAP BACKGROUND REGENERATION START ====="),console.log("[SETTINGS] AI Sitemap enabled, starting background regeneration..."),console.log("[SETTINGS] Shop:",n);const c=`
            mutation RegenerateSitemap($shop: String!) {
              regenerateSitemap(shop: $shop) {
                success
                message
                shop
              }
            }
          `;console.log("[SETTINGS] GraphQL mutation:",c),console.log("[SETTINGS] Variables:",{shop:n});const h=await T("/graphql",{method:"POST",body:JSON.stringify({query:c,variables:{shop:n}}),shop:n});console.log("[SETTINGS] GraphQL sitemap regeneration result:",h),(l=(a=h==null?void 0:h.data)==null?void 0:a.regenerateSitemap)!=null&&l.success?(console.log("[SETTINGS] Background regeneration started successfully"),console.log("[SETTINGS] Setting toast for AI sitemap regeneration with delay..."),d(""),setTimeout(()=>{d("Settings saved! AI-Optimized Sitemap is being regenerated in the background. This may take a few moments."),console.log("[SETTINGS] Success toast set after delay"),_e()},100)):(console.log("[SETTINGS] Background regeneration failed:",(g=h==null?void 0:h.data)==null?void 0:g.regenerateSitemap),console.log("[SETTINGS] Setting toast for failed regeneration..."),d(""),setTimeout(()=>{d("Settings saved, but sitemap regeneration failed"),console.log("[SETTINGS] Error toast set after delay")},100)),console.log("[SETTINGS] ===== AI SITEMAP BACKGROUND REGENERATION END =====")}catch(c){console.error("[SETTINGS] Failed to start sitemap regeneration:",c),d("Settings saved, but sitemap regeneration failed")}else console.log("[SETTINGS] AI Sitemap disabled, skipping background regeneration"),console.log("[SETTINGS] Setting toast for basic save with delay..."),d(""),setTimeout(()=>{d("Settings saved successfully"),console.log("[SETTINGS] Basic success toast set after delay"),console.log("[SETTINGS] Basic save completed, not showing View buttons")},100)}catch(c){console.error("Failed to save settings:",c),d("Failed to save settings")}finally{F(!1)}},Pe=o=>{var l;const s=b(t==null?void 0:t.plan);return((l={productsJson:["starter","professional","growth","growth_extra","enterprise"],storeMetadata:["professional","growth","growth_extra","enterprise"],welcomePage:["growth","growth_extra","enterprise"],collectionsJson:["growth","growth_extra","enterprise"],aiSitemap:["growth_extra","enterprise"],schemaData:["enterprise"]}[o])==null?void 0:l.includes(s))||!1},V=async o=>{console.log(`[DEBUG] setTestPlan called with plan: ${o}, shop: ${n}`);try{const s=`
        mutation SetPlan($shop:String!, $plan: PlanEnum) {
          setPlanOverride(shop:$shop, plan:$plan) { shop plan }
        }
      `;console.log("[DEBUG] GraphQL mutation:",s),console.log("[DEBUG] Variables:",{shop:n,plan:o});const a=await Qe(s,{shop:n,plan:o});console.log("[DEBUG] GraphQL result:",a),d(`Test plan set to ${o||"actual"}`),setTimeout(()=>window.location.reload(),500)}catch(s){console.error("[DEBUG] Failed to set test plan",s),d(`Failed to set test plan: ${s.message}`)}},q=async(o,s)=>{var a,l,g,c,h,G;qe(s),de(!0),Ae(!0),U(null);try{const r={productsJson:`/ai/products.json?shop=${n}`,collectionsJson:`/ai/collections-feed.json?shop=${n}`,storeMetadata:`/ai/store-metadata.json?shop=${n}`,schemaData:`/ai/schema-data.json?shop=${n}`,aiSitemap:`/api/sitemap/generate?shop=${n}&force=true`,welcomePage:`/ai/welcome?shop=${n}`};if(o==="aiSitemap"){console.log("[SETTINGS] Loading AI Sitemap XML...");const f=await fetch(r[o],{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${((g=(l=(a=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:a.getState())==null?void 0:l.session)==null?void 0:g.token)||""}`}});if(f.ok){console.log("[SETTINGS] AI Sitemap XML loaded successfully");const R=await f.text();U(R)}else throw new Error(`HTTP ${f.status}: ${f.statusText}`)}else if(o==="welcomePage"){console.log("[SETTINGS] Loading AI Welcome Page HTML...");const f=await fetch(r[o],{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${((G=(h=(c=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:c.getState())==null?void 0:h.session)==null?void 0:G.token)||""}`}});if(f.ok){console.log("[SETTINGS] AI Welcome Page HTML loaded successfully");const R=await f.text();U(R)}else throw new Error(`HTTP ${f.status}: ${f.statusText}`)}else{const f=await T(r[o]);U(JSON.stringify(f,null,2))}}catch(r){console.error("[SETTINGS] Error loading data:",r),U(`Error loading data: ${r.message}`)}finally{Ae(!1)}};i.useEffect(()=>{console.log("[SETTINGS] showViewButtons state changed to:",me)},[me]),i.useEffect(()=>{console.log("[SETTINGS] Resetting showViewButtons on component mount"),Oe(!1),console.log("[SETTINGS] Resetting schema generation states on component mount"),C(!1),P(!1),console.log("[SETTINGS] Resetting refs to prevent infinite loops"),j.current=!1,y.current=0},[]),console.log("[SETTINGS] Creating checkGeneratedData useEffect..."),console.log("[SETTINGS] Current settings:",t),console.log("[SETTINGS] Current settings features:",t==null?void 0:t.features),i.useEffect(()=>{console.log("[SETTINGS DEBUG] ===== useEffect TRIGGERED ====="),console.log("[SETTINGS DEBUG] Settings:",t),console.log("[SETTINGS DEBUG] Settings features:",t==null?void 0:t.features),console.log("[SETTINGS DEBUG] Shop:",n),console.log("[SETTINGS DEBUG] Conditions check:"),console.log("[SETTINGS DEBUG] - settings?.features exists:",!!(t!=null&&t.features)),console.log("[SETTINGS DEBUG] - shop exists:",!!n),console.log("[SETTINGS DEBUG] - Both conditions met:",!!(t!=null&&t.features&&n)),t!=null&&t.features&&n?(console.log("[SETTINGS] Checking for generated data..."),se()):console.log("[SETTINGS] Skipping checkGeneratedData - conditions not met")},[t==null?void 0:t.features,n,se]),console.log("[SETTINGS] checkGeneratedData useEffect created successfully"),i.useEffect(()=>{console.log("[SETTINGS] ===== FORCE CHECK ON MOUNT ====="),console.log("[SETTINGS] Shop:",n),console.log("[SETTINGS] Settings:",t),console.log("[SETTINGS] Settings features:",t==null?void 0:t.features),console.log("[SETTINGS] checkGeneratedData function:",typeof se),console.log("[SETTINGS] isGeneratingRef.current:",j.current),j.current&&!D&&(console.log("[SETTINGS] ⚠️ Found stale generating state, resetting..."),j.current=!1,y.current=0),n&&(t!=null&&t.features)?(console.log("[SETTINGS] Both shop and settings available, calling checkGeneratedData..."),se()):(console.log("[SETTINGS] Missing shop or settings, skipping checkGeneratedData"),console.log("[SETTINGS] - shop exists:",!!n),console.log("[SETTINGS] - settings?.features exists:",!!(t!=null&&t.features)))},[]);try{return n?Te?e.jsx(w,{children:e.jsx(E,{padding:"400",children:e.jsxs(A,{align:"center",children:[e.jsx(Me,{size:"small"}),e.jsx(S,{children:"Loading settings..."})]})})}):e.jsxs(p,{gap:"600",children:[e.jsx(w,{children:e.jsx(E,{padding:"400",children:e.jsxs(p,{gap:"400",children:[e.jsxs(A,{align:"space-between",children:[e.jsx(S,{as:"h2",variant:"headingMd",children:"AI Bot Access Control"}),(t==null?void 0:t.plan)&&e.jsxs(k,{tone:"info",children:[t.plan.charAt(0).toUpperCase()+t.plan.slice(1)," Plan"]})]}),e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Choose which AI bots can access your store's structured data"}),e.jsx(v,{status:"info",children:e.jsxs(p,{gap:"200",children:[e.jsx(S,{variant:"bodyMd",fontWeight:"semibold",children:"How it works:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginBottom:0},children:[e.jsx("li",{children:"Select AI bots below"}),e.jsx("li",{children:"Save Settings"}),e.jsx("li",{children:"Generate robots.txt"})]})]})}),e.jsx(ne,{}),e.jsxs(p,{gap:"300",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["openai","perplexity"].map(o=>{var G,r,f;const s=(G=t==null?void 0:t.bots)==null?void 0:G[o];if(!s)return null;const a={starter:["openai","perplexity"],professional:["openai","anthropic","perplexity"],growth:["openai","anthropic","google","perplexity","meta","others"],growth_extra:["openai","anthropic","google","perplexity","meta","others"],enterprise:["openai","anthropic","google","perplexity","meta","others"]},l=b(t==null?void 0:t.plan),c=(a[l]||a.starter).includes(o),h=o==="anthropic"?"Professional":o==="google"?"Growth":["meta","others"].includes(o)?"Growth Extra":null;return e.jsx(E,{padding:"200",background:c?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(p,{gap:"100",children:e.jsx(W,{label:e.jsxs(A,{gap:"200",align:"center",children:[e.jsx(S,{variant:c?"bodyMd":"bodySm",tone:c?"base":"subdued",children:s.name||o}),!c&&h&&e.jsxs(k,{tone:"info",size:"small",children:[h,"+"]})]}),checked:!!((f=(r=t==null?void 0:t.bots)==null?void 0:r[o])!=null&&f.enabled),onChange:()=>ue(o),disabled:!c,helpText:c?o==="openai"?"Most popular AI assistant":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="perplexity"?"AI-powered search":o==="meta"?"Meta AI platforms":o==="others"?"Bytespider, DeepSeek, etc.":"":`Upgrade to ${h} plan to enable this AI bot`})})},o)})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["anthropic","google"].map(o=>{var g,c,h,G;const s=(g=t==null?void 0:t.bots)==null?void 0:g[o];if(!s)return null;const a=(c=t==null?void 0:t.availableBots)==null?void 0:c.includes(o),l=o==="anthropic"?"Professional":o==="google"?"Growth":["meta","others"].includes(o)?"Growth Extra":null;return e.jsx(E,{padding:"200",background:a?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(p,{gap:"100",children:e.jsx(W,{label:e.jsxs(A,{gap:"200",align:"center",children:[e.jsx(S,{variant:a?"bodyMd":"bodySm",tone:a?"base":"subdued",children:s.name||o}),!a&&l&&e.jsxs(k,{tone:"info",size:"small",children:[l,"+"]})]}),checked:!!((G=(h=t==null?void 0:t.bots)==null?void 0:h[o])!=null&&G.enabled),onChange:()=>ue(o),disabled:!a,helpText:a?o==="openai"?"Most popular AI assistant":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="perplexity"?"AI-powered search":o==="meta"?"Meta AI platforms":o==="others"?"Bytespider, DeepSeek, etc.":"":`Upgrade to ${l} plan to enable this AI bot`})})},o)})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:["meta","others"].map(o=>{var g,c,h,G;const s=(g=t==null?void 0:t.bots)==null?void 0:g[o];if(!s)return null;const a=(c=t==null?void 0:t.availableBots)==null?void 0:c.includes(o),l=o==="anthropic"?"Professional":o==="google"?"Growth":["meta","others"].includes(o)?"Growth Extra":null;return e.jsx(E,{padding:"200",background:a?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:e.jsx(p,{gap:"100",children:e.jsx(W,{label:e.jsxs(A,{gap:"200",align:"center",children:[e.jsx(S,{variant:a?"bodyMd":"bodySm",tone:a?"base":"subdued",children:s.name||o}),!a&&l&&e.jsxs(k,{tone:"info",size:"small",children:[l,"+"]})]}),checked:!!((G=(h=t==null?void 0:t.bots)==null?void 0:h[o])!=null&&G.enabled),onChange:()=>ue(o),disabled:!a,helpText:a?o==="openai"?"Most popular AI assistant":o==="anthropic"?"Claude AI assistant":o==="google"?"Google Gemini":o==="perplexity"?"AI-powered search":o==="meta"?"Meta AI platforms":o==="others"?"Bytespider, DeepSeek, etc.":"":`Upgrade to ${l} plan to enable this AI bot`})})},o)})})]})]})})}),e.jsx(w,{children:e.jsx(E,{padding:"400",children:e.jsxs(p,{gap:"400",children:[e.jsx(S,{as:"h2",variant:"headingMd",children:"robots.txt Configuration"}),Ve&&e.jsx(v,{status:"warning",title:"Unsaved changes",children:e.jsx("p",{children:'You have unsaved bot selections. Please click "Save Settings" before configuring robots.txt.'})}),e.jsx(v,{children:e.jsx("p",{children:["growth","growth_extra","enterprise"].includes(b(t==null?void 0:t.plan))?"With your plan, you can apply robots.txt changes directly to your theme!":"Copy the generated rules and add them to your theme's robots.txt.liquid file."})}),e.jsxs(A,{gap:"200",children:[e.jsx(x,{onClick:async()=>{console.log("[ADD MANUAL] Starting..."),console.log("[ADD MANUAL] Settings:",t);try{const o=Object.values((t==null?void 0:t.bots)||{}).some(s=>s.enabled);console.log("[ADD MANUAL] Has selected bots:",o),o?(console.log("[ADD MANUAL] Calling generateRobotsTxt..."),await ae(),console.log("[ADD MANUAL] Robots.txt generated, showing instructions"),X(!0)):(console.log("[ADD MANUAL] No bots, showing modal"),Y(!0))}catch(o){console.error("[ADD MANUAL] Error:",o),d("Error generating robots.txt: "+o.message)}},children:"Add manually"}),["growth","growth_extra","enterprise"].includes(b(t==null?void 0:t.plan))&&e.jsx(x,{primary:!0,onClick:async()=>{console.log("[APPLY AUTO] Starting..."),console.log("[APPLY AUTO] Settings:",t),console.log("[APPLY AUTO] Bots:",t==null?void 0:t.bots);try{const o=Object.values((t==null?void 0:t.bots)||{}).some(a=>a.enabled);if(console.log("[APPLY AUTO] Has selected bots:",o),!o){console.log("[APPLY AUTO] No bots selected, showing modal"),Y(!0);return}console.log("[APPLY AUTO] Applying robots.txt...");const s=await T(`/api/ai-discovery/apply-robots?shop=${n}`,{method:"POST",shop:n,body:{shop:n}});console.log("[APPLY AUTO] Data:",s),d(s.message||"robots.txt applied successfully!")}catch(o){console.error("[APPLY AUTO] Error:",o),d(o.message)}},children:"Apply Automatically"})]})]})})}),e.jsx(E,{paddingInlineStart:"600",paddingInlineEnd:"600",children:e.jsxs(A,{align:"center",blockAlign:"center",children:[e.jsx(E,{children:e.jsx(oo,{source:to,color:"subdued"})}),e.jsx(S,{variant:"bodySm",tone:"subdued",children:"Configure what data the AI bots can access"})]})}),e.jsx(w,{children:e.jsx(E,{padding:"400",children:e.jsxs(p,{gap:"400",children:[e.jsx(S,{as:"h2",variant:"headingMd",children:"AI Discovery Features"}),e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Select the features you want to enable for AI bots to consume your store data."}),e.jsx(v,{status:"info",children:`Don't forget to click "Save Settings" after making changes.`}),e.jsx(ne,{}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1rem"},children:[{key:"productsJson",name:"Products JSON Feed",description:"Bulk product data for AI consumption",requiredPlan:"Starter"},{key:"storeMetadata",name:"Store Metadata for AI Search",description:"Organization schema & AI metadata",requiredPlan:"Professional"},{key:"welcomePage",name:"AI Welcome Page",description:"Landing page for AI bots",requiredPlan:"Growth"},{key:"collectionsJson",name:"Collections JSON Feed",description:"Category data for better AI understanding",requiredPlan:"Growth"},{key:"aiSitemap",name:"AI-Optimized Sitemap",description:"Enhanced sitemap with AI hints",requiredPlan:"Growth Extra"},{key:"schemaData",name:"Advanced Schema Data",description:"BreadcrumbList, FAQPage & more",requiredPlan:"Enterprise"}].map(o=>{var l,g;const s=Pe(o.key),a=!!((l=t==null?void 0:t.features)!=null&&l[o.key]);return console.log(`[SETTINGS DEBUG] Feature ${o.key}:`,{isAvailable:s,isEnabled:a,rawValue:(g=t==null?void 0:t.features)==null?void 0:g[o.key],plan:t==null?void 0:t.plan,normalizedPlan:b(t==null?void 0:t.plan)}),e.jsx(E,{padding:"200",background:s?"bg-surface":"bg-surface-secondary",borderRadius:"200",borderWidth:"025",borderColor:"border",children:s?e.jsxs(A,{align:"space-between",blockAlign:"center",children:[e.jsx(E,{flexGrow:1,children:e.jsx(W,{label:o.name,checked:a,onChange:()=>De(o.key),helpText:o.description})}),o.key==="aiSitemap"&&He&&e.jsx(x,{size:"slim",onClick:()=>q(o.key,o.name),children:"View"}),o.key==="productsJson"&&(console.log("[SETTINGS DEBUG] Products JSON button check:"),console.log("[SETTINGS DEBUG] - feature.key === productsJson:",o.key==="productsJson"),console.log("[SETTINGS DEBUG] - showProductsJsonView:",re),console.log("[SETTINGS DEBUG] - Should show button:",o.key==="productsJson"&&re),o.key==="productsJson"&&re)&&e.jsx(x,{size:"slim",onClick:()=>q(o.key,o.name),children:"View"}),o.key==="collectionsJson"&&(console.log("[SETTINGS DEBUG] Collections JSON button check:"),console.log("[SETTINGS DEBUG] - feature.key === collectionsJson:",o.key==="collectionsJson"),console.log("[SETTINGS DEBUG] - showCollectionsJsonView:",ce),console.log("[SETTINGS DEBUG] - Should show button:",o.key==="collectionsJson"&&ce),o.key==="collectionsJson"&&ce)&&e.jsx(x,{size:"slim",onClick:()=>q(o.key,o.name),children:"View"}),o.key==="storeMetadata"&&(console.log("[SETTINGS DEBUG] ===== STORE METADATA BUTTON RENDER ====="),console.log("[SETTINGS DEBUG] feature.key === storeMetadata:",o.key==="storeMetadata"),console.log("[SETTINGS DEBUG] isEnabled:",a),console.log("[SETTINGS DEBUG] showStoreMetadataView:",ie),console.log("[SETTINGS DEBUG] Should show button:",o.key==="storeMetadata"&&a),console.log("[SETTINGS DEBUG] Button type:",ie?"View":"Configure"),console.log("[SETTINGS DEBUG] ===== END STORE METADATA BUTTON DEBUG ====="),o.key==="storeMetadata"&&a)&&(ie?e.jsx(x,{size:"slim",onClick:()=>q(o.key,o.name),children:"View"}):e.jsx(x,{size:"slim",variant:"primary",onClick:()=>{console.log("[SETTINGS DEBUG] Configure button clicked!");const c=`/ai-seo/store-metadata?shop=${n}`;console.log("[SETTINGS DEBUG] Opening URL:",c),window.open(c,"_blank")},children:"Configure"})),o.key==="welcomePage"&&Fe&&e.jsx(x,{size:"slim",onClick:()=>q(o.key,o.name),children:"View"})]}):e.jsx(W,{label:e.jsxs(A,{gap:"200",align:"center",children:[e.jsx(S,{variant:"bodySm",tone:"subdued",children:o.name}),o.requiredPlan&&e.jsxs(k,{tone:"info",size:"small",children:[o.requiredPlan,o.requiredPlan!=="Enterprise"&&"+"]})]}),checked:!1,onChange:()=>De(o.key),disabled:!0,helpText:`Upgrade to ${o.requiredPlan} plan to enable`})},o.key)})})]})})}),(()=>{var l,g;const o=b(t==null?void 0:t.plan)==="enterprise",s=(l=t==null?void 0:t.features)==null?void 0:l.schemaData,a=(g=Se==null?void 0:Se.features)==null?void 0:g.schemaData;return console.log("[SCHEMA-DEBUG] Advanced Schema Management visibility check:"),console.log("[SCHEMA-DEBUG] - Plan check (enterprise):",o),console.log("[SCHEMA-DEBUG] - Settings schemaData:",s),console.log("[SCHEMA-DEBUG] - Original schemaData:",a),console.log("[SCHEMA-DEBUG] - All conditions met:",o&&s&&a),o&&s&&a})()&&e.jsx(w,{children:e.jsx(E,{padding:"400",children:e.jsxs(p,{gap:"400",children:[e.jsx(S,{as:"h2",variant:"headingMd",children:"Advanced Schema Data Management"}),e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Generate and manage structured data for your products"}),e.jsxs(A,{gap:"300",children:[e.jsx(x,{primary:!0,onClick:async()=>{if(console.log("[SCHEMA-GEN] Button clicked!"),j.current){console.log("[SCHEMA-GEN] Already generating, ignoring click");return}try{console.log("[SCHEMA-GEN] Checking for existing data...");const o=await T(`/ai/schema-data.json?shop=${n}`);if(console.log("[SCHEMA-GEN] Existing data:",o),o.schemas&&o.schemas.length>0&&(console.log("[SCHEMA-GEN] Found existing schemas, asking for confirmation..."),!confirm("This will replace existing schema data. Continue?"))){console.log("[SCHEMA-GEN] User cancelled");return}console.log("[SCHEMA-GEN] Starting generation..."),console.log("[SCHEMA-GEN] ⚠️ BEFORE setState - schemaGenerating:",D),j.current=!0,y.current=0,console.log("[SCHEMA-GEN] 🔵 Set isGeneratingRef.current = true"),C(!0),console.log("[SCHEMA-GEN] 🔵 Set schemaGenerating state = true"),P(!1),ge({current:0,total:0,percent:10,currentProduct:"Initializing...",stats:{siteFAQ:!1,products:0,totalSchemas:0}}),console.log("[SCHEMA-GEN] ✅ AFTER setState - should be true now"),console.log("[SCHEMA-GEN] About to call api() function..."),console.log("[SCHEMA-GEN] api function exists:",typeof T),console.log("[SCHEMA-GEN] shop value:",n),console.log("[SCHEMA-GEN] Calling POST /api/schema/generate-all...");let s;try{s=await T(`/api/schema/generate-all?shop=${n}`,{method:"POST",shop:n,body:{shop:n}}),console.log("[SCHEMA-GEN] ✅ API call successful!")}catch(a){throw console.error("[SCHEMA-GEN] ❌ API call failed:",a),console.error("[SCHEMA-GEN] ❌ API error message:",a.message),console.error("[SCHEMA-GEN] ❌ API error stack:",a.stack),a}console.log("[SCHEMA-GEN] POST response:",s),console.log("[SCHEMA-GEN] 🕐 Scheduling progress check in 2 seconds..."),console.log("[SCHEMA-GEN] 🕐 Current schemaGenerating value:",D),setTimeout(()=>{console.log("[SCHEMA-GEN] ⏰ setTimeout fired! Calling checkGenerationProgress..."),we()},1e3)}catch(o){console.error("[SCHEMA-GEN] Error:",o),d("Failed to generate schema: "+(o.message||"Unknown error")),C(!1)}},children:"Generate/Update Schema Data"}),e.jsx(x,{onClick:()=>{window.open(`/ai/schema-data.json?shop=${n}`,"_blank")},children:"View Generated Schema"}),e.jsx(x,{destructive:!0,onClick:async()=>{if(confirm("This will delete all advanced schema data. Are you sure?"))try{await T(`/api/schema/delete?shop=${n}`,{method:"DELETE",shop:n,body:{shop:n}}),d("Schema data deleted successfully")}catch{d("Failed to delete schema data")}},children:"Delete Schema Data"})]}),e.jsx(v,{status:"info",tone:"subdued",children:e.jsxs("p",{children:["Generation creates BreadcrumbList, FAQPage, WebPage and more schemas for each product. AI can access them at ",e.jsx("code",{children:"/ai/product/[handle]/schemas.json"})]})})]})})}),e.jsxs(A,{gap:"200",align:"end",children:[e.jsx(x,{tone:"critical",onClick:async()=>{if(window.confirm("Are you sure you want to reset all AI Discovery settings to defaults?"))try{await T(`/api/ai-discovery/settings?shop=${n}`,{method:"DELETE",shop:n}),d("Settings reset successfully"),he(null),setTimeout(()=>{window.location.reload()},1e3)}catch(o){console.error("Failed to reset:",o),d("Failed to reset settings")}},children:"Reset to Defaults"}),e.jsx(x,{primary:!0,size:"large",loading:_,onClick:Xe,disabled:!t,children:"Save Settings"})]}),K&&e.jsx(N,{open:K,onClose:()=>H(!1),title:"robots.txt Configuration",primaryAction:{content:"Copy to clipboard",onAction:()=>{navigator.clipboard.writeText(Q),d("Copied to clipboard!")}},secondaryActions:[{content:"Close",onAction:()=>H(!1)}],children:e.jsx(N.Section,{children:e.jsxs(p,{gap:"400",children:[!["growth","growth_extra","enterprise"].includes(b(t==null?void 0:t.plan))&&e.jsx(v,{status:"info",title:"Manual Configuration Steps",children:e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:"Copy the robots.txt content below"}),e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Online Store → Themes"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Actions → Edit code"})," on your active theme"]}),e.jsxs("li",{children:["In the file browser, look for ",e.jsx("strong",{children:"robots.txt.liquid"})]}),e.jsxs("li",{children:["If it doesn't exist, click ",e.jsx("strong",{children:"Add a new template"}),' → Select "robots" → Create']}),e.jsx("li",{children:"Replace the content with what you copied"}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Save"})]})]})}),e.jsx(E,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:Q})})]})})}),fe&&e.jsx(N,{open:fe,onClose:()=>Y(!1),title:"No AI Bots Selected",primaryAction:{content:"Got it",onAction:()=>Y(!1)},children:e.jsx(N.Section,{children:e.jsxs(p,{gap:"400",children:[e.jsx(v,{status:"warning",children:e.jsx("p",{children:"You haven't selected any AI bots yet."})}),e.jsx(S,{children:"To configure robots.txt:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:'Select AI bots from the "AI Bot Access Control" section above'}),e.jsx("li",{children:'Click "Save Settings" to save your selections'}),e.jsx("li",{children:'Then click "Apply Automatically" to configure robots.txt'})]})]})})}),xe&&e.jsx(N,{open:xe,onClose:()=>X(!1),title:"Manual robots.txt Configuration",primaryAction:{content:"Continue",onAction:()=>{X(!1),H(!0)}},secondaryActions:[{content:"Cancel",onAction:()=>X(!1)}],children:e.jsx(N.Section,{children:e.jsxs(p,{gap:"400",children:[e.jsx(S,{variant:"headingMd",children:"How to add robots.txt manually:"}),e.jsxs("ol",{style:{marginLeft:"20px",marginTop:"10px"},children:[e.jsx("li",{children:'Click "Continue" to see your custom robots.txt content'}),e.jsx("li",{children:"Copy the generated content"}),e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Online Store → Themes"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Actions → Edit code"})," on your active theme"]}),e.jsxs("li",{children:["Find or create ",e.jsx("strong",{children:"robots.txt.liquid"})," file"]}),e.jsx("li",{children:"Paste the content and save"})]}),e.jsx(v,{status:"info",children:e.jsx("p",{children:"This allows AI bots to discover and properly index your products."})})]})})}),e.jsx(w,{children:e.jsx(E,{padding:"400",children:e.jsxs(p,{gap:"400",children:[e.jsx(S,{as:"h2",variant:"headingMd",children:"Test Plan Switcher (Dev Only)"}),e.jsxs(A,{gap:"200",children:[e.jsx(x,{onClick:()=>V("starter"),children:"Starter"}),e.jsx(x,{onClick:()=>V("professional"),children:"Professional"}),e.jsx(x,{onClick:()=>V("growth"),children:"Growth"}),e.jsx(x,{onClick:()=>V("growth_extra"),children:"Growth Extra"}),e.jsx(x,{onClick:()=>V("enterprise"),children:"Enterprise"})]})]})})}),Ie&&e.jsx(N,{open:Ie,onClose:()=>{de(!1),U(null)},title:be,primaryAction:{content:"Copy",onAction:()=>{navigator.clipboard.writeText(Ne),d("Copied to clipboard!")},disabled:je},secondaryActions:[{content:"Close",onAction:()=>{de(!1),U(null)}}],children:e.jsx(N.Section,{children:e.jsx(E,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:je?e.jsxs(A,{align:"center",gap:"200",children:[e.jsx(Me,{size:"small"}),e.jsx(S,{variant:"bodyMd",children:be==="AI-Optimized Sitemap"?"Loading sitemap XML... This may take a moment for large stores.":"Loading..."})]}):e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:Ne})})})}),O("Modal states",{schemaGenerating:D,schemaComplete:J,modalShouldShow:D&&!J}),D&&!J&&e.jsx(N,{open:D,title:"Generating Advanced Schema Data",onClose:()=>{console.log("[SCHEMA-MODAL] ❌ Close button clicked"),j.current=!1,C(!1),P(!1),console.log("[SCHEMA-MODAL] States and ref reset to false")},children:e.jsx(N.Section,{children:e.jsxs(S,{children:["Modal is showing! Progress: ",B.percent,"%"]})})}),J&&e.jsx(N,{open:!0,title:"Schema Generation Complete",onClose:()=>{C(!1),P(!1)},primaryAction:{content:"View Generated Schemas",onAction:()=>{window.open(`/ai/schema-data.json?shop=${n}`,"_blank"),C(!1),P(!1)}},secondaryActions:[{content:"Close",onAction:()=>{C(!1),P(!1)}}],children:e.jsx(N.Section,{children:e.jsxs(p,{gap:"400",children:[e.jsx(v,{status:"success",title:"Generation successful!",children:e.jsx("p",{children:"Advanced schema data has been generated for your products."})}),e.jsx(S,{variant:"headingMd",children:"Generation Statistics"}),e.jsxs(A,{gap:"600",wrap:!0,children:[e.jsxs(E,{children:[e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Site FAQ"}),e.jsx(S,{variant:"headingLg",fontWeight:"bold",children:B.stats.siteFAQ?"✓":"—"})]}),e.jsxs(E,{children:[e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Products Processed"}),e.jsx(S,{variant:"headingLg",fontWeight:"bold",children:B.stats.products})]}),e.jsxs(E,{children:[e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Total Schemas"}),e.jsx(S,{variant:"headingLg",fontWeight:"bold",children:B.stats.totalSchemas})]})]}),e.jsx(E,{paddingBlockStart:"200",children:e.jsx(S,{variant:"bodySm",tone:"subdued",children:"Schemas are now available at /ai/product/[handle]/schemas.json"})})]})})}),D&&!J&&e.jsx(N,{open:!0,title:"Generating Advanced Schema Data",onClose:()=>{console.log("[SCHEMA-MODAL] Closing modal..."),j.current=!1,y.current=0,C(!1),P(!1)},noScroll:!0,children:e.jsx(N.Section,{children:e.jsxs(p,{gap:"400",children:[e.jsx(S,{variant:"bodyMd",children:"Generating schemas for your products..."}),e.jsx(so,{progress:B.percent,size:"small"}),e.jsx(S,{variant:"bodySm",tone:"subdued",children:"This process may take 1-2 minutes depending on the number of products."})]})})}),J&&e.jsx(N,{open:!0,title:"Schema Generation Complete",onClose:()=>{C(!1),P(!1)},primaryAction:{content:"View Generated Schemas",onAction:()=>{window.open(`/ai/schema-data.json?shop=${n}`,"_blank"),C(!1),P(!1)}},secondaryActions:[{content:"Close",onAction:()=>{C(!1),P(!1)}}],children:e.jsx(N.Section,{children:e.jsxs(p,{gap:"400",children:[e.jsx(v,{status:"success",title:"Generation successful!",children:e.jsx("p",{children:"Advanced schema data has been generated for your products."})}),e.jsx(S,{variant:"headingMd",children:"Generation Statistics"}),e.jsxs(A,{gap:"600",wrap:!0,children:[e.jsxs(E,{children:[e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Site FAQ"}),e.jsx(S,{variant:"headingLg",fontWeight:"bold",children:B.stats.siteFAQ?"✓":"—"})]}),e.jsxs(E,{children:[e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Products Processed"}),e.jsx(S,{variant:"headingLg",fontWeight:"bold",children:B.stats.products})]}),e.jsxs(E,{children:[e.jsx(S,{variant:"bodyMd",tone:"subdued",children:"Total Schemas"}),e.jsx(S,{variant:"headingLg",fontWeight:"bold",children:B.stats.totalSchemas})]})]}),e.jsx(E,{paddingBlockStart:"200",children:e.jsx(S,{variant:"bodySm",tone:"subdued",children:"Schemas are now available at /ai/product/[handle]/schemas.json"})})]})})}),u&&e.jsx(ao,{content:u,onDismiss:()=>d("")}),e.jsx(E,{paddingBlockStart:"400",children:e.jsx(no,{shop:n})})]}):e.jsx(w,{children:e.jsx(E,{padding:"400",children:e.jsx(S,{tone:"critical",children:"Missing shop parameter"})})})}catch(o){return console.error("[SETTINGS] Component render error:",o),e.jsx(p,{gap:"400",children:e.jsx(w,{children:e.jsxs(E,{padding:"400",children:[e.jsx(S,{variant:"headingMd",children:"Settings Error"}),e.jsx(E,{paddingBlockStart:"200",children:e.jsxs(S,{children:["Failed to load settings: ",o.message]})})]})})})}}export{mo as default};
