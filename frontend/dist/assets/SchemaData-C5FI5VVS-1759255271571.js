import{j as e}from"./app-bridge-crv_M_oB-1759255271571.js";import{r as u}from"./react-vendor-tAaa2TlE-1759255271571.js";import{m as _}from"./index-DeiPiOK8-1759255271571.js";import{C as d,a as r,d as c,r as H,T as a,h as f,t as $,I as l,g,B as m,u as o,i as z,D as q,k as L}from"./polaris-BxiQUbiQ-1759255271571.js";const T=(j,n="")=>{try{return new URLSearchParams(window.location.search).get(j)||n}catch{return n}};function G({shop:j}){const n=j||T("shop","");console.log("[SCHEMA-DATA] shopProp:",j),console.log('[SCHEMA-DATA] qs("shop"):',T("shop","")),console.log("[SCHEMA-DATA] final shop:",n),console.log("[SCHEMA-DATA] window.location.search:",window.location.search);const[S,b]=u.useState(0),[k,x]=u.useState(!0),[h,v]=u.useState({organization:null,website:null,products:[]}),[i,C]=u.useState(null),[w,p]=u.useState(""),A=u.useMemo(()=>_(),[]),[I,E]=u.useState("");u.useEffect(()=>{n&&y()},[n,A]);const y=async()=>{x(!0);try{console.log("[SCHEMA-DATA] loadSchemas - shop:",n);const s=`/api/schema/preview?shop=${encodeURIComponent(n)}`;console.log("[SCHEMA-DATA] loadSchemas - url:",s);const t=await A(s,{headers:{"X-Shop":n}});console.log("[SCHEMA-DATA] loadSchemas - response:",t),t.ok?(v(t.schemas),M(t.schemas)):p(`Error: ${t.error}`)}catch(s){console.error("[SCHEMA-DATA] loadSchemas - error:",s),p(`Failed to load schemas: ${s.message}`)}finally{x(!1)}},M=s=>{const t=[];s.organization&&t.push(s.organization),s.website&&t.push(s.website);const D=`<script type="application/ld+json">
${JSON.stringify(t,null,2)}
<\/script>`;E(D)},O=async()=>{x(!0);try{console.log("[SCHEMA-DATA] handleValidate - shop:",n);const s=`/api/schema/validate?shop=${encodeURIComponent(n)}`;console.log("[SCHEMA-DATA] handleValidate - url:",s);const t=await A(s,{headers:{"X-Shop":n}});console.log("[SCHEMA-DATA] handleValidate - response:",t),C(t),p(t.ok?"Validation complete!":"Validation found issues")}catch(s){console.error("[SCHEMA-DATA] handleValidate - error:",s),p(`Validation failed: ${s.message}`)}finally{x(!1)}},R=async()=>{x(!0);try{console.log("[SCHEMA-DATA] handleRegenerate - shop:",n);const s=`/api/schema/generate?shop=${encodeURIComponent(n)}`;console.log("[SCHEMA-DATA] handleRegenerate - url:",s);const t=await A(s,{method:"POST",headers:{"X-Shop":n},body:{shop:n}});console.log("[SCHEMA-DATA] handleRegenerate - response:",t),t.ok?(p("Schemas regenerated successfully!"),y()):p(`Error: ${t.error}`)}catch(s){console.error("[SCHEMA-DATA] handleRegenerate - error:",s),p(`Failed to regenerate: ${s.message}`)}finally{x(!1)}},V=[{id:"overview",content:"Overview",accessibilityLabel:"Overview"},{id:"installation",content:"Installation",accessibilityLabel:"Installation"},{id:"validation",content:"Validation",accessibilityLabel:"Validation"}];return k?e.jsx(d,{children:e.jsx(r,{padding:"400",children:e.jsxs(c,{gap:"400",align:"center",children:[e.jsx(H,{}),e.jsx(a,{children:"Loading schema data..."})]})})}):e.jsxs(e.Fragment,{children:[e.jsx(d,{children:e.jsx(r,{padding:"400",children:e.jsxs(c,{gap:"400",children:[e.jsx(a,{as:"h3",variant:"headingMd",children:"Schema.org Structured Data"}),e.jsx(f,{tone:"info",children:e.jsx(a,{children:"Schema.org structured data helps AI models understand your store content better, improving your visibility and search results."})}),e.jsxs($,{tabs:V,selected:S,onSelect:b,children:[S===0&&e.jsx(r,{paddingBlockStart:"400",children:e.jsxs(c,{gap:"400",children:[e.jsx(d,{children:e.jsx(r,{padding:"300",children:e.jsxs(c,{gap:"300",children:[e.jsxs(l,{align:"space-between",children:[e.jsx(a,{as:"h4",variant:"headingSm",children:"Organization Schema"}),e.jsx(g,{tone:h.organization?"success":"warning",children:h.organization?"Active":"Not configured"})]}),!h.organization&&e.jsx(a,{as:"p",tone:"subdued",children:"Configure organization details in Store Metadata to enable this schema."})]})})}),e.jsx(d,{children:e.jsx(r,{padding:"300",children:e.jsxs(c,{gap:"300",children:[e.jsxs(l,{align:"space-between",children:[e.jsx(a,{as:"h4",variant:"headingSm",children:"WebSite Schema"}),e.jsx(g,{tone:h.website?"success":"warning",children:h.website?"Active":"Not configured"})]}),!h.website&&e.jsx(a,{as:"p",tone:"subdued",children:"Website schema is automatically generated from your store information."})]})})}),e.jsx(d,{children:e.jsx(r,{padding:"300",children:e.jsxs(c,{gap:"300",children:[e.jsxs(l,{align:"space-between",children:[e.jsx(a,{as:"h4",variant:"headingSm",children:"Product Schemas"}),e.jsx(g,{tone:"success",children:"Auto-generated"})]}),e.jsxs(a,{tone:"subdued",children:["Product schemas are automatically generated from your AI Optimisation data when pages load.",h.products.length>0&&` ${h.products.length} products have SEO data.`]})]})})}),e.jsxs(l,{gap:"300",children:[e.jsx(m,{onClick:R,loading:k,children:"Regenerate Schemas"}),e.jsx(m,{variant:"plain",url:"https://developers.google.com/search/docs/appearance/structured-data",children:"Learn about Schema.org"})]})]})}),S===1&&e.jsx(r,{paddingBlockStart:"400",children:e.jsxs(c,{gap:"400",children:[e.jsx(d,{children:e.jsx(r,{padding:"300",children:e.jsxs(c,{gap:"300",children:[e.jsx(a,{as:"h4",variant:"headingSm",children:"Theme Installation"}),e.jsxs(o,{type:"number",children:[e.jsx(o.Item,{children:"Go to your Shopify Admin → Online Store → Themes"}),e.jsx(o.Item,{children:'Click "Actions" → "Edit code" on your current theme'}),e.jsxs(o.Item,{children:["Open the file: ",e.jsx("code",{children:"layout/theme.liquid"})]}),e.jsxs(o.Item,{children:["Add this code before the closing ",e.jsx("code",{children:"</head>"})," tag:"]})]}),e.jsx(r,{background:"bg-surface-secondary",padding:"200",borderRadius:"200",children:e.jsx("pre",{style:{fontSize:"12px",overflow:"auto",whiteSpace:"pre-wrap"},children:`{% comment %} Organization & WebSite Schema - AI SEO App {% endcomment %}
${I}

{% comment %} Product Schema - Dynamic {% endcomment %}
{% if template contains 'product' %}
  {% assign seo_bullets = product.metafields.seo_ai.bullets %}
  {% assign seo_faq = product.metafields.seo_ai.faq %}
  {% assign seo_data = product.metafields.seo_ai['seo__' | append: request.locale.iso_code] | default: product.metafields.seo_ai.seo__en %}
  
  {% if seo_data %}
    <script type="application/ld+json">
    {{ seo_data.jsonLd | json }}
    <\/script>
  {% endif %}
{% endif %}`})}),e.jsx(f,{tone:"warning",children:e.jsx(a,{children:"Always backup your theme before making changes!"})})]})})}),e.jsx(d,{children:e.jsx(r,{padding:"300",children:e.jsxs(c,{gap:"300",children:[e.jsx(a,{as:"h4",variant:"headingSm",children:"Testing Your Installation"}),e.jsxs(o,{children:[e.jsx(o.Item,{children:"After installation, visit your store's homepage and product pages"}),e.jsx(o.Item,{children:"View the page source (right-click → View Source)"}),e.jsxs(o.Item,{children:["Search for ",e.jsx("code",{children:"application/ld+json"})," to find your schemas"]}),e.jsx(o.Item,{children:"Use the Validation tab to test with Google's tools"})]})]})})})]})}),S===2&&e.jsx(r,{paddingBlockStart:"400",children:e.jsxs(c,{gap:"400",children:[e.jsx(d,{children:e.jsx(r,{padding:"300",children:e.jsxs(c,{gap:"300",children:[e.jsx(a,{as:"h4",variant:"headingSm",children:"Validation Tools"}),e.jsx(z,{label:"Test URL",value:`https://${n}`,readOnly:!0,helpText:"Use this URL to test your schemas in the tools below"}),e.jsx(q,{}),e.jsxs(c,{gap:"200",children:[e.jsxs(l,{align:"space-between",children:[e.jsx(a,{children:"Google Rich Results Test"}),e.jsx(m,{url:`https://search.google.com/test/rich-results?url=${encodeURIComponent(`https://${n}`)}`,external:!0,variant:"plain",children:"Open Tool"})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(a,{children:"Schema Markup Validator"}),e.jsx(m,{url:`https://validator.schema.org/#url=${encodeURIComponent(`https://${n}`)}`,external:!0,variant:"plain",children:"Open Tool"})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(a,{children:"Google Search Console"}),e.jsx(m,{url:"https://search.google.com/search-console",external:!0,variant:"plain",children:"Open Console"})]})]})]})})}),i&&e.jsx(d,{children:e.jsx(r,{padding:"300",children:e.jsxs(c,{gap:"300",children:[e.jsx(a,{as:"h4",variant:"headingSm",children:"Internal Validation Results"}),e.jsx(g,{tone:i.ok?"success":"warning",children:i.ok?"All checks passed":"Issues found"}),i.checks&&e.jsxs(c,{gap:"200",children:[e.jsxs(o,{children:[e.jsx(o.Item,{children:e.jsxs(l,{gap:"200",align:"space-between",children:[e.jsxs(l,{gap:"200",children:[e.jsx(a,{children:"hasStoreMetadata:"}),e.jsx(g,{tone:i.checks.hasStoreMetadata?"success":"critical",children:i.checks.hasStoreMetadata?"✓":"✗"})]}),!i.checks.hasStoreMetadata&&e.jsx(m,{size:"slim",variant:"plain",onClick:()=>{b(0),setTimeout(()=>{const s=document.querySelector('[id="store-metadata"]');s&&s.click()},100)},children:"Add store metadata →"})]})}),e.jsx(o.Item,{children:e.jsxs(l,{gap:"200",align:"space-between",children:[e.jsxs(l,{gap:"200",children:[e.jsx(a,{children:"hasProductsWithSEO:"}),e.jsx(g,{tone:i.checks.hasProductsWithSEO?"success":"critical",children:i.checks.hasProductsWithSEO?"✓":"✗"})]}),!i.checks.hasProductsWithSEO&&e.jsx(m,{size:"slim",variant:"plain",onClick:()=>{b(0),setTimeout(()=>{const s=document.querySelector('[id="products"]');s&&s.click()},100)},children:"Generate product SEO →"})]})}),e.jsx(o.Item,{children:e.jsxs(l,{gap:"200",children:[e.jsx(a,{children:"hasThemeInstallation:"}),e.jsx(g,{tone:i.checks.hasThemeInstallation==="manual_check_required"?"info":"success",children:i.checks.hasThemeInstallation==="manual_check_required"?"?":"✓"}),e.jsx(a,{tone:"subdued",variant:"bodySm",children:"Manual check required"})]})}),e.jsx(o.Item,{children:e.jsxs(l,{gap:"200",children:[e.jsx(a,{children:"hasValidSchemas:"}),e.jsx(g,{tone:i.checks.hasValidSchemas?"success":"critical",children:i.checks.hasValidSchemas?"✓":"✗"})]})})]}),!i.checks.hasStoreMetadata&&e.jsx(f,{tone:"warning",children:e.jsx(a,{children:"Missing store metadata. This is needed for Organization schema."})}),!i.checks.hasProductsWithSEO&&e.jsx(f,{tone:"warning",children:e.jsx(a,{children:"No products have Optimisation data. Generate AI Optimisation for products first."})})]})]})})}),e.jsx(m,{onClick:O,loading:k,variant:"primary",children:"Run Validation Check"})]})})]})]})})}),w&&e.jsx(L,{content:w,onDismiss:()=>p("")})]})}export{G as default};
