import{r as e,j as t}from"./react-vendor-BLtYaay5.js";import{u as n}from"./useShopApi-Dxe2kUKp.js";import{U as s}from"./UpgradeModal-Bz-hPgmd.js";import{I as a,T as i}from"./TrialActivationModal-CmZNJenq.js";import{T as l}from"./TokenPurchaseModal-ChVK648j.js";import{S as r}from"./StoreMetadataBanner-3fUD1Drv.js";import{M as o,a as d,T as c,e as u,d as p,b as h,B as g,I as m,g as f,f as x,C as j,h as v,S,i as b,j as y,k as P,l as k,R as A,m as w,n as C,o as $,p as z,E}from"./polaris-BgbORwUH.js";import"./app-bridge-DUY42B6P.js";import"./vendor-L4_WdQez.js";const I=e=>{if(!e)return e;const t=String(e).trim();return t.startsWith("gid://")?t:`gid://shopify/Product/${t}`},R=e=>e<=70?"Starter":e<=200?"Professional":e<=450?"Growth":e<=750?"Growth Extra":"Enterprise";function O({shop:O,globalPlan:T}){var M,U,L,D,F;const{api:N,shop:B}=n(),q=O||B||((e,t="")=>{try{return new URLSearchParams(window.location.search).get(e)||t}catch{return t}})("shop","");e.useEffect(()=>{},[q,N]);const[W,_]=e.useState([]),[Y,G]=e.useState(!1),[H,V]=e.useState(1),[K,J]=e.useState(!0),[Q,X]=e.useState(0),[Z,ee]=e.useState(50),[te,ne]=e.useState(1),[se,ae]=e.useState([]),[ie,le]=e.useState(!1),[re,oe]=e.useState(!1),[de,ce]=e.useState(!1),[ue,pe]=e.useState(""),[he,ge]=e.useState("all"),[me,fe]=e.useState("all"),[xe,je]=e.useState(""),[ve,Se]=e.useState("createdAt"),[be,ye]=e.useState("desc"),[Pe,ke]=e.useState([]),[Ae,we]=e.useState([]),[Ce,$e]=e.useState(!1),[ze,Ee]=e.useState(!1),[Ie,Re]=e.useState(!1),[Oe,Te]=e.useState(!1),[Me,Ue]=e.useState(!1),[Le,De]=e.useState(""),[Fe,Ne]=e.useState([]),[Be,qe]=e.useState([]),[We,_e]=e.useState([]),[Ye,Ge]=e.useState(!1),[He,Ve]=e.useState({current:0,total:0,percent:0}),[Ke,Je]=e.useState(""),[Qe,Xe]=e.useState([]),[Ze,et]=e.useState(!1),[tt,nt]=e.useState(!1),[st,at]=e.useState([]),[it,lt]=e.useState(!1),[rt,ot]=e.useState(!1),[dt,ct]=e.useState("skipped"),[ut,pt]=e.useState([]),[ht,gt]=e.useState(""),[mt,ft]=e.useState({inProgress:!1,status:"idle",message:null,totalProducts:0,processedProducts:0,successfulProducts:0,failedProducts:0,skippedProducts:0,completedAt:null,progress:null,pendingNoSeoFailed:0,pendingNoSeoReasons:[]}),xt=e.useRef(null),[jt,vt]=e.useState({inProgress:!1,status:"idle",phase:null,message:null,totalProducts:0,processedProducts:0,successfulProducts:0,failedProducts:0,skippedProducts:0,progress:null}),St=e.useRef(null),bt=e.useRef(null),yt=e.useRef(1),[Pt,kt]=e.useState(0),[At,wt]=e.useState(0);e.useEffect(()=>{var e;null!=(null==(e=jt.progress)?void 0:e.remainingSeconds)&&kt(jt.progress.remainingSeconds)},[null==(M=jt.progress)?void 0:M.remainingSeconds]),e.useEffect(()=>{var e;null!=(null==(e=mt.progress)?void 0:e.remainingSeconds)&&wt(mt.progress.remainingSeconds)},[null==(U=mt.progress)?void 0:U.remainingSeconds]),e.useEffect(()=>{if(!jt.inProgress)return;const e=setInterval(()=>{kt(e=>Math.max(0,e-1))},1e3);return()=>clearInterval(e)},[jt.inProgress]),e.useEffect(()=>{if(!mt.inProgress)return;const e=setInterval(()=>{wt(e=>Math.max(0,e-1))},1e3);return()=>clearInterval(e)},[mt.inProgress]);const[Ct,$t]=e.useState({inProgress:!1,status:"idle",message:null,totalProducts:0,processedProducts:0,deletedProducts:0,failedProducts:0,completedAt:null}),[zt,Et]=e.useState(null),[It,Rt]=e.useState(70),[Ot,Tt]=e.useState(1),[Mt,Ut]=e.useState(!1),[Lt,Dt]=e.useState("true"===localStorage.getItem("hasVisitedProducts")),[Ft,Nt]=e.useState(!1),[Bt,qt]=e.useState(!1),[Wt,_t]=e.useState(!1),[Yt,Gt]=e.useState(!1),[Ht,Vt]=e.useState(null),[Kt,Jt]=e.useState("starter"),[Qt,Xt]=e.useState(!1),Zt=e.useCallback(async()=>{try{const e=await N(`/api/seo/job-status?shop=${q}`);return vt(t=>{if(t.inProgress&&!e.inProgress&&("completed"===e.status||"failed"===e.status)){if(St.current&&(clearInterval(St.current),St.current=null),"completed"===e.status){const t=`Applied GEO to ${e.successfulProducts} product${1!==e.successfulProducts?"s":""}`+(e.skippedProducts>0?` (${e.skippedProducts} skipped)`:"")+(e.failedProducts>0?` (${e.failedProducts} failed)`:"");gt(t)}else gt(`GEO optimization failed: ${e.message||"Unknown error"}`);bt.current&&bt.current(yt.current,!1,Date.now())}return e}),e}catch(e){}},[q,N,he,me,ue,ve,be]),en=e.useCallback(()=>{St.current&&clearInterval(St.current),vt(e=>({...e,inProgress:!0})),Zt(),St.current=setInterval(()=>{Zt()},5e3)},[Zt]);e.useEffect(()=>()=>{St.current&&clearInterval(St.current)},[]),e.useEffect(()=>{q&&N&&Zt().then(e=>{(null==e?void 0:e.inProgress)&&en()})},[q]),e.useEffect(()=>{if(T&&"object"==typeof T&&!Qt&&"starter"===Kt)if(T.planKey&&""!==T.planKey){Jt(T.planKey);const e=T.language_limit||1,t=T.product_limit||70;Tt(e),Rt(t)}else if(T.plan&&""!==T.plan){const e=T.plan.toLowerCase().replace(/\s+/g,"-");Jt(e);const t=T.language_limit||1,n=T.product_limit||70;Tt(t),Rt(n)}},[T,Kt,Qt]),e.useEffect(()=>{if(Ft&&zt){(re?Q:se.length)<=It&&(Nt(!1),Vt(null))}},[se.length,ie,re,Q,Ft,zt]),e.useEffect(()=>{if(!q)return;N("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n      query PlansMe($shop:String!) {\n        plansMe(shop:$shop) {\n          plan\n          planKey\n          modelsSuggested\n          product_limit\n          language_limit\n        }\n      }\n    ",variables:{shop:q}})}).then(e=>{var t,n,s;if(null==(t=null==e?void 0:e.errors)?void 0:t.length)throw new Error((null==(n=e.errors[0])?void 0:n.message)||"GraphQL error");const a=null==(s=null==e?void 0:e.data)?void 0:s.plansMe,i=(null==a?void 0:a.modelsSuggested)||["anthropic/claude-3.5-sonnet"];Ne(i.map(e=>({label:e,value:e}))),De(i[0]),Et((null==a?void 0:a.plan)||"starter"),Jt((null==a?void 0:a.planKey)||"starter");const l=(null==a?void 0:a.product_limit)||70,r=(null==a?void 0:a.language_limit)||1;Rt(l),Tt(r),Xt(!0)}).catch(e=>{Xt(!0)})},[q,N]),e.useEffect(()=>{if(!q)return;const e=new Promise((e,t)=>{setTimeout(()=>t(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([N(`/api/languages/shop/${q}`),e]).then(e=>{const t=Array.isArray(null==e?void 0:e.shopLanguages)&&e.shopLanguages.length?e.shopLanguages:["en"];_e(t.includes("en")?t:["en",...t])}).catch(e=>{_e(["en"])})},[q,N]),e.useEffect(()=>{q&&N("/api/products/tags/list",{shop:q}).then(e=>we((null==e?void 0:e.tags)||[])).catch(e=>{})},[q,N]);const tn=e.useCallback(async(e=1,t=!1,n=null)=>{var s,a;G(!0);try{const i=new URLSearchParams({shop:q,page:e,limit:Z,..."all"!==he&&{optimized:he},..."all"!==me&&{aiEnhanced:me},...ue&&{search:ue},...xe&&{languageFilter:xe},...Pe.length>0&&{tags:Pe.join(",")},sortBy:ve,sortOrder:be,...n&&{_t:n}}),l=await N(`/api/products/list?${i}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});_(t?e=>[...e,...l.products]:l.products||[]),V(e),J((null==(s=l.pagination)?void 0:s.hasNext)||!1);const r=(null==(a=l.pagination)?void 0:a.total)||0;X(r),ne(Math.ceil(r/Z)||1)}catch(i){_(t?W:[]),J(!1),gt(`Error loading products: ${i.message}`)}finally{G(!1)}},[q,he,me,ue,xe,Pe,ve,be,Z]);e.useEffect(()=>{bt.current=tn},[tn]),e.useEffect(()=>{yt.current=H},[H]),e.useEffect(()=>{q&&tn(1,!1,null)},[q,he,me,xe,Pe,ve,be,Z]),e.useEffect(()=>{!Lt&&q&&(localStorage.setItem("hasVisitedProducts","true"),Dt(!0))},[Lt,q]),e.useEffect(()=>{0!==W.length||Y||!q||Lt||Ut(!0)},[W.length,Y,q,Lt]),e.useEffect(()=>{},[W,se]);const nn=e.useCallback(e=>{pe(e)},[]);e.useEffect(()=>{const e=setTimeout(()=>{q&&tn(1,!1,null)},500);return()=>clearTimeout(e)},[ue]);const sn=e.useCallback(e=>{ae(e),(0===e.length||ie&&e.length<W.length)&&le(!1)},[ie,W.length]),an=e.useCallback(e=>{le(e),oe(!1),ae(e?W.map(e=>e.id):[])},[W]),ln=e.useCallback(async()=>{oe(!0),le(!0),ae(W.map(e=>e.id)),ce(!1)},[W]),rn=e.useCallback(()=>{oe(!1),le(!1),ae([]),ce(!1)},[]),on=e.useCallback(e=>{ee(parseInt(e,10)),V(1),ae([]),le(!1),oe(!1)},[]),dn=e.useCallback(()=>{H>1&&(tn(H-1,!1,null),ae([]),le(!1),oe(!1))},[H,tn]),cn=e.useCallback(()=>{H<te&&(tn(H+1,!1,null),ae([]),le(!1),oe(!1))},[H,te,tn]),un=e.useMemo(()=>{var e;if(re)return Be.length>Ot;const t=W.filter(e=>se.includes(e.id));if(0===t.length)return Be.length>Ot;for(const n of t){const t=(null==(e=n.optimizationSummary)?void 0:e.optimizedLanguages)||[],s=Be.filter(e=>!t.includes(e));if(t.length+s.length>Ot)return!0}return!1},[W,se,re,Ot,Be]),pn=e.useCallback(async()=>{try{const e=await N(`/ai-enhance/job-status?shop=${q}`);return ft(t=>{const n=t.inProgress&&!e.inProgress&&("completed"===e.status||"failed"===e.status),s=t.pendingNoSeoFailed||0,a=t.pendingNoSeoReasons||[];if(n){xt.current&&(clearInterval(xt.current),xt.current=null);const t=(e.failedProducts||0)+s,n=[...e.failReasons||[],...a];if("completed"===e.status){const n=`AI Enhanced ${e.successfulProducts} product${1!==e.successfulProducts?"s":""}`+(e.skippedProducts>0?` (${e.skippedProducts} skipped)`:"")+(t>0?` (${t} failed)`:"");gt(n)}else"failed"===e.status&&gt(`AI Enhancement failed: ${e.message||"Unknown error"}`);return bt.current&&bt.current(yt.current,!1,Date.now()),{...e,failedProducts:t,failReasons:n,pendingNoSeoFailed:0,pendingNoSeoReasons:[]}}return{...e,pendingNoSeoFailed:s,pendingNoSeoReasons:a}}),e}catch(e){}},[q,N]),hn=e.useCallback(()=>{xt.current&&clearInterval(xt.current),pn(),xt.current=setInterval(()=>{pn()},5e3)},[pn]);e.useEffect(()=>()=>{xt.current&&clearInterval(xt.current)},[]),e.useEffect(()=>{q&&pn().then(e=>{(null==e?void 0:e.inProgress)&&hn()})},[q,pn,hn]);const gn=async()=>{let e=[];if(re)try{gt("Loading all matching products...");const t=new URLSearchParams({shop:q,limit:"1000",fields:"id,title,gid,optimizationSummary"});"all"!==he&&t.append("optimized",he),"all"!==me&&t.append("aiEnhanced",me),ue&&t.append("search",ue),xe&&t.append("languageFilter",xe),Pe.length>0&&t.append("tags",Pe.join(","));e=(await N(`/api/products/list?${t.toString()}`)).products||[]}catch(d){return void gt("Failed to load all products")}else e=W.filter(e=>se.includes(e.id));const t=e.filter(e=>{var t,n;return(null==(n=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:n.length)>0}),n=e.filter(e=>{var t,n;return!(null==(n=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:n.length)}),s=t.filter(e=>{var t;return!0===(null==(t=e.optimizationSummary)?void 0:t.aiEnhanced)}),a=t.filter(e=>{var t;return!0!==(null==(t=e.optimizationSummary)?void 0:t.aiEnhanced)});if(0===t.length&&n.length>0)return void gt(`${n.length} product(s) have no Basic SEO. Generate Basic SEO first.`);if(0===e.length)return void gt("Please select products");if(0===a.length&&s.length>0)return void gt(`All ${s.length} selected product(s) are already AI Enhanced. No action needed.`);const i=a.length;if(i>It){const e=R(i);return Vt({error:"Product limit exceeded",message:`Your ${zt} plan supports up to ${It} products for AI Enhancement. You have selected ${i} products that need enhancement.`,minimumPlanRequired:e,currentPlan:zt,features:[`Optimize up to ${It} products`,"All features from your current plan","Growth Extra"===e||"Enterprise"===e?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons","Enterprise"===e?"Advanced Schema Data":null].filter(Boolean)}),void Nt(!0)}s.length>0&&gt(`Skipping ${s.length} already enhanced product(s). Processing ${a.length} product(s).`);const l=a.map(e=>({productId:e.gid||I(e.id),languages:e.optimizationSummary.optimizedLanguages,title:e.title}));if(0===l.length)return void gt("No products to enhance. All selected products are either already enhanced or missing Basic SEO.");const r=n.length,o=n.map(e=>`${e.title}: Basic SEO missing`);$t({inProgress:!1,status:"idle",message:null,completedAt:null}),vt({inProgress:!1,status:"idle",message:null});try{const e=await N("/ai-enhance/batch",{method:"POST",shop:q,body:{products:l,preFailed:{count:r,reasons:o}}});if(e.queued){const e=2.8*l.reduce((e,t)=>{var n;return e+((null==(n=t.languages)?void 0:n.length)||1)},0);ft(e=>({...e,pendingNoSeoFailed:r,pendingNoSeoReasons:o}));const t=l.length+r;gt(e>120?`Enhancing ${t} products in background. You'll receive an email when complete. Feel free to navigate away & explore other features.`:`Enhancing ${t} products in background. You can navigate away safely & explore other features.`),ae([]),le(!1),hn()}else gt(e.message||"Failed to queue AI Enhancement job")}catch(d){if(403===d.status)return Vt({...d,message:d.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),Jt(d.currentPlan||Kt),void(!1===d.needsUpgrade&&d.requiresPurchase?qt(!0):Nt(!0));if(402===d.status||d.requiresPurchase||d.trialRestriction)return Vt(d),Jt(d.currentPlan||zt||"starter"),void(d.trialRestriction&&d.requiresActivation?_t(!0):d.trialRestriction?Nt(!0):qt(!0));gt(`Error: ${d.message||"Failed to start AI Enhancement"}`)}},mn=e=>{if(!e)return"";const t=Math.floor((new Date-new Date(e))/1e3);if(t<60)return"just now";const n=Math.floor(t/60);if(n<60)return`${n}m ago`;const s=Math.floor(n/60);if(s<24)return`${s}h ago`;return`${Math.floor(s/24)}d ago`},fn=Ye&&t.jsx(o,{open:Ye,title:"Processing Products",onClose:()=>{},noScroll:!0,children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"400",children:[t.jsx(c,{variant:"bodyMd",children:Ke?`Processing: ${Ke}`:"Preparing..."}),t.jsx(u,{progress:He.percent}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:[He.current," of ",He.total," products (",He.percent,"%)"]})]})})}),xn=t.jsx(o,{open:Ze,title:"Select Languages",onClose:()=>{et(!1),qe([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:async()=>{var e;if(!Be.length)return void gt("Please select at least one language");let t=Le;t&&t.trim()||(t=(null==(e=Fe[0])?void 0:e.value)||"anthropic/claude-3.5-sonnet");try{let e=[];if(re){const t=new URLSearchParams({shop:q,limit:"1000",fields:"id,title,gid,optimizationSummary"});"all"!==he&&t.append("optimized",he),"all"!==me&&t.append("aiEnhanced",me),ue&&t.append("search",ue),xe&&t.append("languageFilter",xe),Pe.length>0&&t.append("tags",Pe.join(","));e=(await N(`/api/products/list?${t.toString()}`)).products||[]}else e=W.filter(e=>se.includes(e.id));const n=e.filter(e=>{var t;const n=(null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)||[];return Be.every(e=>n.includes(e))}),s=e.filter(e=>{var t;const n=(null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)||[];return Be.some(e=>!n.includes(e))});if(0===s.length&&n.length>0)return et(!1),void gt(`All ${n.length} selected product(s) are already optimized for ${Be.join(", ")}. No action needed.`);if(0===e.length)return et(!1),void gt("Please select products");const a=s.length;if(a>It){et(!1);const e=R(a);return Vt({error:"Product limit exceeded",message:`Your ${Kt} plan supports up to ${It} products for SEO optimization. You have selected ${a} products that need optimization.`,minimumPlanRequired:e,currentPlan:Kt,features:["Optimize more products","All features from your current plan","Growth Extra"===e||"Enterprise"===e?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons","Enterprise"===e?"Advanced Schema Data":null].filter(Boolean)}),void Nt(!0)}et(!1),n.length>0&&gt(`Skipping ${n.length} already optimized product(s). Processing ${s.length} product(s).`),$t({inProgress:!1,status:"idle",message:null,completedAt:null}),ft({inProgress:!1,status:"idle",message:null,completedAt:null});const i=s.map(e=>{var t;return{productId:e.gid||I(e.productId||e.id),title:e.title||"Unknown product",languages:Be,existingLanguages:(null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)||[]}});if(0===i.length)return void gt("No products to optimize. All selected products are already optimized.");const l=await N("/api/seo/generate-apply-batch",{method:"POST",shop:q,body:{shop:q,products:i,model:t}});if(l.queued){ae([]),le(!1);const e=1.3*i.length;gt(e>120?`Optimizing ${i.length} products in background. You'll receive an email when complete. Feel free to navigate away & explore other features.`:`Optimizing ${i.length} products in background. You can navigate away safely & explore other features.`),en()}else gt(l.message||"Failed to queue optimization job")}catch(n){gt(`Error: ${n.message}`)}},disabled:0===Be.length||un},secondaryActions:[{content:"Cancel",onAction:()=>{et(!1),qe([])}}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsxs(c,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",re?"all":se.length," selected products:"]}),un&&t.jsx(p,{tone:"warning",title:"Language limit exceeded",children:t.jsxs(d,{gap:"200",children:[t.jsxs(c,{variant:"bodyMd",children:["Your ",Kt," plan supports up to ",Ot," language",Ot>1?"s":""," per product.",1===se.length&&(null==(F=null==(D=null==(L=W.find(e=>e.id===se[0]))?void 0:L.optimizationSummary)?void 0:D.optimizedLanguages)?void 0:F.length)>0&&t.jsxs(t.Fragment,{children:[" This product already has ",W.find(e=>e.id===se[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),t.jsx(c,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),t.jsx(h,{variant:"primary",onClick:()=>{const e=new URLSearchParams(window.location.search),t=e.toString()?`?${e.toString()}`:"";window.location.href=`/billing${t}`},children:"Upgrade Plan"})]})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"200",wrap:!0,children:We.map(e=>t.jsx(f,{label:e.toUpperCase(),checked:Be.includes(e),onChange:t=>{qe(t?[...Be,e]:Be.filter(t=>t!==e))}},e))})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(h,{plain:!0,onClick:()=>{Be.length===We.length?qe([]):We.length>Ot?(qe([...We]),gt(`You selected ${We.length} languages. Your ${Kt} plan supports ${Ot}. Please deselect or upgrade.`)):qe([...We])},children:Be.length===We.length?"Deselect all":"Select all"})}),t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),jn=t.jsx(o,{open:tt,title:"Delete Optimization for AI Search",onClose:()=>{nt(!1),at([])},primaryAction:{content:"Continue",onAction:()=>{nt(!1),lt(!0)},disabled:0===st.length,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{nt(!1),at([])}}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsxs(c,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",re?"all":se.length," selected products:"]}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"200",wrap:!0,children:We.map(e=>t.jsx(f,{label:e.toUpperCase(),checked:st.includes(e),onChange:t=>{at(t?[...st,e]:st.filter(t=>t!==e))}},e))})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(h,{plain:!0,onClick:()=>{at(st.length===We.length?[]:[...We])},children:st.length===We.length?"Deselect all":"Select all"})}),t.jsx(c,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),vn=t.jsx(o,{open:it,title:"Confirm Deletion",onClose:()=>{lt(!1)},primaryAction:{content:"Delete",onAction:async()=>{var e;if(st.length){nt(!1),lt(!1);try{let t=[];if(re){const e=new URLSearchParams({shop:q,limit:"1000",fields:"id,gid,optimizationSummary"});"all"!==he&&e.append("optimized",he),"all"!==me&&e.append("aiEnhanced",me),ue&&e.append("search",ue),xe&&e.append("languageFilter",xe),Pe.length>0&&e.append("tags",Pe.join(","));t=(await N(`/api/products/list?${e.toString()}`)).products||[]}else t=W.filter(e=>se.includes(e.id));const n=[];let s=0;for(const r of t){const t=r.gid||I(r.productId||r.id),a=(null==(e=r.optimizationSummary)?void 0:e.optimizedLanguages)||[],i=st.filter(e=>a&&a.length>0&&a.includes(e));if(0!==i.length)for(const e of i)n.push({productId:t,language:e});else s++}if(0===n.length)return void gt("No optimized products found to delete");const a=[...new Set(n.map(e=>e.productId))].length;vt({inProgress:!1,status:"idle",message:null}),ft({inProgress:!1,status:"idle",message:null,completedAt:null}),$t({inProgress:!0,status:"processing",message:`Deleting 0/${a} products...`,totalProducts:a,processedProducts:0,deletedProducts:0,failedProducts:0,completedAt:null}),await N("/seo/bulk-delete-batch",{method:"POST",shop:q,body:{items:n}});const i=async()=>{try{const e=await N(`/seo/delete-job-status?shop=${encodeURIComponent(q)}&_t=${Date.now()}`);if(e.inProgress){const t=e.processedProducts||e.deletedProducts||0;return $t({inProgress:!0,status:"processing",message:`Deleting ${t}/${a} products...`,totalProducts:a,processedProducts:t,deletedProducts:e.deletedProducts||0,failedProducts:e.failedProducts||0,completedAt:null}),!1}if("completed"===e.status){const t=e.deletedProducts||0,n=e.failedProducts||0,i=new Set(se.map(e=>String(e)));return _(e=>e.map(e=>{var t,n;const s=String(e.productId||e.id);if(!i.has(s))return e;const a=((null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)||[]).filter(e=>!st.includes(e));return{...e,optimizationSummary:{...e.optimizationSummary,optimizedLanguages:a,optimized:a.length>0,aiEnhanced:a.length>0&&(null==(n=e.optimizationSummary)?void 0:n.aiEnhanced)}}})),ae([]),le(!1),vt({inProgress:!1,status:"idle",message:null}),$t({inProgress:!1,status:"completed",message:`Deleted ${t} product${1!==t?"s":""}${n>0?` (${n} failed)`:""}${s>0?` (${s} skipped)`:""}`,totalProducts:a,processedProducts:t+n,deletedProducts:t,failedProducts:n,completedAt:(new Date).toISOString()}),!0}return!1}catch(e){return!1}},l=setInterval(async()=>{await i()&&clearInterval(l)},500);return setTimeout(async()=>{await i()&&clearInterval(l)},200),void setTimeout(()=>{clearInterval(l),Ct.inProgress&&$t(e=>({...e,inProgress:!1,status:"failed",message:"Timeout - please refresh to check status"}))},3e5)}catch(t){gt(`Error: ${t.message}`),$t({inProgress:!1,status:"failed",message:t.message,totalProducts:0,processedProducts:0,deletedProducts:0,failedProducts:0,completedAt:null})}}else gt("Please select at least one language to delete")},destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>lt(!1)}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsx(c,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),t.jsx(g,{paddingBlock:"200",children:t.jsx(m,{gap:"100",children:st.map(e=>t.jsx(x,{tone:"critical",children:e.toUpperCase()},e))})}),t.jsxs(c,{variant:"bodyMd",children:["This will delete optimisation from ",re?"ALL":se.length," selected products."]}),t.jsx(c,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Sn=async()=>{try{G(!0),gt("Syncing products from Shopify...");const e=await N("/api/products/sync",{method:"POST",shop:q});if(!e.success)throw new Error(e.error||"Sync failed");{const t=e.productsCount||e.synced||0;gt(`✅ Synced ${t} products successfully!`),setTimeout(()=>{tn(1,!1,Date.now())},1e3)}}catch(e){gt(`❌ Sync failed: ${e.message}`)}finally{G(!1)}},bn=t.jsx(E,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{pe(""),ge("all"),je(""),ke([]),tn(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Sn},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:t.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return t.jsxs(t.Fragment,{children:[t.jsx(r,{globalPlan:T}),t.jsx(j,{children:t.jsx(g,{padding:"400",children:t.jsxs(d,{gap:"300",children:[zt&&t.jsx(p,{tone:"info",children:t.jsxs(m,{gap:"200",align:"space-between",children:[t.jsxs(c,{children:["Your ",t.jsx("strong",{children:zt})," plan includes up to"," ",t.jsx("strong",{children:It})," products for SEO optimization.",Q>It&&t.jsxs(t.Fragment,{children:[" You have ",Q," products, so only the first ",It," will be processed."]})]}),(se.length>0||ie||re)&&t.jsxs(c,{children:["Selected: ",re?Math.min(Q,It):se.length,"/",It]})]})}),zt&&(se.length>It||re&&Q>It)&&t.jsx(p,{tone:"critical",children:t.jsxs(d,{gap:"200",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),t.jsxs(c,{children:["Your ",t.jsx("strong",{children:zt})," plan supports up to ",t.jsx("strong",{children:It})," products. You have selected ",t.jsx("strong",{children:re?Q:se.length})," products."]}),t.jsx(c,{children:"Please deselect some products or upgrade your plan to continue."}),t.jsxs(m,{gap:"200",children:[t.jsx(h,{onClick:()=>{ae([]),le(!1)},children:"Clear Selection"}),t.jsx(h,{variant:"primary",onClick:()=>{Vt({error:"Product limit exceeded",message:`Your ${zt} plan supports up to ${It} products. Upgrade to ${R(re?Q:se.length)} to optimize more products.`,minimumPlanRequired:R(re?Q:se.length)}),Nt(!0)},children:"Upgrade Plan"})]})]})}),t.jsxs(m,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[t.jsx(g,{minWidth:"400px",children:t.jsx(v,{label:"",placeholder:"Search by product ID, name, or details...",value:ue,onChange:nn,prefix:t.jsx(S,{}),clearButton:!0,onClearButtonClick:()=>nn("")})}),t.jsx(g,{width:"320px",children:t.jsx(h,{primary:!0,onClick:()=>{0!==se.length||ie||re?et(!0):gt("Please select products first")},disabled:0===se.length&&!ie&&!re,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),t.jsxs(m,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[t.jsx(h,{onClick:Sn,disabled:Y,size:"medium",children:"Sync Products"}),t.jsx(g,{width:"320px",children:t.jsxs(d,{gap:"200",align:"end",children:[(()=>{if(0===se.length&&!ie&&!re)return null;if(!W.filter(e=>se.includes(e.id)).some(e=>{var t,n;return(null==(n=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:n.length)>0}))return null;const e=["professional","professional_plus","professional plus","growth","growth_plus","growth plus","growth_extra","growth extra","enterprise"].includes(Kt.toLowerCase().replace(/_/g," "));return t.jsx(h,{onClick:e?gn:()=>{Vt({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),Nt(!0)},disabled:0===se.length&&!ie&&!re,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),t.jsx(h,{onClick:()=>{0!==se.length||ie||re?(at([]),nt(!0)):gt("Please select products first")},disabled:0===se.length&&!ie&&!re||!W.filter(e=>se.includes(e.id)).some(e=>{var t,n;return(null==(n=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:n.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]})})}),(()=>{var e,n,s,a,i,l,r,o,p,f,v,S,y,P;const k=mt.inProgress||"completed"===mt.status||"failed"===mt.status,A=jt.inProgress||"completed"===jt.status||"failed"===jt.status;return k?t.jsx(g,{paddingBlockStart:"400",children:t.jsx(j,{children:t.jsx(g,{padding:"400",children:mt.inProgress?t.jsxs(d,{gap:"200",children:[t.jsxs(m,{align:"space-between",blockAlign:"center",children:[t.jsxs(m,{gap:"300",blockAlign:"center",children:[t.jsx(b,{size:"small"}),t.jsxs(d,{gap:"100",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"AI Enhancing Products..."}),t.jsx(c,{variant:"bodySm",tone:"subdued",children:(()=>{const e=mt.progress;if((null==e?void 0:e.current)&&(null==e?void 0:e.total)){let t=`Enhancing ${e.current}/${e.total} products`;return At>=60?t+=` • ~${Math.ceil(At/60)} min remaining`:At>0&&(t+=` • ~${At}s remaining`),t}return mt.message||`Processing ${mt.processedProducts}/${mt.totalProducts} products`})()})]})]}),t.jsx(h,{onClick:async()=>{try{await N(`/ai-enhance/job-cancel?shop=${q}`,{method:"POST"}),gt("Cancellation requested...")}catch(e){gt("Failed to cancel")}},size:"slim",variant:"tertiary",children:"Cancel"})]}),(null!=(null==(e=mt.progress)?void 0:e.percent)||mt.totalProducts>0)&&t.jsx(u,{progress:(null==(n=mt.progress)?void 0:n.percent)||mt.processedProducts/mt.totalProducts*100,size:"small"})]}):"completed"===mt.status?t.jsx(d,{gap:"100",children:t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"success",children:"AI Enhanced"}),t.jsxs(c,{variant:"bodyMd",children:["Enhanced ",mt.successfulProducts," product",1!==mt.successfulProducts?"s":""]}),mt.skippedProducts>0&&(null==(s=mt.skipReasons)?void 0:s.length)>0&&t.jsx(h,{variant:"plain",onClick:()=>{ct("skipped"),pt(mt.skipReasons),ot(!0)},children:t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["(",mt.skippedProducts," skipped)"]})}),mt.skippedProducts>0&&!(null==(a=mt.skipReasons)?void 0:a.length)&&t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["(",mt.skippedProducts," skipped)"]}),mt.failedProducts>0&&(null==(i=mt.failReasons)?void 0:i.length)>0&&t.jsx(h,{variant:"plain",onClick:()=>{ct("failed"),pt(mt.failReasons),ot(!0)},children:t.jsxs(c,{variant:"bodySm",tone:"critical",children:["(",mt.failedProducts," failed)"]})}),mt.failedProducts>0&&!(null==(l=mt.failReasons)?void 0:l.length)&&t.jsxs(c,{variant:"bodySm",tone:"critical",children:["(",mt.failedProducts," failed)"]}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["· ",mn(mt.completedAt)]})]})}):t.jsx(d,{gap:"100",children:t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"critical",children:"AI Enhancement Failed"}),t.jsx(c,{variant:"bodyMd",tone:"critical",children:mt.message||"Enhancement failed"}),mt.successfulProducts>0&&t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["· ",mt.successfulProducts," succeeded before failure"]}),(null==(r=mt.failReasons)?void 0:r.length)>0&&t.jsx(h,{variant:"plain",onClick:()=>{ct("failed"),pt(mt.failReasons),ot(!0)},children:t.jsxs(c,{variant:"bodySm",tone:"critical",children:["View ",mt.failReasons.length," errors"]})})]})})})})}):A?t.jsx(g,{paddingBlockStart:"400",children:t.jsx(j,{children:t.jsx(g,{padding:"400",children:jt.inProgress?t.jsxs(d,{gap:"200",children:[t.jsxs(m,{align:"space-between",blockAlign:"center",children:[t.jsxs(m,{gap:"300",blockAlign:"center",children:[t.jsx(b,{size:"small"}),t.jsxs(d,{gap:"100",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"generate"===jt.phase?"Generating GEO...":"Applying GEO..."}),t.jsx(c,{variant:"bodySm",tone:"subdued",children:(()=>{const e=jt.progress;if((null==e?void 0:e.current)&&(null==e?void 0:e.total)){let t=`Processing ${e.current}/${e.total} products`;return Pt>=60?t+=` • ~${Math.ceil(Pt/60)} min remaining`:Pt>0&&(t+=` • ~${Pt}s remaining`),t}return jt.message||`Processing ${jt.processedProducts}/${jt.totalProducts} products`})()})]})]}),t.jsx(h,{onClick:async()=>{try{await N(`/api/seo/job-cancel?shop=${q}`,{method:"POST"}),gt("Cancellation requested...")}catch(e){gt("Failed to cancel")}},size:"slim",variant:"tertiary",children:"Cancel"})]}),(null!=(null==(o=jt.progress)?void 0:o.percent)||jt.totalProducts>0)&&t.jsx(u,{progress:(null==(p=jt.progress)?void 0:p.percent)||jt.processedProducts/jt.totalProducts*100,size:"small"})]}):"completed"===jt.status?t.jsx(d,{gap:"100",children:t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"success",children:"Completed"}),t.jsxs(c,{variant:"bodyMd",children:["Applied GEO to ",jt.successfulProducts," product",1!==jt.successfulProducts?"s":""]}),jt.skippedProducts>0&&(null==(f=jt.skipReasons)?void 0:f.length)>0&&t.jsx(h,{variant:"plain",onClick:()=>{ct("skipped"),pt(jt.skipReasons),ot(!0)},children:t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["(",jt.skippedProducts," skipped)"]})}),jt.skippedProducts>0&&!(null==(v=jt.skipReasons)?void 0:v.length)&&t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["(",jt.skippedProducts," skipped)"]}),jt.failedProducts>0&&(null==(S=jt.failReasons)?void 0:S.length)>0&&t.jsx(h,{variant:"plain",onClick:()=>{ct("failed"),pt(jt.failReasons),ot(!0)},children:t.jsxs(c,{variant:"bodySm",tone:"critical",children:["(",jt.failedProducts," failed)"]})}),jt.failedProducts>0&&!(null==(y=jt.failReasons)?void 0:y.length)&&t.jsxs(c,{variant:"bodySm",tone:"critical",children:["(",jt.failedProducts," failed)"]}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["· ",mn(jt.completedAt)]})]})}):t.jsx(d,{gap:"100",children:t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"critical",children:"Failed"}),t.jsx(c,{variant:"bodyMd",tone:"critical",children:jt.message||"Optimization failed"}),jt.successfulProducts>0&&t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["· ",jt.successfulProducts," succeeded before failure"]}),(null==(P=jt.failReasons)?void 0:P.length)>0&&t.jsx(h,{variant:"plain",onClick:()=>{ct("failed"),pt(jt.failReasons),ot(!0)},children:t.jsxs(c,{variant:"bodySm",tone:"critical",children:["View ",jt.failReasons.length," errors"]})})]})})})})}):null})(),(Ct.inProgress||"completed"===Ct.status||"failed"===Ct.status)&&t.jsx(g,{paddingBlockStart:"400",children:t.jsx(j,{children:t.jsx(g,{padding:"400",children:Ct.inProgress?t.jsxs(m,{gap:"300",align:"start",blockAlign:"center",children:[t.jsx(b,{size:"small"}),t.jsxs(d,{gap:"100",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Deleting Optimization Data..."}),t.jsx(c,{variant:"bodySm",tone:"subdued",children:Ct.message||`Processing ${Ct.processedProducts}/${Ct.totalProducts} products`}),Ct.totalProducts>0&&t.jsx(g,{paddingBlockStart:"100",children:t.jsx(u,{progress:Ct.processedProducts/Ct.totalProducts*100,size:"small"})})]})]}):"completed"===Ct.status?t.jsx(d,{gap:"100",children:t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"info",children:"Deleted"}),t.jsx(c,{variant:"bodyMd",children:Ct.message}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["· ",mn(Ct.completedAt)]}),t.jsx(h,{variant:"plain",onClick:()=>$t({inProgress:!1,status:"idle",message:null}),children:t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Dismiss"})})]})}):t.jsx(d,{gap:"100",children:t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"critical",children:"Delete Failed"}),t.jsx(c,{variant:"bodyMd",tone:"critical",children:Ct.message||"Delete operation failed"}),t.jsx(h,{variant:"plain",onClick:()=>$t({inProgress:!1,status:"idle",message:null}),children:t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Dismiss"})})]})})})})}),t.jsx(g,{paddingBlockStart:"400",children:t.jsxs(j,{children:[t.jsxs(g,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[t.jsxs(m,{gap:"200",wrap:!0,align:"space-between",children:[t.jsxs(m,{gap:"200",wrap:!0,children:[t.jsx(y,{active:Ce,activator:t.jsx(h,{disclosure:"down",onClick:()=>$e(!Ce),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"Optimization Status"}),"all"!==he&&t.jsx(g,{onClick:e=>{e.stopPropagation(),ge("all")},children:t.jsx(c,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>$e(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(P,{title:"Optimization Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Optimized",value:"true"},{label:"Not Optimized",value:"false"}],selected:[he],onChange:e=>{ge(e[0]),je(""),$e(!1)}})})}),t.jsx(y,{active:ze,activator:t.jsx(h,{disclosure:"down",onClick:()=>Ee(!ze),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"AI Add-ons"}),"all"!==me&&t.jsx(g,{onClick:e=>{e.stopPropagation(),fe("all")},children:t.jsx(c,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Ee(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(P,{title:"AI Add-ons",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Add-ons",value:"true"},{label:"No AI Add-ons",value:"false"}],selected:[me],onChange:e=>{fe(e[0]),Ee(!1)}})})}),t.jsx(y,{active:Ie,activator:t.jsx(h,{disclosure:"down",onClick:()=>Re(!Ie),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"Language Status"}),xe&&t.jsx(g,{onClick:e=>{e.stopPropagation(),je("")},children:t.jsx(c,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Re(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(P,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...We.map(e=>({label:`Has ${e.toUpperCase()}`,value:`has_${e}`})),...We.map(e=>({label:`Missing ${e.toUpperCase()}`,value:`missing_${e}`}))],selected:xe?[xe]:[],onChange:e=>{je(e[0]||""),Re(!1)}})})}),t.jsx(y,{active:Oe,activator:t.jsx(h,{disclosure:"down",onClick:()=>Te(!Oe),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"Tags"}),Pe.length>0&&t.jsx(g,{onClick:e=>{e.stopPropagation(),ke([])},children:t.jsx(c,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Te(!1),children:t.jsxs(g,{padding:"300",minWidth:"200px",children:[t.jsx(P,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:Ae.map(e=>({label:e,value:e})),selected:Pe,onChange:e=>{ke(e)}}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(h,{size:"slim",onClick:()=>Te(!1),children:"Apply"})})]})})]}),t.jsx(y,{active:Me,activator:t.jsx(h,{disclosure:"down",onClick:()=>Ue(!Me),removeUnderline:!0,children:t.jsx(m,{gap:"100",blockAlign:"center",children:t.jsx("span",{children:"desc"===be?"Newest first":"Oldest first"})})}),onClose:()=>Ue(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(P,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[be],onChange:e=>{ye(e[0]),Ue(!1)}})})})]}),("all"!==he||"all"!==me||xe||Pe.length>0)&&t.jsx(g,{paddingBlockStart:"200",children:t.jsxs(m,{gap:"100",wrap:!0,children:["all"!==he&&t.jsx(x,{onRemove:()=>ge("all"),children:"true"===he?"Optimized":"Not Optimized"}),"all"!==me&&t.jsx(x,{onRemove:()=>fe("all"),children:"true"===me?"AI Add-ons":"No AI Add-ons"}),xe&&t.jsx(x,{onRemove:()=>je(""),children:xe.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())}),Pe.map(e=>t.jsxs(x,{onRemove:()=>ke(t=>t.filter(t=>t!==e)),children:["Tag: ",e]},e))]})})]}),t.jsxs(g,{children:[t.jsx(g,{paddingBlockEnd:"200",paddingInlineStart:"300",children:t.jsx(m,{gap:"200",align:"start",blockAlign:"center",children:t.jsx(y,{active:de,activator:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},onClick:()=>ce(!de),children:[t.jsx(f,{checked:se.length>0&&(se.length===W.length||re),indeterminate:se.length>0&&se.length<W.length&&!re,onChange:an,label:""}),t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:se.length>0?re?"all"!==he||"all"!==me||xe||Pe.length>0?`All ${Q} matching filter`:`All ${Q} selected`:`${se.length} selected`:"Select"}),t.jsx("span",{style:{fontSize:"10px",color:"#637381"},children:"▼"})]}),onClose:()=>ce(!1),preferredAlignment:"left",children:t.jsx(k,{items:[{content:`Select all ${W.length} on this page`,onAction:()=>{an(!0),ce(!1)},disabled:se.length===W.length&&!re},..."all"!==he||"all"!==me||xe||Pe.length>0?[{content:`Select all ${Q} matching filter`,onAction:()=>{ln(),ce(!1)},disabled:re}]:[{content:`Select all ${Q} in this store`,onAction:ln,disabled:re}],{content:"Deselect all",onAction:rn,disabled:0===se.length}]})})})}),t.jsx(A,{resourceName:{singular:"product",plural:"products"},items:W,renderItem:e=>{var n,s,a;try{const i=e,l=(e=>{if(!e)return"";const t=String(e).match(/\/(\d+)$/);return t?t[1]:e})(i.productId||i.id),r=(null==(n=i.optimizationSummary)?void 0:n.optimizedLanguages)||[],o=(null==(s=i.images)?void 0:s[0])?t.jsx($,{source:i.images[0].url||i.images[0].src||i.images[0],alt:i.title,size:"small"}):i.imageUrl?t.jsx($,{source:i.imageUrl,alt:i.title,size:"small"}):t.jsx(g,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return t.jsx(z,{id:i.id,media:o,accessibilityLabel:`View details for ${i.title}`,onClick:e=>{},children:t.jsxs(m,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[t.jsxs(g,{style:{flex:"1 1 40%",minWidth:"250px"},children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:i.title}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["ID: ",l]})]}),t.jsx(g,{style:{flex:"0 0 25%",minWidth:"160px"},children:t.jsxs(m,{gap:"100",wrap:!0,children:[(()=>{if(We.length>0)return We.map(e=>{const n=r.includes(e),s="DRAFT"===i.status;return t.jsx(x,{tone:s?"subdued":n?"success":"subdued",size:"small",children:e.toUpperCase()},e)});{const e="DRAFT"===i.status;return r.map(n=>t.jsx(x,{tone:e?"subdued":"success",size:"small",children:n.toUpperCase()},n))}})(),(null==(a=i.optimizationSummary)?void 0:a.aiEnhanced)&&"DRAFT"!==i.status&&t.jsx(x,{tone:"info",size:"small",children:"AI✨"})]})}),t.jsx(g,{style:{flex:"0 0 20%",minWidth:"120px",textAlign:"center"},children:"ACTIVE"===i.status?t.jsx(x,{tone:"success",children:"Active"}):"DRAFT"===i.status?t.jsx(x,{children:"Draft"}):"ARCHIVED"===i.status?t.jsx(x,{tone:"warning",children:"Archived"}):t.jsx(x,{children:i.status||"Unknown"})})]})})}catch(i){return null}},selectedItems:se,onSelectionChange:sn,selectable:!0,loading:Y,totalItemsCount:Q,emptyState:bn,showHeader:!1},`products-${W.length}-${se.length}`)]}),t.jsx(g,{padding:"400",borderBlockStart:"divider",children:t.jsxs(m,{align:"space-between",blockAlign:"center",children:[t.jsxs(m,{gap:"200",blockAlign:"center",children:[t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Show:"}),t.jsx(w,{label:"",labelHidden:!0,options:[{label:"10",value:"10"},{label:"20",value:"20"},{label:"50",value:"50"},{label:"100",value:"100"}],value:String(Z),onChange:on}),t.jsx(c,{variant:"bodySm",tone:"subdued",children:"per page"})]}),t.jsxs(m,{gap:"300",blockAlign:"center",children:[t.jsx(c,{variant:"bodySm",tone:"subdued",children:Q>0?`${(H-1)*Z+1}-${Math.min(H*Z,Q)} of ${Q}`:"0 products"}),t.jsxs(m,{gap:"100",children:[t.jsx(h,{icon:t.jsx("span",{style:{fontSize:"16px"},children:"‹"}),disabled:H<=1||Y,onClick:dn,accessibilityLabel:"Previous page"}),t.jsx(h,{icon:t.jsx("span",{style:{fontSize:"16px"},children:"›"}),disabled:H>=te||Y,onClick:cn,accessibilityLabel:"Next page"})]})]})]})})]})}),fn,xn,jn,vn,t.jsx(o,{open:rt,onClose:()=>ot(!1),title:"skipped"===dt?"Skipped Products":"Failed Products",primaryAction:{content:"Close",onAction:()=>ot(!1)},secondaryActions:[{content:"Copy to Clipboard",onAction:async()=>{const e=ut.join("\n");try{await navigator.clipboard.writeText(e),gt("Copied to clipboard")}catch(t){const n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),gt("Copied to clipboard")}}}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsx(c,{variant:"bodyMd",tone:"subdued",children:"skipped"===dt?"These products were skipped because they are already optimized for the selected languages:":"These products failed to optimize:"}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(d,{gap:"200",children:ut.map((e,n)=>t.jsx(g,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:t.jsx(c,{variant:"bodySm",tone:"failed"===dt?"critical":"subdued",children:e})},n))})})]})})}),t.jsx(o,{open:Mt,onClose:()=>Ut(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Ut(!1),Sn()}},secondaryActions:[{content:"Skip for now",onAction:()=>Ut(!1)}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsx(c,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),t.jsx(c,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),t.jsx(s,{open:Ft,onClose:()=>{Nt(!1),Vt(null)},featureName:(null==Ht?void 0:Ht.error)||"Feature",errorMessage:null==Ht?void 0:Ht.message,currentPlan:(null==Ht?void 0:Ht.currentPlan)||Kt,minimumPlanRequired:null==Ht?void 0:Ht.minimumPlanRequired,features:null==Ht?void 0:Ht.features}),Ht&&t.jsxs(t.Fragment,{children:[t.jsx(a,{open:Bt,onClose:()=>{qt(!1),Vt(null)},tokensRequired:Ht.tokensRequired||0,tokensAvailable:Ht.tokensAvailable||0,tokensNeeded:Ht.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:q,needsUpgrade:Ht.needsUpgrade||!1,minimumPlan:Ht.minimumPlanForFeature||null,currentPlan:Ht.currentPlan||Kt,returnTo:"/ai-seo",onBuyTokens:()=>{qt(!1),Gt(!0)}}),t.jsx(i,{open:Wt,onClose:()=>{_t(!1),Vt(null)},feature:Ht.feature||"ai-seo-product-enhanced",trialEndsAt:Ht.trialEndsAt,currentPlan:Ht.currentPlan||Kt,tokensRequired:Ht.tokensRequired||0,onActivatePlan:async()=>{try{const e=await N("/api/billing/activate",{method:"POST",body:{shop:q,endTrial:!0,returnTo:"/ai-seo"}});if(e.requiresApproval&&e.confirmationUrl)return void(window.top.location.href=e.confirmationUrl);window.location.reload()}catch(e){const t=new URLSearchParams(window.location.search),n=t.get("host"),s=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(q)}&embedded=${s}&host=${encodeURIComponent(n)}`}},onPurchaseTokens:()=>{_t(!1),Gt(!0)}})]}),t.jsx(l,{open:Yt,onClose:()=>{Gt(!1),Vt(null)},shop:q,returnTo:"/ai-seo",inTrial:!!(null==Ht?void 0:Ht.trialEndsAt)}),ht&&t.jsx(C,{content:ht,onDismiss:()=>gt("")})]})}export{O as default};
