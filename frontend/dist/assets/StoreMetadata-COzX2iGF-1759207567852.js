import{j as t}from"./app-bridge-Dv3akLCf-1759207567852.js";import{r as g}from"./react-vendor-tAaa2TlE-1759207567852.js";import{m as aa}from"./index-Dqp1pykh-1759207567852.js";import{C as M,a as p,T as j,h as ea,L as f,s as x,i as r,D as ta,f as F,I as V,t as oa,B as T,k as na}from"./polaris-pdvZxUe1-1759207567852.js";const sa=(w,h="")=>{try{return new URLSearchParams(window.location.search).get(w)||h}catch{return h}};function da({shop:w}){var I,R,P,$,O;const h=w||sa("shop",""),[G,k]=g.useState(!1),[H,B]=g.useState(!1),[A,S]=g.useState(""),[u,X]=g.useState(null),C=g.useMemo(()=>aa({}),[]),[K,E]=g.useState(!1),[W,v]=g.useState(!1),[s,i]=g.useState({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}});g.useEffect(()=>{h&&Y()},[h,C]);async function Y(){var e,a,c;k(!0);try{const o=`/api/store/generate?shop=${encodeURIComponent(h)}`;console.log("[StoreMeta] GET",o);const l=await C(o,{headers:{"X-Shop":h}});if(console.log("[StoreMeta] GET ok",{url:o,keys:Object.keys(l||{})}),console.log("[StoreMeta] storeData.features:",l.features),console.log("[StoreMeta] organizationSchema available:",(e=l.features)==null?void 0:e.organizationSchema),console.log("[StoreMeta] shopInfo:",l.shopInfo),console.log("[StoreMeta] shopInfo.name:",(a=l.shopInfo)==null?void 0:a.name),console.log("[StoreMeta] shopInfo.description:",(c=l.shopInfo)==null?void 0:c.description),X(l),l.existingMetadata){const n=l.existingMetadata;i(d=>{var y,b,m,D,L,N,U,q,_,J;return{...d,seo:{...d.seo,...((y=n.seo_metadata)==null?void 0:y.value)||{},keywords:Array.isArray((m=(b=n.seo_metadata)==null?void 0:b.value)==null?void 0:m.keywords)?n.seo_metadata.value.keywords.join(", "):((L=(D=n.seo_metadata)==null?void 0:D.value)==null?void 0:L.keywords)||d.seo.keywords||""},aiMetadata:((N=n.ai_metadata)==null?void 0:N.value)||d.aiMetadata,organizationSchema:{...d.organizationSchema,...((U=n.organization_schema)==null?void 0:U.value)||{},enabled:((_=(q=n.organization_schema)==null?void 0:q.value)==null?void 0:_.enabled)===!0},localBusinessSchema:((J=n.local_business_schema)==null?void 0:J.value)||d.localBusinessSchema}})}l.shopInfo&&(console.log("[StoreMeta] Setting shop info defaults..."),console.log("[StoreMeta] Current title:",s.seo.title),console.log("[StoreMeta] Current metaDescription:",s.seo.metaDescription),console.log("[StoreMeta] Shop name:",l.shopInfo.name),console.log("[StoreMeta] Shop description:",l.shopInfo.description),i(n=>{var d,y,b;return{...n,seo:{...n.seo,title:n.seo.title||l.shopInfo.name,metaDescription:n.seo.metaDescription||l.shopInfo.description},organizationSchema:{...n.organizationSchema,name:n.organizationSchema.name||l.shopInfo.name,email:n.organizationSchema.email||l.shopInfo.email},aiMetadata:{...n.aiMetadata,languages:((d=n.aiMetadata.languages)==null?void 0:d.length)>0?n.aiMetadata.languages:(l.shopInfo.locales||[]).filter(m=>m.published).map(m=>m.locale),supportedCurrencies:((y=n.aiMetadata.supportedCurrencies)==null?void 0:y.length)>0?n.aiMetadata.supportedCurrencies:l.shopInfo.currencies||["EUR"],shippingRegions:((b=n.aiMetadata.shippingRegions)==null?void 0:b.length)>0?n.aiMetadata.shippingRegions:(l.shopInfo.markets||[]).map(m=>m.name)}}}))}catch(o){console.error("[StoreMeta] GET error",(o==null?void 0:o.debug)||o,o),S(`Load failed: ${(o==null?void 0:o.message)||"Unknown error"}`)}finally{k(!1)}}async function z(){B(!0);try{const e=`/api/store/apply?shop=${encodeURIComponent(h)}`;console.log("[StoreMeta] SAVE",e);const a=await C(e,{method:"POST",headers:{"X-Shop":h},body:{metadata:s,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:s.organizationSchema.enabled,updateLocalBusiness:s.localBusinessSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:e,ok:a==null?void 0:a.ok}),S("Metadata saved successfully!")}catch(e){console.error("[StoreMeta] SAVE error",(e==null?void 0:e.debug)||e,e),S(`Save failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{B(!1)}}async function Q(){var e;E(!0);try{await z();const c=await C("/graphql",{method:"POST",headers:{"X-Shop":h},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            seoMetadata
            aiMetadata
            organizationSchema
            localBusinessSchema
          }
        }
      `,variables:{shop:h}}});if(c.error)throw new Error(c.error);const o=(e=c.data)==null?void 0:e.storeMetadata;if(o){const l=window.open("","_blank");console.log("[STORE-METADATA] Raw preview data:",o),console.log("[STORE-METADATA] seoMetadata raw:",o.seoMetadata),console.log("[STORE-METADATA] aiMetadata raw:",o.aiMetadata),console.log("[STORE-METADATA] organizationSchema raw:",o.organizationSchema);const n={shopName:o.shopName,description:o.description,seoMetadata:o.seoMetadata?(()=>{try{return JSON.parse(o.seoMetadata)}catch(d){return console.error("Error parsing seoMetadata:",d),o.seoMetadata}})():null,aiMetadata:o.aiMetadata?(()=>{try{return JSON.parse(o.aiMetadata)}catch(d){return console.error("Error parsing aiMetadata:",d),o.aiMetadata}})():null,organizationSchema:o.organizationSchema?(()=>{try{return JSON.parse(o.organizationSchema)}catch(d){return console.error("Error parsing organizationSchema:",d),o.organizationSchema}})():null,localBusinessSchema:o.localBusinessSchema?(()=>{try{return JSON.parse(o.localBusinessSchema)}catch(d){return console.error("Error parsing localBusinessSchema:",d),o.localBusinessSchema}})():null};l.document.write(`
          <html>
            <head>
              <title>Store Metadata Preview</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
                h1 { color: #333; }
                .section { margin: 20px 0; }
                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
              </style>
            </head>
            <body>
              <h1>Store Metadata Preview</h1>
              <div class="section">
                <h2>Basic Info</h2>
                <p><strong>Shop Name:</strong> ${n.shopName||"Not set"}</p>
                <p><strong>Description:</strong> ${n.description||"Not set"}</p>
              </div>
              
              <div class="section">
                <h2>SEO Metadata</h2>
                <pre>${JSON.stringify(n.seoMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>AI Metadata</h2>
                <pre>${JSON.stringify(n.aiMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Organization Schema</h2>
                <pre>${JSON.stringify(n.organizationSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Local Business Schema</h2>
                <pre>${JSON.stringify(n.localBusinessSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Raw Data</h2>
                <pre>${JSON.stringify(n,null,2)}</pre>
              </div>
            </body>
          </html>
        `),l.document.close()}else throw new Error("No preview data available")}catch(a){S(`Preview failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{E(!1)}}async function Z(){v(!0);try{i({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}}),await z(),S("Metadata cleared successfully!")}catch(e){S(`Clear failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{v(!1)}}return G&&!u?t.jsx(M,{children:t.jsx(p,{padding:"400",children:t.jsx(j,{children:"Loading store data..."})})}):(u==null?void 0:u.plan)==="Starter"?t.jsx(ea,{status:"warning",children:t.jsx(j,{children:"Store metadata features are available starting from the Professional plan."})}):t.jsxs(f,{children:[t.jsx(f.Section,{children:t.jsx(M,{title:"Basic Store Information",children:t.jsx(p,{padding:"400",children:t.jsxs(x,{children:[t.jsx(r,{label:"Store Title",value:s.seo.title,onChange:e=>i(a=>({...a,seo:{...a.seo,title:e}})),helpText:"Short & appealing, max 100 characters (auto-filled from shop name)",maxLength:100}),t.jsx(r,{label:"Store Description",value:s.seo.metaDescription,onChange:e=>i(a=>({...a,seo:{...a.seo,metaDescription:e}})),helpText:"Tell briefly what best describes your business, max 300 chars (auto-filled from shop description)",maxLength:300,multiline:3}),t.jsx(r,{label:"Keywords",value:s.seo.keywords,onChange:e=>i(a=>({...a,seo:{...a.seo,keywords:e}})),helpText:"Comma-separated keywords, max 10 keywords, max 3 words each"})]})})})}),t.jsx(f.Section,{children:t.jsx(M,{title:"AI Metadata",children:t.jsx(p,{padding:"400",children:t.jsxs(x,{children:[t.jsxs(x.Group,{children:[t.jsx(r,{label:"Business Type",value:s.aiMetadata.businessType,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,businessType:e}})),placeholder:"e.g., Fashion Retailer, Electronics Store",helpText:"Max 3 words"}),t.jsx(r,{label:"Target Audience",value:s.aiMetadata.targetAudience,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,targetAudience:e}})),placeholder:"e.g., Young professionals, Parents"})]}),t.jsx(r,{label:"Unique Selling Points",value:s.aiMetadata.uniqueSellingPoints,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,uniqueSellingPoints:e}})),helpText:"Comma-separated list",multiline:2}),t.jsx(r,{label:"Brand Voice",value:s.aiMetadata.brandVoice,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,brandVoice:e}})),placeholder:"e.g., Professional, Friendly, Casual"}),t.jsx(r,{label:"Primary Categories",value:s.aiMetadata.primaryCategories,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,primaryCategories:e}})),helpText:"Main product categories, comma-separated"}),t.jsx(r,{label:"Shipping Information",value:s.aiMetadata.shippingInfo,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,shippingInfo:e}})),helpText:"Shipping costs, delivery times, free shipping thresholds (e.g., Free shipping over $50, 2-3 business days)",multiline:2}),t.jsx(r,{label:"Return Policy",value:s.aiMetadata.returnPolicy,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,returnPolicy:e}})),multiline:2}),t.jsx(ta,{}),t.jsx(j,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),t.jsx(j,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),t.jsx(r,{label:"Supported Languages",value:((I=s.aiMetadata.languages)==null?void 0:I.join(", "))||"",onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,languages:e.split(",").map(c=>c.trim()).filter(c=>c)}})),helpText:"Comma-separated language codes (e.g., en, de, es, fr)",multiline:2}),t.jsx(r,{label:"Supported Currencies",value:((R=s.aiMetadata.supportedCurrencies)==null?void 0:R.join(", "))||"",onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,supportedCurrencies:e.split(",").map(c=>c.trim()).filter(c=>c)}})),helpText:"Comma-separated currency codes (e.g., EUR, USD, GBP)"}),t.jsx(r,{label:"Shipping Regions",value:((P=s.aiMetadata.shippingRegions)==null?void 0:P.join(", "))||"",onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,shippingRegions:e.split(",").map(c=>c.trim()).filter(c=>c)}})),helpText:"Comma-separated regions (e.g., EU, USA, UK, Canada)",multiline:2}),t.jsx(r,{label:"Cultural Considerations",value:s.aiMetadata.culturalConsiderations||"",onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,culturalConsiderations:e}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),(($=u==null?void 0:u.features)==null?void 0:$.organizationSchema)&&t.jsx(f.Section,{children:t.jsx(M,{title:"Organization Schema",children:t.jsxs(p,{padding:"400",children:[t.jsx(F,{label:"Enable Organization Schema",checked:s.organizationSchema.enabled,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,enabled:e}}))}),s.organizationSchema.enabled&&t.jsx(p,{paddingBlockStart:"400",children:t.jsxs(x,{children:[t.jsxs(x.Group,{children:[t.jsx(r,{label:"Organization Name",value:s.organizationSchema.name,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,name:e}}))}),t.jsx(r,{label:"Contact Email",value:s.organizationSchema.email,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,email:e}})),type:"email"})]}),t.jsx(r,{label:"Phone",value:s.organizationSchema.phone,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,phone:e}})),type:"tel"}),t.jsx(r,{label:"Logo URL",value:s.organizationSchema.logo,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,logo:e}})),type:"url"}),t.jsx(r,{label:"Social Media Links",value:s.organizationSchema.sameAs,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,sameAs:e}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}),((O=u==null?void 0:u.features)==null?void 0:O.localBusinessSchema)&&t.jsx(f.Section,{children:t.jsx(M,{title:"Local Business Schema",children:t.jsxs(p,{padding:"400",children:[t.jsxs(V,{align:"start",gap:"200",children:[t.jsx(F,{label:"Enable Local Business Schema",checked:s.localBusinessSchema.enabled,onChange:e=>i(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,enabled:e}}))}),t.jsx(oa,{content:"Optional - only enable if you have physical stores/locations",children:t.jsx(j,{variant:"bodyMd",color:"subdued",children:"ℹ️"})})]}),s.localBusinessSchema.enabled&&t.jsx(p,{paddingBlockStart:"400",children:t.jsxs(x,{children:[t.jsx(r,{label:"Price Range",value:s.localBusinessSchema.priceRange,onChange:e=>i(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,priceRange:e}})),helpText:"e.g., $, $$, $$$, $$$$"}),t.jsx(r,{label:"Opening Hours",value:s.localBusinessSchema.openingHours,onChange:e=>i(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,openingHours:e}})),helpText:"e.g., Mo-Fr 09:00-18:00, Sa 10:00-16:00",multiline:2})]})})]})})}),t.jsx(f.Section,{children:t.jsx(M,{children:t.jsx(p,{padding:"400",children:t.jsxs(V,{gap:"300",children:[t.jsx(T,{onClick:z,loading:H,primary:!0,children:"Save Metadata"}),t.jsx(T,{onClick:Q,loading:K,children:"Preview Metadata"}),t.jsx(T,{onClick:Z,loading:W,destructive:!0,children:"Clear Metadata"})]})})})}),A&&t.jsx(na,{content:A,onDismiss:()=>S("")})]})}export{da as default};
