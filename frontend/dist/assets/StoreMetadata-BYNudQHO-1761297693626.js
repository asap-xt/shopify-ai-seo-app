import{j as a}from"./app-bridge-Cc_mvh1R-1761297693626.js";import{r as u}from"./react-vendor-tAaa2TlE-1761297693626.js";import{m as Je}from"./sessionFetch-CJepNHo3-1761297693626.js";import{C as x,a as c,T as h,d as E,L as M,B as D,t as C,j as s,D as Ve,h as We,I as Ge,l as Xe}from"./polaris-C8gQN_3H-1761297693626.js";const He=(P,p="")=>{try{return new URLSearchParams(window.location.search).get(P)||p}catch{return p}};function ea({shop:P}){var _,F,q,J;const p=P||He("shop",""),[Pe,L]=u.useState(!1),[Ae,R]=u.useState(!1),[O,m]=u.useState(""),[f,Ee]=u.useState(null),v=u.useMemo(()=>Je({}),[]),[Le,I]=u.useState(!1),[Re,U]=u.useState(!1),[w,Oe]=u.useState({storeName:"",homePageTitle:"",metaDescription:""}),[Ie,$]=u.useState(!1),[i,o]=u.useState({seo:{storeName:"",shortDescription:"",fullDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""}});u.useEffect(()=>{p&&B()},[p,v]);async function B(){var t,e,l,n,j,g,S,V,W,G,X,H,K,Y,Q,Z,ee,ae;L(!0);try{const y=`/api/store/generate?shop=${encodeURIComponent(p)}`,r=await v(y,{headers:{"X-Shop":p}});Ee(r),Oe({storeName:((t=r.shopifyDefaults)==null?void 0:t.storeName)||"",homePageTitle:((e=r.shopifyDefaults)==null?void 0:e.homePageTitle)||"",metaDescription:((l=r.shopifyDefaults)==null?void 0:l.metaDescription)||""});const d=r.existingMetadata||{},z=((j=(n=d.seo_metadata)==null?void 0:n.value)==null?void 0:j.storeName)||"",T=((S=(g=d.seo_metadata)==null?void 0:g.value)==null?void 0:S.shortDescription)||"",N=((W=(V=d.seo_metadata)==null?void 0:V.value)==null?void 0:W.fullDescription)||"",te=z||((G=r.shopifyDefaults)==null?void 0:G.storeName)||"",ie=T||((X=r.shopifyDefaults)==null?void 0:X.homePageTitle)||"",oe=N||((H=r.shopifyDefaults)==null?void 0:H.metaDescription)||"";console.log("[StoreMeta] Loading SEO data:",{customStoreName:z,customShortDescription:T,customFullDescription:N,shopifyStoreName:(K=r.shopifyDefaults)==null?void 0:K.storeName,shopifyHomePageTitle:(Y=r.shopifyDefaults)==null?void 0:Y.homePageTitle,shopifyMetaDescription:(Q=r.shopifyDefaults)==null?void 0:Q.metaDescription,displayStoreName:te,displayShortDescription:ie,displayFullDescription:oe});const _e=z&&z!==((Z=r.shopifyDefaults)==null?void 0:Z.storeName),Fe=T&&T!==((ee=r.shopifyDefaults)==null?void 0:ee.homePageTitle),qe=N&&N!==((ae=r.shopifyDefaults)==null?void 0:ae.metaDescription);$(_e||Fe||qe),o(k=>{var ne,se,re,le,de,ce,he,pe,ue,ge,me,Se,fe,ye,xe,Me,je,be,De,Ce,ve,we,ze,Te,Ne,ke;return{...k,seo:{...k.seo,storeName:te,shortDescription:ie,fullDescription:oe,keywords:Array.isArray((se=(ne=d.seo_metadata)==null?void 0:ne.value)==null?void 0:se.keywords)?d.seo_metadata.value.keywords.join(", "):((le=(re=d.seo_metadata)==null?void 0:re.value)==null?void 0:le.keywords)||""},aiMetadata:{...k.aiMetadata,...((de=d.ai_metadata)==null?void 0:de.value)||{},languages:((pe=(he=(ce=d.ai_metadata)==null?void 0:ce.value)==null?void 0:he.languages)==null?void 0:pe.length)>0?d.ai_metadata.value.languages:(((ue=r.shopInfo)==null?void 0:ue.locales)||[]).filter(b=>b.published).map(b=>b.locale),supportedCurrencies:((Se=(me=(ge=d.ai_metadata)==null?void 0:ge.value)==null?void 0:me.supportedCurrencies)==null?void 0:Se.length)>0?d.ai_metadata.value.supportedCurrencies:((fe=r.shopInfo)==null?void 0:fe.currencies)||["EUR"],shippingRegions:((Me=(xe=(ye=d.ai_metadata)==null?void 0:ye.value)==null?void 0:xe.shippingRegions)==null?void 0:Me.length)>0?d.ai_metadata.value.shippingRegions:(((je=r.shopInfo)==null?void 0:je.markets)||[]).map(b=>b.name)},organizationSchema:{...k.organizationSchema,...((be=d.organization_schema)==null?void 0:be.value)||{},enabled:((Ce=(De=d.organization_schema)==null?void 0:De.value)==null?void 0:Ce.enabled)===!0,name:((we=(ve=d.organization_schema)==null?void 0:ve.value)==null?void 0:we.name)||((ze=r.shopInfo)==null?void 0:ze.name)||"",email:((Ne=(Te=d.organization_schema)==null?void 0:Te.value)==null?void 0:Ne.email)||((ke=r.shopInfo)==null?void 0:ke.email)||""}}})}catch(y){console.error("[StoreMeta] Load error:",y),m(`Load failed: ${(y==null?void 0:y.message)||"Unknown error"}`)}finally{L(!1)}}function Ue(){o(t=>({...t,seo:{...t.seo,storeName:"",shortDescription:"",fullDescription:""}})),$(!1),m("Synced with Shopify store settings")}async function A(){R(!0);try{const t=`/api/store/apply?shop=${encodeURIComponent(p)}`;console.log("[StoreMeta] SAVE",t);const e=await v(t,{method:"POST",headers:{"X-Shop":p},body:{metadata:i,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:i.organizationSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:t,ok:e==null?void 0:e.ok}),m("Metadata saved successfully!"),await B()}catch(t){console.error("[StoreMeta] SAVE error",(t==null?void 0:t.debug)||t,t),m(`Save failed: ${(t==null?void 0:t.message)||"Unknown error"}`)}finally{R(!1)}}async function $e(){var t;I(!0);try{await A();const l=await v("/graphql",{method:"POST",headers:{"X-Shop":p},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            shortDescription
            seoMetadata
            aiMetadata
            organizationSchema
          }
        }
      `,variables:{shop:p}}});if(l.error)throw new Error(l.error);const n=(t=l.data)==null?void 0:t.storeMetadata;if(n){const j=window.open("","_blank");console.log("[STORE-METADATA] Raw preview data:",n),console.log("[STORE-METADATA] seoMetadata raw:",n.seoMetadata),console.log("[STORE-METADATA] aiMetadata raw:",n.aiMetadata),console.log("[STORE-METADATA] organizationSchema raw:",n.organizationSchema);const g={shopName:n.shopName,shortDescription:n.shortDescription,description:n.description,seoMetadata:n.seoMetadata?(()=>{try{return JSON.parse(n.seoMetadata)}catch(S){return console.error("Error parsing seoMetadata:",S),n.seoMetadata}})():null,aiMetadata:n.aiMetadata?(()=>{try{return JSON.parse(n.aiMetadata)}catch(S){return console.error("Error parsing aiMetadata:",S),n.aiMetadata}})():null,organizationSchema:n.organizationSchema?(()=>{try{return JSON.parse(n.organizationSchema)}catch(S){return console.error("Error parsing organizationSchema:",S),n.organizationSchema}})():null};j.document.write(`
          <html>
            <head>
              <title>Store Metadata Preview</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
                h1 { color: #333; }
                .section { margin: 20px 0; }
                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
              </style>
            </head>
            <body>
              <h1>Store Metadata Preview</h1>
              <div class="section">
                <h2>Basic Info</h2>
                <p><strong>Shop Name:</strong> ${g.shopName||"Not set"}</p>
                <p><strong>Short Description:</strong> ${n.shortDescription||"Not set"}</p>
                <p><strong>Full Description:</strong> ${g.description||"Not set"}</p>
              </div>
              
              <div class="section">
                <h2>SEO Metadata</h2>
                <pre>${JSON.stringify(g.seoMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>AI Metadata</h2>
                <pre>${JSON.stringify(g.aiMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Organization Schema</h2>
                <pre>${JSON.stringify(g.organizationSchema,null,2)}</pre>
              </div>
              
              <!-- Local Business Schema - DISABLED -->
              <!-- <div class="section">
                <h2>Local Business Schema</h2>
                <pre>${JSON.stringify(g.localBusinessSchema,null,2)}</pre>
              </div> -->
              
              <div class="section">
                <h2>Raw Data</h2>
                <pre>${JSON.stringify(g,null,2)}</pre>
              </div>
            </body>
          </html>
        `),j.document.close()}else throw new Error("No preview data available")}catch(e){m(`Preview failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{I(!1)}}async function Be(){U(!0);try{o({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""}}),await A(),m("Metadata cleared successfully!")}catch(t){m(`Clear failed: ${(t==null?void 0:t.message)||"Unknown error"}`)}finally{U(!1)}}return Pe&&!f?a.jsx(x,{children:a.jsx(c,{padding:"400",children:a.jsx(h,{children:"Loading store data..."})})}):(f==null?void 0:f.plan)==="Starter"?a.jsx(E,{status:"warning",children:a.jsx(h,{children:"Store metadata features are available starting from the Professional plan."})}):a.jsxs(M,{children:[a.jsx(M.Section,{children:a.jsx(x,{title:"Basic Store Information",children:a.jsxs(c,{padding:"400",children:[a.jsx(E,{tone:"info",children:a.jsxs(c,{children:[a.jsx(h,{variant:"bodyMd",fontWeight:"semibold",children:"From Shopify Settings:"}),a.jsxs(c,{paddingBlockStart:"200",children:[a.jsxs(h,{variant:"bodySm",tone:"subdued",children:["Store name: ",a.jsx(h,{as:"span",fontWeight:"medium",children:w.storeName||"Not set"})]}),a.jsx(h,{variant:"bodySm",tone:"subdued"}),a.jsxs(h,{variant:"bodySm",tone:"subdued",children:["Meta description: ",a.jsx(h,{as:"span",fontWeight:"medium",children:w.metaDescription?w.metaDescription.substring(0,100)+(w.metaDescription.length>100?"...":""):"Not set"})]})]}),Ie&&a.jsx(c,{paddingBlockStart:"300",children:a.jsx(D,{size:"slim",onClick:Ue,children:"Sync from Shopify"})})]})}),a.jsx(c,{paddingBlockStart:"400",children:a.jsxs(C,{children:[a.jsx(s,{label:"Store Name",value:i.seo.storeName,onChange:t=>o(e=>({...e,seo:{...e.seo,storeName:t}})),helpText:"Loaded from Shopify. Edit if needed.",maxLength:100}),a.jsx(s,{label:"Short Store Description",value:i.seo.shortDescription,onChange:t=>o(e=>({...e,seo:{...e.seo,shortDescription:t}})),helpText:"Loaded from Shopify. Edit if needed - max 100 characters",maxLength:100}),a.jsx(s,{label:"Full Store Description",value:i.seo.fullDescription,onChange:t=>o(e=>({...e,seo:{...e.seo,fullDescription:t}})),helpText:"Loaded from Shopify. Edit if needed - max 300 characters",maxLength:300,multiline:3}),a.jsx(s,{label:"Keywords",value:i.seo.keywords,onChange:t=>o(e=>({...e,seo:{...e.seo,keywords:t}})),helpText:"Comma-separated keywords (optional)"})]})})]})})}),a.jsx(M.Section,{children:a.jsx(x,{title:"AI Metadata",children:a.jsx(c,{padding:"400",children:a.jsxs(C,{children:[a.jsxs(C.Group,{children:[a.jsx(s,{label:"Business Type",value:i.aiMetadata.businessType,onChange:t=>o(e=>({...e,aiMetadata:{...e.aiMetadata,businessType:t}})),placeholder:"e.g., Fashion Retailer, Electronics Store",helpText:"Max 3 words"}),a.jsx(s,{label:"Target Audience",value:i.aiMetadata.targetAudience,onChange:t=>o(e=>({...e,aiMetadata:{...e.aiMetadata,targetAudience:t}})),placeholder:"e.g., Young professionals, Parents"})]}),a.jsx(s,{label:"Unique Selling Points",value:i.aiMetadata.uniqueSellingPoints,onChange:t=>o(e=>({...e,aiMetadata:{...e.aiMetadata,uniqueSellingPoints:t}})),helpText:"Comma-separated list",multiline:2}),a.jsx(s,{label:"Brand Voice",value:i.aiMetadata.brandVoice,onChange:t=>o(e=>({...e,aiMetadata:{...e.aiMetadata,brandVoice:t}})),placeholder:"e.g., Professional, Friendly, Casual"}),a.jsx(s,{label:"Primary Categories",value:i.aiMetadata.primaryCategories,onChange:t=>o(e=>({...e,aiMetadata:{...e.aiMetadata,primaryCategories:t}})),helpText:"Main product categories, comma-separated"}),a.jsx(s,{label:"Shipping Information",value:i.aiMetadata.shippingInfo,onChange:t=>o(e=>({...e,aiMetadata:{...e.aiMetadata,shippingInfo:t}})),helpText:"Shipping costs, delivery times, free shipping thresholds (e.g., Free shipping over $50, 2-3 business days)",multiline:2}),a.jsx(s,{label:"Return Policy",value:i.aiMetadata.returnPolicy,onChange:t=>o(e=>({...e,aiMetadata:{...e.aiMetadata,returnPolicy:t}})),multiline:2}),a.jsx(Ve,{}),a.jsx(h,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),a.jsx(h,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),a.jsx(s,{label:"Supported Languages",value:((_=i.aiMetadata.languages)==null?void 0:_.join(", "))||"",onChange:t=>o(e=>({...e,aiMetadata:{...e.aiMetadata,languages:t.split(",").map(l=>l.trim()).filter(l=>l)}})),helpText:"Comma-separated language codes (e.g., en, de, es, fr)",multiline:2}),a.jsx(s,{label:"Supported Currencies",value:((F=i.aiMetadata.supportedCurrencies)==null?void 0:F.join(", "))||"",onChange:t=>o(e=>({...e,aiMetadata:{...e.aiMetadata,supportedCurrencies:t.split(",").map(l=>l.trim()).filter(l=>l)}})),helpText:"Comma-separated currency codes (e.g., EUR, USD, GBP)"}),a.jsx(s,{label:"Shipping Regions",value:((q=i.aiMetadata.shippingRegions)==null?void 0:q.join(", "))||"",onChange:t=>o(e=>({...e,aiMetadata:{...e.aiMetadata,shippingRegions:t.split(",").map(l=>l.trim()).filter(l=>l)}})),helpText:"Comma-separated regions (e.g., EU, USA, UK, Canada)",multiline:2}),a.jsx(s,{label:"Cultural Considerations",value:i.aiMetadata.culturalConsiderations||"",onChange:t=>o(e=>({...e,aiMetadata:{...e.aiMetadata,culturalConsiderations:t}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),(J=f==null?void 0:f.features)!=null&&J.organizationSchema?a.jsx(M.Section,{children:a.jsx(x,{title:"Organization Schema",children:a.jsxs(c,{padding:"400",children:[a.jsx(We,{label:"Enable Organization Schema",checked:i.organizationSchema.enabled,onChange:t=>o(e=>({...e,organizationSchema:{...e.organizationSchema,enabled:t}}))}),i.organizationSchema.enabled&&a.jsx(c,{paddingBlockStart:"400",children:a.jsxs(C,{children:[a.jsxs(C.Group,{children:[a.jsx(s,{label:"Organization Name",value:i.organizationSchema.name,onChange:t=>o(e=>({...e,organizationSchema:{...e.organizationSchema,name:t}}))}),a.jsx(s,{label:"Contact Email",value:i.organizationSchema.email,onChange:t=>o(e=>({...e,organizationSchema:{...e.organizationSchema,email:t}})),type:"email"})]}),a.jsx(s,{label:"Phone",value:i.organizationSchema.phone,onChange:t=>o(e=>({...e,organizationSchema:{...e.organizationSchema,phone:t}})),type:"tel"}),a.jsx(s,{label:"Logo URL",value:i.organizationSchema.logo,onChange:t=>o(e=>({...e,organizationSchema:{...e.organizationSchema,logo:t}})),type:"url"}),a.jsx(s,{label:"Social Media Links",value:i.organizationSchema.sameAs,onChange:t=>o(e=>({...e,organizationSchema:{...e.organizationSchema,sameAs:t}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}):a.jsx(M.Section,{children:a.jsx(x,{title:"Organization Schema",children:a.jsx(c,{padding:"400",children:a.jsx(E,{tone:"info",children:a.jsxs(c,{children:[a.jsx(h,{variant:"bodyMd",fontWeight:"semibold",children:"Upgrade to Professional+ to enable Organization Schema"}),a.jsx(h,{variant:"bodySm",tone:"subdued",children:"Organization Schema helps AI bots understand your business structure, contact information, and social media presence."}),a.jsx(c,{paddingBlockStart:"300",children:a.jsx(D,{primary:!0,onClick:()=>{const t=new URLSearchParams(window.location.search),e=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${e}`},children:"Upgrade Plan"})})]})})})})}),a.jsx(M.Section,{children:a.jsx(x,{children:a.jsx(c,{padding:"400",children:a.jsxs(Ge,{gap:"300",children:[a.jsx(D,{onClick:A,loading:Ae,primary:!0,children:"Save Metadata"}),a.jsx(D,{onClick:$e,loading:Le,children:"Preview Metadata"}),a.jsx(D,{onClick:Be,loading:Re,destructive:!0,children:"Clear Metadata"})]})})})}),O&&a.jsx(Xe,{content:O,onDismiss:()=>m("")})]})}export{ea as default};
