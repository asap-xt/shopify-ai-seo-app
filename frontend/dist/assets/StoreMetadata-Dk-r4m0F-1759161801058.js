import{j as t}from"./app-bridge-DZ6oCB_G-1759161801058.js";import{r as c}from"./react-vendor-tAaa2TlE-1759161801058.js";import{m as N}from"./index-BwWYbA4y-1759161801058.js";import{C as u,a as m,T as R,h as X,L as S,s as p,i as s,f as H,I as J,B as M,k as K}from"./polaris-CZDVxQfj-1759161801058.js";const W=(f,l="")=>{try{return new URLSearchParams(window.location.search).get(f)||l}catch{return l}};function ea({shop:f}){var k;const l=f||W("shop",""),[U,b]=c.useState(!1),[_,j]=c.useState(!1),[w,d]=c.useState(""),[h,D]=c.useState(null),x=c.useMemo(()=>N({}),[]),[O,C]=c.useState(!1),[$,z]=c.useState(!1),[n,o]=c.useState({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}});c.useEffect(()=>{l&&V()},[l,x]);async function V(){b(!0);try{const e=`/api/store/generate?shop=${encodeURIComponent(l)}`;console.log("[StoreMeta] GET",e);const a=await x(e,{headers:{"X-Shop":l}});if(console.log("[StoreMeta] GET ok",{url:e,keys:Object.keys(a||{})}),D(a),a.existingMetadata){const i=a.existingMetadata;o(r=>{var g,P,T,v,A,B,E,I,L,q;return{...r,seo:{...r.seo,...((g=i.seo_metadata)==null?void 0:g.value)||{},keywords:Array.isArray((T=(P=i.seo_metadata)==null?void 0:P.value)==null?void 0:T.keywords)?i.seo_metadata.value.keywords.join(", "):((A=(v=i.seo_metadata)==null?void 0:v.value)==null?void 0:A.keywords)||r.seo.keywords||""},aiMetadata:((B=i.ai_metadata)==null?void 0:B.value)||r.aiMetadata,organizationSchema:{...r.organizationSchema,...((E=i.organization_schema)==null?void 0:E.value)||{},enabled:((L=(I=i.organization_schema)==null?void 0:I.value)==null?void 0:L.enabled)===!0},localBusinessSchema:((q=i.local_business_schema)==null?void 0:q.value)||r.localBusinessSchema}})}a.shopInfo&&o(i=>({...i,seo:{...i.seo,title:i.seo.title||a.shopInfo.name},organizationSchema:{...i.organizationSchema,name:i.organizationSchema.name||a.shopInfo.name,email:i.organizationSchema.email||a.shopInfo.email}}))}catch(e){console.error("[StoreMeta] GET error",(e==null?void 0:e.debug)||e,e),d(`Load failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{b(!1)}}async function y(){j(!0);try{const e=`/api/store/apply?shop=${encodeURIComponent(l)}`;console.log("[StoreMeta] SAVE",e);const a=await x(e,{method:"POST",headers:{"X-Shop":l},body:{metadata:n,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:n.organizationSchema.enabled,updateLocalBusiness:n.localBusinessSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:e,ok:a==null?void 0:a.ok}),d("Metadata saved successfully!")}catch(e){console.error("[StoreMeta] SAVE error",(e==null?void 0:e.debug)||e,e),d(`Save failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{j(!1)}}async function F(){var e;C(!0);try{await y();const i=await x("/graphql",{method:"POST",headers:{"X-Shop":l},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            seoMetadata
            aiMetadata
            organizationSchema
            localBusinessSchema
          }
        }
      `,variables:{shop:l}}});if(i.error)throw new Error(i.error);const r=(e=i.data)==null?void 0:e.storeMetadata;if(r){const g=window.open("","_blank");g.document.write(`
          <html>
            <head><title>Store Metadata Preview</title></head>
            <body>
              <h1>Store Metadata Preview</h1>
              <pre>${JSON.stringify(r,null,2)}</pre>
            </body>
          </html>
        `),g.document.close()}else throw new Error("No preview data available")}catch(a){d(`Preview failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{C(!1)}}async function G(){z(!0);try{o({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}}),await y(),d("Metadata cleared successfully!")}catch(e){d(`Clear failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{z(!1)}}return U&&!h?t.jsx(u,{children:t.jsx(m,{padding:"400",children:t.jsx(R,{children:"Loading store data..."})})}):(h==null?void 0:h.plan)==="Starter"?t.jsx(X,{status:"warning",children:t.jsx(R,{children:"Store metadata features are available starting from the Professional plan."})}):t.jsxs(S,{children:[t.jsx(S.Section,{children:t.jsx(u,{title:"Basic Store Information",children:t.jsx(m,{padding:"400",children:t.jsxs(p,{children:[t.jsx(s,{label:"SEO Title",value:n.seo.title,onChange:e=>o(a=>({...a,seo:{...a.seo,title:e}})),helpText:"Title for search engines (max 70 chars)",maxLength:70}),t.jsx(s,{label:"Meta Description",value:n.seo.metaDescription,onChange:e=>o(a=>({...a,seo:{...a.seo,metaDescription:e}})),helpText:"Description for search results (150-160 chars)",maxLength:160,multiline:3}),t.jsx(s,{label:"Keywords",value:n.seo.keywords,onChange:e=>o(a=>({...a,seo:{...a.seo,keywords:e}})),helpText:"Comma-separated keywords"})]})})})}),t.jsx(S.Section,{children:t.jsx(u,{title:"AI Metadata",children:t.jsx(m,{padding:"400",children:t.jsxs(p,{children:[t.jsxs(p.Group,{children:[t.jsx(s,{label:"Business Type",value:n.aiMetadata.businessType,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,businessType:e}})),placeholder:"e.g., Fashion Retailer, Electronics Store"}),t.jsx(s,{label:"Target Audience",value:n.aiMetadata.targetAudience,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,targetAudience:e}})),placeholder:"e.g., Young professionals, Parents"})]}),t.jsx(s,{label:"Unique Selling Points",value:n.aiMetadata.uniqueSellingPoints,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,uniqueSellingPoints:e}})),helpText:"Comma-separated list",multiline:2}),t.jsx(s,{label:"Brand Voice",value:n.aiMetadata.brandVoice,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,brandVoice:e}})),placeholder:"e.g., Professional, Friendly, Casual"}),t.jsx(s,{label:"Primary Categories",value:n.aiMetadata.primaryCategories,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,primaryCategories:e}})),helpText:"Main product categories, comma-separated"}),t.jsx(s,{label:"Shipping Information",value:n.aiMetadata.shippingInfo,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,shippingInfo:e}})),multiline:2}),t.jsx(s,{label:"Return Policy",value:n.aiMetadata.returnPolicy,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,returnPolicy:e}})),multiline:2})]})})})}),((k=h==null?void 0:h.features)==null?void 0:k.organizationSchema)&&t.jsx(S.Section,{children:t.jsx(u,{title:"Organization Schema",children:t.jsxs(m,{padding:"400",children:[t.jsx(H,{label:"Enable Organization Schema",checked:n.organizationSchema.enabled,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,enabled:e}}))}),n.organizationSchema.enabled&&t.jsx(m,{paddingBlockStart:"400",children:t.jsxs(p,{children:[t.jsxs(p.Group,{children:[t.jsx(s,{label:"Organization Name",value:n.organizationSchema.name,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,name:e}}))}),t.jsx(s,{label:"Contact Email",value:n.organizationSchema.email,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,email:e}})),type:"email"})]}),t.jsx(s,{label:"Phone",value:n.organizationSchema.phone,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,phone:e}})),type:"tel"}),t.jsx(s,{label:"Logo URL",value:n.organizationSchema.logo,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,logo:e}})),type:"url"}),t.jsx(s,{label:"Social Media Links",value:n.organizationSchema.sameAs,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,sameAs:e}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}),t.jsx(S.Section,{children:t.jsx(u,{children:t.jsx(m,{padding:"400",children:t.jsxs(J,{gap:"300",children:[t.jsx(M,{onClick:y,loading:_,primary:!0,children:"Save Metadata"}),t.jsx(M,{onClick:F,loading:O,children:"Preview Metadata"}),t.jsx(M,{onClick:G,loading:$,destructive:!0,children:"Clear Metadata"})]})})})}),w&&t.jsx(K,{content:w,onDismiss:()=>d("")})]})}export{ea as default};
