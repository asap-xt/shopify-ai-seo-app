import{j as t}from"./app-bridge-B1Fa2h6V-1759208908924.js";import{r as m}from"./react-vendor-tAaa2TlE-1759208908924.js";import{m as la}from"./index-Caj34OOT-1759208908924.js";import{C as f,a as S,T as w,h as ra,L as x,s as y,i as r,D as ca,f as Y,I as Q,t as da,B,k as ha}from"./polaris-DIpdoCq3-1759208908924.js";const ga=(T,g="")=>{try{return new URLSearchParams(window.location.search).get(T)||g}catch{return g}};function Ma({shop:T}){var P,R,$,O,N;const g=T||ga("shop",""),[Z,A]=m.useState(!1),[aa,v]=m.useState(!1),[E,M]=m.useState(""),[u,ea]=m.useState(null),z=m.useMemo(()=>la({}),[]),[ta,I]=m.useState(!1),[oa,D]=m.useState(!1),[s,i]=m.useState({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}});m.useEffect(()=>{g&&na()},[g,z]);async function na(){var e,a,c,l;A(!0);try{const d=`/api/store/generate?shop=${encodeURIComponent(g)}`;console.log("[StoreMeta] GET",d);const n=await z(d,{headers:{"X-Shop":g}});if(console.log("[StoreMeta] GET ok",{url:d,keys:Object.keys(n||{})}),console.log("[StoreMeta] storeData.features:",n.features),console.log("[StoreMeta] organizationSchema available:",(e=n.features)==null?void 0:e.organizationSchema),console.log("[StoreMeta] shopInfo:",n.shopInfo),console.log("[StoreMeta] shopInfo.name:",(a=n.shopInfo)==null?void 0:a.name),console.log("[StoreMeta] shopInfo.description:",(c=n.shopInfo)==null?void 0:c.description),ea(n),n.existingMetadata){const o=n.existingMetadata;console.log("[StoreMeta] Found existing metadata:",o),console.log("[StoreMeta] existing.seo_metadata:",o.seo_metadata),console.log("[StoreMeta] existing.seo_metadata.value:",(l=o.seo_metadata)==null?void 0:l.value),i(h=>{var b,j,C,p,L,U,_,q,F,J,V,G,H,X,K,W;return{...h,seo:{...h.seo,...((b=o.seo_metadata)==null?void 0:b.value)||{},title:((C=(j=o.seo_metadata)==null?void 0:j.value)==null?void 0:C.title)||h.seo.title||((p=n.shopInfo)==null?void 0:p.name)||"",metaDescription:((U=(L=o.seo_metadata)==null?void 0:L.value)==null?void 0:U.metaDescription)||h.seo.metaDescription||((_=n.shopInfo)==null?void 0:_.description)||"",keywords:Array.isArray((F=(q=o.seo_metadata)==null?void 0:q.value)==null?void 0:F.keywords)?o.seo_metadata.value.keywords.join(", "):((V=(J=o.seo_metadata)==null?void 0:J.value)==null?void 0:V.keywords)||h.seo.keywords||""},aiMetadata:((G=o.ai_metadata)==null?void 0:G.value)||h.aiMetadata,organizationSchema:{...h.organizationSchema,...((H=o.organization_schema)==null?void 0:H.value)||{},enabled:((K=(X=o.organization_schema)==null?void 0:X.value)==null?void 0:K.enabled)===!0},localBusinessSchema:((W=o.local_business_schema)==null?void 0:W.value)||h.localBusinessSchema}})}n.shopInfo&&(console.log("[StoreMeta] Setting shop info defaults..."),console.log("[StoreMeta] Shop name:",n.shopInfo.name),console.log("[StoreMeta] Shop description:",n.shopInfo.description),i(o=>{var b,j,C;console.log("[StoreMeta] Previous formData:",o),console.log("[StoreMeta] Previous title:",o.seo.title),console.log("[StoreMeta] Previous metaDescription:",o.seo.metaDescription);const h={...o,seo:{...o.seo,title:o.seo.title||n.shopInfo.name,metaDescription:o.seo.metaDescription||n.shopInfo.description},organizationSchema:{...o.organizationSchema,name:o.organizationSchema.name||n.shopInfo.name,email:o.organizationSchema.email||n.shopInfo.email},aiMetadata:{...o.aiMetadata,languages:((b=o.aiMetadata.languages)==null?void 0:b.length)>0?o.aiMetadata.languages:(n.shopInfo.locales||[]).filter(p=>p.published).map(p=>p.locale),supportedCurrencies:((j=o.aiMetadata.supportedCurrencies)==null?void 0:j.length)>0?o.aiMetadata.supportedCurrencies:n.shopInfo.currencies||["EUR"],shippingRegions:((C=o.aiMetadata.shippingRegions)==null?void 0:C.length)>0?o.aiMetadata.shippingRegions:(n.shopInfo.markets||[]).map(p=>p.name)}};return console.log("[StoreMeta] New formData:",h),console.log("[StoreMeta] New title:",h.seo.title),console.log("[StoreMeta] New metaDescription:",h.seo.metaDescription),h}))}catch(d){console.error("[StoreMeta] GET error",(d==null?void 0:d.debug)||d,d),M(`Load failed: ${(d==null?void 0:d.message)||"Unknown error"}`)}finally{A(!1)}}async function k(){v(!0);try{const e=`/api/store/apply?shop=${encodeURIComponent(g)}`;console.log("[StoreMeta] SAVE",e);const a=await z(e,{method:"POST",headers:{"X-Shop":g},body:{metadata:s,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:s.organizationSchema.enabled,updateLocalBusiness:s.localBusinessSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:e,ok:a==null?void 0:a.ok}),M("Metadata saved successfully!")}catch(e){console.error("[StoreMeta] SAVE error",(e==null?void 0:e.debug)||e,e),M(`Save failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{v(!1)}}async function sa(){var e;I(!0);try{await k();const c=await z("/graphql",{method:"POST",headers:{"X-Shop":g},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            seoMetadata
            aiMetadata
            organizationSchema
            localBusinessSchema
          }
        }
      `,variables:{shop:g}}});if(c.error)throw new Error(c.error);const l=(e=c.data)==null?void 0:e.storeMetadata;if(l){const d=window.open("","_blank");console.log("[STORE-METADATA] Raw preview data:",l),console.log("[STORE-METADATA] seoMetadata raw:",l.seoMetadata),console.log("[STORE-METADATA] aiMetadata raw:",l.aiMetadata),console.log("[STORE-METADATA] organizationSchema raw:",l.organizationSchema);const n={shopName:l.shopName,description:l.description,seoMetadata:l.seoMetadata?(()=>{try{return JSON.parse(l.seoMetadata)}catch(o){return console.error("Error parsing seoMetadata:",o),l.seoMetadata}})():null,aiMetadata:l.aiMetadata?(()=>{try{return JSON.parse(l.aiMetadata)}catch(o){return console.error("Error parsing aiMetadata:",o),l.aiMetadata}})():null,organizationSchema:l.organizationSchema?(()=>{try{return JSON.parse(l.organizationSchema)}catch(o){return console.error("Error parsing organizationSchema:",o),l.organizationSchema}})():null,localBusinessSchema:l.localBusinessSchema?(()=>{try{return JSON.parse(l.localBusinessSchema)}catch(o){return console.error("Error parsing localBusinessSchema:",o),l.localBusinessSchema}})():null};d.document.write(`
          <html>
            <head>
              <title>Store Metadata Preview</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
                h1 { color: #333; }
                .section { margin: 20px 0; }
                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
              </style>
            </head>
            <body>
              <h1>Store Metadata Preview</h1>
              <div class="section">
                <h2>Basic Info</h2>
                <p><strong>Shop Name:</strong> ${n.shopName||"Not set"}</p>
                <p><strong>Description:</strong> ${n.description||"Not set"}</p>
              </div>
              
              <div class="section">
                <h2>SEO Metadata</h2>
                <pre>${JSON.stringify(n.seoMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>AI Metadata</h2>
                <pre>${JSON.stringify(n.aiMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Organization Schema</h2>
                <pre>${JSON.stringify(n.organizationSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Local Business Schema</h2>
                <pre>${JSON.stringify(n.localBusinessSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Raw Data</h2>
                <pre>${JSON.stringify(n,null,2)}</pre>
              </div>
            </body>
          </html>
        `),d.document.close()}else throw new Error("No preview data available")}catch(a){M(`Preview failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{I(!1)}}async function ia(){D(!0);try{i({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}}),await k(),M("Metadata cleared successfully!")}catch(e){M(`Clear failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{D(!1)}}return Z&&!u?t.jsx(f,{children:t.jsx(S,{padding:"400",children:t.jsx(w,{children:"Loading store data..."})})}):(u==null?void 0:u.plan)==="Starter"?t.jsx(ra,{status:"warning",children:t.jsx(w,{children:"Store metadata features are available starting from the Professional plan."})}):t.jsxs(x,{children:[t.jsx(x.Section,{children:t.jsx(f,{title:"Basic Store Information",children:t.jsx(S,{padding:"400",children:t.jsxs(y,{children:[t.jsx(r,{label:"Store Title",value:s.seo.title,onChange:e=>i(a=>({...a,seo:{...a.seo,title:e}})),helpText:"Short & appealing, max 100 characters (auto-filled from shop name)",maxLength:100}),t.jsx(r,{label:"Store Description",value:s.seo.metaDescription,onChange:e=>i(a=>({...a,seo:{...a.seo,metaDescription:e}})),helpText:"Tell briefly what best describes your business, max 300 chars (auto-filled from shop description)",maxLength:300,multiline:3}),t.jsx(r,{label:"Keywords",value:s.seo.keywords,onChange:e=>i(a=>({...a,seo:{...a.seo,keywords:e}})),helpText:"Comma-separated keywords, max 10 keywords, max 3 words each"})]})})})}),t.jsx(x.Section,{children:t.jsx(f,{title:"AI Metadata",children:t.jsx(S,{padding:"400",children:t.jsxs(y,{children:[t.jsxs(y.Group,{children:[t.jsx(r,{label:"Business Type",value:s.aiMetadata.businessType,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,businessType:e}})),placeholder:"e.g., Fashion Retailer, Electronics Store",helpText:"Max 3 words"}),t.jsx(r,{label:"Target Audience",value:s.aiMetadata.targetAudience,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,targetAudience:e}})),placeholder:"e.g., Young professionals, Parents"})]}),t.jsx(r,{label:"Unique Selling Points",value:s.aiMetadata.uniqueSellingPoints,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,uniqueSellingPoints:e}})),helpText:"Comma-separated list",multiline:2}),t.jsx(r,{label:"Brand Voice",value:s.aiMetadata.brandVoice,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,brandVoice:e}})),placeholder:"e.g., Professional, Friendly, Casual"}),t.jsx(r,{label:"Primary Categories",value:s.aiMetadata.primaryCategories,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,primaryCategories:e}})),helpText:"Main product categories, comma-separated"}),t.jsx(r,{label:"Shipping Information",value:s.aiMetadata.shippingInfo,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,shippingInfo:e}})),helpText:"Shipping costs, delivery times, free shipping thresholds (e.g., Free shipping over $50, 2-3 business days)",multiline:2}),t.jsx(r,{label:"Return Policy",value:s.aiMetadata.returnPolicy,onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,returnPolicy:e}})),multiline:2}),t.jsx(ca,{}),t.jsx(w,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),t.jsx(w,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),t.jsx(r,{label:"Supported Languages",value:((P=s.aiMetadata.languages)==null?void 0:P.join(", "))||"",onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,languages:e.split(",").map(c=>c.trim()).filter(c=>c)}})),helpText:"Comma-separated language codes (e.g., en, de, es, fr)",multiline:2}),t.jsx(r,{label:"Supported Currencies",value:((R=s.aiMetadata.supportedCurrencies)==null?void 0:R.join(", "))||"",onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,supportedCurrencies:e.split(",").map(c=>c.trim()).filter(c=>c)}})),helpText:"Comma-separated currency codes (e.g., EUR, USD, GBP)"}),t.jsx(r,{label:"Shipping Regions",value:(($=s.aiMetadata.shippingRegions)==null?void 0:$.join(", "))||"",onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,shippingRegions:e.split(",").map(c=>c.trim()).filter(c=>c)}})),helpText:"Comma-separated regions (e.g., EU, USA, UK, Canada)",multiline:2}),t.jsx(r,{label:"Cultural Considerations",value:s.aiMetadata.culturalConsiderations||"",onChange:e=>i(a=>({...a,aiMetadata:{...a.aiMetadata,culturalConsiderations:e}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),((O=u==null?void 0:u.features)==null?void 0:O.organizationSchema)&&t.jsx(x.Section,{children:t.jsx(f,{title:"Organization Schema",children:t.jsxs(S,{padding:"400",children:[t.jsx(Y,{label:"Enable Organization Schema",checked:s.organizationSchema.enabled,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,enabled:e}}))}),s.organizationSchema.enabled&&t.jsx(S,{paddingBlockStart:"400",children:t.jsxs(y,{children:[t.jsxs(y.Group,{children:[t.jsx(r,{label:"Organization Name",value:s.organizationSchema.name,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,name:e}}))}),t.jsx(r,{label:"Contact Email",value:s.organizationSchema.email,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,email:e}})),type:"email"})]}),t.jsx(r,{label:"Phone",value:s.organizationSchema.phone,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,phone:e}})),type:"tel"}),t.jsx(r,{label:"Logo URL",value:s.organizationSchema.logo,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,logo:e}})),type:"url"}),t.jsx(r,{label:"Social Media Links",value:s.organizationSchema.sameAs,onChange:e=>i(a=>({...a,organizationSchema:{...a.organizationSchema,sameAs:e}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}),((N=u==null?void 0:u.features)==null?void 0:N.localBusinessSchema)&&t.jsx(x.Section,{children:t.jsx(f,{title:"Local Business Schema",children:t.jsxs(S,{padding:"400",children:[t.jsxs(Q,{align:"start",gap:"200",children:[t.jsx(Y,{label:"Enable Local Business Schema",checked:s.localBusinessSchema.enabled,onChange:e=>i(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,enabled:e}}))}),t.jsx(da,{content:"Optional - only enable if you have physical stores/locations",children:t.jsx(w,{variant:"bodyMd",color:"subdued",children:"ℹ️"})})]}),s.localBusinessSchema.enabled&&t.jsx(S,{paddingBlockStart:"400",children:t.jsxs(y,{children:[t.jsx(r,{label:"Price Range",value:s.localBusinessSchema.priceRange,onChange:e=>i(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,priceRange:e}})),helpText:"e.g., $, $$, $$$, $$$$"}),t.jsx(r,{label:"Opening Hours",value:s.localBusinessSchema.openingHours,onChange:e=>i(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,openingHours:e}})),helpText:"e.g., Mo-Fr 09:00-18:00, Sa 10:00-16:00",multiline:2})]})})]})})}),t.jsx(x.Section,{children:t.jsx(f,{children:t.jsx(S,{padding:"400",children:t.jsxs(Q,{gap:"300",children:[t.jsx(B,{onClick:k,loading:aa,primary:!0,children:"Save Metadata"}),t.jsx(B,{onClick:sa,loading:ta,children:"Preview Metadata"}),t.jsx(B,{onClick:ia,loading:oa,destructive:!0,children:"Clear Metadata"})]})})})}),E&&t.jsx(ha,{content:E,onDismiss:()=>M("")})]})}export{Ma as default};
