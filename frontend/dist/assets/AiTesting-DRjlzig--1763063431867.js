import{j as e}from"./app-bridge-qxGsxVyo-1763063431867.js";import{r as l,R as Ae}from"./react-vendor-tAaa2TlE-1763063431867.js";import{m as we}from"./sessionFetch-CJepNHo3-1763063431867.js";import{T as Te}from"./TrialActivationModal-DSl_GyM9-1763063431867.js";import{g as oe,a as Ie}from"./usePlanHierarchy-D5Zdzl7i-1763063431867.js";import{a as c,d as S,T as s,L as J,C as U,B as j,I as a,b as h,e as ce,f as o,D as v,h as ke,k as ve,M as T}from"./polaris-DpTyL3Qr-1763063431867.js";const Pe=(z,d="")=>{try{return new URLSearchParams(window.location.search).get(z)||d}catch{return d}};function $e({shop:z}){var ie,re,ae;const d=z||Pe("shop",""),le=t=>{const i=new URLSearchParams(window.location.search),r=i.toString()?`?${i.toString()}`:"";window.location.href=`${t}${r}`},[O,m]=l.useState(""),w=l.useMemo(()=>we(),[]),[x,V]=l.useState(null),[Y,P]=l.useState(""),[de,H]=l.useState(!1),[f,he]=l.useState(null),[B,ue]=l.useState(""),[ge,M]=l.useState(!1),[pe,G]=l.useState(!1),[xe,L]=l.useState(!1),[u,y]=l.useState(null),[je,Q]=l.useState(!1),[A,Ce]=l.useState(null),[I,K]=l.useState({}),[q,_]=l.useState(!1),[me,X]=l.useState(0),[n,Z]=l.useState({}),[N,ee]=l.useState(!1),[be,se]=l.useState(0),[k,W]=l.useState(null),[ne,te]=l.useState(null);l.useEffect(()=>{d&&(Se(),C())},[d,w]),l.useEffect(()=>{const t=()=>{!document.hidden&&d&&(console.log("[AI-TESTING] Page visible, refreshing token balance..."),C())};return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}},[d,w]);const Se=async()=>{var t,i,r,b,D;try{const g=await w(`/api/billing/info?shop=${d}`);console.log("[AI-TESTING] ðŸ“‹ Billing info received:",g),console.log("[AI-TESTING] ðŸ“‹ Raw plan from API:",(t=g==null?void 0:g.subscription)==null?void 0:t.plan),console.log("[AI-TESTING] ðŸ“‹ Plan type:",typeof((i=g==null?void 0:g.subscription)==null?void 0:i.plan));const p=((r=g==null?void 0:g.subscription)==null?void 0:r.plan)||"Starter";console.log("[AI-TESTING] ðŸ“‹ Setting plan to:",p),V(p),W(((b=g==null?void 0:g.tokens)==null?void 0:b.balance)||0),te(((D=g==null?void 0:g.subscription)==null?void 0:D.trialEndsAt)||null)}catch(g){console.error("[AI-TESTING] Error loading billing info:",g),V("Starter"),W(0)}},C=async()=>{var t,i;try{const r=await w(`/api/billing/info?shop=${d}`);console.log("[AI-TESTING] Token balance refresh:",r),W(((t=r==null?void 0:r.tokens)==null?void 0:t.balance)||0),te(((i=r==null?void 0:r.subscription)==null?void 0:i.trialEndsAt)||null)}catch(r){console.error("[AI-TESTING] Error loading token balance:",r)}},R=t=>{if(!x)return!1;const i=oe(x);switch(t){case"productsJson":return i>=0;case"storeMetadata":return i>=1;case"welcomePage":case"collectionsJson":return i>=2;case"aiSitemap":return i>=3;case"schemaData":return i>=4;case"meta":return i>=0;case"claude":return i>=0;case"gemini":return i>=1;case"chatgpt":return i>=2;case"perplexity":return i>=3;case"deepseek":return i>=4;default:return!1}},E=t=>{switch(t){case"storeMetadata":return"Professional";case"welcomePage":case"collectionsJson":return"Growth";case"aiSitemap":return"Growth Extra";case"schemaData":return"Enterprise";case"gemini":return"Professional";case"chatgpt":return"Growth";case"perplexity":return"Growth Extra";case"deepseek":return"Enterprise";default:return"Professional"}},F=(t,i)=>{he({name:t,url:i}),H(!0)},fe=async()=>{_(!0),X(0),K({});try{console.log("[AI-TESTING] Starting tests for shop:",d);const t=await w("/api/ai-testing/run-tests",{method:"POST",body:{shop:d}});console.log("[AI-TESTING] Test results:",t),t.results?(K(t.results),X(100),m("Basic tests completed!")):m("Testing failed. Please try again.")}catch(t){console.error("[AI-TESTING] Error running tests:",t),m("Failed to run tests. Please try again.")}finally{_(!1)}},ye=async()=>{console.log("[AI-TESTING] ðŸŽ¯ runAiValidation called"),console.log("[AI-TESTING] ðŸŽ¯ Current plan from state:",x),console.log("[AI-TESTING] ðŸŽ¯ Plan type:",typeof x);const t=oe(x);if(console.log("[AI-TESTING] ðŸŽ¯ Plan hierarchy:",Ie),console.log("[AI-TESTING] ðŸŽ¯ Current index in hierarchy:",t),t<1){y({message:"AI-powered validation requires Professional plan or higher",requiredPlan:"Professional",currentPlan:x||"Starter"}),M(!0);return}const i=["growth extra","enterprise"],r=(x==null?void 0:x.toLowerCase())||"starter",b=i.includes(r),D=ne&&new Date(ne)>new Date;if(!(b&&D&&k===0)&&(!k||k<50)){y({message:"You need at least 50 tokens to run AI validation",tokenCost:50,currentBalance:k||0}),G(!0);return}ee(!0),se(0),Z({});try{console.log("[AI-TESTING] Starting AI validation for shop:",d);const p=await w("/api/ai-testing/ai-validate",{method:"POST",body:{shop:d,endpointResults:I}});console.log("[AI-TESTING] AI validation results:",p),p.results?(Z(p.results),se(100),m(`AI validation completed! (${p.tokensUsed||0} tokens used)`),C()):m("AI validation failed. Please try again.")}catch(p){if(console.error("[AI-TESTING] Error running AI validation:",p),p.status===402){if(p.trialRestriction&&p.requiresActivation){y(p),L(!0);return}if(p.requiresUpgrade){y(p),M(!0);return}if(p.requiresPurchase){y(p),G(!0);return}}m("Failed to run AI validation. Please try again.")}finally{ee(!1)}},$=async(t,i=null)=>{try{P("Generating AI response...");let r=`/api/ai-discovery/simulate?shop=${d}&type=${t}`;i&&(r+=`&question=${encodeURIComponent(i)}`);const b=await w(r,{method:"GET"});P(b.response||"No response generated")}catch(r){if(console.error("[AI-TESTING] Simulation error:",r),console.log("[AI-TESTING] Error status:",r.status),console.log("[AI-TESTING] Error requiresUpgrade:",r.requiresUpgrade),console.log("[AI-TESTING] Error requiresPurchase:",r.requiresPurchase),r.status===402){if(r.trialRestriction&&r.requiresActivation){y(r),L(!0),P("");return}if(r.requiresUpgrade){y(r),M(!0),P("");return}if(r.requiresPurchase){y(r),G(!0),P("");return}}P("Error generating response. Please try again."),m("Failed to simulate AI response")}};return e.jsxs(e.Fragment,{children:[e.jsxs(c,{gap:"400",children:[e.jsx(S,{tone:"info",children:e.jsx(s,{children:"Test how AI models discover and understand your store content. Check if your structured data and AI Discovery features are working correctly."})}),e.jsxs(J,{children:[e.jsx(J.Section,{variant:"oneHalf",children:e.jsx(U,{children:e.jsx(j,{padding:"300",children:e.jsxs(c,{gap:"400",children:[e.jsxs(a,{align:"space-between",blockAlign:"center",children:[e.jsxs(c,{gap:"100",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"ðŸ”§ Basic Endpoint Tests"}),e.jsx(s,{variant:"bodySm",tone:"subdued",children:"Quick check if endpoints are accessible and returning data"})]}),e.jsx(h,{onClick:fe,loading:q,disabled:q,children:q?"Testing...":"Run Basic Tests"})]}),q&&e.jsx(j,{children:e.jsxs(c,{gap:"200",children:[e.jsx(s,{variant:"bodySm",children:"Testing endpoints..."}),e.jsx(ce,{progress:me,size:"small"})]})}),Object.keys(I).length>0&&e.jsx(c,{gap:"300",children:Object.entries(I).map(([t,i],r)=>{const b=r===Object.entries(I).length-1;return e.jsxs(Ae.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(c,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:i.name}),i.status==="success"&&e.jsx(o,{tone:"success",children:"âœ“ OK"}),i.status==="warning"&&e.jsx(o,{tone:"warning",children:"âš ï¸ Warning"}),i.status==="error"&&e.jsx(o,{tone:"critical",children:"âœ— Failed"}),i.status==="locked"&&e.jsx(o,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[i.message,i.dataSize&&` (${(i.dataSize/1024).toFixed(1)} KB)`]}),i.actionLink&&e.jsx(h,{size:"slim",onClick:()=>le(i.actionLink),children:t==="basicSitemap"?"Go to Sitemap":t==="aiSitemap"?"Go to Settings":"Go"})]})}),!b&&e.jsx(v,{})]},t)})}),Object.keys(I).length===0&&!q&&e.jsx(S,{tone:"info",children:e.jsx(s,{children:'Click "Run Basic Tests" to check if your AI Discovery endpoints are configured correctly.'})})]})})})}),e.jsx(J.Section,{variant:"oneHalf",children:e.jsx(U,{children:e.jsx(j,{padding:"300",children:e.jsxs(c,{gap:"400",children:[e.jsxs(a,{align:"space-between",blockAlign:"center",children:[e.jsxs(c,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"ðŸ¤– AI-Powered Validation"}),k!==null&&e.jsxs(o,{tone:k>50?"success":"warning",children:[k," tokens"]}),e.jsx(h,{size:"micro",onClick:()=>{console.log("[AI-TESTING] Manual token refresh..."),C()},accessibilityLabel:"Refresh token balance",children:"ðŸ”„"})]}),e.jsx(s,{variant:"bodySm",tone:"subdued",children:"Deep analysis with AI bot"}),x&&e.jsx(s,{variant:"bodySm",tone:"subdued",children:"Requires: Professional+ plan & pay-per-use tokens"})]}),e.jsx(h,{onClick:ye,loading:N,disabled:N||Object.keys(I).length===0,variant:"primary",children:N?"Validating...":"Test with AI Bot"})]}),N&&e.jsx(j,{children:e.jsxs(c,{gap:"200",children:[e.jsx(s,{variant:"bodySm",children:"AI is analyzing your endpoints..."}),e.jsx(ce,{progress:be,size:"small",tone:"primary"})]})}),Object.keys(n).length>0&&e.jsxs(c,{gap:"300",children:[n.productsJson&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(c,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Products JSON Feed"}),n.productsJson.rating==="excellent"&&e.jsx(o,{tone:"success",children:"ðŸ¤– Excellent"}),n.productsJson.rating==="good"&&e.jsx(o,{tone:"success",children:"ðŸ¤– Good"}),n.productsJson.rating==="fair"&&e.jsx(o,{tone:"warning",children:"ðŸ¤– Fair"}),n.productsJson.rating==="poor"&&e.jsx(o,{tone:"critical",children:"ðŸ¤– Poor"})]}),e.jsx(s,{variant:"bodySm",children:n.productsJson.feedback}),n.productsJson.suggestions&&e.jsxs(s,{variant:"bodySm",tone:"subdued",children:["ðŸ’¡ ",n.productsJson.suggestions]})]})}),e.jsx(v,{})]}),n.storeMetadata&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(c,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Store Metadata"}),n.storeMetadata.rating==="excellent"&&e.jsx(o,{tone:"success",children:"ðŸ¤– Excellent"}),n.storeMetadata.rating==="good"&&e.jsx(o,{tone:"success",children:"ðŸ¤– Good"}),n.storeMetadata.rating==="fair"&&e.jsx(o,{tone:"warning",children:"ðŸ¤– Fair"}),n.storeMetadata.rating==="poor"&&e.jsx(o,{tone:"critical",children:"ðŸ¤– Poor"})]}),e.jsx(s,{variant:"bodySm",children:n.storeMetadata.feedback}),n.storeMetadata.suggestions&&e.jsxs(s,{variant:"bodySm",tone:"subdued",children:["ðŸ’¡ ",n.storeMetadata.suggestions]})]})}),e.jsx(v,{})]}),n.welcomePage&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(c,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"AI Welcome Page"}),n.welcomePage.rating==="excellent"&&e.jsx(o,{tone:"success",children:"ðŸ¤– Excellent"}),n.welcomePage.rating==="good"&&e.jsx(o,{tone:"success",children:"ðŸ¤– Good"}),n.welcomePage.rating==="fair"&&e.jsx(o,{tone:"warning",children:"ðŸ¤– Fair"}),n.welcomePage.rating==="poor"&&e.jsx(o,{tone:"critical",children:"ðŸ¤– Poor"})]}),e.jsx(s,{variant:"bodySm",children:n.welcomePage.feedback}),n.welcomePage.suggestions&&e.jsxs(s,{variant:"bodySm",tone:"subdued",children:["ðŸ’¡ ",n.welcomePage.suggestions]})]})}),e.jsx(v,{})]}),n.collectionsJson&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(c,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Collections JSON Feed"}),n.collectionsJson.rating==="excellent"&&e.jsx(o,{tone:"success",children:"ðŸ¤– Excellent"}),n.collectionsJson.rating==="good"&&e.jsx(o,{tone:"success",children:"ðŸ¤– Good"}),n.collectionsJson.rating==="fair"&&e.jsx(o,{tone:"warning",children:"ðŸ¤– Fair"}),n.collectionsJson.rating==="poor"&&e.jsx(o,{tone:"critical",children:"ðŸ¤– Poor"})]}),e.jsx(s,{variant:"bodySm",children:n.collectionsJson.feedback}),n.collectionsJson.suggestions&&e.jsxs(s,{variant:"bodySm",tone:"subdued",children:["ðŸ’¡ ",n.collectionsJson.suggestions]})]})}),e.jsx(v,{})]}),n.aiSitemap&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(c,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"AI-Enhanced Sitemap"}),n.aiSitemap.rating==="excellent"&&e.jsx(o,{tone:"success",children:"ðŸ¤– Excellent"}),n.aiSitemap.rating==="good"&&e.jsx(o,{tone:"success",children:"ðŸ¤– Good"}),n.aiSitemap.rating==="fair"&&e.jsx(o,{tone:"warning",children:"ðŸ¤– Fair"}),n.aiSitemap.rating==="poor"&&e.jsx(o,{tone:"critical",children:"ðŸ¤– Poor"})]}),e.jsx(s,{variant:"bodySm",children:n.aiSitemap.feedback}),n.aiSitemap.suggestions&&e.jsxs(s,{variant:"bodySm",tone:"subdued",children:["ðŸ’¡ ",n.aiSitemap.suggestions]})]})}),e.jsx(v,{})]}),n.schemaData&&e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(c,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Advanced Schema Data"}),n.schemaData.rating==="excellent"&&e.jsx(o,{tone:"success",children:"ðŸ¤– Excellent"}),n.schemaData.rating==="good"&&e.jsx(o,{tone:"success",children:"ðŸ¤– Good"}),n.schemaData.rating==="fair"&&e.jsx(o,{tone:"warning",children:"ðŸ¤– Fair"}),n.schemaData.rating==="poor"&&e.jsx(o,{tone:"critical",children:"ðŸ¤– Poor"})]}),e.jsx(s,{variant:"bodySm",children:n.schemaData.feedback}),n.schemaData.suggestions&&e.jsxs(s,{variant:"bodySm",tone:"subdued",children:["ðŸ’¡ ",n.schemaData.suggestions]})]})})]}),Object.keys(n).length===0&&!N&&e.jsx(S,{tone:"info",children:e.jsx(s,{children:Object.keys(I).length===0?"Run Basic Tests first, then use AI validation for deep analysis":'Click "Test with AI Bot" to get AI-powered feedback on your endpoint data quality'})}),!x&&e.jsx(S,{tone:"warning",children:e.jsx(s,{children:"Loading plan information..."})})]})})})})]}),e.jsx(U,{children:e.jsx(j,{padding:"300",children:e.jsxs(c,{gap:"400",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"Test with Real AI Bots"}),e.jsx(s,{variant:"bodyMd",tone:"subdued",children:"Manually test your store with real AI search engines"}),e.jsxs(c,{gap:"200",children:[e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Meta AI Search"}),R("meta")?e.jsx(h,{onClick:()=>F("Meta AI","https://www.meta.ai/"),size:"slim",children:"Test"}):e.jsxs(h,{disabled:!0,size:"slim",children:[E("meta"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Claude AI Search"}),R("claude")?e.jsx(h,{onClick:()=>F("Claude AI","https://claude.ai/"),size:"slim",children:"Test"}):e.jsxs(h,{disabled:!0,size:"slim",children:[E("claude"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Gemini AI Search"}),R("gemini")?e.jsx(h,{onClick:()=>F("Gemini AI","https://gemini.google.com/"),size:"slim",children:"Test"}):e.jsxs(h,{disabled:!0,size:"slim",children:[E("gemini"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"ChatGPT Web Search"}),R("chatgpt")?e.jsx(h,{url:`https://chat.openai.com/?q=What+products+does+${d}+sell%3F+Tell+me+about+this+business+and+what+they+offer`,external:!0,size:"slim",children:"Test"}):e.jsxs(h,{disabled:!0,size:"slim",children:[E("chatgpt"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Perplexity AI Search"}),R("perplexity")?e.jsx(h,{url:`https://www.perplexity.ai/search?q=What+products+does+${d}+sell%3F+Tell+me+about+this+business+and+what+they+offer`,external:!0,size:"slim",children:"Test"}):e.jsxs(h,{disabled:!0,size:"slim",children:[E("perplexity"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"DeepSeek AI Search"}),R("deepseek")?e.jsx(h,{onClick:()=>F("DeepSeek AI","https://chat.deepseek.com/"),size:"slim",children:"Test"}):e.jsxs(h,{disabled:!0,size:"slim",children:[E("deepseek"),"+ Required"]})]})]}),e.jsx(S,{tone:"info",children:e.jsxs(s,{children:[e.jsx("strong",{children:"How to test with AI bots:"}),e.jsx("br",{}),"â€¢ ",e.jsx("strong",{children:"Perplexity & ChatGPT:"}),' Click "Test" - they support URL parameters',e.jsx("br",{}),"â€¢ ",e.jsx("strong",{children:"Meta AI, Claude, Gemini, DeepSeek:"}),' Click "Test" to open a modal with the prompt to copy']})})]})})}),e.jsx(U,{children:e.jsx(j,{padding:"300",children:e.jsxs(c,{gap:"300",children:[e.jsx(s,{as:"h4",variant:"headingSm",children:"AI Search Simulation"}),e.jsx(s,{variant:"bodyMd",tone:"subdued",children:"Test how AI bots would respond to questions about your store based on your structured data."}),e.jsx(S,{tone:"info",children:e.jsxs(c,{gap:"100",children:[e.jsx(s,{variant:"bodySm",fontWeight:"semibold",children:"Simulation Details:"}),e.jsxs(s,{variant:"bodySm",children:["â€¢ ",e.jsx("strong",{children:"Data Source:"})," Your store's products, collections, and metadata"]}),e.jsxs(s,{variant:"bodySm",children:["â€¢ ",e.jsx("strong",{children:"Response Style:"})," Concise (2-3 sentences), natural language"]}),e.jsxs(s,{variant:"bodySm",children:["â€¢ ",e.jsx("strong",{children:"Best For:"})," General store info, products, categories, contact details"]}),e.jsxs(s,{variant:"bodySm",children:["â€¢ ",e.jsx("strong",{children:"Limitations:"})," May not have real-time data (current stock, active promotions, exact shipping times)"]})]})}),e.jsxs(c,{gap:"200",children:[e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"What products does this store sell?"}),e.jsx(h,{onClick:()=>$("products"),size:"slim",children:"Simulate Response"})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Tell me about this business"}),e.jsx(h,{onClick:()=>$("business"),size:"slim",children:"Simulate Response"})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"What categories does this store have?"}),e.jsx(h,{onClick:()=>$("categories"),size:"slim",children:"Simulate Response"})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"What is this store's contact information?"}),e.jsx(h,{onClick:()=>$("contact"),size:"slim",children:"Simulate Response"})]})]}),e.jsx(v,{}),e.jsxs(c,{gap:"200",children:[e.jsx(s,{variant:"headingSm",children:"Ask Your Own Question"}),e.jsx(ke,{label:"",value:B,onChange:ue,placeholder:"e.g., What are your return policies? Do you ship internationally?",autoComplete:"off",connectedRight:e.jsx(h,{onClick:()=>{B.trim()?$("custom",B):m("Please enter a question")},disabled:!B.trim(),children:"Ask AI"})})]}),Y&&e.jsxs(j,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"AI Bot Response:"}),e.jsx(j,{paddingBlockStart:"200",children:e.jsx(s,{variant:"bodyMd",children:Y})})]})]})})})]}),O&&e.jsx(ve,{content:O,onDismiss:()=>m("")}),e.jsx(T,{open:de,onClose:()=>H(!1),title:`Test with ${f==null?void 0:f.name}`,primaryAction:{content:"Open AI Bot",url:f==null?void 0:f.url,external:!0},secondaryActions:[{content:"Copy Prompt",onAction:()=>{navigator.clipboard.writeText(`What products does ${d} sell? Tell me about this business and what they offer.`),m("Prompt copied to clipboard!")}}],children:e.jsx(T.Section,{children:e.jsxs(c,{gap:"300",children:[e.jsx(s,{variant:"bodyMd",children:'1. Click "Copy Prompt" (left button)'}),e.jsxs(s,{variant:"bodyMd",children:['2. Click "Open AI Bot" (right button) to visit ',f==null?void 0:f.name]}),e.jsx(s,{variant:"bodyMd",children:"3. Paste the prompt and send"}),e.jsxs(j,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Prompt to test:"}),e.jsx(j,{paddingBlockStart:"200",children:e.jsxs(s,{variant:"bodyMd",as:"p",children:["What products does ",d," sell? Tell me about this business and what they offer."]})})]}),e.jsx(S,{tone:"info",children:e.jsx(s,{children:"The AI bot will search the web and use your store's structured data to answer."})})]})})}),e.jsx(T,{open:je,onClose:()=>Q(!1),title:"Upgrade Required",primaryAction:{content:"View Plans",onAction:()=>{const t=new URLSearchParams(window.location.search),i=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${i}`}},secondaryActions:[{content:"Cancel",onAction:()=>Q(!1)}],children:e.jsx(T.Section,{children:e.jsxs(c,{gap:"300",children:[e.jsxs(s,{variant:"bodyMd",children:[e.jsx("strong",{children:A==null?void 0:A.endpoint})," requires ",e.jsx("strong",{children:A==null?void 0:A.requiredPlan})," plan or higher."]}),e.jsxs(s,{variant:"bodyMd",tone:"subdued",children:["Your current plan: ",e.jsx("strong",{children:A==null?void 0:A.currentPlan})]}),e.jsx(S,{tone:"info",children:e.jsx(s,{children:"Upgrade to access this advanced AI Discovery feature."})})]})})}),e.jsx(T,{open:ge,onClose:()=>M(!1),title:"Upgrade Required",primaryAction:{content:"View Plans",onAction:()=>{const t=new URLSearchParams(window.location.search),i=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${i}`}},secondaryActions:[{content:"Cancel",onAction:()=>M(!1)}],children:e.jsx(T.Section,{children:e.jsxs(c,{gap:"300",children:[e.jsxs(s,{variant:"bodyMd",children:["AI Testing requires ",e.jsx("strong",{children:(u==null?void 0:u.minimumPlan)||"Professional"})," plan or higher."]}),e.jsxs(s,{variant:"bodyMd",tone:"subdued",children:["Your current plan: ",e.jsx("strong",{children:(u==null?void 0:u.currentPlan)||"Starter"})]}),e.jsx(S,{tone:"info",children:e.jsx(s,{children:"Upgrade to test AI responses with real store data."})})]})})}),e.jsx(T,{open:pe,onClose:()=>{G(!1),C()},title:"Insufficient Tokens",primaryAction:{content:"Buy Tokens",onAction:()=>{const t=new URLSearchParams(window.location.search),i=t.toString()?`?${t.toString()}`:"",r=i?"&":"?";window.location.href=`/billing${i}${r}returnTo=${encodeURIComponent("/ai-testing")}`}},secondaryActions:[{content:"Cancel",onAction:()=>{G(!1),C()}}],children:e.jsx(T.Section,{children:e.jsxs(c,{gap:"300",children:[e.jsx(s,{variant:"bodyMd",children:"You need more tokens to use AI Testing."}),e.jsx(j,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:e.jsxs(c,{gap:"200",children:[e.jsxs(a,{align:"space-between",children:[e.jsx(s,{variant:"bodySm",children:"Required:"}),e.jsxs(s,{variant:"bodySm",fontWeight:"semibold",children:[((ie=u==null?void 0:u.tokensRequired)==null?void 0:ie.toLocaleString())||0," tokens"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{variant:"bodySm",children:"Available:"}),e.jsxs(s,{variant:"bodySm",children:[((re=u==null?void 0:u.tokensAvailable)==null?void 0:re.toLocaleString())||0," tokens"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{variant:"bodySm",children:"Needed:"}),e.jsxs(s,{variant:"bodySm",fontWeight:"semibold",tone:"critical",children:[((ae=u==null?void 0:u.tokensNeeded)==null?void 0:ae.toLocaleString())||0," tokens"]})]})]})}),e.jsx(S,{tone:"info",children:e.jsx(s,{children:"Purchase tokens to continue using AI features. Tokens never expire."})})]})})}),u&&e.jsx(Te,{open:xe,onClose:()=>{L(!1),y(null)},feature:u.feature||"ai-testing-simulation",trialEndsAt:u.trialEndsAt,currentPlan:u.currentPlan||x,tokensRequired:u.tokensRequired||0,onActivatePlan:async()=>{try{console.log("[AI-TESTING] ðŸ”“ Activating plan directly...");const t=await w("/api/billing/activate",{method:"POST",body:JSON.stringify({shop:d,endTrial:!0,returnTo:"/ai-testing"})});if(console.log("[AI-TESTING] âœ… Activation response:",t),t.requiresApproval&&t.confirmationUrl){console.log("[AI-TESTING] ðŸ” Redirecting to Shopify approval..."),window.top.location.href=t.confirmationUrl;return}console.log("[AI-TESTING] âœ… Plan activated, reloading page..."),window.location.reload()}catch(t){console.error("[AI-TESTING] âŒ Activation failed:",t);const i=new URLSearchParams(window.location.search),r=i.get("host"),b=i.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${b}&host=${encodeURIComponent(r)}`}},onPurchaseTokens:()=>{const t=new URLSearchParams(window.location.search),i=t.get("host"),r=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${r}&host=${encodeURIComponent(i)}&returnTo=${encodeURIComponent("/ai-testing")}`}})]})}export{$e as default};
