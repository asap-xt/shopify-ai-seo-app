import{j as a}from"./app-bridge-CQ8pdmSs-1761330952907.js";import{r as v}from"./react-vendor-tAaa2TlE-1761330952907.js";import{u as A}from"./useShopApi-DUbbi41C-1761330952907.js";import{a as g,e as P,T as f,d as I,C as _,I as L,j as R,y as W,B as G}from"./polaris-CtNZ7NY6-1761330952907.js";class S{constructor(s=0,t="Network Error"){this.status=s,this.text=t}}const J=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,s)=>Promise.resolve(localStorage.setItem(e,s)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},n={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:J()},T=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},$=(e,s="https://api.emailjs.com")=>{if(!e)return;const t=T(e);n.publicKey=t.publicKey,n.blockHeadless=t.blockHeadless,n.storageProvider=t.storageProvider,n.blockList=t.blockList,n.limitRate=t.limitRate,n.origin=t.origin||s},B=async(e,s,t={})=>{const o=await fetch(n.origin+e,{method:"POST",headers:t,body:s}),i=await o.text(),h=new S(o.status,i);if(o.ok)return h;throw h},M=(e,s,t)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!s||typeof s!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!t||typeof t!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},Q=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},q=e=>e.webdriver||!e.languages||e.languages.length===0,C=()=>new S(451,"Unavailable For Headless Browser"),Y=(e,s)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof s!="string")throw"The BlockList watchVariable has to be a string"},X=e=>{var s;return!((s=e.list)!=null&&s.length)||!e.watchVariable},Z=(e,s)=>e instanceof FormData?e.get(s):e[s],E=(e,s)=>{if(X(e))return!1;Y(e.list,e.watchVariable);const t=Z(s,e.watchVariable);return typeof t!="string"?!1:e.list.includes(t)},H=()=>new S(403,"Forbidden"),ee=(e,s)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(s&&typeof s!="string")throw"The LimitRate ID has to be a non-empty string"},te=async(e,s,t)=>{const o=Number(await t.get(e)||0);return s-Date.now()+o},O=async(e,s,t)=>{if(!s.throttle||!t)return!1;ee(s.throttle,s.id);const o=s.id||e;return await te(o,s.throttle,t)>0?!0:(await t.set(o,Date.now().toString()),!1)},V=()=>new S(429,"Too Many Requests"),se=async(e,s,t,o)=>{const i=T(o),h=i.publicKey||n.publicKey,y=i.blockHeadless||n.blockHeadless,d=i.storageProvider||n.storageProvider,w={...n.blockList,...i.blockList},m={...n.limitRate,...i.limitRate};return y&&q(navigator)?Promise.reject(C()):(M(h,e,s),Q(t),t&&E(w,t)?Promise.reject(H()):await O(location.pathname,m,d)?Promise.reject(V()):B("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:h,service_id:e,template_id:s,template_params:t}),{"Content-type":"application/json"}))},re=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},ae=e=>typeof e=="string"?document.querySelector(e):e,ie=async(e,s,t,o)=>{const i=T(o),h=i.publicKey||n.publicKey,y=i.blockHeadless||n.blockHeadless,d=n.storageProvider||i.storageProvider,w={...n.blockList,...i.blockList},m={...n.limitRate,...i.limitRate};if(y&&q(navigator))return Promise.reject(C());const c=ae(t);M(h,e,s),re(c);const p=new FormData(c);return E(w,p)?Promise.reject(H()):await O(location.pathname,m,d)?Promise.reject(V()):(p.append("lib_version","4.4.1"),p.append("service_id",e),p.append("template_id",s),p.append("user_id",h),B("/api/v1.0/email/send-form",p))},oe={init:$,send:se,sendForm:ie,EmailJSResponseStatus:S},F=[{label:"Bug Report",value:"bug_report"},{label:"Feature Request",value:"feature_request"},{label:"Billing Issue",value:"billing_issue"},{label:"General Question",value:"general_question"},{label:"Technical Support",value:"technical_support"}];function me({shop:e}){const{api:s}=A(),[t,o]=v.useState({name:"",email:"",subject:"general_question",message:"",file:null}),[i,h]=v.useState(!1),[y,d]=v.useState(null),[w,m]=v.useState(""),[c,p]=v.useState(null),x=e||((r,l="")=>{try{return new URLSearchParams(window.location.search).get(r)||l}catch{return l}})("shop","");v.useEffect(()=>{D()},[x]);const D=async()=>{try{const r=await s(`/api/shop/info?shop=${encodeURIComponent(x)}`);p(r),o(l=>({...l,name:(r==null?void 0:r.name)||"",email:(r==null?void 0:r.email)||""}))}catch(r){console.error("[ContactSupport] Error loading shop info:",r)}},k=(r,l)=>{o(u=>({...u,[r]:l}))},K=r=>{if(r.length>0){const l=r[0];if(l.size>5*1024*1024){d("error"),m("File size must be less than 5MB");return}o(u=>({...u,file:l}))}},z=r=>new Promise((l,u)=>{const j=new FileReader;j.readAsDataURL(r),j.onload=()=>l(j.result),j.onerror=b=>u(b)}),N=()=>t.name.trim()?t.email.trim()?t.message.trim()?!0:(d("error"),m("Please enter your message"),!1):(d("error"),m("Please enter your email"),!1):(d("error"),m("Please enter your name"),!1),U=async r=>{var l;if(r.preventDefault(),!!N()){h(!0),d(null),m("");try{let u={name:t.name,email:t.email,subject:((l=F.find(b=>b.value===t.subject))==null?void 0:l.label)||t.subject,message:t.message,shop_name:(c==null?void 0:c.name)||x,shop_url:`https://${x}`,time:new Date().toLocaleString()};if(t.file)try{const b=await z(t.file);u.attachment=b,u.file_name=t.file.name,u.file_size=`${(t.file.size/1024).toFixed(1)} KB`,u.file_type=t.file.type}catch(b){console.error("[ContactSupport] Error converting file to base64:",b),d("error"),m("Failed to process file attachment");return}const j=await oe.send("service_c8j657n","template_zrftkfg",u,"-0N7g1SCh9fSknb6q");console.log("[ContactSupport] Email sent successfully:",j),d("success"),m("Message sent successfully! We'll get back to you within 24 hours."),o({name:(c==null?void 0:c.name)||"",email:(c==null?void 0:c.email)||"",subject:"general_question",message:"",file:null})}catch(u){console.error("[ContactSupport] Error sending email:",u),d("error"),m("Failed to send message. Please try again or contact us directly.")}finally{h(!1)}}};return a.jsx(g,{padding:"400",children:a.jsxs(P,{gap:"400",children:[a.jsx(f,{variant:"bodyMd",tone:"subdued",children:"Need help? Send us a message and we'll get back to you within 24 hours."}),y&&a.jsx(I,{tone:y==="success"?"success":"critical",children:w}),a.jsx(_,{children:a.jsx(g,{padding:"400",children:a.jsx("form",{onSubmit:U,children:a.jsxs(P,{gap:"400",children:[a.jsxs(L,{gap:"400",wrap:!0,children:[a.jsx(g,{flexGrow:1,children:a.jsx(R,{label:"Name",value:t.name,onChange:r=>k("name",r),placeholder:"Your name",required:!0,disabled:i})}),a.jsx(g,{flexGrow:1,children:a.jsx(R,{label:"Email",type:"email",value:t.email,onChange:r=>k("email",r),placeholder:"your@email.com",required:!0,disabled:i})})]}),a.jsx(W,{label:"Subject",options:F,value:t.subject,onChange:r=>k("subject",r),disabled:i}),a.jsx(R,{label:"Message",value:t.message,onChange:r=>k("message",r),multiline:4,placeholder:"Describe your issue or question...",required:!0,disabled:i}),a.jsxs(g,{children:[a.jsx(f,{as:"label",variant:"bodyMd",fontWeight:"medium",children:"Attach File (Optional)"}),a.jsx(g,{paddingBlockStart:"100",children:a.jsx("input",{type:"file",accept:"image/*,.pdf,.doc,.docx,.txt",onChange:r=>K(r.target.files),disabled:i,style:{padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"14px",width:"100%"}})}),a.jsx(f,{variant:"bodySm",tone:"subdued",children:"Maximum file size: 5MB"})]}),a.jsx(L,{gap:"200",align:"end",children:a.jsx(G,{variant:"primary",submit:!0,loading:i,disabled:i,children:i?"Sending...":"Send Message"})})]})})})}),a.jsx(_,{children:a.jsx(g,{padding:"400",children:a.jsxs(P,{gap:"200",children:[a.jsx(f,{as:"h3",variant:"headingMd",children:"Other Ways to Reach Us"}),a.jsx(f,{variant:"bodyMd",tone:"subdued",children:"• Email: indexaize@gmail.com"}),a.jsx(f,{variant:"bodyMd",tone:"subdued",children:"• Response time: Within 24 hours"}),a.jsxs(f,{variant:"bodyMd",tone:"subdued",children:["• Include your shop name: ",x]})]})})})]})})}export{me as default};
