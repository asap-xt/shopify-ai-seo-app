const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ZGQyXc0w-1757706246455.js","assets/react-vendor-tAaa2TlE-1757706246455.js","assets/index-BvFXJdzC-1757706246455.js","assets/index-CFwsnZ86-1757706246455.js","assets/BulkEdit-whDHliHi-1757706246455.js","assets/app-bridge-C0P6XKgV-1757706246455.js","assets/polaris-DPuFGk_s-1757706246455.js","assets/Collections-5bpbrvOn-1757706246455.js","assets/Sitemap-DHpPHJOr-1757706246455.js","assets/StoreMetadata-B3g5vuoc-1757706246455.js","assets/SchemaData-CpTnfztu-1757706246455.js","assets/Settings-D2oXcxV7-1757706246455.js"])))=>i.map(i=>d[i]);
import{j as t}from"./app-bridge-C0P6XKgV-1757706246455.js";import{a as N,r as u,R as P}from"./react-vendor-tAaa2TlE-1757706246455.js";import{P as V,A as M,B as x,I as R,T as h,a as g,C as y,b as U,F as W,c as G}from"./polaris-DPuFGk_s-1757706246455.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();var F,b=N;F=b.createRoot,b.hydrateRoot;const q="modulepreload",z=function(e){return"/"+e},D={},f=function(r,o,a){let n=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));n=Promise.allSettled(o.map(c=>{if(c=z(c),c in D)return;D[c]=!0;const p=c.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const d=document.createElement("link");if(d.rel=p?"stylesheet":q,p||(d.as="script"),d.crossOrigin="",d.href=c,l&&d.setAttribute("nonce",l),document.head.appendChild(d),p)return new Promise((_,v)=>{d.addEventListener("load",_),d.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return n.then(i=>{for(const l of i||[])l.status==="rejected"&&s(l.reason);return r().catch(s)})},H=u.createContext(null);function K(){const e=u.useContext(H);return e||console.warn("[useAppBridge] No App Bridge instance in context"),e}function Y({children:e}){const[r,o]=u.useState(null),[a,n]=u.useState(!0),[s,i]=u.useState(null),l=new URLSearchParams(window.location.search),c=l.get("host"),p=l.get("shop"),m="2749a2f6d38ff5796ed256b5c9dc70a1";return console.log("[APP-BRIDGE-PROVIDER] Public App - Initializing with:",{host:c?"Present":"Missing",shop:p?"Present":"Missing",apiKey:"Present"}),u.useEffect(()=>{c||console.warn("[APP-BRIDGE-PROVIDER] No host parameter - app may not be embedded"),f(async()=>{const{createApp:d}=await import("./index-ZGQyXc0w-1757706246455.js").then(_=>_.i);return{createApp:d}},__vite__mapDeps([0,1,2])).then(({createApp:d})=>{const _=d({apiKey:m,host:c||p,forceRedirect:!1});console.log("[APP-BRIDGE-PROVIDER] Public App - App instance created"),o(_),window.__SHOPIFY_APP_BRIDGE__=_,n(!1)}).catch(d=>{console.error("[APP-BRIDGE-PROVIDER] Failed to create app:",d),i(d.message),n(!1)})},[m,c,p]),a?t.jsx("div",{children:"Loading..."}):(s&&console.warn("[APP-BRIDGE-PROVIDER] App Bridge initialization failed:",s),t.jsx(H.Provider,{value:r,children:e}))}const J={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_NAME:"NEW AI SEO",VITE_SHOPIFY_API_KEY:"2749a2f6d38ff5796ed256b5c9dc70a1"};let A=null;async function Q(e=!1){var r;if(A)return A;if(window.__SHOPIFY_APP_BRIDGE__)return A=window.__SHOPIFY_APP_BRIDGE__,e&&console.log("[SFETCH] Using global App Bridge instance"),A;try{const o=await f(()=>import("./index-ZGQyXc0w-1757706246455.js").then(c=>c.i),__vite__mapDeps([0,1,2])),a=o&&(o.default||o);if(!a)return e&&console.error("[SFETCH] App Bridge module not available"),null;const n=new URLSearchParams(window.location.search).get("host"),s=new URLSearchParams(window.location.search).get("shop"),i=window.__SHOPIFY_API_KEY||import.meta&&J&&"2749a2f6d38ff5796ed256b5c9dc70a1"||((r=document.querySelector('meta[name="shopify-api-key"]'))==null?void 0:r.getAttribute("content"))||null;if(!i)return e&&console.error("[SFETCH] Missing API key for public app"),null;const l=n||s;return l?(A=a({apiKey:i,host:l,forceRedirect:!1}),e&&console.log("[SFETCH] Public App - AppBridge created"),A):(e&&console.warn("[SFETCH] No host or shop parameter - may not be embedded"),null)}catch(o){return e&&console.error("[SFETCH] AppBridge creation failed:",o),null}}async function X(e,r=!1){try{r&&console.log("[SFETCH] Getting token from App Bridge...",{app:!!e});const o=await f(()=>import("./index-CFwsnZ86-1757706246455.js").then(s=>s.i),__vite__mapDeps([3,1,2])),a=o&&o.getSessionToken;if(!a||!e)return r&&console.log("[SFETCH] No getSessionToken or app:",{getSessionToken:!!a,app:!!e}),null;r&&console.log("[SFETCH] Calling getSessionToken...");const n=await a(e);return r&&console.log("[SFETCH] Got session token?",!!n,n?`(len=${n.length}, head=${n.slice(0,10)}...)`:""),n||null}catch(o){return r&&console.error("[SFETCH] Token fetch failed:",o),null}}function Z({debug:e}={}){const o=e??!1;return async function(n,{method:s="GET",headers:i={},body:l,shop:c}={}){const p=c?`${n}${n.includes("?")?"&":"?"}shop=${encodeURIComponent(c)}`:n,m=await Q(o),d=m?await X(m,o):null;o&&console.log("[SFETCH] Public App →",{url:p,method:s,shopParam:c,hasToken:!!d,tokenHead:d?d.slice(0,10):null}),o&&console.log("[SFETCH] App Bridge details:",{app:!!m,token:!!d,tokenLength:d?d.length:0});const _={method:s,headers:{"Content-Type":"application/json",...i},credentials:"include",body:l?JSON.stringify(l):void 0},v=d?{..._,headers:{..._.headers,Authorization:`Bearer ${d}`}}:_,S=await fetch(p,v);o&&console.log("[SFETCH] Public App ← response",S.status,S.statusText,"for",p);const j=await S.text();let E;try{E=j?JSON.parse(j):null}catch{E={error:(j==null?void 0:j.slice(0,500))||"Non-JSON response"}}if(!S.ok){const $=(E==null?void 0:E.error)||(E==null?void 0:E.message)||`HTTP ${S.status}`,w=new Error($);throw w.status=S.status,w.body=E,w.debug={url:p,method:s,shopParam:c,hasAuthHeader:!!v.headers.Authorization,tokenHead:d?d.slice(0,10):null},o&&console.error("[SFETCH] ! error",w),w}return E}}const ee=(e,r="")=>{try{return new URLSearchParams(window.location.search).get(e)||r}catch{return r}};function te(){const e=u.useMemo(()=>Z(),[]),r=ee("shop","");return{api:e,shop:r}}const I=["en","de","es","fr"],O={en:"🇬🇧",de:"🇩🇪",es:"🇪🇸",fr:"🇫🇷"},B={en:"English",de:"Deutsch",es:"Español",fr:"Français"};function ne({lang:e="en",setLang:r,t:o}){const[a,n]=u.useState(!1);u.useEffect(()=>{if(!I.includes(e)){try{localStorage.setItem("app_lang","en")}catch{}typeof r=="function"&&r("en")}},[e,r]);const s=I.includes(e)?e:"en",i=t.jsx(x,{onClick:()=>n(c=>!c),disclosure:!0,children:t.jsxs(R,{gap:"200",blockAlign:"center",children:[t.jsx("span",{"aria-hidden":!0,children:O[s]}),t.jsx(h,{as:"span",variant:"bodyMd",children:B[s]})]})}),l=u.useMemo(()=>I.map(c=>({content:`${O[c]} ${B[c]}`,active:c===s,onAction:()=>{try{localStorage.setItem("app_lang",c)}catch{}typeof r=="function"&&r(c),n(!1)}})),[s,r]);return t.jsx(V,{active:a,activator:i,onClose:()=>n(!1),autofocusTarget:"first-node",children:t.jsx(M,{items:l})})}function re({sectionTitle:e,lang:r,setLang:o,t:a}){return t.jsx(g,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",background:"bg",children:t.jsxs(R,{align:"space-between",blockAlign:"center",children:[t.jsx(h,{as:"h1",variant:"headingLg",children:e}),t.jsx(ne,{lang:r,setLang:o,t:a})]})})}const C="en",L={en:()=>f(()=>import("./en-DY--Skhq-1757706246455.js"),[]),de:()=>f(()=>import("./de-BYtsvH6H-1757706246455.js"),[]),es:()=>f(()=>import("./es-Cshzw9pa-1757706246455.js"),[]),fr:()=>f(()=>import("./fr-DGTXCiho-1757706246455.js"),[])},k=Object.keys(L);function se(){try{const e=localStorage.getItem("app_lang");return k.includes(e)?e:null}catch{return null}}function oe(e){try{localStorage.setItem("app_lang",e)}catch{}}function ie(){const[e,r]=u.useState(()=>se()||C),[o,a]=u.useState({});u.useEffect(()=>{let s=!1;async function i(){const c=await(L[e]||L[C])();s||a(c.default||c)}return i(),oe(e),()=>{s=!0}},[e]);const n=u.useMemo(()=>(s,i="")=>{const l=s==null?void 0:s.split(".").reduce((c,p)=>c&&c[p]!==void 0?c[p]:void 0,o);return l!=null?String(l):i||s},[o]);return{lang:e,setLang:r,t:n,dict:o,langs:k}}const ae=P.lazy(()=>f(()=>import("./BulkEdit-whDHliHi-1757706246455.js"),__vite__mapDeps([4,5,1,6]))),ce=P.lazy(()=>f(()=>import("./Collections-5bpbrvOn-1757706246455.js"),__vite__mapDeps([7,5,1,6]))),le=P.lazy(()=>f(()=>import("./Sitemap-DHpPHJOr-1757706246455.js"),__vite__mapDeps([8,5,1,6]))),de=P.lazy(()=>f(()=>import("./StoreMetadata-B3g5vuoc-1757706246455.js"),__vite__mapDeps([9,5,1,6]))),ue=P.lazy(()=>f(()=>import("./SchemaData-CpTnfztu-1757706246455.js"),__vite__mapDeps([10,5,1,6]))),pe=P.lazy(()=>f(()=>import("./Settings-D2oXcxV7-1757706246455.js"),__vite__mapDeps([11,5,1,6]))),he={Polaris:{ResourceList:{sortingLabel:"Sort by"}}},T=(e,r="")=>{try{return new URLSearchParams(window.location.search).get(e)||r}catch{return r}};function fe(){const[e,r]=u.useState(window.location.pathname);return u.useEffect(()=>{const o=()=>r(window.location.pathname);return window.addEventListener("popstate",o),()=>window.removeEventListener("popstate",o)},[]),{path:e}}function me({active:e,shop:r}){e==="/"||e.startsWith("/dashboard"),e.startsWith("/ai-seo"),e.startsWith("/billing"),e.startsWith("/settings");const a=new URLSearchParams(window.location.search).get("host"),n=new URLSearchParams;r&&n.set("shop",r),a&&n.set("host",a);const s=n.toString()?`?${n.toString()}`:"";return t.jsxs("ui-nav-menu",{children:[t.jsx("a",{href:`/${s}`,rel:"home",children:"Home"}),t.jsx("a",{href:`/dashboard${s}`,children:"Dashboard"}),t.jsx("a",{href:`/ai-seo${s}`,children:"AI SEO"}),t.jsx("a",{href:`/billing${s}`,children:"Billing"}),t.jsx("a",{href:`/settings${s}`,children:"Settings"})]})}const ge=P.memo(({shop:e})=>{var s;const[r,o]=u.useState(null),{api:a}=te(),n=e||T("shop","");return u.useEffect(()=>{n&&a("/plans/me",{shop:n}).then(i=>{i&&!i.error&&o(i)}).catch(i=>console.error("Failed to load plan:",i))},[n,a]),u.useEffect(()=>{n&&a("/collections/check-definitions",{shop:n}).then(i=>{const l=(i.definitions||[]).map(m=>m.key),p=["en","bg","fr"].filter(m=>!l.includes(`seo__${m}`));if(p.length>0)return a("/collections/create-definitions",{method:"POST",shop:n,body:{shop:n,languages:p}})}).catch(i=>console.error("Definitions error:",i))},[n,a]),r?t.jsx(y,{title:"Dashboard",children:t.jsxs(g,{padding:"400",children:[t.jsxs(R,{gap:"800",wrap:!1,children:[t.jsxs(g,{children:[t.jsx(h,{variant:"headingMd",as:"h3",children:"Current plan"}),t.jsx(h,{children:r.plan||"Free"})]}),t.jsxs(g,{children:[t.jsx(h,{variant:"headingMd",as:"h3",children:"Shop"}),t.jsx(h,{children:r.shop||"â€”"})]}),t.jsxs(g,{children:[t.jsx(h,{variant:"headingMd",as:"h3",children:"AI queries"}),t.jsxs(h,{children:[r.ai_queries_used||0," / ",r.ai_queries_limit||0]})]}),t.jsxs(g,{children:[t.jsx(h,{variant:"headingMd",as:"h3",children:"Product limit"}),t.jsx(h,{children:r.product_limit||0})]})]}),t.jsxs(g,{paddingBlockStart:"400",children:[t.jsx(h,{variant:"headingMd",as:"h3",children:"Allowed AI providers"}),t.jsx(h,{children:((s=r.providersAllowed)==null?void 0:s.join(", "))||"None"})]}),r.trial_ends_at&&t.jsxs(g,{paddingBlockStart:"400",children:[t.jsx(h,{variant:"headingMd",as:"h3",children:"Trial ends at"}),t.jsx(h,{children:new Date(r.trial_ends_at).toLocaleDateString()})]})]})}):t.jsx(y,{children:t.jsx(g,{padding:"400",children:t.jsx(h,{children:"Loading plan info..."})})})}),_e=P.memo(()=>{const e=T("shop",""),r=window.location.pathname,a=r.includes("/ai-seo/collections")?"collections":r.includes("/ai-seo/sitemap")?"sitemap":r.includes("/ai-seo/store-metadata")?"store-metadata":r.includes("/ai-seo/schema-data")?"schema-data":"products",n=s=>{const i=new URLSearchParams(window.location.search);return`/ai-seo/${s}${i.toString()?`?${i.toString()}`:""}`};return t.jsxs("div",{children:[t.jsx(g,{paddingBlockEnd:"400",children:t.jsxs(R,{gap:"200",children:[t.jsx(x,{url:n("products"),primary:a==="products",children:"Products"}),t.jsx(x,{url:n("collections"),primary:a==="collections",children:"Collections"}),t.jsx(x,{url:n("sitemap"),primary:a==="sitemap",children:"Sitemap"}),t.jsx(x,{url:n("store-metadata"),primary:a==="store-metadata",children:"Store metadata"}),t.jsx(x,{url:n("schema-data"),primary:a==="schema-data",children:"Schema Data"})]})}),t.jsxs("div",{children:[a==="products"&&t.jsx(ae,{shop:e}),a==="collections"&&t.jsx(ce,{shop:e}),a==="sitemap"&&t.jsx(le,{shop:e}),a==="store-metadata"&&t.jsx(de,{shop:e}),a==="schema-data"&&t.jsx(ue,{shop:e})]})]})});function Ee(){K();const{path:e}=fe(),{lang:r,setLang:o,t:a}=ie(),n=!!new URLSearchParams(window.location.search).get("host"),s=T("shop",""),i=u.useMemo(()=>e.startsWith("/ai-seo")?"AI SEO":e.startsWith("/billing")?"Billing":e.startsWith("/settings")?"Settings":"Dashboard",[e]),l=()=>e==="/"||e.startsWith("/dashboard")?t.jsx(ge,{shop:s}):e.startsWith("/ai-seo")?t.jsx(_e,{shop:s}):e.startsWith("/billing")?t.jsx(y,{children:t.jsx(g,{padding:"400",children:t.jsx(h,{children:"Billing page"})})}):e.startsWith("/settings")?t.jsx(pe,{shop:s}):t.jsx(y,{children:t.jsx(g,{padding:"400",children:t.jsxs(h,{children:["Page not found: ",e]})})});return t.jsxs(U,{i18n:he,children:[n&&t.jsx(me,{active:e,shop:s}),t.jsx(W,{children:t.jsxs(G,{children:[t.jsx(re,{sectionTitle:i,lang:r,setLang:o,t:a,shop:s}),l()]})})]})}function Pe(){const e=new URLSearchParams(window.location.search),r=e.get("host"),o=e.get("shop");return console.log("[MAIN] Public App - Host:",r,"Shop:",o),console.log("[MAIN] Full URL:",window.location.href),console.log("[MAIN] Rendering with AppBridgeProvider (Public App)"),t.jsx(Y,{children:t.jsx(Ee,{})})}F(document.getElementById("root")).render(t.jsx(Pe,{}));export{Z as m,te as u};
