import{j as e}from"./app-bridge-YwxA37qC-1760712112618.js";import{r as j}from"./react-vendor-tAaa2TlE-1760712112618.js";import{m as Q}from"./sessionFetch-CJepNHo3-1760712112618.js";import{L as o,C as h,a as $,T as a,I as s,d as l,e as r,f as R,B as x,D as W,g as H}from"./polaris-BxgvwEpI-1760712112618.js";const J=(u,d="")=>{try{return new URLSearchParams(window.location.search).get(u)||d}catch{return d}};function _({shop:u}){var k,M,C,A,z,L,D,P,B,T,O,E,I;const d=u||J("shop",""),v=j.useMemo(()=>Q(),[]),c=i=>{const p=new URLSearchParams(window.location.search),q=p.toString()?`?${p.toString()}`:"";window.location.href=`${i}${q}`},[G,w]=j.useState(!0),[n,N]=j.useState(null),[t,U]=j.useState(null),[S,F]=j.useState(null);j.useEffect(()=>{d&&V()},[d]);const V=async()=>{try{w(!0);const i=await v(`/api/billing/info?shop=${d}`,{method:"GET",headers:{"Content-Type":"application/json"}});U(i.subscription),F(i.tokens);const p=await v(`/api/dashboard/stats?shop=${d}`,{method:"GET",headers:{"Content-Type":"application/json"}});N(p)}catch(i){console.error("[Dashboard] Error loading data:",i)}finally{w(!1)}},g=((k=n==null?void 0:n.products)==null?void 0:k.total)>0?Math.round(n.products.optimized/n.products.total*100):0,m=((M=n==null?void 0:n.collections)==null?void 0:M.total)>0?Math.round(n.collections.optimized/n.collections.total*100):0,b=["growth","growth extra","enterprise"].includes(t==null?void 0:t.plan),f=["professional","growth","growth extra","enterprise"].includes(t==null?void 0:t.plan),y=(t==null?void 0:t.plan)==="enterprise";return G?e.jsx(o,{children:e.jsx(o.Section,{children:e.jsx(h,{children:e.jsx($,{padding:"400",children:e.jsx(a,{children:"Loading dashboard..."})})})})}):e.jsxs(o,{children:[e.jsx(o.Section,{children:e.jsxs(s,{gap:"400",wrap:!1,children:[e.jsx("div",{style:{flex:1},children:e.jsx(h,{children:e.jsxs(l,{gap:"400",children:[e.jsxs(s,{align:"space-between",blockAlign:"center",children:[e.jsx(a,{variant:"headingMd",children:"Products"}),e.jsxs(r,{tone:g===100?"success":"attention",children:[((C=n==null?void 0:n.products)==null?void 0:C.optimized)||0," / ",((A=n==null?void 0:n.products)==null?void 0:A.total)||0]})]}),e.jsx(R,{progress:g,tone:g===100?"success":"primary"}),e.jsxs(a,{variant:"bodySm",tone:"subdued",children:[g,"% optimized for AI Search"]}),((z=n==null?void 0:n.products)==null?void 0:z.lastOptimized)&&e.jsxs(a,{variant:"bodySm",tone:"subdued",children:["Last: ",new Date(n.products.lastOptimized).toLocaleDateString()]})]})})}),b&&e.jsx("div",{style:{flex:1},children:e.jsx(h,{children:e.jsxs(l,{gap:"400",children:[e.jsxs(s,{align:"space-between",blockAlign:"center",children:[e.jsx(a,{variant:"headingMd",children:"Collections"}),e.jsxs(r,{tone:m===100?"success":"attention",children:[((L=n==null?void 0:n.collections)==null?void 0:L.optimized)||0," / ",((D=n==null?void 0:n.collections)==null?void 0:D.total)||0]})]}),e.jsx(R,{progress:m,tone:m===100?"success":"primary"}),e.jsxs(a,{variant:"bodySm",tone:"subdued",children:[m,"% optimized for AI Search"]}),((P=n==null?void 0:n.collections)==null?void 0:P.lastOptimized)&&e.jsxs(a,{variant:"bodySm",tone:"subdued",children:["Last: ",new Date(n.collections.lastOptimized).toLocaleDateString()]})]})})}),e.jsx("div",{style:{flex:1},children:e.jsx(h,{children:e.jsxs(l,{gap:"400",children:[e.jsx(a,{variant:"headingMd",children:"Token Balance"}),e.jsxs($,{children:[e.jsx(a,{variant:"heading2xl",alignment:"center",children:((B=S==null?void 0:S.balance)==null?void 0:B.toLocaleString())||0}),e.jsx(a,{variant:"bodySm",tone:"subdued",alignment:"center",children:"tokens available"}),((t==null?void 0:t.plan)==="growth extra"||(t==null?void 0:t.plan)==="enterprise")&&e.jsxs(a,{variant:"bodySm",tone:"subdued",alignment:"center",children:["(",(t==null?void 0:t.plan)==="growth extra"?"100M":"300M"," included)"]})]}),e.jsx(x,{variant:"primary",fullWidth:!0,onClick:()=>c("/billing"),children:"Manage Tokens"})]})})})]})}),e.jsx(o.Section,{children:e.jsx(h,{children:e.jsxs(l,{gap:"400",children:[e.jsx(a,{variant:"headingMd",children:"Quick Actions"}),e.jsxs(s,{gap:"300",wrap:!0,children:[e.jsx(x,{onClick:()=>c("/products"),children:"Optimize Products"}),b&&e.jsx(x,{onClick:()=>c("/collections"),children:"Optimize Collections"}),f&&e.jsx(x,{onClick:()=>c("/store-metadata"),children:"Edit Store Metadata"}),e.jsx(x,{onClick:()=>c("/sitemap"),children:"View Sitemap"}),y&&e.jsx(x,{onClick:()=>c("/schema"),children:"Advanced Schema"})]})]})})}),e.jsx(o.Section,{children:e.jsx(h,{children:e.jsxs(l,{gap:"400",children:[e.jsx(a,{variant:"headingMd",children:"AI Features Status"}),e.jsx(W,{}),e.jsxs(l,{gap:"300",children:[f&&e.jsxs(s,{align:"space-between",blockAlign:"center",children:[e.jsx(a,{variant:"bodyMd",children:"Store Metadata"}),(T=n==null?void 0:n.storeMetadata)!=null&&T.complete?e.jsx(r,{tone:"success",children:"✓ Complete"}):e.jsx(r,{tone:"warning",children:"Incomplete"})]}),e.jsxs(s,{align:"space-between",blockAlign:"center",children:[e.jsx(a,{variant:"bodyMd",children:"Sitemap"}),(O=n==null?void 0:n.sitemap)!=null&&O.generated?e.jsx(r,{tone:"success",children:"✓ Generated"}):e.jsx(r,{tone:"attention",children:"Not yet"})]}),y&&e.jsxs(s,{align:"space-between",blockAlign:"center",children:[e.jsx(a,{variant:"bodyMd",children:"Advanced Schema"}),(E=n==null?void 0:n.advancedSchema)!=null&&E.active?e.jsx(r,{tone:"success",children:"✓ Active"}):e.jsx(r,{tone:"attention",children:"Not set up"})]})]})]})})}),(n==null?void 0:n.alerts)&&n.alerts.length>0&&e.jsx(o.Section,{children:e.jsx(l,{gap:"300",children:n.alerts.map((i,p)=>e.jsx(H,{tone:i.type==="warning"?"warning":"info",title:i.title,action:i.action?{content:i.action.label,onAction:()=>c(i.action.url)}:void 0,children:i.message&&e.jsx("p",{children:i.message})},p))})}),e.jsx(o.Section,{children:e.jsx(h,{children:e.jsxs(l,{gap:"300",children:[e.jsxs(s,{align:"space-between",blockAlign:"center",children:[e.jsx(a,{variant:"headingMd",children:"Current Plan"}),e.jsx(r,{tone:"info",children:((I=t==null?void 0:t.plan)==null?void 0:I.toUpperCase())||"N/A"})]}),e.jsxs(a,{variant:"bodySm",tone:"subdued",children:["$",(t==null?void 0:t.price)||0,"/month"]}),e.jsx(x,{onClick:()=>c("/billing"),children:"View Plans & Billing"})]})})})]})}export{_ as default};
