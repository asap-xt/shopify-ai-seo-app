import{j as e}from"./app-bridge-CAQ4mTfo-1759004267748.js";import{r as o}from"./react-vendor-tAaa2TlE-1759004267748.js";import{u as kt}from"./index-CfACRGTX-1759004267748.js";import{U as zt}from"./UpgradeModal-jfKY76Vg-1759004267748.js";import{M as E,d as K,T as r,e as Je,a as c,I as y,f as be,B as U,D as Ot,g as Q,C as Xe,h as Ze,i as Mt,S as Kt,P as Ee,j as Le,R as $t,k as Wt,l as et,m as Nt,E as Rt}from"./polaris-BCXdWoP9-1759004267748.js";const Gt=(b,g="")=>{try{return new URLSearchParams(window.location.search).get(b)||g}catch{return g}},ze=b=>{if(!b)return b;const g=String(b).trim();return g.startsWith("gid://")?g:`gid://shopify/Product/${g}`},Ht=b=>{if(!b)return"";const g=String(b).match(/\/(\d+)$/);return g?g[1]:b},G=b=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(b==null?void 0:b.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(b==null?void 0:b.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}};function Jt({shop:b}){const{api:g,shop:tt}=kt(),l=b||tt||Gt("shop","");o.useEffect(()=>{console.log("[BULK-EDIT] Component mounted"),console.log("[BULK-EDIT] Shop:",l),console.log("[BULK-EDIT] API function available:",typeof g=="function")},[l,g]);const[A,F]=o.useState([]),[ee,ce]=o.useState(!1),[st,Oe]=o.useState(1),[nt,Ie]=o.useState(!0),[q,Me]=o.useState(0),[x,te]=o.useState([]),[T,de]=o.useState(!1),[_,Ke]=o.useState(""),[O,ue]=o.useState("all"),[k,se]=o.useState(""),[ge,Ft]=o.useState("createdAt"),[Y,ot]=o.useState("desc"),[$,pe]=o.useState([]),[at,lt]=o.useState([]),[$e,Ae]=o.useState(!1),[We,we]=o.useState(!1),[Ne,Pe]=o.useState(!1),[Re,Te]=o.useState(!1),[ne,Ge]=o.useState(""),[He,it]=o.useState([]),[W,he]=o.useState([]),[D,Fe]=o.useState([]),[De,J]=o.useState(!1),[me,N]=o.useState({current:0,total:0,percent:0}),[qe,X]=o.useState(""),[fe,oe]=o.useState([]),[ae,_e]=o.useState({}),[rt,Ce]=o.useState(!1),[ct,Se]=o.useState(!1),[dt,le]=o.useState(!1),[R,ie]=o.useState([]),[ut,xe]=o.useState(!1),[Ve,L]=o.useState(""),[ve,Be]=o.useState(!1),[I,re]=o.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[w,gt]=o.useState(null),[pt,je]=o.useState(!1),[ye,ht]=o.useState(localStorage.getItem("hasVisitedProducts")==="true"),[mt,Ue]=o.useState(!1),[ft,St]=o.useState("starter");o.useEffect(()=>{if(!l)return;g("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          modelsSuggested
        }
      }
    `,variables:{shop:l}})}).then(s=>{var i,m,d;if((i=s==null?void 0:s.errors)!=null&&i.length)throw new Error(((m=s.errors[0])==null?void 0:m.message)||"GraphQL error");const a=(d=s==null?void 0:s.data)==null?void 0:d.plansMe,p=(a==null?void 0:a.modelsSuggested)||["anthropic/claude-3.5-sonnet"];it(p.map(n=>({label:n,value:n}))),Ge(p[0]),gt((a==null?void 0:a.plan)||"starter")}).catch(s=>console.error("[BULK-EDIT] GraphQL plansMe failed:",s))},[l,g]),o.useEffect(()=>{if(console.log("[BULK-EDIT] Languages useEffect triggered",{shop:l,api:!!g}),!l){console.log("[BULK-EDIT] No shop, skipping languages load");return}console.log("[BULK-EDIT] Making languages API call to:",`/api/languages/shop/${l}`),console.log("[BULK-EDIT] About to call api() function");const t=new Promise((s,a)=>{setTimeout(()=>a(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([g(`/api/languages/shop/${l}`),t]).then(s=>{console.log("[BULK-EDIT] Languages API response:",s);const a=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];console.log("[BULK-EDIT] Setting available languages to:",a.includes("en")?a:["en",...a]),Fe(a.includes("en")?a:["en",...a])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),console.error("[BULK-EDIT] Error details:",s.message,s.stack),Fe(["en"])})},[l,g]),o.useEffect(()=>{l&&g("/api/products/tags/list",{shop:l}).then(t=>lt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[l,g]);const H=o.useCallback(async(t=1,s=!1,a=null)=>{var p,i,m,d;console.log(`[BULK-EDIT-LOAD] loadProducts called with pageNum: ${t}, append: ${s}, timestamp: ${a}`),console.log("[BULK-EDIT-LOAD] Current products state:",A.length),ce(!0);try{const n=new URLSearchParams({shop:l,page:t,limit:50,...O!=="all"&&{optimized:O},..._&&{search:_},...k&&{languageFilter:k},...$.length>0&&{tags:$.join(",")},sortBy:ge,sortOrder:Y,...a&&{_t:a}}),u=await g(`/api/products/list?${n}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log(`[BULK-EDIT-LOAD] API returned ${((p=u.products)==null?void 0:p.length)||0} products`),((i=u.products)==null?void 0:i.length)>0&&console.log("[BULK-EDIT-LOAD] First product data:",{id:u.products[0].id,_id:u.products[0]._id,title:u.products[0].title,optimizationSummary:u.products[0].optimizationSummary,allKeys:Object.keys(u.products[0])}),F(s?j=>[...j,...u.products]:u.products||[]),Oe(t),Ie(((m=u.pagination)==null?void 0:m.hasNext)||!1),Me(((d=u.pagination)==null?void 0:d.total)||0)}catch(n){F(s?A:[]),Ie(!1),L(`Error loading products: ${n.message}`)}finally{ce(!1)}},[l,O,_,k,$,ge,Y]);o.useEffect(()=>{l&&H(1,!1,null)},[l,H,O,k,$,ge,Y]),o.useEffect(()=>{!ye&&l&&(localStorage.setItem("hasVisitedProducts","true"),ht(!0))},[ye,l]),o.useEffect(()=>{A.length===0&&!ee&&l&&!ye&&je(!0)},[A.length,ee,l,ye]);const Qe=o.useCallback(t=>{Ke(t)},[]);o.useEffect(()=>{const t=setTimeout(()=>{l&&H(1,!1,null)},500);return()=>clearTimeout(t)},[_]);const xt=o.useCallback(t=>{te(t),t.length===0&&de(!1)},[]),Ye=o.useCallback(t=>{de(t),te(t?A.map(s=>s.id):[])},[A]),jt=()=>{if(x.length===0&&!T){L("Please select products first");return}Se(!0)},yt=()=>{if(x.length===0&&!T){L("Please select products first");return}ie([]),le(!0)},bt=()=>{const s=A.filter(i=>x.includes(i.id)).filter(i=>{var m,d;return((d=(m=i.optimizationSummary)==null?void 0:m.optimizedLanguages)==null?void 0:d.length)>0}),a=async()=>{var m;if(console.log("üîç [AI-ENHANCE] handleStartEnhancement called with products:",s),w&&!["Growth Extra","Enterprise"].includes(w)){St(w),Be(!1),Ue(!0);return}re({processing:!0,current:0,total:s.length,currentItem:"",results:null});const i={successful:0,failed:0,skipped:0,skippedDueToPlan:0};for(let d=0;d<s.length;d++){const n=s[d];re(u=>({...u,current:d,currentItem:n.title}));try{if(!(await g("/ai-enhance/check-eligibility",{method:"POST",shop:l,body:{shop:l}})).eligible){i.skipped++,i.skippedDueToPlan++;continue}const j=await g("/ai-enhance/product",{method:"POST",shop:l,body:{shop:l,productId:n.gid||`gid://shopify/Product/${n.productId}`,languages:n.optimizationSummary.optimizedLanguages}});if(console.log(`üîç [AI-ENHANCE] Product ${n.productId} enhance data:`,j),j.results&&j.results.length>0){const v={shop:l,productId:n.gid||`gid://shopify/Product/${n.productId}`,results:j.results.filter(f=>f.bullets&&f.faq).map(f=>{console.log(`üîç [AI-ENHANCE] Language ${f.language} - AI bullets:`,f.bullets),console.log(`üîç [AI-ENHANCE] Language ${f.language} - AI FAQ:`,f.faq),console.log(`üîç [AI-ENHANCE] Language ${f.language} - updatedSeo from AI:`,f.updatedSeo);const C={language:f.language,seo:{...f.updatedSeo,bullets:f.bullets||[],faq:f.faq||[]}};return console.log(`üîç [AI-ENHANCE] Language ${f.language} - final seo result:`,JSON.stringify(C.seo,null,2)),C}),options:{updateBullets:!0,updateFaq:!0}};console.log(`üîç [AI-ENHANCE] Applying data for product ${n.productId}:`,v),console.log("üîç [AI-ENHANCE] First result SEO object:",JSON.stringify((m=v.results[0])==null?void 0:m.seo,null,2));const h=await g("/api/seo/apply-multi",{method:"POST",shop:l,body:v});console.log(`üîç [AI-ENHANCE] Apply result for product ${n.productId}:`,h),i.successful++}else console.log(`üîç [AI-ENHANCE] No valid results for product ${n.productId}:`,j),i.failed++}catch(u){console.error("Enhancement error:",u),i.failed++}re(u=>({...u,current:d+1}))}re(d=>({...d,processing:!1,results:i})),L(`AI enhancement complete! ${i.successful} products enhanced.`)},p=()=>{Be(!1),re({processing:!1,current:0,total:0,currentItem:"",results:null}),I.results&&I.results.successful>0&&H(1,!1,null)};return!I.processing&&!I.results?e.jsx(E,{open:ve,title:"AI Enhanced add-ons for AI Search",onClose:p,primaryAction:{content:"Start AI Enhancement",onAction:a},secondaryActions:[{content:"Cancel",onAction:p}],children:e.jsx(E.Section,{children:e.jsxs(K,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["AI enhancement will improve bullets and FAQ for ",s.length," products."]}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI enhancement is only available for Growth Extra and Enterprise plans."})]})})}):I.processing?e.jsx(E,{open:ve,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(E.Section,{children:e.jsxs(K,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",I.currentItem]}),e.jsx(Je,{progress:I.current/I.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[I.current," of ",I.total," products (",Math.round(I.current/I.total*100),"%)"]})]})})}):I.results!==null?e.jsx(E,{open:ve,title:"AI Enhancement Results",onClose:p,primaryAction:{content:"Done",onAction:p},children:e.jsx(E.Section,{children:e.jsxs(K,{gap:"300",children:[e.jsxs(y,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:I.results.successful})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:I.results.failed})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:I.results.skipped})]})]}),I.results.skippedDueToPlan>0&&e.jsx(c,{paddingBlockStart:"300",children:e.jsx(r,{variant:"bodySm",tone:"subdued",children:"AI enhancement is only available for Growth Extra and Enterprise plans."})})]})})}):null},Et=async()=>{var t;if(console.log("[BULK-EDIT/DEBUG] ===== GENERATE SEO START ====="),console.log("[BULK-EDIT/DEBUG] selectedLanguages:",W),console.log("[BULK-EDIT/DEBUG] model:",ne),console.log("[BULK-EDIT/DEBUG] modelOptions:",He),!W.length){L("Please select at least one language");return}if(!ne||!ne.trim()){console.log("[BULK-EDIT/DEBUG] Model is empty, using fallback");const s=((t=He[0])==null?void 0:t.value)||"anthropic/claude-3.5-sonnet";console.log("[BULK-EDIT/DEBUG] Using fallback model:",s),Ge(s)}Se(!1),J(!0),N({current:0,total:0,percent:0}),oe([]),_e({});try{let s=[];T?s=(await g(`/api/products/list?shop=${encodeURIComponent(l)}&limit=1000&fields=id`)).products||[]:s=A.filter(h=>x.includes(h.id));const a=G(w),p=s.length;s=s.slice(0,a);const i=s.length,m=p-i;N({current:0,total:i,percent:0});const d=5,n={};for(let h=0;h<s.length;h+=d){const C=s.slice(h,Math.min(h+d,s.length)).map(async S=>{var M;X(S.title||S.handle||"Product");try{const B=S.gid||ze(S.productId||S.id),V=((M=S.optimizationSummary)==null?void 0:M.optimizedLanguages)||[],Z=W.filter(Ut=>!V.includes(Ut));if(Z.length===0){n[S.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}console.log("[BULK-EDIT/DEBUG] Making API call with:"),console.log("[BULK-EDIT/DEBUG] - productId:",B),console.log("[BULK-EDIT/DEBUG] - model:",ne),console.log("[BULK-EDIT/DEBUG] - languages:",Z);const Bt=await g("/api/seo/generate-multi",{method:"POST",shop:l,body:{shop:l,productId:B,model:ne,languages:Z}});n[S.id]={success:!0,data:Bt,languages:Z}}catch(B){n[S.id]={success:!1,error:B.message},oe(V=>[...V,{product:S.title,error:B.message}])}});await Promise.all(C);const z=Math.min(h+d,s.length),P=Math.round(z/i*100);N({current:z,total:i,percent:P})}_e(n),Ce(!0);const u=Object.keys(n).filter(h=>n[h].success&&!n[h].skipped).length,j=Object.keys(n).filter(h=>n[h].skipped).length;let v=`Generated Optimization for AI Search for ${u} products`;j>0&&(v+=` (${j} already optimised)`),m>0&&(v+=` (${m} skipped due to plan limit)`),L(v)}catch(s){L(`Error: ${s.message}`)}finally{J(!1),X("")}},Lt=async()=>{var t,s,a,p;J(!0),N({current:0,total:0,percent:0});try{const i=Object.entries(ae).filter(([u,j])=>j.success&&!j.skipped),m=i.length;N({current:0,total:m,percent:0});for(let u=0;u<i.length;u++){const[j,v]=i[u],h=A.find(z=>z.id===j);if(!h)continue;X(h.title||"Product");try{const z=h.gid||ze(h.productId||h.id),P=await g("/api/seo/apply-multi",{method:"POST",shop:l,body:{shop:l,productId:z,results:v.data.results.filter(S=>S==null?void 0:S.seo).map(S=>({language:S.language,seo:S.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});P.appliedLanguages&&P.appliedLanguages.length>0&&(console.log(`[BULK-EDIT] Optimistic update for product ${j}, languages:`,P.appliedLanguages),F(S=>S.map(M=>{var B;if(M.id===j){const V=((B=M.optimizationSummary)==null?void 0:B.optimizedLanguages)||[],Z=[...new Set([...V,...P.appliedLanguages])];return{...M,optimizationSummary:{...M.optimizationSummary,optimizedLanguages:Z,optimized:!0,lastOptimized:new Date().toISOString()}}}return M})))}catch(z){oe(P=>[...P,{product:h.title,error:`Apply failed: ${z.message}`}])}const f=u+1,C=Math.round(f/m*100);N({current:f,total:m,percent:C})}L("AI Search Optimisation applied successfully!"),Ce(!1),te([]),de(!1),console.log("[BULK-EDIT] Waiting for database propagation..."),await new Promise(u=>setTimeout(u,1e3)),console.log("[BULK-EDIT] Clearing products state before reload..."),F([]),console.log("[BULK-EDIT] Reloading products with cache bypass...");const d=new URLSearchParams({shop:l,page:1,limit:50,...O!=="all"&&{optimized:O},..._&&{search:_},...k&&{languageFilter:k},...$.length>0&&{tags:$.join(",")},sortBy:ge,sortOrder:Y,_t:Date.now()}),n=await g(`/api/products/list?${d}`,{shop:l,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log("[BULK-EDIT] Products reloaded, first product:",(t=n.products[0])==null?void 0:t.title),console.log("[BULK-EDIT] First product optimization summary:",(s=n.products[0])==null?void 0:s.optimizationSummary),F(n.products||[]),Oe(1),Ie(((a=n.pagination)==null?void 0:a.hasNext)||!1),Me(((p=n.pagination)==null?void 0:p.total)||0)}catch(i){L(`Error applying AI Search Optimisation: ${i.message}`)}finally{J(!1),X("")}},It=async()=>{var t,s;if(!R.length){L("Please select at least one language to delete");return}le(!1),xe(!1),J(!0),N({current:0,total:0,percent:0}),oe([]);try{let a=[];T?a=(await g(`/api/products/list?shop=${encodeURIComponent(l)}&limit=1000&fields=id`)).products||[]:a=A.filter(d=>x.includes(d.id));const p=a.length;N({current:0,total:p,percent:0});let i=0,m=0;for(let d=0;d<a.length;d++){const n=a[d];X(n.title||n.handle||"Product");try{const v=n.gid||ze(n.productId||n.id),h=((t=n.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],f=R.filter(z=>h&&h.length>0&&h.includes(z));if(console.log("[BULK-DELETE] Product optimized languages:",h),console.log("[BULK-DELETE] Languages to delete:",f),f.length===0){m++;continue}const C=await g("/api/seo/delete-multi",{method:"POST",shop:l,body:{shop:l,productId:v,languages:f}});console.log("[BULK-DELETE] Delete response:",C),console.log("[BULK-DELETE] Deleted languages:",C.deletedLanguages),C.deletedLanguages&&C.deletedLanguages.length>0&&(console.log("[BULK-DELETE] Before optimistic update, product:",n),console.log("[BULK-DELETE] Current optimized languages:",(s=n.optimizationSummary)==null?void 0:s.optimizedLanguages),F(z=>z.map(P=>{var S;if(P.id===n.id){const M=((S=P.optimizationSummary)==null?void 0:S.optimizedLanguages)||[],B=M.filter(V=>!C.deletedLanguages.includes(V));return console.log("[BULK-DELETE] Updating product:",P.id),console.log("[BULK-DELETE] Languages before:",M),console.log("[BULK-DELETE] Languages after:",B),{...P,optimizationSummary:{...P.optimizationSummary,optimizedLanguages:B,optimized:B.length>0,lastOptimized:B.length>0?P.optimizationSummary.lastOptimized:null}}}return P})),console.log("[BULK-DELETE] State updated, checking first product:",A[0])),i++,C.deletedLanguages&&C.deletedLanguages.length>0&&await g("/api/products/verify-after-delete",{method:"POST",shop:l,body:{shop:l,productIds:[v],deletedLanguages:C.deletedLanguages}})}catch(v){oe(h=>[...h,{product:n.title,error:v.message}])}const u=d+1,j=Math.round(u/p*100);N({current:u,total:p,percent:j})}te([]),de(!1),m>0?L(`Deleted Optimization for AI Search from ${i} products (${m} had no optimisation to delete)`):L(`Deleted Optimization for AI Search from ${i} products`),console.log("[BULK-DELETE] Operation successful!"),setTimeout(()=>{console.log("[BULK-DELETE] Triggering reload with timestamp");const d=Date.now();H(1,!1,d)},500)}catch(a){L(`Error: ${a.message}`)}finally{J(!1),X("")}},At=t=>{var m,d;const s=t,a=Ht(s.productId||s.id),p=((m=s.optimizationSummary)==null?void 0:m.optimizedLanguages)||[];console.log(`[BULK-EDIT] Rendering product: "${s.title}"`),console.log("[BULK-EDIT] optimizationSummary:",s.optimizationSummary),console.log("[BULK-EDIT] optimizedLanguages:",p),console.log("[BULK-EDIT] availableLanguages:",D);const i=(d=s.images)!=null&&d[0]?e.jsx(et,{source:s.images[0].url||s.images[0].src||s.images[0],alt:s.title,size:"small"}):s.imageUrl?e.jsx(et,{source:s.imageUrl,alt:s.title,size:"small"}):e.jsx(c,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Nt,{id:s.id,url:"",media:i,accessibilityLabel:`View details for ${s.title}`,children:e.jsxs(y,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(c,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:s.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["ID: ",a]})]}),e.jsx(c,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(y,{gap:"100",children:(console.log(`[BULK-EDIT] Rendering badges for "${s.title}"`),console.log("[BULK-EDIT] availableLanguages.length:",D.length),console.log("[BULK-EDIT] availableLanguages:",D),console.log("[BULK-EDIT] optimizedLanguages:",p),D.length>0?(console.log("[BULK-EDIT] Using availableLanguages.map"),D.map(n=>{const u=p.includes(n);return console.log(`[BULK-EDIT] Language ${n}: optimized=${u}`),e.jsx(Q,{tone:u?"success":"subdued",size:"small",children:n.toUpperCase()},n)})):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),p.map(n=>e.jsx(Q,{tone:"success",size:"small",children:n.toUpperCase()},n))))})}),e.jsx(c,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(Q,{tone:"success",children:"Active"})})]})})},wt=De&&e.jsx(E,{open:De,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(E.Section,{children:e.jsxs(K,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:qe?`Processing: ${qe}`:"Preparing..."}),e.jsx(Je,{progress:me.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[me.current," of ",me.total," products (",me.percent,"%)"]})]})})}),Pt=e.jsx(E,{open:ct,title:"Select Languages",onClose:()=>{Se(!1),he([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Et,disabled:W.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{Se(!1),he([])}}],children:e.jsx(E.Section,{children:e.jsxs(K,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",T?"all":x.length," selected products:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:D.map(t=>e.jsx(be,{label:t.toUpperCase(),checked:W.includes(t),onChange:s=>{he(s?[...W,t]:W.filter(a=>a!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(U,{plain:!0,onClick:()=>{he(W.length===D.length?[]:[...D])},children:W.length===D.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Tt=e.jsx(E,{open:rt&&!De,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:Lt,disabled:!Object.values(ae).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Ce(!1)}],children:e.jsx(E.Section,{children:e.jsxs(K,{gap:"300",children:[e.jsxs(y,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(ae).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(ae).filter(t=>t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(ae).filter(t=>!t.success).length})]})]}),fe.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ot,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(c,{maxHeight:"200px",overflowY:"scroll",children:[fe.slice(0,10).map((t,s)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),fe.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",fe.length-10," more errors"]})]})]})]})})}),Dt=e.jsx(E,{open:dt,title:"Delete Optimization for AI Search",onClose:()=>{le(!1),ie([])},primaryAction:{content:"Continue",onAction:()=>{le(!1),xe(!0)},disabled:R.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{le(!1),ie([])}}],children:e.jsx(E.Section,{children:e.jsxs(K,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",T?"all":x.length," selected products:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:D.map(t=>e.jsx(be,{label:t.toUpperCase(),checked:R.includes(t),onChange:s=>{ie(s?[...R,t]:R.filter(a=>a!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(U,{plain:!0,onClick:()=>{ie(R.length===D.length?[]:[...D])},children:R.length===D.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Ct=e.jsx(E,{open:ut,title:"Confirm Deletion",onClose:()=>{xe(!1)},primaryAction:{content:"Delete",onAction:It,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>xe(!1)}],children:e.jsx(E.Section,{children:e.jsxs(K,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(c,{paddingBlock:"200",children:e.jsx(y,{gap:"100",children:R.map(t=>e.jsx(Q,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",T?"ALL":x.length," selected products."]}),e.jsx(r,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),ke=async()=>{try{ce(!0),L("Syncing products from Shopify...");const t=await g("/api/products/sync",{method:"POST",shop:l});if(t.success){const s=t.productsCount||t.synced||0;L(`‚úÖ Synced ${s} products successfully!`),setTimeout(()=>{H(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),L(`‚ùå Sync failed: ${t.message}`)}finally{ce(!1)}},vt=e.jsx(Rt,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Ke(""),ue("all"),se(""),pe([]),H(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:ke},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Xe,{children:e.jsxs(c,{padding:"400",children:[e.jsxs(K,{gap:"300",children:[w&&e.jsx(Ze,{tone:"info",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(r,{children:["Your ",e.jsx("strong",{children:w})," plan includes up to"," ",e.jsx("strong",{children:G(w)})," products for SEO optimization.",q>G(w)&&e.jsxs(e.Fragment,{children:[" You have ",q," products, so only the first ",G(w)," will be processed."]})]}),(x.length>0||T)&&e.jsxs(r,{children:["Selected: ",T?Math.min(q,G(w)):x.length,"/",G(w)]})]})}),w&&(x.length>G(w)||T&&q>G(w))&&e.jsx(Ze,{tone:"warning",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(r,{children:[e.jsx("strong",{children:"Plan Limit Exceeded:"})," You've selected more products than your ",w," plan allows. Only the first ",G(w)," products will be processed."]}),e.jsx(U,{size:"micro",onClick:()=>Ue(!0),children:"Upgrade Plan"})]})}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(c,{minWidth:"400px",children:e.jsx(Mt,{label:"",placeholder:"Search by product ID, name, or details...",value:_,onChange:Qe,prefix:e.jsx(Kt,{}),clearButton:!0,onClearButtonClick:()=>Qe("")})}),e.jsx(c,{width:"320px",children:e.jsx(U,{primary:!0,onClick:jt,disabled:x.length===0&&!T,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(U,{onClick:ke,disabled:ee,size:"medium",children:"Sync Products"}),e.jsx(c,{width:"320px",children:e.jsxs(K,{gap:"200",align:"end",children:[x.length===0&&!T||!A.filter(a=>x.includes(a.id)).some(a=>{var p,i;return((i=(p=a.optimizationSummary)==null?void 0:p.optimizedLanguages)==null?void 0:i.length)>0})?null:e.jsx(U,{onClick:()=>Be(!0),disabled:x.length===0&&!T,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(U,{onClick:yt,disabled:x.length===0&&!T||!A.filter(a=>x.includes(a.id)).some(a=>{var p,i;return((i=(p=a.optimizationSummary)==null?void 0:p.optimizedLanguages)==null?void 0:i.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),q>0&&e.jsx(c,{paddingBlockStart:"300",children:e.jsx(be,{label:`Select all ${q} products in your store`,checked:T,onChange:Ye})})]})}),e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(Xe,{children:[e.jsxs(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(y,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(y,{gap:"200",wrap:!0,children:[e.jsx(Ee,{active:$e,activator:e.jsx(U,{disclosure:"down",onClick:()=>Ae(!$e),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),O!=="all"&&e.jsx(c,{onClick:t=>{t.stopPropagation(),ue("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>Ae(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Le,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[O],onChange:t=>{ue(t[0]),se(""),Ae(!1)}})})}),e.jsx(Ee,{active:We,activator:e.jsx(U,{disclosure:"down",onClick:()=>we(!We),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),k&&e.jsx(c,{onClick:t=>{t.stopPropagation(),se("")},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>we(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Le,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...D.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...D.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:k?[k]:[],onChange:t=>{se(t[0]||""),we(!1)}})})}),e.jsx(Ee,{active:Ne,activator:e.jsx(U,{disclosure:"down",onClick:()=>Pe(!Ne),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),$.length>0&&e.jsx(c,{onClick:t=>{t.stopPropagation(),pe([])},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>Pe(!1),children:e.jsxs(c,{padding:"300",minWidth:"200px",children:[e.jsx(Le,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:at.map(t=>({label:t,value:t})),selected:$,onChange:t=>{pe(t)}}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(U,{size:"slim",onClick:()=>Pe(!1),children:"Apply"})})]})})]}),e.jsx(Ee,{active:Re,activator:e.jsx(U,{disclosure:"down",onClick:()=>Te(!Re),removeUnderline:!0,children:e.jsx(y,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:Y==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Te(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Le,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[Y],onChange:t=>{ot(t[0]),Te(!1)}})})})]}),(O!=="all"||k||$.length>0)&&e.jsx(c,{paddingBlockStart:"200",children:e.jsxs(y,{gap:"100",wrap:!0,children:[O!=="all"&&e.jsx(Q,{onRemove:()=>ue("all"),children:O==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),k&&e.jsx(Q,{onRemove:()=>se(""),children:k.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),$.map(t=>e.jsxs(Q,{onRemove:()=>pe(s=>s.filter(a=>a!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(c,{children:[e.jsx(c,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(y,{gap:"200",align:"start",children:[e.jsx(be,{checked:x.length===A.length&&A.length>0,onChange:Ye,label:""}),e.jsxs(r,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",x.length>0&&` (${x.length} selected products)`]})]})}),e.jsx($t,{resourceName:{singular:"product",plural:"products"},items:A,renderItem:At,selectedItems:x,onSelectionChange:xt,selectable:!0,loading:ee,totalItemsCount:q,emptyState:vt,showHeader:!1})]}),nt&&!ee&&e.jsx(c,{padding:"400",textAlign:"center",children:e.jsx(U,{onClick:()=>H(st+1,!0,null),children:"Load more"})})]})}),wt,Pt,Tt,Dt,Ct,bt(),e.jsx(E,{open:pt,onClose:()=>je(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{je(!1),ke()}},secondaryActions:[{content:"Skip for now",onAction:()=>je(!1)}],children:e.jsx(E.Section,{children:e.jsxs(K,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(r,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(zt,{open:mt,onClose:()=>Ue(!1),featureName:"AI Enhancement",currentPlan:ft}),Ve&&e.jsx(Wt,{content:Ve,onDismiss:()=>L("")})]})}export{Jt as default};
