import{j as e}from"./app-bridge-CKSN_lCm-1760728058402.js";import{r as h}from"./react-vendor-tAaa2TlE-1760728058402.js";import{m as ne}from"./sessionFetch-CJepNHo3-1760728058402.js";import{L as g,C as u,a as r,T as n,d as ae,e as i,f as D,I as d,B as c,D as y,g as te,h as O,i as se}from"./polaris-CT3Tgb0p-1760728058402.js";const ie=(v,x="")=>{try{return new URLSearchParams(window.location.search).get(v)||x}catch{return x}};function le({shop:v}){var I,T,$,R,N,F,V,_;const x=v||ie("shop",""),m=h.useMemo(()=>ne(),[]),p=t=>{const o=new URLSearchParams(window.location.search),j=o.toString()?`?${o.toString()}`:"";window.location.href=`${t}${j}`},[G,P]=h.useState(!0),[a,U]=h.useState(null),[s,q]=h.useState(null),[f,Q]=h.useState(null),[l,w]=h.useState(null),[b,M]=h.useState(!1),[Y,E]=h.useState(!1),[S,H]=h.useState(!1);h.useEffect(()=>{L(),J()},[x]),h.useEffect(()=>{l&&l.autoSyncEnabled&&!l.synced&&z()},[l]);const L=async()=>{try{P(!0);const[t,o]=await Promise.all([m.get(`/api/dashboard/stats?shop=${x}`),m.get(`/api/billing/tokens/balance?shop=${x}`)]);if(t.ok&&o.ok){const j=await t.json(),k=await o.json();U(j),q(j.subscription),Q(k)}}catch(t){console.error("[Dashboard] Error loading data:",t)}finally{P(!1)}},J=async()=>{try{const t=await m.get(`/api/dashboard/sync-status?shop=${x}`);if(t.ok){const o=await t.json();w(o),E(o.autoSyncEnabled||!1)}}catch(t){console.error("[Dashboard] Error loading sync status:",t)}},z=async()=>{try{M(!0);const t=await m.post(`/api/dashboard/sync?shop=${x}`,{});if(console.log("[Dashboard] Sync start response:",t.status),t.ok){const o=setInterval(async()=>{const j=await m.get(`/api/dashboard/sync-status?shop=${x}`);if(j.ok){const k=await j.json();w(k),k.inProgress||(clearInterval(o),M(!1),L())}},2e3)}}catch(t){console.error("[Dashboard] Error syncing:",t),M(!1)}},K=async t=>{try{(await m.post(`/api/dashboard/auto-sync?shop=${x}`,{enabled:t})).ok&&(E(t),w({...l,autoSyncEnabled:t}))}catch(o){console.error("[Dashboard] Error toggling auto-sync:",o)}},C=((I=a==null?void 0:a.products)==null?void 0:I.total)>0?Math.round(a.products.optimized/a.products.total*100):0,B=((T=a==null?void 0:a.collections)==null?void 0:T.total)>0?Math.round(a.collections.optimized/a.collections.total*100):0,W=["growth","growth_extra","enterprise"].includes(s==null?void 0:s.plan),X=["professional","growth","growth_extra","enterprise"].includes(s==null?void 0:s.plan),Z=(s==null?void 0:s.plan)==="enterprise",ee=["growth_extra","enterprise"].includes(s==null?void 0:s.plan);if(G)return e.jsx(g,{children:e.jsx(g.Section,{children:e.jsx(u,{children:e.jsx(r,{padding:"400",children:e.jsx(n,{children:"Loading dashboard..."})})})})});const A=!(l!=null&&l.synced);return e.jsxs(g,{children:[e.jsx(g.Section,{children:e.jsx(n,{variant:"headingLg",as:"h1",children:"Store Overview"})}),A&&e.jsx(g.Section,{children:e.jsx(ae,{title:"Sync your store",tone:"info",action:{content:b?"Syncing...":"Sync Now",onAction:z,loading:b},children:e.jsxs(i,{gap:"200",children:[e.jsx(n,{children:"Sync products, collections, languages, and markets to get started with AI optimization."}),b&&e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(D,{progress:50,size:"small",tone:"highlight"}),e.jsx(r,{paddingBlockStart:"100",children:e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Fetching store data..."})})]})]})})}),!A&&l&&e.jsx(g.Section,{children:e.jsx(u,{children:e.jsxs(i,{gap:"300",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"Store Sync"}),e.jsx(r,{paddingBlockStart:"050",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["Last synced: ",l.lastSyncDate?new Date(l.lastSyncDate).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"]})})]}),e.jsx(c,{onClick:z,loading:b,children:"Sync Now"})]}),e.jsx(y,{}),e.jsx(te,{label:"Auto-sync on load",checked:Y,onChange:K,helpText:"Automatically sync store data when you open the dashboard"})]})})}),e.jsx(g.Section,{children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"16px"},children:[e.jsx(u,{children:e.jsxs(i,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Products"}),e.jsxs(i,{gap:"200",children:[e.jsxs(d,{align:"space-between",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Total"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:(($=a==null?void 0:a.products)==null?void 0:$.total)||0})]}),e.jsxs(d,{align:"space-between",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Optimized"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:((R=a==null?void 0:a.products)==null?void 0:R.optimized)||0})]}),e.jsx(y,{}),e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(D,{progress:C,size:"small",tone:C===100?"success":"primary"}),e.jsx(r,{paddingBlockStart:"100",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[C,"% optimized"]})})]})]})]})}),W&&e.jsx(u,{children:e.jsxs(i,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Collections"}),e.jsxs(i,{gap:"200",children:[e.jsxs(d,{align:"space-between",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Total"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:((N=a==null?void 0:a.collections)==null?void 0:N.total)||0})]}),e.jsxs(d,{align:"space-between",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Optimized"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:((F=a==null?void 0:a.collections)==null?void 0:F.optimized)||0})]}),e.jsx(y,{}),e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(D,{progress:B,size:"small",tone:B===100?"success":"primary"}),e.jsx(r,{paddingBlockStart:"100",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[B,"% optimized"]})})]})]})]})}),e.jsx(u,{children:e.jsxs(i,{gap:"400",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{variant:"headingMd",children:"Languages"}),(a==null?void 0:a.storeMarkets)&&a.storeMarkets.length>0&&e.jsxs(O,{tone:"info",children:[a.storeMarkets.length," markets"]})]}),e.jsx(i,{gap:"200",children:a!=null&&a.languages&&a.languages.length>0?e.jsxs(e.Fragment,{children:[a.languages.slice(0,3).map((t,o)=>e.jsxs(d,{align:"space-between",children:[e.jsxs(n,{variant:"bodyMd",tone:"subdued",children:[t.name||t.code," ",t.primary&&"★"]}),e.jsx(O,{tone:t.optimizedCount>0?"success":"subdued",children:t.optimizedCount||0})]},o)),a.languages.length>3&&e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["+",a.languages.length-3," more..."]})]}):e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"No language data"})}),(a==null?void 0:a.storeMarkets)&&a.storeMarkets.length>0&&e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(y,{}),e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["Markets: ",a.storeMarkets.slice(0,2).map(t=>t.name).join(", "),a.storeMarkets.length>2?` +${a.storeMarkets.length-2}`:""]})})]})]})})]})}),e.jsx(g.Section,{children:e.jsxs(d,{gap:"400",wrap:!0,children:[e.jsx("div",{style:{flex:"1",minWidth:"300px"},children:e.jsx(u,{children:e.jsxs(i,{gap:"300",children:[e.jsx(n,{variant:"headingMd",children:"Last Optimization"}),e.jsx(n,{variant:"bodyLg",fontWeight:"semibold",children:a!=null&&a.lastOptimization?new Date(a.lastOptimization).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}),e.jsx(c,{onClick:()=>p("/ai-seo/products"),children:"Optimize Now"})]})})}),e.jsx("div",{style:{flex:"1",minWidth:"300px"},children:e.jsx(u,{children:e.jsxs(i,{gap:"300",children:[e.jsx(n,{variant:"headingMd",children:"Token Balance"}),e.jsxs(n,{variant:"bodyLg",fontWeight:"semibold",children:[((V=f==null?void 0:f.balance)==null?void 0:V.toLocaleString())||0," tokens"]}),((s==null?void 0:s.plan)==="growth_extra"||(s==null?void 0:s.plan)==="enterprise")&&e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[(s==null?void 0:s.plan)==="growth_extra"?"100M":"300M"," included monthly"]}),e.jsx(c,{variant:"primary",onClick:()=>p("/billing"),children:"Manage Tokens"})]})})})]})}),e.jsx(g.Section,{children:e.jsx(u,{children:e.jsxs(i,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Quick Actions"}),e.jsxs(d,{gap:"300",wrap:!0,children:[e.jsx(c,{onClick:()=>p("/ai-seo/products"),children:"Optimize Products"}),W&&e.jsx(c,{onClick:()=>p("/ai-seo/collections"),children:"Optimize Collections"}),!A&&e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:()=>p("/ai-seo/sitemap"),children:ee?"Regenerate Sitemap":"View Sitemap"}),Z&&e.jsx(c,{onClick:()=>p("/ai-seo/schema-data"),children:"Regenerate Schemas"})]}),X&&e.jsx(c,{onClick:()=>p("/ai-seo/store-metadata"),children:"Store Info"})]})]})})}),e.jsx(g.Section,{children:e.jsx(u,{children:e.jsxs(i,{gap:"300",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(n,{variant:"headingMd",children:"Current Plan"}),e.jsx(r,{paddingBlockStart:"100",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["$",(s==null?void 0:s.price)||0,"/month"]})})]}),e.jsx(O,{tone:"info",size:"large",children:((_=s==null?void 0:s.plan)==null?void 0:_.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsx(c,{onClick:()=>p("/billing"),children:"View Plans & Billing"})]})})}),e.jsx(g.Section,{children:e.jsx(u,{children:e.jsxs(i,{gap:"300",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{variant:"headingMd",children:"Getting Started"}),e.jsxs(c,{onClick:()=>H(!S),disclosure:S?"up":"down",children:[S?"Hide":"Show"," Guide"]})]}),e.jsx(se,{open:S,id:"onboarding-collapsible",transition:{duration:"200ms",timingFunction:"ease-in-out"},children:e.jsx(r,{paddingBlockStart:"300",children:e.jsxs(i,{gap:"400",children:[e.jsx(y,{}),e.jsxs(i,{gap:"300",children:[e.jsx(n,{variant:"headingMd",as:"h3",children:"Quick Start Guide"}),e.jsxs(i,{gap:"200",children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"1. Sync Your Store"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:'Click "Sync Now" to fetch your products, collections, and languages from Shopify. This is required before you can start optimizing.'}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"2. Choose a Plan"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Visit Plans & Billing to select the plan that fits your store size. Each plan includes different limits for products, languages, and features."}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"3. Optimize Your Products"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:'Go to "Search Optimization for AI" → Products tab. Select products and click "AI Enhance" to generate SEO-optimized titles, descriptions, and metadata.'}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"4. Generate AI Sitemap"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Navigate to Sitemap tab and generate your AI-optimized sitemap. This helps AI search engines discover and index your products."}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"5. Monitor & Improve"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Return to Dashboard regularly to track optimization progress and token usage. Enable auto-sync to keep your data fresh."})]})]}),e.jsx(y,{}),e.jsxs(i,{gap:"200",children:[e.jsx(n,{variant:"headingMd",as:"h3",children:"Video Tutorial"}),e.jsx(r,{padding:"400",background:"bg-surface-secondary",borderRadius:"200",children:e.jsxs(i,{gap:"200",inlineAlign:"center",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",alignment:"center",children:"Video tutorial coming soon"}),e.jsx(n,{variant:"bodySm",tone:"subdued",alignment:"center",children:"[Embedded video will be added here]"})]})})]}),e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(d,{gap:"200",children:[e.jsx(c,{variant:"primary",onClick:()=>p("/ai-seo/products"),children:"Start Optimizing"}),e.jsx(c,{onClick:()=>p("/billing"),children:"View Plans"})]})})]})})})]})})})]})}export{le as default};
