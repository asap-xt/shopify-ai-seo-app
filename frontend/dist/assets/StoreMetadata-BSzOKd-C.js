import{r as e,j as a}from"./react-vendor-BXVC7v0l.js";import{m as n}from"./sessionFetch-BRcq_jFV.js";import{C as i,B as t,T as o,d as s,L as l,b as r,r as d,h,D as c,g as u,I as p,l as m}from"./polaris-CyaoFo5Q.js";import"./app-bridge-DUY42B6P.js";import"./vendor-Cs_VgJ2r.js";import"./index-Bmo9wlzQ.js";function g({shop:g}){var v,S,f,x,j,y,M,b;const C=g||((e,a="")=>{try{return new URLSearchParams(window.location.search).get(e)||a}catch{return a}})("shop",""),[z,D]=e.useState(!1),[w,N]=e.useState(!1),[P,k]=e.useState(""),[T,I]=e.useState(null),R=e.useMemo(()=>n({}),[]),[L,O]=e.useState(!1),[U,A]=e.useState(!1),[$,_]=e.useState({storeName:"",homePageTitle:"",metaDescription:""}),[E,B]=e.useState(!1),[W,F]=e.useState({seo:{storeName:"",shortDescription:"",fullDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:"",supportedCurrencies:"",shippingRegions:"",culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""}});async function J(){var e,a,n,i,t,o,s,l,r,d,h,c,u,p,m,g,v,S,f,x,j,y,M,b,z,w,N,P,T,L,O,U,A,$,E,W,J,q,G,V,X;D(!0);try{const D=`/api/store/generate?shop=${encodeURIComponent(C)}`,k=await R(D,{headers:{"X-Shop":C}});I(k),_({storeName:(null==(e=k.shopifyDefaults)?void 0:e.storeName)||"",homePageTitle:(null==(a=k.shopifyDefaults)?void 0:a.homePageTitle)||"",metaDescription:(null==(n=k.shopifyDefaults)?void 0:n.metaDescription)||""});const K=k.existingMetadata||{},H=(null==(t=null==(i=K.seo_metadata)?void 0:i.value)?void 0:t.storeName)||"",Y=(null==(s=null==(o=K.seo_metadata)?void 0:o.value)?void 0:s.shortDescription)||"",Q=(null==(r=null==(l=K.seo_metadata)?void 0:l.value)?void 0:r.fullDescription)||"",Z=H||(null==(d=k.shopifyDefaults)?void 0:d.storeName)||"",ee=Y||(null==(h=k.shopifyDefaults)?void 0:h.homePageTitle)||"",ae=Q||(null==(c=k.shopifyDefaults)?void 0:c.metaDescription)||"",ne=H&&H!==(null==(u=k.shopifyDefaults)?void 0:u.storeName),ie=Y&&Y!==(null==(p=k.shopifyDefaults)?void 0:p.homePageTitle),te=Q&&Q!==(null==(m=k.shopifyDefaults)?void 0:m.metaDescription);B(ne||ie||te);const oe={seo:{storeName:Z,shortDescription:ee,fullDescription:ae,keywords:Array.isArray(null==(v=null==(g=K.seo_metadata)?void 0:g.value)?void 0:v.keywords)?K.seo_metadata.value.keywords.join(", "):(null==(f=null==(S=K.seo_metadata)?void 0:S.value)?void 0:f.keywords)||""},aiMetadata:{...(null==(x=K.ai_metadata)?void 0:x.value)||{},languages:(null==(M=null==(y=null==(j=K.ai_metadata)?void 0:j.value)?void 0:y.languages)?void 0:M.length)>0?K.ai_metadata.value.languages.join(", "):((null==(b=k.shopInfo)?void 0:b.locales)||[]).filter(e=>e.published).map(e=>e.locale).join(", "),supportedCurrencies:(null==(N=null==(w=null==(z=K.ai_metadata)?void 0:z.value)?void 0:w.supportedCurrencies)?void 0:N.length)>0?K.ai_metadata.value.supportedCurrencies.join(", "):((null==(P=k.shopInfo)?void 0:P.currencies)||["EUR"]).join(", "),shippingRegions:(null==(O=null==(L=null==(T=K.ai_metadata)?void 0:T.value)?void 0:L.shippingRegions)?void 0:O.length)>0?K.ai_metadata.value.shippingRegions.join(", "):((null==(U=k.shopInfo)?void 0:U.markets)||[]).map(e=>e.name).join(", ")},organizationSchema:{...(null==(A=K.organization_schema)?void 0:A.value)||{},enabled:!0===(null==(E=null==($=K.organization_schema)?void 0:$.value)?void 0:E.enabled),name:(null==(J=null==(W=K.organization_schema)?void 0:W.value)?void 0:J.name)||(null==(q=k.shopInfo)?void 0:q.name)||"",email:(null==(V=null==(G=K.organization_schema)?void 0:G.value)?void 0:V.email)||(null==(X=k.shopInfo)?void 0:X.email)||""}};F(oe)}catch(K){k(`Load failed: ${(null==K?void 0:K.message)||"Unknown error"}`)}finally{D(!1)}}async function q(){N(!0);try{const e={...W,aiMetadata:{...W.aiMetadata,languages:"string"==typeof W.aiMetadata.languages?W.aiMetadata.languages.split(",").map(e=>e.trim()).filter(e=>e):W.aiMetadata.languages,supportedCurrencies:"string"==typeof W.aiMetadata.supportedCurrencies?W.aiMetadata.supportedCurrencies.split(",").map(e=>e.trim()).filter(e=>e):W.aiMetadata.supportedCurrencies,shippingRegions:"string"==typeof W.aiMetadata.shippingRegions?W.aiMetadata.shippingRegions.split(",").map(e=>e.trim()).filter(e=>e):W.aiMetadata.shippingRegions}},a=`/api/store/apply?shop=${encodeURIComponent(C)}`;await R(a,{method:"POST",headers:{"X-Shop":C},body:{metadata:e,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:W.organizationSchema.enabled}}});k("Metadata saved successfully!"),await J()}catch(e){k(`Save failed: ${(null==e?void 0:e.message)||"Unknown error"}`)}finally{N(!1)}}return e.useEffect(()=>{C&&J()},[C,R]),z&&!T?a.jsx(i,{children:a.jsx(t,{padding:"400",children:a.jsx(o,{children:"Loading store data..."})})}):"Starter"===(null==T?void 0:T.plan)?a.jsx(s,{status:"warning",children:a.jsx(o,{children:"Store metadata features are available starting from the Professional plan."})}):a.jsxs(l,{children:[a.jsx(l.Section,{children:a.jsx(i,{title:"Basic Store Information",children:a.jsxs(t,{padding:"400",children:[a.jsx(s,{tone:"info",children:a.jsxs(t,{children:[a.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"From Shopify Settings:"}),a.jsxs(t,{paddingBlockStart:"200",children:[a.jsxs(o,{variant:"bodySm",tone:"subdued",children:["Store name: ",a.jsx(o,{as:"span",fontWeight:"medium",children:$.storeName||"Not set"})]}),a.jsxs(o,{variant:"bodySm",tone:"subdued",children:["Home page title: ",a.jsx(o,{as:"span",fontWeight:"medium",children:$.homePageTitle||"Not set"})]}),a.jsxs(o,{variant:"bodySm",tone:"subdued",children:["Meta description: ",a.jsx(o,{as:"span",fontWeight:"medium",children:$.metaDescription?$.metaDescription.substring(0,100)+($.metaDescription.length>100?"...":""):"Not set"})]}),a.jsxs(o,{variant:"bodySm",tone:"subdued",children:["Languages: ",a.jsx(o,{as:"span",fontWeight:"medium",children:(null==(S=null==(v=null==T?void 0:T.shopInfo)?void 0:v.locales)?void 0:S.filter(e=>e.published).map(e=>e.locale).join(", "))||"Not set"})]}),a.jsxs(o,{variant:"bodySm",tone:"subdued",children:["Currencies: ",a.jsx(o,{as:"span",fontWeight:"medium",children:(null==(x=null==(f=null==T?void 0:T.shopInfo)?void 0:f.currencies)?void 0:x.join(", "))||"EUR"})]}),a.jsxs(o,{variant:"bodySm",tone:"subdued",children:["Markets: ",a.jsx(o,{as:"span",fontWeight:"medium",children:(null==(y=null==(j=null==T?void 0:T.shopInfo)?void 0:j.markets)?void 0:y.map(e=>e.name).join(", "))||"Not set"})]}),(null==(M=null==T?void 0:T.shopInfo)?void 0:M.name)&&a.jsxs(o,{variant:"bodySm",tone:"subdued",children:["Organization: ",a.jsx(o,{as:"span",fontWeight:"medium",children:T.shopInfo.name}),T.shopInfo.email&&a.jsxs(a.Fragment,{children:[" (",T.shopInfo.email,")"]})]})]}),E&&a.jsx(t,{paddingBlockStart:"300",children:a.jsx(r,{size:"slim",onClick:function(){F(e=>({...e,seo:{...e.seo,storeName:"",shortDescription:"",fullDescription:""}})),B(!1),k("Synced with Shopify store settings")},children:"Sync from Shopify"})})]})}),a.jsx(t,{paddingBlockStart:"400",children:a.jsxs(d,{children:[a.jsx(h,{label:"Store Name",value:W.seo.storeName,onChange:e=>F(a=>({...a,seo:{...a.seo,storeName:e}})),helpText:"Loaded from Shopify. Edit if needed.",maxLength:100}),a.jsx(h,{label:"Short Store Description",value:W.seo.shortDescription,onChange:e=>F(a=>({...a,seo:{...a.seo,shortDescription:e}})),helpText:"Loaded from Shopify. Edit if needed - max 100 characters",maxLength:100}),a.jsx(h,{label:"Full Store Description",value:W.seo.fullDescription,onChange:e=>F(a=>({...a,seo:{...a.seo,fullDescription:e}})),helpText:"Loaded from Shopify. Edit if needed - max 300 characters",maxLength:300,multiline:3}),a.jsx(h,{label:"Keywords",value:W.seo.keywords,onChange:e=>F(a=>({...a,seo:{...a.seo,keywords:e}})),helpText:"Comma-separated keywords (optional)"})]})})]})})}),a.jsx(l.Section,{children:a.jsx(i,{title:"AI Metadata",children:a.jsx(t,{padding:"400",children:a.jsxs(d,{children:[a.jsxs(d.Group,{children:[a.jsx(h,{label:"Business Type",value:W.aiMetadata.businessType,onChange:e=>F(a=>({...a,aiMetadata:{...a.aiMetadata,businessType:e}})),placeholder:"e.g., Fashion Retailer, Electronics Store",helpText:"Max 3 words"}),a.jsx(h,{label:"Target Audience",value:W.aiMetadata.targetAudience,onChange:e=>F(a=>({...a,aiMetadata:{...a.aiMetadata,targetAudience:e}})),placeholder:"e.g., Young professionals, Parents"})]}),a.jsx(h,{label:"Unique Selling Points",value:W.aiMetadata.uniqueSellingPoints,onChange:e=>F(a=>({...a,aiMetadata:{...a.aiMetadata,uniqueSellingPoints:e}})),helpText:"Comma-separated list",multiline:2}),a.jsx(h,{label:"Brand Voice",value:W.aiMetadata.brandVoice,onChange:e=>F(a=>({...a,aiMetadata:{...a.aiMetadata,brandVoice:e}})),placeholder:"e.g., Professional, Friendly, Casual"}),a.jsx(h,{label:"Primary Categories",value:W.aiMetadata.primaryCategories,onChange:e=>F(a=>({...a,aiMetadata:{...a.aiMetadata,primaryCategories:e}})),helpText:"Main product categories, comma-separated"}),a.jsx(h,{label:"Shipping Information",value:W.aiMetadata.shippingInfo,onChange:e=>F(a=>({...a,aiMetadata:{...a.aiMetadata,shippingInfo:e}})),helpText:"Shipping costs, delivery times, free shipping thresholds (e.g., Free shipping over $50, 2-3 business days)",multiline:2}),a.jsx(h,{label:"Return Policy",value:W.aiMetadata.returnPolicy,onChange:e=>F(a=>({...a,aiMetadata:{...a.aiMetadata,returnPolicy:e}})),multiline:2}),a.jsx(c,{}),a.jsx(o,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),a.jsx(o,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),a.jsx(h,{label:"Supported Languages",value:W.aiMetadata.languages||"",onChange:e=>{F(a=>({...a,aiMetadata:{...a.aiMetadata,languages:e}}))},helpText:"Comma-separated language codes (e.g., en, de, es, fr)",multiline:2}),a.jsx(h,{label:"Supported Currencies",value:W.aiMetadata.supportedCurrencies||"",onChange:e=>{F(a=>({...a,aiMetadata:{...a.aiMetadata,supportedCurrencies:e}}))},helpText:"Comma-separated currency codes (e.g., EUR, USD, GBP)"}),a.jsx(h,{label:"Shipping Regions",value:W.aiMetadata.shippingRegions||"",onChange:e=>{F(a=>({...a,aiMetadata:{...a.aiMetadata,shippingRegions:e}}))},helpText:"Comma-separated regions (e.g., EU, USA, UK, Canada)",multiline:2}),a.jsx(h,{label:"Cultural Considerations",value:W.aiMetadata.culturalConsiderations||"",onChange:e=>F(a=>({...a,aiMetadata:{...a.aiMetadata,culturalConsiderations:e}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),(null==(b=null==T?void 0:T.features)?void 0:b.organizationSchema)?a.jsx(l.Section,{children:a.jsx(i,{title:"Organization Schema",children:a.jsxs(t,{padding:"400",children:[a.jsx(u,{label:"Enable Organization Schema",checked:W.organizationSchema.enabled,onChange:e=>F(a=>({...a,organizationSchema:{...a.organizationSchema,enabled:e}}))}),W.organizationSchema.enabled&&a.jsx(t,{paddingBlockStart:"400",children:a.jsxs(d,{children:[a.jsxs(d.Group,{children:[a.jsx(h,{label:"Organization Name",value:W.organizationSchema.name,onChange:e=>F(a=>({...a,organizationSchema:{...a.organizationSchema,name:e}}))}),a.jsx(h,{label:"Contact Email",value:W.organizationSchema.email,onChange:e=>F(a=>({...a,organizationSchema:{...a.organizationSchema,email:e}})),type:"email"})]}),a.jsx(h,{label:"Phone",value:W.organizationSchema.phone,onChange:e=>F(a=>({...a,organizationSchema:{...a.organizationSchema,phone:e}})),type:"tel"}),a.jsx(h,{label:"Logo URL",value:W.organizationSchema.logo,onChange:e=>F(a=>({...a,organizationSchema:{...a.organizationSchema,logo:e}})),type:"url"}),a.jsx(h,{label:"Social Media Links",value:W.organizationSchema.sameAs,onChange:e=>F(a=>({...a,organizationSchema:{...a.organizationSchema,sameAs:e}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}):a.jsx(l.Section,{children:a.jsx(i,{title:"Organization Schema",children:a.jsx(t,{padding:"400",children:a.jsx(s,{tone:"info",children:a.jsxs(t,{children:[a.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Upgrade to Professional+ to enable Organization Schema"}),a.jsx(o,{variant:"bodySm",tone:"subdued",children:"Organization Schema helps AI bots understand your business structure, contact information, and social media presence."}),a.jsx(t,{paddingBlockStart:"300",children:a.jsx(r,{primary:!0,onClick:()=>{const e=new URLSearchParams(window.location.search),a=e.toString()?`?${e.toString()}`:"";window.location.href=`/billing${a}`},children:"Upgrade Plan"})})]})})})})}),a.jsx(l.Section,{children:a.jsx(i,{children:a.jsx(t,{padding:"400",children:a.jsxs(p,{gap:"300",children:[a.jsx(r,{onClick:q,loading:w,primary:!0,children:"Save Metadata"}),a.jsx(r,{onClick:async function(){var e;O(!0);try{await q();const a="\n        query GetStoreMetadata($shop: String!) {\n          storeMetadata(shop: $shop) {\n            shopName\n            description\n            shortDescription\n            seoMetadata\n            aiMetadata\n            organizationSchema\n          }\n        }\n      ",n=await R("/graphql",{method:"POST",headers:{"X-Shop":C},body:{query:a,variables:{shop:C}}});if(n.error)throw new Error(n.error);const i=null==(e=n.data)?void 0:e.storeMetadata;if(!i)throw new Error("No preview data available");{const e=window.open("","_blank"),a={shopName:i.shopName,shortDescription:i.shortDescription,description:i.description,seoMetadata:i.seoMetadata?(()=>{try{return JSON.parse(i.seoMetadata)}catch(e){return i.seoMetadata}})():null,aiMetadata:i.aiMetadata?(()=>{try{return JSON.parse(i.aiMetadata)}catch(e){return i.aiMetadata}})():null,organizationSchema:i.organizationSchema?(()=>{try{return JSON.parse(i.organizationSchema)}catch(e){return i.organizationSchema}})():null};e.document.write(`\n          <html>\n            <head>\n              <title>Store Metadata Preview</title>\n              <style>\n                body { font-family: Arial, sans-serif; margin: 20px; }\n                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }\n                h1 { color: #333; }\n                .section { margin: 20px 0; }\n                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }\n              </style>\n            </head>\n            <body>\n              <h1>Store Metadata Preview</h1>\n              <div class="section">\n                <h2>Basic Info</h2>\n                <p><strong>Shop Name:</strong> ${a.shopName||"Not set"}</p>\n                <p><strong>Short Description:</strong> ${i.shortDescription||"Not set"}</p>\n                <p><strong>Full Description:</strong> ${a.description||"Not set"}</p>\n              </div>\n              \n              <div class="section">\n                <h2>SEO Metadata</h2>\n                <pre>${JSON.stringify(a.seoMetadata,null,2)}</pre>\n              </div>\n              \n              <div class="section">\n                <h2>AI Metadata</h2>\n                <pre>${JSON.stringify(a.aiMetadata,null,2)}</pre>\n              </div>\n              \n              <div class="section">\n                <h2>Organization Schema</h2>\n                <pre>${JSON.stringify(a.organizationSchema,null,2)}</pre>\n              </div>\n              \n              \x3c!-- Local Business Schema - DISABLED --\x3e\n              \x3c!-- <div class="section">\n                <h2>Local Business Schema</h2>\n                <pre>${JSON.stringify(a.localBusinessSchema,null,2)}</pre>\n              </div> --\x3e\n              \n              <div class="section">\n                <h2>Raw Data</h2>\n                <pre>${JSON.stringify(a,null,2)}</pre>\n              </div>\n            </body>\n          </html>\n        `),e.document.close()}}catch(a){k(`Preview failed: ${(null==a?void 0:a.message)||"Unknown error"}`)}finally{O(!1)}},loading:L,children:"Preview Metadata"}),!1]})})})}),P&&a.jsx(m,{content:P,onDismiss:()=>k("")})]})}export{g as default};
