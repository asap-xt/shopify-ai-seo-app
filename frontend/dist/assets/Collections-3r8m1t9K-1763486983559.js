import{j as e}from"./app-bridge-C1hn5a03-1763486983559.js";import{r as n}from"./react-vendor-tAaa2TlE-1763486983559.js";import{m as kt}from"./sessionFetch-CaTDI4e_-1763486983559.js";import{S as It,U as Et}from"./StoreMetadataBanner-BrP8mF5J-1763486983559.js";import{I as Tt}from"./InsufficientTokensModal-BHKltrbO-1763486983559.js";import{T as Dt}from"./TrialActivationModal-BcJNOlSH-1763486983559.js";import{M as S,a as M,T as r,e as me,d as zt,b as O,B as c,I as w,g as _e,D as $t,f as V,C as He,h as Rt,S as Ut,i as Ke,j as Ge,R as Bt,k as Wt,m as Nt,E as qt}from"./polaris-B-MgUW3u-1763486983559.js";import"./index-eGuQmzpK-1763486983559.js";const Ft=(ae,j="")=>{try{return new URLSearchParams(window.location.search).get(ae)||j}catch{return j}};function js({shop:ae,globalPlan:j}){var Ne,qe,Fe;const d=ae||Ft("shop",""),b=n.useMemo(()=>kt(),[]),[f,Se]=n.useState([]),[xe,je]=n.useState(!1),[_,Je]=n.useState(0),[g,H]=n.useState([]),[C,X]=n.useState(!1),[_t,Ht]=n.useState(""),[z,le]=n.useState(""),[P,ee]=n.useState("all"),[Kt,Gt]=n.useState(""),[Jt,Qt]=n.useState([]),[Yt,Zt]=n.useState([]),[ye,re]=n.useState(!1),[Vt,Xt]=n.useState(!1),[es,ts]=n.useState(!1),[we,ie]=n.useState(!1),[k,Qe]=n.useState("updatedAt"),[I,Ye]=n.useState("desc"),[Ze,Ve]=n.useState(""),[ss,Xe]=n.useState([]),[v,B]=n.useState([]),[A,be]=n.useState([]),[ce,K]=n.useState(!1),[E,$]=n.useState({current:0,total:0,percent:0}),[Ce,G]=n.useState(""),[J,ve]=n.useState([]),[ns,os]=n.useState(!1),[as,ls]=n.useState(null),[rs,is]=n.useState(!1),[cs,et]=n.useState(""),[tt,te]=n.useState(!1),[W,N]=n.useState([]),[Ae,Le]=n.useState(!1),[st,Q]=n.useState(!1),[Me,Oe]=n.useState(!1),[nt,se]=n.useState(!1),[Pe,ne]=n.useState([]),[R,de]=n.useState({}),[ot,ue]=n.useState(!1),[at,he]=n.useState(!1),[ke,ds]=n.useState({}),[lt,ge]=n.useState(!1),[Ie,pe]=n.useState(null),[rt,Ee]=n.useState(!1),[Te,m]=n.useState(""),[De,ze]=n.useState(!1),[it,Y]=n.useState(!1),[ct,$e]=n.useState(!1),[dt,Re]=n.useState(!1),[p,q]=n.useState(null),[L,Z]=n.useState("starter"),[T,fe]=n.useState(1),[Ue,Be]=n.useState(!1);n.useEffect(()=>{if(!(!j||typeof j!="object")&&!Ue&&L==="starter"){if(j.planKey&&j.planKey!==""){Z(j.planKey);const t=j.language_limit||1;fe(t)}else if(j.plan&&j.plan!==""){const t=j.plan.toLowerCase().replace(/\s+/g,"-");Z(t);const s=j.language_limit||1;fe(s)}}},[j,L,Ue]);const[y,U]=n.useState({processing:!1,current:0,total:0,currentItem:"",results:null});n.useEffect(()=>{if(!d)return;b("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          language_limit
          product_limit
        }
      }
    `,variables:{shop:d}})}).then(s=>{var l,u,x;if((l=s==null?void 0:s.errors)!=null&&l.length)throw new Error(((u=s.errors[0])==null?void 0:u.message)||"GraphQL error");const o=(x=s==null?void 0:s.data)==null?void 0:x.plansMe,a=(o==null?void 0:o.modelsSuggested)||["google/gemini-1.5-flash"];Xe(a.map(F=>({label:F,value:F}))),Ve(a[0]),Z((o==null?void 0:o.planKey)||"starter");const i=(o==null?void 0:o.language_limit)||1;fe(i),Be(!0)}).catch(s=>{console.error("[COLLECTIONS] GraphQL plansMe failed:",s),m(`Error loading models: ${s.message}`),Be(!0)})},[d,b]),n.useEffect(()=>{d&&b(`/api/languages/shop/${d}?shop=${d}`).then(t=>{const s=(t==null?void 0:t.shopLanguages)||["en"];be(s),B([])}).catch(t=>{console.error("[COLLECTIONS] Languages API error:",t),be(["en"]),B([])})},[d,b]);const ut=async()=>{try{Oe(!0);const t=await b(`/api/collections/sync?shop=${d}`,{method:"POST"});t!=null&&t.success?(m("Collections synced successfully!"),await D()):(console.error("[COLLECTIONS] Sync failed:",t),m("Failed to sync collections"))}catch(t){console.error("[COLLECTIONS] Sync error:",t),m("Error syncing collections")}finally{Oe(!1)}},D=n.useCallback(async()=>{je(!0);try{const s=`/collections/list-graphql?${new URLSearchParams({shop:d,...z&&{search:z},...P!=="all"&&{optimized:P},sortBy:k,sortOrder:I})}`;let a=(await b(s)).collections||[];if(z){const i=z.toLowerCase();a=a.filter(l=>l.title.toLowerCase().includes(i)||l.handle.toLowerCase().includes(i))}P!=="all"&&(a=a.filter(i=>P==="true"?i.hasSeoData:!i.hasSeoData)),Se(a),Je(a.length)}catch(t){m(`Error loading collections: ${t.message}`)}finally{je(!1)}},[d,z,P,k,I,b]);n.useEffect(()=>{d&&(D(),Q(!1))},[d,P,k,I,D]),n.useEffect(()=>{const t=setTimeout(()=>{d&&D()},500);return()=>clearTimeout(t)},[z]);const ht=n.useCallback(t=>{H(t);const s=t.some(o=>{const a=f.find(i=>i.id===o);return a==null?void 0:a.hasSeoData});Q(s),t.length===0&&X(!1)},[f]),gt=n.useCallback(t=>{if(X(t),t){H(f.map(o=>o.id));const s=f.some(o=>o.hasSeoData);Q(s)}else H([]),Q(!1)},[f]),pt=async t=>{Ee(!0);try{const s=`/collections/${t.split("/").pop()}/seo-data?shop=${encodeURIComponent(d)}`,o=await b(s);pe(o),ge(!0)}catch(s){m((s==null?void 0:s.status)===404?"No SEO data found for this collection":"Failed to load SEO data")}finally{Ee(!1)}},We=n.useMemo(()=>{var s;if(C)return v.length>T;const t=f.filter(o=>g.includes(o.id));if(t.length===0)return v.length>T;for(const o of t){const a=((s=o.optimizationSummary)==null?void 0:s.optimizedLanguages)||[],i=v.filter(u=>!a.includes(u));if(a.length+i.length>T)return!0}return!1},[f,g,C,T,v]),ft=()=>{if(g.length===0&&!C){m("Please select collections first");return}he(!0)},mt=async()=>{const s=f.filter(a=>g.includes(a.id)).filter(a=>{var i;return((i=a.optimizedLanguages)==null?void 0:i.length)>0});if(s.length===0){m("Please select collections with Basic SEO optimization");return}ze(!0),U({processing:!0,current:0,total:s.length,currentItem:"",results:null});const o={successful:0,failed:0,skipped:0};for(let a=0;a<s.length;a++){const i=s[a];U(l=>({...l,current:a,currentItem:i.title}));try{const l=i.optimizedLanguages||[];if(l.length===0){o.skipped++;continue}const u=await b(`/ai-enhance/collection/${encodeURIComponent(i.id)}`,{method:"POST",shop:d,body:{shop:d,languages:l}});u&&u.ok?o.successful++:o.failed++}catch(l){if(l.status===403){U({processing:!1,current:0,total:0,currentItem:"",results:null}),q(l),Z(l.currentPlan||L||"starter"),Y(!0);return}if(l.status===402||l.requiresPurchase||l.trialRestriction){U({processing:!1,current:0,total:0,currentItem:"",results:null}),q(l),Z(l.currentPlan||L||"starter"),l.trialRestriction&&l.requiresActivation?Re(!0):l.trialRestriction?Y(!0):$e(!0);return}o.failed++}U(l=>({...l,current:a+1}))}U(a=>({...a,processing:!1,results:o})),m(`AI enhancement complete! ${o.successful} collections enhanced.`)},St=()=>{f.filter(o=>g.includes(o.id)).filter(o=>{var a;return((a=o.optimizedLanguages)==null?void 0:a.length)>0});const s=()=>{const o=y.results;ze(!1),U({processing:!1,current:0,total:0,currentItem:"",results:null}),o&&o.successful>0&&setTimeout(()=>{Se([]),D()},1500)};return y.processing?e.jsx(S,{open:De,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(S.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",y.currentItem]}),e.jsx(me,{progress:y.current/y.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[y.current," of ",y.total," collections (",Math.round(y.current/y.total*100),"%)"]})]})})}):y.results!==null?e.jsx(S,{open:De,title:"AI Enhancement Results",onClose:s,primaryAction:{content:"Done",onAction:s},children:e.jsx(S.Section,{children:e.jsx(M,{gap:"300",children:e.jsxs(w,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:y.results.successful})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:y.results.failed})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:y.results.skipped})]})]})})})}):null},xt=async()=>{var t;if(!v.length){m("Please select at least one language");return}he(!1),K(!0),$({current:0,total:0,percent:0}),ve([]),de({});try{const s=C?f:f.filter(l=>g.includes(l.id)),o=s.length;$({current:0,total:o,percent:0});const a={};for(let l=0;l<s.length;l++){const u=s[l];G(u.title);try{const h=await b("/seo/generate-collection-multi",{method:"POST",shop:d,body:JSON.stringify({shop:d,collectionId:u.id,model:Ze,languages:v})});a[u.id]={success:!0,data:h}}catch(h){if(h.status===403||(t=h.message)!=null&&t.includes("requires Professional plan")){K(!1),G(""),q({error:h.message||"Collections SEO requires Professional plan or higher",currentPlan:h.currentPlan||L||"starter",upgradeMessage:h.upgradeMessage||"Upgrade to Professional plan to optimize collections for AI search"}),Y(!0);return}a[u.id]={success:!1,error:h.message},ve(oe=>[...oe,{collection:u.title,error:h.message}])}const x=l+1,F=Math.round(x/o*100);$({current:x,total:o,percent:F})}de(a),ue(!0);const i=Object.values(a).filter(l=>l.success).length;m(`Generated optimization for ${i} collections`)}catch(s){m(`Error: ${s.message}`)}finally{K(!1),G("")}},jt=async()=>{var t;K(!0),$({current:0,total:0,percent:0});try{const s=Object.entries(R).filter(([a,i])=>i.success),o=s.length;$({current:0,total:o,percent:0});for(let a=0;a<s.length;a++){const[i,l]=s[a],u=f.find(h=>h.id===i);if(!u)continue;G(u.title);try{if(!((t=l.data)!=null&&t.results)||!Array.isArray(l.data.results))throw new Error("Invalid results structure");const h=await b("/seo/apply-collection-multi",{method:"POST",shop:d,body:{shop:d,collectionId:i,results:l.data.results.map(oe=>({language:oe.language,seo:oe.data})),options:{updateTitle:!0,updateDescription:!0,updateSeo:!0,updateMetafields:!0}}});if(!(h!=null&&h.ok))throw new Error((h==null?void 0:h.error)||"Apply failed")}catch(h){console.error("Apply error for collection:",i,h),J.push({id:u.id,title:u.title,message:h.message})}const x=a+1,F=Math.round(x/o*100);$({current:x,total:o,percent:F})}m("Optimization applied successfully!"),ue(!1),de({}),H([]),await D(),X(!1)}catch(s){m(`Error applying optimization: ${s.message}`)}finally{K(!1),G("")}},yt=async(t=[])=>{Le(!0),et("");try{const s=C?f:f.filter(l=>g.includes(l.id)),o=s.length*t.length;let a=0;const i=[];for(const l of s)for(const u of t)try{const x=await b("/collections/delete-seo",{method:"DELETE",shop:d,body:{shop:d,collectionId:l.id,language:u}})}catch(x){console.error(`[DELETE-SEO-BULK] Failed to delete ${u} for ${l.title}:`,x),i.push({id:l.id,title:l.title,message:x.message})}finally{a++,$({current:a,total:o,percent:Math.round(a/o*100)})}m(`Deleted optimization for ${t.join(", ").toUpperCase()}`),setTimeout(async()=>{await D(),H([]),X(!1),Q(!1)},100)}catch(s){console.error("[DELETE-SEO-BULK] Error:",s),m(`Delete error: ${s.message}`)}finally{Le(!1),ne([]),N([])}},wt=t=>{var l,u;const s=((l=R[t.id])==null?void 0:l.success)||ke[t.id],o=((u=R[t.id])==null?void 0:u.data)||ke[t.id],a=t.optimizedLanguages||[],i=e.jsx(c,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Nt,{id:t.id,media:i,accessibilityLabel:`View details for ${t.title}`,children:e.jsxs(w,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(c,{style:{flex:"1 1 30%",minWidth:"200px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:t.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Handle: ",t.handle]})]}),e.jsx(c,{style:{flex:"0 0 15%",minWidth:"100px",textAlign:"center"},children:e.jsxs(r,{variant:"bodyMd",children:[t.productsCount," products"]})}),e.jsx(c,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(w,{gap:"100",wrap:!0,children:t.hasSeoData?e.jsxs(e.Fragment,{children:[A.map(x=>e.jsx(V,{tone:a.includes(x)?"success":"subdued",size:"small",children:x.toUpperCase()},x)),t.aiEnhanced&&e.jsx(V,{tone:"info",size:"small",children:"AIâœ¨"})]}):e.jsx(V,{tone:"subdued",children:"No AI Search Optimisation"})})}),e.jsxs(c,{style:{flex:"0 0 15%",minWidth:"120px"},children:[s&&e.jsx(O,{size:"slim",onClick:()=>{pe(o),ge(!0)},children:"Preview JSON"}),!s&&t.hasSeoData&&e.jsx(O,{size:"slim",loading:rt,onClick:()=>pt(t.id),children:"Preview JSON"})]})]})})},bt=ce&&!y.processing&&e.jsx(S,{open:ce,title:"Processing Collections",onClose:()=>{},noScroll:!0,children:e.jsx(S.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:Ce?`Processing: ${Ce}`:"Preparing..."}),e.jsx(me,{progress:E.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[E.current," of ",E.total," collections (",E.percent,"%)"]})]})})}),Ct=e.jsx(S,{open:at,title:"Select Languages",primaryAction:{content:"Generate Optimization for AI Search",onAction:xt,disabled:v.length===0||We},secondaryActions:[{content:"Cancel",onAction:()=>he(!1)}],children:e.jsx(S.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",C?"all":g.length," selected collections:"]}),We&&e.jsx(zt,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(M,{gap:"200",children:[e.jsxs(r,{variant:"bodyMd",children:["Your ",L," plan supports up to ",T," language",T>1?"s":""," per collection.",g.length===1&&((Fe=(qe=(Ne=f.find(t=>t.id===g[0]))==null?void 0:Ne.optimizationSummary)==null?void 0:qe.optimizedLanguages)==null?void 0:Fe.length)>0&&e.jsxs(e.Fragment,{children:[" This collection already has ",f.find(t=>t.id===g[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(r,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(O,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),s=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${s}`},children:"Upgrade Plan"})]})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(w,{gap:"200",wrap:!0,children:A.map(t=>e.jsx(_e,{label:t.toUpperCase(),checked:v.includes(t),onChange:s=>{B(s?[...v,t]:v.filter(o=>o!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(O,{plain:!0,onClick:()=>{v.length===A.length?B([]):A.length>T?(B([...A]),m(`You selected ${A.length} languages. Your ${L} plan supports ${T}. Please deselect or upgrade.`)):B([...A])},children:v.length===A.length?"Deselect all":"Select all"})})]})})}),vt=e.jsx(S,{open:ot&&!ce,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:jt,disabled:!Object.values(R).some(t=>t.success)},secondaryActions:[{content:"Cancel",onAction:()=>ue(!1)}],children:e.jsx(S.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(w,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(R).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(R).filter(t=>t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(R).filter(t=>!t.success&&!t.skipped).length})]})]}),J.length>0&&e.jsxs(e.Fragment,{children:[e.jsx($t,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(c,{maxHeight:"200px",overflowY:"scroll",children:[J.slice(0,10).map((t,s)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.collection,": ",t.error]},s)),J.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",J.length-10," more errors"]})]})]})]})})}),At=e.jsx(S,{open:lt,title:"SEO Data Preview",secondaryActions:[{content:"Close",onAction:()=>{ge(!1),pe(null)}}],children:e.jsx(S.Section,{children:e.jsx(c,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",backgroundColor:"#f6f6f7",padding:"12px",borderRadius:"4px",maxHeight:"400px",overflow:"auto"},children:Ie?JSON.stringify(Ie,null,2):""})})})}),Lt=e.jsx(S,{open:tt,title:"Delete Optimization for AI Search",onClose:()=>{te(!1),N([])},primaryAction:{content:"Continue",onAction:()=>{ne(W),te(!1),se(!0)},disabled:W.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{te(!1),N([])}}],children:e.jsx(S.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",C?_:g.length," selected collections:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(w,{gap:"400",wrap:!1,children:A.map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[e.jsx("input",{type:"checkbox",checked:W.includes(t),onChange:s=>{N(s.target.checked?[...W,t]:W.filter(o=>o!==t))},style:{marginRight:"8px",width:"18px",height:"18px",cursor:"pointer"}}),e.jsx(r,{variant:"bodyMd",children:t.toUpperCase()})]},t))})}),e.jsx(c,{children:e.jsx(O,{plain:!0,onClick:()=>{N(W.length===A.length?[]:[...A])},children:"Select all"})}),e.jsx(c,{paddingBlockStart:"300",children:e.jsx(r,{variant:"bodySm",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})})]})})}),Mt=e.jsx(S,{open:nt,title:"Confirm Deletion",onClose:()=>{se(!1),ne([])},primaryAction:{content:"Delete",destructive:!0,onAction:async()=>{se(!1),setTimeout(()=>{yt(Pe)},100)}},secondaryActions:[{content:"Cancel",onAction:()=>{se(!1),ne([]),N([])}}],children:e.jsx(S.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(w,{gap:"200",children:Pe.map(t=>e.jsx(V,{tone:"warning",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",C?_:g.length," selected collections."]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(r,{variant:"bodySm",tone:"critical",children:"This action cannot be undone."})})]})})}),Ot=Ae&&e.jsx(S,{open:Ae,title:"Deleting SEO Data",onClose:()=>{},noScroll:!0,children:e.jsx(S.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:"Deleting selected languages..."}),e.jsx(me,{progress:E.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[E.current," of ",E.total," operations (",E.percent,"%)"]})]})})}),Pt=e.jsx(qt,{heading:"No collections found",action:{content:"Clear filters",onAction:()=>{le(""),ee("all"),D()}},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms"})});return e.jsxs(e.Fragment,{children:[e.jsx(It,{globalPlan:j}),e.jsx(He,{children:e.jsx(c,{padding:"400",children:e.jsxs(M,{gap:"300",children:[e.jsxs(w,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(c,{minWidth:"400px",children:e.jsx(Rt,{label:"",placeholder:"Search by collection name...",value:z,onChange:le,prefix:e.jsx(Ut,{}),clearButton:!0,onClearButtonClick:()=>le("")})}),e.jsx(c,{width:"320px",children:e.jsx(O,{primary:!0,onClick:ft,disabled:g.length===0&&!C,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(w,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(O,{onClick:ut,disabled:Me||xe,size:"medium",children:Me?"Syncing...":"Sync Collections"}),e.jsx(c,{width:"320px",children:e.jsxs(M,{gap:"200",align:"end",children:[(()=>{if(g.length===0&&!C||!f.filter(a=>g.includes(a.id)).some(a=>{var i;return((i=a.optimizedLanguages)==null?void 0:i.length)>0}))return null;const o=L.toLowerCase().replace(/_/g," ")==="starter";return e.jsx(O,{onClick:o?()=>{q({error:"Collections require Professional plan or higher",message:"Upgrade to Professional plan to access Collections optimization",minimumPlanRequired:"Professional"}),Y(!0)}:mt,disabled:g.length===0&&!C,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(O,{outline:!0,destructive:!0,onClick:()=>te(!0),disabled:g.length===0||!st,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]})})}),e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(He,{children:[e.jsxs(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(w,{gap:"200",wrap:!0,align:"space-between",children:[e.jsx(w,{gap:"200",wrap:!0,children:e.jsx(Ke,{active:ye,activator:e.jsx(O,{disclosure:"down",onClick:()=>re(!ye),removeUnderline:!0,children:e.jsxs(w,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),P!=="all"&&e.jsx(c,{onClick:t=>{t.stopPropagation(),ee("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>re(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Ge,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All collections",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[P],onChange:t=>{ee(t[0]),re(!1)}})})})}),e.jsx(Ke,{active:we,activator:e.jsx(O,{disclosure:"down",onClick:()=>ie(!we),removeUnderline:!0,children:e.jsx(w,{gap:"100",blockAlign:"center",children:e.jsxs("span",{children:[k==="updatedAt"&&I==="desc"&&"Newest first",k==="updatedAt"&&I==="asc"&&"Oldest first",k==="title"&&I==="asc"&&"Name A-Z",k==="title"&&I==="desc"&&"Name Z-A",k==="productsCount"&&I==="desc"&&"Most products",k==="productsCount"&&I==="asc"&&"Least products"]})})}),onClose:()=>ie(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Ge,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"updatedAt_desc"},{label:"Oldest first",value:"updatedAt_asc"},{label:"Name A-Z",value:"title_asc"},{label:"Name Z-A",value:"title_desc"},{label:"Most products",value:"productsCount_desc"},{label:"Least products",value:"productsCount_asc"}],selected:[`${k}_${I}`],onChange:t=>{const[s,o]=t[0].split("_");Qe(s),Ye(o),ie(!1)}})})})]}),P!=="all"&&e.jsx(c,{paddingBlockStart:"200",children:e.jsx(w,{gap:"100",wrap:!0,children:e.jsx(V,{onRemove:()=>ee("all"),children:P==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"})})})]}),_>0&&e.jsx(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:e.jsx(_e,{label:`Select all ${_} collections`,checked:C,onChange:gt})}),e.jsx(Bt,{resourceName:{singular:"collection",plural:"collections"},items:f,renderItem:wt,selectedItems:g,onSelectionChange:ht,selectable:!0,loading:xe,totalItemsCount:_,emptyState:Pt,showHeader:!1},`collections-${f.length}-${g.length}`)]})}),bt,Ct,vt,At,Lt,Mt,Ot,St(),e.jsx(Et,{open:it,onClose:()=>Y(!1),featureName:"Collections AI Enhancement",currentPlan:L,errorMessage:(p==null?void 0:p.error)||(p==null?void 0:p.message),minimumPlanRequired:p==null?void 0:p.minimumPlanRequired}),p&&e.jsxs(e.Fragment,{children:[e.jsx(Tt,{open:ct,onClose:()=>{$e(!1),q(null)},tokensRequired:p.tokensRequired||0,tokensAvailable:p.tokensAvailable||0,tokensNeeded:p.tokensNeeded||0,feature:"ai-seo-collection",shop:d,needsUpgrade:p.needsUpgrade||!1,minimumPlan:p.minimumPlanForFeature||null,currentPlan:p.currentPlan||L,returnTo:"/ai-seo/collections"}),e.jsx(Dt,{open:dt,onClose:()=>{Re(!1),q(null)},feature:p.feature||"ai-seo-collection",trialEndsAt:p.trialEndsAt,currentPlan:p.currentPlan||L,tokensRequired:p.tokensRequired||0,onActivatePlan:async()=>{try{console.log("[COLLECTIONS] ðŸ”“ Activating plan directly...");const t=await b("/api/billing/activate",{method:"POST",body:JSON.stringify({shop:d,endTrial:!0,returnTo:"/ai-seo/collections"})});if(t.requiresApproval&&t.confirmationUrl){window.top.location.href=t.confirmationUrl;return}window.location.reload()}catch(t){console.error("[COLLECTIONS] âŒ Activation failed:",t);const s=new URLSearchParams(window.location.search),o=s.get("host"),a=s.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${a}&host=${encodeURIComponent(o)}`}},onPurchaseTokens:()=>{const t=new URLSearchParams(window.location.search),s=t.get("host"),o=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${o}&host=${encodeURIComponent(s)}&returnTo=${encodeURIComponent("/ai-seo/collections")}`}})]}),Te&&e.jsx(Wt,{content:Te,onDismiss:()=>m("")})]})}export{js as default};
