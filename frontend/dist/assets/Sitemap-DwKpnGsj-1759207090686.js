import{j as e}from"./app-bridge-DTE91Ko9-1759207090686.js";import{r as o}from"./react-vendor-tAaa2TlE-1759207090686.js";import{m as W}from"./index-CFnK_KSE-1759207090686.js";import{C as _,a as r,d as p,h as G,I as d,T as t,B as C,n as x,o as j,p as R,q as U,r as F,k as L}from"./polaris-BrE7Wu1T-1759207090686.js";const T=(f,n="")=>{try{return new URLSearchParams(window.location.search).get(f)||n}catch{return n}};function O({shop:f}){const n=f||T("shop",""),[a,I]=o.useState(null),[S,k]=o.useState(!1),[w,y]=o.useState(!1),[v,l]=o.useState(""),[s,B]=o.useState(null),m=o.useMemo(()=>W(),[]),b=o.useCallback(async()=>{if(n)try{const i=await m(`/api/sitemap/info?shop=${n}`);I(i)}catch(i){l(i.message||"Failed to load sitemap info")}},[n,m]),A=o.useCallback(async()=>{var i,h,g;if(n)try{const c=await m("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
        query PlansMe($shop:String!) {
          plansMe(shop:$shop) {
            shop
            plan
            planKey
            priceUsd
            ai_queries_used
            ai_queries_limit
            product_limit
            providersAllowed
            modelsSuggested
            autosyncCron
            trial {
              active
              ends_at
              days_left
            }
          }
        }
      `,variables:{shop:n}})});if((i=c==null?void 0:c.errors)!=null&&i.length)throw new Error(((h=c.errors[0])==null?void 0:h.message)||"GraphQL error");const P=(g=c==null?void 0:c.data)==null?void 0:g.plansMe;B(P||null)}catch{}},[n,m]),E=o.useCallback(async()=>{var i,h,g;if(n){k(!0);try{const u=await fetch(`/api/sitemap/generate?shop=${encodeURIComponent(n)}`,{method:"POST",credentials:"include",headers:{Authorization:`Bearer ${((g=(h=(i=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:i.getState())==null?void 0:h.session)==null?void 0:g.token)||""}`}});if(u.ok)l("Sitemap generated successfully!"),await b();else{const c=await u.text();l(`Sitemap generation failed: ${c}`)}}catch(u){l(u.message||"Sitemap generation failed")}finally{k(!1)}}},[n,b]),M=o.useCallback(async()=>{if(n){y(!0);try{const i=`/api/sitemap/generate?shop=${encodeURIComponent(n)}&force=true&t=${Date.now()}`,h=window.open(i,"_blank");setTimeout(()=>{y(!1)},2e3)}catch{y(!1),l("Failed to open sitemap")}}},[n]);return o.useEffect(()=>{b(),A()},[b,A]),e.jsxs(_,{children:[e.jsx(r,{padding:"400",children:e.jsxs(p,{gap:"400",children:[e.jsx(G,{tone:"info",children:e.jsxs("p",{children:["Your ",(s==null?void 0:s.plan)||"Starter"," plan includes up to"," ",e.jsx("strong",{children:(s==null?void 0:s.plan)==="Starter"?100:(s==null?void 0:s.plan)==="Professional"?350:(s==null?void 0:s.plan)==="Growth"?1e3:(s==null?void 0:s.plan)==="Growth Extra"?2500:(s==null?void 0:s.plan)==="Enterprise"?6e3:100})," ","URLs in the sitemap.",(a==null?void 0:a.productCount)&&a.productCount>((s==null?void 0:s.plan)==="Starter"?100:(s==null?void 0:s.plan)==="Professional"?350:(s==null?void 0:s.plan)==="Growth"?1e3:(s==null?void 0:s.plan)==="Growth Extra"?2500:(s==null?void 0:s.plan)==="Enterprise"?6e3:100)&&e.jsxs(e.Fragment,{children:[" You have ",a.productCount," products, so only the first"," ",(s==null?void 0:s.plan)==="Starter"?100:(s==null?void 0:s.plan)==="Professional"?350:(s==null?void 0:s.plan)==="Growth"?1e3:(s==null?void 0:s.plan)==="Growth Extra"?2500:(s==null?void 0:s.plan)==="Enterprise"?6e3:100," will be included."]})]})}),e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsxs(r,{children:[e.jsx(t,{variant:"headingMd",as:"h3",children:"Sitemap Generator"}),e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Generate structured sitemap for AI models to discover and index your products"})]}),e.jsx(C,{primary:!0,onClick:E,loading:S,disabled:S,children:S?"Generating...":"Generate Sitemap"})]}),a&&e.jsx(r,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(p,{gap:"300",children:[e.jsx(d,{gap:"200",blockAlign:"center",children:a.generated?e.jsxs(e.Fragment,{children:[e.jsx(x,{source:j,tone:"success"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:"Sitemap Active"})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{source:R}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"No Sitemap Found"})]})}),a.generated&&e.jsxs(p,{gap:"400",children:[e.jsx(r,{children:e.jsxs(p,{gap:"200",children:[e.jsx(r,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(d,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Products included"}),e.jsxs(t,{variant:"bodyMd",fontWeight:"semibold",children:[a.lastProductCount||0," URLs"]})]})}),e.jsx(r,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(d,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"File size"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:a.size?`${(a.size/1024).toFixed(2)} KB`:"Unknown"})]})}),e.jsx(r,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(d,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Last updated"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:a.generatedAt?new Date(a.generatedAt).toLocaleString():"Unknown"})]})})]})}),e.jsx(r,{children:e.jsx(C,{fullWidth:!0,onClick:M,loading:w,disabled:w,icon:U,children:w?e.jsxs(d,{gap:"200",align:"center",children:[e.jsx(F,{size:"small"}),e.jsx(t,{children:"Loading sitemap..."})]}):"View Sitemap"})})]})]})}),e.jsxs(r,{paddingBlockStart:"400",children:[e.jsx(t,{variant:"headingMd",as:"h4",children:"What's included:"}),e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(p,{gap:"200",children:[e.jsxs(d,{gap:"200",blockAlign:"start",children:[e.jsx(r,{minWidth:"24px",children:e.jsx(x,{source:j,tone:"positive"})}),e.jsx(t,{children:"All active products with structured URLs for AI parsing"})]}),e.jsxs(d,{gap:"200",blockAlign:"start",children:[e.jsx(r,{minWidth:"24px",children:e.jsx(x,{source:j,tone:"positive"})}),e.jsx(t,{children:"Priority rankings to help AI models understand product importance"})]}),e.jsxs(d,{gap:"200",blockAlign:"start",children:[e.jsx(r,{minWidth:"24px",children:e.jsx(x,{source:j,tone:"positive"})}),e.jsx(t,{children:"Multi-language URLs for international AI search coverage"})]}),e.jsxs(d,{gap:"200",blockAlign:"start",children:[e.jsx(r,{minWidth:"24px",children:e.jsx(x,{source:j,tone:"positive"})}),e.jsx(t,{children:"Standard XML format that AI crawlers understand"})]})]})})]}),e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(t,{variant:"headingMd",as:"h4",children:"How it helps AI models:"}),e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(p,{gap:"200",children:[e.jsx(t,{children:'1. Click "Generate Sitemap" to create a structured map of your products'}),e.jsx(t,{children:"2. The sitemap is automatically saved and available to AI crawlers"}),e.jsx(t,{children:"3. AI models can discover and understand your product catalog structure"}),e.jsx(t,{children:"4. Regenerate when you add new products to keep AI models updated"})]})})]})]})}),v&&e.jsx(L,{content:v,onDismiss:()=>l("")})]})}export{O as default};
