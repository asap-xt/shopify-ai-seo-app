import{j as e}from"./app-bridge-YCtueGlv-1762878363427.js";import{r as s}from"./react-vendor-tAaa2TlE-1762878363427.js";import{v as te,L as c,C as m,a as i,w as W,x as H,d as j,I as v,T as a,f as ae,D as L,B as p,b as $,M as f,y as re,h as oe}from"./polaris-Gdq4DfDZ-1762878363427.js";const E=[10,20,50,100];function de({shop:u}){var G,N,Y;const[q,D]=s.useState(!0),[l,J]=s.useState(null),[x,I]=s.useState(null),[K,y]=s.useState(!1),[V,k]=s.useState(!1),[_,T]=s.useState(!1),[S,A]=s.useState(""),[P,B]=s.useState(E[0]),[C,M]=s.useState(!1),[F,g]=s.useState(null),[O,U]=s.useState(!1),[Q,R]=s.useState(!1),z=s.useCallback(async()=>{var t;try{D(!0),g(null);const r=await fetch(`/api/billing/info?shop=${u}`,{headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP ${r.status}`);const o=await r.json();J(o),(((t=o.subscription)==null?void 0:t.status)==="pending"||!o.subscription)&&R(!0)}catch(r){console.error("[Billing] Error fetching info:",r),g("Failed to load billing information")}finally{D(!1)}},[u]);s.useEffect(()=>{if(z(),new URLSearchParams(window.location.search).get("success")==="true"){const r=window.location.pathname+"?shop="+u;window.history.replaceState({},"",r),setTimeout(()=>{console.log("[Billing] Plan activated successfully, redirecting to Dashboard...");const o=new URLSearchParams(window.location.search),h=o.get("host"),w=o.get("embedded"),b=`/dashboard?shop=${encodeURIComponent(u)}&embedded=${w}&host=${encodeURIComponent(h)}`;console.log("[Billing] Redirecting to:",b),window.location.href=b},1e3)}},[z,u]);const X=async t=>{try{M(!0),g(null),R(!1);const r=await fetch("/api/billing/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:u,plan:t,endTrial:O})}),o=await r.json();if(!r.ok)throw new Error(o.error||"Failed to create subscription");o.confirmationUrl&&(window.top.location.href=o.confirmationUrl)}catch(r){console.error("[Billing] Subscribe error:",r),g(r.message)}finally{M(!1),y(!1),U(!1)}},Z=async t=>{try{M(!0),g(null);const r=await fetch("/api/billing/tokens/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:u,amount:parseFloat(t)})}),o=await r.json();if(!r.ok)throw new Error(o.error||"Failed to purchase tokens");o.confirmationUrl&&(window.top.location.href=o.confirmationUrl)}catch(r){console.error("[Billing] Purchase error:",r),g(r.message)}finally{M(!1),k(!1)}},ee=t=>{const h=t*.3/.16;return Math.floor(h*1e6)};if(q)return e.jsx(te,{title:"Plans & Billing",primaryAction:!0,children:e.jsxs(c,{children:[e.jsx(c.Section,{children:e.jsx(m,{children:e.jsxs(i,{gap:"400",children:[e.jsx(W,{size:"small"}),e.jsx(H,{lines:3})]})})}),e.jsx(c.Section,{children:e.jsx(m,{children:e.jsxs(i,{gap:"400",children:[e.jsx(W,{size:"medium"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},children:[1,2,3,4].map(t=>e.jsx(m,{children:e.jsxs(i,{gap:"200",children:[e.jsx(W,{size:"small"}),e.jsx(H,{lines:5})]})},t))})]})})})]})});const n=l==null?void 0:l.subscription,d=l==null?void 0:l.tokens,ne=(l==null?void 0:l.plans)||[];return console.log("[Billing] Current plan:",n==null?void 0:n.plan,"Type:",typeof(n==null?void 0:n.plan)),e.jsxs(e.Fragment,{children:[e.jsxs(c,{children:[F&&e.jsx(c.Section,{children:e.jsx(j,{title:"Error",tone:"critical",onDismiss:()=>g(null),children:e.jsx("p",{children:F})})}),Q&&e.jsx(c.Section,{children:e.jsx(j,{title:"ðŸ¤– Future-Proof Your Product Discovery",tone:"success",onDismiss:()=>R(!1),children:e.jsxs(i,{gap:"200",children:[e.jsx("p",{children:"Traditional SEO isn't enough anymore. AI assistants like ChatGPT, Gemini & Perplexity need structured data to recommend your products."}),e.jsx("p",{children:"indexAIze transforms your product data into structured formats optimized for AI search engines, making it easy for ChatGPT, Gemini, Perplexity and others to find and recommend your products."}),e.jsxs("p",{children:[e.jsx("strong",{children:"âœ… Smart approach:"})," Start with a smaller plan to test optimization. Upgrade anytime to scale across your entire catalog."]})]})})}),(n==null?void 0:n.inTrial)&&e.jsx(c.Section,{children:e.jsx(j,{title:"Trial Period Active",tone:"info",action:{content:"Activate Plan",onAction:()=>{U(!0),y(!0)}},children:e.jsxs("p",{children:["Trial ends on ",new Date(n.trialEndsAt).toLocaleDateString(),". Advanced AI features are locked during trial. Activate your ",n.plan," plan to use them now."]})})}),e.jsx(c.Section,{children:e.jsx(m,{children:e.jsx(i,{gap:"400",children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},children:ne.map(t=>{var r;return e.jsx(m,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",minHeight:"400px",gap:"12px"},children:[e.jsxs(v,{align:"space-between",blockAlign:"center",children:[e.jsx(a,{variant:"headingMd",children:t.name}),(n==null?void 0:n.plan)===t.key&&(n==null?void 0:n.status)==="active"&&e.jsx(ae,{tone:"success",children:"Current"})]}),t.badge&&e.jsx(a,{variant:"bodySm",tone:"subdued",fontWeight:"medium",children:t.badge}),e.jsxs(a,{variant:"heading2xl",children:["$",t.price]}),e.jsx(a,{variant:"bodySm",tone:"subdued",children:"per month"}),e.jsx(L,{}),e.jsxs(a,{variant:"bodySm",tone:"subdued",children:["Optimize up to ",e.jsx("strong",{children:((r=t.productLimit)==null?void 0:r.toLocaleString())||"N/A"})," products in up to ",e.jsx("strong",{children:t.languageLimit||1})," ",t.languageLimit===1?"language":"languages"]}),t.features&&t.features.length>0&&e.jsxs(p,{children:[e.jsx(a,{variant:"bodySm",fontWeight:"semibold",children:"Features:"}),e.jsx(i,{gap:"100",children:t.features.map((o,h)=>e.jsx(a,{variant:"bodySm",tone:"subdued",children:o.startsWith("All from")||o.startsWith("âœ“")?o:`âœ“ ${o}`},h))})]}),e.jsx("div",{style:{flexGrow:1}}),(n==null?void 0:n.plan)===t.key&&(n==null?void 0:n.status)==="active"?e.jsx(p,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",style:{marginTop:"auto"},children:e.jsx(a,{variant:"bodySm",alignment:"center",tone:"subdued",fontWeight:"medium",children:"Current Plan"})}):e.jsx($,{variant:"primary",fullWidth:!0,onClick:()=>{I(t),y(!0)},children:"Select Plan"})]})},t.key)})})})})}),e.jsx(c.Section,{variant:"oneThird",children:e.jsx(m,{children:e.jsxs(i,{gap:"400",children:[e.jsx(a,{variant:"headingMd",children:"Token Balance"}),e.jsx(L,{}),e.jsxs(i,{gap:"300",children:[e.jsxs(p,{children:[e.jsx(a,{variant:"heading2xl",alignment:"center",children:((G=d==null?void 0:d.balance)==null?void 0:G.toLocaleString())||0}),e.jsx(a,{variant:"bodySm",tone:"subdued",alignment:"center",children:"tokens available"}),(()=>{var b;const t=(b=n==null?void 0:n.plan)==null?void 0:b.toLowerCase().trim();console.log("[Billing] Current plan key:",t);const r=t==="growth extra",o=t==="enterprise",h=r||o;if(console.log("[Billing] Is growth extra?",r),console.log("[Billing] Is enterprise?",o),console.log("[Billing] Condition result:",h),!h)return console.log("[Billing] NOT rendering tokens text"),null;const w=r?"100M":"300M";return console.log("[Billing] Rendering tokens text:",w),e.jsxs(a,{variant:"bodySm",tone:"subdued",alignment:"center",fontWeight:"medium",children:["(",w," included this cycle)"]})})()]}),e.jsxs(v,{align:"space-between",children:[e.jsx(a,{variant:"bodySm",tone:"subdued",children:(()=>{var r;const t=(r=n==null?void 0:n.plan)==null?void 0:r.toLowerCase().trim();return t==="growth extra"||t==="enterprise"?"Additional Purchased":"Purchased"})()}),e.jsx(a,{variant:"bodySm",children:((N=d==null?void 0:d.totalPurchased)==null?void 0:N.toLocaleString())||0})]}),e.jsxs(v,{align:"space-between",children:[e.jsx(a,{variant:"bodySm",tone:"subdued",children:"Used"}),e.jsx(a,{variant:"bodySm",children:((Y=d==null?void 0:d.totalUsed)==null?void 0:Y.toLocaleString())||0})]}),e.jsx(L,{}),e.jsx($,{variant:"primary",fullWidth:!0,onClick:()=>{console.log("[Billing] Buy Tokens clicked. Plan:",n==null?void 0:n.plan,"Comparison:",(n==null?void 0:n.plan)==="starter"),(n==null?void 0:n.plan)==="starter"?(console.log("[Billing] Showing upgrade modal for Starter plan"),T(!0)):(console.log("[Billing] Showing token purchase modal"),k(!0))},children:"Buy Tokens"}),e.jsx(p,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:e.jsxs(i,{gap:"100",children:[e.jsx(a,{variant:"bodySm",tone:"subdued",children:"ðŸ’¡ Tokens enable AI features"}),e.jsx(a,{variant:"bodySm",tone:"subdued",children:"â™»ï¸ Never expire, roll over monthly"})]})})]})]})})})]}),e.jsx(f,{open:K,onClose:()=>{y(!1),I(null),U(!1)},title:"Confirm Plan Selection",primaryAction:{content:C?"Processing...":"Confirm",loading:C,onAction:()=>X((x==null?void 0:x.key)||(n==null?void 0:n.plan))},secondaryActions:[{content:"Cancel",onAction:()=>{y(!1),I(null),U(!1)}}],children:e.jsx(f.Section,{children:e.jsxs(i,{gap:"400",children:[e.jsxs(a,{children:["You are about to subscribe to the ",e.jsx("strong",{children:(x==null?void 0:x.name)||(n==null?void 0:n.plan)})," plan."]}),(n==null?void 0:n.inTrial)&&O&&e.jsx(j,{tone:"warning",children:e.jsx("p",{children:"This will end your trial period and start billing immediately."})})]})})}),e.jsx(f,{open:V,onClose:()=>{k(!1),A(""),B(E[0])},title:"Purchase Tokens",primaryAction:{content:C?"Processing...":"Purchase",loading:C,onAction:()=>Z(S||P)},secondaryActions:[{content:"Cancel",onAction:()=>{k(!1),A(""),B(E[0])}}],children:e.jsx(f.Section,{children:e.jsxs(i,{gap:"400",children:[e.jsx(a,{variant:"headingMd",children:"Select Amount"}),e.jsx(re,{variant:"segmented",children:E.map(t=>e.jsxs($,{pressed:P===t&&!S,onClick:()=>{B(t),A("")},children:["$",t]},t))}),e.jsx(a,{variant:"bodyMd",tone:"subdued",children:"Or enter a custom amount (multiples of $5)"}),e.jsx(oe,{type:"number",value:S,onChange:t=>{A(t),B(null)},placeholder:"Enter amount",prefix:"$",min:5,step:5,autoComplete:"off"}),e.jsx(p,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(i,{gap:"200",children:[e.jsxs(v,{align:"space-between",children:[e.jsx(a,{variant:"bodyMd",children:"Amount"}),e.jsxs(a,{variant:"bodyMd",fontWeight:"semibold",children:["$",S||P]})]}),e.jsxs(v,{align:"space-between",children:[e.jsx(a,{variant:"bodyMd",children:"Tokens"}),e.jsx(a,{variant:"bodyMd",fontWeight:"semibold",children:ee(parseFloat(S||P)).toLocaleString()})]}),e.jsx(L,{}),e.jsx(a,{variant:"bodySm",tone:"subdued",children:"Tokens never expire and roll over indefinitely"})]})}),(n==null?void 0:n.inTrial)&&e.jsx(j,{tone:"info",children:e.jsx("p",{children:"Your trial will continue after purchasing tokens."})})]})})}),e.jsx(f,{open:_,onClose:()=>T(!1),title:"Upgrade Required",primaryAction:{content:"View Plans",onAction:()=>{T(!1),window.scrollTo({top:0,behavior:"smooth"})}},secondaryActions:[{content:"Cancel",onAction:()=>T(!1)}],children:e.jsx(f.Section,{children:e.jsxs(i,{gap:"400",children:[e.jsxs(a,{variant:"bodyLg",children:["Token purchases require ",e.jsx("strong",{children:"Professional"})," plan or higher."]}),e.jsxs(a,{variant:"bodyMd",tone:"subdued",children:["Your current plan: ",e.jsx("strong",{children:"Starter"})]}),e.jsx(p,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(i,{gap:"200",children:[e.jsx(a,{variant:"headingSm",children:"Upgrade to unlock:"}),e.jsx(a,{variant:"bodyMd",children:"âœ“ Token purchases"}),e.jsx(a,{variant:"bodyMd",children:"âœ“ AI-enhanced optimization"}),e.jsx(a,{variant:"bodyMd",children:"âœ“ Store Metadata for AI Search"}),e.jsx(a,{variant:"bodyMd",children:"âœ“ More AI bot access"}),e.jsx(a,{variant:"bodyMd",children:"âœ“ Higher product limits"})]})}),e.jsx(j,{tone:"info",children:e.jsx("p",{children:"Professional plan starts at $15.99/month with up to 250 products."})})]})})})]})}export{de as default};
