import{j as e}from"./app-bridge-DEaMzp1Y-1761940419499.js";import{r as g}from"./react-vendor-tAaa2TlE-1761940419499.js";import{m as Fe}from"./sessionFetch-CJepNHo3-1761940419499.js";import{C as y,B as h,T as r,a as k,L as M,e as w,s as D,h as l,D as We,f as qe,I as Je,k as Ve}from"./polaris-CJquqaRr-1761940419499.js";const Ge=(z,p="")=>{try{return new URLSearchParams(window.location.search).get(z)||p}catch{return p}};function ea({shop:z}){var B,_,$,F,W,q,J,V;const p=z||Ge("shop",""),[ke,E]=g.useState(!1),[Ee,P]=g.useState(!1),[L,x]=g.useState(""),[s,Pe]=g.useState(null),C=g.useMemo(()=>Fe({}),[]),[Le,O]=g.useState(!1),[Ke,Xe]=g.useState(!1),[j,Oe]=g.useState({storeName:"",homePageTitle:"",metaDescription:""}),[Re,R]=g.useState(!1),[i,n]=g.useState({seo:{storeName:"",shortDescription:"",fullDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:"",supportedCurrencies:"",shippingRegions:"",culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""}});g.useEffect(()=>{p&&I()},[p,C]);async function I(){var t,a,u,o,b,m,S,G,K,X,H,Y,Q,Z,ee,ae,te,ie,oe,ne,se,re,le,de,ce,he,pe,ge,ue,me,Se,fe,xe,ye,Me,je,be,ve,De,Ce,we;console.log("[StoreMeta] LOAD - Start"),E(!0);try{const f=`/api/store/generate?shop=${encodeURIComponent(p)}`;console.log("[StoreMeta] LOAD - Fetching from",f);const d=await C(f,{headers:{"X-Shop":p}});console.log("[StoreMeta] LOAD - Received data",{hasExisting:!!d.existingMetadata,existingKeys:Object.keys(d.existingMetadata||{}),shopifyDefaults:d.shopifyDefaults}),Pe(d),Oe({storeName:((t=d.shopifyDefaults)==null?void 0:t.storeName)||"",homePageTitle:((a=d.shopifyDefaults)==null?void 0:a.homePageTitle)||"",metaDescription:((u=d.shopifyDefaults)==null?void 0:u.metaDescription)||""});const c=d.existingMetadata||{},T=((b=(o=c.seo_metadata)==null?void 0:o.value)==null?void 0:b.storeName)||"",N=((S=(m=c.seo_metadata)==null?void 0:m.value)==null?void 0:S.shortDescription)||"",A=((K=(G=c.seo_metadata)==null?void 0:G.value)==null?void 0:K.fullDescription)||"",ze=T||((X=d.shopifyDefaults)==null?void 0:X.storeName)||"",Te=N||((H=d.shopifyDefaults)==null?void 0:H.homePageTitle)||"",Ne=A||((Y=d.shopifyDefaults)==null?void 0:Y.metaDescription)||"";console.log("[StoreMeta] LOAD - Display values",{displayStoreName:ze,displayShortDescription:Te,displayFullDescription:Ne});const Be=T&&T!==((Q=d.shopifyDefaults)==null?void 0:Q.storeName),_e=N&&N!==((Z=d.shopifyDefaults)==null?void 0:Z.homePageTitle),$e=A&&A!==((ee=d.shopifyDefaults)==null?void 0:ee.metaDescription);R(Be||_e||$e);const Ae={seo:{storeName:ze,shortDescription:Te,fullDescription:Ne,keywords:Array.isArray((te=(ae=c.seo_metadata)==null?void 0:ae.value)==null?void 0:te.keywords)?c.seo_metadata.value.keywords.join(", "):((oe=(ie=c.seo_metadata)==null?void 0:ie.value)==null?void 0:oe.keywords)||""},aiMetadata:{...((ne=c.ai_metadata)==null?void 0:ne.value)||{},languages:((le=(re=(se=c.ai_metadata)==null?void 0:se.value)==null?void 0:re.languages)==null?void 0:le.length)>0?c.ai_metadata.value.languages.join(", "):(((de=d.shopInfo)==null?void 0:de.locales)||[]).filter(v=>v.published).map(v=>v.locale).join(", "),supportedCurrencies:((pe=(he=(ce=c.ai_metadata)==null?void 0:ce.value)==null?void 0:he.supportedCurrencies)==null?void 0:pe.length)>0?c.ai_metadata.value.supportedCurrencies.join(", "):(((ge=d.shopInfo)==null?void 0:ge.currencies)||["EUR"]).join(", "),shippingRegions:((Se=(me=(ue=c.ai_metadata)==null?void 0:ue.value)==null?void 0:me.shippingRegions)==null?void 0:Se.length)>0?c.ai_metadata.value.shippingRegions.join(", "):(((fe=d.shopInfo)==null?void 0:fe.markets)||[]).map(v=>v.name).join(", ")},organizationSchema:{...((xe=c.organization_schema)==null?void 0:xe.value)||{},enabled:((Me=(ye=c.organization_schema)==null?void 0:ye.value)==null?void 0:Me.enabled)===!0,name:((be=(je=c.organization_schema)==null?void 0:je.value)==null?void 0:be.name)||((ve=d.shopInfo)==null?void 0:ve.name)||"",email:((Ce=(De=c.organization_schema)==null?void 0:De.value)==null?void 0:Ce.email)||((we=d.shopInfo)==null?void 0:we.email)||""}};console.log("[StoreMeta] LOAD - Setting formData",Ae),n(Ae)}catch(f){console.error("[StoreMeta] Load error:",f),x(`Load failed: ${(f==null?void 0:f.message)||"Unknown error"}`)}finally{E(!1)}}function Ie(){n(t=>({...t,seo:{...t.seo,storeName:"",shortDescription:"",fullDescription:""}})),R(!1),x("Synced with Shopify store settings")}async function U(){P(!0);try{const t={...i,aiMetadata:{...i.aiMetadata,languages:typeof i.aiMetadata.languages=="string"?i.aiMetadata.languages.split(",").map(o=>o.trim()).filter(o=>o):i.aiMetadata.languages,supportedCurrencies:typeof i.aiMetadata.supportedCurrencies=="string"?i.aiMetadata.supportedCurrencies.split(",").map(o=>o.trim()).filter(o=>o):i.aiMetadata.supportedCurrencies,shippingRegions:typeof i.aiMetadata.shippingRegions=="string"?i.aiMetadata.shippingRegions.split(",").map(o=>o.trim()).filter(o=>o):i.aiMetadata.shippingRegions}},a=`/api/store/apply?shop=${encodeURIComponent(p)}`;console.log("[StoreMeta] SAVE",a);const u=await C(a,{method:"POST",headers:{"X-Shop":p},body:{metadata:t,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:i.organizationSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:a,ok:u==null?void 0:u.ok}),x("Metadata saved successfully!"),await I()}catch(t){console.error("[StoreMeta] SAVE error",(t==null?void 0:t.debug)||t,t),x(`Save failed: ${(t==null?void 0:t.message)||"Unknown error"}`)}finally{P(!1)}}async function Ue(){var t;O(!0);try{await U();const u=await C("/graphql",{method:"POST",headers:{"X-Shop":p},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            shortDescription
            seoMetadata
            aiMetadata
            organizationSchema
          }
        }
      `,variables:{shop:p}}});if(u.error)throw new Error(u.error);const o=(t=u.data)==null?void 0:t.storeMetadata;if(o){const b=window.open("","_blank");console.log("[STORE-METADATA] Raw preview data:",o),console.log("[STORE-METADATA] seoMetadata raw:",o.seoMetadata),console.log("[STORE-METADATA] aiMetadata raw:",o.aiMetadata),console.log("[STORE-METADATA] organizationSchema raw:",o.organizationSchema);const m={shopName:o.shopName,shortDescription:o.shortDescription,description:o.description,seoMetadata:o.seoMetadata?(()=>{try{return JSON.parse(o.seoMetadata)}catch(S){return console.error("Error parsing seoMetadata:",S),o.seoMetadata}})():null,aiMetadata:o.aiMetadata?(()=>{try{return JSON.parse(o.aiMetadata)}catch(S){return console.error("Error parsing aiMetadata:",S),o.aiMetadata}})():null,organizationSchema:o.organizationSchema?(()=>{try{return JSON.parse(o.organizationSchema)}catch(S){return console.error("Error parsing organizationSchema:",S),o.organizationSchema}})():null};b.document.write(`
          <html>
            <head>
              <title>Store Metadata Preview</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
                h1 { color: #333; }
                .section { margin: 20px 0; }
                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
              </style>
            </head>
            <body>
              <h1>Store Metadata Preview</h1>
              <div class="section">
                <h2>Basic Info</h2>
                <p><strong>Shop Name:</strong> ${m.shopName||"Not set"}</p>
                <p><strong>Short Description:</strong> ${o.shortDescription||"Not set"}</p>
                <p><strong>Full Description:</strong> ${m.description||"Not set"}</p>
              </div>
              
              <div class="section">
                <h2>SEO Metadata</h2>
                <pre>${JSON.stringify(m.seoMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>AI Metadata</h2>
                <pre>${JSON.stringify(m.aiMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Organization Schema</h2>
                <pre>${JSON.stringify(m.organizationSchema,null,2)}</pre>
              </div>
              
              <!-- Local Business Schema - DISABLED -->
              <!-- <div class="section">
                <h2>Local Business Schema</h2>
                <pre>${JSON.stringify(m.localBusinessSchema,null,2)}</pre>
              </div> -->
              
              <div class="section">
                <h2>Raw Data</h2>
                <pre>${JSON.stringify(m,null,2)}</pre>
              </div>
            </body>
          </html>
        `),b.document.close()}else throw new Error("No preview data available")}catch(a){x(`Preview failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{O(!1)}}return ke&&!s?e.jsx(y,{children:e.jsx(h,{padding:"400",children:e.jsx(r,{children:"Loading store data..."})})}):(s==null?void 0:s.plan)==="Starter"?e.jsx(k,{status:"warning",children:e.jsx(r,{children:"Store metadata features are available starting from the Professional plan."})}):e.jsxs(M,{children:[e.jsx(M.Section,{children:e.jsx(y,{title:"Basic Store Information",children:e.jsxs(h,{padding:"400",children:[e.jsx(k,{tone:"info",children:e.jsxs(h,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"From Shopify Settings:"}),e.jsxs(h,{paddingBlockStart:"200",children:[e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Store name: ",e.jsx(r,{as:"span",fontWeight:"medium",children:j.storeName||"Not set"})]}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Home page title: ",e.jsx(r,{as:"span",fontWeight:"medium",children:j.homePageTitle||"Not set"})]}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Meta description: ",e.jsx(r,{as:"span",fontWeight:"medium",children:j.metaDescription?j.metaDescription.substring(0,100)+(j.metaDescription.length>100?"...":""):"Not set"})]}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Languages: ",e.jsx(r,{as:"span",fontWeight:"medium",children:((_=(B=s==null?void 0:s.shopInfo)==null?void 0:B.locales)==null?void 0:_.filter(t=>t.published).map(t=>t.locale).join(", "))||"Not set"})]}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Currencies: ",e.jsx(r,{as:"span",fontWeight:"medium",children:((F=($=s==null?void 0:s.shopInfo)==null?void 0:$.currencies)==null?void 0:F.join(", "))||"EUR"})]}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Markets: ",e.jsx(r,{as:"span",fontWeight:"medium",children:((q=(W=s==null?void 0:s.shopInfo)==null?void 0:W.markets)==null?void 0:q.map(t=>t.name).join(", "))||"Not set"})]}),((J=s==null?void 0:s.shopInfo)==null?void 0:J.name)&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Organization: ",e.jsx(r,{as:"span",fontWeight:"medium",children:s.shopInfo.name}),s.shopInfo.email&&e.jsxs(e.Fragment,{children:[" (",s.shopInfo.email,")"]})]})]}),Re&&e.jsx(h,{paddingBlockStart:"300",children:e.jsx(w,{size:"slim",onClick:Ie,children:"Sync from Shopify"})})]})}),e.jsx(h,{paddingBlockStart:"400",children:e.jsxs(D,{children:[e.jsx(l,{label:"Store Name",value:i.seo.storeName,onChange:t=>n(a=>({...a,seo:{...a.seo,storeName:t}})),helpText:"Loaded from Shopify. Edit if needed.",maxLength:100}),e.jsx(l,{label:"Short Store Description",value:i.seo.shortDescription,onChange:t=>n(a=>({...a,seo:{...a.seo,shortDescription:t}})),helpText:"Loaded from Shopify. Edit if needed - max 100 characters",maxLength:100}),e.jsx(l,{label:"Full Store Description",value:i.seo.fullDescription,onChange:t=>n(a=>({...a,seo:{...a.seo,fullDescription:t}})),helpText:"Loaded from Shopify. Edit if needed - max 300 characters",maxLength:300,multiline:3}),e.jsx(l,{label:"Keywords",value:i.seo.keywords,onChange:t=>n(a=>({...a,seo:{...a.seo,keywords:t}})),helpText:"Comma-separated keywords (optional)"})]})})]})})}),e.jsx(M.Section,{children:e.jsx(y,{title:"AI Metadata",children:e.jsx(h,{padding:"400",children:e.jsxs(D,{children:[e.jsxs(D.Group,{children:[e.jsx(l,{label:"Business Type",value:i.aiMetadata.businessType,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,businessType:t}})),placeholder:"e.g., Fashion Retailer, Electronics Store",helpText:"Max 3 words"}),e.jsx(l,{label:"Target Audience",value:i.aiMetadata.targetAudience,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,targetAudience:t}})),placeholder:"e.g., Young professionals, Parents"})]}),e.jsx(l,{label:"Unique Selling Points",value:i.aiMetadata.uniqueSellingPoints,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,uniqueSellingPoints:t}})),helpText:"Comma-separated list",multiline:2}),e.jsx(l,{label:"Brand Voice",value:i.aiMetadata.brandVoice,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,brandVoice:t}})),placeholder:"e.g., Professional, Friendly, Casual"}),e.jsx(l,{label:"Primary Categories",value:i.aiMetadata.primaryCategories,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,primaryCategories:t}})),helpText:"Main product categories, comma-separated"}),e.jsx(l,{label:"Shipping Information",value:i.aiMetadata.shippingInfo,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,shippingInfo:t}})),helpText:"Shipping costs, delivery times, free shipping thresholds (e.g., Free shipping over $50, 2-3 business days)",multiline:2}),e.jsx(l,{label:"Return Policy",value:i.aiMetadata.returnPolicy,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,returnPolicy:t}})),multiline:2}),e.jsx(We,{}),e.jsx(r,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),e.jsx(r,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),e.jsx(l,{label:"Supported Languages",value:i.aiMetadata.languages||"",onChange:t=>{n(a=>({...a,aiMetadata:{...a.aiMetadata,languages:t}}))},helpText:"Comma-separated language codes (e.g., en, de, es, fr)",multiline:2}),e.jsx(l,{label:"Supported Currencies",value:i.aiMetadata.supportedCurrencies||"",onChange:t=>{n(a=>({...a,aiMetadata:{...a.aiMetadata,supportedCurrencies:t}}))},helpText:"Comma-separated currency codes (e.g., EUR, USD, GBP)"}),e.jsx(l,{label:"Shipping Regions",value:i.aiMetadata.shippingRegions||"",onChange:t=>{n(a=>({...a,aiMetadata:{...a.aiMetadata,shippingRegions:t}}))},helpText:"Comma-separated regions (e.g., EU, USA, UK, Canada)",multiline:2}),e.jsx(l,{label:"Cultural Considerations",value:i.aiMetadata.culturalConsiderations||"",onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,culturalConsiderations:t}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),(V=s==null?void 0:s.features)!=null&&V.organizationSchema?e.jsx(M.Section,{children:e.jsx(y,{title:"Organization Schema",children:e.jsxs(h,{padding:"400",children:[e.jsx(qe,{label:"Enable Organization Schema",checked:i.organizationSchema.enabled,onChange:t=>n(a=>({...a,organizationSchema:{...a.organizationSchema,enabled:t}}))}),i.organizationSchema.enabled&&e.jsx(h,{paddingBlockStart:"400",children:e.jsxs(D,{children:[e.jsxs(D.Group,{children:[e.jsx(l,{label:"Organization Name",value:i.organizationSchema.name,onChange:t=>n(a=>({...a,organizationSchema:{...a.organizationSchema,name:t}}))}),e.jsx(l,{label:"Contact Email",value:i.organizationSchema.email,onChange:t=>n(a=>({...a,organizationSchema:{...a.organizationSchema,email:t}})),type:"email"})]}),e.jsx(l,{label:"Phone",value:i.organizationSchema.phone,onChange:t=>n(a=>({...a,organizationSchema:{...a.organizationSchema,phone:t}})),type:"tel"}),e.jsx(l,{label:"Logo URL",value:i.organizationSchema.logo,onChange:t=>n(a=>({...a,organizationSchema:{...a.organizationSchema,logo:t}})),type:"url"}),e.jsx(l,{label:"Social Media Links",value:i.organizationSchema.sameAs,onChange:t=>n(a=>({...a,organizationSchema:{...a.organizationSchema,sameAs:t}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}):e.jsx(M.Section,{children:e.jsx(y,{title:"Organization Schema",children:e.jsx(h,{padding:"400",children:e.jsx(k,{tone:"info",children:e.jsxs(h,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Upgrade to Professional+ to enable Organization Schema"}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Organization Schema helps AI bots understand your business structure, contact information, and social media presence."}),e.jsx(h,{paddingBlockStart:"300",children:e.jsx(w,{primary:!0,onClick:()=>{const t=new URLSearchParams(window.location.search),a=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${a}`},children:"Upgrade Plan"})})]})})})})}),e.jsx(M.Section,{children:e.jsx(y,{children:e.jsx(h,{padding:"400",children:e.jsxs(Je,{gap:"300",children:[e.jsx(w,{onClick:U,loading:Ee,primary:!0,children:"Save Metadata"}),e.jsx(w,{onClick:Ue,loading:Le,children:"Preview Metadata"}),!1]})})})}),L&&e.jsx(Ve,{content:L,onDismiss:()=>x("")})]})}export{ea as default};
