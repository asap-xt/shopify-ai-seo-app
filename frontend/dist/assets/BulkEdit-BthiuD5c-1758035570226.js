import{j as e}from"./app-bridge-BBQkl22A-1758035570226.js";import{r as n}from"./react-vendor-tAaa2TlE-1758035570226.js";import{u as It}from"./index-CE9vuTD2-1758035570226.js";import{M as x,d as O,T as r,e as He,a as u,I,f as we,B as k,D as vt,g as F,C as Fe,h as Pt,S as Ct,P as me,i as fe,R as wt,j as Tt,k as Ge,l as Dt,E as zt}from"./polaris-HiI2ZWh4-1758035570226.js";const Ot=(B,p="")=>{try{return new URLSearchParams(window.location.search).get(B)||p}catch{return p}},Te=B=>{if(!B)return B;const p=String(B).trim();return p.startsWith("gid://")?p:`gid://shopify/Product/${p}`},kt=B=>{if(!B)return"";const p=String(B).match(/\/(\d+)$/);return p?p[1]:B};function Wt({shop:B}){const{api:p,shop:qe}=It(),i=B||qe||Ot("shop","");n.useEffect(()=>{console.log("[BULK-EDIT] Component mounted"),console.log("[BULK-EDIT] Shop:",i),console.log("[BULK-EDIT] API function available:",typeof p=="function")},[i,p]);const[C,_]=n.useState([]),[V,ne]=n.useState(!1),[Je,De]=n.useState(1),[Ve,Se]=n.useState(!0),[xe,ze]=n.useState(0),[v,Q]=n.useState([]),[T,oe]=n.useState(!1),[H,Oe]=n.useState(""),[U,ae]=n.useState("all"),[D,Y]=n.useState(""),[le,Bt]=n.useState("createdAt"),[G,Qe]=n.useState("desc"),[$,ie]=n.useState([]),[Ye,Xe]=n.useState([]),[ke,je]=n.useState(!1),[Be,ye]=n.useState(!1),[Ue,be]=n.useState(!1),[Me,Le]=n.useState(!1),[Ze,et]=n.useState(""),[Ut,tt]=n.useState([]),[W,re]=n.useState([]),[P,$e]=n.useState([]),[Ae,q]=n.useState(!1),[ce,K]=n.useState({current:0,total:0,percent:0}),[Ke,J]=n.useState(""),[de,X]=n.useState([]),[Z,Ne]=n.useState({}),[st,Ee]=n.useState(!1),[nt,ue]=n.useState(!1),[ot,ee]=n.useState(!1),[N,te]=n.useState([]),[at,ge]=n.useState(!1),[We,j]=n.useState(""),[Ie,ve]=n.useState(!1),[L,se]=n.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[Re,lt]=n.useState(null),[it,pe]=n.useState(!1),[rt,he]=n.useState(!1);n.useEffect(()=>{i&&p("/plans/me",{shop:i}).then(t=>{const s=(t==null?void 0:t.modelsSuggested)||["anthropic/claude-3.5-sonnet"];tt(s.map(o=>({label:o,value:o}))),et(s[0]),lt((t==null?void 0:t.plan)||"starter")}).catch(t=>console.error("[BULK-EDIT] /plans/me failed:",t))},[i,p]),n.useEffect(()=>{if(console.log("[BULK-EDIT] Languages useEffect triggered",{shop:i,api:!!p}),!i){console.log("[BULK-EDIT] No shop, skipping languages load");return}console.log("[BULK-EDIT] Making languages API call to:",`/api/languages/shop/${i}`),console.log("[BULK-EDIT] About to call api() function");const t=new Promise((s,o)=>{setTimeout(()=>o(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([p(`/api/languages/shop/${i}`),t]).then(s=>{console.log("[BULK-EDIT] Languages API response:",s);const o=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];console.log("[BULK-EDIT] Setting available languages to:",o.includes("en")?o:["en",...o]),$e(o.includes("en")?o:["en",...o])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),console.error("[BULK-EDIT] Error details:",s.message,s.stack),$e(["en"])})},[i,p]),n.useEffect(()=>{i&&p("/api/products/tags/list",{shop:i}).then(t=>Xe((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[i,p]);const R=n.useCallback(async(t=1,s=!1,o=null)=>{var c,d,S,l;console.log(`[BULK-EDIT-LOAD] loadProducts called with pageNum: ${t}, append: ${s}, timestamp: ${o}`),console.log("[BULK-EDIT-LOAD] Current products state:",C.length),ne(!0);try{const a=new URLSearchParams({shop:i,page:t,limit:50,...U!=="all"&&{optimized:U},...H&&{search:H},...D&&{languageFilter:D},...$.length>0&&{tags:$.join(",")},sortBy:le,sortOrder:G,...o&&{_t:o}}),g=await p(`/api/products/list?${a}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log(`[BULK-EDIT-LOAD] API returned ${((c=g.products)==null?void 0:c.length)||0} products`),((d=g.products)==null?void 0:d.length)>0&&console.log("[BULK-EDIT-LOAD] First product data:",{id:g.products[0]._id,title:g.products[0].title,optimizationSummary:g.products[0].optimizationSummary}),_(s?y=>[...y,...g.products]:g.products||[]),De(t),Se(((S=g.pagination)==null?void 0:S.hasNext)||!1),ze(((l=g.pagination)==null?void 0:l.total)||0)}catch(a){_(s?C:[]),Se(!1),j(`Error loading products: ${a.message}`)}finally{ne(!1)}},[i,U,H,D,$,le,G]);n.useEffect(()=>{i&&R(1,!1,null)},[i,R,U,D,$,le,G]),n.useEffect(()=>{C.length===0&&!V&&i&&pe(!0)},[C.length,V,i]);const _e=n.useCallback(t=>{Oe(t)},[]);n.useEffect(()=>{const t=setTimeout(()=>{i&&R(1,!1,null)},500);return()=>clearTimeout(t)},[H]);const ct=n.useCallback(t=>{Q(t),t.length===0&&oe(!1)},[]),dt=n.useCallback(t=>{oe(t),Q(t?C.map(s=>s._id):[])},[C]),ut=()=>{if(v.length===0&&!T){j("Please select products first");return}ue(!0)},gt=()=>{if(v.length===0&&!T){j("Please select products first");return}te([]),ee(!0)},pt=()=>{const s=C.filter(d=>v.includes(d._id)).filter(d=>{var S,l;return((l=(S=d.optimizationSummary)==null?void 0:S.optimizedLanguages)==null?void 0:l.length)>0}),o=async()=>{var S;if(console.log("üîç [AI-ENHANCE] handleStartEnhancement called with products:",s),Re&&!["Growth Extra","Enterprise"].includes(Re)){ve(!1),he(!0);return}se({processing:!0,current:0,total:s.length,currentItem:"",results:null});const d={successful:0,failed:0,skipped:0,skippedDueToPlan:0};for(let l=0;l<s.length;l++){const a=s[l];se(g=>({...g,current:l,currentItem:a.title}));try{if(!(await p("/ai-enhance/check-eligibility",{method:"POST",shop:i,body:{shop:i}})).eligible){d.skipped++,d.skippedDueToPlan++;continue}const y=await p("/ai-enhance/product",{method:"POST",shop:i,body:{shop:i,productId:a.gid||`gid://shopify/Product/${a.productId}`,languages:a.optimizationSummary.optimizedLanguages}});if(console.log(`üîç [AI-ENHANCE] Product ${a.productId} enhance data:`,y),y.results&&y.results.length>0){const z={shop:i,productId:a.gid||`gid://shopify/Product/${a.productId}`,results:y.results.filter(f=>f.bullets&&f.faq).map(f=>{var w;const A=`seo_ai.seo__${f.language}`,b=(w=a.metafields)==null?void 0:w.find(M=>M.key===A);let h={};if(b!=null&&b.value)try{h=JSON.parse(b.value)}catch(M){console.warn(`Failed to parse metafield for ${f.language}:`,M),h={}}console.log(`üîç [AI-ENHANCE] Language ${f.language} - existing metafield SEO:`,JSON.stringify(h,null,2)),console.log(`üîç [AI-ENHANCE] Language ${f.language} - AI bullets:`,f.bullets),console.log(`üîç [AI-ENHANCE] Language ${f.language} - AI FAQ:`,f.faq);const E={language:f.language,seo:{title:h.title||`Product ${a.productId}`,metaDescription:h.metaDescription||"Product description",slug:h.slug||`product-${a.productId}`,bodyHtml:h.bodyHtml||"<p>Product description</p>",bullets:f.bullets||[],faq:f.faq||[],imageAlt:h.imageAlt||[],jsonLd:h.jsonLd||{}}};return console.log(`üîç [AI-ENHANCE] Language ${f.language} - final seo result:`,JSON.stringify(E.seo,null,2)),E}),options:{updateBullets:!0,updateFaq:!0}};console.log(`üîç [AI-ENHANCE] Applying data for product ${a.productId}:`,z),console.log("üîç [AI-ENHANCE] First result SEO object:",JSON.stringify((S=z.results[0])==null?void 0:S.seo,null,2));const m=await p("/api/seo/apply-multi",{method:"POST",shop:i,body:z});console.log(`üîç [AI-ENHANCE] Apply result for product ${a.productId}:`,m),d.successful++}else console.log(`üîç [AI-ENHANCE] No valid results for product ${a.productId}:`,y),d.failed++}catch(g){console.error("Enhancement error:",g),d.failed++}se(g=>({...g,current:l+1}))}se(l=>({...l,processing:!1,results:d})),j(`AI enhancement complete! ${d.successful} products enhanced.`)},c=()=>{ve(!1),se({processing:!1,current:0,total:0,currentItem:"",results:null}),L.results&&L.results.successful>0&&R(1,!1,null)};return!L.processing&&!L.results?e.jsx(x,{open:Ie,title:"AI Enhanced add-ons for AI Search",onClose:c,primaryAction:{content:"Start AI Enhancement",onAction:o},secondaryActions:[{content:"Cancel",onAction:c}],children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["AI enhancement will improve bullets and FAQ for ",s.length," products."]}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI enhancement is only available for Growth Extra and Enterprise plans."})]})})}):L.processing?e.jsx(x,{open:Ie,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",L.currentItem]}),e.jsx(He,{progress:L.current/L.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[L.current," of ",L.total," products (",Math.round(L.current/L.total*100),"%)"]})]})})}):L.results!==null?e.jsx(x,{open:Ie,title:"AI Enhancement Results",onClose:c,primaryAction:{content:"Done",onAction:c},children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsxs(I,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:L.results.successful})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:L.results.failed})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:L.results.skipped})]})]}),L.results.skippedDueToPlan>0&&e.jsx(u,{paddingBlockStart:"300",children:e.jsx(r,{variant:"bodySm",tone:"subdued",children:"AI enhancement is only available for Growth Extra and Enterprise plans."})})]})})}):null},ht=async()=>{if(!W.length){j("Please select at least one language");return}ue(!1),q(!0),K({current:0,total:0,percent:0}),X([]),Ne({});try{let t=[];T?t=(await p(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:t=C.filter(l=>v.includes(l._id));const s=t.length;K({current:0,total:s,percent:0});const o=5,c={};for(let l=0;l<t.length;l+=o){const g=t.slice(l,Math.min(l+o,t.length)).map(async m=>{var f;J(m.title||m.handle||"Product");try{const A=m.gid||Te(m.productId||m.id),b=((f=m.optimizationSummary)==null?void 0:f.optimizedLanguages)||[],h=W.filter(w=>!b.includes(w));if(h.length===0){c[m._id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const E=await p("/api/seo/generate-multi",{method:"POST",shop:i,body:{shop:i,productId:A,model:Ze,languages:h}});c[m._id]={success:!0,data:E,languages:h}}catch(A){c[m._id]={success:!1,error:A.message},X(b=>[...b,{product:m.title,error:A.message}])}});await Promise.all(g);const y=Math.min(l+o,t.length),z=Math.round(y/s*100);K({current:y,total:s,percent:z})}Ne(c),Ee(!0);const d=Object.keys(c).filter(l=>c[l].success&&!c[l].skipped).length,S=Object.keys(c).filter(l=>c[l].skipped).length;S>0?j(`Generated Optimization for AI Search for ${d} products (${S} already optimised)`):j(`Generated Optimization for AI Search for ${d} products`)}catch(t){j(`Error: ${t.message}`)}finally{q(!1),J("")}},mt=async()=>{var t,s,o,c;q(!0),K({current:0,total:0,percent:0});try{const d=Object.entries(Z).filter(([g,y])=>y.success&&!y.skipped),S=d.length;K({current:0,total:S,percent:0});for(let g=0;g<d.length;g++){const[y,z]=d[g],m=C.find(b=>b._id===y);if(!m)continue;J(m.title||"Product");try{const b=m.gid||Te(m.productId||m.id),h=await p("/api/seo/apply-multi",{method:"POST",shop:i,body:{shop:i,productId:b,results:z.data.results.filter(E=>E==null?void 0:E.seo).map(E=>({language:E.language,seo:E.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});h.appliedLanguages&&h.appliedLanguages.length>0&&(console.log(`[BULK-EDIT] Optimistic update for product ${y}, languages:`,h.appliedLanguages),_(E=>E.map(w=>{var M;if(w._id===y){const Ce=((M=w.optimizationSummary)==null?void 0:M.optimizedLanguages)||[],Et=[...new Set([...Ce,...h.appliedLanguages])];return{...w,optimizationSummary:{...w.optimizationSummary,optimizedLanguages:Et,optimized:!0,lastOptimized:new Date().toISOString()}}}return w})))}catch(b){X(h=>[...h,{product:m.title,error:`Apply failed: ${b.message}`}])}const f=g+1,A=Math.round(f/S*100);K({current:f,total:S,percent:A})}j("AI Search Optimisation applied successfully!"),Ee(!1),Q([]),oe(!1),console.log("[BULK-EDIT] Waiting for database propagation..."),await new Promise(g=>setTimeout(g,1e3)),console.log("[BULK-EDIT] Clearing products state before reload..."),_([]),console.log("[BULK-EDIT] Reloading products with cache bypass...");const l=new URLSearchParams({shop:i,page:1,limit:50,...U!=="all"&&{optimized:U},...H&&{search:H},...D&&{languageFilter:D},...$.length>0&&{tags:$.join(",")},sortBy:le,sortOrder:G,_t:Date.now()}),a=await p(`/api/products/list?${l}`,{shop:i,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log("[BULK-EDIT] Products reloaded, first product:",(t=a.products[0])==null?void 0:t.title),console.log("[BULK-EDIT] First product optimization summary:",(s=a.products[0])==null?void 0:s.optimizationSummary),_(a.products||[]),De(1),Se(((o=a.pagination)==null?void 0:o.hasNext)||!1),ze(((c=a.pagination)==null?void 0:c.total)||0)}catch(d){j(`Error applying AI Search Optimisation: ${d.message}`)}finally{q(!1),J("")}},ft=async()=>{var t,s;if(!N.length){j("Please select at least one language to delete");return}ee(!1),ge(!1),q(!0),K({current:0,total:0,percent:0}),X([]);try{let o=[];T?o=(await p(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:o=C.filter(l=>v.includes(l._id));const c=o.length;K({current:0,total:c,percent:0});let d=0,S=0;for(let l=0;l<o.length;l++){const a=o[l];J(a.title||a.handle||"Product");try{const z=a.gid||Te(a.productId||a.id),m=((t=a.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],f=N.filter(b=>m&&m.length>0&&m.includes(b));if(console.log("[BULK-DELETE] Product optimized languages:",m),console.log("[BULK-DELETE] Languages to delete:",f),f.length===0){S++;continue}const A=await p("/api/seo/delete-multi",{method:"POST",shop:i,body:{shop:i,productId:z,languages:f}});console.log("[BULK-DELETE] Delete response:",A),console.log("[BULK-DELETE] Deleted languages:",A.deletedLanguages),A.deletedLanguages&&A.deletedLanguages.length>0&&(console.log("[BULK-DELETE] Before optimistic update, product:",a),console.log("[BULK-DELETE] Current optimized languages:",(s=a.optimizationSummary)==null?void 0:s.optimizedLanguages),_(b=>b.map(h=>{var E;if(h._id===a._id){const w=((E=h.optimizationSummary)==null?void 0:E.optimizedLanguages)||[],M=w.filter(Ce=>!A.deletedLanguages.includes(Ce));return console.log("[BULK-DELETE] Updating product:",h._id),console.log("[BULK-DELETE] Languages before:",w),console.log("[BULK-DELETE] Languages after:",M),{...h,optimizationSummary:{...h.optimizationSummary,optimizedLanguages:M,optimized:M.length>0,lastOptimized:M.length>0?h.optimizationSummary.lastOptimized:null}}}return h})),console.log("[BULK-DELETE] State updated, checking first product:",C[0])),d++,A.deletedLanguages&&A.deletedLanguages.length>0&&await p("/api/products/verify-after-delete",{method:"POST",shop:i,body:{shop:i,productIds:[z],deletedLanguages:A.deletedLanguages}})}catch(z){X(m=>[...m,{product:a.title,error:z.message}])}const g=l+1,y=Math.round(g/c*100);K({current:g,total:c,percent:y})}Q([]),oe(!1),S>0?j(`Deleted Optimization for AI Search from ${d} products (${S} had no optimisation to delete)`):j(`Deleted Optimization for AI Search from ${d} products`),console.log("[BULK-DELETE] Operation successful!"),setTimeout(()=>{console.log("[BULK-DELETE] Triggering reload with timestamp");const l=Date.now();R(1,!1,l)},500)}catch(o){j(`Error: ${o.message}`)}finally{q(!1),J("")}},St=t=>{var S,l;const s=t,o=kt(s.productId||s.id),c=((S=s.optimizationSummary)==null?void 0:S.optimizedLanguages)||[];console.log(`[BULK-EDIT] Rendering product: "${s.title}"`),console.log("[BULK-EDIT] optimizationSummary:",s.optimizationSummary),console.log("[BULK-EDIT] optimizedLanguages:",c),console.log("[BULK-EDIT] availableLanguages:",P);const d=(l=s.images)!=null&&l[0]?e.jsx(Ge,{source:s.images[0].url||s.images[0].src||s.images[0],alt:s.title,size:"small"}):s.imageUrl?e.jsx(Ge,{source:s.imageUrl,alt:s.title,size:"small"}):e.jsx(u,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Dt,{id:s._id,url:"",media:d,accessibilityLabel:`View details for ${s.title}`,children:e.jsxs(I,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(u,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:s.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["ID: ",o]})]}),e.jsx(u,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(I,{gap:"100",children:(console.log(`[BULK-EDIT] Rendering badges for "${s.title}"`),console.log("[BULK-EDIT] availableLanguages.length:",P.length),console.log("[BULK-EDIT] availableLanguages:",P),console.log("[BULK-EDIT] optimizedLanguages:",c),P.length>0?(console.log("[BULK-EDIT] Using availableLanguages.map"),P.map(a=>{const g=c.includes(a);return console.log(`[BULK-EDIT] Language ${a}: optimized=${g}`),e.jsx(F,{tone:g?"success":"subdued",size:"small",children:a.toUpperCase()},a)})):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),c.map(a=>e.jsx(F,{tone:"success",size:"small",children:a.toUpperCase()},a))))})}),e.jsx(u,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(F,{tone:"success",children:"Active"})})]})})},xt=Ae&&e.jsx(x,{open:Ae,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:Ke?`Processing: ${Ke}`:"Preparing..."}),e.jsx(He,{progress:ce.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[ce.current," of ",ce.total," products (",ce.percent,"%)"]})]})})}),jt=e.jsx(x,{open:nt,title:"Select Languages",onClose:()=>{ue(!1),re([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:ht,disabled:W.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{ue(!1),re([])}}],children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",T?"all":v.length," selected products:"]}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(I,{gap:"200",wrap:!0,children:P.map(t=>e.jsx(we,{label:t.toUpperCase(),checked:W.includes(t),onChange:s=>{re(s?[...W,t]:W.filter(o=>o!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{re(W.length===P.length?[]:[...P])},children:W.length===P.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),yt=e.jsx(x,{open:st&&!Ae,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:mt,disabled:!Object.values(Z).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Ee(!1)}],children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsxs(I,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(Z).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(Z).filter(t=>t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(Z).filter(t=>!t.success).length})]})]}),de.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(vt,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(u,{maxHeight:"200px",overflowY:"scroll",children:[de.slice(0,10).map((t,s)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),de.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",de.length-10," more errors"]})]})]})]})})}),bt=e.jsx(x,{open:ot,title:"Delete Optimization for AI Search",onClose:()=>{ee(!1),te([])},primaryAction:{content:"Continue",onAction:()=>{ee(!1),ge(!0)},disabled:N.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{ee(!1),te([])}}],children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",T?"all":v.length," selected products:"]}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(I,{gap:"200",wrap:!0,children:P.map(t=>e.jsx(we,{label:t.toUpperCase(),checked:N.includes(t),onChange:s=>{te(s?[...N,t]:N.filter(o=>o!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{te(N.length===P.length?[]:[...P])},children:N.length===P.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Lt=e.jsx(x,{open:at,title:"Confirm Deletion",onClose:()=>{ge(!1)},primaryAction:{content:"Delete",onAction:ft,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>ge(!1)}],children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(u,{paddingBlock:"200",children:e.jsx(I,{gap:"100",children:N.map(t=>e.jsx(F,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",T?"ALL":v.length," selected products."]}),e.jsx(r,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Pe=async()=>{try{ne(!0),j("Syncing products from Shopify...");const t=await p("/api/products/sync",{method:"POST",shop:i});if(t.success)j(`‚úÖ Synced ${t.synced} products successfully!`),setTimeout(()=>{R(1,!1,Date.now())},1e3);else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),j(`‚ùå Sync failed: ${t.message}`)}finally{ne(!1)}},At=e.jsx(zt,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Oe(""),ae("all"),Y(""),ie([]),R(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Pe},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{children:e.jsxs(u,{padding:"400",children:[e.jsxs(O,{gap:"300",children:[e.jsxs(I,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(u,{minWidth:"400px",children:e.jsx(Pt,{label:"",placeholder:"Search by product ID, name, or details...",value:H,onChange:_e,prefix:e.jsx(Ct,{}),clearButton:!0,onClearButtonClick:()=>_e("")})}),e.jsx(u,{width:"320px",children:e.jsx(k,{primary:!0,onClick:ut,disabled:v.length===0&&!T,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(I,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(k,{onClick:Pe,disabled:V,size:"medium",children:"Sync Products"}),e.jsx(u,{width:"320px",children:e.jsxs(O,{gap:"200",align:"end",children:[v.length===0&&!T||!C.filter(o=>v.includes(o._id)).some(o=>{var c,d;return((d=(c=o.optimizationSummary)==null?void 0:c.optimizedLanguages)==null?void 0:d.length)>0})?null:e.jsx(k,{onClick:()=>ve(!0),disabled:v.length===0&&!T,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(k,{onClick:gt,disabled:v.length===0&&!T||!C.filter(o=>v.includes(o._id)).some(o=>{var c,d;return((d=(c=o.optimizationSummary)==null?void 0:c.optimizedLanguages)==null?void 0:d.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),xe>0&&e.jsx(u,{paddingBlockStart:"300",children:e.jsx(we,{label:`Select all ${xe} products in your store`,checked:T,onChange:dt})})]})}),e.jsx(u,{paddingBlockStart:"400",children:e.jsxs(Fe,{children:[e.jsxs(u,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(I,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(I,{gap:"200",wrap:!0,children:[e.jsx(me,{active:ke,activator:e.jsx(k,{disclosure:"down",onClick:()=>je(!ke),removeUnderline:!0,children:e.jsxs(I,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),U!=="all"&&e.jsx(u,{onClick:t=>{t.stopPropagation(),ae("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>je(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(fe,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[U],onChange:t=>{ae(t[0]),Y(""),je(!1)}})})}),e.jsx(me,{active:Be,activator:e.jsx(k,{disclosure:"down",onClick:()=>ye(!Be),removeUnderline:!0,children:e.jsxs(I,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),D&&e.jsx(u,{onClick:t=>{t.stopPropagation(),Y("")},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>ye(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(fe,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...P.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...P.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:D?[D]:[],onChange:t=>{Y(t[0]||""),ye(!1)}})})}),e.jsx(me,{active:Ue,activator:e.jsx(k,{disclosure:"down",onClick:()=>be(!Ue),removeUnderline:!0,children:e.jsxs(I,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),$.length>0&&e.jsx(u,{onClick:t=>{t.stopPropagation(),ie([])},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>be(!1),children:e.jsxs(u,{padding:"300",minWidth:"200px",children:[e.jsx(fe,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:Ye.map(t=>({label:t,value:t})),selected:$,onChange:t=>{ie(t)}}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(k,{size:"slim",onClick:()=>be(!1),children:"Apply"})})]})})]}),e.jsx(me,{active:Me,activator:e.jsx(k,{disclosure:"down",onClick:()=>Le(!Me),removeUnderline:!0,children:e.jsx(I,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:G==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Le(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(fe,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[G],onChange:t=>{Qe(t[0]),Le(!1)}})})})]}),(U!=="all"||D||$.length>0)&&e.jsx(u,{paddingBlockStart:"200",children:e.jsxs(I,{gap:"100",wrap:!0,children:[U!=="all"&&e.jsx(F,{onRemove:()=>ae("all"),children:U==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),D&&e.jsx(F,{onRemove:()=>Y(""),children:D.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),$.map(t=>e.jsxs(F,{onRemove:()=>ie(s=>s.filter(o=>o!==t)),children:["Tag: ",t]},t))]})})]}),e.jsx(wt,{resourceName:{singular:"product",plural:"products"},items:C,renderItem:St,selectedItems:v,onSelectionChange:ct,selectable:!0,loading:V,totalItemsCount:xe,emptyState:At,showHeader:!1}),Ve&&!V&&e.jsx(u,{padding:"400",textAlign:"center",children:e.jsx(k,{onClick:()=>R(Je+1,!0,null),children:"Load more"})})]})}),xt,jt,yt,bt,Lt,pt(),e.jsx(x,{open:it,onClose:()=>pe(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{pe(!1),Pe()}},secondaryActions:[{content:"Skip for now",onAction:()=>pe(!1)}],children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(r,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(x,{open:rt,onClose:()=>he(!1),title:"Upgrade Required",primaryAction:{content:"Upgrade Plan",onAction:()=>{he(!1),j("Please upgrade your plan to use AI Enhancement features")}},secondaryActions:[{content:"Cancel",onAction:()=>he(!1)}],children:e.jsx(x.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"AI enhancement is only available for Growth Extra and Enterprise plans."}),e.jsx(r,{variant:"bodyMd",children:"Please upgrade in order to use this feature!"})]})})}),We&&e.jsx(Tt,{content:We,onDismiss:()=>j("")})]})}export{Wt as default};
