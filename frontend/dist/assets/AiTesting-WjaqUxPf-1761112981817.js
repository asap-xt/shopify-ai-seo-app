import{j as e}from"./app-bridge-DrHDrSRA-1761112981817.js";import{r as l}from"./react-vendor-tAaa2TlE-1761112981817.js";import{m as se}from"./sessionFetch-CJepNHo3-1761112981817.js";import{C as q,a as g,e as i,d as j,T as s,I as a,B as o,f as te,g as c,D as S,j as ne,l as ae,M as m}from"./polaris-B-MkaDG5-1761112981817.js";const re=(M,u="")=>{try{return new URLSearchParams(window.location.search).get(M)||u}catch{return u}};function he({shop:M}){var O,L,N;const u=M||re("shop",""),[z,b]=l.useState(""),v=l.useMemo(()=>se(),[]),[F,K]=l.useState(null),[D,A]=l.useState(""),[U,G]=l.useState(!1),[x,Y]=l.useState(null),[P,H]=l.useState(""),[Q,C]=l.useState(!1),[V,R]=l.useState(!1),[d,E]=l.useState(null),[X,W]=l.useState(!1),[p,ie]=l.useState(null),[t,$]=l.useState({}),[k,J]=l.useState(!1),[Z,B]=l.useState(0);l.useEffect(()=>{u&&_()},[u,v]);const _=async()=>{var r,h;try{const f=await v("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
        query PlansMe($shop:String!) {
          plansMe(shop:$shop) {
            shop
            plan
            planKey
          }
        }
      `,variables:{shop:u}})});console.log("[AI-TESTING] Plan data:",f),K((h=(r=f==null?void 0:f.data)==null?void 0:r.plansMe)==null?void 0:h.plan)}catch(n){console.error("[AI-TESTING] Error loading plan:",n)}},y=r=>{if(!F)return!1;const n=["Starter","Professional","Growth","Growth Extra","Enterprise"].indexOf(F);switch(r){case"productsJson":return n>=0;case"storeMetadata":return n>=1;case"welcomePage":case"collectionsJson":return n>=2;case"aiSitemap":return n>=3;case"schemaData":return n>=4;case"meta":return n>=0;case"claude":return n>=0;case"gemini":return n>=1;case"chatgpt":return n>=2;case"perplexity":return n>=3;case"deepseek":return n>=4;default:return!1}},w=r=>{switch(r){case"storeMetadata":return"Professional";case"welcomePage":case"collectionsJson":return"Growth";case"aiSitemap":return"Growth Extra";case"schemaData":return"Enterprise";case"gemini":return"Professional";case"chatgpt":return"Growth";case"perplexity":return"Growth Extra";case"deepseek":return"Enterprise";default:return"Professional"}},I=(r,h)=>{Y({name:r,url:h}),G(!0)},ee=async()=>{J(!0),B(0),$({});try{console.log("[AI-TESTING] Starting tests for shop:",u);const r=await v("/api/ai-testing/run-tests",{method:"POST",body:{shop:u}});console.log("[AI-TESTING] Test results:",r),r.results?($(r.results),B(100),b("Testing completed!")):b("Testing failed. Please try again.")}catch(r){console.error("[AI-TESTING] Error running tests:",r),b("Failed to run tests. Please try again.")}finally{J(!1)}},T=async(r,h=null)=>{try{A("Generating AI response...");let n=`/api/ai-discovery/simulate?shop=${u}&type=${r}`;h&&(n+=`&question=${encodeURIComponent(h)}`);const f=await v(n,{method:"GET"});A(f.response||"No response generated")}catch(n){if(console.error("[AI-TESTING] Simulation error:",n),console.log("[AI-TESTING] Error status:",n.status),console.log("[AI-TESTING] Error requiresUpgrade:",n.requiresUpgrade),console.log("[AI-TESTING] Error requiresPurchase:",n.requiresPurchase),n.status===402){if(n.requiresUpgrade){E(n),C(!0),A("");return}if(n.requiresPurchase){E(n),R(!0),A("");return}}A("Error generating response. Please try again."),b("Failed to simulate AI response")}};return e.jsxs(e.Fragment,{children:[e.jsx(q,{children:e.jsx(g,{padding:"400",children:e.jsxs(i,{gap:"400",children:[e.jsx(j,{tone:"info",children:e.jsx(s,{children:"Test how AI models discover and understand your store content. Check if your structured data and AI Discovery features are working correctly."})}),e.jsx(q,{children:e.jsx(g,{padding:"300",children:e.jsxs(i,{gap:"400",children:[e.jsxs(a,{align:"space-between",blockAlign:"center",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"AI Discovery Endpoints"}),e.jsx(o,{onClick:ee,loading:k,disabled:k,children:k?"Testing...":"Run All Tests"})]}),e.jsx(s,{variant:"bodyMd",tone:"subdued",children:"Automated tests to verify that your AI Discovery endpoints are working correctly."}),k&&e.jsx(g,{children:e.jsxs(i,{gap:"200",children:[e.jsx(s,{variant:"bodySm",children:"Testing endpoints..."}),e.jsx(te,{progress:Z,size:"small"})]})}),Object.keys(t).length>0&&e.jsxs(i,{gap:"300",children:[t.productsJson&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(i,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Products JSON Feed"}),t.productsJson.status==="success"&&e.jsx(c,{tone:"success",children:"âœ“ OK"}),t.productsJson.status==="error"&&e.jsx(c,{tone:"critical",children:"âœ— Failed"}),t.productsJson.status==="locked"&&e.jsx(c,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[t.productsJson.message,t.productsJson.dataSize&&` (${(t.productsJson.dataSize/1024).toFixed(1)} KB)`]})]})}),e.jsx(S,{})]}),t.storeMetadata&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(i,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Store Metadata"}),t.storeMetadata.status==="success"&&e.jsx(c,{tone:"success",children:"âœ“ OK"}),t.storeMetadata.status==="error"&&e.jsx(c,{tone:"critical",children:"âœ— Failed"}),t.storeMetadata.status==="locked"&&e.jsx(c,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[t.storeMetadata.message,t.storeMetadata.dataSize&&` (${(t.storeMetadata.dataSize/1024).toFixed(1)} KB)`]})]})}),e.jsx(S,{})]}),t.welcomePage&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(i,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"AI Welcome Page"}),t.welcomePage.status==="success"&&e.jsx(c,{tone:"success",children:"âœ“ OK"}),t.welcomePage.status==="error"&&e.jsx(c,{tone:"critical",children:"âœ— Failed"}),t.welcomePage.status==="locked"&&e.jsx(c,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[t.welcomePage.message,t.welcomePage.dataSize&&` (${(t.welcomePage.dataSize/1024).toFixed(1)} KB)`]})]})}),e.jsx(S,{})]}),t.collectionsJson&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(i,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Collections JSON Feed"}),t.collectionsJson.status==="success"&&e.jsx(c,{tone:"success",children:"âœ“ OK"}),t.collectionsJson.status==="error"&&e.jsx(c,{tone:"critical",children:"âœ— Failed"}),t.collectionsJson.status==="locked"&&e.jsx(c,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[t.collectionsJson.message,t.collectionsJson.dataSize&&` (${(t.collectionsJson.dataSize/1024).toFixed(1)} KB)`]})]})}),e.jsx(S,{})]}),t.aiSitemap&&e.jsxs(e.Fragment,{children:[e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(i,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"AI-Enhanced Sitemap"}),t.aiSitemap.status==="success"&&e.jsx(c,{tone:"success",children:"âœ“ OK"}),t.aiSitemap.status==="error"&&e.jsx(c,{tone:"critical",children:"âœ— Failed"}),t.aiSitemap.status==="locked"&&e.jsx(c,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[t.aiSitemap.message,t.aiSitemap.dataSize&&` (${(t.aiSitemap.dataSize/1024).toFixed(1)} KB)`]})]})}),e.jsx(S,{})]}),t.schemaData&&e.jsx(a,{align:"space-between",blockAlign:"center",children:e.jsxs(i,{gap:"100",children:[e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Advanced Schema Data"}),t.schemaData.status==="success"&&e.jsx(c,{tone:"success",children:"âœ“ OK"}),t.schemaData.status==="error"&&e.jsx(c,{tone:"critical",children:"âœ— Failed"}),t.schemaData.status==="locked"&&e.jsx(c,{children:"ðŸ”’ Locked"})]}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[t.schemaData.message,t.schemaData.dataSize&&` (${(t.schemaData.dataSize/1024).toFixed(1)} KB)`]})]})})]}),Object.keys(t).length===0&&!k&&e.jsx(j,{tone:"info",children:e.jsx(s,{children:'Click "Run All Tests" to check if your AI Discovery endpoints are configured correctly.'})}),e.jsx(S,{}),e.jsxs(i,{gap:"200",children:[e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Meta AI Search"}),y("meta")?e.jsx(o,{onClick:()=>I("Meta AI","https://www.meta.ai/"),size:"slim",children:"Test"}):e.jsxs(o,{disabled:!0,size:"slim",children:[w("meta"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Claude AI Search"}),y("claude")?e.jsx(o,{onClick:()=>I("Claude AI","https://claude.ai/"),size:"slim",children:"Test"}):e.jsxs(o,{disabled:!0,size:"slim",children:[w("claude"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Gemini AI Search"}),y("gemini")?e.jsx(o,{onClick:()=>I("Gemini AI","https://gemini.google.com/"),size:"slim",children:"Test"}):e.jsxs(o,{disabled:!0,size:"slim",children:[w("gemini"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"ChatGPT Web Search"}),y("chatgpt")?e.jsx(o,{url:`https://chat.openai.com/?q=What+products+does+${u}+sell%3F+Tell+me+about+this+business+and+what+they+offer`,external:!0,size:"slim",children:"Test"}):e.jsxs(o,{disabled:!0,size:"slim",children:[w("chatgpt"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Perplexity AI Search"}),y("perplexity")?e.jsx(o,{url:`https://www.perplexity.ai/search?q=What+products+does+${u}+sell%3F+Tell+me+about+this+business+and+what+they+offer`,external:!0,size:"slim",children:"Test"}):e.jsxs(o,{disabled:!0,size:"slim",children:[w("perplexity"),"+ Required"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"DeepSeek AI Search"}),y("deepseek")?e.jsx(o,{onClick:()=>I("DeepSeek AI","https://chat.deepseek.com/"),size:"slim",children:"Test"}):e.jsxs(o,{disabled:!0,size:"slim",children:[w("deepseek"),"+ Required"]})]})]}),e.jsx(j,{tone:"info",children:e.jsxs(s,{children:[e.jsx("strong",{children:"How to test with AI bots:"}),e.jsx("br",{}),"â€¢ ",e.jsx("strong",{children:"Perplexity & ChatGPT:"}),' Click "Test" - they support URL parameters',e.jsx("br",{}),"â€¢ ",e.jsx("strong",{children:"Meta AI, Claude, Gemini, DeepSeek:"}),' Click "Test" to open a modal with the prompt to copy']})})]})})}),e.jsx(q,{children:e.jsx(g,{padding:"300",children:e.jsxs(i,{gap:"300",children:[e.jsx(s,{as:"h4",variant:"headingSm",children:"AI Search Simulation"}),e.jsx(s,{variant:"bodyMd",tone:"subdued",children:"Test how AI bots would respond to questions about your store based on your structured data."}),e.jsx(j,{tone:"info",children:e.jsxs(i,{gap:"100",children:[e.jsx(s,{variant:"bodySm",fontWeight:"semibold",children:"Simulation Details:"}),e.jsxs(s,{variant:"bodySm",children:["â€¢ ",e.jsx("strong",{children:"Data Source:"})," Your store's products, collections, and metadata"]}),e.jsxs(s,{variant:"bodySm",children:["â€¢ ",e.jsx("strong",{children:"Response Style:"})," Concise (2-3 sentences), natural language"]}),e.jsxs(s,{variant:"bodySm",children:["â€¢ ",e.jsx("strong",{children:"Best For:"})," General store info, products, categories, contact details"]}),e.jsxs(s,{variant:"bodySm",children:["â€¢ ",e.jsx("strong",{children:"Limitations:"})," May not have real-time data (current stock, active promotions, exact shipping times)"]})]})}),e.jsxs(i,{gap:"200",children:[e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"What products does this store sell?"}),e.jsx(o,{onClick:()=>T("products"),size:"slim",children:"Simulate Response"})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"Tell me about this business"}),e.jsx(o,{onClick:()=>T("business"),size:"slim",children:"Simulate Response"})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"What categories does this store have?"}),e.jsx(o,{onClick:()=>T("categories"),size:"slim",children:"Simulate Response"})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{children:"What is this store's contact information?"}),e.jsx(o,{onClick:()=>T("contact"),size:"slim",children:"Simulate Response"})]})]}),e.jsx(S,{}),e.jsxs(i,{gap:"200",children:[e.jsx(s,{variant:"headingSm",children:"Ask Your Own Question"}),e.jsx(ne,{label:"",value:P,onChange:H,placeholder:"e.g., What are your return policies? Do you ship internationally?",autoComplete:"off",connectedRight:e.jsx(o,{onClick:()=>{P.trim()?T("custom",P):b("Please enter a question")},disabled:!P.trim(),children:"Ask AI"})})]}),D&&e.jsxs(g,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"AI Bot Response:"}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(s,{variant:"bodyMd",children:D})})]})]})})})]})})}),z&&e.jsx(ae,{content:z,onDismiss:()=>b("")}),e.jsx(m,{open:U,onClose:()=>G(!1),title:`Test with ${x==null?void 0:x.name}`,primaryAction:{content:"Open AI Bot",url:x==null?void 0:x.url,external:!0},secondaryActions:[{content:"Copy Prompt",onAction:()=>{navigator.clipboard.writeText(`What products does ${u} sell? Tell me about this business and what they offer.`),b("Prompt copied to clipboard!")}}],children:e.jsx(m.Section,{children:e.jsxs(i,{gap:"300",children:[e.jsx(s,{variant:"bodyMd",children:'1. Click "Copy Prompt" (left button)'}),e.jsxs(s,{variant:"bodyMd",children:['2. Click "Open AI Bot" (right button) to visit ',x==null?void 0:x.name]}),e.jsx(s,{variant:"bodyMd",children:"3. Paste the prompt and send"}),e.jsxs(g,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:[e.jsx(s,{variant:"bodyMd",fontWeight:"semibold",children:"Prompt to test:"}),e.jsx(g,{paddingBlockStart:"200",children:e.jsxs(s,{variant:"bodyMd",as:"p",children:["What products does ",u," sell? Tell me about this business and what they offer."]})})]}),e.jsx(j,{tone:"info",children:e.jsx(s,{children:"The AI bot will search the web and use your store's structured data to answer."})})]})})}),e.jsx(m,{open:X,onClose:()=>W(!1),title:"Upgrade Required",primaryAction:{content:"View Plans",onAction:()=>{const r=new URLSearchParams(window.location.search),h=r.toString()?`?${r.toString()}`:"";window.location.href=`/billing${h}`}},secondaryActions:[{content:"Cancel",onAction:()=>W(!1)}],children:e.jsx(m.Section,{children:e.jsxs(i,{gap:"300",children:[e.jsxs(s,{variant:"bodyMd",children:[e.jsx("strong",{children:p==null?void 0:p.endpoint})," requires ",e.jsx("strong",{children:p==null?void 0:p.requiredPlan})," plan or higher."]}),e.jsxs(s,{variant:"bodyMd",tone:"subdued",children:["Your current plan: ",e.jsx("strong",{children:p==null?void 0:p.currentPlan})]}),e.jsx(j,{tone:"info",children:e.jsx(s,{children:"Upgrade to access this advanced AI Discovery feature."})})]})})}),e.jsx(m,{open:Q,onClose:()=>C(!1),title:"Upgrade Required",primaryAction:{content:"View Plans",onAction:()=>{const r=new URLSearchParams(window.location.search),h=r.toString()?`?${r.toString()}`:"";window.location.href=`/billing${h}`}},secondaryActions:[{content:"Cancel",onAction:()=>C(!1)}],children:e.jsx(m.Section,{children:e.jsxs(i,{gap:"300",children:[e.jsxs(s,{variant:"bodyMd",children:["AI Testing requires ",e.jsx("strong",{children:(d==null?void 0:d.minimumPlan)||"Professional"})," plan or higher."]}),e.jsxs(s,{variant:"bodyMd",tone:"subdued",children:["Your current plan: ",e.jsx("strong",{children:(d==null?void 0:d.currentPlan)||"Starter"})]}),e.jsx(j,{tone:"info",children:e.jsx(s,{children:"Upgrade to test AI responses with real store data."})})]})})}),e.jsx(m,{open:V,onClose:()=>R(!1),title:"Insufficient Tokens",primaryAction:{content:"Buy Tokens",onAction:()=>{const r=new URLSearchParams(window.location.search),h=r.toString()?`?${r.toString()}`:"";window.location.href=`/billing${h}`}},secondaryActions:[{content:"Cancel",onAction:()=>R(!1)}],children:e.jsx(m.Section,{children:e.jsxs(i,{gap:"300",children:[e.jsx(s,{variant:"bodyMd",children:"You need more tokens to use AI Testing."}),e.jsx(g,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:e.jsxs(i,{gap:"200",children:[e.jsxs(a,{align:"space-between",children:[e.jsx(s,{variant:"bodySm",children:"Required:"}),e.jsxs(s,{variant:"bodySm",fontWeight:"semibold",children:[((O=d==null?void 0:d.tokensRequired)==null?void 0:O.toLocaleString())||0," tokens"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{variant:"bodySm",children:"Available:"}),e.jsxs(s,{variant:"bodySm",children:[((L=d==null?void 0:d.tokensAvailable)==null?void 0:L.toLocaleString())||0," tokens"]})]}),e.jsxs(a,{align:"space-between",children:[e.jsx(s,{variant:"bodySm",children:"Needed:"}),e.jsxs(s,{variant:"bodySm",fontWeight:"semibold",tone:"critical",children:[((N=d==null?void 0:d.tokensNeeded)==null?void 0:N.toLocaleString())||0," tokens"]})]})]})}),e.jsx(j,{tone:"info",children:e.jsx(s,{children:"Purchase tokens to continue using AI features. Tokens never expire."})})]})})})]})}export{he as default};
