import{r as e,j as n}from"./react-vendor-BLtYaay5.js";import{m as s}from"./sessionFetch-D9zn2iVF.js";import{g as a}from"./usePlanHierarchy-CpsbOjPs.js";import{T as t,I as i}from"./TrialActivationModal-CmZNJenq.js";import{T as o}from"./TokenPurchaseModal-ChVK648j.js";import{U as r}from"./UpgradeModal-Bz-hPgmd.js";import{e as c}from"./tokenEstimates-Dgf19ZiR.js";import{C as d,B as l,a as h,i as u,T as p,d as m,v as g,I as j,f as x,b as S,w as f,e as y,x as v,g as b,n as w,M as A}from"./polaris-BgbORwUH.js";import"./app-bridge-DUY42B6P.js";import"./vendor-L4_WdQez.js";import"./index-SIhijMOo.js";const P=(e,n="")=>{try{return new URLSearchParams(window.location.search).get(e)||n}catch{return n}},_=e=>(e||"starter").toLowerCase().replace(/\s+/g,"_");function I({shop:I}){var O,k,T,C,E;const D=I||P("shop","");P("shop","");const[z,$]=e.useState(0),[q,N]=e.useState(!0),[M,R]=e.useState({organization:null,website:null,products:[]}),[L,U]=e.useState(""),B=e.useMemo(()=>s(),[]),[G,F]=e.useState(""),[J,Y]=e.useState(null),[W,H]=e.useState(null),[Z,Q]=e.useState(null),[V,X]=e.useState(0),[K,ee]=e.useState({inProgress:!1,status:"idle",message:null,position:null,estimatedTime:null,generatedAt:null,schemaCount:0}),[ne,se]=e.useState(null),[ae,te]=e.useState(!1),[ie,oe]=e.useState(!1),[re,ce]=e.useState({}),[de,le]=e.useState(!1),[he,ue]=e.useState(!1),[pe,me]=e.useState(!1),[ge,je]=e.useState(null),[xe,Se]=e.useState(!1),[fe,ye]=e.useState(null),[ve,be]=e.useState(!1),[we,Ae]=e.useState(!1),[Pe,_e]=e.useState(!1),[Ie,Oe]=e.useState(!1),[ke,Te]=e.useState(null),[Ce,Ee]=e.useState(!1),[De,ze]=e.useState({material:!1,color:!1,size:!1,weight:!1,dimensions:!1,category:!1,audience:!1,reviews:!1,ratings:!0,enhancedDescription:!1,organization:!1}),[$e,qe]=e.useState(!1);e.useEffect(()=>{D&&(Le(),Ne(),Me())},[D,B]),e.useEffect(()=>()=>{ne&&clearInterval(ne)},[ne]);const Ne=async()=>{try{const n=await B(`/api/ai-discovery/settings?shop=${D}`);Y(null==n?void 0:n.plan),H(_(null==n?void 0:n.plan)),X((null==n?void 0:n.productCount)||0),(null==n?void 0:n.richAttributes)&&ze(e=>({...e,...n.richAttributes}));try{const e=await B(`/api/billing/info?shop=${D}`);(null==e?void 0:e.subscription)&&Q(e.subscription)}catch(e){}}catch(n){}},Me=e.useCallback(async()=>{var e,n,s,a,t,i,o,r,c,d;try{const l=await B(`/api/schema/status?shop=${D}`);return ee({inProgress:l.inProgress||!1,status:l.status||"idle",message:l.message||null,position:(null==(e=l.queue)?void 0:e.position)||null,estimatedTime:(null==(n=l.queue)?void 0:n.estimatedTime)||null,generatedAt:(null==(s=l.schema)?void 0:s.generatedAt)||null,schemaCount:(null==(a=l.schema)?void 0:a.schemaCount)||0,progress:(null==(t=l.shopStatus)?void 0:t.progress)||null,totalProducts:(null==(i=l.shopStatus)?void 0:i.totalProducts)||0,processedProducts:(null==(o=l.shopStatus)?void 0:o.processedProducts)||0,successfulProducts:(null==(r=l.shopStatus)?void 0:r.successfulProducts)||0,failedProducts:(null==(c=l.shopStatus)?void 0:c.failedProducts)||0}),"completed"!==l.status||l.inProgress||(ne&&(clearInterval(ne),se(null)),K.inProgress&&U(`Advanced Schema Data generated! (${(null==(d=l.schema)?void 0:d.schemaCount)||0} schemas)`)),"failed"===l.status&&(ne&&(clearInterval(ne),se(null)),"NO_OPTIMIZED_PRODUCTS"===l.message?(ye("NO_OPTIMIZED_PRODUCTS"),Se(!0)):"ONLY_BASIC_SEO"===l.message&&(ye("ONLY_BASIC_SEO"),Se(!0))),l}catch(l){}},[D,B,ne,K.inProgress]),Re=e.useCallback(()=>{ne&&clearInterval(ne),Me();const e=setInterval(()=>{Me()},1e4);se(e)},[Me,ne]),Le=async()=>{N(!0);try{const e=`/api/schema/preview?shop=${encodeURIComponent(D)}`,n=await B(e,{headers:{"X-Shop":D}});n.ok?(R(n.schemas),Ue(n.schemas)):U(`Error: ${n.error}`)}catch(e){U(`Failed to load schemas: ${e.message}`)}finally{N(!1)}},Ue=e=>{const n=[];e.organization&&n.push(e.organization),e.website&&n.push(e.website);const s=`<script type="application/ld+json">\n${JSON.stringify(n,null,2)}\n<\/script>`;F(s)};return q?n.jsx(d,{children:n.jsx(l,{padding:"400",children:n.jsxs(h,{gap:"400",align:"center",children:[n.jsx(u,{}),n.jsx(p,{children:"Loading schema data..."})]})})}):n.jsxs(n.Fragment,{children:[n.jsx(d,{children:n.jsx(l,{padding:"400",children:n.jsxs(h,{gap:"400",children:[n.jsx(p,{as:"h3",variant:"headingMd",children:"Structured Schema Data"}),n.jsx(m,{tone:"info",children:n.jsx(p,{children:"Structured data helps AI models understand your store content better, improving your visibility and search results."})}),n.jsxs(g,{tabs:[{id:"generate",content:"Generate Schemas",accessibilityLabel:"Generate Schemas"},{id:"installation",content:"Theme Installation",accessibilityLabel:"Theme Installation"}],selected:z,onSelect:$,children:[0===z&&n.jsx(l,{paddingBlockStart:"400",children:n.jsxs(h,{gap:"400",children:[n.jsx(d,{children:n.jsx(l,{padding:"300",children:n.jsxs(h,{gap:"300",children:[n.jsxs(j,{align:"space-between",children:[n.jsx(p,{as:"h4",variant:"headingSm",children:"Organization Schema"}),n.jsx(x,{tone:M.organization?"success":"warning",children:M.organization?"Active":"Not configured"})]}),!M.organization&&n.jsx(p,{as:"p",tone:"subdued",children:"Configure organization details in Store Metadata to enable this schema."})]})})}),n.jsx(d,{children:n.jsx(l,{padding:"300",children:n.jsxs(h,{gap:"300",children:[n.jsxs(j,{align:"space-between",children:[n.jsx(p,{as:"h4",variant:"headingSm",children:"WebSite Schema"}),n.jsx(x,{tone:M.website?"success":"warning",children:M.website?"Active":"Not configured"})]}),!M.website&&n.jsx(p,{as:"p",tone:"subdued",children:"Website schema is automatically generated from your store information."})]})})}),n.jsx(d,{children:n.jsx(l,{padding:"300",children:n.jsxs(h,{gap:"300",children:[n.jsxs(j,{align:"space-between",children:[n.jsx(p,{as:"h4",variant:"headingSm",children:"Product Schemas"}),n.jsx(x,{tone:"success",children:"Auto-generated"})]}),n.jsxs(p,{tone:"subdued",children:["Product schemas are automatically generated from your AI Optimisation data when pages load.",M.products.length>0&&` ${M.products.length} products have SEO data.`]}),n.jsx(l,{paddingBlockStart:"200",children:n.jsx(S,{onClick:async()=>{N(!0);try{const e=`/api/schema/generate?shop=${encodeURIComponent(D)}`,n=await B(e,{method:"POST",headers:{"X-Shop":D},body:{shop:D}});n.ok?(U("Schemas regenerated successfully!"),Le()):U(`Error: ${n.error}`)}catch(e){U(`Failed to regenerate: ${e.message}`)}finally{N(!1)}},loading:q,children:"Regenerate Basic Schemas"})})]})})})]})}),1===z&&n.jsx(l,{paddingBlockStart:"400",children:n.jsxs(h,{gap:"400",children:[n.jsx(m,{tone:"info",children:n.jsxs(h,{gap:"300",children:[n.jsx(p,{as:"h4",variant:"headingSm",children:"Theme Installation"}),n.jsx(p,{children:"Install the schema code to display structured data on your store pages."})]})}),n.jsx(d,{children:n.jsx(l,{padding:"400",children:n.jsxs(h,{gap:"400",children:[n.jsx(p,{as:"h4",variant:"headingSm",children:"Installation Options"}),(()=>{const e=new URLSearchParams(window.location.search).get("testPlan"),s=a(e||W)>=4;return n.jsxs(h,{gap:"300",children:[n.jsxs(j,{gap:"300",wrap:!1,children:[s?n.jsx(S,{variant:"primary",size:"large",loading:ve,onClick:()=>Ae(!0),children:"Auto-Install to Theme"}):n.jsx(S,{size:"large",onClick:()=>_e(!0),children:"Auto-Install (Growth Plus+)"}),n.jsx(S,{size:"large",variant:s?"secondary":"primary",onClick:()=>{Ee(!Ce),Ce||setTimeout(()=>{var e;null==(e=document.getElementById("manual-install-section"))||e.scrollIntoView({behavior:"smooth"})},100)},children:Ce?"Hide Manual Instructions":"View Manual Instructions"})]}),n.jsx(p,{variant:"bodySm",tone:"subdued",children:s?"Auto-Install creates snippets/ai-schema.liquid and adds one line to theme.liquid.":"Upgrade to Growth Plus for automatic installation, or follow manual instructions below."})]})})()]})})}),Ce&&n.jsxs(n.Fragment,{children:[n.jsx("div",{id:"manual-install-section",children:n.jsx(m,{tone:"info",children:n.jsxs(h,{gap:"300",children:[n.jsx(p,{as:"h4",variant:"headingSm",children:"Manual Installation Steps"}),n.jsxs(f,{type:"number",children:[n.jsx(f.Item,{children:"Go to your Shopify Admin → Online Store → Themes"}),n.jsx(f.Item,{children:'Click "Actions" → "Edit code" on your current theme'}),n.jsxs(f.Item,{children:["Open the file: ",n.jsx("code",{children:"layout/theme.liquid"})]}),n.jsxs(f.Item,{children:["Add this code before the closing ",n.jsx("code",{children:"</head>"})," tag:"]})]})]})})}),n.jsx(d,{children:n.jsx(l,{padding:"300",children:n.jsxs(h,{gap:"300",children:[n.jsx(p,{as:"h4",variant:"headingSm",children:"Code to Install"}),n.jsx(l,{background:"bg-surface-secondary",padding:"200",borderRadius:"200",children:n.jsx("pre",{style:{fontSize:"12px",overflow:"auto",whiteSpace:"pre-wrap"},children:'{%- comment -%} Advanced Schema Data - Auto-generated by indexAIze - AI Discovery & SEO {%- endcomment -%}\n\n{%- comment -%} AI Discovery Links - helps AI crawlers find structured data endpoints {%- endcomment -%}\n{%- if shop.metafields.ai_discovery.settings -%}\n  {%- assign ai_settings = shop.metafields.ai_discovery.settings.value -%}\n  {%- if ai_settings.features.discoveryLinks -%}\n    {%- if ai_settings.features.llmsTxt -%}\n      <link rel="alternate" type="text/plain" href="/apps/indexaize/llms.txt" title="LLMs.txt - AI Discovery">\n    {%- endif -%}\n    {%- if ai_settings.features.productsJson -%}\n      <link rel="alternate" type="application/json" href="/apps/indexaize/ai/products.json" title="AI Product Feed">\n    {%- endif -%}\n    {%- if ai_settings.features.storeMetadata -%}\n      <link rel="alternate" type="application/json" href="/apps/indexaize/ai/store-metadata.json" title="Store Metadata for AI">\n    {%- endif -%}\n    {%- if ai_settings.features.collectionsJson -%}\n      <link rel="alternate" type="application/json" href="/apps/indexaize/ai/collections-feed.json" title="AI Collections Feed">\n    {%- endif -%}\n  {%- endif -%}\n{%- endif -%}\n\n{%- comment -%} Organization & WebSite Schema (site-wide) {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.shop_schemas -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.shop_schemas.value }}\n  <\/script>\n{%- endif -%}\n\n{%- comment -%} Product Schema (product pages only) {%- endcomment -%}\n{%- if product -%}\n  {%- comment -%} Try Advanced Schema first (requires tokens/Enterprise plan) {%- endcomment -%}\n  {%- assign schema_key = \'schemas_\' | append: request.locale.iso_code -%}\n  {%- assign schemas_json = product.metafields.advanced_schema[schema_key].value -%}\n  {%- if schemas_json -%}\n    <script type="application/ld+json">\n{{ schemas_json }}\n    <\/script>\n  {%- else -%}\n    {%- comment -%} Fallback to basic SEO JSON-LD (available for all plans) {%- endcomment -%}\n    {%- assign seo_key = \'seo__\' | append: request.locale.iso_code -%}\n    {%- assign seo_data_json = product.metafields.seo_ai[seo_key].value | default: product.metafields.seo_ai.seo__en.value -%}\n    {%- if seo_data_json -%}\n      <script type="application/ld+json" id="seo-basic-jsonld-{{ product.id }}">\n      <\/script>\n      <script>\n        (function() {\n          try {\n            var seoData = JSON.parse({{ seo_data_json | json }});\n            if (seoData && seoData.jsonLd) {\n              var scriptTag = document.getElementById(\'seo-basic-jsonld-{{ product.id }}\');\n              if (scriptTag) {\n                scriptTag.textContent = JSON.stringify(seoData.jsonLd);\n              }\n            }\n          } catch(e) {\n            console.error(\'Failed to parse SEO JSON-LD:\', e);\n          }\n        })();\n      <\/script>\n    {%- endif -%}\n  {%- endif -%}\n{%- endif -%}\n\n{%- comment -%} Site-wide FAQ Schema {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.site_faq -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.site_faq.value }}\n  <\/script>\n{%- endif -%}'})}),n.jsx(j,{align:"end",children:n.jsx(S,{onClick:()=>{navigator.clipboard.writeText('{%- comment -%} Advanced Schema Data - Auto-generated by indexAIze - AI Discovery & SEO {%- endcomment -%}\n\n{%- comment -%} Organization & WebSite Schema (site-wide) {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.shop_schemas -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.shop_schemas.value }}\n  <\/script>\n{%- endif -%}\n\n{%- comment -%} Product Schema (product pages only) {%- endcomment -%}\n{%- if product -%}\n  {%- comment -%} Try Advanced Schema first (requires tokens/Enterprise plan) {%- endcomment -%}\n  {%- assign schema_key = \'schemas_\' | append: request.locale.iso_code -%}\n  {%- assign schemas_json = product.metafields.advanced_schema[schema_key].value -%}\n  {%- if schemas_json -%}\n    <script type="application/ld+json">\n{{ schemas_json }}\n    <\/script>\n  {%- else -%}\n    {%- comment -%} Fallback to basic SEO JSON-LD (available for all plans) {%- endcomment -%}\n    {%- assign seo_key = \'seo__\' | append: request.locale.iso_code -%}\n    {%- assign seo_data_json = product.metafields.seo_ai[seo_key].value | default: product.metafields.seo_ai.seo__en.value -%}\n    {%- if seo_data_json -%}\n      <script type="application/ld+json" id="seo-basic-jsonld-{{ product.id }}">\n      <\/script>\n      <script>\n        (function() {\n          try {\n            var seoData = JSON.parse({{ seo_data_json | json }});\n            if (seoData && seoData.jsonLd) {\n              var scriptTag = document.getElementById(\'seo-basic-jsonld-{{ product.id }}\');\n              if (scriptTag) {\n                scriptTag.textContent = JSON.stringify(seoData.jsonLd);\n              }\n            }\n          } catch(e) {\n            console.error(\'Failed to parse SEO JSON-LD:\', e);\n          }\n        })();\n      <\/script>\n    {%- endif -%}\n  {%- endif -%}\n{%- endif -%}\n\n{%- comment -%} Site-wide FAQ Schema {%- endcomment -%}\n{%- if shop.metafields.advanced_schema.site_faq -%}\n  <script type="application/ld+json">\n{{ shop.metafields.advanced_schema.site_faq.value }}\n  <\/script>\n{%- endif -%}'),U("Code copied to clipboard!")},children:"Copy Code"})}),n.jsx(m,{tone:"warning",children:n.jsx(p,{children:"Always backup your theme before making changes!"})})]})})})]}),n.jsx(d,{children:n.jsx(l,{padding:"300",children:n.jsxs(h,{gap:"300",children:[n.jsxs(j,{align:"space-between",blockAlign:"center",children:[n.jsx(p,{as:"h4",variant:"headingSm",children:"Test Your Installation"}),n.jsx(S,{size:"slim",loading:Ie,onClick:async()=>{Oe(!0),Te(null);try{const e=await B(`/api/schema/test-installation?shop=${D}`);Te(e)}catch(e){U("Test failed: "+e.message)}finally{Oe(!1)}},children:"Run Tests"})]}),ke?n.jsxs(h,{gap:"200",children:[n.jsx(m,{tone:ke.allPassed?"success":"warning",children:n.jsx("p",{children:ke.summary})}),n.jsx(l,{paddingBlockStart:"200",children:n.jsxs(h,{gap:"200",children:[n.jsxs(h,{gap:"100",children:[n.jsxs(j,{gap:"200",blockAlign:"center",children:[n.jsx(x,{tone:ke.snippetExists?"success":"critical",children:ke.snippetExists?"Pass":"Fail"}),n.jsx(p,{fontWeight:"medium",children:"Snippet file (snippets/ai-schema.liquid)"})]}),!ke.snippetExists&&n.jsx(p,{variant:"bodySm",tone:"subdued",children:'→ Click "Auto-Install to Theme" above to create the snippet file.'})]}),n.jsxs(h,{gap:"100",children:[n.jsxs(j,{gap:"200",blockAlign:"center",children:[n.jsx(x,{tone:ke.themeHasRenderTag?"success":"critical",children:ke.themeHasRenderTag?"Pass":"Fail"}),n.jsx(p,{fontWeight:"medium",children:"Theme.liquid render tag"})]}),!ke.themeHasRenderTag&&n.jsxs(p,{variant:"bodySm",tone:"subdued",children:['→ Click "Auto-Install to Theme" or manually add ',"{% render 'ai-schema' %}"," before </head> in theme.liquid."]})]}),n.jsxs(h,{gap:"100",children:[n.jsxs(j,{gap:"200",blockAlign:"center",children:[n.jsx(x,{tone:ke.homepageHasJsonLd?"success":"warning",children:ke.homepageHasJsonLd?"Pass":"N/A"}),n.jsx(p,{fontWeight:"medium",children:"Homepage JSON-LD"})]}),!ke.homepageHasJsonLd&&n.jsx(p,{variant:"bodySm",tone:"subdued",children:'→ Go to "Generate Schemas" tab and click "Generate/Update Schema Data" to create Organization & WebSite schemas.'})]}),n.jsxs(h,{gap:"100",children:[n.jsxs(j,{gap:"200",blockAlign:"center",children:[n.jsx(x,{tone:ke.productPageHasSchema?"success":"warning",children:ke.productPageHasSchema?"Pass":"N/A"}),n.jsx(p,{fontWeight:"medium",children:"Product page schema"})]}),!ke.productPageHasSchema&&n.jsx(p,{variant:"bodySm",tone:"subdued",children:"→ Go to Search Optimization and run Basic SEO or AI-Enhanced optimization on your products first."})]})]})}),ke.testedDomain&&n.jsxs(p,{variant:"bodySm",tone:"subdued",children:["Tested domain: ",ke.testedDomain]}),ke.testedProductUrl&&n.jsxs(p,{variant:"bodySm",tone:"subdued",children:["Tested product: ",ke.testedProductUrl]}),(null==(O=ke.errors)?void 0:O.length)>0&&n.jsxs(p,{variant:"bodySm",tone:"critical",children:["Errors: ",ke.errors.join(", ")]})]}):n.jsx(p,{variant:"bodySm",tone:"subdued",children:'Click "Run Tests" to verify your schema installation is working correctly.'})]})})})]})})]})]})})}),0===z&&n.jsx(l,{paddingBlockStart:"400",children:n.jsx(d,{children:n.jsx(l,{padding:"400",children:n.jsxs(h,{gap:"400",children:[n.jsx(p,{as:"h2",variant:"headingMd",children:"Advanced Schema Data"}),n.jsx(p,{variant:"bodyMd",tone:"subdued",children:"Advanced schemas use artificial intelligence to generate rich, contextual data for each product. This AI-enhanced structured data helps AI bots to understand your products deeply, resulting in better visibility and more accurate recommendations."}),n.jsx(m,{tone:"info",children:n.jsx("p",{children:"Generation creates BreadcrumbList, FAQPage, WebPage, Product and more schema types for each product. These include AI-generated FAQs based on product features, navigation breadcrumbs for better context, detailed product attributes (material, size, color), aggregate ratings, and semantic descriptions that standard Shopify schemas don't provide."})}),n.jsxs(j,{gap:"300",children:[n.jsx(S,{loading:K.inProgress,disabled:K.inProgress,onClick:async()=>{var e,n,s,a;try{const e=await B(`/ai/schema-data.json?shop=${D}`);if(e.schemas&&e.schemas.length>0&&!confirm("This will replace existing schema data. Continue?"))return;await B(`/api/schema/generate-all?shop=${D}`,{method:"POST",body:{shop:D}});U("Generating Advanced Schema Data in background. You can navigate away safely & explore other features."),Re()}catch(t){if(402===t.status)return je(t),void(t.trialRestriction&&t.requiresActivation?le(!0):t.requiresPurchase?ue(!0):U("Advanced Schema Data requires activation or token purchase."));if((null==(e=t.message)?void 0:e.includes("NO_OPTIMIZED_PRODUCTS"))||(null==(n=t.error)?void 0:n.includes("NO_OPTIMIZED_PRODUCTS")))return ye("NO_OPTIMIZED_PRODUCTS"),void Se(!0);if((null==(s=t.message)?void 0:s.includes("ONLY_BASIC_SEO"))||(null==(a=t.error)?void 0:a.includes("ONLY_BASIC_SEO")))return ye("ONLY_BASIC_SEO"),void Se(!0);U("Failed to generate schema: "+(t.message||"Unknown error"))}},children:"Generate/Update Schema Data"}),n.jsx(S,{onClick:()=>{window.open(`/ai/schema-data.json?shop=${D}`,"_blank")},disabled:K.inProgress,children:"View Generated Schema"}),n.jsx(S,{tone:"critical",disabled:K.inProgress,onClick:async()=>{if(confirm("This will delete all advanced schema data. Are you sure?"))try{await B(`/api/schema/delete?shop=${D}`,{method:"DELETE",body:{shop:D}}),U("Schema data deleted successfully"),ee({inProgress:!1,status:"idle",message:null,position:null,estimatedTime:null,generatedAt:null,schemaCount:0})}catch(e){U("Failed to delete schema data")}},children:"Delete Schema Data"})]}),K.inProgress&&n.jsx(l,{paddingBlockStart:"400",children:n.jsxs(h,{gap:"300",children:[(null==(k=K.progress)?void 0:k.total)>0&&n.jsx(y,{progress:(null==(T=K.progress)?void 0:T.percent)||0,size:"small"}),n.jsxs(j,{gap:"200",blockAlign:"center",align:"space-between",children:[n.jsxs(j,{gap:"200",blockAlign:"center",children:[n.jsx(u,{size:"small"}),n.jsx(p,{variant:"bodyMd",tone:"subdued",children:K.message||"Generating Advanced Schema Data..."})]}),(null==(C=K.progress)?void 0:C.remainingSeconds)>0&&n.jsx(p,{variant:"bodySm",tone:"subdued",children:K.progress.remainingSeconds>=60?`~${Math.ceil(K.progress.remainingSeconds/60)} min remaining`:`~${K.progress.remainingSeconds} sec remaining`})]}),(null==(E=K.progress)?void 0:E.total)>0&&n.jsxs(p,{variant:"bodySm",tone:"subdued",children:[K.progress.current||0," / ",K.progress.total," products (",K.progress.percent||0,"%)"]}),K.position>0&&n.jsxs(p,{variant:"bodySm",tone:"subdued",children:["Queue position: ",K.position]})]})}),!K.inProgress&&"completed"===K.status&&K.generatedAt&&n.jsx(l,{paddingBlockStart:"200",children:n.jsxs(j,{gap:"200",blockAlign:"center",children:[n.jsx(x,{tone:"success",children:"Generated"}),n.jsxs(p,{variant:"bodySm",tone:"subdued",children:[K.schemaCount," schemas · ",(()=>{const e=new Date,n=new Date(K.generatedAt),s=Math.floor((e-n)/1e3/60);if(s<1)return"Just now";if(s<60)return`${s} min ago`;const a=Math.floor(s/60);if(a<24)return`${a}h ago`;return`${Math.floor(a/24)}d ago`})()]})]})}),n.jsx(d,{children:n.jsx(l,{padding:"300",children:n.jsxs(h,{gap:"300",children:[n.jsxs(j,{align:"space-between",blockAlign:"center",children:[n.jsxs(h,{gap:"100",children:[n.jsx(p,{as:"h3",variant:"headingSm",children:"Rich Product Attributes"}),n.jsx(p,{variant:"bodyMd",tone:"subdued",children:"Select which AI-generated attributes to include in product schemas"})]}),n.jsx(S,{size:"slim",onClick:async()=>{qe(!0);try{const e=await B(`/api/ai-discovery/settings?shop=${D}`);await B(`/api/ai-discovery/settings?shop=${D}`,{method:"POST",body:{shop:D,bots:e.bots,features:e.features,richAttributes:De}}),U("Rich attributes saved!")}catch(e){U("Failed to save attributes: "+(e.message||"Unknown error"))}finally{qe(!1)}},loading:$e,children:"Save Attributes"})]}),n.jsx(v,{columns:2,gap:"400",children:[{key:"material",label:"Material",description:"Product material (cotton, leather, metal, etc.)"},{key:"color",label:"Color",description:"Product color information"},{key:"size",label:"Size",description:"Product size or dimensions"},{key:"weight",label:"Weight",description:"Product weight information"},{key:"dimensions",label:"Dimensions",description:"Product measurements"},{key:"category",label:"Category",description:"Product category classification"},{key:"audience",label:"Target Audience",description:"Intended user group (men, women, kids, etc.)"},{key:"reviews",label:"Review Schemas",description:"AI-generated product reviews for schema.org"},{key:"ratings",label:"Rating Schemas",description:"AI-generated ratings and aggregate ratings"},{key:"enhancedDescription",label:"Enhanced Descriptions",description:"AI-enhanced product descriptions"},{key:"organization",label:"Organization Schema",description:"Brand organization information"}].map(e=>n.jsx(b,{label:e.label,helpText:e.description,checked:De[e.key]||!1,onChange:n=>{ze(s=>({...s,[e.key]:n}))}},e.key))})]})})})]})})})}),L&&n.jsx(w,{content:L,onDismiss:()=>U("")}),n.jsx(r,{open:ie,onClose:()=>oe(!1),feature:re.feature,currentPlan:re.currentPlan,requiredPlan:re.requiredPlan,returnTo:"/ai-seo/schema-data"}),n.jsx(t,{open:de,onClose:()=>le(!1),onActivatePlan:async()=>{try{const e=await B(`/api/billing/activate?shop=${D}`,{method:"POST",body:{shop:D,endTrial:!0,returnTo:window.location.pathname}});e.confirmationUrl?window.top.location.href=e.confirmationUrl:e.success&&(le(!1),U("Plan activated! You can now generate Advanced Schema Data."),setTimeout(()=>(async(e=!1)=>{te(!0);try{const s=_(J),a=["professional_plus","growth_plus","starter_plus"],t=["growth_extra","enterprise"].includes(s),i=a.includes(s),o=c("ai-schema-advanced",{productCount:V||0}).withMargin;if(!t&&!i)return ce({feature:"Advanced Schema Data",currentPlan:J,requiredPlan:"Professional Plus, Growth Plus, Growth Extra, or Enterprise",tokensRequired:o}),oe(!0),void te(!1);if(i)try{const e=await B(`/api/billing/tokens/balance?shop=${D}`),n=(null==e?void 0:e.balance)||0;if(n<o)return je({feature:"ai-schema-advanced",tokensRequired:o,tokensAvailable:n,tokensNeeded:o-n}),ue(!0),void te(!1)}catch(n){}const r=await B(`/api/schema/generate-all?shop=${D}`,{method:"POST",body:{shop:D,forceBasicSeo:e}});r.queued?(U("Advanced Schema generation started..."),Re()):r.error&&("NO_OPTIMIZED_PRODUCTS"===r.error?(ye("NO_OPTIMIZED_PRODUCTS"),Se(!0)):"ONLY_BASIC_SEO"===r.error?(ye("ONLY_BASIC_SEO"),Se(!0)):U(`Error: ${r.error}`))}catch(s){402===s.status?s.trialRestriction&&s.requiresActivation?(je(s),le(!0)):s.requiresPurchase?(je(s),ue(!0)):U(s.message||"Payment required"):403===s.status?(ce({feature:"Advanced Schema Data",currentPlan:J,requiredPlan:"Professional Plus, Growth Plus, Growth Extra, or Enterprise"}),oe(!0)):400===s.status?"NO_OPTIMIZED_PRODUCTS"===s.error?(ye("NO_OPTIMIZED_PRODUCTS"),Se(!0)):"ONLY_BASIC_SEO"===s.error?(ye("ONLY_BASIC_SEO"),Se(!0)):U(s.message||"Error generating schema"):U(`Error: ${s.message}`)}finally{te(!1)}})(),1e3))}catch(e){U("Failed to activate plan")}},onPurchaseTokens:()=>{le(!1),me(!0)},feature:"ai-schema-advanced",trialEndsAt:(null==Z?void 0:Z.trialEndsAt)||(null==ge?void 0:ge.trialEndsAt),currentPlan:J||(null==ge?void 0:ge.currentPlan)||"Enterprise",tokensRequired:(null==ge?void 0:ge.tokensRequired)||c("ai-schema-advanced",{productCount:V}).withMargin}),n.jsx(i,{open:he,onClose:()=>ue(!1),onBuyTokens:()=>{ue(!1),me(!0)},feature:"ai-schema-advanced",tokensRequired:(null==ge?void 0:ge.tokensRequired)||0,tokensAvailable:(null==ge?void 0:ge.tokensAvailable)||0,tokensNeeded:(null==ge?void 0:ge.tokensNeeded)||(null==ge?void 0:ge.tokensRequired)||0}),n.jsx(o,{open:pe,onClose:()=>me(!1),shop:D,tokensNeeded:(null==ge?void 0:ge.tokensNeeded)||0,returnTo:"/ai-seo/schema-data"}),xe&&"NO_OPTIMIZED_PRODUCTS"===fe&&n.jsx(A,{open:!0,title:"No Optimized Products Found",onClose:async()=>{Se(!1),ye(null);try{await B(`/api/schema/dismiss-error?shop=${D}`,{method:"POST"})}catch(e){}},primaryAction:{content:"Go to Search Optimization",onAction:async()=>{Se(!1),ye(null);try{await B(`/api/schema/dismiss-error?shop=${D}`,{method:"POST"})}catch(s){}const e=new URLSearchParams(window.location.search),n=e.toString()?`?${e.toString()}`:"";window.location.href=`/ai-seo${n}`}},secondaryActions:[{content:"Cancel",onAction:async()=>{Se(!1),ye(null);try{await B(`/api/schema/dismiss-error?shop=${D}`,{method:"POST"})}catch(e){}}}],children:n.jsx(A.Section,{children:n.jsxs(h,{gap:"400",children:[n.jsx(m,{tone:"warning",children:n.jsx("p",{children:"No optimized products were found in your store."})}),n.jsx(p,{children:"Advanced Schema Data requires at least basic AISEO optimization on your products. Please run AISEO optimization first, then try generating schemas again."}),n.jsx(p,{variant:"bodyMd",fontWeight:"semibold",children:"You can choose:"}),n.jsxs(h,{gap:"200",children:[n.jsxs(p,{children:["• ",n.jsx("strong",{children:"Basic AISEO"})," - Free AISEO optimization"]}),n.jsxs(p,{children:["• ",n.jsx("strong",{children:"AI-Enhanced AISEO"})," - Advanced optimization (requires tokens)"]})]})]})})}),we&&n.jsx(A,{open:we,onClose:()=>Ae(!1),title:"Install Schema Snippet to Theme",primaryAction:{content:"Install",onAction:async()=>{Ae(!1),await(async()=>{be(!0);try{const e=await B(`/api/schema/install-theme?shop=${D}`,{method:"POST",body:{shop:D}});if(!e.success)throw new Error(e.error||"Unknown error");U("Schema snippet installed successfully! Check your theme.")}catch(e){U("Failed to install: "+(e.message||"You may need to re-authorize the app."))}finally{be(!1),Ae(!1)}})()}},secondaryActions:[{content:"Cancel",onAction:()=>Ae(!1)}],children:n.jsx(A.Section,{children:n.jsxs(h,{gap:"400",children:[n.jsx(m,{status:"info",children:n.jsxs("p",{children:["This will create ",n.jsx("code",{children:"snippets/ai-schema.liquid"})," and add one line to ",n.jsx("code",{children:"layout/theme.liquid"}),"."]})}),n.jsxs(p,{children:["The installation adds ",n.jsx("code",{children:"{% render 'ai-schema' %}"})," before the closing ",n.jsx("code",{children:"</head>"})," tag. Your existing theme code will not be modified or replaced."]}),n.jsx(p,{variant:"bodyMd",fontWeight:"semibold",children:"Do you want to proceed with automatic installation?"})]})})}),Pe&&n.jsx(A,{open:Pe,onClose:()=>_e(!1),title:"Upgrade for Auto-Install",primaryAction:{content:"Upgrade to Growth Plus",onAction:()=>{const e=new URLSearchParams(window.location.search),n=e.get("host"),s=e.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(D)}&embedded=${s}&host=${encodeURIComponent(n)}`}},secondaryActions:[{content:"Use Manual Install",onAction:()=>{var e;_e(!1),null==(e=document.getElementById("manual-install-section"))||e.scrollIntoView({behavior:"smooth"})}}],children:n.jsx(A.Section,{children:n.jsxs(h,{gap:"400",children:[n.jsx(m,{status:"info",children:n.jsxs("p",{children:["Auto-Install to Theme is available on ",n.jsx("strong",{children:"Growth Plus"})," plan and higher."]})}),n.jsx(p,{children:"This feature automatically installs the schema snippet to your Shopify theme, saving you time and ensuring correct configuration."}),n.jsx(p,{variant:"bodyMd",fontWeight:"semibold",children:"Your options:"}),n.jsxs(h,{gap:"200",children:[n.jsxs(p,{children:["• ",n.jsx("strong",{children:"Upgrade to Growth Plus"})," - Get Auto-Install and many more features"]}),n.jsxs(p,{children:["• ",n.jsx("strong",{children:"Use Manual Install"})," - Copy the code and paste it in your theme editor"]})]})]})})}),xe&&"ONLY_BASIC_SEO"===fe&&n.jsx(A,{open:!0,title:"AI-Enhanced Optimization Recommended",onClose:async()=>{Se(!1),ye(null);try{await B(`/api/schema/dismiss-error?shop=${D}`,{method:"POST"})}catch(e){}},primaryAction:{content:"Generate AI-Enhanced Add-ons",onAction:async()=>{Se(!1),ye(null);try{await B(`/api/schema/dismiss-error?shop=${D}`,{method:"POST"})}catch(s){}const e=new URLSearchParams(window.location.search),n=e.toString()?`?${e.toString()}`:"";window.location.href=`/ai-seo${n}`}},secondaryActions:[{content:"Proceed with Basic AISEO",onAction:async()=>{Se(!1),ye(null);try{U("Starting schema generation with basic AISEO..."),await B(`/api/schema/generate-all?shop=${D}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({forceBasicSeo:!0})}),Re()}catch(e){U("Failed to generate schema: "+(e.message||"Unknown error"))}}}],children:n.jsx(A.Section,{children:n.jsxs(h,{gap:"400",children:[n.jsx(m,{tone:"info",children:n.jsx("p",{children:"Only basic AISEO optimization was found on your products."})}),n.jsx(p,{children:"For best results with Advanced Schema Data, we recommend running AI-Enhanced AISEO optimization first. This will provide richer product data for schema generation."}),n.jsx(p,{variant:"bodyMd",fontWeight:"semibold",children:"What would you like to do?"}),n.jsxs(h,{gap:"200",children:[n.jsxs(p,{children:["• ",n.jsx("strong",{children:"Generate AI-Enhanced Add-ons"})," - Get the best results (requires tokens)"]}),n.jsxs(p,{children:["• ",n.jsx("strong",{children:"Proceed with Basic AISEO"})," - Continue with current basic AISEO"]})]})]})})})]})}export{I as default};
