import{j as t}from"./app-bridge-6r6BIFE_-1759223349524.js";import{r as h}from"./react-vendor-tAaa2TlE-1759223349524.js";import{m as Ra}from"./index-BqHTigSF-1759223349524.js";import{C as b,a as p,T as m,h as ja,L as C,B as z,s as v,i as n,D as Ia,f as Oa,I as Ba,k as _a}from"./polaris-BdPP8PLz-1759223349524.js";const Ua=(T,c="")=>{try{return new URLSearchParams(window.location.search).get(T)||c}catch{return c}};function Va({shop:T}){var U,$,F,q;const c=T||Ua("shop",""),[ba,P]=h.useState(!1),[Ca,L]=h.useState(!1),[R,g]=h.useState(""),[f,va]=h.useState(null),D=h.useMemo(()=>Ra({}),[]),[Da,I]=h.useState(!1),[wa,O]=h.useState(!1),[x,za]=h.useState({storeName:"",homePageTitle:"",metaDescription:""}),[Ta,B]=h.useState(!1),[i,o]=h.useState({seo:{storeName:"",shortDescription:"",fullDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""}});h.useEffect(()=>{c&&_()},[c,D]);async function _(){var e,a,r,s,M,u,S,J,V,G,W,X;P(!0);try{const y=`/api/store/generate?shop=${encodeURIComponent(c)}`,d=await D(y,{headers:{"X-Shop":c}});va(d),za({storeName:((e=d.shopifyDefaults)==null?void 0:e.storeName)||"",homePageTitle:((a=d.shopifyDefaults)==null?void 0:a.homePageTitle)||"",metaDescription:((r=d.shopifyDefaults)==null?void 0:r.metaDescription)||""});const l=d.existingMetadata||{},A=((M=(s=l.seo_metadata)==null?void 0:s.value)==null?void 0:M.storeName)||"",N=((S=(u=l.seo_metadata)==null?void 0:u.value)==null?void 0:S.shortDescription)||"",E=((V=(J=l.seo_metadata)==null?void 0:J.value)==null?void 0:V.fullDescription)||"",Ea=A&&A!==((G=d.shopifyDefaults)==null?void 0:G.storeName),Pa=N&&N!==((W=d.shopifyDefaults)==null?void 0:W.homePageTitle),La=E&&E!==((X=d.shopifyDefaults)==null?void 0:X.metaDescription);B(Ea||Pa||La),o(w=>{var K,H,Y,Q,Z,aa,ea,ta,ia,oa,na,sa,ra,la,da,ca,ha,ua,pa,ma,ga,Sa,fa,xa,ya,Ma;return{...w,seo:{...w.seo,storeName:A,shortDescription:N,fullDescription:E,keywords:Array.isArray((H=(K=l.seo_metadata)==null?void 0:K.value)==null?void 0:H.keywords)?l.seo_metadata.value.keywords.join(", "):((Q=(Y=l.seo_metadata)==null?void 0:Y.value)==null?void 0:Q.keywords)||""},aiMetadata:{...w.aiMetadata,...((Z=l.ai_metadata)==null?void 0:Z.value)||{},languages:((ta=(ea=(aa=l.ai_metadata)==null?void 0:aa.value)==null?void 0:ea.languages)==null?void 0:ta.length)>0?l.ai_metadata.value.languages:(((ia=d.shopInfo)==null?void 0:ia.locales)||[]).filter(j=>j.published).map(j=>j.locale),supportedCurrencies:((sa=(na=(oa=l.ai_metadata)==null?void 0:oa.value)==null?void 0:na.supportedCurrencies)==null?void 0:sa.length)>0?l.ai_metadata.value.supportedCurrencies:((ra=d.shopInfo)==null?void 0:ra.currencies)||["EUR"],shippingRegions:((ca=(da=(la=l.ai_metadata)==null?void 0:la.value)==null?void 0:da.shippingRegions)==null?void 0:ca.length)>0?l.ai_metadata.value.shippingRegions:(((ha=d.shopInfo)==null?void 0:ha.markets)||[]).map(j=>j.name)},organizationSchema:{...w.organizationSchema,...((ua=l.organization_schema)==null?void 0:ua.value)||{},enabled:((ma=(pa=l.organization_schema)==null?void 0:pa.value)==null?void 0:ma.enabled)===!0,name:((Sa=(ga=l.organization_schema)==null?void 0:ga.value)==null?void 0:Sa.name)||((fa=d.shopInfo)==null?void 0:fa.name)||"",email:((ya=(xa=l.organization_schema)==null?void 0:xa.value)==null?void 0:ya.email)||((Ma=d.shopInfo)==null?void 0:Ma.email)||""}}})}catch(y){console.error("[StoreMeta] Load error:",y),g(`Load failed: ${(y==null?void 0:y.message)||"Unknown error"}`)}finally{P(!1)}}function ka(){o(e=>({...e,seo:{...e.seo,storeName:"",shortDescription:"",fullDescription:""}})),B(!1),g("Synced with Shopify store settings")}async function k(){L(!0);try{const e=`/api/store/apply?shop=${encodeURIComponent(c)}`;console.log("[StoreMeta] SAVE",e);const a=await D(e,{method:"POST",headers:{"X-Shop":c},body:{metadata:i,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:i.organizationSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:e,ok:a==null?void 0:a.ok}),g("Metadata saved successfully!"),await _()}catch(e){console.error("[StoreMeta] SAVE error",(e==null?void 0:e.debug)||e,e),g(`Save failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{L(!1)}}async function Aa(){var e;I(!0);try{await k();const r=await D("/graphql",{method:"POST",headers:{"X-Shop":c},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            seoMetadata
            aiMetadata
            organizationSchema
            // localBusinessSchema // DISABLED
          }
        }
      `,variables:{shop:c}}});if(r.error)throw new Error(r.error);const s=(e=r.data)==null?void 0:e.storeMetadata;if(s){const M=window.open("","_blank");console.log("[STORE-METADATA] Raw preview data:",s),console.log("[STORE-METADATA] seoMetadata raw:",s.seoMetadata),console.log("[STORE-METADATA] aiMetadata raw:",s.aiMetadata),console.log("[STORE-METADATA] organizationSchema raw:",s.organizationSchema);const u={shopName:s.shopName,description:s.description,seoMetadata:s.seoMetadata?(()=>{try{return JSON.parse(s.seoMetadata)}catch(S){return console.error("Error parsing seoMetadata:",S),s.seoMetadata}})():null,aiMetadata:s.aiMetadata?(()=>{try{return JSON.parse(s.aiMetadata)}catch(S){return console.error("Error parsing aiMetadata:",S),s.aiMetadata}})():null,organizationSchema:s.organizationSchema?(()=>{try{return JSON.parse(s.organizationSchema)}catch(S){return console.error("Error parsing organizationSchema:",S),s.organizationSchema}})():null};M.document.write(`
          <html>
            <head>
              <title>Store Metadata Preview</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
                h1 { color: #333; }
                .section { margin: 20px 0; }
                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
              </style>
            </head>
            <body>
              <h1>Store Metadata Preview</h1>
              <div class="section">
                <h2>Basic Info</h2>
                <p><strong>Shop Name:</strong> ${u.shopName||"Not set"}</p>
                <p><strong>Description:</strong> ${u.description||"Not set"}</p>
              </div>
              
              <div class="section">
                <h2>SEO Metadata</h2>
                <pre>${JSON.stringify(u.seoMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>AI Metadata</h2>
                <pre>${JSON.stringify(u.aiMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Organization Schema</h2>
                <pre>${JSON.stringify(u.organizationSchema,null,2)}</pre>
              </div>
              
              <!-- Local Business Schema - DISABLED -->
              <!-- <div class="section">
                <h2>Local Business Schema</h2>
                <pre>${JSON.stringify(u.localBusinessSchema,null,2)}</pre>
              </div> -->
              
              <div class="section">
                <h2>Raw Data</h2>
                <pre>${JSON.stringify(u,null,2)}</pre>
              </div>
            </body>
          </html>
        `),M.document.close()}else throw new Error("No preview data available")}catch(a){g(`Preview failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{I(!1)}}async function Na(){O(!0);try{o({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""}}),await k(),g("Metadata cleared successfully!")}catch(e){g(`Clear failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{O(!1)}}return ba&&!f?t.jsx(b,{children:t.jsx(p,{padding:"400",children:t.jsx(m,{children:"Loading store data..."})})}):(f==null?void 0:f.plan)==="Starter"?t.jsx(ja,{status:"warning",children:t.jsx(m,{children:"Store metadata features are available starting from the Professional plan."})}):t.jsxs(C,{children:[t.jsx(C.Section,{children:t.jsx(b,{title:"Basic Store Information",children:t.jsxs(p,{padding:"400",children:[t.jsx(ja,{tone:"info",children:t.jsxs(p,{children:[t.jsx(m,{variant:"bodyMd",fontWeight:"semibold",children:"From Shopify Settings:"}),t.jsxs(p,{paddingBlockStart:"200",children:[t.jsxs(m,{variant:"bodySm",tone:"subdued",children:["Store name: ",t.jsx(m,{as:"span",fontWeight:"medium",children:x.storeName||"Not set"})]}),t.jsx(m,{variant:"bodySm",tone:"subdued"}),t.jsxs(m,{variant:"bodySm",tone:"subdued",children:["Meta description: ",t.jsx(m,{as:"span",fontWeight:"medium",children:x.metaDescription?x.metaDescription.substring(0,100)+(x.metaDescription.length>100?"...":""):"Not set"})]})]}),Ta&&t.jsx(p,{paddingBlockStart:"300",children:t.jsx(z,{size:"slim",onClick:ka,children:"Sync from Shopify"})})]})}),t.jsx(p,{paddingBlockStart:"400",children:t.jsxs(v,{children:[t.jsx(n,{label:"Store Name",value:i.seo.storeName,onChange:e=>o(a=>({...a,seo:{...a.seo,storeName:e}})),placeholder:x.storeName,helpText:"Leave empty to use Shopify store name",maxLength:100}),t.jsx(n,{label:"Short Store Description",value:i.seo.shortDescription,onChange:e=>o(a=>({...a,seo:{...a.seo,shortDescription:e}})),helpText:"Въведи кратко описание на магазина - макс 100 знака",maxLength:100}),t.jsx(n,{label:"Full Store Description",value:i.seo.fullDescription,onChange:e=>o(a=>({...a,seo:{...a.seo,fullDescription:e}})),placeholder:x.metaDescription,helpText:"Leave empty to use Shopify meta description",maxLength:300,multiline:3}),t.jsx(n,{label:"Keywords",value:i.seo.keywords,onChange:e=>o(a=>({...a,seo:{...a.seo,keywords:e}})),helpText:"Comma-separated keywords (optional)"})]})})]})})}),t.jsx(C.Section,{children:t.jsx(b,{title:"AI Metadata",children:t.jsx(p,{padding:"400",children:t.jsxs(v,{children:[t.jsxs(v.Group,{children:[t.jsx(n,{label:"Business Type",value:i.aiMetadata.businessType,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,businessType:e}})),placeholder:"e.g., Fashion Retailer, Electronics Store",helpText:"Max 3 words"}),t.jsx(n,{label:"Target Audience",value:i.aiMetadata.targetAudience,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,targetAudience:e}})),placeholder:"e.g., Young professionals, Parents"})]}),t.jsx(n,{label:"Unique Selling Points",value:i.aiMetadata.uniqueSellingPoints,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,uniqueSellingPoints:e}})),helpText:"Comma-separated list",multiline:2}),t.jsx(n,{label:"Brand Voice",value:i.aiMetadata.brandVoice,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,brandVoice:e}})),placeholder:"e.g., Professional, Friendly, Casual"}),t.jsx(n,{label:"Primary Categories",value:i.aiMetadata.primaryCategories,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,primaryCategories:e}})),helpText:"Main product categories, comma-separated"}),t.jsx(n,{label:"Shipping Information",value:i.aiMetadata.shippingInfo,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,shippingInfo:e}})),helpText:"Shipping costs, delivery times, free shipping thresholds (e.g., Free shipping over $50, 2-3 business days)",multiline:2}),t.jsx(n,{label:"Return Policy",value:i.aiMetadata.returnPolicy,onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,returnPolicy:e}})),multiline:2}),t.jsx(Ia,{}),t.jsx(m,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),t.jsx(m,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),t.jsx(n,{label:"Supported Languages",value:((U=i.aiMetadata.languages)==null?void 0:U.join(", "))||"",onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,languages:e.split(",").map(r=>r.trim()).filter(r=>r)}})),helpText:"Comma-separated language codes (e.g., en, de, es, fr)",multiline:2}),t.jsx(n,{label:"Supported Currencies",value:(($=i.aiMetadata.supportedCurrencies)==null?void 0:$.join(", "))||"",onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,supportedCurrencies:e.split(",").map(r=>r.trim()).filter(r=>r)}})),helpText:"Comma-separated currency codes (e.g., EUR, USD, GBP)"}),t.jsx(n,{label:"Shipping Regions",value:((F=i.aiMetadata.shippingRegions)==null?void 0:F.join(", "))||"",onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,shippingRegions:e.split(",").map(r=>r.trim()).filter(r=>r)}})),helpText:"Comma-separated regions (e.g., EU, USA, UK, Canada)",multiline:2}),t.jsx(n,{label:"Cultural Considerations",value:i.aiMetadata.culturalConsiderations||"",onChange:e=>o(a=>({...a,aiMetadata:{...a.aiMetadata,culturalConsiderations:e}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),((q=f==null?void 0:f.features)==null?void 0:q.organizationSchema)&&t.jsx(C.Section,{children:t.jsx(b,{title:"Organization Schema",children:t.jsxs(p,{padding:"400",children:[t.jsx(Oa,{label:"Enable Organization Schema",checked:i.organizationSchema.enabled,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,enabled:e}}))}),i.organizationSchema.enabled&&t.jsx(p,{paddingBlockStart:"400",children:t.jsxs(v,{children:[t.jsxs(v.Group,{children:[t.jsx(n,{label:"Organization Name",value:i.organizationSchema.name,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,name:e}}))}),t.jsx(n,{label:"Contact Email",value:i.organizationSchema.email,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,email:e}})),type:"email"})]}),t.jsx(n,{label:"Phone",value:i.organizationSchema.phone,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,phone:e}})),type:"tel"}),t.jsx(n,{label:"Logo URL",value:i.organizationSchema.logo,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,logo:e}})),type:"url"}),t.jsx(n,{label:"Social Media Links",value:i.organizationSchema.sameAs,onChange:e=>o(a=>({...a,organizationSchema:{...a.organizationSchema,sameAs:e}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}),t.jsx(C.Section,{children:t.jsx(b,{children:t.jsx(p,{padding:"400",children:t.jsxs(Ba,{gap:"300",children:[t.jsx(z,{onClick:k,loading:Ca,primary:!0,children:"Save Metadata"}),t.jsx(z,{onClick:Aa,loading:Da,children:"Preview Metadata"}),t.jsx(z,{onClick:Na,loading:wa,destructive:!0,children:"Clear Metadata"})]})})})}),R&&t.jsx(_a,{content:R,onDismiss:()=>g("")})]})}export{Va as default};
