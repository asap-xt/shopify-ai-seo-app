import{j as e}from"./app-bridge-5mK6XDlw-1760380080447.js";import{r as a}from"./react-vendor-tAaa2TlE-1760380080447.js";import{u as Ft}from"./index-CIyjpvjU-1760380080447.js";import{U as Kt,I as qt}from"./InsufficientTokensModal-De0YVtsA-1760380080447.js";import{M as E,d as R,T as r,e as nt,f as Ne,B as v,a as c,I as y,g as Pe,D as Yt,h as _,C as ot,i as _t,S as Vt,P as we,j as Ce,R as Qt,k as Jt,l as at,m as Xt,E as Zt}from"./polaris-DMIdEbpi-1760380080447.js";const es=(b,p="")=>{try{return new URLSearchParams(window.location.search).get(b)||p}catch{return p}},ce=b=>{if(!b)return b;const p=String(b).trim();return p.startsWith("gid://")?p:`gid://shopify/Product/${p}`},ts=b=>{if(!b)return"";const p=String(b).match(/\/(\d+)$/);return p?p[1]:b},W=b=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(b==null?void 0:b.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(b==null?void 0:b.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}};function is({shop:b}){const{api:p,shop:lt}=Ft(),i=b||lt||es("shop","");a.useEffect(()=>{},[i,p]);const[x,F]=a.useState([]),[te,de]=a.useState(!1),[rt,We]=a.useState(1),[it,Ie]=a.useState(!0),[K,Ge]=a.useState(0),[h,se]=a.useState([]),[w,ue]=a.useState(!1),[q,He]=a.useState(""),[T,he]=a.useState("all"),[M,ne]=a.useState(""),[ge,ss]=a.useState("createdAt"),[V,ct]=a.useState("desc"),[U,pe]=a.useState([]),[dt,ut]=a.useState([]),[Fe,Ee]=a.useState(!1),[Ke,Ae]=a.useState(!1),[qe,Le]=a.useState(!1),[Ye,Oe]=a.useState(!1),[ht,gt]=a.useState(""),[pt,mt]=a.useState([]),[z,Q]=a.useState([]),[A,_e]=a.useState([]),[ve,J]=a.useState(!1),[me,B]=a.useState({current:0,total:0,percent:0}),[Ve,X]=a.useState(""),[fe,oe]=a.useState([]),[ae,Qe]=a.useState({}),[ft,ke]=a.useState(!1),[St,Se]=a.useState(!1),[xt,le]=a.useState(!1),[N,re]=a.useState([]),[jt,xe]=a.useState(!1),[Je,P]=a.useState(""),[Xe,yt]=a.useState(!1),[L,Z]=a.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[O,bt]=a.useState(null),[G,Pt]=a.useState(1),[wt,je]=a.useState(!1),[ye,Ct]=a.useState(localStorage.getItem("hasVisitedProducts")==="true"),[It,Me]=a.useState(!1),[Et,Ze]=a.useState(!1),[Y,Te]=a.useState(null),[ze,et]=a.useState("starter");a.useEffect(()=>{if(!i)return;p("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
        }
      }
    `,variables:{shop:i}})}).then(n=>{var m,u,g;if((m=n==null?void 0:n.errors)!=null&&m.length)throw new Error(((u=n.errors[0])==null?void 0:u.message)||"GraphQL error");const s=(g=n==null?void 0:n.data)==null?void 0:g.plansMe,o=(s==null?void 0:s.modelsSuggested)||["anthropic/claude-3.5-sonnet"];mt(o.map(S=>({label:S,value:S}))),gt(o[0]),bt((s==null?void 0:s.plan)||"starter"),et((s==null?void 0:s.planKey)||"starter");const d=((s==null?void 0:s.planKey)||"starter").toLowerCase();Pt({starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[d]||1)}).catch(n=>console.error("[BULK-EDIT] GraphQL plansMe failed:",n))},[i,p]),a.useEffect(()=>{if(!i)return;const t=new Promise((n,s)=>{setTimeout(()=>s(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([p(`/api/languages/shop/${i}`),t]).then(n=>{const s=Array.isArray(n==null?void 0:n.shopLanguages)&&n.shopLanguages.length?n.shopLanguages:["en"];_e(s.includes("en")?s:["en",...s])}).catch(n=>{console.error("[BULK-EDIT] Languages API error:",n),_e(["en"])})},[i,p]),a.useEffect(()=>{i&&p("/api/products/tags/list",{shop:i}).then(t=>ut((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[i,p]);const H=a.useCallback(async(t=1,n=!1,s=null)=>{var o,d,l,m,u;de(!0);try{const g=new URLSearchParams({shop:i,page:t,limit:50,...T!=="all"&&{optimized:T},...q&&{search:q},...M&&{languageFilter:M},...U.length>0&&{tags:U.join(",")},sortBy:ge,sortOrder:V,...s&&{_t:s}}),S=await p(`/api/products/list?${g}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((o=S.products)==null?void 0:o.length)>0,console.log("[LOAD-PRODUCTS] ===== PRODUCTS LOADED ====="),console.log("[LOAD-PRODUCTS] Total products:",(d=S.products)==null?void 0:d.length),((l=S.products)==null?void 0:l.length)>0&&S.products.forEach((j,$)=>{var f,k;console.log(`[LOAD-PRODUCTS] Product ${$}: ID=${j.id} (type: ${typeof j.id}), _id=${j._id}, title="${j.title}", has SEO: ${!!((k=(f=j.optimizationSummary)==null?void 0:f.optimizedLanguages)!=null&&k.length)}`)}),F(n?j=>[...j,...S.products]:S.products||[]),We(t),Ie(((m=S.pagination)==null?void 0:m.hasNext)||!1),Ge(((u=S.pagination)==null?void 0:u.total)||0)}catch(g){F(n?x:[]),Ie(!1),P(`Error loading products: ${g.message}`)}finally{de(!1)}},[i,T,q,M,U,ge,V]);a.useEffect(()=>{i&&H(1,!1,null)},[i,H,T,M,U,ge,V]),a.useEffect(()=>{!ye&&i&&(localStorage.setItem("hasVisitedProducts","true"),Ct(!0))},[ye,i]),a.useEffect(()=>{x.length===0&&!te&&i&&!ye&&je(!0)},[x.length,te,i,ye]),a.useEffect(()=>{console.log("[DEBUG-MONITOR] ===== STATE CHANGED ====="),console.log("[DEBUG-MONITOR] Products count:",x.length),console.log("[DEBUG-MONITOR] Selected items count:",h.length),console.log("[DEBUG-MONITOR] Products:",x.map(t=>({id:t.id,title:t.title}))),console.log("[DEBUG-MONITOR] Selected items:",h)},[x,h]);const tt=a.useCallback(t=>{He(t)},[]);a.useEffect(()=>{const t=setTimeout(()=>{i&&H(1,!1,null)},500);return()=>clearTimeout(t)},[q]);const At=a.useCallback(t=>{console.log("[SELECTION-CHANGE] ===== SELECTION CHANGED ====="),console.log("[SELECTION-CHANGE] New selected items:",t),console.log("[SELECTION-CHANGE] Item count:",t.length),console.log("[SELECTION-CHANGE] Item types:",t.map(n=>typeof n)),console.log("[SELECTION-CHANGE] Current products count:",x.length),console.log("[SELECTION-CHANGE] Current products IDs:",x.map(n=>n.id)),se(t),t.length===0&&ue(!1)},[x]),st=a.useCallback(t=>{ue(t),se(t?x.map(n=>n.id):[])},[x]),De=a.useMemo(()=>{if(w)return G;const t=x.filter(o=>h.includes(o.id));if(t.length===0)return G;const n=Math.max(...t.map(o=>{var d,l;return((l=(d=o.optimizationSummary)==null?void 0:d.optimizedLanguages)==null?void 0:l.length)||0})),s=Math.max(0,G-n);return console.log(`[LANGUAGE-LIMIT] Plan limit: ${G}, Max optimized: ${n}, Max new: ${s}`),s},[x,h,w,G]),Lt=()=>{if(h.length===0&&!w){P("Please select products first");return}Se(!0)},Ot=()=>{if(h.length===0&&!w){P("Please select products first");return}re([]),le(!0)},vt=async()=>{const n=x.filter(o=>h.includes(o.id)).filter(o=>{var d,l;return((l=(d=o.optimizationSummary)==null?void 0:d.optimizedLanguages)==null?void 0:l.length)>0});Z({processing:!0,current:0,total:n.length,currentItem:"",results:null});const s={successful:0,failed:0,skipped:0};for(let o=0;o<n.length;o++){const d=n[o];Z(l=>({...l,current:o,currentItem:d.title}));try{const l=await p("/ai-enhance/product",{method:"POST",shop:i,body:{shop:i,productId:d.gid||ce(d.id),languages:d.optimizationSummary.optimizedLanguages}});if(l.results&&l.results.length>0){const m={shop:i,productId:d.gid||ce(d.id),results:l.results.filter(g=>g.bullets&&g.faq).map(g=>({language:g.language,seo:{...g.updatedSeo,bullets:g.bullets||[],faq:g.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},u=await p("/api/seo/apply-multi",{method:"POST",shop:i,body:m});s.successful++}else s.failed++}catch(l){if(console.error("Enhancement error:",l),l.status===402||l.requiresPurchase||l.trialRestriction){Z({processing:!1,current:0,total:0,currentItem:"",results:null}),Te(l),et(l.currentPlan||O||"starter"),l.trialRestriction?Me(!0):Ze(!0);return}s.failed++}Z(l=>({...l,current:o+1}))}Z(o=>({...o,processing:!1,results:s})),P(`AI enhancement complete! ${s.successful} products enhanced.`)},Re=()=>{yt(!1),Z({processing:!1,current:0,total:0,currentItem:"",results:null}),L.results&&L.results.successful>0&&H(1,!1,null)},kt=()=>L.processing?e.jsx(E,{open:Xe,title:"Processing AI Enhancement",onClose:Re,noScroll:!0,children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",L.currentItem]}),e.jsx(nt,{progress:L.current/L.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[L.current," of ",L.total," products (",Math.round(L.current/L.total*100),"%)"]})]})})}):L.results!==null?e.jsx(E,{open:Xe,title:"AI Enhancement Results",onClose:Re,primaryAction:{content:"Done",onAction:Re},children:e.jsx(E.Section,{children:e.jsx(R,{gap:"300",children:e.jsxs(y,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:L.results.successful})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:L.results.failed})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:L.results.skipped})]})]})})})}):null,Mt=async()=>{var n;if(!z.length){P("Please select at least one language");return}let t=ht;(!t||!t.trim())&&(t=((n=pt[0])==null?void 0:n.value)||"anthropic/claude-3.5-sonnet"),Se(!1),J(!0),B({current:0,total:0,percent:0}),oe([]),Qe({});try{let s=[];w?s=(await p(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:s=x.filter(f=>h.includes(f.id));const o=W(O),d=s.length;s=s.slice(0,o);const l=s.length,m=d-l;B({current:0,total:l,percent:0});const u=5,g={};for(let f=0;f<s.length;f+=u){const C=s.slice(f,Math.min(f+u,s.length)).map(async I=>{var ee;X(I.title||I.handle||"Product");try{const be=I.gid||ce(I.productId||I.id),$e=((ee=I.optimizationSummary)==null?void 0:ee.optimizedLanguages)||[],Be=z.filter(Ht=>!$e.includes(Ht));if(Be.length===0){g[I.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Gt=await p("/api/seo/generate-multi",{method:"POST",shop:i,body:{shop:i,productId:be,model:t,languages:Be}});g[I.id]={success:!0,data:Gt,languages:Be}}catch(be){g[I.id]={success:!1,error:be.message},oe($e=>[...$e,{product:I.title,error:be.message}])}});await Promise.all(C);const D=Math.min(f+u,s.length),ie=Math.round(D/l*100);B({current:D,total:l,percent:ie})}Qe(g),ke(!0);const S=Object.keys(g).filter(f=>g[f].success&&!g[f].skipped).length,j=Object.keys(g).filter(f=>g[f].skipped).length;let $=`Generated Optimization for AI Search for ${S} products`;j>0&&($+=` (${j} already optimised)`),m>0&&($+=` (${m} skipped due to plan limit)`),P($)}catch(s){P(`Error: ${s.message}`)}finally{J(!1),X("")}},Tt=async()=>{var t,n;J(!0),B({current:0,total:0,percent:0});try{const s=Object.entries(ae).filter(([m,u])=>u.success&&!u.skipped),o=s.length;B({current:0,total:o,percent:0});for(let m=0;m<s.length;m++){const[u,g]=s[m],S=x.find(f=>f.id===u);if(!S)continue;X(S.title||"Product");try{const f=S.gid||ce(S.productId||S.id),k=await p("/api/seo/apply-multi",{method:"POST",shop:i,body:{shop:i,productId:f,results:g.data.results.filter(C=>C==null?void 0:C.seo).map(C=>({language:C.language,seo:C.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});k.appliedLanguages&&k.appliedLanguages.length>0&&F(C=>C.map(D=>{var ie;if(D.id===u){const I=((ie=D.optimizationSummary)==null?void 0:ie.optimizedLanguages)||[],ee=[...new Set([...I,...k.appliedLanguages])];return{...D,optimizationSummary:{...D.optimizationSummary,optimizedLanguages:ee,optimized:!0,lastOptimized:new Date().toISOString()}}}return D}))}catch(f){oe(k=>[...k,{product:S.title,error:`Apply failed: ${f.message}`}])}const j=m+1,$=Math.round(j/o*100);B({current:j,total:o,percent:$})}P("AI Search Optimisation applied successfully!"),ke(!1),console.log("[APPLY-SEO] ===== CLEARING SELECTION ====="),console.log("[APPLY-SEO] Selected items BEFORE clear:",h),se([]),ue(!1),console.log("[APPLY-SEO] Selected items cleared"),console.log("[APPLY-SEO] Waiting for database propagation..."),await new Promise(m=>setTimeout(m,1e3)),console.log("[APPLY-SEO] Clearing products state before reload..."),F([]);const d=new URLSearchParams({shop:i,page:1,limit:50,...T!=="all"&&{optimized:T},...q&&{search:q},...M&&{languageFilter:M},...U.length>0&&{tags:U.join(",")},sortBy:ge,sortOrder:V,_t:Date.now()}),l=await p(`/api/products/list?${d}`,{shop:i,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});F(l.products||[]),We(1),Ie(((t=l.pagination)==null?void 0:t.hasNext)||!1),Ge(((n=l.pagination)==null?void 0:n.total)||0)}catch(s){P(`Error applying AI Search Optimisation: ${s.message}`)}finally{J(!1),X("")}},zt=async()=>{var t;if(!N.length){P("Please select at least one language to delete");return}le(!1),xe(!1),J(!0),B({current:0,total:0,percent:0}),oe([]);try{let n=[];w?n=(await p(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:n=x.filter(l=>h.includes(l.id));const s=n.length;B({current:0,total:s,percent:0});let o=0,d=0;for(let l=0;l<n.length;l++){const m=n[l];X(m.title||m.handle||"Product");try{const S=m.gid||ce(m.productId||m.id),j=((t=m.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],$=N.filter(k=>j&&j.length>0&&j.includes(k));if($.length===0){d++;continue}const f=await p("/api/seo/delete-multi",{method:"POST",shop:i,body:{shop:i,productId:S,languages:$}});f.deletedLanguages&&f.deletedLanguages.length>0&&F(k=>k.map(C=>{var D;if(C.id===m.id){const I=(((D=C.optimizationSummary)==null?void 0:D.optimizedLanguages)||[]).filter(ee=>!f.deletedLanguages.includes(ee));return{...C,optimizationSummary:{...C.optimizationSummary,optimizedLanguages:I,optimized:I.length>0,lastOptimized:I.length>0?C.optimizationSummary.lastOptimized:null}}}return C})),o++,f.deletedLanguages&&f.deletedLanguages.length>0&&await p("/api/products/verify-after-delete",{method:"POST",shop:i,body:{shop:i,productIds:[S],deletedLanguages:f.deletedLanguages}})}catch(S){oe(j=>[...j,{product:m.title,error:S.message}])}const u=l+1,g=Math.round(u/s*100);B({current:u,total:s,percent:g})}se([]),ue(!1),d>0?P(`Deleted Optimization for AI Search from ${o} products (${d} had no optimisation to delete)`):P(`Deleted Optimization for AI Search from ${o} products`),setTimeout(()=>{const l=Date.now();H(1,!1,l)},500)}catch(n){P(`Error: ${n.message}`)}finally{J(!1),X("")}},Dt=t=>{var n,s;try{const o=t,d=ts(o.productId||o.id),l=((n=o.optimizationSummary)==null?void 0:n.optimizedLanguages)||[];console.log(`[BULK-EDIT-RENDER] Product: "${o.title}", ID: ${o.id}, Type: ${typeof o.id}`),console.log("[BULK-EDIT-RENDER] Optimized Languages:",l),console.log("[BULK-EDIT-RENDER] Selected Items:",h),console.log("[BULK-EDIT-RENDER] Is Selected:",h.includes(o.id));const m=(s=o.images)!=null&&s[0]?e.jsx(at,{source:o.images[0].url||o.images[0].src||o.images[0],alt:o.title,size:"small"}):o.imageUrl?e.jsx(at,{source:o.imageUrl,alt:o.title,size:"small"}):e.jsx(c,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Xt,{id:o.id,media:m,accessibilityLabel:`View details for ${o.title}`,onClick:u=>{console.log("[ResourceItem] ===== CLICK ON RESOURCE ITEM ====="),console.log("[ResourceItem] e.target:",u.target),console.log("[ResourceItem] e.target.tagName:",u.target.tagName),console.log('[ResourceItem] e.target.closest("input"):',u.target.closest("input")),console.log('[ResourceItem] e.target.closest("a"):',u.target.closest("a")),console.log("[ResourceItem] Event bubbling up...")},children:e.jsxs(y,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(c,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:o.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["ID: ",d]})]}),e.jsx(c,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(y,{gap:"100",children:A.length>0?A.map(u=>{const g=l.includes(u);return e.jsx(_,{tone:g?"success":"subdued",size:"small",children:u.toUpperCase()},u)}):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),l.map(u=>e.jsx(_,{tone:"success",size:"small",children:u.toUpperCase()},u)))})}),e.jsx(c,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(_,{tone:"success",children:"Active"})})]})})}catch(o){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",o),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},Rt=ve&&e.jsx(E,{open:ve,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:Ve?`Processing: ${Ve}`:"Preparing..."}),e.jsx(nt,{progress:me.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[me.current," of ",me.total," products (",me.percent,"%)"]})]})})}),Ut=e.jsx(E,{open:St,title:"Select Languages",onClose:()=>{Se(!1),Q([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Mt,disabled:z.length===0||z.length>De},secondaryActions:[{content:"Cancel",onAction:()=>{Se(!1),Q([])}}],children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",w?"all":h.length," selected products:"]}),z.length>De&&e.jsx(Ne,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(R,{gap:"200",children:[e.jsxs(r,{variant:"bodyMd",children:["You can add up to ",De," new language(s) (your plan supports ",G," total, and some products already have optimizations)."]}),e.jsxs(r,{variant:"bodyMd",children:["You selected ",z.length," new language(s). Please deselect some or upgrade your plan:"]}),e.jsx(v,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),n=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${n}`},children:"Upgrade Plan"})]})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:A.map(t=>e.jsx(Pe,{label:t.toUpperCase(),checked:z.includes(t),onChange:n=>{Q(n?[...z,t]:z.filter(s=>s!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(v,{plain:!0,onClick:()=>{z.length===A.length?Q([]):A.length>G?(Q([...A]),P(`You selected ${A.length} languages. Your ${ze} plan supports ${G}. Please deselect or upgrade.`)):Q([...A])},children:z.length===A.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),$t=e.jsx(E,{open:ft&&!ve,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:Tt,disabled:!Object.values(ae).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>ke(!1)}],children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsxs(y,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(ae).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(ae).filter(t=>t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(ae).filter(t=>!t.success).length})]})]}),fe.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Yt,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(c,{maxHeight:"200px",overflowY:"scroll",children:[fe.slice(0,10).map((t,n)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},n)),fe.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",fe.length-10," more errors"]})]})]})]})})}),Bt=e.jsx(E,{open:xt,title:"Delete Optimization for AI Search",onClose:()=>{le(!1),re([])},primaryAction:{content:"Continue",onAction:()=>{le(!1),xe(!0)},disabled:N.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{le(!1),re([])}}],children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",w?"all":h.length," selected products:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:A.map(t=>e.jsx(Pe,{label:t.toUpperCase(),checked:N.includes(t),onChange:n=>{re(n?[...N,t]:N.filter(s=>s!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(v,{plain:!0,onClick:()=>{re(N.length===A.length?[]:[...A])},children:N.length===A.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Nt=e.jsx(E,{open:jt,title:"Confirm Deletion",onClose:()=>{xe(!1)},primaryAction:{content:"Delete",onAction:zt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>xe(!1)}],children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(c,{paddingBlock:"200",children:e.jsx(y,{gap:"100",children:N.map(t=>e.jsx(_,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",w?"ALL":h.length," selected products."]}),e.jsx(r,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Ue=async()=>{try{de(!0),P("Syncing products from Shopify...");const t=await p("/api/products/sync",{method:"POST",shop:i});if(t.success){const n=t.productsCount||t.synced||0;P(`✅ Synced ${n} products successfully!`),setTimeout(()=>{H(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),P(`❌ Sync failed: ${t.message}`)}finally{de(!1)}},Wt=e.jsx(Zt,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{He(""),he("all"),ne(""),pe([]),H(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Ue},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(ot,{children:e.jsxs(c,{padding:"400",children:[e.jsxs(R,{gap:"300",children:[O&&e.jsx(Ne,{tone:"info",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(r,{children:["Your ",e.jsx("strong",{children:O})," plan includes up to"," ",e.jsx("strong",{children:W(O)})," products for SEO optimization.",K>W(O)&&e.jsxs(e.Fragment,{children:[" You have ",K," products, so only the first ",W(O)," will be processed."]})]}),(h.length>0||w)&&e.jsxs(r,{children:["Selected: ",w?Math.min(K,W(O)):h.length,"/",W(O)]})]})}),O&&(h.length>W(O)||w&&K>W(O))&&e.jsx(Ne,{tone:"warning",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(r,{children:[e.jsx("strong",{children:"Plan Limit Exceeded:"})," You've selected more products than your ",O," plan allows. Only the first ",W(O)," products will be processed."]}),e.jsx(v,{size:"micro",onClick:()=>Me(!0),children:"Upgrade Plan"})]})}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(c,{minWidth:"400px",children:e.jsx(_t,{label:"",placeholder:"Search by product ID, name, or details...",value:q,onChange:tt,prefix:e.jsx(Vt,{}),clearButton:!0,onClearButtonClick:()=>tt("")})}),e.jsx(c,{width:"320px",children:e.jsx(v,{primary:!0,onClick:Lt,disabled:h.length===0&&!w,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(v,{onClick:Ue,disabled:te,size:"medium",children:"Sync Products"}),e.jsx(c,{width:"320px",children:e.jsxs(R,{gap:"200",align:"end",children:[h.length===0&&!w||!x.filter(s=>h.includes(s.id)).some(s=>{var o,d;return((d=(o=s.optimizationSummary)==null?void 0:o.optimizedLanguages)==null?void 0:d.length)>0})?null:e.jsx(v,{onClick:vt,disabled:h.length===0&&!w,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(v,{onClick:Ot,disabled:h.length===0&&!w||!x.filter(s=>h.includes(s.id)).some(s=>{var o,d;return((d=(o=s.optimizationSummary)==null?void 0:o.optimizedLanguages)==null?void 0:d.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),K>0&&e.jsx(c,{paddingBlockStart:"300",children:e.jsx(Pe,{label:`Select all ${K} products in your store`,checked:w,onChange:st})})]})}),e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(ot,{children:[e.jsxs(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(y,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(y,{gap:"200",wrap:!0,children:[e.jsx(we,{active:Fe,activator:e.jsx(v,{disclosure:"down",onClick:()=>Ee(!Fe),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),T!=="all"&&e.jsx(c,{onClick:t=>{t.stopPropagation(),he("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Ee(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Ce,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[T],onChange:t=>{he(t[0]),ne(""),Ee(!1)}})})}),e.jsx(we,{active:Ke,activator:e.jsx(v,{disclosure:"down",onClick:()=>Ae(!Ke),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),M&&e.jsx(c,{onClick:t=>{t.stopPropagation(),ne("")},children:e.jsx(r,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Ae(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Ce,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...A.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...A.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:M?[M]:[],onChange:t=>{ne(t[0]||""),Ae(!1)}})})}),e.jsx(we,{active:qe,activator:e.jsx(v,{disclosure:"down",onClick:()=>Le(!qe),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),U.length>0&&e.jsx(c,{onClick:t=>{t.stopPropagation(),pe([])},children:e.jsx(r,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Le(!1),children:e.jsxs(c,{padding:"300",minWidth:"200px",children:[e.jsx(Ce,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:dt.map(t=>({label:t,value:t})),selected:U,onChange:t=>{pe(t)}}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(v,{size:"slim",onClick:()=>Le(!1),children:"Apply"})})]})})]}),e.jsx(we,{active:Ye,activator:e.jsx(v,{disclosure:"down",onClick:()=>Oe(!Ye),removeUnderline:!0,children:e.jsx(y,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:V==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Oe(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Ce,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[V],onChange:t=>{ct(t[0]),Oe(!1)}})})})]}),(T!=="all"||M||U.length>0)&&e.jsx(c,{paddingBlockStart:"200",children:e.jsxs(y,{gap:"100",wrap:!0,children:[T!=="all"&&e.jsx(_,{onRemove:()=>he("all"),children:T==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),M&&e.jsx(_,{onRemove:()=>ne(""),children:M.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),U.map(t=>e.jsxs(_,{onRemove:()=>pe(n=>n.filter(s=>s!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(c,{children:[e.jsx(c,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(y,{gap:"200",align:"start",children:[e.jsx(Pe,{checked:h.length===x.length&&x.length>0,onChange:st,label:""}),e.jsxs(r,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",h.length>0&&` (${h.length} selected products)`]})]})}),e.jsx(Qt,{resourceName:{singular:"product",plural:"products"},items:x,renderItem:Dt,selectedItems:h,onSelectionChange:At,selectable:!0,loading:te,totalItemsCount:K,emptyState:Wt,showHeader:!1},`products-${x.length}-${h.length}`)]}),it&&!te&&e.jsx(c,{padding:"400",textAlign:"center",children:e.jsx(v,{onClick:()=>H(rt+1,!0,null),children:"Load more"})})]})}),Rt,Ut,$t,Bt,Nt,kt(),e.jsx(E,{open:wt,onClose:()=>je(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{je(!1),Ue()}},secondaryActions:[{content:"Skip for now",onAction:()=>je(!1)}],children:e.jsx(E.Section,{children:e.jsxs(R,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(r,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Kt,{open:It,onClose:()=>{Me(!1),Te(null)},featureName:"AI Enhancement",currentPlan:ze}),Y&&e.jsx(qt,{open:Et,onClose:()=>{Ze(!1),Te(null)},tokensRequired:Y.tokensRequired||0,tokensAvailable:Y.tokensAvailable||0,tokensNeeded:Y.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:i,needsUpgrade:Y.needsUpgrade||!1,minimumPlan:Y.minimumPlanForFeature||null,currentPlan:Y.currentPlan||ze}),Je&&e.jsx(Jt,{content:Je,onDismiss:()=>P("")})]})}export{is as default};
