import{r as e,j as t}from"./react-vendor-BLtYaay5.js";import{C as a,B as i,a as s,I as o,T as n,b as r,D as d,e as l,d as c}from"./polaris-DLzuUptG.js";const u={productsJson:"Products JSON Feed",basicSitemap:"Basic Sitemap",robotsTxt:"robots.txt.liquid",schemaData:"Schema Data (theme.liquid)",welcomePage:"AI Welcome Page",collectionsJson:"Collections JSON Feed",storeMetadata:"Store Metadata",aiSitemap:"AI-Enhanced Sitemap",advancedSchemaApi:"Advanced Schema Data"};function g({testResults:g={},aiTestResults:h={},stats:p={},shop:m="",api:b=null,onTestsComplete:v=null,onScoreCalculated:x=null}){const[f,y]=e.useState(!1),j=Object.keys(g).length>0,M=e=>{const t=Math.max(0,Math.min(100,e))/100;return`rgb(${Math.round(239+-223*t)}, ${Math.round(68+117*t)}, ${Math.round(68+61*t)})`},w=e.useMemo(()=>((e,t,a,i)=>{var s,o,n,r,d,l,c;const u={endpointAvailability:0,aiValidationQuality:0,optimizationCoverage:0,structuredDataQuality:0,total:0},g={productsJson:5,basicSitemap:4,robotsTxt:2,schemaData:2,welcomePage:3,collectionsJson:4,storeMetadata:4,aiSitemap:3,advancedSchemaApi:3};let h=0,p=0;for(const[k,z]of Object.entries(e||{})){const e=g[k]||1;p+=e,"success"===z.status?h+=e:"warning"===z.status?h+=.7*e:"locked"===z.status&&(h+=.3*e)}u.endpointAvailability=p>0?Math.round(h/p*30):0;const m={excellent:1,good:.75,fair:.5,poor:.25,unavailable:0,locked:.1};let b=0,v=0;for(const[k,z]of Object.entries(t||{})){if("robotsTxt"===k||"schemaData"===k)continue;const e=(null==(s=z.rating)?void 0:s.toLowerCase())||"unavailable",t=g[k]||1;b+=(m[e]||0)*t,v+=t}u.aiValidationQuality=v>0?Math.round(b/v*40):0;const x=a.totalProducts||0,f=a.optimizedProducts||0,y=a.totalCollections||0,j=a.optimizedCollections||0;let M=0;if(x>0){M+=12*(f/x)}if(y>0){M+=8*(j/y)}else x>0&&(M+=8);u.optimizationCoverage=Math.round(M);let w=0;if("success"===(null==(o=null==e?void 0:e.schemaData)?void 0:o.status)&&(w+=3),"success"===(null==(n=null==e?void 0:e.storeMetadata)?void 0:n.status)){w+=3;const e=null==(d=null==(r=null==t?void 0:t.storeMetadata)?void 0:r.rating)?void 0:d.toLowerCase();"excellent"===e?w+=4:"good"===e&&(w+=2)}else"locked"===(null==(l=null==e?void 0:e.storeMetadata)?void 0:l.status)&&(w+=1);"success"===(null==(c=null==e?void 0:e.advancedSchemaApi)?void 0:c.status)&&(w+=2),u.structuredDataQuality=Math.min(10,Math.round(w)),u.total=Math.min(100,u.endpointAvailability+u.aiValidationQuality+u.optimizationCoverage+u.structuredDataQuality);let S="E",A="#ef4444";u.total>=80?(S="A",A="#10b981"):u.total>=60?(S="B",A="#3b82f6"):u.total>=40?(S="C",A="#f59e0b"):u.total>=20&&(S="D",A="#f97316");const $=[];if(u.endpointAvailability<20){const t=Object.entries(e||{}).filter(([e,t])=>"locked"===t.status).length,a=Object.entries(e||{}).filter(([e,t])=>"error"===t.status||"failed"===t.status).length;t>0&&0===a?$.push("Several AI discovery endpoints are locked due to plan limitations. Upgrade your plan to unlock them."):t>0&&a>0?$.push("Some endpoints are missing or not working. Others are locked due to plan limitations. Fix endpoint issues and upgrade your plan to improve your score."):$.push("Several AI discovery endpoints are missing or not working. Fix endpoint issues to improve your score.")}if(u.aiValidationQuality<30){const e=Object.entries(t||{}).filter(([e,t])=>{var a;const i=null==(a=t.rating)?void 0:a.toLowerCase();return("poor"===i||"fair"===i)&&"robotsTxt"!==e&&"schemaData"!==e}).map(([e])=>i[e]||e);e.length>0&&($.push(`${e.length} endpoint(s) have low data quality ratings. Improve content quality to boost your score.`),$.push(`Review and improve: ${e.join(", ")}`))}return u.optimizationCoverage<15&&($.push("Low optimization coverage. Optimize more products and collections to improve your score."),$.push("Go to Store Optimization for AI and optimize your products/collections")),u.structuredDataQuality<7&&$.push("Structured data could be improved. Add organization schema and enhance product schema."),{score:u.total,grade:S,gradeColor:A,breakdown:u,recommendations:$.length>0?$:["Your store is well-optimized for AI search engines!"]}})(g,h,p,u),[g,h,p]);return e.useEffect(()=>{x&&w&&x(w.score)},[w,x]),w?t.jsx(a,{children:t.jsx(i,{padding:"400",children:t.jsxs(s,{gap:"300",children:[t.jsxs(o,{align:"space-between",blockAlign:"center",children:[t.jsxs(s,{gap:"100",children:[t.jsx(n,{as:"h3",variant:"headingMd",children:"AIEO Score"}),t.jsx(n,{variant:"bodySm",tone:"subdued",children:"Overall AI Engine Optimization rating"})]}),b&&m&&t.jsx(r,{size:"slim",onClick:async()=>{if(b&&m){y(!0);try{const t=await b("/api/ai-testing/run-tests",{method:"POST",body:{shop:m}});if(t.results){try{localStorage.setItem(`ai-test-results-${m}`,JSON.stringify({results:t.results,timestamp:(new Date).toISOString()}))}catch(e){}v&&v(t.results)}}catch(t){}finally{y(!1)}}},loading:f,disabled:f,children:f?"Testing...":j?"Refresh Tests":"Run Basic Tests"})]}),t.jsx(d,{}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px"},children:[t.jsx(i,{style:{width:"138px",height:"138px",borderRadius:"50%",background:(e=>{const t=3.6*e,a=Math.max(0,Math.min(100,e))/100;let i=[];if(a<=.2)i=["#ef4444 0deg",`#ef4444 ${t}deg`,`#e5e7eb ${t}deg`,"#e5e7eb 360deg"];else if(a<=.4){i=["#ef4444 0deg",`#f97316 ${.5*t}deg`,`#f97316 ${t}deg`,`#e5e7eb ${t}deg`,"#e5e7eb 360deg"]}else if(a<=.6){i=["#ef4444 0deg",`#f97316 ${.33*t}deg`,`#f59e0b ${.66*t}deg`,`#f59e0b ${t}deg`,`#e5e7eb ${t}deg`,"#e5e7eb 360deg"]}else if(a<=.8){const e=216;i=["#ef4444 0deg",`#f97316 ${.2*t}deg`,`#f59e0b ${.4*t}deg`,`#22c55e ${Math.max(e,.7*t)}deg`,`#22c55e ${t}deg`,`#e5e7eb ${t}deg`,"#e5e7eb 360deg"]}else{const e=216;i=["#ef4444 0deg",`#f97316 ${.15*t}deg`,`#f59e0b ${.3*t}deg`,`#10b981 ${Math.max(e,.5*t)}deg`,`#10b981 ${t}deg`,`#e5e7eb ${t}deg`,"#e5e7eb 360deg"]}return`conic-gradient(${i.join(", ")})`})(w.score),display:"flex",alignItems:"center",justifyContent:"center",position:"relative",flexShrink:0},children:t.jsx(i,{style:{width:"103.5px",height:"103.5px",borderRadius:"50%",background:"white",position:"absolute",zIndex:1}})}),t.jsxs(s,{gap:"100",children:[t.jsxs(n,{variant:"headingMd",fontWeight:"semibold",style:{color:M(w.score)},children:["AIEO Score = ",w.score]}),t.jsxs(n,{variant:"headingMd",fontWeight:"bold",style:{color:M(w.score)},children:["AIEO Rating = ",w.grade]})]})]}),t.jsxs(s,{gap:"200",children:[t.jsx(n,{variant:"headingSm",children:"Score Breakdown"}),t.jsxs(s,{gap:"100",children:[t.jsxs(o,{align:"space-between",children:[t.jsx(n,{variant:"bodyMd",children:"Endpoint Availability"}),t.jsxs(n,{variant:"bodyMd",fontWeight:"semibold",children:[w.breakdown.endpointAvailability,"/30"]})]}),t.jsx(l,{progress:Math.round(w.breakdown.endpointAvailability/30*100),size:"small",tone:"success"})]}),t.jsxs(s,{gap:"100",children:[t.jsxs(o,{align:"space-between",children:[t.jsx(n,{variant:"bodyMd",children:"AI Validation Quality"}),t.jsxs(n,{variant:"bodyMd",fontWeight:"semibold",children:[w.breakdown.aiValidationQuality,"/40"]})]}),t.jsx(l,{progress:Math.round(w.breakdown.aiValidationQuality/40*100),size:"small",tone:"success"})]}),t.jsxs(s,{gap:"100",children:[t.jsxs(o,{align:"space-between",children:[t.jsx(n,{variant:"bodyMd",children:"Optimization Coverage"}),t.jsxs(n,{variant:"bodyMd",fontWeight:"semibold",children:[w.breakdown.optimizationCoverage,"/20"]})]}),t.jsx(l,{progress:Math.round(w.breakdown.optimizationCoverage/20*100),size:"small",tone:"success"})]}),t.jsxs(s,{gap:"100",children:[t.jsxs(o,{align:"space-between",children:[t.jsx(n,{variant:"bodyMd",children:"Structured Data Quality"}),t.jsxs(n,{variant:"bodyMd",fontWeight:"semibold",children:[w.breakdown.structuredDataQuality,"/10"]})]}),t.jsx(l,{progress:Math.round(w.breakdown.structuredDataQuality/10*100),size:"small",tone:"success"})]})]})]}),w.recommendations&&w.recommendations.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(d,{}),t.jsxs(s,{gap:"200",children:[t.jsx(n,{variant:"headingSm",children:"Recommendations"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:w.recommendations.map((e,a)=>t.jsx(c,{tone:e.includes("Fix")||e.includes("Improve")||e.includes("low")?"critical":e.includes("Review")?"warning":"info",children:t.jsx(n,{variant:"bodyMd",children:e})},a))})]})]})]})})}):null}export{g as A};
