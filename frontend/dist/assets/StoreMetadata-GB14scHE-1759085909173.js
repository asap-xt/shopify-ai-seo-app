import{j as n}from"./app-bridge-C5IPOfn6-1759085909173.js";import{r}from"./react-vendor-tAaa2TlE-1759085909173.js";import{m as H}from"./index-B5qZEQ_l-1759085909172.js";import{C as m,a as g,T as v,h as X,L as u,s as S,i as s,f as K,I as N,B as y,k as Y}from"./polaris-B9CwvHTo-1759085909173.js";const J=(p,l="")=>{try{return new URLSearchParams(window.location.search).get(p)||l}catch{return l}};function ea({shop:p}){var k;const l=p||J("shop",""),[_,j]=r.useState(!1),[D,b]=r.useState(!1),[M,c]=r.useState(""),[d,V]=r.useState(null),x=r.useMemo(()=>H({}),[]),[O,C]=r.useState(!1),[$,z]=r.useState(!1),[t,i]=r.useState({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}});r.useEffect(()=>{l&&q()},[l,x]);async function q(){j(!0);try{const a=`/api/store/generate?shop=${encodeURIComponent(l)}`;console.log("[StoreMeta] GET",a);const e=await x(a,{headers:{"X-Shop":l}});if(console.log("[StoreMeta] GET ok",{url:a,keys:Object.keys(e||{})}),V(e),e.existingMetadata){const o=e.existingMetadata;i(h=>{var w,T,P,A,I,B,L,E,U,R;return{...h,seo:{...h.seo,...((w=o.seo_metadata)==null?void 0:w.value)||{},keywords:Array.isArray((P=(T=o.seo_metadata)==null?void 0:T.value)==null?void 0:P.keywords)?o.seo_metadata.value.keywords.join(", "):((I=(A=o.seo_metadata)==null?void 0:A.value)==null?void 0:I.keywords)||h.seo.keywords||""},aiMetadata:((B=o.ai_metadata)==null?void 0:B.value)||h.aiMetadata,organizationSchema:{...h.organizationSchema,...((L=o.organization_schema)==null?void 0:L.value)||{},enabled:((U=(E=o.organization_schema)==null?void 0:E.value)==null?void 0:U.enabled)===!0},localBusinessSchema:((R=o.local_business_schema)==null?void 0:R.value)||h.localBusinessSchema}})}e.shopInfo&&i(o=>({...o,seo:{...o.seo,title:o.seo.title||e.shopInfo.name},organizationSchema:{...o.organizationSchema,name:o.organizationSchema.name||e.shopInfo.name,email:o.organizationSchema.email||e.shopInfo.email}}))}catch(a){console.error("[StoreMeta] GET error",(a==null?void 0:a.debug)||a,a),c(`Load failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{j(!1)}}async function f(){b(!0);try{const a=`/api/store/apply?shop=${encodeURIComponent(l)}`;console.log("[StoreMeta] SAVE",a);const e=await x(a,{method:"POST",headers:{"X-Shop":l},body:{metadata:t,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:t.organizationSchema.enabled,updateLocalBusiness:t.localBusinessSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:a,ok:e==null?void 0:e.ok}),c("Metadata saved successfully!")}catch(a){console.error("[StoreMeta] SAVE error",(a==null?void 0:a.debug)||a,a),c(`Save failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{b(!1)}}async function F(){C(!0);try{await f();const a=`/api/store/public/${encodeURIComponent(l)}`;window.open(a,"_blank")}catch(a){c(`Preview failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{C(!1)}}async function G(){z(!0);try{i({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}}),await f(),c("Metadata cleared successfully!")}catch(a){c(`Clear failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{z(!1)}}return _&&!d?n.jsx(m,{children:n.jsx(g,{padding:"400",children:n.jsx(v,{children:"Loading store data..."})})}):(d==null?void 0:d.plan)==="Starter"?n.jsx(X,{status:"warning",children:n.jsx(v,{children:"Store metadata features are available starting from the Professional plan."})}):n.jsxs(u,{children:[n.jsx(u.Section,{children:n.jsx(m,{title:"Basic Store Information",children:n.jsx(g,{padding:"400",children:n.jsxs(S,{children:[n.jsx(s,{label:"SEO Title",value:t.seo.title,onChange:a=>i(e=>({...e,seo:{...e.seo,title:a}})),helpText:"Title for search engines (max 70 chars)",maxLength:70}),n.jsx(s,{label:"Meta Description",value:t.seo.metaDescription,onChange:a=>i(e=>({...e,seo:{...e.seo,metaDescription:a}})),helpText:"Description for search results (150-160 chars)",maxLength:160,multiline:3}),n.jsx(s,{label:"Keywords",value:t.seo.keywords,onChange:a=>i(e=>({...e,seo:{...e.seo,keywords:a}})),helpText:"Comma-separated keywords"})]})})})}),n.jsx(u.Section,{children:n.jsx(m,{title:"AI Metadata",children:n.jsx(g,{padding:"400",children:n.jsxs(S,{children:[n.jsxs(S.Group,{children:[n.jsx(s,{label:"Business Type",value:t.aiMetadata.businessType,onChange:a=>i(e=>({...e,aiMetadata:{...e.aiMetadata,businessType:a}})),placeholder:"e.g., Fashion Retailer, Electronics Store"}),n.jsx(s,{label:"Target Audience",value:t.aiMetadata.targetAudience,onChange:a=>i(e=>({...e,aiMetadata:{...e.aiMetadata,targetAudience:a}})),placeholder:"e.g., Young professionals, Parents"})]}),n.jsx(s,{label:"Unique Selling Points",value:t.aiMetadata.uniqueSellingPoints,onChange:a=>i(e=>({...e,aiMetadata:{...e.aiMetadata,uniqueSellingPoints:a}})),helpText:"Comma-separated list",multiline:2}),n.jsx(s,{label:"Brand Voice",value:t.aiMetadata.brandVoice,onChange:a=>i(e=>({...e,aiMetadata:{...e.aiMetadata,brandVoice:a}})),placeholder:"e.g., Professional, Friendly, Casual"}),n.jsx(s,{label:"Primary Categories",value:t.aiMetadata.primaryCategories,onChange:a=>i(e=>({...e,aiMetadata:{...e.aiMetadata,primaryCategories:a}})),helpText:"Main product categories, comma-separated"}),n.jsx(s,{label:"Shipping Information",value:t.aiMetadata.shippingInfo,onChange:a=>i(e=>({...e,aiMetadata:{...e.aiMetadata,shippingInfo:a}})),multiline:2}),n.jsx(s,{label:"Return Policy",value:t.aiMetadata.returnPolicy,onChange:a=>i(e=>({...e,aiMetadata:{...e.aiMetadata,returnPolicy:a}})),multiline:2})]})})})}),((k=d==null?void 0:d.features)==null?void 0:k.organizationSchema)&&n.jsx(u.Section,{children:n.jsx(m,{title:"Organization Schema",children:n.jsxs(g,{padding:"400",children:[n.jsx(K,{label:"Enable Organization Schema",checked:t.organizationSchema.enabled,onChange:a=>i(e=>({...e,organizationSchema:{...e.organizationSchema,enabled:a}}))}),t.organizationSchema.enabled&&n.jsx(g,{paddingBlockStart:"400",children:n.jsxs(S,{children:[n.jsxs(S.Group,{children:[n.jsx(s,{label:"Organization Name",value:t.organizationSchema.name,onChange:a=>i(e=>({...e,organizationSchema:{...e.organizationSchema,name:a}}))}),n.jsx(s,{label:"Contact Email",value:t.organizationSchema.email,onChange:a=>i(e=>({...e,organizationSchema:{...e.organizationSchema,email:a}})),type:"email"})]}),n.jsx(s,{label:"Phone",value:t.organizationSchema.phone,onChange:a=>i(e=>({...e,organizationSchema:{...e.organizationSchema,phone:a}})),type:"tel"}),n.jsx(s,{label:"Logo URL",value:t.organizationSchema.logo,onChange:a=>i(e=>({...e,organizationSchema:{...e.organizationSchema,logo:a}})),type:"url"}),n.jsx(s,{label:"Social Media Links",value:t.organizationSchema.sameAs,onChange:a=>i(e=>({...e,organizationSchema:{...e.organizationSchema,sameAs:a}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}),n.jsx(u.Section,{children:n.jsx(m,{children:n.jsx(g,{padding:"400",children:n.jsxs(N,{gap:"300",children:[n.jsx(y,{onClick:f,loading:D,primary:!0,children:"Save Metadata"}),n.jsx(y,{onClick:F,loading:O,children:"Preview Metadata"}),n.jsx(y,{onClick:G,loading:$,destructive:!0,children:"Clear Metadata"})]})})})}),M&&n.jsx(Y,{content:M,onDismiss:()=>c("")})]})}export{ea as default};
