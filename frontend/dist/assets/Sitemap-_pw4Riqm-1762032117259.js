import{j as e}from"./app-bridge-FtywbJMM-1762032117259.js";import{r as i}from"./react-vendor-tAaa2TlE-1762032117259.js";import{m as G}from"./sessionFetch-CJepNHo3-1762032117259.js";import{C as z,B as o,a as h,d as W,I as l,n as L,T as t,b as _,o as j,p as S,q,r as Q,k as D}from"./polaris-DRaC-UAa-1762032117259.js";const O=(b,n="")=>{try{return new URLSearchParams(window.location.search).get(b)||n}catch{return n}},C=b=>{const n=(b||"starter").toLowerCase().replace(/\s+/g,"_"),r={starter:{products:100,languages:1},professional:{products:250,languages:2},professional_plus:{products:250,languages:2},growth:{products:700,languages:3},growth_plus:{products:700,languages:3},growth_extra:{products:1e3,languages:6},enterprise:{products:2500,languages:10}};return r[n]||r.starter};function V({shop:b}){const n=b||O("shop",""),[r,$]=i.useState(null),[w,M]=i.useState(!1),[v,A]=i.useState(!1),[P,p]=i.useState(""),[c,F]=i.useState(null),[a,I]=i.useState(null),[g,B]=i.useState(!1),m=i.useMemo(()=>G(),[]),y=i.useCallback(async()=>{if(n)try{const s=await m(`/api/sitemap/info?shop=${n}`);$(s)}catch(s){p(s.message||"Failed to load sitemap info")}},[n,m]),E=i.useCallback(async()=>{var s,x,f;if(n)try{const d=await m("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
        query PlansMe($shop:String!) {
          plansMe(shop:$shop) {
            shop
            plan
            planKey
            priceUsd
            product_limit
            providersAllowed
            modelsSuggested
            autosyncCron
            trial {
              active
              ends_at
              days_left
            }
          }
        }
      `,variables:{shop:n}})});if((s=d==null?void 0:d.errors)!=null&&s.length)throw new Error(((x=d.errors[0])==null?void 0:x.message)||"GraphQL error");const u=(f=d==null?void 0:d.data)==null?void 0:f.plansMe;F(u||null)}catch{}},[n,m]),R=i.useCallback(async()=>{var s,x,f,k;if(n){M(!0),I(null);try{const d=await fetch(`/api/sitemap/generate?shop=${encodeURIComponent(n)}`,{method:"POST",credentials:"include",headers:{Authorization:`Bearer ${((f=(x=(s=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:s.getState())==null?void 0:x.session)==null?void 0:f.token)||""}`,"Content-Type":"application/json"}});if(d.ok){const u=await d.json();console.log("[SITEMAP] Generation response:",u),u.success?(p(u.message||"Sitemap generation started!"),I(u.job),(k=u.job)!=null&&k.queued&&B(!0)):p(u.message||"Sitemap generation failed")}else{const u=await d.text();p(`Sitemap generation failed: ${u}`)}}catch(d){console.error("[SITEMAP] Generation error:",d),p(d.message||"Sitemap generation failed")}finally{M(!1)}}},[n]),T=i.useCallback(async()=>{if(!(!n||!g))try{const s=await m(`/api/sitemap/status?shop=${n}`);console.log("[SITEMAP] Status:",s),I(s.queue),(s.queue.status==="completed"||s.queue.status==="failed"||s.queue.status==="idle")&&(B(!1),p(s.queue.message||"Sitemap generation completed!"),await y())}catch(s){console.error("[SITEMAP] Status check error:",s)}},[n,g,m,y]);i.useEffect(()=>{if(g){const s=setInterval(T,3e3);return()=>clearInterval(s)}},[g,T]);const U=i.useCallback(async()=>{if(n){A(!0);try{const s=`/api/sitemap/generate?shop=${encodeURIComponent(n)}&force=true&t=${Date.now()}`,x=window.open(s,"_blank");setTimeout(()=>{A(!1)},2e3)}catch{A(!1),p("Failed to open sitemap")}}},[n]);return i.useEffect(()=>{y(),E()},[y,E]),e.jsxs(z,{children:[e.jsx(o,{padding:"400",children:e.jsxs(h,{gap:"400",children:[e.jsx(W,{tone:"info",children:e.jsxs("p",{children:["Your ",(c==null?void 0:c.plan)||"Starter"," plan includes up to"," ",e.jsx("strong",{children:(()=>{const s=C(c==null?void 0:c.plan);return`${s.products.toLocaleString()} products in up to ${s.languages} language${s.languages>1?"s":""}`})()}),".",(r==null?void 0:r.productCount)&&r.productCount>C(c==null?void 0:c.plan).products&&e.jsxs(e.Fragment,{children:[" You have ",r.productCount," products, so only the first"," ",C(c==null?void 0:c.plan).products.toLocaleString()," ","will be included in the sitemap."]})]})}),(g||a)&&e.jsx(W,{tone:(a==null?void 0:a.status)==="processing"?"info":(a==null?void 0:a.status)==="failed"?"critical":"success",children:e.jsxs(h,{gap:"200",children:[e.jsxs(l,{gap:"200",blockAlign:"center",children:[g&&e.jsx(L,{size:"small"}),e.jsx(t,{variant:"bodyMd",fontWeight:"medium",children:(a==null?void 0:a.message)||"Processing..."})]}),(a==null?void 0:a.position)>0&&e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Position in queue: ",a.position," | Estimated time: ~",a.estimatedTime,"s"]}),(a==null?void 0:a.queueLength)>0&&e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Queue length: ",a.queueLength," job(s)"]})]})}),e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs(o,{children:[e.jsx(t,{variant:"headingMd",as:"h3",children:"Sitemap Generator"}),e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Generate structured sitemap for AI models to discover and index your products"})]}),e.jsx(_,{primary:!0,onClick:R,loading:w,disabled:w,children:w?"Generating...":"Generate Sitemap"})]}),r&&e.jsx(o,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(h,{gap:"300",children:[e.jsx(l,{gap:"200",blockAlign:"center",children:r.generated?e.jsxs(e.Fragment,{children:[e.jsx(j,{source:S,tone:"success"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:"Sitemap Active"})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{source:q}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"No Sitemap Found"})]})}),r.generated&&e.jsxs(h,{gap:"400",children:[e.jsx(o,{children:e.jsxs(h,{gap:"200",children:[e.jsx(o,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(l,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Products included"}),e.jsxs(t,{variant:"bodyMd",fontWeight:"semibold",children:[r.lastProductCount||0," URLs"]})]})}),e.jsx(o,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(l,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"File size"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:r.size?`${(r.size/1024).toFixed(2)} KB`:"Unknown"})]})}),e.jsx(o,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(l,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Last updated"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:r.generatedAt?new Date(r.generatedAt).toLocaleString():"Unknown"})]})})]})}),e.jsx(o,{children:e.jsx(_,{fullWidth:!0,onClick:U,loading:v,disabled:v,icon:Q,children:v?e.jsxs(l,{gap:"200",align:"center",children:[e.jsx(L,{size:"small"}),e.jsx(t,{children:"Loading sitemap..."})]}):"View Sitemap"})})]})]})}),e.jsxs(o,{paddingBlockStart:"400",children:[e.jsx(t,{variant:"headingMd",as:"h4",children:"What's included:"}),e.jsx(o,{paddingBlockStart:"200",children:e.jsxs(h,{gap:"200",children:[e.jsxs(l,{gap:"200",blockAlign:"start",children:[e.jsx(o,{minWidth:"24px",children:e.jsx(j,{source:S,tone:"positive"})}),e.jsx(t,{children:"All active products with structured URLs for AI parsing"})]}),e.jsxs(l,{gap:"200",blockAlign:"start",children:[e.jsx(o,{minWidth:"24px",children:e.jsx(j,{source:S,tone:"positive"})}),e.jsx(t,{children:"Priority rankings to help AI models understand product importance"})]}),e.jsxs(l,{gap:"200",blockAlign:"start",children:[e.jsx(o,{minWidth:"24px",children:e.jsx(j,{source:S,tone:"positive"})}),e.jsx(t,{children:"Multi-language URLs for international AI search coverage"})]}),e.jsxs(l,{gap:"200",blockAlign:"start",children:[e.jsx(o,{minWidth:"24px",children:e.jsx(j,{source:S,tone:"positive"})}),e.jsx(t,{children:"Standard XML format that AI crawlers understand"})]})]})})]}),e.jsxs(o,{paddingBlockStart:"200",children:[e.jsx(t,{variant:"headingMd",as:"h4",children:"How it helps AI models:"}),e.jsx(o,{paddingBlockStart:"200",children:e.jsxs(h,{gap:"200",children:[e.jsx(t,{children:'1. Click "Generate Sitemap" to create a structured map of your products'}),e.jsx(t,{children:"2. The sitemap is automatically saved and available to AI crawlers"}),e.jsx(t,{children:"3. AI models can discover and understand your product catalog structure"}),e.jsx(t,{children:"4. Regenerate when you add new products to keep AI models updated"})]})})]})]})}),P&&e.jsx(D,{content:P,onDismiss:()=>p("")})]})}export{V as default};
