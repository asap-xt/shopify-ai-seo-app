import{j as a}from"./app-bridge-BkLRgbTe-1759220996771.js";import{r as m}from"./react-vendor-tAaa2TlE-1759220996771.js";import{m as Ie}from"./index-BHBnSfh_-1759220996771.js";import{C as M,a as d,T as h,h as Ce,L as j,B as T,s as b,i as n,D as _e,f as ve,I as we,t as Ue,k as Fe}from"./polaris-C_AEIE-4-1759220996771.js";const qe=(z,u="")=>{try{return new URLSearchParams(window.location.search).get(z)||u}catch{return u}};function Ge({shop:z}){var _,U,F,q,J;const u=z||qe("shop",""),[De,P]=m.useState(!1),[Te,E]=m.useState(!1),[R,x]=m.useState(""),[g,ze]=m.useState(null),D=m.useMemo(()=>Ie({}),[]),[Be,$]=m.useState(!1),[ke,L]=m.useState(!1),[p,Ne]=m.useState({storeName:"",homePageTitle:"",metaDescription:""}),[Ae,O]=m.useState(!1),[s,i]=m.useState({seo:{storeName:"",shortDescription:"",fullDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}});m.useEffect(()=>{u&&I()},[u,D]);async function I(){var t,e,r,o,C,S,f,V,H,W,G,X;P(!0);try{const y=`/api/store/generate?shop=${encodeURIComponent(u)}`,c=await D(y,{headers:{"X-Shop":u}});ze(c),Ne({storeName:((t=c.shopifyDefaults)==null?void 0:t.storeName)||"",homePageTitle:((e=c.shopifyDefaults)==null?void 0:e.homePageTitle)||"",metaDescription:((r=c.shopifyDefaults)==null?void 0:r.metaDescription)||""});const l=c.existingMetadata||{},k=((C=(o=l.seo_metadata)==null?void 0:o.value)==null?void 0:C.storeName)||"",N=((f=(S=l.seo_metadata)==null?void 0:S.value)==null?void 0:f.shortDescription)||"",A=((H=(V=l.seo_metadata)==null?void 0:V.value)==null?void 0:H.fullDescription)||"",$e=k&&k!==((W=c.shopifyDefaults)==null?void 0:W.storeName),Le=N&&N!==((G=c.shopifyDefaults)==null?void 0:G.homePageTitle),Oe=A&&A!==((X=c.shopifyDefaults)==null?void 0:X.metaDescription);O($e||Le||Oe),i(v=>{var K,Y,Q,Z,ee,ae,te,se,ie,oe,ne,re,le,ce,de,he,ue,me,ge,pe,Se,fe,xe,ye,Me,je,be;return{...v,seo:{...v.seo,storeName:k,shortDescription:N,fullDescription:A,keywords:Array.isArray((Y=(K=l.seo_metadata)==null?void 0:K.value)==null?void 0:Y.keywords)?l.seo_metadata.value.keywords.join(", "):((Z=(Q=l.seo_metadata)==null?void 0:Q.value)==null?void 0:Z.keywords)||""},aiMetadata:{...v.aiMetadata,...((ee=l.ai_metadata)==null?void 0:ee.value)||{},languages:((se=(te=(ae=l.ai_metadata)==null?void 0:ae.value)==null?void 0:te.languages)==null?void 0:se.length)>0?l.ai_metadata.value.languages:(((ie=c.shopInfo)==null?void 0:ie.locales)||[]).filter(w=>w.published).map(w=>w.locale),supportedCurrencies:((re=(ne=(oe=l.ai_metadata)==null?void 0:oe.value)==null?void 0:ne.supportedCurrencies)==null?void 0:re.length)>0?l.ai_metadata.value.supportedCurrencies:((le=c.shopInfo)==null?void 0:le.currencies)||["EUR"],shippingRegions:((he=(de=(ce=l.ai_metadata)==null?void 0:ce.value)==null?void 0:de.shippingRegions)==null?void 0:he.length)>0?l.ai_metadata.value.shippingRegions:(((ue=c.shopInfo)==null?void 0:ue.markets)||[]).map(w=>w.name)},organizationSchema:{...v.organizationSchema,...((me=l.organization_schema)==null?void 0:me.value)||{},enabled:((pe=(ge=l.organization_schema)==null?void 0:ge.value)==null?void 0:pe.enabled)===!0,name:((fe=(Se=l.organization_schema)==null?void 0:Se.value)==null?void 0:fe.name)||((xe=c.shopInfo)==null?void 0:xe.name)||"",email:((Me=(ye=l.organization_schema)==null?void 0:ye.value)==null?void 0:Me.email)||((je=c.shopInfo)==null?void 0:je.email)||""},localBusinessSchema:((be=l.local_business_schema)==null?void 0:be.value)||v.localBusinessSchema}})}catch(y){console.error("[StoreMeta] Load error:",y),x(`Load failed: ${(y==null?void 0:y.message)||"Unknown error"}`)}finally{P(!1)}}function Pe(){i(t=>({...t,seo:{...t.seo,storeName:"",shortDescription:"",fullDescription:""}})),O(!1),x("Synced with Shopify store settings")}async function B(){E(!0);try{const t=`/api/store/apply?shop=${encodeURIComponent(u)}`;console.log("[StoreMeta] SAVE",t);const e=await D(t,{method:"POST",headers:{"X-Shop":u},body:{metadata:s,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:s.organizationSchema.enabled,updateLocalBusiness:s.localBusinessSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:t,ok:e==null?void 0:e.ok}),x("Metadata saved successfully!"),await I()}catch(t){console.error("[StoreMeta] SAVE error",(t==null?void 0:t.debug)||t,t),x(`Save failed: ${(t==null?void 0:t.message)||"Unknown error"}`)}finally{E(!1)}}async function Ee(){var t;$(!0);try{await B();const r=await D("/graphql",{method:"POST",headers:{"X-Shop":u},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            seoMetadata
            aiMetadata
            organizationSchema
            localBusinessSchema
          }
        }
      `,variables:{shop:u}}});if(r.error)throw new Error(r.error);const o=(t=r.data)==null?void 0:t.storeMetadata;if(o){const C=window.open("","_blank");console.log("[STORE-METADATA] Raw preview data:",o),console.log("[STORE-METADATA] seoMetadata raw:",o.seoMetadata),console.log("[STORE-METADATA] aiMetadata raw:",o.aiMetadata),console.log("[STORE-METADATA] organizationSchema raw:",o.organizationSchema);const S={shopName:o.shopName,description:o.description,seoMetadata:o.seoMetadata?(()=>{try{return JSON.parse(o.seoMetadata)}catch(f){return console.error("Error parsing seoMetadata:",f),o.seoMetadata}})():null,aiMetadata:o.aiMetadata?(()=>{try{return JSON.parse(o.aiMetadata)}catch(f){return console.error("Error parsing aiMetadata:",f),o.aiMetadata}})():null,organizationSchema:o.organizationSchema?(()=>{try{return JSON.parse(o.organizationSchema)}catch(f){return console.error("Error parsing organizationSchema:",f),o.organizationSchema}})():null,localBusinessSchema:o.localBusinessSchema?(()=>{try{return JSON.parse(o.localBusinessSchema)}catch(f){return console.error("Error parsing localBusinessSchema:",f),o.localBusinessSchema}})():null};C.document.write(`
          <html>
            <head>
              <title>Store Metadata Preview</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
                h1 { color: #333; }
                .section { margin: 20px 0; }
                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
              </style>
            </head>
            <body>
              <h1>Store Metadata Preview</h1>
              <div class="section">
                <h2>Basic Info</h2>
                <p><strong>Shop Name:</strong> ${S.shopName||"Not set"}</p>
                <p><strong>Description:</strong> ${S.description||"Not set"}</p>
              </div>
              
              <div class="section">
                <h2>SEO Metadata</h2>
                <pre>${JSON.stringify(S.seoMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>AI Metadata</h2>
                <pre>${JSON.stringify(S.aiMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Organization Schema</h2>
                <pre>${JSON.stringify(S.organizationSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Local Business Schema</h2>
                <pre>${JSON.stringify(S.localBusinessSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Raw Data</h2>
                <pre>${JSON.stringify(S,null,2)}</pre>
              </div>
            </body>
          </html>
        `),C.document.close()}else throw new Error("No preview data available")}catch(e){x(`Preview failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{$(!1)}}async function Re(){L(!0);try{i({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}}),await B(),x("Metadata cleared successfully!")}catch(t){x(`Clear failed: ${(t==null?void 0:t.message)||"Unknown error"}`)}finally{L(!1)}}return De&&!g?a.jsx(M,{children:a.jsx(d,{padding:"400",children:a.jsx(h,{children:"Loading store data..."})})}):(g==null?void 0:g.plan)==="Starter"?a.jsx(Ce,{status:"warning",children:a.jsx(h,{children:"Store metadata features are available starting from the Professional plan."})}):a.jsxs(j,{children:[a.jsx(j.Section,{children:a.jsx(M,{title:"Basic Store Information",children:a.jsxs(d,{padding:"400",children:[a.jsx(Ce,{tone:"info",children:a.jsxs(d,{children:[a.jsx(h,{variant:"bodyMd",fontWeight:"semibold",children:"From Shopify Settings:"}),a.jsxs(d,{paddingBlockStart:"200",children:[a.jsxs(h,{variant:"bodySm",tone:"subdued",children:["Store name: ",a.jsx(h,{as:"span",fontWeight:"medium",children:p.storeName||"Not set"})]}),a.jsxs(h,{variant:"bodySm",tone:"subdued",children:["Short Store Description: ",a.jsx(h,{as:"span",fontWeight:"medium",children:p.homePageTitle?p.homePageTitle.substring(0,50)+(p.homePageTitle.length>50?"...":""):"Not set"})]}),a.jsxs(h,{variant:"bodySm",tone:"subdued",children:["Meta description: ",a.jsx(h,{as:"span",fontWeight:"medium",children:p.metaDescription?p.metaDescription.substring(0,100)+(p.metaDescription.length>100?"...":""):"Not set"})]})]}),Ae&&a.jsx(d,{paddingBlockStart:"300",children:a.jsx(T,{size:"slim",onClick:Pe,children:"Sync from Shopify"})})]})}),a.jsx(d,{paddingBlockStart:"400",children:a.jsxs(b,{children:[a.jsx(n,{label:"Store Name",value:s.seo.storeName,onChange:t=>i(e=>({...e,seo:{...e.seo,storeName:t}})),placeholder:p.storeName,helpText:"Leave empty to use Shopify store name",maxLength:100}),a.jsx(n,{label:"Short Store Description",value:s.seo.shortDescription,onChange:t=>i(e=>({...e,seo:{...e.seo,shortDescription:t}})),placeholder:p.homePageTitle,helpText:"Custom home page title for AI/SEO, max 100 characters",maxLength:100}),a.jsx(n,{label:"Full Store Description",value:s.seo.fullDescription,onChange:t=>i(e=>({...e,seo:{...e.seo,fullDescription:t}})),placeholder:p.metaDescription,helpText:"Leave empty to use Shopify meta description",maxLength:300,multiline:3}),a.jsx(n,{label:"Keywords",value:s.seo.keywords,onChange:t=>i(e=>({...e,seo:{...e.seo,keywords:t}})),helpText:"Comma-separated keywords (optional)"})]})})]})})}),a.jsx(j.Section,{children:a.jsx(M,{title:"AI Metadata",children:a.jsx(d,{padding:"400",children:a.jsxs(b,{children:[a.jsxs(b.Group,{children:[a.jsx(n,{label:"Business Type",value:s.aiMetadata.businessType,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,businessType:t}})),placeholder:"e.g., Fashion Retailer, Electronics Store",helpText:"Max 3 words"}),a.jsx(n,{label:"Target Audience",value:s.aiMetadata.targetAudience,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,targetAudience:t}})),placeholder:"e.g., Young professionals, Parents"})]}),a.jsx(n,{label:"Unique Selling Points",value:s.aiMetadata.uniqueSellingPoints,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,uniqueSellingPoints:t}})),helpText:"Comma-separated list",multiline:2}),a.jsx(n,{label:"Brand Voice",value:s.aiMetadata.brandVoice,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,brandVoice:t}})),placeholder:"e.g., Professional, Friendly, Casual"}),a.jsx(n,{label:"Primary Categories",value:s.aiMetadata.primaryCategories,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,primaryCategories:t}})),helpText:"Main product categories, comma-separated"}),a.jsx(n,{label:"Shipping Information",value:s.aiMetadata.shippingInfo,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,shippingInfo:t}})),helpText:"Shipping costs, delivery times, free shipping thresholds (e.g., Free shipping over $50, 2-3 business days)",multiline:2}),a.jsx(n,{label:"Return Policy",value:s.aiMetadata.returnPolicy,onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,returnPolicy:t}})),multiline:2}),a.jsx(_e,{}),a.jsx(h,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),a.jsx(h,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),a.jsx(n,{label:"Supported Languages",value:((_=s.aiMetadata.languages)==null?void 0:_.join(", "))||"",onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,languages:t.split(",").map(r=>r.trim()).filter(r=>r)}})),helpText:"Comma-separated language codes (e.g., en, de, es, fr)",multiline:2}),a.jsx(n,{label:"Supported Currencies",value:((U=s.aiMetadata.supportedCurrencies)==null?void 0:U.join(", "))||"",onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,supportedCurrencies:t.split(",").map(r=>r.trim()).filter(r=>r)}})),helpText:"Comma-separated currency codes (e.g., EUR, USD, GBP)"}),a.jsx(n,{label:"Shipping Regions",value:((F=s.aiMetadata.shippingRegions)==null?void 0:F.join(", "))||"",onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,shippingRegions:t.split(",").map(r=>r.trim()).filter(r=>r)}})),helpText:"Comma-separated regions (e.g., EU, USA, UK, Canada)",multiline:2}),a.jsx(n,{label:"Cultural Considerations",value:s.aiMetadata.culturalConsiderations||"",onChange:t=>i(e=>({...e,aiMetadata:{...e.aiMetadata,culturalConsiderations:t}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),((q=g==null?void 0:g.features)==null?void 0:q.organizationSchema)&&a.jsx(j.Section,{children:a.jsx(M,{title:"Organization Schema",children:a.jsxs(d,{padding:"400",children:[a.jsx(ve,{label:"Enable Organization Schema",checked:s.organizationSchema.enabled,onChange:t=>i(e=>({...e,organizationSchema:{...e.organizationSchema,enabled:t}}))}),s.organizationSchema.enabled&&a.jsx(d,{paddingBlockStart:"400",children:a.jsxs(b,{children:[a.jsxs(b.Group,{children:[a.jsx(n,{label:"Organization Name",value:s.organizationSchema.name,onChange:t=>i(e=>({...e,organizationSchema:{...e.organizationSchema,name:t}}))}),a.jsx(n,{label:"Contact Email",value:s.organizationSchema.email,onChange:t=>i(e=>({...e,organizationSchema:{...e.organizationSchema,email:t}})),type:"email"})]}),a.jsx(n,{label:"Phone",value:s.organizationSchema.phone,onChange:t=>i(e=>({...e,organizationSchema:{...e.organizationSchema,phone:t}})),type:"tel"}),a.jsx(n,{label:"Logo URL",value:s.organizationSchema.logo,onChange:t=>i(e=>({...e,organizationSchema:{...e.organizationSchema,logo:t}})),type:"url"}),a.jsx(n,{label:"Social Media Links",value:s.organizationSchema.sameAs,onChange:t=>i(e=>({...e,organizationSchema:{...e.organizationSchema,sameAs:t}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}),((J=g==null?void 0:g.features)==null?void 0:J.localBusinessSchema)&&a.jsx(j.Section,{children:a.jsx(M,{title:"Local Business Schema",children:a.jsxs(d,{padding:"400",children:[a.jsxs(we,{align:"start",gap:"200",children:[a.jsx(ve,{label:"Enable Local Business Schema",checked:s.localBusinessSchema.enabled,onChange:t=>i(e=>({...e,localBusinessSchema:{...e.localBusinessSchema,enabled:t}}))}),a.jsx(Ue,{content:"Optional - only enable if you have physical stores/locations",children:a.jsx(h,{variant:"bodyMd",color:"subdued",children:"ℹ️"})})]}),s.localBusinessSchema.enabled&&a.jsx(d,{paddingBlockStart:"400",children:a.jsxs(b,{children:[a.jsx(n,{label:"Price Range",value:s.localBusinessSchema.priceRange,onChange:t=>i(e=>({...e,localBusinessSchema:{...e.localBusinessSchema,priceRange:t}})),helpText:"e.g., $, $$, $$$, $$$$"}),a.jsx(n,{label:"Opening Hours",value:s.localBusinessSchema.openingHours,onChange:t=>i(e=>({...e,localBusinessSchema:{...e.localBusinessSchema,openingHours:t}})),helpText:"e.g., Mo-Fr 09:00-18:00, Sa 10:00-16:00",multiline:2})]})})]})})}),a.jsx(j.Section,{children:a.jsx(M,{children:a.jsx(d,{padding:"400",children:a.jsxs(we,{gap:"300",children:[a.jsx(T,{onClick:B,loading:Te,primary:!0,children:"Save Metadata"}),a.jsx(T,{onClick:Ee,loading:Be,children:"Preview Metadata"}),a.jsx(T,{onClick:Re,loading:ke,destructive:!0,children:"Clear Metadata"})]})})})}),R&&a.jsx(Fe,{content:R,onDismiss:()=>x("")})]})}export{Ge as default};
