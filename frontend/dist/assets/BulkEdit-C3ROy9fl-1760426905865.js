import{j as e}from"./app-bridge-gbdz_Dv9-1760426905865.js";import{r as o}from"./react-vendor-tAaa2TlE-1760426905865.js";import{u as Vt}from"./index-DKOsh1sc-1760426905865.js";import{U as Qt,I as Jt}from"./InsufficientTokensModal-Bz3xklQX-1760426905865.js";import{M as O,d as U,T as i,e as ut,f as qe,B as z,a as g,I as C,g as Ae,D as Xt,h as Z,C as gt,i as Zt,S as es,P as Ee,j as Oe,R as ts,k as ss,l as pt,m as ns,E as rs}from"./polaris-CwdJJNIV-1760426905865.js";const os=(f,j="")=>{try{return new URLSearchParams(window.location.search).get(f)||j}catch{return j}},fe=f=>{if(!f)return f;const j=String(f).trim();return j.startsWith("gid://")?j:`gid://shopify/Product/${j}`},as=f=>{if(!f)return"";const j=String(f).match(/\/(\d+)$/);return j?j[1]:f},$=f=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(f==null?void 0:f.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(f==null?void 0:f.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}},He=f=>new URLSearchParams(window.location.search).get("debug_limits")==="true"?f<=5?"Starter":f<=10?"Growth":f<=12?"Professional":f<=15?"Growth Extra":"Enterprise":f<=100?"Starter":f<=350?"Professional":f<=1e3?"Growth":f<=2500?"Growth Extra":"Enterprise";function ps({shop:f,globalPlan:j}){var lt,ct,dt;const{api:I,shop:ht}=Vt(),c=f||ht||os("shop","");o.useEffect(()=>{},[c,I]);const[x,Y]=o.useState([]),[ae,Se]=o.useState(!1),[mt,Fe]=o.useState(1),[ft,ve]=o.useState(!0),[k,Ke]=o.useState(0),[l,ee]=o.useState([]),[y,ie]=o.useState(!1),[V,_e]=o.useState(""),[B,xe]=o.useState("all"),[R,le]=o.useState(""),[je,is]=o.useState("createdAt"),[te,St]=o.useState("desc"),[W,ye]=o.useState([]),[xt,jt]=o.useState([]),[Ye,ze]=o.useState(!1),[Ve,Me]=o.useState(!1),[Qe,Te]=o.useState(!1),[Je,ke]=o.useState(!1),[yt,Pt]=o.useState(""),[bt,wt]=o.useState([]),[D,se]=o.useState([]),[v,Xe]=o.useState([]),[Re,Q]=o.useState(!1),[Pe,G]=o.useState({current:0,total:0,percent:0}),[Ze,ne]=o.useState(""),[be,ce]=o.useState([]),[de,et]=o.useState({}),[Ct,De]=o.useState(!1),[It,ue]=o.useState(!1),[Lt,ge]=o.useState(!1),[q,pe]=o.useState([]),[At,we]=o.useState(!1),[tt,L]=o.useState(""),[st,nt]=o.useState(!1),[M,J]=o.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[b,Et]=o.useState(null),[F,Ue]=o.useState(1),[Ot,Ce]=o.useState(!1),[Ie,vt]=o.useState(localStorage.getItem("hasVisitedProducts")==="true"),[$e,X]=o.useState(!1),[zt,rt]=o.useState(!1),[P,K]=o.useState(null),[re,he]=o.useState("starter");o.useEffect(()=>{if(!(!j||typeof j!="object")){if(j.planKey&&j.planKey!==""){he(j.planKey);const s={starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[j.planKey.toLowerCase()]||1;Ue(s)}else if(j.plan&&j.plan!==""){const t=j.plan.toLowerCase().replace(/\s+/g,"-");he(t);const n={starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[t]||1;Ue(n)}}},[j]),o.useEffect(()=>{if($e&&b){const t=$(b);(y?k:l.length)<=t&&(X(!1),K(null))}},[l.length,y,k,$e,b]),o.useEffect(()=>{if(!c)return;I("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
        }
      }
    `,variables:{shop:c}})}).then(s=>{var h,p,m;if((h=s==null?void 0:s.errors)!=null&&h.length)throw new Error(((p=s.errors[0])==null?void 0:p.message)||"GraphQL error");const n=(m=s==null?void 0:s.data)==null?void 0:m.plansMe,r=(n==null?void 0:n.modelsSuggested)||["anthropic/claude-3.5-sonnet"];wt(r.map(S=>({label:S,value:S}))),Pt(r[0]),Et((n==null?void 0:n.plan)||"starter"),he((n==null?void 0:n.planKey)||"starter");const d=((n==null?void 0:n.planKey)||"starter").toLowerCase();Ue({starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[d]||1)}).catch(s=>console.error("[BULK-EDIT] GraphQL plansMe failed:",s))},[c,I]),o.useEffect(()=>{if(!c)return;const t=new Promise((s,n)=>{setTimeout(()=>n(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([I(`/api/languages/shop/${c}`),t]).then(s=>{const n=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];Xe(n.includes("en")?n:["en",...n])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),Xe(["en"])})},[c,I]),o.useEffect(()=>{c&&I("/api/products/tags/list",{shop:c}).then(t=>jt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[c,I]);const _=o.useCallback(async(t=1,s=!1,n=null)=>{var r,d,a,h,p;Se(!0);try{const m=new URLSearchParams({shop:c,page:t,limit:50,...B!=="all"&&{optimized:B},...V&&{search:V},...R&&{languageFilter:R},...W.length>0&&{tags:W.join(",")},sortBy:je,sortOrder:te,...n&&{_t:n}}),S=await I(`/api/products/list?${m}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((r=S.products)==null?void 0:r.length)>0,console.log("[LOAD-PRODUCTS] ===== PRODUCTS LOADED ====="),console.log("[LOAD-PRODUCTS] Total products:",(d=S.products)==null?void 0:d.length),((a=S.products)==null?void 0:a.length)>0&&S.products.forEach((w,H)=>{var u,T;console.log(`[LOAD-PRODUCTS] Product ${H}: ID=${w.id} (type: ${typeof w.id}), _id=${w._id}, title="${w.title}", has SEO: ${!!((T=(u=w.optimizationSummary)==null?void 0:u.optimizedLanguages)!=null&&T.length)}`)}),Y(s?w=>[...w,...S.products]:S.products||[]),Fe(t),ve(((h=S.pagination)==null?void 0:h.hasNext)||!1),Ke(((p=S.pagination)==null?void 0:p.total)||0)}catch(m){Y(s?x:[]),ve(!1),L(`Error loading products: ${m.message}`)}finally{Se(!1)}},[c,B,V,R,W,je,te]);o.useEffect(()=>{c&&_(1,!1,null)},[c,_,B,R,W,je,te]),o.useEffect(()=>{!Ie&&c&&(localStorage.setItem("hasVisitedProducts","true"),vt(!0))},[Ie,c]),o.useEffect(()=>{x.length===0&&!ae&&c&&!Ie&&Ce(!0)},[x.length,ae,c,Ie]),o.useEffect(()=>{console.log("[DEBUG-MONITOR] ===== STATE CHANGED ====="),console.log("[DEBUG-MONITOR] Products count:",x.length),console.log("[DEBUG-MONITOR] Selected items count:",l.length),console.log("[DEBUG-MONITOR] Products:",x.map(t=>({id:t.id,title:t.title}))),console.log("[DEBUG-MONITOR] Selected items:",l)},[x,l]);const ot=o.useCallback(t=>{_e(t)},[]);o.useEffect(()=>{const t=setTimeout(()=>{c&&_(1,!1,null)},500);return()=>clearTimeout(t)},[V]);const Mt=o.useCallback(t=>{console.log("[SELECTION-CHANGE] ===== SELECTION CHANGED ====="),console.log("[SELECTION-CHANGE] New selected items:",t),console.log("[SELECTION-CHANGE] Item count:",t.length),console.log("[SELECTION-CHANGE] Item types:",t.map(s=>typeof s)),console.log("[SELECTION-CHANGE] Current products count:",x.length),console.log("[SELECTION-CHANGE] Current products IDs:",x.map(s=>s.id)),ee(t),t.length===0&&ie(!1)},[x]),at=o.useCallback(t=>{ie(t),ee(t?x.map(s=>s.id):[])},[x]),it=o.useMemo(()=>{var s;if(y)return D.length>F;const t=x.filter(n=>l.includes(n.id));if(t.length===0)return D.length>F;for(const n of t){const r=((s=n.optimizationSummary)==null?void 0:s.optimizedLanguages)||[],d=D.filter(h=>!r.includes(h));if(r.length+d.length>F)return!0}return!1},[x,l,y,F,D]),Tt=()=>{if(l.length===0&&!y){L("Please select products first");return}ue(!0)},kt=()=>{if(l.length===0&&!y){L("Please select products first");return}pe([]),ge(!0)},Rt=async()=>{const s=x.filter(r=>l.includes(r.id)).filter(r=>{var d,a;return((a=(d=r.optimizationSummary)==null?void 0:d.optimizedLanguages)==null?void 0:a.length)>0});nt(!0),J({processing:!0,current:0,total:s.length,currentItem:"",results:null});const n={successful:0,failed:0,skipped:0};for(let r=0;r<s.length;r++){const d=s[r];J(a=>({...a,current:r,currentItem:d.title}));try{const a=await I("/ai-enhance/product",{method:"POST",shop:c,body:{shop:c,productId:d.gid||fe(d.id),languages:d.optimizationSummary.optimizedLanguages}});if(a.results&&a.results.length>0){const h={shop:c,productId:d.gid||fe(d.id),results:a.results.filter(m=>m.bullets&&m.faq).map(m=>({language:m.language,seo:{...m.updatedSeo,bullets:m.bullets||[],faq:m.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},p=await I("/api/seo/apply-multi",{method:"POST",shop:c,body:h});n.successful++}else n.failed++}catch(a){if(console.error("Enhancement error:",a),console.error("🔍 [DEBUG] Error details:",{status:a.status,trialRestriction:a.trialRestriction,needsUpgrade:a.needsUpgrade,requiresPurchase:a.requiresPurchase,message:a.message,currentPlan:a.currentPlan}),a.status===403){J({processing:!1,current:0,total:0,currentItem:"",results:null}),K({...a,message:a.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),he(a.currentPlan||re),X(!0);return}if(a.status===402||a.requiresPurchase||a.trialRestriction){J({processing:!1,current:0,total:0,currentItem:"",results:null}),K(a),he(a.currentPlan||b||"starter"),a.trialRestriction?X(!0):rt(!0);return}n.failed++}J(a=>({...a,current:r+1}))}J(r=>({...r,processing:!1,results:n})),L(`AI enhancement complete! ${n.successful} products enhanced.`)},Be=()=>{nt(!1),J({processing:!1,current:0,total:0,currentItem:"",results:null}),M.results&&M.results.successful>0&&_(1,!1,null)},Dt=()=>M.processing?e.jsx(O,{open:st,title:"Processing AI Enhancement",onClose:Be,noScroll:!0,children:e.jsx(O.Section,{children:e.jsxs(U,{gap:"400",children:[e.jsxs(i,{variant:"bodyMd",children:["Processing: ",M.currentItem]}),e.jsx(ut,{progress:M.current/M.total*100}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[M.current," of ",M.total," products (",Math.round(M.current/M.total*100),"%)"]})]})})}):M.results!==null?e.jsx(O,{open:st,title:"AI Enhancement Results",onClose:Be,primaryAction:{content:"Done",onAction:Be},children:e.jsx(O.Section,{children:e.jsx(U,{gap:"300",children:e.jsxs(C,{gap:"400",children:[e.jsxs(g,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"success",children:M.results.successful})]}),e.jsxs(g,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:M.results.failed})]}),e.jsxs(g,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"info",children:M.results.skipped})]})]})})})}):null,Ut=async()=>{var s;if(!D.length){L("Please select at least one language");return}let t=yt;(!t||!t.trim())&&(t=((s=bt[0])==null?void 0:s.value)||"anthropic/claude-3.5-sonnet"),Q(!0),G({current:0,total:0,percent:0}),ce([]),et({});try{let n=[];y?n=(await I(`/api/products/list?shop=${encodeURIComponent(c)}&limit=1000&fields=id`)).products||[]:n=x.filter(u=>l.includes(u.id));const r=$(b),d=n.length;if(d>r){Q(!1),G({current:0,total:0,percent:0}),ue(!1);const u=He(d);K({error:"Product limit exceeded",message:`Your ${b} plan supports up to ${r} products for SEO optimization. You have selected ${d} products.`,minimumPlanRequired:u,currentPlan:b,features:[`Optimize up to ${$(u)} products`,"All features from your current plan",u==="Growth Extra"||u==="Enterprise"?"AI-enhanced add-ons with included tokens":"Access to AI-enhanced add-ons",u==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),X(!0);return}ue(!1);const a=d,h=0;G({current:0,total:a,percent:0});const p=5,m={};for(let u=0;u<n.length;u+=p){const A=n.slice(u,Math.min(u+p,n.length)).map(async E=>{var oe;ne(E.title||E.handle||"Product");try{const Le=E.gid||fe(E.productId||E.id),We=((oe=E.optimizationSummary)==null?void 0:oe.optimizedLanguages)||[],Ge=D.filter(Yt=>!We.includes(Yt));if(Ge.length===0){m[E.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const _t=await I("/api/seo/generate-multi",{method:"POST",shop:c,body:{shop:c,productId:Le,model:t,languages:Ge}});m[E.id]={success:!0,data:_t,languages:Ge}}catch(Le){m[E.id]={success:!1,error:Le.message},ce(We=>[...We,{product:E.title,error:Le.message}])}});await Promise.all(A);const N=Math.min(u+p,n.length),me=Math.round(N/a*100);G({current:N,total:a,percent:me})}et(m),De(!0);const S=Object.keys(m).filter(u=>m[u].success&&!m[u].skipped).length,w=Object.keys(m).filter(u=>m[u].skipped).length;let H=`Generated Optimization for AI Search for ${S} products`;w>0&&(H+=` (${w} already optimised)`),h>0,L(H)}catch(n){L(`Error: ${n.message}`)}finally{Q(!1),ne("")}},$t=async()=>{var t,s;Q(!0),G({current:0,total:0,percent:0});try{const n=Object.entries(de).filter(([h,p])=>p.success&&!p.skipped),r=n.length;G({current:0,total:r,percent:0});for(let h=0;h<n.length;h++){const[p,m]=n[h],S=x.find(u=>u.id===p);if(!S)continue;ne(S.title||"Product");try{const u=S.gid||fe(S.productId||S.id),T=await I("/api/seo/apply-multi",{method:"POST",shop:c,body:{shop:c,productId:u,results:m.data.results.filter(A=>A==null?void 0:A.seo).map(A=>({language:A.language,seo:A.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});T.appliedLanguages&&T.appliedLanguages.length>0&&Y(A=>A.map(N=>{var me;if(N.id===p){const E=((me=N.optimizationSummary)==null?void 0:me.optimizedLanguages)||[],oe=[...new Set([...E,...T.appliedLanguages])];return{...N,optimizationSummary:{...N.optimizationSummary,optimizedLanguages:oe,optimized:!0,lastOptimized:new Date().toISOString()}}}return N}))}catch(u){ce(T=>[...T,{product:S.title,error:`Apply failed: ${u.message}`}])}const w=h+1,H=Math.round(w/r*100);G({current:w,total:r,percent:H})}L("AI Search Optimisation applied successfully!"),De(!1),console.log("[APPLY-SEO] ===== CLEARING SELECTION ====="),console.log("[APPLY-SEO] Selected items BEFORE clear:",l),ee([]),ie(!1),console.log("[APPLY-SEO] Selected items cleared"),console.log("[APPLY-SEO] Waiting for database propagation..."),await new Promise(h=>setTimeout(h,1e3)),console.log("[APPLY-SEO] Clearing products state before reload..."),Y([]);const d=new URLSearchParams({shop:c,page:1,limit:50,...B!=="all"&&{optimized:B},...V&&{search:V},...R&&{languageFilter:R},...W.length>0&&{tags:W.join(",")},sortBy:je,sortOrder:te,_t:Date.now()}),a=await I(`/api/products/list?${d}`,{shop:c,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});Y(a.products||[]),Fe(1),ve(((t=a.pagination)==null?void 0:t.hasNext)||!1),Ke(((s=a.pagination)==null?void 0:s.total)||0)}catch(n){L(`Error applying AI Search Optimisation: ${n.message}`)}finally{Q(!1),ne("")}},Bt=async()=>{var t;if(!q.length){L("Please select at least one language to delete");return}ge(!1),we(!1),Q(!0),G({current:0,total:0,percent:0}),ce([]);try{let s=[];y?s=(await I(`/api/products/list?shop=${encodeURIComponent(c)}&limit=1000&fields=id`)).products||[]:s=x.filter(a=>l.includes(a.id));const n=s.length;G({current:0,total:n,percent:0});let r=0,d=0;for(let a=0;a<s.length;a++){const h=s[a];ne(h.title||h.handle||"Product");try{const S=h.gid||fe(h.productId||h.id),w=((t=h.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],H=q.filter(T=>w&&w.length>0&&w.includes(T));if(H.length===0){d++;continue}const u=await I("/api/seo/delete-multi",{method:"POST",shop:c,body:{shop:c,productId:S,languages:H}});u.deletedLanguages&&u.deletedLanguages.length>0&&Y(T=>T.map(A=>{var N;if(A.id===h.id){const E=(((N=A.optimizationSummary)==null?void 0:N.optimizedLanguages)||[]).filter(oe=>!u.deletedLanguages.includes(oe));return{...A,optimizationSummary:{...A.optimizationSummary,optimizedLanguages:E,optimized:E.length>0,lastOptimized:E.length>0?A.optimizationSummary.lastOptimized:null}}}return A})),r++,u.deletedLanguages&&u.deletedLanguages.length>0&&await I("/api/products/verify-after-delete",{method:"POST",shop:c,body:{shop:c,productIds:[S],deletedLanguages:u.deletedLanguages}})}catch(S){ce(w=>[...w,{product:h.title,error:S.message}])}const p=a+1,m=Math.round(p/n*100);G({current:p,total:n,percent:m})}ee([]),ie(!1),d>0?L(`Deleted Optimization for AI Search from ${r} products (${d} had no optimisation to delete)`):L(`Deleted Optimization for AI Search from ${r} products`),setTimeout(()=>{const a=Date.now();_(1,!1,a)},500)}catch(s){L(`Error: ${s.message}`)}finally{Q(!1),ne("")}},Nt=t=>{var s,n;try{const r=t,d=as(r.productId||r.id),a=((s=r.optimizationSummary)==null?void 0:s.optimizedLanguages)||[];console.log(`[BULK-EDIT-RENDER] Product: "${r.title}", ID: ${r.id}, Type: ${typeof r.id}`),console.log("[BULK-EDIT-RENDER] Optimized Languages:",a),console.log("[BULK-EDIT-RENDER] Selected Items:",l),console.log("[BULK-EDIT-RENDER] Is Selected:",l.includes(r.id));const h=(n=r.images)!=null&&n[0]?e.jsx(pt,{source:r.images[0].url||r.images[0].src||r.images[0],alt:r.title,size:"small"}):r.imageUrl?e.jsx(pt,{source:r.imageUrl,alt:r.title,size:"small"}):e.jsx(g,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(ns,{id:r.id,media:h,accessibilityLabel:`View details for ${r.title}`,onClick:p=>{console.log("[ResourceItem] ===== CLICK ON RESOURCE ITEM ====="),console.log("[ResourceItem] e.target:",p.target),console.log("[ResourceItem] e.target.tagName:",p.target.tagName),console.log('[ResourceItem] e.target.closest("input"):',p.target.closest("input")),console.log('[ResourceItem] e.target.closest("a"):',p.target.closest("a")),console.log("[ResourceItem] Event bubbling up...")},children:e.jsxs(C,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(g,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:r.title}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["ID: ",d]})]}),e.jsx(g,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(C,{gap:"100",children:v.length>0?v.map(p=>{const m=a.includes(p);return e.jsx(Z,{tone:m?"success":"subdued",size:"small",children:p.toUpperCase()},p)}):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),a.map(p=>e.jsx(Z,{tone:"success",size:"small",children:p.toUpperCase()},p)))})}),e.jsx(g,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(Z,{tone:"success",children:"Active"})})]})})}catch(r){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",r),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},Wt=Re&&e.jsx(O,{open:Re,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(O.Section,{children:e.jsxs(U,{gap:"400",children:[e.jsx(i,{variant:"bodyMd",children:Ze?`Processing: ${Ze}`:"Preparing..."}),e.jsx(ut,{progress:Pe.percent}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[Pe.current," of ",Pe.total," products (",Pe.percent,"%)"]})]})})}),Gt=e.jsx(O,{open:It,title:"Select Languages",onClose:()=>{ue(!1),se([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Ut,disabled:D.length===0||it},secondaryActions:[{content:"Cancel",onAction:()=>{ue(!1),se([])}}],children:e.jsx(O.Section,{children:e.jsxs(U,{gap:"300",children:[e.jsxs(i,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",y?"all":l.length," selected products:"]}),it&&e.jsx(qe,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(U,{gap:"200",children:[e.jsxs(i,{variant:"bodyMd",children:["Your ",re," plan supports up to ",F," language",F>1?"s":""," per product.",l.length===1&&((dt=(ct=(lt=x.find(t=>t.id===l[0]))==null?void 0:lt.optimizationSummary)==null?void 0:ct.optimizedLanguages)==null?void 0:dt.length)>0&&e.jsxs(e.Fragment,{children:[" This product already has ",x.find(t=>t.id===l[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(i,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(z,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),s=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${s}`},children:"Upgrade Plan"})]})}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(C,{gap:"200",wrap:!0,children:v.map(t=>e.jsx(Ae,{label:t.toUpperCase(),checked:D.includes(t),onChange:s=>{se(s?[...D,t]:D.filter(n=>n!==t))}},t))})}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(z,{plain:!0,onClick:()=>{D.length===v.length?se([]):v.length>F?(se([...v]),L(`You selected ${v.length} languages. Your ${re} plan supports ${F}. Please deselect or upgrade.`)):se([...v])},children:D.length===v.length?"Deselect all":"Select all"})}),e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),qt=e.jsx(O,{open:Ct&&!Re,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:$t,disabled:!Object.values(de).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>De(!1)}],children:e.jsx(O.Section,{children:e.jsxs(U,{gap:"300",children:[e.jsxs(C,{gap:"400",children:[e.jsxs(g,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(de).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(g,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(de).filter(t=>t.skipped).length})]}),e.jsxs(g,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(de).filter(t=>!t.success).length})]})]}),be.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Xt,{}),e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(g,{maxHeight:"200px",overflowY:"scroll",children:[be.slice(0,10).map((t,s)=>e.jsxs(i,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),be.length>10&&e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["... and ",be.length-10," more errors"]})]})]})]})})}),Ht=e.jsx(O,{open:Lt,title:"Delete Optimization for AI Search",onClose:()=>{ge(!1),pe([])},primaryAction:{content:"Continue",onAction:()=>{ge(!1),we(!0)},disabled:q.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{ge(!1),pe([])}}],children:e.jsx(O.Section,{children:e.jsxs(U,{gap:"300",children:[e.jsxs(i,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",y?"all":l.length," selected products:"]}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(C,{gap:"200",wrap:!0,children:v.map(t=>e.jsx(Ae,{label:t.toUpperCase(),checked:q.includes(t),onChange:s=>{pe(s?[...q,t]:q.filter(n=>n!==t))}},t))})}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(z,{plain:!0,onClick:()=>{pe(q.length===v.length?[]:[...v])},children:q.length===v.length?"Deselect all":"Select all"})}),e.jsx(i,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Ft=e.jsx(O,{open:At,title:"Confirm Deletion",onClose:()=>{we(!1)},primaryAction:{content:"Delete",onAction:Bt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>we(!1)}],children:e.jsx(O.Section,{children:e.jsxs(U,{gap:"300",children:[e.jsx(i,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(g,{paddingBlock:"200",children:e.jsx(C,{gap:"100",children:q.map(t=>e.jsx(Z,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(i,{variant:"bodyMd",children:["This will delete optimisation from ",y?"ALL":l.length," selected products."]}),e.jsx(i,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Ne=async()=>{try{Se(!0),L("Syncing products from Shopify...");const t=await I("/api/products/sync",{method:"POST",shop:c});if(t.success){const s=t.productsCount||t.synced||0;L(`✅ Synced ${s} products successfully!`),setTimeout(()=>{_(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),L(`❌ Sync failed: ${t.message}`)}finally{Se(!1)}},Kt=e.jsx(rs,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{_e(""),xe("all"),le(""),ye([]),_(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Ne},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(gt,{children:e.jsxs(g,{padding:"400",children:[e.jsxs(U,{gap:"300",children:[b&&e.jsx(qe,{tone:"info",children:e.jsxs(C,{gap:"200",align:"space-between",children:[e.jsxs(i,{children:["Your ",e.jsx("strong",{children:b})," plan includes up to"," ",e.jsx("strong",{children:$(b)})," products for SEO optimization.",k>$(b)&&e.jsxs(e.Fragment,{children:[" You have ",k," products, so only the first ",$(b)," will be processed."]})]}),(l.length>0||y)&&e.jsxs(i,{children:["Selected: ",y?Math.min(k,$(b)):l.length,"/",$(b)]})]})}),b&&(l.length>$(b)||y&&k>$(b))&&e.jsx(qe,{tone:"critical",children:e.jsxs(U,{gap:"200",children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),e.jsxs(i,{children:["Your ",e.jsx("strong",{children:b})," plan supports up to ",e.jsx("strong",{children:$(b)})," products. You have selected ",e.jsx("strong",{children:y?k:l.length})," products."]}),e.jsx(i,{children:"Please deselect some products or upgrade your plan to continue."}),e.jsxs(C,{gap:"200",children:[e.jsx(z,{onClick:()=>{ee([]),ie(!1)},children:"Clear Selection"}),e.jsx(z,{variant:"primary",onClick:()=>{K({error:"Product limit exceeded",message:`Your ${b} plan supports up to ${$(b)} products. Upgrade to ${He(y?k:l.length)} to optimize more products.`,minimumPlanRequired:He(y?k:l.length)}),X(!0)},children:"Upgrade Plan"})]})]})}),e.jsxs(C,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(g,{minWidth:"400px",children:e.jsx(Zt,{label:"",placeholder:"Search by product ID, name, or details...",value:V,onChange:ot,prefix:e.jsx(es,{}),clearButton:!0,onClearButtonClick:()=>ot("")})}),e.jsx(g,{width:"320px",children:e.jsx(z,{primary:!0,onClick:Tt,disabled:l.length===0&&!y,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(C,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(z,{onClick:Ne,disabled:ae,size:"medium",children:"Sync Products"}),e.jsx(g,{width:"320px",children:e.jsxs(U,{gap:"200",align:"end",children:[(()=>{if(l.length===0&&!y||!x.filter(r=>l.includes(r.id)).some(r=>{var d,a;return((a=(d=r.optimizationSummary)==null?void 0:d.optimizedLanguages)==null?void 0:a.length)>0}))return null;const n=["professional","growth","growth_extra","growth extra","enterprise"].includes(re.toLowerCase().replace(/_/g," "));return e.jsx(z,{onClick:n?Rt:()=>{K({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),X(!0)},disabled:l.length===0&&!y,size:"medium",fullWidth:!0,children:n?"AI Enhanced add-ons for AI Search":"✨ AI Enhanced add-ons"})})(),e.jsx(z,{onClick:kt,disabled:l.length===0&&!y||!x.filter(n=>l.includes(n.id)).some(n=>{var r,d;return((d=(r=n.optimizationSummary)==null?void 0:r.optimizedLanguages)==null?void 0:d.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),k>0&&e.jsx(g,{paddingBlockStart:"300",children:e.jsx(Ae,{label:`Select all ${k} products in your store`,checked:y,onChange:at})})]})}),e.jsx(g,{paddingBlockStart:"400",children:e.jsxs(gt,{children:[e.jsxs(g,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(C,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(C,{gap:"200",wrap:!0,children:[e.jsx(Ee,{active:Ye,activator:e.jsx(z,{disclosure:"down",onClick:()=>ze(!Ye),removeUnderline:!0,children:e.jsxs(C,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),B!=="all"&&e.jsx(g,{onClick:t=>{t.stopPropagation(),xe("all")},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ze(!1),children:e.jsx(g,{padding:"300",minWidth:"200px",children:e.jsx(Oe,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[B],onChange:t=>{xe(t[0]),le(""),ze(!1)}})})}),e.jsx(Ee,{active:Ve,activator:e.jsx(z,{disclosure:"down",onClick:()=>Me(!Ve),removeUnderline:!0,children:e.jsxs(C,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),R&&e.jsx(g,{onClick:t=>{t.stopPropagation(),le("")},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Me(!1),children:e.jsx(g,{padding:"300",minWidth:"200px",children:e.jsx(Oe,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...v.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...v.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:R?[R]:[],onChange:t=>{le(t[0]||""),Me(!1)}})})}),e.jsx(Ee,{active:Qe,activator:e.jsx(z,{disclosure:"down",onClick:()=>Te(!Qe),removeUnderline:!0,children:e.jsxs(C,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),W.length>0&&e.jsx(g,{onClick:t=>{t.stopPropagation(),ye([])},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Te(!1),children:e.jsxs(g,{padding:"300",minWidth:"200px",children:[e.jsx(Oe,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:xt.map(t=>({label:t,value:t})),selected:W,onChange:t=>{ye(t)}}),e.jsx(g,{paddingBlockStart:"200",children:e.jsx(z,{size:"slim",onClick:()=>Te(!1),children:"Apply"})})]})})]}),e.jsx(Ee,{active:Je,activator:e.jsx(z,{disclosure:"down",onClick:()=>ke(!Je),removeUnderline:!0,children:e.jsx(C,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:te==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>ke(!1),children:e.jsx(g,{padding:"300",minWidth:"200px",children:e.jsx(Oe,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[te],onChange:t=>{St(t[0]),ke(!1)}})})})]}),(B!=="all"||R||W.length>0)&&e.jsx(g,{paddingBlockStart:"200",children:e.jsxs(C,{gap:"100",wrap:!0,children:[B!=="all"&&e.jsx(Z,{onRemove:()=>xe("all"),children:B==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),R&&e.jsx(Z,{onRemove:()=>le(""),children:R.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),W.map(t=>e.jsxs(Z,{onRemove:()=>ye(s=>s.filter(n=>n!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(g,{children:[e.jsx(g,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(C,{gap:"200",align:"start",children:[e.jsx(Ae,{checked:l.length===x.length&&x.length>0,onChange:at,label:""}),e.jsxs(i,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",l.length>0&&` (${l.length} selected products)`]})]})}),e.jsx(ts,{resourceName:{singular:"product",plural:"products"},items:x,renderItem:Nt,selectedItems:l,onSelectionChange:Mt,selectable:!0,loading:ae,totalItemsCount:k,emptyState:Kt,showHeader:!1},`products-${x.length}-${l.length}`)]}),ft&&!ae&&e.jsx(g,{padding:"400",textAlign:"center",children:e.jsx(z,{onClick:()=>_(mt+1,!0,null),children:"Load more"})})]})}),Wt,Gt,qt,Ht,Ft,Dt(),e.jsx(O,{open:Ot,onClose:()=>Ce(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Ce(!1),Ne()}},secondaryActions:[{content:"Skip for now",onAction:()=>Ce(!1)}],children:e.jsx(O.Section,{children:e.jsxs(U,{gap:"300",children:[e.jsx(i,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(i,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Qt,{open:$e,onClose:()=>{X(!1),K(null)},featureName:(P==null?void 0:P.error)||"Feature",errorMessage:P==null?void 0:P.message,currentPlan:(P==null?void 0:P.currentPlan)||re,minimumPlanRequired:P==null?void 0:P.minimumPlanRequired,features:P==null?void 0:P.features}),P&&e.jsx(Jt,{open:zt,onClose:()=>{rt(!1),K(null)},tokensRequired:P.tokensRequired||0,tokensAvailable:P.tokensAvailable||0,tokensNeeded:P.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:c,needsUpgrade:P.needsUpgrade||!1,minimumPlan:P.minimumPlanForFeature||null,currentPlan:P.currentPlan||re}),tt&&e.jsx(ss,{content:tt,onDismiss:()=>L("")})]})}export{ps as default};
