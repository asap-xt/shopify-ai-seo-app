import{j as e}from"./app-bridge-DZw0QMxb-1758459818867.js";import{r as n}from"./react-vendor-tAaa2TlE-1758459818867.js";import{u as wt}from"./index-DgldQeds-1758459818867.js";import{U as Tt}from"./UpgradeModal-Bs6bErnn-1758459818867.js";import{M as b,d as M,T as r,e as Fe,a as u,I,f as Te,B as O,D as Dt,g as F,C as Ge,h as zt,S as Ot,P as me,i as fe,R as kt,j as Bt,k as qe,l as Ut,E as Mt}from"./polaris-BoGSbwc9-1758459818867.js";const $t=(k,p="")=>{try{return new URLSearchParams(window.location.search).get(k)||p}catch{return p}},De=k=>{if(!k)return k;const p=String(k).trim();return p.startsWith("gid://")?p:`gid://shopify/Product/${p}`},Kt=k=>{if(!k)return"";const p=String(k).match(/\/(\d+)$/);return p?p[1]:k};function qt({shop:k}){const{api:p,shop:Ve}=wt(),i=k||Ve||$t("shop","");n.useEffect(()=>{console.log("[BULK-EDIT] Component mounted"),console.log("[BULK-EDIT] Shop:",i),console.log("[BULK-EDIT] API function available:",typeof p=="function")},[i,p]);const[v,H]=n.useState([]),[J,ne]=n.useState(!1),[Je,ze]=n.useState(1),[Qe,Se]=n.useState(!0),[xe,Oe]=n.useState(0),[P,Q]=n.useState([]),[T,oe]=n.useState(!1),[R,ke]=n.useState(""),[B,ae]=n.useState("all"),[D,Y]=n.useState(""),[le,Nt]=n.useState("createdAt"),[G,Ye]=n.useState("desc"),[$,ie]=n.useState([]),[Xe,Ze]=n.useState([]),[Be,je]=n.useState(!1),[Ue,ye]=n.useState(!1),[Me,be]=n.useState(!1),[$e,Le]=n.useState(!1),[et,tt]=n.useState(""),[Wt,st]=n.useState([]),[W,re]=n.useState([]),[C,Ke]=n.useState([]),[Ee,q]=n.useState(!1),[ce,K]=n.useState({current:0,total:0,percent:0}),[Ne,V]=n.useState(""),[de,X]=n.useState([]),[Z,We]=n.useState({}),[nt,Ae]=n.useState(!1),[ot,ue]=n.useState(!1),[at,ee]=n.useState(!1),[N,te]=n.useState([]),[lt,ge]=n.useState(!1),[_e,j]=n.useState(""),[Ie,Pe]=n.useState(!1),[L,se]=n.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[Ce,it]=n.useState(null),[rt,pe]=n.useState(!1),[he,ct]=n.useState(localStorage.getItem("hasVisitedProducts")==="true"),[dt,He]=n.useState(!1),[ut,gt]=n.useState("starter");n.useEffect(()=>{i&&p("/plans/me",{shop:i}).then(t=>{const s=(t==null?void 0:t.modelsSuggested)||["anthropic/claude-3.5-sonnet"];st(s.map(o=>({label:o,value:o}))),tt(s[0]),it((t==null?void 0:t.plan)||"starter")}).catch(t=>console.error("[BULK-EDIT] /plans/me failed:",t))},[i,p]),n.useEffect(()=>{if(console.log("[BULK-EDIT] Languages useEffect triggered",{shop:i,api:!!p}),!i){console.log("[BULK-EDIT] No shop, skipping languages load");return}console.log("[BULK-EDIT] Making languages API call to:",`/api/languages/shop/${i}`),console.log("[BULK-EDIT] About to call api() function");const t=new Promise((s,o)=>{setTimeout(()=>o(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([p(`/api/languages/shop/${i}`),t]).then(s=>{console.log("[BULK-EDIT] Languages API response:",s);const o=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];console.log("[BULK-EDIT] Setting available languages to:",o.includes("en")?o:["en",...o]),Ke(o.includes("en")?o:["en",...o])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),console.error("[BULK-EDIT] Error details:",s.message,s.stack),Ke(["en"])})},[i,p]),n.useEffect(()=>{i&&p("/api/products/tags/list",{shop:i}).then(t=>Ze((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[i,p]);const _=n.useCallback(async(t=1,s=!1,o=null)=>{var c,d,S,l;console.log(`[BULK-EDIT-LOAD] loadProducts called with pageNum: ${t}, append: ${s}, timestamp: ${o}`),console.log("[BULK-EDIT-LOAD] Current products state:",v.length),ne(!0);try{const a=new URLSearchParams({shop:i,page:t,limit:50,...B!=="all"&&{optimized:B},...R&&{search:R},...D&&{languageFilter:D},...$.length>0&&{tags:$.join(",")},sortBy:le,sortOrder:G,...o&&{_t:o}}),g=await p(`/api/products/list?${a}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log(`[BULK-EDIT-LOAD] API returned ${((c=g.products)==null?void 0:c.length)||0} products`),((d=g.products)==null?void 0:d.length)>0&&console.log("[BULK-EDIT-LOAD] First product data:",{id:g.products[0]._id,title:g.products[0].title,optimizationSummary:g.products[0].optimizationSummary}),H(s?x=>[...x,...g.products]:g.products||[]),ze(t),Se(((S=g.pagination)==null?void 0:S.hasNext)||!1),Oe(((l=g.pagination)==null?void 0:l.total)||0)}catch(a){H(s?v:[]),Se(!1),j(`Error loading products: ${a.message}`)}finally{ne(!1)}},[i,B,R,D,$,le,G]);n.useEffect(()=>{i&&_(1,!1,null)},[i,_,B,D,$,le,G]),n.useEffect(()=>{!he&&i&&(localStorage.setItem("hasVisitedProducts","true"),ct(!0))},[he,i]),n.useEffect(()=>{v.length===0&&!J&&i&&!he&&pe(!0)},[v.length,J,i,he]);const Re=n.useCallback(t=>{ke(t)},[]);n.useEffect(()=>{const t=setTimeout(()=>{i&&_(1,!1,null)},500);return()=>clearTimeout(t)},[R]);const pt=n.useCallback(t=>{Q(t),t.length===0&&oe(!1)},[]),ht=n.useCallback(t=>{oe(t),Q(t?v.map(s=>s._id):[])},[v]),mt=()=>{if(P.length===0&&!T){j("Please select products first");return}ue(!0)},ft=()=>{if(P.length===0&&!T){j("Please select products first");return}te([]),ee(!0)},St=()=>{const s=v.filter(d=>P.includes(d._id)).filter(d=>{var S,l;return((l=(S=d.optimizationSummary)==null?void 0:S.optimizedLanguages)==null?void 0:l.length)>0}),o=async()=>{var S;if(console.log("üîç [AI-ENHANCE] handleStartEnhancement called with products:",s),Ce&&!["Growth Extra","Enterprise"].includes(Ce)){gt(Ce),Pe(!1),He(!0);return}se({processing:!0,current:0,total:s.length,currentItem:"",results:null});const d={successful:0,failed:0,skipped:0,skippedDueToPlan:0};for(let l=0;l<s.length;l++){const a=s[l];se(g=>({...g,current:l,currentItem:a.title}));try{if(!(await p("/ai-enhance/check-eligibility",{method:"POST",shop:i,body:{shop:i}})).eligible){d.skipped++,d.skippedDueToPlan++;continue}const x=await p("/ai-enhance/product",{method:"POST",shop:i,body:{shop:i,productId:a.gid||`gid://shopify/Product/${a.productId}`,languages:a.optimizationSummary.optimizedLanguages}});if(console.log(`üîç [AI-ENHANCE] Product ${a.productId} enhance data:`,x),x.results&&x.results.length>0){const z={shop:i,productId:a.gid||`gid://shopify/Product/${a.productId}`,results:x.results.filter(f=>f.bullets&&f.faq).map(f=>{var w;const E=`seo_ai.seo__${f.language}`,y=(w=a.metafields)==null?void 0:w.find(U=>U.key===E);let h={};if(y!=null&&y.value)try{h=JSON.parse(y.value)}catch(U){console.warn(`Failed to parse metafield for ${f.language}:`,U),h={}}console.log(`üîç [AI-ENHANCE] Language ${f.language} - existing metafield SEO:`,JSON.stringify(h,null,2)),console.log(`üîç [AI-ENHANCE] Language ${f.language} - AI bullets:`,f.bullets),console.log(`üîç [AI-ENHANCE] Language ${f.language} - AI FAQ:`,f.faq);const A={language:f.language,seo:{title:h.title||`Product ${a.productId}`,metaDescription:h.metaDescription||"Product description",slug:h.slug||`product-${a.productId}`,bodyHtml:h.bodyHtml||"<p>Product description</p>",bullets:f.bullets||[],faq:f.faq||[],imageAlt:h.imageAlt||[],jsonLd:h.jsonLd||{}}};return console.log(`üîç [AI-ENHANCE] Language ${f.language} - final seo result:`,JSON.stringify(A.seo,null,2)),A}),options:{updateBullets:!0,updateFaq:!0}};console.log(`üîç [AI-ENHANCE] Applying data for product ${a.productId}:`,z),console.log("üîç [AI-ENHANCE] First result SEO object:",JSON.stringify((S=z.results[0])==null?void 0:S.seo,null,2));const m=await p("/api/seo/apply-multi",{method:"POST",shop:i,body:z});console.log(`üîç [AI-ENHANCE] Apply result for product ${a.productId}:`,m),d.successful++}else console.log(`üîç [AI-ENHANCE] No valid results for product ${a.productId}:`,x),d.failed++}catch(g){console.error("Enhancement error:",g),d.failed++}se(g=>({...g,current:l+1}))}se(l=>({...l,processing:!1,results:d})),j(`AI enhancement complete! ${d.successful} products enhanced.`)},c=()=>{Pe(!1),se({processing:!1,current:0,total:0,currentItem:"",results:null}),L.results&&L.results.successful>0&&_(1,!1,null)};return!L.processing&&!L.results?e.jsx(b,{open:Ie,title:"AI Enhanced add-ons for AI Search",onClose:c,primaryAction:{content:"Start AI Enhancement",onAction:o},secondaryActions:[{content:"Cancel",onAction:c}],children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["AI enhancement will improve bullets and FAQ for ",s.length," products."]}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI enhancement is only available for Growth Extra and Enterprise plans."})]})})}):L.processing?e.jsx(b,{open:Ie,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",L.currentItem]}),e.jsx(Fe,{progress:L.current/L.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[L.current," of ",L.total," products (",Math.round(L.current/L.total*100),"%)"]})]})})}):L.results!==null?e.jsx(b,{open:Ie,title:"AI Enhancement Results",onClose:c,primaryAction:{content:"Done",onAction:c},children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(I,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:L.results.successful})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:L.results.failed})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:L.results.skipped})]})]}),L.results.skippedDueToPlan>0&&e.jsx(u,{paddingBlockStart:"300",children:e.jsx(r,{variant:"bodySm",tone:"subdued",children:"AI enhancement is only available for Growth Extra and Enterprise plans."})})]})})}):null},xt=async()=>{if(!W.length){j("Please select at least one language");return}ue(!1),q(!0),K({current:0,total:0,percent:0}),X([]),We({});try{let t=[];T?t=(await p(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:t=v.filter(l=>P.includes(l._id));const s=t.length;K({current:0,total:s,percent:0});const o=5,c={};for(let l=0;l<t.length;l+=o){const g=t.slice(l,Math.min(l+o,t.length)).map(async m=>{var f;V(m.title||m.handle||"Product");try{const E=m.gid||De(m.productId||m.id),y=((f=m.optimizationSummary)==null?void 0:f.optimizedLanguages)||[],h=W.filter(w=>!y.includes(w));if(h.length===0){c[m._id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const A=await p("/api/seo/generate-multi",{method:"POST",shop:i,body:{shop:i,productId:E,model:et,languages:h}});c[m._id]={success:!0,data:A,languages:h}}catch(E){c[m._id]={success:!1,error:E.message},X(y=>[...y,{product:m.title,error:E.message}])}});await Promise.all(g);const x=Math.min(l+o,t.length),z=Math.round(x/s*100);K({current:x,total:s,percent:z})}We(c),Ae(!0);const d=Object.keys(c).filter(l=>c[l].success&&!c[l].skipped).length,S=Object.keys(c).filter(l=>c[l].skipped).length;S>0?j(`Generated Optimization for AI Search for ${d} products (${S} already optimised)`):j(`Generated Optimization for AI Search for ${d} products`)}catch(t){j(`Error: ${t.message}`)}finally{q(!1),V("")}},jt=async()=>{var t,s,o,c;q(!0),K({current:0,total:0,percent:0});try{const d=Object.entries(Z).filter(([g,x])=>x.success&&!x.skipped),S=d.length;K({current:0,total:S,percent:0});for(let g=0;g<d.length;g++){const[x,z]=d[g],m=v.find(y=>y._id===x);if(!m)continue;V(m.title||"Product");try{const y=m.gid||De(m.productId||m.id),h=await p("/api/seo/apply-multi",{method:"POST",shop:i,body:{shop:i,productId:y,results:z.data.results.filter(A=>A==null?void 0:A.seo).map(A=>({language:A.language,seo:A.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});h.appliedLanguages&&h.appliedLanguages.length>0&&(console.log(`[BULK-EDIT] Optimistic update for product ${x}, languages:`,h.appliedLanguages),H(A=>A.map(w=>{var U;if(w._id===x){const we=((U=w.optimizationSummary)==null?void 0:U.optimizedLanguages)||[],vt=[...new Set([...we,...h.appliedLanguages])];return{...w,optimizationSummary:{...w.optimizationSummary,optimizedLanguages:vt,optimized:!0,lastOptimized:new Date().toISOString()}}}return w})))}catch(y){X(h=>[...h,{product:m.title,error:`Apply failed: ${y.message}`}])}const f=g+1,E=Math.round(f/S*100);K({current:f,total:S,percent:E})}j("AI Search Optimisation applied successfully!"),Ae(!1),Q([]),oe(!1),console.log("[BULK-EDIT] Waiting for database propagation..."),await new Promise(g=>setTimeout(g,1e3)),console.log("[BULK-EDIT] Clearing products state before reload..."),H([]),console.log("[BULK-EDIT] Reloading products with cache bypass...");const l=new URLSearchParams({shop:i,page:1,limit:50,...B!=="all"&&{optimized:B},...R&&{search:R},...D&&{languageFilter:D},...$.length>0&&{tags:$.join(",")},sortBy:le,sortOrder:G,_t:Date.now()}),a=await p(`/api/products/list?${l}`,{shop:i,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log("[BULK-EDIT] Products reloaded, first product:",(t=a.products[0])==null?void 0:t.title),console.log("[BULK-EDIT] First product optimization summary:",(s=a.products[0])==null?void 0:s.optimizationSummary),H(a.products||[]),ze(1),Se(((o=a.pagination)==null?void 0:o.hasNext)||!1),Oe(((c=a.pagination)==null?void 0:c.total)||0)}catch(d){j(`Error applying AI Search Optimisation: ${d.message}`)}finally{q(!1),V("")}},yt=async()=>{var t,s;if(!N.length){j("Please select at least one language to delete");return}ee(!1),ge(!1),q(!0),K({current:0,total:0,percent:0}),X([]);try{let o=[];T?o=(await p(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:o=v.filter(l=>P.includes(l._id));const c=o.length;K({current:0,total:c,percent:0});let d=0,S=0;for(let l=0;l<o.length;l++){const a=o[l];V(a.title||a.handle||"Product");try{const z=a.gid||De(a.productId||a.id),m=((t=a.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],f=N.filter(y=>m&&m.length>0&&m.includes(y));if(console.log("[BULK-DELETE] Product optimized languages:",m),console.log("[BULK-DELETE] Languages to delete:",f),f.length===0){S++;continue}const E=await p("/api/seo/delete-multi",{method:"POST",shop:i,body:{shop:i,productId:z,languages:f}});console.log("[BULK-DELETE] Delete response:",E),console.log("[BULK-DELETE] Deleted languages:",E.deletedLanguages),E.deletedLanguages&&E.deletedLanguages.length>0&&(console.log("[BULK-DELETE] Before optimistic update, product:",a),console.log("[BULK-DELETE] Current optimized languages:",(s=a.optimizationSummary)==null?void 0:s.optimizedLanguages),H(y=>y.map(h=>{var A;if(h._id===a._id){const w=((A=h.optimizationSummary)==null?void 0:A.optimizedLanguages)||[],U=w.filter(we=>!E.deletedLanguages.includes(we));return console.log("[BULK-DELETE] Updating product:",h._id),console.log("[BULK-DELETE] Languages before:",w),console.log("[BULK-DELETE] Languages after:",U),{...h,optimizationSummary:{...h.optimizationSummary,optimizedLanguages:U,optimized:U.length>0,lastOptimized:U.length>0?h.optimizationSummary.lastOptimized:null}}}return h})),console.log("[BULK-DELETE] State updated, checking first product:",v[0])),d++,E.deletedLanguages&&E.deletedLanguages.length>0&&await p("/api/products/verify-after-delete",{method:"POST",shop:i,body:{shop:i,productIds:[z],deletedLanguages:E.deletedLanguages}})}catch(z){X(m=>[...m,{product:a.title,error:z.message}])}const g=l+1,x=Math.round(g/c*100);K({current:g,total:c,percent:x})}Q([]),oe(!1),S>0?j(`Deleted Optimization for AI Search from ${d} products (${S} had no optimisation to delete)`):j(`Deleted Optimization for AI Search from ${d} products`),console.log("[BULK-DELETE] Operation successful!"),setTimeout(()=>{console.log("[BULK-DELETE] Triggering reload with timestamp");const l=Date.now();_(1,!1,l)},500)}catch(o){j(`Error: ${o.message}`)}finally{q(!1),V("")}},bt=t=>{var S,l;const s=t,o=Kt(s.productId||s.id),c=((S=s.optimizationSummary)==null?void 0:S.optimizedLanguages)||[];console.log(`[BULK-EDIT] Rendering product: "${s.title}"`),console.log("[BULK-EDIT] optimizationSummary:",s.optimizationSummary),console.log("[BULK-EDIT] optimizedLanguages:",c),console.log("[BULK-EDIT] availableLanguages:",C);const d=(l=s.images)!=null&&l[0]?e.jsx(qe,{source:s.images[0].url||s.images[0].src||s.images[0],alt:s.title,size:"small"}):s.imageUrl?e.jsx(qe,{source:s.imageUrl,alt:s.title,size:"small"}):e.jsx(u,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Ut,{id:s._id,url:"",media:d,accessibilityLabel:`View details for ${s.title}`,children:e.jsxs(I,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(u,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:s.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["ID: ",o]})]}),e.jsx(u,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(I,{gap:"100",children:(console.log(`[BULK-EDIT] Rendering badges for "${s.title}"`),console.log("[BULK-EDIT] availableLanguages.length:",C.length),console.log("[BULK-EDIT] availableLanguages:",C),console.log("[BULK-EDIT] optimizedLanguages:",c),C.length>0?(console.log("[BULK-EDIT] Using availableLanguages.map"),C.map(a=>{const g=c.includes(a);return console.log(`[BULK-EDIT] Language ${a}: optimized=${g}`),e.jsx(F,{tone:g?"success":"subdued",size:"small",children:a.toUpperCase()},a)})):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),c.map(a=>e.jsx(F,{tone:"success",size:"small",children:a.toUpperCase()},a))))})}),e.jsx(u,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(F,{tone:"success",children:"Active"})})]})})},Lt=Ee&&e.jsx(b,{open:Ee,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:Ne?`Processing: ${Ne}`:"Preparing..."}),e.jsx(Fe,{progress:ce.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[ce.current," of ",ce.total," products (",ce.percent,"%)"]})]})})}),Et=e.jsx(b,{open:ot,title:"Select Languages",onClose:()=>{ue(!1),re([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:xt,disabled:W.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{ue(!1),re([])}}],children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",T?"all":P.length," selected products:"]}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(I,{gap:"200",wrap:!0,children:C.map(t=>e.jsx(Te,{label:t.toUpperCase(),checked:W.includes(t),onChange:s=>{re(s?[...W,t]:W.filter(o=>o!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(O,{plain:!0,onClick:()=>{re(W.length===C.length?[]:[...C])},children:W.length===C.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),At=e.jsx(b,{open:nt&&!Ee,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:jt,disabled:!Object.values(Z).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Ae(!1)}],children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(I,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(Z).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(Z).filter(t=>t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(Z).filter(t=>!t.success).length})]})]}),de.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Dt,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(u,{maxHeight:"200px",overflowY:"scroll",children:[de.slice(0,10).map((t,s)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),de.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",de.length-10," more errors"]})]})]})]})})}),It=e.jsx(b,{open:at,title:"Delete Optimization for AI Search",onClose:()=>{ee(!1),te([])},primaryAction:{content:"Continue",onAction:()=>{ee(!1),ge(!0)},disabled:N.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{ee(!1),te([])}}],children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",T?"all":P.length," selected products:"]}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(I,{gap:"200",wrap:!0,children:C.map(t=>e.jsx(Te,{label:t.toUpperCase(),checked:N.includes(t),onChange:s=>{te(s?[...N,t]:N.filter(o=>o!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(O,{plain:!0,onClick:()=>{te(N.length===C.length?[]:[...C])},children:N.length===C.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Pt=e.jsx(b,{open:lt,title:"Confirm Deletion",onClose:()=>{ge(!1)},primaryAction:{content:"Delete",onAction:yt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>ge(!1)}],children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(u,{paddingBlock:"200",children:e.jsx(I,{gap:"100",children:N.map(t=>e.jsx(F,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",T?"ALL":P.length," selected products."]}),e.jsx(r,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),ve=async()=>{try{ne(!0),j("Syncing products from Shopify...");const t=await p("/api/products/sync",{method:"POST",shop:i});if(t.success)j(`‚úÖ Synced ${t.synced} products successfully!`),setTimeout(()=>{_(1,!1,Date.now())},1e3);else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),j(`‚ùå Sync failed: ${t.message}`)}finally{ne(!1)}},Ct=e.jsx(Mt,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{ke(""),ae("all"),Y(""),ie([]),_(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:ve},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Ge,{children:e.jsxs(u,{padding:"400",children:[e.jsxs(M,{gap:"300",children:[e.jsxs(I,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(u,{minWidth:"400px",children:e.jsx(zt,{label:"",placeholder:"Search by product ID, name, or details...",value:R,onChange:Re,prefix:e.jsx(Ot,{}),clearButton:!0,onClearButtonClick:()=>Re("")})}),e.jsx(u,{width:"320px",children:e.jsx(O,{primary:!0,onClick:mt,disabled:P.length===0&&!T,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(I,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(O,{onClick:ve,disabled:J,size:"medium",children:"Sync Products"}),e.jsx(u,{width:"320px",children:e.jsxs(M,{gap:"200",align:"end",children:[P.length===0&&!T||!v.filter(o=>P.includes(o._id)).some(o=>{var c,d;return((d=(c=o.optimizationSummary)==null?void 0:c.optimizedLanguages)==null?void 0:d.length)>0})?null:e.jsx(O,{onClick:()=>Pe(!0),disabled:P.length===0&&!T,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(O,{onClick:ft,disabled:P.length===0&&!T||!v.filter(o=>P.includes(o._id)).some(o=>{var c,d;return((d=(c=o.optimizationSummary)==null?void 0:c.optimizedLanguages)==null?void 0:d.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),xe>0&&e.jsx(u,{paddingBlockStart:"300",children:e.jsx(Te,{label:`Select all ${xe} products in your store`,checked:T,onChange:ht})})]})}),e.jsx(u,{paddingBlockStart:"400",children:e.jsxs(Ge,{children:[e.jsxs(u,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(I,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(I,{gap:"200",wrap:!0,children:[e.jsx(me,{active:Be,activator:e.jsx(O,{disclosure:"down",onClick:()=>je(!Be),removeUnderline:!0,children:e.jsxs(I,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),B!=="all"&&e.jsx(u,{onClick:t=>{t.stopPropagation(),ae("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>je(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(fe,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[B],onChange:t=>{ae(t[0]),Y(""),je(!1)}})})}),e.jsx(me,{active:Ue,activator:e.jsx(O,{disclosure:"down",onClick:()=>ye(!Ue),removeUnderline:!0,children:e.jsxs(I,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),D&&e.jsx(u,{onClick:t=>{t.stopPropagation(),Y("")},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>ye(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(fe,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...C.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...C.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:D?[D]:[],onChange:t=>{Y(t[0]||""),ye(!1)}})})}),e.jsx(me,{active:Me,activator:e.jsx(O,{disclosure:"down",onClick:()=>be(!Me),removeUnderline:!0,children:e.jsxs(I,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),$.length>0&&e.jsx(u,{onClick:t=>{t.stopPropagation(),ie([])},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>be(!1),children:e.jsxs(u,{padding:"300",minWidth:"200px",children:[e.jsx(fe,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:Xe.map(t=>({label:t,value:t})),selected:$,onChange:t=>{ie(t)}}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(O,{size:"slim",onClick:()=>be(!1),children:"Apply"})})]})})]}),e.jsx(me,{active:$e,activator:e.jsx(O,{disclosure:"down",onClick:()=>Le(!$e),removeUnderline:!0,children:e.jsx(I,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:G==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Le(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(fe,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[G],onChange:t=>{Ye(t[0]),Le(!1)}})})})]}),(B!=="all"||D||$.length>0)&&e.jsx(u,{paddingBlockStart:"200",children:e.jsxs(I,{gap:"100",wrap:!0,children:[B!=="all"&&e.jsx(F,{onRemove:()=>ae("all"),children:B==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),D&&e.jsx(F,{onRemove:()=>Y(""),children:D.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),$.map(t=>e.jsxs(F,{onRemove:()=>ie(s=>s.filter(o=>o!==t)),children:["Tag: ",t]},t))]})})]}),e.jsx(kt,{resourceName:{singular:"product",plural:"products"},items:v,renderItem:bt,selectedItems:P,onSelectionChange:pt,selectable:!0,loading:J,totalItemsCount:xe,emptyState:Ct,showHeader:!1}),Qe&&!J&&e.jsx(u,{padding:"400",textAlign:"center",children:e.jsx(O,{onClick:()=>_(Je+1,!0,null),children:"Load more"})})]})}),Lt,Et,At,It,Pt,St(),e.jsx(b,{open:rt,onClose:()=>pe(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{pe(!1),ve()}},secondaryActions:[{content:"Skip for now",onAction:()=>pe(!1)}],children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(r,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Tt,{open:dt,onClose:()=>He(!1),featureName:"AI Enhancement",currentPlan:ut}),_e&&e.jsx(Bt,{content:_e,onDismiss:()=>j("")})]})}export{qt as default};
