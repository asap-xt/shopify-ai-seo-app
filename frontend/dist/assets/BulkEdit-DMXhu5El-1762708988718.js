import{j as e}from"./app-bridge-iczP3bKW-1762708988718.js";import{r as a}from"./react-vendor-tAaa2TlE-1762708988718.js";import{u as Vt}from"./useShopApi-DGu6zAHq-1762708988718.js";import{S as Qt,U as Jt}from"./StoreMetadataBanner-DEYLhKjk-1762708988718.js";import{I as Xt}from"./InsufficientTokensModal-BqujAbG6-1762708988718.js";import{M as L,a as $,T as c,e as dt,d as Fe,b as O,B as p,I as P,g as Ie,D as Zt,f as Z,C as ut,h as es,S as ts,i as Le,j as ze,R as ss,k as ns,l as pt,m as rs,E as as}from"./polaris-CT7L0LfG-1762708988718.js";const os=(I,S="")=>{try{return new URLSearchParams(window.location.search).get(I)||S}catch{return S}},xe=I=>{if(!I)return I;const S=String(I).trim();return S.startsWith("gid://")?S:`gid://shopify/Product/${S}`},is=I=>{if(!I)return"";const S=String(I).match(/\/(\d+)$/);return S?S[1]:I},Ee=I=>I<=70?"Starter":I<=200?"Professional":I<=450?"Growth":I<=750?"Growth Extra":"Enterprise";function ms({shop:I,globalPlan:S}){var it,lt,ct;const{api:w,shop:ht}=Vt(),d=I||ht||os("shop","");a.useEffect(()=>{},[d,w]);const[j,Y]=a.useState([]),[ie,Se]=a.useState(!1),[gt,Oe]=a.useState(1),[mt,je]=a.useState(!0),[D,ke]=a.useState(0),[h,ne]=a.useState([]),[f,le]=a.useState(!1),[G,Ye]=a.useState(""),[T,ye]=a.useState("all"),[k,ce]=a.useState(""),[de,ls]=a.useState("createdAt"),[ee,ft]=a.useState("desc"),[U,be]=a.useState([]),[xt,St]=a.useState([]),[Ke,Me]=a.useState(!1),[Ve,Te]=a.useState(!1),[Qe,Re]=a.useState(!1),[Je,$e]=a.useState(!1),[jt,yt]=a.useState(""),[bt,wt]=a.useState([]),[B,re]=a.useState([]),[z,Xe]=a.useState([]),[De,te]=a.useState(!1),[we,W]=a.useState({current:0,total:0,percent:0}),[Ze,ae]=a.useState(""),[Pe,ue]=a.useState([]),[pe,et]=a.useState({}),[Pt,Ue]=a.useState(!1),[At,he]=a.useState(!1),[Ct,ge]=a.useState(!1),[H,me]=a.useState([]),[vt,Ae]=a.useState(!1),[tt,A]=a.useState(""),[st,nt]=a.useState(!1),[v,se]=a.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[q,It]=a.useState(null),[E,Lt]=a.useState(70),[K,Be]=a.useState(1),[zt,Ce]=a.useState(!1),[ve,Et]=a.useState(localStorage.getItem("hasVisitedProducts")==="true"),[Ne,V]=a.useState(!1),[Ot,We]=a.useState(!1),[x,F]=a.useState(null),[Q,fe]=a.useState("starter");a.useEffect(()=>{if(!(!S||typeof S!="object")){if(S.planKey&&S.planKey!==""){fe(S.planKey);const n={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[S.planKey.toLowerCase()]||1;Be(n)}else if(S.plan&&S.plan!==""){const t=S.plan.toLowerCase().replace(/\s+/g,"-");fe(t);const s={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[t]||1;Be(s)}}},[S]),a.useEffect(()=>{Ne&&q&&(f?D:h.length)<=E&&(V(!1),F(null))},[h.length,f,D,Ne,q]),a.useEffect(()=>{if(!d)return;w("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
          language_limit
        }
      }
    `,variables:{shop:d}})}).then(n=>{var o,i,l;if((o=n==null?void 0:n.errors)!=null&&o.length)throw new Error(((i=n.errors[0])==null?void 0:i.message)||"GraphQL error");const s=(l=n==null?void 0:n.data)==null?void 0:l.plansMe,u=(s==null?void 0:s.modelsSuggested)||["anthropic/claude-3.5-sonnet"];wt(u.map(r=>({label:r,value:r}))),yt(u[0]),It((s==null?void 0:s.plan)||"starter"),fe((s==null?void 0:s.planKey)||"starter"),Lt((s==null?void 0:s.product_limit)||70),Be((s==null?void 0:s.language_limit)||1)}).catch(n=>console.error("[BULK-EDIT] GraphQL plansMe failed:",n))},[d,w]),a.useEffect(()=>{if(!d)return;const t=new Promise((n,s)=>{setTimeout(()=>s(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([w(`/api/languages/shop/${d}`),t]).then(n=>{const s=Array.isArray(n==null?void 0:n.shopLanguages)&&n.shopLanguages.length?n.shopLanguages:["en"];Xe(s.includes("en")?s:["en",...s])}).catch(n=>{console.error("[BULK-EDIT] Languages API error:",n),Xe(["en"])})},[d,w]),a.useEffect(()=>{d&&w("/api/products/tags/list",{shop:d}).then(t=>St((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[d,w]);const oe=a.useCallback(async(t=1,n=!1,s=null)=>{var u,o,i,l;Se(!0);try{const r=new URLSearchParams({shop:d,page:t,limit:50,...T!=="all"&&{optimized:T},...G&&{search:G},...k&&{languageFilter:k},...U.length>0&&{tags:U.join(",")},sortBy:de,sortOrder:ee,...s&&{_t:s}}),m=await w(`/api/products/list?${r}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((u=m.products)==null?void 0:u.length)>0,((o=m.products)==null?void 0:o.length)>0&&m.products.forEach((y,b)=>{}),Y(n?y=>[...y,...m.products]:m.products||[]),Oe(t),je(((i=m.pagination)==null?void 0:i.hasNext)||!1),ke(((l=m.pagination)==null?void 0:l.total)||0)}catch(r){Y(n?j:[]),je(!1),A(`Error loading products: ${r.message}`)}finally{Se(!1)}},[d,T,G,k,U,de,ee]);a.useEffect(()=>{d&&oe(1,!1,null)},[d,T,k,U,de,ee]),a.useEffect(()=>{!ve&&d&&(localStorage.setItem("hasVisitedProducts","true"),Et(!0))},[ve,d]),a.useEffect(()=>{j.length===0&&!ie&&d&&!ve&&Ce(!0)},[j.length,ie,d,ve]),a.useEffect(()=>{},[j,h]);const rt=a.useCallback(t=>{Ye(t)},[]);a.useEffect(()=>{const t=setTimeout(()=>{d&&oe(1,!1,null)},500);return()=>clearTimeout(t)},[G]);const kt=a.useCallback(t=>{ne(t),t.length===0&&le(!1)},[j]),at=a.useCallback(t=>{le(t),ne(t?j.map(n=>n.id):[])},[j]),ot=a.useMemo(()=>{var n;if(f)return B.length>K;const t=j.filter(s=>h.includes(s.id));if(t.length===0)return B.length>K;for(const s of t){const u=((n=s.optimizationSummary)==null?void 0:n.optimizedLanguages)||[],o=B.filter(l=>!u.includes(l));if(u.length+o.length>K)return!0}return!1},[j,h,f,K,B]),Mt=()=>{if(h.length===0&&!f){A("Please select products first");return}he(!0)},Tt=()=>{if(h.length===0&&!f){A("Please select products first");return}me([]),ge(!0)},Rt=async()=>{const t=j.filter(i=>h.includes(i.id)),n=t.filter(i=>{var l,r;return((r=(l=i.optimizationSummary)==null?void 0:l.optimizedLanguages)==null?void 0:r.length)>0}),s=t.filter(i=>{var l,r;return!((r=(l=i.optimizationSummary)==null?void 0:l.optimizedLanguages)!=null&&r.length)}),u=n.length;if(u>E){const i=Ee(u);F({error:"Product limit exceeded",message:`Your ${q} plan supports up to ${E} products for AI Enhancement. You have selected ${u} products with Basic SEO.`,minimumPlanRequired:i,currentPlan:q,features:[`Optimize up to ${E} products`,"All features from your current plan",i==="Growth Extra"||i==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",i==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),V(!0);return}nt(!0),se({processing:!0,current:0,total:n.length,currentItem:"",results:null});const o={successful:0,failed:0,skipped:s.length,skipReasons:s.length>0?[`${s.length} product(s): No Basic Optimization`]:[]};for(let i=0;i<n.length;i++){const l=n[i];se(r=>({...r,current:i,currentItem:l.title}));try{const r=await w("/ai-enhance/product",{method:"POST",shop:d,body:{shop:d,productId:l.gid||xe(l.id),languages:l.optimizationSummary.optimizedLanguages}});if(r.results&&r.results.length>0){const m={shop:d,productId:l.gid||xe(l.id),results:r.results.filter(b=>b.bullets&&b.faq).map(b=>({language:b.language,seo:{...b.updatedSeo,bullets:b.bullets||[],faq:b.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},y=await w("/api/seo/apply-multi",{method:"POST",shop:d,body:m});o.successful++}else o.failed++}catch(r){if(console.error("âŒ [AI-ENHANCE] Enhancement error:",r),console.error("ðŸ” [AI-ENHANCE DEBUG] Error type:",typeof r),console.error("ðŸ” [AI-ENHANCE DEBUG] Error.status:",r.status,"Type:",typeof r.status),console.error("ðŸ” [AI-ENHANCE DEBUG] Error.requiresPurchase:",r.requiresPurchase),console.error("ðŸ” [AI-ENHANCE DEBUG] Error.trialRestriction:",r.trialRestriction),console.error("ðŸ” [AI-ENHANCE DEBUG] Full error object:",JSON.stringify(r,Object.getOwnPropertyNames(r))),console.error("ðŸ” [AI-ENHANCE DEBUG] Error details:",{status:r.status,trialRestriction:r.trialRestriction,needsUpgrade:r.needsUpgrade,requiresPurchase:r.requiresPurchase,message:r.message,currentPlan:r.currentPlan}),r.status===403){se({processing:!1,current:0,total:0,currentItem:"",results:null}),F({...r,message:r.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),fe(r.currentPlan||Q),r.needsUpgrade===!1&&r.requiresPurchase?We(!0):V(!0);return}if(r.status===402||r.requiresPurchase||r.trialRestriction){se({processing:!1,current:0,total:0,currentItem:"",results:null}),F(r),fe(r.currentPlan||q||"starter"),r.trialRestriction?V(!0):We(!0);return}o.failed++}se(r=>({...r,current:i+1}))}se(i=>({...i,processing:!1,results:o})),A(`AI enhancement complete! ${o.successful} products enhanced.`)},qe=async()=>{var t,n;if(nt(!1),se({processing:!1,current:0,total:0,currentItem:"",results:null}),v.results&&v.results.successful>0){await new Promise(o=>setTimeout(o,1e3));const s=new URLSearchParams({shop:d,page:1,limit:50,...T!=="all"&&{optimized:T},...G&&{search:G},...k&&{languageFilter:k},...U.length>0&&{tags:U.join(",")},sortBy:de,sortOrder:ee,_t:Date.now()}),u=await w(`/api/products/list?${s}`,{shop:d,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});Y(u.products||[]),Oe(1),je(((t=u.pagination)==null?void 0:t.hasNext)||!1),ke(((n=u.pagination)==null?void 0:n.total)||0)}},$t=()=>v.processing?e.jsx(L,{open:st,title:"Processing AI Enhancement",onClose:qe,noScroll:!0,children:e.jsx(L.Section,{children:e.jsxs($,{gap:"400",children:[e.jsxs(c,{variant:"bodyMd",children:["Processing: ",v.currentItem]}),e.jsx(dt,{progress:v.current/v.total*100}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:[v.current," of ",v.total," products (",Math.round(v.current/v.total*100),"%)"]})]})})}):v.results!==null?e.jsx(L,{open:st,title:"AI Enhancement Results",onClose:qe,primaryAction:{content:"Done",onAction:qe},children:e.jsx(L.Section,{children:e.jsxs($,{gap:"400",children:[e.jsxs(P,{gap:"400",children:[e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:v.results.successful})]}),e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:v.results.failed})]}),e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:v.results.skipped})]})]}),v.results.skipReasons&&v.results.skipReasons.length>0&&e.jsxs($,{gap:"200",children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped products:"}),v.results.skipReasons.map((t,n)=>e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["â€¢ ",t]},n))]})]})})}):null,Dt=async()=>{var n;if(!B.length){A("Please select at least one language");return}let t=jt;(!t||!t.trim())&&(t=((n=bt[0])==null?void 0:n.value)||"anthropic/claude-3.5-sonnet"),te(!0),W({current:0,total:0,percent:0}),ue([]),et({});try{let s=[];f?s=(await w(`/api/products/list?shop=${encodeURIComponent(d)}&limit=1000&fields=id`)).products||[]:s=j.filter(g=>h.includes(g.id));const u=s.length;if(u>E){te(!1),W({current:0,total:0,percent:0}),he(!1);const g=Ee(u);F({error:"Product limit exceeded",message:`Your ${Q} plan supports up to ${E} products for SEO optimization. You have selected ${u} products.`,minimumPlanRequired:g,currentPlan:Q,features:["Optimize more products","All features from your current plan",g==="Growth Extra"||g==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",g==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),V(!0);return}he(!1);const o=u,i=0;W({current:0,total:o,percent:0});const l=5,r={};for(let g=0;g<s.length;g+=l){const N=s.slice(g,Math.min(g+l,s.length)).map(async M=>{var J;ae(M.title||M.handle||"Product");try{const X=M.gid||xe(M.productId||M.id),Ge=((J=M.optimizationSummary)==null?void 0:J.optimizedLanguages)||[],He=B.filter(Kt=>!Ge.includes(Kt));if(He.length===0){r[M.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Yt=await w("/api/seo/generate-multi",{method:"POST",shop:d,body:{shop:d,productId:X,model:t,languages:He}});r[M.id]={success:!0,data:Yt,languages:He}}catch(X){r[M.id]={success:!1,error:X.message},ue(Ge=>[...Ge,{product:M.title,error:X.message}])}});await Promise.all(N);const C=Math.min(g+l,s.length),_=Math.round(C/o*100);W({current:C,total:o,percent:_})}et(r),Ue(!0);const m=Object.keys(r).filter(g=>r[g].success&&!r[g].skipped).length,y=Object.keys(r).filter(g=>r[g].skipped).length;let b=`Generated Optimization for AI Search for ${m} products`;y>0&&(b+=` (${y} already optimised)`),i>0,A(b)}catch(s){A(`Error: ${s.message}`)}finally{te(!1),ae("")}},Ut=async()=>{var t,n;te(!0),W({current:0,total:0,percent:0});try{const s=Object.entries(pe).filter(([l,r])=>r.success&&!r.skipped),u=s.length;W({current:0,total:u,percent:0});for(let l=0;l<s.length;l++){const[r,m]=s[l],y=j.find(R=>R.id===r);if(!y)continue;ae(y.title||"Product");try{const R=y.gid||xe(y.productId||y.id),N=await w("/api/seo/apply-multi",{method:"POST",shop:d,body:{shop:d,productId:R,results:m.data.results.filter(C=>C==null?void 0:C.seo).map(C=>({language:C.language,seo:C.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});N.appliedLanguages&&N.appliedLanguages.length>0&&Y(C=>C.map(_=>{var M;if(_.id===r){const J=((M=_.optimizationSummary)==null?void 0:M.optimizedLanguages)||[],X=[...new Set([...J,...N.appliedLanguages])];return{..._,optimizationSummary:{..._.optimizationSummary,optimizedLanguages:X,optimized:!0,lastOptimized:new Date().toISOString()}}}return _}))}catch(R){ue(N=>[...N,{product:y.title,error:`Apply failed: ${R.message}`}])}const b=l+1,g=Math.round(b/u*100);W({current:b,total:u,percent:g})}A("AI Search Optimisation applied successfully!"),Ue(!1),ne([]),le(!1),await new Promise(l=>setTimeout(l,1e3)),Y([]);const o=new URLSearchParams({shop:d,page:1,limit:50,...T!=="all"&&{optimized:T},...G&&{search:G},...k&&{languageFilter:k},...U.length>0&&{tags:U.join(",")},sortBy:de,sortOrder:ee,_t:Date.now()}),i=await w(`/api/products/list?${o}`,{shop:d,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});Y(i.products||[]),Oe(1),je(((t=i.pagination)==null?void 0:t.hasNext)||!1),ke(((n=i.pagination)==null?void 0:n.total)||0)}catch(s){A(`Error applying AI Search Optimisation: ${s.message}`)}finally{te(!1),ae("")}},Bt=async()=>{var t;if(!H.length){A("Please select at least one language to delete");return}ge(!1),Ae(!1),te(!0),W({current:0,total:0,percent:0}),ue([]);try{let n=[];f?n=(await w(`/api/products/list?shop=${encodeURIComponent(d)}&limit=1000&fields=id`)).products||[]:n=j.filter(i=>h.includes(i.id));const s=n.length;W({current:0,total:s,percent:0});let u=0,o=0;for(let i=0;i<n.length;i++){const l=n[i];ae(l.title||l.handle||"Product");try{const y=l.gid||xe(l.productId||l.id),b=((t=l.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],g=H.filter(N=>b&&b.length>0&&b.includes(N));if(g.length===0){o++;continue}const R=await w("/api/seo/delete-multi",{method:"POST",shop:d,body:{shop:d,productId:y,languages:g}});R.deletedLanguages&&R.deletedLanguages.length>0&&Y(N=>N.map(C=>{var _;if(C.id===l.id){const J=(((_=C.optimizationSummary)==null?void 0:_.optimizedLanguages)||[]).filter(X=>!R.deletedLanguages.includes(X));return{...C,optimizationSummary:{...C.optimizationSummary,optimizedLanguages:J,optimized:J.length>0,lastOptimized:J.length>0?C.optimizationSummary.lastOptimized:null}}}return C})),u++,R.deletedLanguages&&R.deletedLanguages.length>0&&await w("/api/products/verify-after-delete",{method:"POST",shop:d,body:{shop:d,productIds:[y],deletedLanguages:R.deletedLanguages}})}catch(y){ue(b=>[...b,{product:l.title,error:y.message}])}const r=i+1,m=Math.round(r/s*100);W({current:r,total:s,percent:m})}ne([]),le(!1),o>0?A(`Deleted Optimization for AI Search from ${u} products (${o} had no optimisation to delete)`):A(`Deleted Optimization for AI Search from ${u} products`),setTimeout(()=>{const i=Date.now();oe(1,!1,i)},500)}catch(n){A(`Error: ${n.message}`)}finally{te(!1),ae("")}},Nt=t=>{var n,s,u;try{const o=t,i=is(o.productId||o.id),l=((n=o.optimizationSummary)==null?void 0:n.optimizedLanguages)||[],r=(s=o.images)!=null&&s[0]?e.jsx(pt,{source:o.images[0].url||o.images[0].src||o.images[0],alt:o.title,size:"small"}):o.imageUrl?e.jsx(pt,{source:o.imageUrl,alt:o.title,size:"small"}):e.jsx(p,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(rs,{id:o.id,media:r,accessibilityLabel:`View details for ${o.title}`,onClick:m=>{},children:e.jsxs(P,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(p,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:o.title}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["ID: ",i]})]}),e.jsx(p,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsxs(P,{gap:"100",wrap:!0,children:[z.length>0?z.map(m=>{const y=l.includes(m);return e.jsx(Z,{tone:y?"success":"subdued",size:"small",children:m.toUpperCase()},m)}):l.map(m=>e.jsx(Z,{tone:"success",size:"small",children:m.toUpperCase()},m)),((u=o.optimizationSummary)==null?void 0:u.aiEnhanced)&&e.jsx(Z,{tone:"info",size:"small",children:"AIâœ¨"})]})}),e.jsx(p,{style:{flex:"0 0 20%",minWidth:"120px",textAlign:"center"},children:e.jsx(Z,{tone:"success",children:"Active"})})]})})}catch(o){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",o),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},Wt=De&&e.jsx(L,{open:De,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(L.Section,{children:e.jsxs($,{gap:"400",children:[e.jsx(c,{variant:"bodyMd",children:Ze?`Processing: ${Ze}`:"Preparing..."}),e.jsx(dt,{progress:we.percent}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:[we.current," of ",we.total," products (",we.percent,"%)"]})]})})}),qt=e.jsx(L,{open:At,title:"Select Languages",onClose:()=>{he(!1),re([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Dt,disabled:B.length===0||ot},secondaryActions:[{content:"Cancel",onAction:()=>{he(!1),re([])}}],children:e.jsx(L.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(c,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",f?"all":h.length," selected products:"]}),ot&&e.jsx(Fe,{tone:"warning",title:"Language limit exceeded",children:e.jsxs($,{gap:"200",children:[e.jsxs(c,{variant:"bodyMd",children:["Your ",Q," plan supports up to ",K," language",K>1?"s":""," per product.",h.length===1&&((ct=(lt=(it=j.find(t=>t.id===h[0]))==null?void 0:it.optimizationSummary)==null?void 0:lt.optimizedLanguages)==null?void 0:ct.length)>0&&e.jsxs(e.Fragment,{children:[" This product already has ",j.find(t=>t.id===h[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(c,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(O,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),n=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${n}`},children:"Upgrade Plan"})]})}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(P,{gap:"200",wrap:!0,children:z.map(t=>e.jsx(Ie,{label:t.toUpperCase(),checked:B.includes(t),onChange:n=>{re(n?[...B,t]:B.filter(s=>s!==t))}},t))})}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(O,{plain:!0,onClick:()=>{B.length===z.length?re([]):z.length>K?(re([...z]),A(`You selected ${z.length} languages. Your ${Q} plan supports ${K}. Please deselect or upgrade.`)):re([...z])},children:B.length===z.length?"Deselect all":"Select all"})}),e.jsx(c,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),_t=e.jsx(L,{open:Pt&&!De,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:Ut,disabled:!Object.values(pe).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Ue(!1)}],children:e.jsx(L.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(P,{gap:"400",children:[e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(pe).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(pe).filter(t=>t.skipped).length})]}),e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(pe).filter(t=>!t.success).length})]})]}),Pe.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Zt,{}),e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(p,{maxHeight:"200px",overflowY:"scroll",children:[Pe.slice(0,10).map((t,n)=>e.jsxs(c,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},n)),Pe.length>10&&e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["... and ",Pe.length-10," more errors"]})]})]})]})})}),Gt=e.jsx(L,{open:Ct,title:"Delete Optimization for AI Search",onClose:()=>{ge(!1),me([])},primaryAction:{content:"Continue",onAction:()=>{ge(!1),Ae(!0)},disabled:H.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{ge(!1),me([])}}],children:e.jsx(L.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(c,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",f?"all":h.length," selected products:"]}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(P,{gap:"200",wrap:!0,children:z.map(t=>e.jsx(Ie,{label:t.toUpperCase(),checked:H.includes(t),onChange:n=>{me(n?[...H,t]:H.filter(s=>s!==t))}},t))})}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(O,{plain:!0,onClick:()=>{me(H.length===z.length?[]:[...z])},children:H.length===z.length?"Deselect all":"Select all"})}),e.jsx(c,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Ht=e.jsx(L,{open:vt,title:"Confirm Deletion",onClose:()=>{Ae(!1)},primaryAction:{content:"Delete",onAction:Bt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>Ae(!1)}],children:e.jsx(L.Section,{children:e.jsxs($,{gap:"300",children:[e.jsx(c,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(p,{paddingBlock:"200",children:e.jsx(P,{gap:"100",children:H.map(t=>e.jsx(Z,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(c,{variant:"bodyMd",children:["This will delete optimisation from ",f?"ALL":h.length," selected products."]}),e.jsx(c,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),_e=async()=>{try{Se(!0),A("Syncing products from Shopify...");const t=await w("/api/products/sync",{method:"POST",shop:d});if(t.success){const n=t.productsCount||t.synced||0;A(`âœ… Synced ${n} products successfully!`),setTimeout(()=>{oe(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),A(`âŒ Sync failed: ${t.message}`)}finally{Se(!1)}},Ft=e.jsx(as,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Ye(""),ye("all"),ce(""),be([]),oe(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:_e},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Qt,{globalPlan:S}),e.jsx(ut,{children:e.jsxs(p,{padding:"400",children:[e.jsxs($,{gap:"300",children:[q&&e.jsx(Fe,{tone:"info",children:e.jsxs(P,{gap:"200",align:"space-between",children:[e.jsxs(c,{children:["Your ",e.jsx("strong",{children:q})," plan includes up to"," ",e.jsx("strong",{children:E})," products for SEO optimization.",D>E&&e.jsxs(e.Fragment,{children:[" You have ",D," products, so only the first ",E," will be processed."]})]}),(h.length>0||f)&&e.jsxs(c,{children:["Selected: ",f?Math.min(D,E):h.length,"/",E]})]})}),q&&(h.length>E||f&&D>E)&&e.jsx(Fe,{tone:"critical",children:e.jsxs($,{gap:"200",children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),e.jsxs(c,{children:["Your ",e.jsx("strong",{children:q})," plan supports up to ",e.jsx("strong",{children:E})," products. You have selected ",e.jsx("strong",{children:f?D:h.length})," products."]}),e.jsx(c,{children:"Please deselect some products or upgrade your plan to continue."}),e.jsxs(P,{gap:"200",children:[e.jsx(O,{onClick:()=>{ne([]),le(!1)},children:"Clear Selection"}),e.jsx(O,{variant:"primary",onClick:()=>{F({error:"Product limit exceeded",message:`Your ${q} plan supports up to ${E} products. Upgrade to ${Ee(f?D:h.length)} to optimize more products.`,minimumPlanRequired:Ee(f?D:h.length)}),V(!0)},children:"Upgrade Plan"})]})]})}),e.jsxs(P,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(p,{minWidth:"400px",children:e.jsx(es,{label:"",placeholder:"Search by product ID, name, or details...",value:G,onChange:rt,prefix:e.jsx(ts,{}),clearButton:!0,onClearButtonClick:()=>rt("")})}),e.jsx(p,{width:"320px",children:e.jsx(O,{primary:!0,onClick:Mt,disabled:h.length===0&&!f,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(P,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(O,{onClick:_e,disabled:ie,size:"medium",children:"Sync Products"}),e.jsx(p,{width:"320px",children:e.jsxs($,{gap:"200",align:"end",children:[(()=>{if(h.length===0&&!f||!j.filter(u=>h.includes(u.id)).some(u=>{var o,i;return((i=(o=u.optimizationSummary)==null?void 0:o.optimizedLanguages)==null?void 0:i.length)>0}))return null;const s=["professional","professional_plus","professional plus","growth","growth_plus","growth plus","growth_extra","growth extra","enterprise"].includes(Q.toLowerCase().replace(/_/g," "));return e.jsx(O,{onClick:s?Rt:()=>{F({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),V(!0)},disabled:h.length===0&&!f,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(O,{onClick:Tt,disabled:h.length===0&&!f||!j.filter(s=>h.includes(s.id)).some(s=>{var u,o;return((o=(u=s.optimizationSummary)==null?void 0:u.optimizedLanguages)==null?void 0:o.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),D>0&&e.jsx(p,{paddingBlockStart:"300",children:e.jsx(Ie,{label:`Select all ${D} products in your store`,checked:f,onChange:at})})]})}),e.jsx(p,{paddingBlockStart:"400",children:e.jsxs(ut,{children:[e.jsxs(p,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(P,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(P,{gap:"200",wrap:!0,children:[e.jsx(Le,{active:Ke,activator:e.jsx(O,{disclosure:"down",onClick:()=>Me(!Ke),removeUnderline:!0,children:e.jsxs(P,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),T!=="all"&&e.jsx(p,{onClick:t=>{t.stopPropagation(),ye("all")},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Me(!1),children:e.jsx(p,{padding:"300",minWidth:"200px",children:e.jsx(ze,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[T],onChange:t=>{ye(t[0]),ce(""),Me(!1)}})})}),e.jsx(Le,{active:Ve,activator:e.jsx(O,{disclosure:"down",onClick:()=>Te(!Ve),removeUnderline:!0,children:e.jsxs(P,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),k&&e.jsx(p,{onClick:t=>{t.stopPropagation(),ce("")},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Te(!1),children:e.jsx(p,{padding:"300",minWidth:"200px",children:e.jsx(ze,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...z.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...z.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:k?[k]:[],onChange:t=>{ce(t[0]||""),Te(!1)}})})}),e.jsx(Le,{active:Qe,activator:e.jsx(O,{disclosure:"down",onClick:()=>Re(!Qe),removeUnderline:!0,children:e.jsxs(P,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),U.length>0&&e.jsx(p,{onClick:t=>{t.stopPropagation(),be([])},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Re(!1),children:e.jsxs(p,{padding:"300",minWidth:"200px",children:[e.jsx(ze,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:xt.map(t=>({label:t,value:t})),selected:U,onChange:t=>{be(t)}}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(O,{size:"slim",onClick:()=>Re(!1),children:"Apply"})})]})})]}),e.jsx(Le,{active:Je,activator:e.jsx(O,{disclosure:"down",onClick:()=>$e(!Je),removeUnderline:!0,children:e.jsx(P,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:ee==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>$e(!1),children:e.jsx(p,{padding:"300",minWidth:"200px",children:e.jsx(ze,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[ee],onChange:t=>{ft(t[0]),$e(!1)}})})})]}),(T!=="all"||k||U.length>0)&&e.jsx(p,{paddingBlockStart:"200",children:e.jsxs(P,{gap:"100",wrap:!0,children:[T!=="all"&&e.jsx(Z,{onRemove:()=>ye("all"),children:T==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),k&&e.jsx(Z,{onRemove:()=>ce(""),children:k.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),U.map(t=>e.jsxs(Z,{onRemove:()=>be(n=>n.filter(s=>s!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(p,{children:[e.jsx(p,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(P,{gap:"200",align:"start",children:[e.jsx(Ie,{checked:h.length===j.length&&j.length>0,onChange:at,label:""}),e.jsxs(c,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",h.length>0&&` (${h.length} selected products)`]})]})}),e.jsx(ss,{resourceName:{singular:"product",plural:"products"},items:j,renderItem:Nt,selectedItems:h,onSelectionChange:kt,selectable:!0,loading:ie,totalItemsCount:D,emptyState:Ft,showHeader:!1},`products-${j.length}-${h.length}`)]}),mt&&!ie&&e.jsx(p,{padding:"400",textAlign:"center",children:e.jsx(O,{onClick:()=>oe(gt+1,!0,null),children:"Load more"})})]})}),Wt,qt,_t,Gt,Ht,$t(),e.jsx(L,{open:zt,onClose:()=>Ce(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Ce(!1),_e()}},secondaryActions:[{content:"Skip for now",onAction:()=>Ce(!1)}],children:e.jsx(L.Section,{children:e.jsxs($,{gap:"300",children:[e.jsx(c,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(c,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Jt,{open:Ne,onClose:()=>{V(!1),F(null)},featureName:(x==null?void 0:x.error)||"Feature",errorMessage:x==null?void 0:x.message,currentPlan:(x==null?void 0:x.currentPlan)||Q,minimumPlanRequired:x==null?void 0:x.minimumPlanRequired,features:x==null?void 0:x.features}),x&&e.jsx(Xt,{open:Ot,onClose:()=>{We(!1),F(null)},tokensRequired:x.tokensRequired||0,tokensAvailable:x.tokensAvailable||0,tokensNeeded:x.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:d,needsUpgrade:x.needsUpgrade||!1,minimumPlan:x.minimumPlanForFeature||null,currentPlan:x.currentPlan||Q}),tt&&e.jsx(ns,{content:tt,onDismiss:()=>A("")})]})}export{ms as default};
