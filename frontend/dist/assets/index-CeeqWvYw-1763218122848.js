const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-N42pkkeX-1763218122848.js","assets/app-bridge-BOWO_dBq-1763218122848.js","assets/react-vendor-tAaa2TlE-1763218122848.js","assets/sessionFetch-CJepNHo3-1763218122848.js","assets/usePlanHierarchy-BjUEvxZF-1763218122848.js","assets/polaris-DK8JpoCT-1763218122848.js","assets/BulkEdit-CI7tqj_v-1763218122848.js","assets/useShopApi-Z0jo2zvm-1763218122848.js","assets/StoreMetadataBanner-D0tzwckt-1763218122848.js","assets/InsufficientTokensModal-3swiFM-e-1763218122848.js","assets/TrialActivationModal-CeGYtyMC-1763218122848.js","assets/Collections-DNS5qzxH-1763218122848.js","assets/Sitemap-BS-QgRIC-1763218122848.js","assets/StoreMetadata-BxzZcLg8-1763218122848.js","assets/SchemaData-DayZo15C-1763218122848.js","assets/Settings-_nnxpQr5-1763218122848.js","assets/AiTesting-gPmBV4yz-1763218122848.js","assets/Billing-D4xgcPtV-1763218122848.js","assets/CleanUninstall-DbUtVSjt-1763218122848.js","assets/ContactSupport-DKxEJ9BF-1763218122848.js"])))=>i.map(i=>d[i]);
import{j as e}from"./app-bridge-BOWO_dBq-1763218122848.js";import{a as J,r as h,R as f}from"./react-vendor-tAaa2TlE-1763218122848.js";import{B as S,I as G,T as j,C as z,A as R,F as N,P as O}from"./polaris-DK8JpoCT-1763218122848.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function s(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerPolicy&&(t.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?t.credentials="include":o.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function l(o){if(o.ep)return;o.ep=!0;const t=s(o);fetch(o.href,t)}})();var Y,C=J;Y=C.createRoot,C.hydrateRoot;const Q="modulepreload",X=function(n){return"/"+n},k={},p=function(i,s,l){let o=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),d=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=Promise.allSettled(s.map(c=>{if(c=X(c),c in k)return;k[c]=!0;const g=c.endsWith(".css"),x=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${x}`))return;const u=document.createElement("link");if(u.rel=g?"stylesheet":Q,g||(u.as="script"),u.crossOrigin="",u.href=c,d&&u.setAttribute("nonce",d),document.head.appendChild(u),g)return new Promise((m,_)=>{u.addEventListener("load",m),u.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function t(r){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=r,window.dispatchEvent(d),!d.defaultPrevented)throw r}return o.then(r=>{for(const d of r||[])d.status==="rejected"&&t(d.reason);return i().catch(t)})},Z=()=>{if(typeof window>"u"||!window.gtag){console.warn("[ANALYTICS] GA4 not loaded");return}console.log("[ANALYTICS] GA4 initialized")},ee=()=>{if(typeof window>"u"||!window.fbq){console.warn("[ANALYTICS] Meta Pixel not loaded");return}console.log("[ANALYTICS] Meta Pixel initialized")},D=(n,i="")=>{if(typeof window>"u"||!window.gtag){console.warn("[ANALYTICS] GA4 not available, skipping page view:",n);return}try{window.gtag("event","page_view",{page_path:n,page_title:i||document.title,page_location:window.location.href}),console.log("[ANALYTICS] Page view tracked:",n)}catch(s){console.error("[ANALYTICS] Error tracking page view:",s)}};function te({sectionTitle:n,lang:i,setLang:s,t:l}){return e.jsx(S,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",background:"bg",children:e.jsx(G,{align:"space-between",blockAlign:"center",children:e.jsx(j,{as:"h1",variant:"headingLg",children:n})})})}const $="en",L={en:()=>p(()=>import("./en-DY--Skhq-1763218122848.js"),[]),de:()=>p(()=>import("./de-BYtsvH6H-1763218122848.js"),[]),es:()=>p(()=>import("./es-Cshzw9pa-1763218122848.js"),[]),fr:()=>p(()=>import("./fr-DGTXCiho-1763218122848.js"),[])},K=Object.keys(L);function ne(){try{const n=localStorage.getItem("app_lang");return K.includes(n)?n:null}catch{return null}}function oe(n){try{localStorage.setItem("app_lang",n)}catch{}}function re(){const[n,i]=h.useState(()=>ne()||$),[s,l]=h.useState({});h.useEffect(()=>{let t=!1;async function r(){const c=await(L[n]||L[$])();t||l(c.default||c)}return r(),oe(n),()=>{t=!0}},[n]);const o=h.useMemo(()=>(t,r="")=>{const d=t==null?void 0:t.split(".").reduce((c,g)=>c&&c[g]!==void 0?c[g]:void 0,s);return d!=null?String(d):r||t},[s]);return{lang:n,setLang:i,t:o,dict:s,langs:K}}const ae=f.lazy(()=>p(()=>import("./Dashboard-N42pkkeX-1763218122848.js"),__vite__mapDeps([0,1,2,3,4,5]))),ie=f.lazy(()=>p(()=>import("./BulkEdit-CI7tqj_v-1763218122848.js"),__vite__mapDeps([6,1,2,7,8,5,9,10]))),se=f.lazy(()=>p(()=>import("./Collections-DNS5qzxH-1763218122848.js"),__vite__mapDeps([11,1,2,3,8,5,9,10]))),le=f.lazy(()=>p(()=>import("./Sitemap-BS-QgRIC-1763218122848.js"),__vite__mapDeps([12,1,2,3,5]))),ce=f.lazy(()=>p(()=>import("./StoreMetadata-BxzZcLg8-1763218122848.js"),__vite__mapDeps([13,1,2,3,5]))),de=f.lazy(()=>p(()=>import("./SchemaData-DayZo15C-1763218122848.js"),__vite__mapDeps([14,1,2,3,4,5]))),ue=f.lazy(()=>(console.log("[APP] ===== LOADING SETTINGS COMPONENT ====="),p(()=>import("./Settings-_nnxpQr5-1763218122848.js"),__vite__mapDeps([15,1,2,3,9,5,4])))),pe=f.lazy(()=>p(()=>import("./AiTesting-gPmBV4yz-1763218122848.js"),__vite__mapDeps([16,1,2,3,9,5,10,4]))),he=f.lazy(()=>p(()=>import("./Billing-D4xgcPtV-1763218122848.js"),__vite__mapDeps([17,1,2,5]))),ge=f.lazy(()=>p(()=>import("./CleanUninstall-DbUtVSjt-1763218122848.js"),__vite__mapDeps([18,1,2,3,5]))),fe=f.lazy(()=>p(()=>import("./ContactSupport-DKxEJ9BF-1763218122848.js"),__vite__mapDeps([19,1,2,7,5]))),M={Polaris:{ResourceList:{sortingLabel:"Sort by"}}},V=(n,i="")=>{try{return new URLSearchParams(window.location.search).get(n)||i}catch{return i}};function me(){const n=l=>l.replace(/^\/apps\/[^/]+/,"").replace(/^\/indexaize-unlock-ai-search/,"")||"/",[i,s]=h.useState(()=>n(window.location.pathname));return h.useEffect(()=>{const l=()=>{const r=n(window.location.pathname);console.log("[useRoute] Location changed to:",r),s(r),D(r)};window.addEventListener("popstate",l);let o=window.location.pathname;const t=setInterval(()=>{window.location.pathname!==o&&(o=window.location.pathname,l())},50);return()=>{window.removeEventListener("popstate",l),clearInterval(t)}},[]),h.useEffect(()=>{Z(),ee(),D(i)},[]),{path:i}}function _e({active:n,shop:i}){n==="/"||n.startsWith("/dashboard"),n.startsWith("/ai-seo"),n.startsWith("/billing"),n.startsWith("/settings");const l=new URLSearchParams(window.location.search).get("host"),o=new URLSearchParams;i&&o.set("shop",i),l&&o.set("host",l);const t=o.toString()?`?${o.toString()}`:"";return e.jsxs("ui-nav-menu",{children:[e.jsx("a",{href:`/${t}`,rel:"home",children:"Home"}),e.jsx("a",{href:`/dashboard${t}`,children:"Dashboard"}),e.jsx("a",{href:`/ai-seo${t}`,children:"Search Optimization for AI"}),e.jsx("a",{href:`/settings${t}`,children:"Settings"}),e.jsx("a",{href:`/ai-testing${t}`,children:"AI Testing"}),e.jsx("a",{href:`/billing${t}`,children:"Plans & Billing"}),e.jsx("a",{href:`/clean-uninstall${t}`,children:"Clean & Uninstall"}),e.jsx("a",{href:`/contact-support${t}`,children:"Contact Support"})]})}const Pe=f.memo(({shop:n,plan:i})=>{const s=n||V("shop",""),l=window.location.pathname,t=l==="/ai-seo"||l==="/ai-seo/products"?"products":l==="/ai-seo/collections"?"collections":l==="/ai-seo/sitemap"?"sitemap":l==="/ai-seo/store-metadata"?"store-metadata":l==="/ai-seo/schema-data"?"schema-data":"products",r=d=>{const c=new URLSearchParams(window.location.search),g=c.toString()?`?${c.toString()}`:"";return d==="products"?`/ai-seo${g}`:`/ai-seo/${d}${g}`};return e.jsxs("div",{children:[e.jsx(S,{paddingBlockEnd:"400",children:e.jsx(z,{children:e.jsx(S,{padding:"200",children:e.jsxs(G,{gap:"100",children:[e.jsx("a",{href:r("products"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:t==="products"?"#008060":"#f6f6f7",color:t==="products"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Products"}),e.jsx("a",{href:r("collections"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:t==="collections"?"#008060":"#f6f6f7",color:t==="collections"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Collections"}),e.jsx("a",{href:r("sitemap"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:t==="sitemap"?"#008060":"#f6f6f7",color:t==="sitemap"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Sitemap"}),e.jsx("a",{href:r("store-metadata"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:t==="store-metadata"?"#008060":"#f6f6f7",color:t==="store-metadata"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Store metadata"}),e.jsx("a",{href:r("schema-data"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:t==="schema-data"?"#008060":"#f6f6f7",color:t==="schema-data"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Schema Data"})]})})})}),e.jsxs("div",{children:[t==="products"&&e.jsx(ie,{shop:s,globalPlan:i}),t==="collections"&&e.jsx(se,{shop:s,globalPlan:i}),t==="sitemap"&&e.jsx(le,{shop:s}),t==="store-metadata"&&e.jsx(ce,{shop:s}),t==="schema-data"&&e.jsx(de,{shop:s})]})]})});function we(){const{path:n}=me(),{lang:i,setLang:s,t:l}=re(),o=!!new URLSearchParams(window.location.search).get("host"),t=V("shop",""),[r,d]=h.useState(()=>{try{const x=sessionStorage.getItem(`plan_${t}`);if(x){const u=JSON.parse(x);return!u||typeof u.language_limit>"u"?(console.log("[APP] Ignoring stale cached plan (missing language_limit):",u),sessionStorage.removeItem(`plan_${t}`),null):(console.log("[APP] Using cached plan from sessionStorage:",{planKey:u.planKey,language_limit:u.language_limit}),u)}return null}catch{return null}});h.useEffect(()=>{const x=async()=>{const m=new URLSearchParams(window.location.search),_=m.get("shop"),y=m.get("id_token");if(_&&y)try{console.log("[APP] Performing initial token exchange for shop:",_);const P=await fetch("/token-exchange",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:_,id_token:y})});if(!P.ok){const I=await P.json();console.error("[APP] Token exchange failed:",I);return}const E=await P.json();console.log("[APP] Token exchange successful:",E);const w=new URL(window.location);w.searchParams.delete("id_token"),window.history.replaceState({},"",w),await u(_)}catch(P){console.error("[APP] Token exchange error:",P)}else _&&await u(_)},u=async m=>{var _,y,P;try{const w=await fetch("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
          query PlansMe($shop:String!) {
            plansMe(shop:$shop) {
              shop
              plan
              planKey
              priceUsd
              product_limit
              language_limit
              collection_limit
              providersAllowed
              modelsSuggested
              subscriptionStatus
              trial {
                active
                ends_at
                days_left
              }
            }
          }
        `,variables:{shop:m}})});if(w.status===202&&(await w.json()).error==="token_exchange_required"){console.log("[APP] Token exchange required, but no id_token available"),window.location.href=`/auth?shop=${encodeURIComponent(m)}`;return}if(!w.ok){console.error("[APP] Failed to load plans:",await w.text());return}const I=await w.json(),a=(_=I==null?void 0:I.data)==null?void 0:_.plansMe;if(a){((y=a==null?void 0:a.planKey)!=null&&y.includes("growth")||(P=a==null?void 0:a.plan)!=null&&P.toLowerCase().includes("growth"))&&console.log("[APP] GraphQL plansMe response:",{plan:a==null?void 0:a.plan,planKey:a==null?void 0:a.planKey,language_limit:a==null?void 0:a.language_limit,product_limit:a==null?void 0:a.product_limit}),d(a);try{sessionStorage.setItem(`plan_${m}`,JSON.stringify(a)),console.log("[APP] Plan saved to sessionStorage:",{shop:m,planKey:a==null?void 0:a.planKey,language_limit:a==null?void 0:a.language_limit})}catch(b){console.error("[APP] Failed to cache plan:",b)}const F=window.location.pathname.includes("/billing");if((a.subscriptionStatus==="pending"||!a.plan)&&!F){console.log("[APP] No active subscription, redirecting to billing...");try{localStorage.removeItem(`onboardingOpen_${m}`)}catch(H){console.error("[APP] Failed to clear onboarding state:",H)}const b=new URLSearchParams(window.location.search),W=b.get("host"),q=b.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(m)}&embedded=${q}&host=${encodeURIComponent(W)}`;return}}}catch(E){console.error("[APP] Error loading initial data:",E)}};x()},[]);const c=h.useMemo(()=>n.startsWith("/ai-seo")?"Search Optimization for AI":n.startsWith("/billing")?"Plans & Billing":n.startsWith("/settings")?"Settings":n.startsWith("/ai-testing")?"AI Testing":n.startsWith("/clean-uninstall")?"Clean & Uninstall":n.startsWith("/contact-support")?"Contact Support":"Dashboard",[n]),g=()=>n==="/"||n==="/dashboard"?e.jsx(ae,{shop:t}):n.startsWith("/ai-seo")?e.jsx(Pe,{shop:t,plan:r}):n==="/billing"?e.jsx(he,{shop:t}):n==="/settings"?(console.log("[APP] ===== RENDERING SETTINGS PAGE ====="),e.jsx(ue,{shop:t})):n==="/contact-support"?(console.log("[APP] ===== RENDERING CONTACT SUPPORT PAGE ====="),e.jsx(fe,{shop:t})):n==="/ai-testing"?(console.log("[APP] ===== RENDERING AI TESTING PAGE ====="),console.log("[APP] Path:",n),console.log("[APP] Shop:",t),e.jsx(pe,{shop:t})):n==="/clean-uninstall"?e.jsx(ge,{shop:t}):e.jsx(z,{children:e.jsxs(S,{padding:"400",children:[e.jsx(j,{variant:"headingMd",children:"Page not found"}),e.jsx(S,{paddingBlockStart:"200",children:e.jsxs(j,{children:['The page "',n,'" does not exist.']})})]})});return r?e.jsxs(R,{i18n:M,children:[o&&e.jsx(_e,{active:n,shop:t}),e.jsx(N,{children:e.jsxs(O,{children:[e.jsx(te,{sectionTitle:c,lang:i,setLang:s,t:l,shop:t}),g()]})})]}):e.jsx(R,{i18n:M,children:e.jsx(N,{children:e.jsx(O,{children:e.jsx(S,{padding:"400",children:e.jsx(j,{children:"Loading..."})})})})})}const T=new URLSearchParams(window.location.search),v=T.get("host"),A=T.get("shop"),U=T.get("embedded")==="1";console.log("[MAIN] Public App - Host:",v,"Shop:",A);console.log("[MAIN] Full URL:",window.location.href);function Ae(){const[n,i]=h.useState(!1),s=h.useMemo(()=>(console.log("[MAIN] Checking for API key..."),console.log("[MAIN] window.__SHOPIFY_API_KEY:",window.__SHOPIFY_API_KEY),console.log("[MAIN] import.meta.env.VITE_SHOPIFY_API_KEY:","2749a2f6d38ff5796ed256b5c9dc70a1"),window.__SHOPIFY_API_KEY?(console.log("[MAIN] Using injected API key:",window.__SHOPIFY_API_KEY),window.__SHOPIFY_API_KEY):(console.log("[MAIN] Using env API key:","2749a2f6d38ff5796ed256b5c9dc70a1"),"2749a2f6d38ff5796ed256b5c9dc70a1")),[]);return h.useEffect(()=>{setTimeout(()=>i(!0),100)},[]),!U||!v||!A?(console.log("[MAIN] Not embedded or missing params"),e.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[e.jsx("h1",{children:"Error: App must be loaded from Shopify Admin"}),e.jsxs("p",{children:["Shop: ",A||"Missing"]}),e.jsxs("p",{children:["Host: ",v||"Missing"]}),e.jsxs("p",{children:["Embedded: ",U?"Yes":"No"]}),e.jsx("a",{href:`https://admin.shopify.com/store/${A==null?void 0:A.replace(".myshopify.com","")}/apps`,children:"Go to Shopify Admin"})]})):s?(console.log("[MAIN] App config:",{apiKey:s?"SET":"MISSING",host:v?"SET":"MISSING",shop:A?"SET":"MISSING"}),n?e.jsx(we,{}):e.jsx("div",{children:"Loading..."})):e.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[e.jsx("h1",{children:"Configuration Error"}),e.jsx("p",{children:"Shopify API key is not configured."}),e.jsx("p",{children:"Please contact support."})]})}Y(document.getElementById("root")).render(e.jsx(Ae,{}));
