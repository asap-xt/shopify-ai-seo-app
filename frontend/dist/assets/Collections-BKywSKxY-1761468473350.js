import{j as e}from"./app-bridge-BkvVFMBc-1761468473350.js";import{r as o}from"./react-vendor-tAaa2TlE-1761468473350.js";import{m as $t}from"./sessionFetch-CJepNHo3-1761468473350.js";import{S as Rt,U as zt,I as Bt}from"./StoreMetadataBanner-DhEADQkR-1761468473350.js";import{M as S,e as A,T as r,f as Le,d as Ut,B as E,a as c,I as j,h as Ze,D as Wt,g as _,C as Ve,j as Kt,S as Ft,P as re,k as ce,R as Ht,l as _t,n as qt,E as Gt}from"./polaris-pV7tHFln-1761468473350.js";const Jt=(q,y="")=>{try{return new URLSearchParams(window.location.search).get(q)||y}catch{return y}};function hs({shop:q,globalPlan:y}){var Ge,Je,Qe;const u=q||Jt("shop","");console.log("[COLLECTIONS] Component initialized with shop:",u,"shopProp:",q);const L=o.useMemo(()=>$t(),[]),[p,Xe]=o.useState([]),[be,ve]=o.useState(!1),[G,et]=o.useState(0),[g,J]=o.useState([]),[w,V]=o.useState(!1),[Qt,Yt]=o.useState(""),[N,de]=o.useState(""),[v,X]=o.useState("all"),[U,ue]=o.useState(""),[ee,he]=o.useState([]),[tt,Zt]=o.useState([]),[Oe,ge]=o.useState(!1),[Ae,pe]=o.useState(!1),[Ie,fe]=o.useState(!1),[ke,me]=o.useState(!1),[I,st]=o.useState("updatedAt"),[k,nt]=o.useState("desc"),[ot,lt]=o.useState(""),[Vt,at]=o.useState([]),[b,W]=o.useState([]),[f,Te]=o.useState([]),[Se,te]=o.useState(!1),[P,$]=o.useState({current:0,total:0,percent:0}),[Me,se]=o.useState(""),[Q,Pe]=o.useState([]),[Xt,es]=o.useState(!1),[ts,ss]=o.useState(null),[ns,os]=o.useState(!1),[ls,it]=o.useState(""),[rt,ne]=o.useState(!1),[K,F]=o.useState([]),[De,Ne]=o.useState(!1),[ct,Y]=o.useState(!1),[$e,Re]=o.useState(!1),[dt,oe]=o.useState(!1),[ze,le]=o.useState([]),[R,xe]=o.useState({}),[ut,je]=o.useState(!1),[ht,Ce]=o.useState(!1),[Be,as]=o.useState({}),[gt,ye]=o.useState(!1),[Ue,Ee]=o.useState(null),[pt,We]=o.useState(!1),[Ke,m]=o.useState(""),[Fe,He]=o.useState(!1),[ft,ae]=o.useState(!1),[mt,_e]=o.useState(!1),[x,ie]=o.useState(null),[z,Z]=o.useState("starter"),[D,we]=o.useState(1);o.useEffect(()=>{if(!(!y||typeof y!="object")){if(y.planKey&&y.planKey!==""){Z(y.planKey);const s={starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[y.planKey.toLowerCase()]||1;we(s)}else if(y.plan&&y.plan!==""){const t=y.plan.toLowerCase().replace(/\s+/g,"-");Z(t);const n={starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[t]||1;we(n)}}},[y]);const[C,B]=o.useState({processing:!1,current:0,total:0,currentItem:"",results:null});o.useEffect(()=>{if(!u)return;L("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
        }
      }
    `,variables:{shop:u}})}).then(s=>{var d,h,T;if((d=s==null?void 0:s.errors)!=null&&d.length)throw new Error(((h=s.errors[0])==null?void 0:h.message)||"GraphQL error");const n=(T=s==null?void 0:s.data)==null?void 0:T.plansMe,a=(n==null?void 0:n.modelsSuggested)||["google/gemini-1.5-flash"];at(a.map(H=>({label:H,value:H}))),lt(a[0]),Z((n==null?void 0:n.planKey)||"starter");const i=((n==null?void 0:n.planKey)||"starter").toLowerCase();we({starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[i]||1)}).catch(s=>m(`Error loading models: ${s.message}`))},[u,L]),o.useEffect(()=>{u&&(console.log("[COLLECTIONS] Loading languages for shop:",u),L(`/api/languages/shop/${u}?shop=${u}`).then(t=>{console.log("[COLLECTIONS] Languages API data:",t);const s=(t==null?void 0:t.shopLanguages)||["en"];console.log("[COLLECTIONS] Extracted languages:",s),Te(s),W([])}).catch(t=>{console.error("[COLLECTIONS] Languages API error:",t),Te(["en"]),W([])}))},[u,L]);const St=async()=>{try{Re(!0),console.log("[COLLECTIONS] Starting collections sync...");const t=await L(`/api/collections/sync?shop=${u}`,{method:"POST"});t!=null&&t.success?(console.log("[COLLECTIONS] Sync successful:",t),m("Collections synced successfully!"),await M()):(console.error("[COLLECTIONS] Sync failed:",t),m("Failed to sync collections"))}catch(t){console.error("[COLLECTIONS] Sync error:",t),m("Error syncing collections")}finally{Re(!1)}},M=o.useCallback(async()=>{var t;ve(!0);try{console.log("[COLLECTIONS] Shop value:",u),console.log("[COLLECTIONS] Shop prop:",q),console.log("[COLLECTIONS] URL search params:",window.location.search);const n=`/collections/list-graphql?${new URLSearchParams({shop:u,...N&&{search:N},...v!=="all"&&{optimized:v},sortBy:I,sortOrder:k})}`;console.log("[COLLECTIONS] Using GraphQL endpoint:",n);const a=await L(n);console.log("[COLLECTIONS] API Response data:",a),((t=a==null?void 0:a.collections)==null?void 0:t.length)>0&&(console.log("[COLLECTIONS] First collection optimizedLanguages:",a.collections[0].optimizedLanguages),console.log("[COLLECTIONS] First collection full data:",a.collections[0]));let i=a.collections||[];if(N){const l=N.toLowerCase();i=i.filter(d=>d.title.toLowerCase().includes(l)||d.handle.toLowerCase().includes(l))}v!=="all"&&(i=i.filter(l=>v==="true"?l.hasSeoData:!l.hasSeoData)),Xe(i),et(i.length)}catch(s){m(`Error loading collections: ${s.message}`)}finally{ve(!1)}},[u,N,v,I,k,L]);o.useEffect(()=>{u&&(M(),Y(!1))},[u,v,I,k,M]),o.useEffect(()=>{const t=setTimeout(()=>{u&&M()},500);return()=>clearTimeout(t)},[N]);const xt=o.useCallback(t=>{J(t);const s=t.some(n=>{const a=p.find(i=>i.id===n);return a==null?void 0:a.hasSeoData});Y(s),t.length===0&&V(!1)},[p]),jt=o.useCallback(t=>{if(V(t),t){J(p.map(n=>n.id));const s=p.some(n=>n.hasSeoData);Y(s)}else J([]),Y(!1)},[p]),Ct=async t=>{We(!0);try{const s=`/collections/${t.split("/").pop()}/seo-data?shop=${encodeURIComponent(u)}`,n=await L(s);Ee(n),ye(!0)}catch(s){m((s==null?void 0:s.status)===404?"No SEO data found for this collection":"Failed to load SEO data")}finally{We(!1)}},qe=o.useMemo(()=>{var s;if(w)return b.length>D;const t=p.filter(n=>g.includes(n.id));if(t.length===0)return b.length>D;for(const n of t){const a=((s=n.optimizationSummary)==null?void 0:s.optimizedLanguages)||[],i=b.filter(d=>!a.includes(d));if(a.length+i.length>D)return!0}return!1},[p,g,w,D,b]),yt=()=>{if(g.length===0&&!w){m("Please select collections first");return}Ce(!0)},Et=async()=>{console.log("[AI-ENHANCE] Starting enhancement...");const s=p.filter(a=>g.includes(a.id)).filter(a=>{var i;return((i=a.optimizedLanguages)==null?void 0:i.length)>0});if(s.length===0){m("Please select collections with Basic SEO optimization");return}console.log("[AI-ENHANCE] Collections to enhance:",s.length),He(!0),B({processing:!0,current:0,total:s.length,currentItem:"",results:null});const n={successful:0,failed:0,skipped:0};for(let a=0;a<s.length;a++){const i=s[a];B(l=>({...l,current:a,currentItem:i.title}));try{const l=i.optimizedLanguages||[];if(l.length===0){console.log(`[AI-ENHANCE] No languages for ${i.title}, skipping`),n.skipped++;continue}console.log(`[AI-ENHANCE] Enhancing ${i.title} for languages:`,l);const d=await L(`/ai-enhance/collection/${encodeURIComponent(i.id)}`,{method:"POST",shop:u,body:{shop:u,languages:l}});d&&d.ok?(n.successful++,console.log(`[AI-ENHANCE] Success for ${i.title}`)):(n.failed++,console.log(`[AI-ENHANCE] Failed for ${i.title}`))}catch(l){if(console.error("[AI-ENHANCE] Error:",l),l.status===403){B({processing:!1,current:0,total:0,currentItem:"",results:null}),ie(l),Z(l.currentPlan||z||"starter"),ae(!0);return}if(l.status===402||l.requiresPurchase||l.trialRestriction){B({processing:!1,current:0,total:0,currentItem:"",results:null}),ie(l),Z(l.currentPlan||z||"starter"),l.trialRestriction?ae(!0):_e(!0);return}n.failed++}B(l=>({...l,current:a+1}))}B(a=>({...a,processing:!1,results:n})),m(`AI enhancement complete! ${n.successful} collections enhanced.`),n.successful>0&&await M()},wt=()=>{p.filter(n=>g.includes(n.id)).filter(n=>{var a;return((a=n.optimizedLanguages)==null?void 0:a.length)>0});const s=()=>{He(!1),B({processing:!1,current:0,total:0,currentItem:"",results:null}),C.results&&C.results.successful>0&&M()};return C.processing?e.jsx(S,{open:Fe,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(S.Section,{children:e.jsxs(A,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",C.currentItem]}),e.jsx(Le,{progress:C.current/C.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[C.current," of ",C.total," collections (",Math.round(C.current/C.total*100),"%)"]})]})})}):C.results!==null?e.jsx(S,{open:Fe,title:"AI Enhancement Results",onClose:s,primaryAction:{content:"Done",onAction:s},children:e.jsx(S.Section,{children:e.jsx(A,{gap:"300",children:e.jsxs(j,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:C.results.successful})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:C.results.failed})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:C.results.skipped})]})]})})})}):null},Lt=async()=>{if(!b.length){m("Please select at least one language");return}Ce(!1),te(!0),$({current:0,total:0,percent:0}),Pe([]),xe({});try{const t=w?p:p.filter(i=>g.includes(i.id)),s=t.length;$({current:0,total:s,percent:0});const n={};for(let i=0;i<t.length;i++){const l=t[i];se(l.title);try{const T=await L("/seo/generate-collection-multi",{method:"POST",shop:u,body:JSON.stringify({shop:u,collectionId:l.id,model:ot,languages:b})});n[l.id]={success:!0,data:T}}catch(T){n[l.id]={success:!1,error:T.message},Pe(H=>[...H,{collection:l.title,error:T.message}])}const d=i+1,h=Math.round(d/s*100);$({current:d,total:s,percent:h})}xe(n),je(!0);const a=Object.values(n).filter(i=>i.success).length;m(`Generated optimization for ${a} collections`)}catch(t){m(`Error: ${t.message}`)}finally{te(!1),se("")}},bt=async()=>{var t,s;te(!0),$({current:0,total:0,percent:0});try{const n=Object.entries(R).filter(([i,l])=>l.success),a=n.length;$({current:0,total:a,percent:0});for(let i=0;i<n.length;i++){const[l,d]=n[i],h=p.find(O=>O.id===l);if(!h)continue;se(h.title);try{if(console.log("Applying SEO for collection:",l),console.log("Result data:",d.data),console.log("Results array:",(t=d.data)==null?void 0:t.results),!((s=d.data)!=null&&s.results)||!Array.isArray(d.data.results))throw new Error("Invalid results structure");const O=await L("/seo/apply-collection-multi",{method:"POST",shop:u,body:{shop:u,collectionId:l,results:d.data.results.map(Ye=>({language:Ye.language,seo:Ye.data})),options:{updateTitle:!0,updateDescription:!0,updateSeo:!0,updateMetafields:!0}}});if(!(O!=null&&O.ok))throw new Error((O==null?void 0:O.error)||"Apply failed")}catch(O){console.error("Apply error for collection:",l,O),Q.push({id:h.id,title:h.title,message:O.message})}const T=i+1,H=Math.round(T/a*100);$({current:T,total:a,percent:H})}m("Optimization applied successfully!"),je(!1),xe({}),J([]),await M(),V(!1)}catch(n){m(`Error applying optimization: ${n.message}`)}finally{te(!1),se("")}},vt=async(t=[])=>{console.log("[DELETE-SEO-BULK] ===== BULK DELETE START ====="),console.log("[DELETE-SEO-BULK] Languages to delete:",t),console.log("[DELETE-SEO-BULK] Selected items:",g),console.log("[DELETE-SEO-BULK] Select all pages:",w),Ne(!0),it("");try{const s=w?p:p.filter(l=>g.includes(l.id)),n=s.length*t.length;let a=0;const i=[];for(const l of s)for(const d of t)try{console.log(`[DELETE-SEO-BULK] Deleting ${d} for ${l.title} (${l.id})`);const h=await L("/collections/delete-seo",{method:"DELETE",shop:u,body:{shop:u,collectionId:l.id,language:d}});console.log(`[DELETE-SEO-BULK] Success for ${l.title} - ${d}:`,h)}catch(h){console.error(`[DELETE-SEO-BULK] Failed to delete ${d} for ${l.title}:`,h),i.push({id:l.id,title:l.title,message:h.message})}finally{a++,$({current:a,total:n,percent:Math.round(a/n*100)})}m(`Deleted optimization for ${t.join(", ").toUpperCase()}`),setTimeout(async()=>{await M(),J([]),V(!1),Y(!1)},100)}catch(s){console.error("[DELETE-SEO-BULK] Error:",s),m(`Delete error: ${s.message}`)}finally{console.log("[DELETE-SEO-BULK] ===== BULK DELETE END ====="),Ne(!1),le([]),F([])}},Ot=t=>{var l,d;const s=((l=R[t.id])==null?void 0:l.success)||Be[t.id],n=((d=R[t.id])==null?void 0:d.data)||Be[t.id],a=t.optimizedLanguages||[];console.log(`[COLLECTIONS] Rendering collection "${t.title}":`,{optimizedLanguages:a,availableLanguages:f,hasSeoData:t.hasSeoData});const i=e.jsx(c,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(qt,{id:t.id,media:i,accessibilityLabel:`View details for ${t.title}`,onClick:h=>{console.log("[Collections-ResourceItem] ===== CLICK ON RESOURCE ITEM ====="),console.log("[Collections-ResourceItem] e.target:",h.target),console.log("[Collections-ResourceItem] e.target.tagName:",h.target.tagName),console.log('[Collections-ResourceItem] e.target.closest("input"):',h.target.closest("input")),console.log('[Collections-ResourceItem] e.target.closest("a"):',h.target.closest("a")),console.log("[Collections-ResourceItem] Event bubbling up...")},children:e.jsxs(j,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(c,{style:{flex:"1 1 30%",minWidth:"200px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:t.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Handle: ",t.handle]})]}),e.jsx(c,{style:{flex:"0 0 15%",minWidth:"100px",textAlign:"center"},children:e.jsxs(r,{variant:"bodyMd",children:[t.productsCount," products"]})}),e.jsx(c,{style:{flex:"0 0 25%",minWidth:"160px"},children:t.hasSeoData?e.jsx(j,{gap:"100",children:f.map(h=>e.jsx(_,{tone:a.includes(h)?"success":"subdued",size:"small",children:h.toUpperCase()},h))}):e.jsx(_,{tone:"subdued",children:"No AI Search Optimisation"})}),e.jsxs(c,{style:{flex:"0 0 15%",minWidth:"120px"},children:[s&&e.jsx(E,{size:"slim",onClick:()=>{Ee(n),ye(!0)},children:"Preview JSON"}),!s&&t.hasSeoData&&e.jsx(E,{size:"slim",loading:pt,onClick:()=>Ct(t.id),children:"Preview JSON"})]})]})})},At=Se&&!C.processing&&e.jsx(S,{open:Se,title:"Processing Collections",onClose:()=>{},noScroll:!0,children:e.jsx(S.Section,{children:e.jsxs(A,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:Me?`Processing: ${Me}`:"Preparing..."}),e.jsx(Le,{progress:P.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[P.current," of ",P.total," collections (",P.percent,"%)"]})]})})}),It=e.jsx(S,{open:ht,title:"Select Languages",primaryAction:{content:"Generate Optimization for AI Search",onAction:Lt,disabled:b.length===0||qe},secondaryActions:[{content:"Cancel",onAction:()=>Ce(!1)}],children:e.jsx(S.Section,{children:e.jsxs(A,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",w?"all":g.length," selected collections:"]}),qe&&e.jsx(Ut,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(A,{gap:"200",children:[e.jsxs(r,{variant:"bodyMd",children:["Your ",z," plan supports up to ",D," language",D>1?"s":""," per collection.",g.length===1&&((Qe=(Je=(Ge=p.find(t=>t.id===g[0]))==null?void 0:Ge.optimizationSummary)==null?void 0:Je.optimizedLanguages)==null?void 0:Qe.length)>0&&e.jsxs(e.Fragment,{children:[" This collection already has ",p.find(t=>t.id===g[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(r,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(E,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),s=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${s}`},children:"Upgrade Plan"})]})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(j,{gap:"200",wrap:!0,children:f.map(t=>e.jsx(Ze,{label:t.toUpperCase(),checked:b.includes(t),onChange:s=>{W(s?[...b,t]:b.filter(n=>n!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(E,{plain:!0,onClick:()=>{b.length===f.length?W([]):f.length>D?(W([...f]),m(`You selected ${f.length} languages. Your ${z} plan supports ${D}. Please deselect or upgrade.`)):W([...f])},children:b.length===f.length?"Deselect all":"Select all"})})]})})}),kt=e.jsx(S,{open:ut&&!Se,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:bt,disabled:!Object.values(R).some(t=>t.success)},secondaryActions:[{content:"Cancel",onAction:()=>je(!1)}],children:e.jsx(S.Section,{children:e.jsxs(A,{gap:"300",children:[e.jsxs(j,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(R).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(R).filter(t=>t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(R).filter(t=>!t.success&&!t.skipped).length})]})]}),Q.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Wt,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(c,{maxHeight:"200px",overflowY:"scroll",children:[Q.slice(0,10).map((t,s)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.collection,": ",t.error]},s)),Q.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",Q.length-10," more errors"]})]})]})]})})}),Tt=e.jsx(S,{open:gt,title:"SEO Data Preview",secondaryActions:[{content:"Close",onAction:()=>{ye(!1),Ee(null)}}],children:e.jsx(S.Section,{children:e.jsx(c,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",backgroundColor:"#f6f6f7",padding:"12px",borderRadius:"4px",maxHeight:"400px",overflow:"auto"},children:Ue?JSON.stringify(Ue,null,2):""})})})}),Mt=e.jsx(S,{open:rt,title:"Delete Optimization for AI Search",onClose:()=>{ne(!1),F([])},primaryAction:{content:"Continue",onAction:()=>{le(K),ne(!1),oe(!0)},disabled:K.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{ne(!1),F([])}}],children:e.jsx(S.Section,{children:e.jsxs(A,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",w?G:g.length," selected collections:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(j,{gap:"400",wrap:!1,children:f.map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[e.jsx("input",{type:"checkbox",checked:K.includes(t),onChange:s=>{F(s.target.checked?[...K,t]:K.filter(n=>n!==t))},style:{marginRight:"8px",width:"18px",height:"18px",cursor:"pointer"}}),e.jsx(r,{variant:"bodyMd",children:t.toUpperCase()})]},t))})}),e.jsx(c,{children:e.jsx(E,{plain:!0,onClick:()=>{F(K.length===f.length?[]:[...f])},children:"Select all"})}),e.jsx(c,{paddingBlockStart:"300",children:e.jsx(r,{variant:"bodySm",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})})]})})}),Pt=e.jsx(S,{open:dt,title:"Confirm Deletion",onClose:()=>{oe(!1),le([])},primaryAction:{content:"Delete",destructive:!0,onAction:async()=>{oe(!1),setTimeout(()=>{vt(ze)},100)}},secondaryActions:[{content:"Cancel",onAction:()=>{oe(!1),le([]),F([])}}],children:e.jsx(S.Section,{children:e.jsxs(A,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(j,{gap:"200",children:ze.map(t=>e.jsx(_,{tone:"warning",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",w?G:g.length," selected collections."]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(r,{variant:"bodySm",tone:"critical",children:"This action cannot be undone."})})]})})}),Dt=De&&e.jsx(S,{open:De,title:"Deleting SEO Data",onClose:()=>{},noScroll:!0,children:e.jsx(S.Section,{children:e.jsxs(A,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:"Deleting selected languages..."}),e.jsx(Le,{progress:P.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[P.current," of ",P.total," operations (",P.percent,"%)"]})]})})}),Nt=e.jsx(Gt,{heading:"No collections found",action:{content:"Clear filters",onAction:()=>{de(""),X("all"),M()}},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms"})});return e.jsxs(e.Fragment,{children:[e.jsx(Rt,{globalPlan:y}),e.jsx(Ve,{children:e.jsx(c,{padding:"400",children:e.jsxs(A,{gap:"300",children:[e.jsxs(j,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(c,{minWidth:"400px",children:e.jsx(Kt,{label:"",placeholder:"Search by collection name...",value:N,onChange:de,prefix:e.jsx(Ft,{}),clearButton:!0,onClearButtonClick:()=>de("")})}),e.jsx(c,{width:"320px",children:e.jsx(E,{primary:!0,onClick:yt,disabled:g.length===0&&!w,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(j,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(E,{onClick:St,disabled:$e||be,size:"medium",children:$e?"Syncing...":"Sync Collections"}),e.jsx(c,{width:"320px",children:e.jsxs(A,{gap:"200",align:"end",children:[(()=>{if(g.length===0&&!w||!p.filter(a=>g.includes(a.id)).some(a=>{var i;return((i=a.optimizedLanguages)==null?void 0:i.length)>0}))return null;const n=z.toLowerCase().replace(/_/g," ")==="starter";return e.jsx(E,{onClick:n?()=>{ie({error:"Collections require Professional plan or higher",message:"Upgrade to Professional plan to access Collections optimization",minimumPlanRequired:"Professional"}),ae(!0)}:Et,disabled:g.length===0&&!w,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(E,{outline:!0,destructive:!0,onClick:()=>ne(!0),disabled:g.length===0||!ct,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]})})}),e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(Ve,{children:[e.jsxs(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(j,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(j,{gap:"200",wrap:!0,children:[e.jsx(re,{active:Oe,activator:e.jsx(E,{disclosure:"down",onClick:()=>ge(!Oe),removeUnderline:!0,children:e.jsxs(j,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),v!=="all"&&e.jsx(c,{onClick:t=>{t.stopPropagation(),X("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ge(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(ce,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All collections",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[v],onChange:t=>{X(t[0]),ge(!1)}})})}),e.jsx(re,{active:Ae,activator:e.jsx(E,{disclosure:"down",onClick:()=>pe(!Ae),removeUnderline:!0,children:e.jsxs(j,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),U&&e.jsx(c,{onClick:t=>{t.stopPropagation(),ue("")},children:e.jsx(r,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>pe(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(ce,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...(f==null?void 0:f.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})))||[],...(f==null?void 0:f.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`})))||[]],selected:U?[U]:[],onChange:t=>{ue(t[0]||""),pe(!1)}})})}),e.jsx(re,{active:Ie,activator:e.jsx(E,{disclosure:"down",onClick:()=>fe(!Ie),removeUnderline:!0,children:e.jsxs(j,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),ee.length>0&&e.jsx(c,{onClick:t=>{t.stopPropagation(),he([])},children:e.jsx(r,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>fe(!1),children:e.jsxs(c,{padding:"300",minWidth:"200px",children:[e.jsx(ce,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:tt.map(t=>({label:t,value:t})),selected:ee,onChange:t=>{he(t)}}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(E,{size:"slim",onClick:()=>fe(!1),children:"Apply"})})]})})]}),e.jsx(re,{active:ke,activator:e.jsx(E,{disclosure:"down",onClick:()=>me(!ke),removeUnderline:!0,children:e.jsx(j,{gap:"100",blockAlign:"center",children:e.jsxs("span",{children:[I==="updatedAt"&&k==="desc"&&"Newest first",I==="updatedAt"&&k==="asc"&&"Oldest first",I==="title"&&k==="asc"&&"Name A-Z",I==="title"&&k==="desc"&&"Name Z-A",I==="productsCount"&&k==="desc"&&"Most products",I==="productsCount"&&k==="asc"&&"Least products"]})})}),onClose:()=>me(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(ce,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"updatedAt_desc"},{label:"Oldest first",value:"updatedAt_asc"},{label:"Name A-Z",value:"title_asc"},{label:"Name Z-A",value:"title_desc"},{label:"Most products",value:"productsCount_desc"},{label:"Least products",value:"productsCount_asc"}],selected:[`${I}_${k}`],onChange:t=>{const[s,n]=t[0].split("_");st(s),nt(n),me(!1)}})})})]}),(v!=="all"||U||ee.length>0)&&e.jsx(c,{paddingBlockStart:"200",children:e.jsxs(j,{gap:"100",wrap:!0,children:[v!=="all"&&e.jsx(_,{onRemove:()=>X("all"),children:v==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),U&&e.jsx(_,{onRemove:()=>ue(""),children:U.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),ee.map(t=>e.jsxs(_,{onRemove:()=>he(s=>s.filter(n=>n!==t)),children:["Tag: ",t]},t))]})})]}),G>0&&e.jsx(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:e.jsx(Ze,{label:`Select all ${G} collections`,checked:w,onChange:jt})}),e.jsx(Ht,{resourceName:{singular:"collection",plural:"collections"},items:p,renderItem:Ot,selectedItems:g,onSelectionChange:xt,selectable:!0,loading:be,totalItemsCount:G,emptyState:Nt,showHeader:!1},`collections-${p.length}-${g.length}`)]})}),At,It,kt,Tt,Mt,Pt,Dt,wt(),e.jsx(zt,{open:ft,onClose:()=>ae(!1),featureName:"Collections AI Enhancement",currentPlan:z,errorMessage:(x==null?void 0:x.error)||(x==null?void 0:x.message),minimumPlanRequired:x==null?void 0:x.minimumPlanRequired}),x&&e.jsx(Bt,{open:mt,onClose:()=>{_e(!1),ie(null)},tokensRequired:x.tokensRequired||0,tokensAvailable:x.tokensAvailable||0,tokensNeeded:x.tokensNeeded||0,feature:"ai-seo-collection",shop:u,needsUpgrade:x.needsUpgrade||!1,minimumPlan:x.minimumPlanForFeature||null,currentPlan:x.currentPlan||z}),Ke&&e.jsx(_t,{content:Ke,onDismiss:()=>m("")})]})}export{hs as default};
