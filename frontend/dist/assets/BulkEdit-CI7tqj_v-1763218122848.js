import{j as e}from"./app-bridge-BOWO_dBq-1763218122848.js";import{r as a}from"./react-vendor-tAaa2TlE-1763218122848.js";import{u as Zt}from"./useShopApi-Z0jo2zvm-1763218122848.js";import{S as es,U as ts}from"./StoreMetadataBanner-D0tzwckt-1763218122848.js";import{I as ss}from"./InsufficientTokensModal-3swiFM-e-1763218122848.js";import{T as ns}from"./TrialActivationModal-CeGYtyMC-1763218122848.js";import{M as C,a as O,T as c,e as ht,d as Ge,b as E,B as p,I as P,g as ve,D as as,f as q,C as gt,h as os,S as rs,i as Ie,j as Ce,R as is,k as ls,l as mt,m as cs,E as ds}from"./polaris-DK8JpoCT-1763218122848.js";const us=(v,m="")=>{try{return new URLSearchParams(window.location.search).get(v)||m}catch{return m}},fe=v=>{if(!v)return v;const m=String(v).trim();return m.startsWith("gid://")?m:`gid://shopify/Product/${m}`},ps=v=>{if(!v)return"";const m=String(v).match(/\/(\d+)$/);return m?m[1]:v},ze=v=>v<=70?"Starter":v<=200?"Professional":v<=450?"Growth":v<=750?"Growth Extra":"Enterprise";function bs({shop:v,globalPlan:m}){var dt,ut,pt;const{api:b,shop:ft}=Zt(),d=v||ft||us("shop","");a.useEffect(()=>{},[d,b]);const[y,Q]=a.useState([]),[ie,xe]=a.useState(!1),[xt,Ne]=a.useState(1),[St,ke]=a.useState(!0),[D,He]=a.useState(0),[g,ne]=a.useState([]),[j,le]=a.useState(!1),[Z,Ye]=a.useState(""),[B,Se]=a.useState("all"),[R,ce]=a.useState(""),[je,hs]=a.useState("createdAt"),[ae,jt]=a.useState("desc"),[_,ye]=a.useState([]),[yt,bt]=a.useState([]),[Qe,Ee]=a.useState(!1),[Ve,Te]=a.useState(!1),[Je,Me]=a.useState(!1),[Xe,Oe]=a.useState(!1),[wt,Pt]=a.useState(""),[At,Lt]=a.useState([]),[U,oe]=a.useState([]),[z,Ze]=a.useState([]),[De,ee]=a.useState(!1),[be,F]=a.useState({current:0,total:0,percent:0}),[et,re]=a.useState(""),[we,de]=a.useState([]),[ue,tt]=a.useState({}),[vt,Re]=a.useState(!1),[It,pe]=a.useState(!1),[Ct,he]=a.useState(!1),[H,ge]=a.useState([]),[zt,Pe]=a.useState(!1),[st,A]=a.useState(""),[nt,at]=a.useState(!1),[I,te]=a.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[W,kt]=a.useState(null),[k,Et]=a.useState(70),[V,Ue]=a.useState(1),[Tt,Ae]=a.useState(!1),[Le,Mt]=a.useState(localStorage.getItem("hasVisitedProducts")==="true"),[$e,J]=a.useState(!1),[Ot,Be]=a.useState(!1),[Dt,ot]=a.useState(!1),[S,G]=a.useState(null),[$,me]=a.useState("starter"),[We,rt]=a.useState(!1);a.useEffect(()=>{if(!(!m||typeof m!="object"))if(!We&&$==="starter"){if(m.planKey&&m.planKey!==""){console.log("[BULK-EDIT] Using globalPlan as fallback (GraphQL not loaded yet):",{planKey:m.planKey,language_limit:m.language_limit}),me(m.planKey);const t=m.language_limit||1;Ue(t)}else if(m.plan&&m.plan!==""){const t=m.plan.toLowerCase().replace(/\s+/g,"-");console.log("[BULK-EDIT] Using globalPlan.plan as fallback (GraphQL not loaded yet):",{plan:W,derivedPlanKey:t,language_limit:m.language_limit}),me(t);const n=m.language_limit||1;Ue(n)}}else We&&console.log("[BULK-EDIT] Skipping globalPlan update - GraphQL data already loaded:",{currentPlan:$,globalPlanPlanKey:m.planKey,globalPlanLanguageLimit:m.language_limit})},[m,$,We]),a.useEffect(()=>{$e&&W&&(j?D:g.length)<=k&&(J(!1),G(null))},[g.length,j,D,$e,W]),a.useEffect(()=>{if(!d)return;b("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
          language_limit
        }
      }
    `,variables:{shop:d}})}).then(n=>{var l,r,f,x,L;if((l=n==null?void 0:n.errors)!=null&&l.length)throw new Error(((r=n.errors[0])==null?void 0:r.message)||"GraphQL error");const s=(f=n==null?void 0:n.data)==null?void 0:f.plansMe;((x=s==null?void 0:s.planKey)!=null&&x.includes("growth")||(L=s==null?void 0:s.plan)!=null&&L.toLowerCase().includes("growth"))&&console.log("[BULK-EDIT] GraphQL plansMe response:",{plan:s==null?void 0:s.plan,planKey:s==null?void 0:s.planKey,language_limit:s==null?void 0:s.language_limit,product_limit:s==null?void 0:s.product_limit});const u=(s==null?void 0:s.modelsSuggested)||["anthropic/claude-3.5-sonnet"];Lt(u.map(h=>({label:h,value:h}))),Pt(u[0]),kt((s==null?void 0:s.plan)||"starter"),me((s==null?void 0:s.planKey)||"starter");const o=(s==null?void 0:s.product_limit)||70,i=(s==null?void 0:s.language_limit)||1;console.log("[BULK-EDIT] Setting limits from GraphQL:",{productLimit:o,languageLimit:i,planKey:s==null?void 0:s.planKey}),Et(o),Ue(i),rt(!0)}).catch(n=>{console.error("[BULK-EDIT] GraphQL plansMe failed:",n),rt(!0)})},[d,b]),a.useEffect(()=>{if(!d)return;const t=new Promise((n,s)=>{setTimeout(()=>s(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([b(`/api/languages/shop/${d}`),t]).then(n=>{const s=Array.isArray(n==null?void 0:n.shopLanguages)&&n.shopLanguages.length?n.shopLanguages:["en"];Ze(s.includes("en")?s:["en",...s])}).catch(n=>{console.error("[BULK-EDIT] Languages API error:",n),Ze(["en"])})},[d,b]),a.useEffect(()=>{d&&b("/api/products/tags/list",{shop:d}).then(t=>bt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[d,b]);const se=a.useCallback(async(t=1,n=!1,s=null)=>{var u,o,i,l;xe(!0);try{const r=new URLSearchParams({shop:d,page:t,limit:50,...B!=="all"&&{optimized:B},...Z&&{search:Z},...R&&{languageFilter:R},..._.length>0&&{tags:_.join(",")},sortBy:je,sortOrder:ae,...s&&{_t:s}}),f=await b(`/api/products/list?${r}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((u=f.products)==null?void 0:u.length)>0,((o=f.products)==null?void 0:o.length)>0&&f.products.forEach((x,L)=>{}),Q(n?x=>[...x,...f.products]:f.products||[]),Ne(t),ke(((i=f.pagination)==null?void 0:i.hasNext)||!1),He(((l=f.pagination)==null?void 0:l.total)||0)}catch(r){Q(n?y:[]),ke(!1),A(`Error loading products: ${r.message}`)}finally{xe(!1)}},[d,B,Z,R,_,je,ae]);a.useEffect(()=>{d&&se(1,!1,null)},[d,B,R,_,je,ae]),a.useEffect(()=>{!Le&&d&&(localStorage.setItem("hasVisitedProducts","true"),Mt(!0))},[Le,d]),a.useEffect(()=>{y.length===0&&!ie&&d&&!Le&&Ae(!0)},[y.length,ie,d,Le]),a.useEffect(()=>{},[y,g]);const it=a.useCallback(t=>{Ye(t)},[]);a.useEffect(()=>{const t=setTimeout(()=>{d&&se(1,!1,null)},500);return()=>clearTimeout(t)},[Z]);const Rt=a.useCallback(t=>{ne(t),t.length===0&&le(!1)},[]),lt=a.useCallback(t=>{le(t),ne(t?y.map(n=>n.id):[])},[y]),ct=a.useMemo(()=>{var n;if(j)return U.length>V;const t=y.filter(s=>g.includes(s.id));if(t.length===0)return U.length>V;for(const s of t){const u=((n=s.optimizationSummary)==null?void 0:n.optimizedLanguages)||[],o=U.filter(l=>!u.includes(l));if(u.length+o.length>V)return!0}return!1},[y,g,j,V,U]),Ut=()=>{if(g.length===0&&!j){A("Please select products first");return}pe(!0)},$t=()=>{if(g.length===0&&!j){A("Please select products first");return}ge([]),he(!0)},Bt=async()=>{const t=y.filter(i=>g.includes(i.id)),n=t.filter(i=>{var l,r;return((r=(l=i.optimizationSummary)==null?void 0:l.optimizedLanguages)==null?void 0:r.length)>0}),s=t.filter(i=>{var l,r;return!((r=(l=i.optimizationSummary)==null?void 0:l.optimizedLanguages)!=null&&r.length)}),u=n.length;if(u>k){const i=ze(u);G({error:"Product limit exceeded",message:`Your ${W} plan supports up to ${k} products for AI Enhancement. You have selected ${u} products with Basic SEO.`,minimumPlanRequired:i,currentPlan:W,features:[`Optimize up to ${k} products`,"All features from your current plan",i==="Growth Extra"||i==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",i==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),J(!0);return}at(!0),te({processing:!0,current:0,total:n.length,currentItem:"",results:null});const o={successful:0,failed:0,skipped:s.length,skipReasons:s.length>0?[`${s.length} product(s): No Basic Optimization`]:[]};for(let i=0;i<n.length;i++){const l=n[i];te(r=>({...r,current:i,currentItem:l.title}));try{const r=l.gid||fe(l.id);if(!r){console.error("[AI-ENHANCE] Missing product GID, skipping:",l),o.failed++;continue}const f=await b("/ai-enhance/product",{method:"POST",shop:d,body:{shop:d,productId:r,languages:l.optimizationSummary.optimizedLanguages}});if(f.results&&f.results.length>0){const x={shop:d,productId:l.gid||fe(l.id),results:f.results.filter(h=>h.bullets&&h.faq).map(h=>({language:h.language,seo:{...h.updatedSeo,bullets:h.bullets||[],faq:h.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},L=await b("/api/seo/apply-multi",{method:"POST",shop:d,body:x});o.successful++}else o.failed++}catch(r){if(r.status===403){te({processing:!1,current:0,total:0,currentItem:"",results:null}),G({...r,message:r.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),me(r.currentPlan||$),r.needsUpgrade===!1&&r.requiresPurchase?Be(!0):J(!0);return}if(r.status===402||r.requiresPurchase||r.trialRestriction){te({processing:!1,current:0,total:0,currentItem:"",results:null}),G(r),me(r.currentPlan||W||"starter"),r.trialRestriction&&r.requiresActivation?ot(!0):r.trialRestriction?J(!0):Be(!0);return}o.failed++}te(r=>({...r,current:i+1}))}te(i=>({...i,processing:!1,results:o})),A(`AI enhancement complete! ${o.successful} products enhanced.`)},Ke=()=>{const t=I.results;at(!1),te({processing:!1,current:0,total:0,currentItem:"",results:null}),t&&t.successful>0&&setTimeout(()=>{Q([]),se(1,!1,Date.now())},1500)},Wt=()=>I.processing?e.jsx(C,{open:nt,title:"Processing AI Enhancement",onClose:Ke,noScroll:!0,children:e.jsx(C.Section,{children:e.jsxs(O,{gap:"400",children:[e.jsxs(c,{variant:"bodyMd",children:["Processing: ",I.currentItem]}),e.jsx(ht,{progress:I.current/I.total*100}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:[I.current," of ",I.total," products (",Math.round(I.current/I.total*100),"%)"]})]})})}):I.results!==null?e.jsx(C,{open:nt,title:"AI Enhancement Results",onClose:Ke,primaryAction:{content:"Done",onAction:Ke},children:e.jsx(C.Section,{children:e.jsxs(O,{gap:"400",children:[e.jsxs(P,{gap:"400",children:[e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:I.results.successful})]}),e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:I.results.failed})]}),e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:I.results.skipped})]})]}),I.results.skipReasons&&I.results.skipReasons.length>0&&e.jsxs(O,{gap:"200",children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped products:"}),I.results.skipReasons.map((t,n)=>e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["â€¢ ",t]},n))]})]})})}):null,Kt=async()=>{var n;if(!U.length){A("Please select at least one language");return}let t=wt;(!t||!t.trim())&&(t=((n=At[0])==null?void 0:n.value)||"anthropic/claude-3.5-sonnet"),ee(!0),F({current:0,total:0,percent:0}),de([]),tt({});try{let s=[];j?s=(await b(`/api/products/list?shop=${encodeURIComponent(d)}&limit=1000&fields=id`)).products||[]:s=y.filter(h=>g.includes(h.id));const u=s.length;if(u>k){ee(!1),F({current:0,total:0,percent:0}),pe(!1);const h=ze(u);G({error:"Product limit exceeded",message:`Your ${$} plan supports up to ${k} products for SEO optimization. You have selected ${u} products.`,minimumPlanRequired:h,currentPlan:$,features:["Optimize more products","All features from your current plan",h==="Growth Extra"||h==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",h==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),J(!0);return}pe(!1);const o=u,i=0;F({current:0,total:o,percent:0});const l=5,r={};for(let h=0;h<s.length;h+=l){const K=s.slice(h,Math.min(h+l,s.length)).map(async M=>{var Y;re(M.title||M.handle||"Product");try{const X=M.gid||fe(M.productId||M.id),_e=((Y=M.optimizationSummary)==null?void 0:Y.optimizedLanguages)||[],Fe=U.filter(Xt=>!_e.includes(Xt));if(Fe.length===0){r[M.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Jt=await b("/api/seo/generate-multi",{method:"POST",shop:d,body:{shop:d,productId:X,model:t,languages:Fe}});r[M.id]={success:!0,data:Jt,languages:Fe}}catch(X){r[M.id]={success:!1,error:X.message},de(_e=>[..._e,{product:M.title,error:X.message}])}});await Promise.all(K);const w=Math.min(h+l,s.length),N=Math.round(w/o*100);F({current:w,total:o,percent:N})}tt(r),Re(!0);const f=Object.keys(r).filter(h=>r[h].success&&!r[h].skipped).length,x=Object.keys(r).filter(h=>r[h].skipped).length;let L=`Generated Optimization for AI Search for ${f} products`;x>0&&(L+=` (${x} already optimised)`),i>0,A(L)}catch(s){A(`Error: ${s.message}`)}finally{ee(!1),re("")}},qt=async()=>{var t,n;ee(!0),F({current:0,total:0,percent:0});try{const s=Object.entries(ue).filter(([l,r])=>r.success&&!r.skipped),u=s.length;F({current:0,total:u,percent:0});for(let l=0;l<s.length;l++){const[r,f]=s[l],x=y.find(T=>T.id===r);if(!x)continue;re(x.title||"Product");try{const T=x.gid||fe(x.productId||x.id),K=await b("/api/seo/apply-multi",{method:"POST",shop:d,body:{shop:d,productId:T,results:f.data.results.filter(w=>w==null?void 0:w.seo).map(w=>({language:w.language,seo:w.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});K.appliedLanguages&&K.appliedLanguages.length>0&&Q(w=>w.map(N=>{var M;if(N.id===r){const Y=((M=N.optimizationSummary)==null?void 0:M.optimizedLanguages)||[],X=[...new Set([...Y,...K.appliedLanguages])];return{...N,optimizationSummary:{...N.optimizationSummary,optimizedLanguages:X,optimized:!0,lastOptimized:new Date().toISOString()}}}return N}))}catch(T){de(K=>[...K,{product:x.title,error:`Apply failed: ${T.message}`}])}const L=l+1,h=Math.round(L/u*100);F({current:L,total:u,percent:h})}A("AI Search Optimisation applied successfully!"),Re(!1),ne([]),le(!1),await new Promise(l=>setTimeout(l,1e3)),Q([]);const o=new URLSearchParams({shop:d,page:1,limit:50,...B!=="all"&&{optimized:B},...Z&&{search:Z},...R&&{languageFilter:R},..._.length>0&&{tags:_.join(",")},sortBy:je,sortOrder:ae,_t:Date.now()}),i=await b(`/api/products/list?${o}`,{shop:d,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});Q(i.products||[]),Ne(1),ke(((t=i.pagination)==null?void 0:t.hasNext)||!1),He(((n=i.pagination)==null?void 0:n.total)||0)}catch(s){A(`Error applying AI Search Optimisation: ${s.message}`)}finally{ee(!1),re("")}},_t=async()=>{var t;if(!H.length){A("Please select at least one language to delete");return}he(!1),Pe(!1),ee(!0),F({current:0,total:0,percent:0}),de([]);try{let n=[];j?n=(await b(`/api/products/list?shop=${encodeURIComponent(d)}&limit=1000&fields=id`)).products||[]:n=y.filter(i=>g.includes(i.id));const s=n.length;F({current:0,total:s,percent:0});let u=0,o=0;for(let i=0;i<n.length;i++){const l=n[i];re(l.title||l.handle||"Product");try{const x=l.gid||fe(l.productId||l.id),L=((t=l.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],h=H.filter(K=>L&&L.length>0&&L.includes(K));if(h.length===0){o++;continue}const T=await b("/api/seo/delete-multi",{method:"POST",shop:d,body:{shop:d,productId:x,languages:h}});T.deletedLanguages&&T.deletedLanguages.length>0&&Q(K=>K.map(w=>{var N;if(w.id===l.id){const Y=(((N=w.optimizationSummary)==null?void 0:N.optimizedLanguages)||[]).filter(X=>!T.deletedLanguages.includes(X));return{...w,optimizationSummary:{...w.optimizationSummary,optimizedLanguages:Y,optimized:Y.length>0,aiEnhanced:Y.length>0?w.optimizationSummary.aiEnhanced:!1,lastOptimized:Y.length>0?w.optimizationSummary.lastOptimized:null}}}return w})),u++,T.deletedLanguages&&T.deletedLanguages.length>0&&await b("/api/products/verify-after-delete",{method:"POST",shop:d,body:{shop:d,productIds:[x],deletedLanguages:T.deletedLanguages}})}catch(x){de(L=>[...L,{product:l.title,error:x.message}])}const r=i+1,f=Math.round(r/s*100);F({current:r,total:s,percent:f})}ne([]),le(!1),o>0?A(`Deleted Optimization for AI Search from ${u} products (${o} had no optimisation to delete)`):A(`Deleted Optimization for AI Search from ${u} products`),setTimeout(()=>{const i=Date.now();se(1,!1,i)},500)}catch(n){A(`Error: ${n.message}`)}finally{ee(!1),re("")}},Ft=t=>{var n,s,u;try{const o=t,i=ps(o.productId||o.id),l=((n=o.optimizationSummary)==null?void 0:n.optimizedLanguages)||[],r=(s=o.images)!=null&&s[0]?e.jsx(mt,{source:o.images[0].url||o.images[0].src||o.images[0],alt:o.title,size:"small"}):o.imageUrl?e.jsx(mt,{source:o.imageUrl,alt:o.title,size:"small"}):e.jsx(p,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(cs,{id:o.id,media:r,accessibilityLabel:`View details for ${o.title}`,onClick:f=>{},children:e.jsxs(P,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(p,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:o.title}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["ID: ",i]})]}),e.jsx(p,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsxs(P,{gap:"100",wrap:!0,children:[(()=>{if(z.length>0)return z.map(f=>{const x=l.includes(f),L=o.status==="DRAFT";return e.jsx(q,{tone:L?"subdued":x?"success":"subdued",size:"small",children:f.toUpperCase()},f)});{const f=o.status==="DRAFT";return l.map(x=>e.jsx(q,{tone:f?"subdued":"success",size:"small",children:x.toUpperCase()},x))}})(),((u=o.optimizationSummary)==null?void 0:u.aiEnhanced)&&o.status!=="DRAFT"&&e.jsx(q,{tone:"info",size:"small",children:"AIâœ¨"})]})}),e.jsx(p,{style:{flex:"0 0 20%",minWidth:"120px",textAlign:"center"},children:o.status==="ACTIVE"?e.jsx(q,{tone:"success",children:"Active"}):o.status==="DRAFT"?e.jsx(q,{children:"Draft"}):o.status==="ARCHIVED"?e.jsx(q,{tone:"warning",children:"Archived"}):e.jsx(q,{children:o.status||"Unknown"})})]})})}catch(o){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",o),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},Gt=De&&e.jsx(C,{open:De,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(C.Section,{children:e.jsxs(O,{gap:"400",children:[e.jsx(c,{variant:"bodyMd",children:et?`Processing: ${et}`:"Preparing..."}),e.jsx(ht,{progress:be.percent}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:[be.current," of ",be.total," products (",be.percent,"%)"]})]})})}),Nt=e.jsx(C,{open:It,title:"Select Languages",onClose:()=>{pe(!1),oe([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Kt,disabled:U.length===0||ct},secondaryActions:[{content:"Cancel",onAction:()=>{pe(!1),oe([])}}],children:e.jsx(C.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsxs(c,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",j?"all":g.length," selected products:"]}),ct&&e.jsx(Ge,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(O,{gap:"200",children:[e.jsxs(c,{variant:"bodyMd",children:["Your ",$," plan supports up to ",V," language",V>1?"s":""," per product.",g.length===1&&((pt=(ut=(dt=y.find(t=>t.id===g[0]))==null?void 0:dt.optimizationSummary)==null?void 0:ut.optimizedLanguages)==null?void 0:pt.length)>0&&e.jsxs(e.Fragment,{children:[" This product already has ",y.find(t=>t.id===g[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(c,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(E,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),n=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${n}`},children:"Upgrade Plan"})]})}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(P,{gap:"200",wrap:!0,children:z.map(t=>e.jsx(ve,{label:t.toUpperCase(),checked:U.includes(t),onChange:n=>{oe(n?[...U,t]:U.filter(s=>s!==t))}},t))})}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(E,{plain:!0,onClick:()=>{U.length===z.length?oe([]):z.length>V?(oe([...z]),A(`You selected ${z.length} languages. Your ${$} plan supports ${V}. Please deselect or upgrade.`)):oe([...z])},children:U.length===z.length?"Deselect all":"Select all"})}),e.jsx(c,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Ht=e.jsx(C,{open:vt&&!De,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:qt,disabled:!Object.values(ue).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Re(!1)}],children:e.jsx(C.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsxs(P,{gap:"400",children:[e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(ue).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(ue).filter(t=>t.skipped).length})]}),e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(ue).filter(t=>!t.success).length})]})]}),we.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(as,{}),e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(p,{maxHeight:"200px",overflowY:"scroll",children:[we.slice(0,10).map((t,n)=>e.jsxs(c,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},n)),we.length>10&&e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["... and ",we.length-10," more errors"]})]})]})]})})}),Yt=e.jsx(C,{open:Ct,title:"Delete Optimization for AI Search",onClose:()=>{he(!1),ge([])},primaryAction:{content:"Continue",onAction:()=>{he(!1),Pe(!0)},disabled:H.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{he(!1),ge([])}}],children:e.jsx(C.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsxs(c,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",j?"all":g.length," selected products:"]}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(P,{gap:"200",wrap:!0,children:z.map(t=>e.jsx(ve,{label:t.toUpperCase(),checked:H.includes(t),onChange:n=>{ge(n?[...H,t]:H.filter(s=>s!==t))}},t))})}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(E,{plain:!0,onClick:()=>{ge(H.length===z.length?[]:[...z])},children:H.length===z.length?"Deselect all":"Select all"})}),e.jsx(c,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Qt=e.jsx(C,{open:zt,title:"Confirm Deletion",onClose:()=>{Pe(!1)},primaryAction:{content:"Delete",onAction:_t,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>Pe(!1)}],children:e.jsx(C.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsx(c,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(p,{paddingBlock:"200",children:e.jsx(P,{gap:"100",children:H.map(t=>e.jsx(q,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(c,{variant:"bodyMd",children:["This will delete optimisation from ",j?"ALL":g.length," selected products."]}),e.jsx(c,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),qe=async()=>{try{xe(!0),A("Syncing products from Shopify...");const t=await b("/api/products/sync",{method:"POST",shop:d});if(t.success){const n=t.productsCount||t.synced||0;A(`âœ… Synced ${n} products successfully!`),setTimeout(()=>{se(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),A(`âŒ Sync failed: ${t.message}`)}finally{xe(!1)}},Vt=e.jsx(ds,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Ye(""),Se("all"),ce(""),ye([]),se(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:qe},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(es,{globalPlan:m}),e.jsx(gt,{children:e.jsxs(p,{padding:"400",children:[e.jsxs(O,{gap:"300",children:[W&&e.jsx(Ge,{tone:"info",children:e.jsxs(P,{gap:"200",align:"space-between",children:[e.jsxs(c,{children:["Your ",e.jsx("strong",{children:W})," plan includes up to"," ",e.jsx("strong",{children:k})," products for SEO optimization.",D>k&&e.jsxs(e.Fragment,{children:[" You have ",D," products, so only the first ",k," will be processed."]})]}),(g.length>0||j)&&e.jsxs(c,{children:["Selected: ",j?Math.min(D,k):g.length,"/",k]})]})}),W&&(g.length>k||j&&D>k)&&e.jsx(Ge,{tone:"critical",children:e.jsxs(O,{gap:"200",children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),e.jsxs(c,{children:["Your ",e.jsx("strong",{children:W})," plan supports up to ",e.jsx("strong",{children:k})," products. You have selected ",e.jsx("strong",{children:j?D:g.length})," products."]}),e.jsx(c,{children:"Please deselect some products or upgrade your plan to continue."}),e.jsxs(P,{gap:"200",children:[e.jsx(E,{onClick:()=>{ne([]),le(!1)},children:"Clear Selection"}),e.jsx(E,{variant:"primary",onClick:()=>{G({error:"Product limit exceeded",message:`Your ${W} plan supports up to ${k} products. Upgrade to ${ze(j?D:g.length)} to optimize more products.`,minimumPlanRequired:ze(j?D:g.length)}),J(!0)},children:"Upgrade Plan"})]})]})}),e.jsxs(P,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(p,{minWidth:"400px",children:e.jsx(os,{label:"",placeholder:"Search by product ID, name, or details...",value:Z,onChange:it,prefix:e.jsx(rs,{}),clearButton:!0,onClearButtonClick:()=>it("")})}),e.jsx(p,{width:"320px",children:e.jsx(E,{primary:!0,onClick:Ut,disabled:g.length===0&&!j,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(P,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(E,{onClick:qe,disabled:ie,size:"medium",children:"Sync Products"}),e.jsx(p,{width:"320px",children:e.jsxs(O,{gap:"200",align:"end",children:[(()=>{if(g.length===0&&!j||!y.filter(u=>g.includes(u.id)).some(u=>{var o,i;return((i=(o=u.optimizationSummary)==null?void 0:o.optimizedLanguages)==null?void 0:i.length)>0}))return null;const s=["professional","professional_plus","professional plus","growth","growth_plus","growth plus","growth_extra","growth extra","enterprise"].includes($.toLowerCase().replace(/_/g," "));return e.jsx(E,{onClick:s?Bt:()=>{G({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),J(!0)},disabled:g.length===0&&!j,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(E,{onClick:$t,disabled:g.length===0&&!j||!y.filter(s=>g.includes(s.id)).some(s=>{var u,o;return((o=(u=s.optimizationSummary)==null?void 0:u.optimizedLanguages)==null?void 0:o.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),D>0&&e.jsx(p,{paddingBlockStart:"300",children:e.jsx(ve,{label:`Select all ${D} products in your store`,checked:j,onChange:lt})})]})}),e.jsx(p,{paddingBlockStart:"400",children:e.jsxs(gt,{children:[e.jsxs(p,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(P,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(P,{gap:"200",wrap:!0,children:[e.jsx(Ie,{active:Qe,activator:e.jsx(E,{disclosure:"down",onClick:()=>Ee(!Qe),removeUnderline:!0,children:e.jsxs(P,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),B!=="all"&&e.jsx(p,{onClick:t=>{t.stopPropagation(),Se("all")},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Ee(!1),children:e.jsx(p,{padding:"300",minWidth:"200px",children:e.jsx(Ce,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[B],onChange:t=>{Se(t[0]),ce(""),Ee(!1)}})})}),e.jsx(Ie,{active:Ve,activator:e.jsx(E,{disclosure:"down",onClick:()=>Te(!Ve),removeUnderline:!0,children:e.jsxs(P,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),R&&e.jsx(p,{onClick:t=>{t.stopPropagation(),ce("")},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Te(!1),children:e.jsx(p,{padding:"300",minWidth:"200px",children:e.jsx(Ce,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...z.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...z.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:R?[R]:[],onChange:t=>{ce(t[0]||""),Te(!1)}})})}),e.jsx(Ie,{active:Je,activator:e.jsx(E,{disclosure:"down",onClick:()=>Me(!Je),removeUnderline:!0,children:e.jsxs(P,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),_.length>0&&e.jsx(p,{onClick:t=>{t.stopPropagation(),ye([])},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Me(!1),children:e.jsxs(p,{padding:"300",minWidth:"200px",children:[e.jsx(Ce,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:yt.map(t=>({label:t,value:t})),selected:_,onChange:t=>{ye(t)}}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(E,{size:"slim",onClick:()=>Me(!1),children:"Apply"})})]})})]}),e.jsx(Ie,{active:Xe,activator:e.jsx(E,{disclosure:"down",onClick:()=>Oe(!Xe),removeUnderline:!0,children:e.jsx(P,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:ae==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Oe(!1),children:e.jsx(p,{padding:"300",minWidth:"200px",children:e.jsx(Ce,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[ae],onChange:t=>{jt(t[0]),Oe(!1)}})})})]}),(B!=="all"||R||_.length>0)&&e.jsx(p,{paddingBlockStart:"200",children:e.jsxs(P,{gap:"100",wrap:!0,children:[B!=="all"&&e.jsx(q,{onRemove:()=>Se("all"),children:B==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),R&&e.jsx(q,{onRemove:()=>ce(""),children:R.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),_.map(t=>e.jsxs(q,{onRemove:()=>ye(n=>n.filter(s=>s!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(p,{children:[e.jsx(p,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(P,{gap:"200",align:"start",children:[e.jsx(ve,{checked:g.length===y.length&&y.length>0,onChange:lt,label:""}),e.jsxs(c,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",g.length>0&&` (${g.length} selected products)`]})]})}),e.jsx(is,{resourceName:{singular:"product",plural:"products"},items:y,renderItem:Ft,selectedItems:g,onSelectionChange:Rt,selectable:!0,loading:ie,totalItemsCount:D,emptyState:Vt,showHeader:!1},`products-${y.length}-${g.length}`)]}),St&&!ie&&e.jsx(p,{padding:"400",textAlign:"center",children:e.jsx(E,{onClick:()=>se(xt+1,!0,null),children:"Load more"})})]})}),Gt,Nt,Ht,Yt,Qt,Wt(),e.jsx(C,{open:Tt,onClose:()=>Ae(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Ae(!1),qe()}},secondaryActions:[{content:"Skip for now",onAction:()=>Ae(!1)}],children:e.jsx(C.Section,{children:e.jsxs(O,{gap:"300",children:[e.jsx(c,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(c,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(ts,{open:$e,onClose:()=>{J(!1),G(null)},featureName:(S==null?void 0:S.error)||"Feature",errorMessage:S==null?void 0:S.message,currentPlan:(S==null?void 0:S.currentPlan)||$,minimumPlanRequired:S==null?void 0:S.minimumPlanRequired,features:S==null?void 0:S.features}),S&&e.jsxs(e.Fragment,{children:[e.jsx(ss,{open:Ot,onClose:()=>{Be(!1),G(null)},tokensRequired:S.tokensRequired||0,tokensAvailable:S.tokensAvailable||0,tokensNeeded:S.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:d,needsUpgrade:S.needsUpgrade||!1,minimumPlan:S.minimumPlanForFeature||null,currentPlan:S.currentPlan||$,returnTo:"/ai-seo"}),e.jsx(ns,{open:Dt,onClose:()=>{ot(!1),G(null)},feature:S.feature||"ai-seo-product-enhanced",trialEndsAt:S.trialEndsAt,currentPlan:S.currentPlan||$,tokensRequired:S.tokensRequired||0,onActivatePlan:async()=>{try{console.log("[BULK-EDIT] ðŸ”“ Activating plan directly...");const t=await b("/api/billing/activate",{method:"POST",body:{shop:d,endTrial:!0,returnTo:"/ai-seo"}});if(console.log("[BULK-EDIT] âœ… Activation response:",t),t.requiresApproval&&t.confirmationUrl){console.log("[BULK-EDIT] ðŸ” Redirecting to Shopify approval..."),window.top.location.href=t.confirmationUrl;return}console.log("[BULK-EDIT] âœ… Plan activated, reloading page..."),window.location.reload()}catch(t){console.error("[BULK-EDIT] âŒ Activation failed:",t);const n=new URLSearchParams(window.location.search),s=n.get("host"),u=n.get("embedded");console.log("[BULK-EDIT] ðŸ”„ Fallback - redirecting to Billing page..."),window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${u}&host=${encodeURIComponent(s)}`}},onPurchaseTokens:()=>{const t=new URLSearchParams(window.location.search),n=t.get("host"),s=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${s}&host=${encodeURIComponent(n)}&returnTo=${encodeURIComponent("/ai-seo")}`}})]}),st&&e.jsx(ls,{content:st,onDismiss:()=>A("")})]})}export{bs as default};
