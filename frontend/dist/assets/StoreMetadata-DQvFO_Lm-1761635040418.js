import{j as e}from"./app-bridge-DLeWu0VC-1761635040418.js";import{r as u}from"./react-vendor-tAaa2TlE-1761635040418.js";import{m as Ke}from"./sessionFetch-CJepNHo3-1761635040418.js";import{C as y,a as p,T as r,d as L,L as M,B as v,t as D,j as l,D as Xe,h as He,I as Ye,l as Qe}from"./polaris-CKq1NPLF-1761635040418.js";const Ze=(z,m="")=>{try{return new URLSearchParams(window.location.search).get(z)||m}catch{return m}};function ia({shop:z}){var B,_,F,q,W,J,V,G,K,X,H;const m=z||Ze("shop",""),[Re,P]=u.useState(!1),[Oe,R]=u.useState(!1),[O,S]=u.useState(""),[n,Ie]=u.useState(null),w=u.useMemo(()=>Ke({}),[]),[Ue,I]=u.useState(!1),[$e,U]=u.useState(!1),[j,Be]=u.useState({storeName:"",homePageTitle:"",metaDescription:""}),[_e,$]=u.useState(!1),[o,i]=u.useState({seo:{storeName:"",shortDescription:"",fullDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""}});u.useEffect(()=>{m&&A()},[m,w]);async function A(){var a,t,c,s,b,g,f,Y,Q,Z,ee,ae,te,oe,ie,ne,se,re,le,de,ce,he,pe,me,ue,ge,Se,fe,xe,ye,Me,je,be,Ce,ve,De,we,ze,Ae,Te,Ee;console.log("[StoreMeta] LOAD - Start"),P(!0);try{const x=`/api/store/generate?shop=${encodeURIComponent(m)}`;console.log("[StoreMeta] LOAD - Fetching from",x);const d=await w(x,{headers:{"X-Shop":m}});console.log("[StoreMeta] LOAD - Received data",{hasExisting:!!d.existingMetadata,existingKeys:Object.keys(d.existingMetadata||{}),shopifyDefaults:d.shopifyDefaults}),Ie(d),Be({storeName:((a=d.shopifyDefaults)==null?void 0:a.storeName)||"",homePageTitle:((t=d.shopifyDefaults)==null?void 0:t.homePageTitle)||"",metaDescription:((c=d.shopifyDefaults)==null?void 0:c.metaDescription)||""});const h=d.existingMetadata||{},E=((b=(s=h.seo_metadata)==null?void 0:s.value)==null?void 0:b.storeName)||"",N=((f=(g=h.seo_metadata)==null?void 0:g.value)==null?void 0:f.shortDescription)||"",k=((Q=(Y=h.seo_metadata)==null?void 0:Y.value)==null?void 0:Q.fullDescription)||"",Ne=E||((Z=d.shopifyDefaults)==null?void 0:Z.storeName)||"",ke=N||((ee=d.shopifyDefaults)==null?void 0:ee.homePageTitle)||"",Le=k||((ae=d.shopifyDefaults)==null?void 0:ae.metaDescription)||"";console.log("[StoreMeta] LOAD - Display values",{displayStoreName:Ne,displayShortDescription:ke,displayFullDescription:Le});const Je=E&&E!==((te=d.shopifyDefaults)==null?void 0:te.storeName),Ve=N&&N!==((oe=d.shopifyDefaults)==null?void 0:oe.homePageTitle),Ge=k&&k!==((ie=d.shopifyDefaults)==null?void 0:ie.metaDescription);$(Je||Ve||Ge);const Pe={seo:{storeName:Ne,shortDescription:ke,fullDescription:Le,keywords:Array.isArray((se=(ne=h.seo_metadata)==null?void 0:ne.value)==null?void 0:se.keywords)?h.seo_metadata.value.keywords.join(", "):((le=(re=h.seo_metadata)==null?void 0:re.value)==null?void 0:le.keywords)||""},aiMetadata:{...((de=h.ai_metadata)==null?void 0:de.value)||{},languages:((pe=(he=(ce=h.ai_metadata)==null?void 0:ce.value)==null?void 0:he.languages)==null?void 0:pe.length)>0?h.ai_metadata.value.languages:(((me=d.shopInfo)==null?void 0:me.locales)||[]).filter(C=>C.published).map(C=>C.locale),supportedCurrencies:((Se=(ge=(ue=h.ai_metadata)==null?void 0:ue.value)==null?void 0:ge.supportedCurrencies)==null?void 0:Se.length)>0?h.ai_metadata.value.supportedCurrencies:((fe=d.shopInfo)==null?void 0:fe.currencies)||["EUR"],shippingRegions:((Me=(ye=(xe=h.ai_metadata)==null?void 0:xe.value)==null?void 0:ye.shippingRegions)==null?void 0:Me.length)>0?h.ai_metadata.value.shippingRegions:(((je=d.shopInfo)==null?void 0:je.markets)||[]).map(C=>C.name)},organizationSchema:{...((be=h.organization_schema)==null?void 0:be.value)||{},enabled:((ve=(Ce=h.organization_schema)==null?void 0:Ce.value)==null?void 0:ve.enabled)===!0,name:((we=(De=h.organization_schema)==null?void 0:De.value)==null?void 0:we.name)||((ze=d.shopInfo)==null?void 0:ze.name)||"",email:((Te=(Ae=h.organization_schema)==null?void 0:Ae.value)==null?void 0:Te.email)||((Ee=d.shopInfo)==null?void 0:Ee.email)||""}};console.log("[StoreMeta] LOAD - Setting formData",Pe),i(Pe)}catch(x){console.error("[StoreMeta] Load error:",x),S(`Load failed: ${(x==null?void 0:x.message)||"Unknown error"}`)}finally{P(!1)}}function Fe(){i(a=>({...a,seo:{...a.seo,storeName:"",shortDescription:"",fullDescription:""}})),$(!1),S("Synced with Shopify store settings")}async function T(){R(!0);try{const a=`/api/store/apply?shop=${encodeURIComponent(m)}`;console.log("[StoreMeta] SAVE",a);const t=await w(a,{method:"POST",headers:{"X-Shop":m},body:{metadata:o,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:o.organizationSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:a,ok:t==null?void 0:t.ok}),S("Metadata saved successfully!"),await A()}catch(a){console.error("[StoreMeta] SAVE error",(a==null?void 0:a.debug)||a,a),S(`Save failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{R(!1)}}async function qe(){var a;I(!0);try{await T();const c=await w("/graphql",{method:"POST",headers:{"X-Shop":m},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            shortDescription
            seoMetadata
            aiMetadata
            organizationSchema
          }
        }
      `,variables:{shop:m}}});if(c.error)throw new Error(c.error);const s=(a=c.data)==null?void 0:a.storeMetadata;if(s){const b=window.open("","_blank");console.log("[STORE-METADATA] Raw preview data:",s),console.log("[STORE-METADATA] seoMetadata raw:",s.seoMetadata),console.log("[STORE-METADATA] aiMetadata raw:",s.aiMetadata),console.log("[STORE-METADATA] organizationSchema raw:",s.organizationSchema);const g={shopName:s.shopName,shortDescription:s.shortDescription,description:s.description,seoMetadata:s.seoMetadata?(()=>{try{return JSON.parse(s.seoMetadata)}catch(f){return console.error("Error parsing seoMetadata:",f),s.seoMetadata}})():null,aiMetadata:s.aiMetadata?(()=>{try{return JSON.parse(s.aiMetadata)}catch(f){return console.error("Error parsing aiMetadata:",f),s.aiMetadata}})():null,organizationSchema:s.organizationSchema?(()=>{try{return JSON.parse(s.organizationSchema)}catch(f){return console.error("Error parsing organizationSchema:",f),s.organizationSchema}})():null};b.document.write(`
          <html>
            <head>
              <title>Store Metadata Preview</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
                h1 { color: #333; }
                .section { margin: 20px 0; }
                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
              </style>
            </head>
            <body>
              <h1>Store Metadata Preview</h1>
              <div class="section">
                <h2>Basic Info</h2>
                <p><strong>Shop Name:</strong> ${g.shopName||"Not set"}</p>
                <p><strong>Short Description:</strong> ${s.shortDescription||"Not set"}</p>
                <p><strong>Full Description:</strong> ${g.description||"Not set"}</p>
              </div>
              
              <div class="section">
                <h2>SEO Metadata</h2>
                <pre>${JSON.stringify(g.seoMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>AI Metadata</h2>
                <pre>${JSON.stringify(g.aiMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Organization Schema</h2>
                <pre>${JSON.stringify(g.organizationSchema,null,2)}</pre>
              </div>
              
              <!-- Local Business Schema - DISABLED -->
              <!-- <div class="section">
                <h2>Local Business Schema</h2>
                <pre>${JSON.stringify(g.localBusinessSchema,null,2)}</pre>
              </div> -->
              
              <div class="section">
                <h2>Raw Data</h2>
                <pre>${JSON.stringify(g,null,2)}</pre>
              </div>
            </body>
          </html>
        `),b.document.close()}else throw new Error("No preview data available")}catch(t){S(`Preview failed: ${(t==null?void 0:t.message)||"Unknown error"}`)}finally{I(!1)}}async function We(){console.log("[StoreMeta] CLEAR - Start",{formData:o}),U(!0);try{const a={seo:{storeName:"",shortDescription:"",fullDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""}};console.log("[StoreMeta] CLEAR - Setting formData to empty",{emptyData:a}),i(a),console.log("[StoreMeta] CLEAR - Calling handleSave"),await T(),console.log("[StoreMeta] CLEAR - Save complete, reloading data"),await A(),console.log("[StoreMeta] CLEAR - Complete"),S("Metadata cleared successfully!")}catch(a){console.error("[StoreMeta] CLEAR - Error",a),S(`Clear failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{U(!1)}}return Re&&!n?e.jsx(y,{children:e.jsx(p,{padding:"400",children:e.jsx(r,{children:"Loading store data..."})})}):(n==null?void 0:n.plan)==="Starter"?e.jsx(L,{status:"warning",children:e.jsx(r,{children:"Store metadata features are available starting from the Professional plan."})}):e.jsxs(M,{children:[e.jsx(M.Section,{children:e.jsx(y,{title:"Basic Store Information",children:e.jsxs(p,{padding:"400",children:[e.jsx(L,{tone:"info",children:e.jsxs(p,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"From Shopify Settings:"}),e.jsxs(p,{paddingBlockStart:"200",children:[e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Store name: ",e.jsx(r,{as:"span",fontWeight:"medium",children:j.storeName||"Not set"})]}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Home page title: ",e.jsx(r,{as:"span",fontWeight:"medium",children:j.homePageTitle||"Not set"})]}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Meta description: ",e.jsx(r,{as:"span",fontWeight:"medium",children:j.metaDescription?j.metaDescription.substring(0,100)+(j.metaDescription.length>100?"...":""):"Not set"})]}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Languages: ",e.jsx(r,{as:"span",fontWeight:"medium",children:((_=(B=n==null?void 0:n.shopInfo)==null?void 0:B.locales)==null?void 0:_.filter(a=>a.published).map(a=>a.locale).join(", "))||"Not set"})]}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Currencies: ",e.jsx(r,{as:"span",fontWeight:"medium",children:((q=(F=n==null?void 0:n.shopInfo)==null?void 0:F.currencies)==null?void 0:q.join(", "))||"EUR"})]}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Markets: ",e.jsx(r,{as:"span",fontWeight:"medium",children:((J=(W=n==null?void 0:n.shopInfo)==null?void 0:W.markets)==null?void 0:J.map(a=>a.name).join(", "))||"Not set"})]}),((V=n==null?void 0:n.shopInfo)==null?void 0:V.name)&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Organization: ",e.jsx(r,{as:"span",fontWeight:"medium",children:n.shopInfo.name}),n.shopInfo.email&&e.jsxs(e.Fragment,{children:[" (",n.shopInfo.email,")"]})]})]}),_e&&e.jsx(p,{paddingBlockStart:"300",children:e.jsx(v,{size:"slim",onClick:Fe,children:"Sync from Shopify"})})]})}),e.jsx(p,{paddingBlockStart:"400",children:e.jsxs(D,{children:[e.jsx(l,{label:"Store Name",value:o.seo.storeName,onChange:a=>i(t=>({...t,seo:{...t.seo,storeName:a}})),helpText:"Loaded from Shopify. Edit if needed.",maxLength:100}),e.jsx(l,{label:"Short Store Description",value:o.seo.shortDescription,onChange:a=>i(t=>({...t,seo:{...t.seo,shortDescription:a}})),helpText:"Loaded from Shopify. Edit if needed - max 100 characters",maxLength:100}),e.jsx(l,{label:"Full Store Description",value:o.seo.fullDescription,onChange:a=>i(t=>({...t,seo:{...t.seo,fullDescription:a}})),helpText:"Loaded from Shopify. Edit if needed - max 300 characters",maxLength:300,multiline:3}),e.jsx(l,{label:"Keywords",value:o.seo.keywords,onChange:a=>i(t=>({...t,seo:{...t.seo,keywords:a}})),helpText:"Comma-separated keywords (optional)"})]})})]})})}),e.jsx(M.Section,{children:e.jsx(y,{title:"AI Metadata",children:e.jsx(p,{padding:"400",children:e.jsxs(D,{children:[e.jsxs(D.Group,{children:[e.jsx(l,{label:"Business Type",value:o.aiMetadata.businessType,onChange:a=>i(t=>({...t,aiMetadata:{...t.aiMetadata,businessType:a}})),placeholder:"e.g., Fashion Retailer, Electronics Store",helpText:"Max 3 words"}),e.jsx(l,{label:"Target Audience",value:o.aiMetadata.targetAudience,onChange:a=>i(t=>({...t,aiMetadata:{...t.aiMetadata,targetAudience:a}})),placeholder:"e.g., Young professionals, Parents"})]}),e.jsx(l,{label:"Unique Selling Points",value:o.aiMetadata.uniqueSellingPoints,onChange:a=>i(t=>({...t,aiMetadata:{...t.aiMetadata,uniqueSellingPoints:a}})),helpText:"Comma-separated list",multiline:2}),e.jsx(l,{label:"Brand Voice",value:o.aiMetadata.brandVoice,onChange:a=>i(t=>({...t,aiMetadata:{...t.aiMetadata,brandVoice:a}})),placeholder:"e.g., Professional, Friendly, Casual"}),e.jsx(l,{label:"Primary Categories",value:o.aiMetadata.primaryCategories,onChange:a=>i(t=>({...t,aiMetadata:{...t.aiMetadata,primaryCategories:a}})),helpText:"Main product categories, comma-separated"}),e.jsx(l,{label:"Shipping Information",value:o.aiMetadata.shippingInfo,onChange:a=>i(t=>({...t,aiMetadata:{...t.aiMetadata,shippingInfo:a}})),helpText:"Shipping costs, delivery times, free shipping thresholds (e.g., Free shipping over $50, 2-3 business days)",multiline:2}),e.jsx(l,{label:"Return Policy",value:o.aiMetadata.returnPolicy,onChange:a=>i(t=>({...t,aiMetadata:{...t.aiMetadata,returnPolicy:a}})),multiline:2}),e.jsx(Xe,{}),e.jsx(r,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),e.jsx(r,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),e.jsx(l,{label:"Supported Languages",value:((G=o.aiMetadata.languages)==null?void 0:G.join(", "))||"",onChange:a=>i(t=>({...t,aiMetadata:{...t.aiMetadata,languages:a.split(",").map(c=>c.trim()).filter(c=>c)}})),helpText:"Comma-separated language codes (e.g., en, de, es, fr)",multiline:2}),e.jsx(l,{label:"Supported Currencies",value:((K=o.aiMetadata.supportedCurrencies)==null?void 0:K.join(", "))||"",onChange:a=>i(t=>({...t,aiMetadata:{...t.aiMetadata,supportedCurrencies:a.split(",").map(c=>c.trim()).filter(c=>c)}})),helpText:"Comma-separated currency codes (e.g., EUR, USD, GBP)"}),e.jsx(l,{label:"Shipping Regions",value:((X=o.aiMetadata.shippingRegions)==null?void 0:X.join(", "))||"",onChange:a=>i(t=>({...t,aiMetadata:{...t.aiMetadata,shippingRegions:a.split(",").map(c=>c.trim()).filter(c=>c)}})),helpText:"Comma-separated regions (e.g., EU, USA, UK, Canada)",multiline:2}),e.jsx(l,{label:"Cultural Considerations",value:o.aiMetadata.culturalConsiderations||"",onChange:a=>i(t=>({...t,aiMetadata:{...t.aiMetadata,culturalConsiderations:a}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),(H=n==null?void 0:n.features)!=null&&H.organizationSchema?e.jsx(M.Section,{children:e.jsx(y,{title:"Organization Schema",children:e.jsxs(p,{padding:"400",children:[e.jsx(He,{label:"Enable Organization Schema",checked:o.organizationSchema.enabled,onChange:a=>i(t=>({...t,organizationSchema:{...t.organizationSchema,enabled:a}}))}),o.organizationSchema.enabled&&e.jsx(p,{paddingBlockStart:"400",children:e.jsxs(D,{children:[e.jsxs(D.Group,{children:[e.jsx(l,{label:"Organization Name",value:o.organizationSchema.name,onChange:a=>i(t=>({...t,organizationSchema:{...t.organizationSchema,name:a}}))}),e.jsx(l,{label:"Contact Email",value:o.organizationSchema.email,onChange:a=>i(t=>({...t,organizationSchema:{...t.organizationSchema,email:a}})),type:"email"})]}),e.jsx(l,{label:"Phone",value:o.organizationSchema.phone,onChange:a=>i(t=>({...t,organizationSchema:{...t.organizationSchema,phone:a}})),type:"tel"}),e.jsx(l,{label:"Logo URL",value:o.organizationSchema.logo,onChange:a=>i(t=>({...t,organizationSchema:{...t.organizationSchema,logo:a}})),type:"url"}),e.jsx(l,{label:"Social Media Links",value:o.organizationSchema.sameAs,onChange:a=>i(t=>({...t,organizationSchema:{...t.organizationSchema,sameAs:a}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}):e.jsx(M.Section,{children:e.jsx(y,{title:"Organization Schema",children:e.jsx(p,{padding:"400",children:e.jsx(L,{tone:"info",children:e.jsxs(p,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Upgrade to Professional+ to enable Organization Schema"}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Organization Schema helps AI bots understand your business structure, contact information, and social media presence."}),e.jsx(p,{paddingBlockStart:"300",children:e.jsx(v,{primary:!0,onClick:()=>{const a=new URLSearchParams(window.location.search),t=a.toString()?`?${a.toString()}`:"";window.location.href=`/billing${t}`},children:"Upgrade Plan"})})]})})})})}),e.jsx(M.Section,{children:e.jsx(y,{children:e.jsx(p,{padding:"400",children:e.jsxs(Ye,{gap:"300",children:[e.jsx(v,{onClick:T,loading:Oe,primary:!0,children:"Save Metadata"}),e.jsx(v,{onClick:qe,loading:Ue,children:"Preview Metadata"}),e.jsx(v,{onClick:We,loading:$e,destructive:!0,children:"Clear Metadata"})]})})})}),O&&e.jsx(Qe,{content:O,onDismiss:()=>S("")})]})}export{ia as default};
