import{j as e}from"./app-bridge-DdLq8SSf-1760425514902.js";import{r as a}from"./react-vendor-tAaa2TlE-1760425514902.js";import{u as Vt}from"./index-CPajSVEj-1760425514902.js";import{U as Qt,I as Jt}from"./InsufficientTokensModal-BZeShi7O-1760425514902.js";import{M as A,d as D,T as i,e as dt,f as Ge,B as v,a as u,I as P,g as Le,D as Xt,h as X,C as ut,i as Zt,S as es,P as Ae,j as Oe,R as ts,k as ss,l as gt,m as ns,E as rs}from"./polaris-CcC0W3en-1760425514902.js";const os=(f,j="")=>{try{return new URLSearchParams(window.location.search).get(f)||j}catch{return j}},fe=f=>{if(!f)return f;const j=String(f).trim();return j.startsWith("gid://")?j:`gid://shopify/Product/${j}`},as=f=>{if(!f)return"";const j=String(f).match(/\/(\d+)$/);return j?j[1]:f},W=f=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(f==null?void 0:f.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(f==null?void 0:f.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}},He=f=>new URLSearchParams(window.location.search).get("debug_limits")==="true"?f<=5?"Starter":f<=10?"Growth":f<=12?"Professional":f<=15?"Growth Extra":"Enterprise":f<=100?"Starter":f<=350?"Professional":f<=1e3?"Growth":f<=2500?"Growth Extra":"Enterprise";function ps({shop:f,globalPlan:j}){var it,lt,ct;const{api:w,shop:pt}=Vt(),l=f||pt||os("shop","");a.useEffect(()=>{},[l,w]);const[x,F]=a.useState([]),[ae,Se]=a.useState(!1),[ht,qe]=a.useState(1),[mt,ve]=a.useState(!0),[$,Ke]=a.useState(0),[c,Z]=a.useState([]),[y,ie]=a.useState(!1),[_,Fe]=a.useState(""),[R,xe]=a.useState("all"),[T,le]=a.useState(""),[je,is]=a.useState("createdAt"),[ee,ft]=a.useState("desc"),[B,ye]=a.useState([]),[St,xt]=a.useState([]),[_e,ke]=a.useState(!1),[Ye,ze]=a.useState(!1),[Ve,Te]=a.useState(!1),[Qe,Me]=a.useState(!1),[jt,yt]=a.useState(""),[bt,Pt]=a.useState([]),[M,te]=a.useState([]),[O,Je]=a.useState([]),[De,Y]=a.useState(!1),[be,N]=a.useState({current:0,total:0,percent:0}),[Xe,se]=a.useState(""),[Pe,ce]=a.useState([]),[de,Ze]=a.useState({}),[wt,Re]=a.useState(!1),[Ct,ue]=a.useState(!1),[Et,ge]=a.useState(!1),[G,pe]=a.useState([]),[It,we]=a.useState(!1),[et,C]=a.useState(""),[tt,st]=a.useState(!1),[k,V]=a.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[E,Lt]=a.useState(null),[q,Ue]=a.useState(1),[At,Ce]=a.useState(!1),[Ee,Ot]=a.useState(localStorage.getItem("hasVisitedProducts")==="true"),[vt,ne]=a.useState(!1),[kt,nt]=a.useState(!1),[Q,J]=a.useState(null),[re,he]=a.useState("starter");a.useEffect(()=>{if(!(!j||typeof j!="object")){if(j.planKey&&j.planKey!==""){he(j.planKey);const n={starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[j.planKey.toLowerCase()]||1;Ue(n)}else if(j.plan&&j.plan!==""){const t=j.plan.toLowerCase().replace(/\s+/g,"-");he(t);const s={starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[t]||1;Ue(s)}}},[j]),a.useEffect(()=>{if(!l)return;w("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
        }
      }
    `,variables:{shop:l}})}).then(n=>{var p,g,h;if((p=n==null?void 0:n.errors)!=null&&p.length)throw new Error(((g=n.errors[0])==null?void 0:g.message)||"GraphQL error");const s=(h=n==null?void 0:n.data)==null?void 0:h.plansMe,r=(s==null?void 0:s.modelsSuggested)||["anthropic/claude-3.5-sonnet"];Pt(r.map(S=>({label:S,value:S}))),yt(r[0]),Lt((s==null?void 0:s.plan)||"starter"),he((s==null?void 0:s.planKey)||"starter");const d=((s==null?void 0:s.planKey)||"starter").toLowerCase();Ue({starter:1,professional:2,growth:3,"growth extra":6,growth_extra:6,enterprise:10}[d]||1)}).catch(n=>console.error("[BULK-EDIT] GraphQL plansMe failed:",n))},[l,w]),a.useEffect(()=>{if(!l)return;const t=new Promise((n,s)=>{setTimeout(()=>s(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([w(`/api/languages/shop/${l}`),t]).then(n=>{const s=Array.isArray(n==null?void 0:n.shopLanguages)&&n.shopLanguages.length?n.shopLanguages:["en"];Je(s.includes("en")?s:["en",...s])}).catch(n=>{console.error("[BULK-EDIT] Languages API error:",n),Je(["en"])})},[l,w]),a.useEffect(()=>{l&&w("/api/products/tags/list",{shop:l}).then(t=>xt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[l,w]);const K=a.useCallback(async(t=1,n=!1,s=null)=>{var r,d,o,p,g;Se(!0);try{const h=new URLSearchParams({shop:l,page:t,limit:50,...R!=="all"&&{optimized:R},..._&&{search:_},...T&&{languageFilter:T},...B.length>0&&{tags:B.join(",")},sortBy:je,sortOrder:ee,...s&&{_t:s}}),S=await w(`/api/products/list?${h}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((r=S.products)==null?void 0:r.length)>0,console.log("[LOAD-PRODUCTS] ===== PRODUCTS LOADED ====="),console.log("[LOAD-PRODUCTS] Total products:",(d=S.products)==null?void 0:d.length),((o=S.products)==null?void 0:o.length)>0&&S.products.forEach((b,H)=>{var m,z;console.log(`[LOAD-PRODUCTS] Product ${H}: ID=${b.id} (type: ${typeof b.id}), _id=${b._id}, title="${b.title}", has SEO: ${!!((z=(m=b.optimizationSummary)==null?void 0:m.optimizedLanguages)!=null&&z.length)}`)}),F(n?b=>[...b,...S.products]:S.products||[]),qe(t),ve(((p=S.pagination)==null?void 0:p.hasNext)||!1),Ke(((g=S.pagination)==null?void 0:g.total)||0)}catch(h){F(n?x:[]),ve(!1),C(`Error loading products: ${h.message}`)}finally{Se(!1)}},[l,R,_,T,B,je,ee]);a.useEffect(()=>{l&&K(1,!1,null)},[l,K,R,T,B,je,ee]),a.useEffect(()=>{!Ee&&l&&(localStorage.setItem("hasVisitedProducts","true"),Ot(!0))},[Ee,l]),a.useEffect(()=>{x.length===0&&!ae&&l&&!Ee&&Ce(!0)},[x.length,ae,l,Ee]),a.useEffect(()=>{console.log("[DEBUG-MONITOR] ===== STATE CHANGED ====="),console.log("[DEBUG-MONITOR] Products count:",x.length),console.log("[DEBUG-MONITOR] Selected items count:",c.length),console.log("[DEBUG-MONITOR] Products:",x.map(t=>({id:t.id,title:t.title}))),console.log("[DEBUG-MONITOR] Selected items:",c)},[x,c]);const rt=a.useCallback(t=>{Fe(t)},[]);a.useEffect(()=>{const t=setTimeout(()=>{l&&K(1,!1,null)},500);return()=>clearTimeout(t)},[_]);const zt=a.useCallback(t=>{console.log("[SELECTION-CHANGE] ===== SELECTION CHANGED ====="),console.log("[SELECTION-CHANGE] New selected items:",t),console.log("[SELECTION-CHANGE] Item count:",t.length),console.log("[SELECTION-CHANGE] Item types:",t.map(n=>typeof n)),console.log("[SELECTION-CHANGE] Current products count:",x.length),console.log("[SELECTION-CHANGE] Current products IDs:",x.map(n=>n.id)),Z(t),t.length===0&&ie(!1)},[x]),ot=a.useCallback(t=>{ie(t),Z(t?x.map(n=>n.id):[])},[x]),at=a.useMemo(()=>{var n;if(y)return M.length>q;const t=x.filter(s=>c.includes(s.id));if(t.length===0)return M.length>q;for(const s of t){const r=((n=s.optimizationSummary)==null?void 0:n.optimizedLanguages)||[],d=M.filter(p=>!r.includes(p));if(r.length+d.length>q)return!0}return!1},[x,c,y,q,M]),Tt=()=>{if(c.length===0&&!y){C("Please select products first");return}ue(!0)},Mt=()=>{if(c.length===0&&!y){C("Please select products first");return}pe([]),ge(!0)},Dt=async()=>{const n=x.filter(r=>c.includes(r.id)).filter(r=>{var d,o;return((o=(d=r.optimizationSummary)==null?void 0:d.optimizedLanguages)==null?void 0:o.length)>0});st(!0),V({processing:!0,current:0,total:n.length,currentItem:"",results:null});const s={successful:0,failed:0,skipped:0};for(let r=0;r<n.length;r++){const d=n[r];V(o=>({...o,current:r,currentItem:d.title}));try{const o=await w("/ai-enhance/product",{method:"POST",shop:l,body:{shop:l,productId:d.gid||fe(d.id),languages:d.optimizationSummary.optimizedLanguages}});if(o.results&&o.results.length>0){const p={shop:l,productId:d.gid||fe(d.id),results:o.results.filter(h=>h.bullets&&h.faq).map(h=>({language:h.language,seo:{...h.updatedSeo,bullets:h.bullets||[],faq:h.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},g=await w("/api/seo/apply-multi",{method:"POST",shop:l,body:p});s.successful++}else s.failed++}catch(o){if(console.error("Enhancement error:",o),console.error("🔍 [DEBUG] Error details:",{status:o.status,trialRestriction:o.trialRestriction,needsUpgrade:o.needsUpgrade,requiresPurchase:o.requiresPurchase,message:o.message,currentPlan:o.currentPlan}),o.status===403){V({processing:!1,current:0,total:0,currentItem:"",results:null}),J({...o,message:o.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),he(o.currentPlan||re),ne(!0);return}if(o.status===402||o.requiresPurchase||o.trialRestriction){V({processing:!1,current:0,total:0,currentItem:"",results:null}),J(o),he(o.currentPlan||E||"starter"),o.trialRestriction?ne(!0):nt(!0);return}s.failed++}V(o=>({...o,current:r+1}))}V(r=>({...r,processing:!1,results:s})),C(`AI enhancement complete! ${s.successful} products enhanced.`)},$e=()=>{st(!1),V({processing:!1,current:0,total:0,currentItem:"",results:null}),k.results&&k.results.successful>0&&K(1,!1,null)},Rt=()=>k.processing?e.jsx(A,{open:tt,title:"Processing AI Enhancement",onClose:$e,noScroll:!0,children:e.jsx(A.Section,{children:e.jsxs(D,{gap:"400",children:[e.jsxs(i,{variant:"bodyMd",children:["Processing: ",k.currentItem]}),e.jsx(dt,{progress:k.current/k.total*100}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[k.current," of ",k.total," products (",Math.round(k.current/k.total*100),"%)"]})]})})}):k.results!==null?e.jsx(A,{open:tt,title:"AI Enhancement Results",onClose:$e,primaryAction:{content:"Done",onAction:$e},children:e.jsx(A.Section,{children:e.jsx(D,{gap:"300",children:e.jsxs(P,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"success",children:k.results.successful})]}),e.jsxs(u,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:k.results.failed})]}),e.jsxs(u,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"info",children:k.results.skipped})]})]})})})}):null,Ut=async()=>{var n;if(!M.length){C("Please select at least one language");return}let t=jt;(!t||!t.trim())&&(t=((n=bt[0])==null?void 0:n.value)||"anthropic/claude-3.5-sonnet"),Y(!0),N({current:0,total:0,percent:0}),ce([]),Ze({});try{let s=[];y?s=(await w(`/api/products/list?shop=${encodeURIComponent(l)}&limit=1000&fields=id`)).products||[]:s=x.filter(m=>c.includes(m.id));const r=W(E),d=s.length;if(d>r){Y(!1),N({current:0,total:0,percent:0}),ue(!1),J({error:"Product limit exceeded",message:`Your ${E} plan supports up to ${r} products. You have selected ${d} products. Please upgrade your plan or reduce your selection.`,minimumPlanRequired:He(d)}),ne(!0);return}ue(!1);const o=d,p=0;N({current:0,total:o,percent:0});const g=5,h={};for(let m=0;m<s.length;m+=g){const I=s.slice(m,Math.min(m+g,s.length)).map(async L=>{var oe;se(L.title||L.handle||"Product");try{const Ie=L.gid||fe(L.productId||L.id),Ne=((oe=L.optimizationSummary)==null?void 0:oe.optimizedLanguages)||[],We=M.filter(Yt=>!Ne.includes(Yt));if(We.length===0){h[L.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const _t=await w("/api/seo/generate-multi",{method:"POST",shop:l,body:{shop:l,productId:Ie,model:t,languages:We}});h[L.id]={success:!0,data:_t,languages:We}}catch(Ie){h[L.id]={success:!1,error:Ie.message},ce(Ne=>[...Ne,{product:L.title,error:Ie.message}])}});await Promise.all(I);const U=Math.min(m+g,s.length),me=Math.round(U/o*100);N({current:U,total:o,percent:me})}Ze(h),Re(!0);const S=Object.keys(h).filter(m=>h[m].success&&!h[m].skipped).length,b=Object.keys(h).filter(m=>h[m].skipped).length;let H=`Generated Optimization for AI Search for ${S} products`;b>0&&(H+=` (${b} already optimised)`),p>0,C(H)}catch(s){C(`Error: ${s.message}`)}finally{Y(!1),se("")}},$t=async()=>{var t,n;Y(!0),N({current:0,total:0,percent:0});try{const s=Object.entries(de).filter(([p,g])=>g.success&&!g.skipped),r=s.length;N({current:0,total:r,percent:0});for(let p=0;p<s.length;p++){const[g,h]=s[p],S=x.find(m=>m.id===g);if(!S)continue;se(S.title||"Product");try{const m=S.gid||fe(S.productId||S.id),z=await w("/api/seo/apply-multi",{method:"POST",shop:l,body:{shop:l,productId:m,results:h.data.results.filter(I=>I==null?void 0:I.seo).map(I=>({language:I.language,seo:I.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});z.appliedLanguages&&z.appliedLanguages.length>0&&F(I=>I.map(U=>{var me;if(U.id===g){const L=((me=U.optimizationSummary)==null?void 0:me.optimizedLanguages)||[],oe=[...new Set([...L,...z.appliedLanguages])];return{...U,optimizationSummary:{...U.optimizationSummary,optimizedLanguages:oe,optimized:!0,lastOptimized:new Date().toISOString()}}}return U}))}catch(m){ce(z=>[...z,{product:S.title,error:`Apply failed: ${m.message}`}])}const b=p+1,H=Math.round(b/r*100);N({current:b,total:r,percent:H})}C("AI Search Optimisation applied successfully!"),Re(!1),console.log("[APPLY-SEO] ===== CLEARING SELECTION ====="),console.log("[APPLY-SEO] Selected items BEFORE clear:",c),Z([]),ie(!1),console.log("[APPLY-SEO] Selected items cleared"),console.log("[APPLY-SEO] Waiting for database propagation..."),await new Promise(p=>setTimeout(p,1e3)),console.log("[APPLY-SEO] Clearing products state before reload..."),F([]);const d=new URLSearchParams({shop:l,page:1,limit:50,...R!=="all"&&{optimized:R},..._&&{search:_},...T&&{languageFilter:T},...B.length>0&&{tags:B.join(",")},sortBy:je,sortOrder:ee,_t:Date.now()}),o=await w(`/api/products/list?${d}`,{shop:l,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});F(o.products||[]),qe(1),ve(((t=o.pagination)==null?void 0:t.hasNext)||!1),Ke(((n=o.pagination)==null?void 0:n.total)||0)}catch(s){C(`Error applying AI Search Optimisation: ${s.message}`)}finally{Y(!1),se("")}},Bt=async()=>{var t;if(!G.length){C("Please select at least one language to delete");return}ge(!1),we(!1),Y(!0),N({current:0,total:0,percent:0}),ce([]);try{let n=[];y?n=(await w(`/api/products/list?shop=${encodeURIComponent(l)}&limit=1000&fields=id`)).products||[]:n=x.filter(o=>c.includes(o.id));const s=n.length;N({current:0,total:s,percent:0});let r=0,d=0;for(let o=0;o<n.length;o++){const p=n[o];se(p.title||p.handle||"Product");try{const S=p.gid||fe(p.productId||p.id),b=((t=p.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],H=G.filter(z=>b&&b.length>0&&b.includes(z));if(H.length===0){d++;continue}const m=await w("/api/seo/delete-multi",{method:"POST",shop:l,body:{shop:l,productId:S,languages:H}});m.deletedLanguages&&m.deletedLanguages.length>0&&F(z=>z.map(I=>{var U;if(I.id===p.id){const L=(((U=I.optimizationSummary)==null?void 0:U.optimizedLanguages)||[]).filter(oe=>!m.deletedLanguages.includes(oe));return{...I,optimizationSummary:{...I.optimizationSummary,optimizedLanguages:L,optimized:L.length>0,lastOptimized:L.length>0?I.optimizationSummary.lastOptimized:null}}}return I})),r++,m.deletedLanguages&&m.deletedLanguages.length>0&&await w("/api/products/verify-after-delete",{method:"POST",shop:l,body:{shop:l,productIds:[S],deletedLanguages:m.deletedLanguages}})}catch(S){ce(b=>[...b,{product:p.title,error:S.message}])}const g=o+1,h=Math.round(g/s*100);N({current:g,total:s,percent:h})}Z([]),ie(!1),d>0?C(`Deleted Optimization for AI Search from ${r} products (${d} had no optimisation to delete)`):C(`Deleted Optimization for AI Search from ${r} products`),setTimeout(()=>{const o=Date.now();K(1,!1,o)},500)}catch(n){C(`Error: ${n.message}`)}finally{Y(!1),se("")}},Nt=t=>{var n,s;try{const r=t,d=as(r.productId||r.id),o=((n=r.optimizationSummary)==null?void 0:n.optimizedLanguages)||[];console.log(`[BULK-EDIT-RENDER] Product: "${r.title}", ID: ${r.id}, Type: ${typeof r.id}`),console.log("[BULK-EDIT-RENDER] Optimized Languages:",o),console.log("[BULK-EDIT-RENDER] Selected Items:",c),console.log("[BULK-EDIT-RENDER] Is Selected:",c.includes(r.id));const p=(s=r.images)!=null&&s[0]?e.jsx(gt,{source:r.images[0].url||r.images[0].src||r.images[0],alt:r.title,size:"small"}):r.imageUrl?e.jsx(gt,{source:r.imageUrl,alt:r.title,size:"small"}):e.jsx(u,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(ns,{id:r.id,media:p,accessibilityLabel:`View details for ${r.title}`,onClick:g=>{console.log("[ResourceItem] ===== CLICK ON RESOURCE ITEM ====="),console.log("[ResourceItem] e.target:",g.target),console.log("[ResourceItem] e.target.tagName:",g.target.tagName),console.log('[ResourceItem] e.target.closest("input"):',g.target.closest("input")),console.log('[ResourceItem] e.target.closest("a"):',g.target.closest("a")),console.log("[ResourceItem] Event bubbling up...")},children:e.jsxs(P,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(u,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:r.title}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["ID: ",d]})]}),e.jsx(u,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(P,{gap:"100",children:O.length>0?O.map(g=>{const h=o.includes(g);return e.jsx(X,{tone:h?"success":"subdued",size:"small",children:g.toUpperCase()},g)}):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),o.map(g=>e.jsx(X,{tone:"success",size:"small",children:g.toUpperCase()},g)))})}),e.jsx(u,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(X,{tone:"success",children:"Active"})})]})})}catch(r){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",r),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},Wt=De&&e.jsx(A,{open:De,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(A.Section,{children:e.jsxs(D,{gap:"400",children:[e.jsx(i,{variant:"bodyMd",children:Xe?`Processing: ${Xe}`:"Preparing..."}),e.jsx(dt,{progress:be.percent}),e.jsxs(i,{variant:"bodySm",tone:"subdued",children:[be.current," of ",be.total," products (",be.percent,"%)"]})]})})}),Gt=e.jsx(A,{open:Ct,title:"Select Languages",onClose:()=>{ue(!1),te([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Ut,disabled:M.length===0||at},secondaryActions:[{content:"Cancel",onAction:()=>{ue(!1),te([])}}],children:e.jsx(A.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsxs(i,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",y?"all":c.length," selected products:"]}),at&&e.jsx(Ge,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(D,{gap:"200",children:[e.jsxs(i,{variant:"bodyMd",children:["Your ",re," plan supports up to ",q," language",q>1?"s":""," per product.",c.length===1&&((ct=(lt=(it=x.find(t=>t.id===c[0]))==null?void 0:it.optimizationSummary)==null?void 0:lt.optimizedLanguages)==null?void 0:ct.length)>0&&e.jsxs(e.Fragment,{children:[" This product already has ",x.find(t=>t.id===c[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(i,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(v,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),n=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${n}`},children:"Upgrade Plan"})]})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(P,{gap:"200",wrap:!0,children:O.map(t=>e.jsx(Le,{label:t.toUpperCase(),checked:M.includes(t),onChange:n=>{te(n?[...M,t]:M.filter(s=>s!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(v,{plain:!0,onClick:()=>{M.length===O.length?te([]):O.length>q?(te([...O]),C(`You selected ${O.length} languages. Your ${re} plan supports ${q}. Please deselect or upgrade.`)):te([...O])},children:M.length===O.length?"Deselect all":"Select all"})}),e.jsx(i,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Ht=e.jsx(A,{open:wt&&!De,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:$t,disabled:!Object.values(de).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Re(!1)}],children:e.jsx(A.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsxs(P,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(de).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(de).filter(t=>t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(i,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(de).filter(t=>!t.success).length})]})]}),Pe.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Xt,{}),e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(u,{maxHeight:"200px",overflowY:"scroll",children:[Pe.slice(0,10).map((t,n)=>e.jsxs(i,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},n)),Pe.length>10&&e.jsxs(i,{variant:"bodySm",tone:"subdued",children:["... and ",Pe.length-10," more errors"]})]})]})]})})}),qt=e.jsx(A,{open:Et,title:"Delete Optimization for AI Search",onClose:()=>{ge(!1),pe([])},primaryAction:{content:"Continue",onAction:()=>{ge(!1),we(!0)},disabled:G.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{ge(!1),pe([])}}],children:e.jsx(A.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsxs(i,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",y?"all":c.length," selected products:"]}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(P,{gap:"200",wrap:!0,children:O.map(t=>e.jsx(Le,{label:t.toUpperCase(),checked:G.includes(t),onChange:n=>{pe(n?[...G,t]:G.filter(s=>s!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(v,{plain:!0,onClick:()=>{pe(G.length===O.length?[]:[...O])},children:G.length===O.length?"Deselect all":"Select all"})}),e.jsx(i,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Kt=e.jsx(A,{open:It,title:"Confirm Deletion",onClose:()=>{we(!1)},primaryAction:{content:"Delete",onAction:Bt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>we(!1)}],children:e.jsx(A.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsx(i,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(u,{paddingBlock:"200",children:e.jsx(P,{gap:"100",children:G.map(t=>e.jsx(X,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(i,{variant:"bodyMd",children:["This will delete optimisation from ",y?"ALL":c.length," selected products."]}),e.jsx(i,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Be=async()=>{try{Se(!0),C("Syncing products from Shopify...");const t=await w("/api/products/sync",{method:"POST",shop:l});if(t.success){const n=t.productsCount||t.synced||0;C(`✅ Synced ${n} products successfully!`),setTimeout(()=>{K(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),C(`❌ Sync failed: ${t.message}`)}finally{Se(!1)}},Ft=e.jsx(rs,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Fe(""),xe("all"),le(""),ye([]),K(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Be},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(ut,{children:e.jsxs(u,{padding:"400",children:[e.jsxs(D,{gap:"300",children:[E&&e.jsx(Ge,{tone:"info",children:e.jsxs(P,{gap:"200",align:"space-between",children:[e.jsxs(i,{children:["Your ",e.jsx("strong",{children:E})," plan includes up to"," ",e.jsx("strong",{children:W(E)})," products for SEO optimization.",$>W(E)&&e.jsxs(e.Fragment,{children:[" You have ",$," products, so only the first ",W(E)," will be processed."]})]}),(c.length>0||y)&&e.jsxs(i,{children:["Selected: ",y?Math.min($,W(E)):c.length,"/",W(E)]})]})}),E&&(c.length>W(E)||y&&$>W(E))&&e.jsx(Ge,{tone:"critical",children:e.jsxs(D,{gap:"200",children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),e.jsxs(i,{children:["Your ",e.jsx("strong",{children:E})," plan supports up to ",e.jsx("strong",{children:W(E)})," products. You have selected ",e.jsx("strong",{children:y?$:c.length})," products."]}),e.jsx(i,{children:"Please deselect some products or upgrade your plan to continue."}),e.jsxs(P,{gap:"200",children:[e.jsx(v,{onClick:()=>{Z([]),ie(!1)},children:"Clear Selection"}),e.jsx(v,{variant:"primary",onClick:()=>{J({error:"Product limit exceeded",message:`Your ${E} plan supports up to ${W(E)} products. Upgrade to ${He(y?$:c.length)} to optimize more products.`,minimumPlanRequired:He(y?$:c.length)}),ne(!0)},children:"Upgrade Plan"})]})]})}),e.jsxs(P,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(u,{minWidth:"400px",children:e.jsx(Zt,{label:"",placeholder:"Search by product ID, name, or details...",value:_,onChange:rt,prefix:e.jsx(es,{}),clearButton:!0,onClearButtonClick:()=>rt("")})}),e.jsx(u,{width:"320px",children:e.jsx(v,{primary:!0,onClick:Tt,disabled:c.length===0&&!y,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(P,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(v,{onClick:Be,disabled:ae,size:"medium",children:"Sync Products"}),e.jsx(u,{width:"320px",children:e.jsxs(D,{gap:"200",align:"end",children:[(()=>{if(c.length===0&&!y||!x.filter(r=>c.includes(r.id)).some(r=>{var d,o;return((o=(d=r.optimizationSummary)==null?void 0:d.optimizedLanguages)==null?void 0:o.length)>0}))return null;const s=["professional","growth","growth_extra","growth extra","enterprise"].includes(re.toLowerCase().replace(/_/g," "));return e.jsx(v,{onClick:s?Dt:()=>{J({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),ne(!0)},disabled:c.length===0&&!y,size:"medium",fullWidth:!0,children:s?"AI Enhanced add-ons for AI Search":"✨ AI Enhanced add-ons"})})(),e.jsx(v,{onClick:Mt,disabled:c.length===0&&!y||!x.filter(s=>c.includes(s.id)).some(s=>{var r,d;return((d=(r=s.optimizationSummary)==null?void 0:r.optimizedLanguages)==null?void 0:d.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),$>0&&e.jsx(u,{paddingBlockStart:"300",children:e.jsx(Le,{label:`Select all ${$} products in your store`,checked:y,onChange:ot})})]})}),e.jsx(u,{paddingBlockStart:"400",children:e.jsxs(ut,{children:[e.jsxs(u,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(P,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(P,{gap:"200",wrap:!0,children:[e.jsx(Ae,{active:_e,activator:e.jsx(v,{disclosure:"down",onClick:()=>ke(!_e),removeUnderline:!0,children:e.jsxs(P,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),R!=="all"&&e.jsx(u,{onClick:t=>{t.stopPropagation(),xe("all")},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ke(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(Oe,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[R],onChange:t=>{xe(t[0]),le(""),ke(!1)}})})}),e.jsx(Ae,{active:Ye,activator:e.jsx(v,{disclosure:"down",onClick:()=>ze(!Ye),removeUnderline:!0,children:e.jsxs(P,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),T&&e.jsx(u,{onClick:t=>{t.stopPropagation(),le("")},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ze(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(Oe,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...O.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...O.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:T?[T]:[],onChange:t=>{le(t[0]||""),ze(!1)}})})}),e.jsx(Ae,{active:Ve,activator:e.jsx(v,{disclosure:"down",onClick:()=>Te(!Ve),removeUnderline:!0,children:e.jsxs(P,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),B.length>0&&e.jsx(u,{onClick:t=>{t.stopPropagation(),ye([])},children:e.jsx(i,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Te(!1),children:e.jsxs(u,{padding:"300",minWidth:"200px",children:[e.jsx(Oe,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:St.map(t=>({label:t,value:t})),selected:B,onChange:t=>{ye(t)}}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(v,{size:"slim",onClick:()=>Te(!1),children:"Apply"})})]})})]}),e.jsx(Ae,{active:Qe,activator:e.jsx(v,{disclosure:"down",onClick:()=>Me(!Qe),removeUnderline:!0,children:e.jsx(P,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:ee==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Me(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(Oe,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[ee],onChange:t=>{ft(t[0]),Me(!1)}})})})]}),(R!=="all"||T||B.length>0)&&e.jsx(u,{paddingBlockStart:"200",children:e.jsxs(P,{gap:"100",wrap:!0,children:[R!=="all"&&e.jsx(X,{onRemove:()=>xe("all"),children:R==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),T&&e.jsx(X,{onRemove:()=>le(""),children:T.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),B.map(t=>e.jsxs(X,{onRemove:()=>ye(n=>n.filter(s=>s!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(u,{children:[e.jsx(u,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(P,{gap:"200",align:"start",children:[e.jsx(Le,{checked:c.length===x.length&&x.length>0,onChange:ot,label:""}),e.jsxs(i,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",c.length>0&&` (${c.length} selected products)`]})]})}),e.jsx(ts,{resourceName:{singular:"product",plural:"products"},items:x,renderItem:Nt,selectedItems:c,onSelectionChange:zt,selectable:!0,loading:ae,totalItemsCount:$,emptyState:Ft,showHeader:!1},`products-${x.length}-${c.length}`)]}),mt&&!ae&&e.jsx(u,{padding:"400",textAlign:"center",children:e.jsx(v,{onClick:()=>K(ht+1,!0,null),children:"Load more"})})]})}),Wt,Gt,Ht,qt,Kt,Rt(),e.jsx(A,{open:At,onClose:()=>Ce(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Ce(!1),Be()}},secondaryActions:[{content:"Skip for now",onAction:()=>Ce(!1)}],children:e.jsx(A.Section,{children:e.jsxs(D,{gap:"300",children:[e.jsx(i,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(i,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Qt,{open:vt,onClose:()=>{ne(!1),J(null)},featureName:"AI Enhancement",currentPlan:re}),Q&&e.jsx(Jt,{open:kt,onClose:()=>{nt(!1),J(null)},tokensRequired:Q.tokensRequired||0,tokensAvailable:Q.tokensAvailable||0,tokensNeeded:Q.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:l,needsUpgrade:Q.needsUpgrade||!1,minimumPlan:Q.minimumPlanForFeature||null,currentPlan:Q.currentPlan||re}),et&&e.jsx(ss,{content:et,onDismiss:()=>C("")})]})}export{ps as default};
