import{j as t}from"./app-bridge-Ci7Qxd_D-1759170981400.js";import{r as u}from"./react-vendor-tAaa2TlE-1759170981400.js";import{m as K}from"./index-Dhz2Zb2B-1759170981400.js";import{C as S,a as m,T as j,h as Y,L as M,s as x,i as l,D as Q,f as q,I as Z,B as z,k as aa}from"./polaris-Bb2L6S_q-1759170981400.js";const ea=(C,d="")=>{try{return new URLSearchParams(window.location.search).get(C)||d}catch{return d}};function sa({shop:C}){var R,v,O,P,$;const d=C||ea("shop",""),[_,T]=u.useState(!1),[J,B]=u.useState(!1),[k,p]=u.useState(""),[h,V]=u.useState(null),y=u.useMemo(()=>K({}),[]),[F,E]=u.useState(!1),[G,A]=u.useState(!1),[o,s]=u.useState({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}});u.useEffect(()=>{d&&H()},[d,y]);async function H(){T(!0);try{const e=`/api/store/generate?shop=${encodeURIComponent(d)}`;console.log("[StoreMeta] GET",e);const a=await y(e,{headers:{"X-Shop":d}});if(console.log("[StoreMeta] GET ok",{url:e,keys:Object.keys(a||{})}),V(a),a.existingMetadata){const n=a.existingMetadata;s(i=>{var g,c,r,f,b,I,L,N,D,U;return{...i,seo:{...i.seo,...((g=n.seo_metadata)==null?void 0:g.value)||{},keywords:Array.isArray((r=(c=n.seo_metadata)==null?void 0:c.value)==null?void 0:r.keywords)?n.seo_metadata.value.keywords.join(", "):((b=(f=n.seo_metadata)==null?void 0:f.value)==null?void 0:b.keywords)||i.seo.keywords||""},aiMetadata:((I=n.ai_metadata)==null?void 0:I.value)||i.aiMetadata,organizationSchema:{...i.organizationSchema,...((L=n.organization_schema)==null?void 0:L.value)||{},enabled:((D=(N=n.organization_schema)==null?void 0:N.value)==null?void 0:D.enabled)===!0},localBusinessSchema:((U=n.local_business_schema)==null?void 0:U.value)||i.localBusinessSchema}})}a.shopInfo&&s(n=>{var i,g,c;return{...n,seo:{...n.seo,title:n.seo.title||a.shopInfo.name},organizationSchema:{...n.organizationSchema,name:n.organizationSchema.name||a.shopInfo.name,email:n.organizationSchema.email||a.shopInfo.email},aiMetadata:{...n.aiMetadata,languages:((i=n.aiMetadata.languages)==null?void 0:i.length)>0?n.aiMetadata.languages:(a.shopInfo.locales||[]).filter(r=>r.published).map(r=>r.locale),supportedCurrencies:((g=n.aiMetadata.supportedCurrencies)==null?void 0:g.length)>0?n.aiMetadata.supportedCurrencies:a.shopInfo.currencies||["EUR"],shippingRegions:((c=n.aiMetadata.shippingRegions)==null?void 0:c.length)>0?n.aiMetadata.shippingRegions:(a.shopInfo.markets||[]).flatMap(r=>{var f;return((f=r.countries)==null?void 0:f.map(b=>b.name))||[r.name]})}}})}catch(e){console.error("[StoreMeta] GET error",(e==null?void 0:e.debug)||e,e),p(`Load failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{T(!1)}}async function w(){B(!0);try{const e=`/api/store/apply?shop=${encodeURIComponent(d)}`;console.log("[StoreMeta] SAVE",e);const a=await y(e,{method:"POST",headers:{"X-Shop":d},body:{metadata:o,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:o.organizationSchema.enabled,updateLocalBusiness:o.localBusinessSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:e,ok:a==null?void 0:a.ok}),p("Metadata saved successfully!")}catch(e){console.error("[StoreMeta] SAVE error",(e==null?void 0:e.debug)||e,e),p(`Save failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{B(!1)}}async function X(){var e;E(!0);try{await w();const n=await y("/graphql",{method:"POST",headers:{"X-Shop":d},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            seoMetadata
            aiMetadata
            organizationSchema
            localBusinessSchema
          }
        }
      `,variables:{shop:d}}});if(n.error)throw new Error(n.error);const i=(e=n.data)==null?void 0:e.storeMetadata;if(i){const g=window.open("","_blank");console.log("[STORE-METADATA] Raw preview data:",i),console.log("[STORE-METADATA] seoMetadata raw:",i.seoMetadata),console.log("[STORE-METADATA] aiMetadata raw:",i.aiMetadata),console.log("[STORE-METADATA] organizationSchema raw:",i.organizationSchema);const c={shopName:i.shopName,description:i.description,seoMetadata:i.seoMetadata?(()=>{try{return JSON.parse(i.seoMetadata)}catch(r){return console.error("Error parsing seoMetadata:",r),i.seoMetadata}})():null,aiMetadata:i.aiMetadata?(()=>{try{return JSON.parse(i.aiMetadata)}catch(r){return console.error("Error parsing aiMetadata:",r),i.aiMetadata}})():null,organizationSchema:i.organizationSchema?(()=>{try{return JSON.parse(i.organizationSchema)}catch(r){return console.error("Error parsing organizationSchema:",r),i.organizationSchema}})():null,localBusinessSchema:i.localBusinessSchema?(()=>{try{return JSON.parse(i.localBusinessSchema)}catch(r){return console.error("Error parsing localBusinessSchema:",r),i.localBusinessSchema}})():null};g.document.write(`
          <html>
            <head>
              <title>Store Metadata Preview</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
                h1 { color: #333; }
                .section { margin: 20px 0; }
                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
              </style>
            </head>
            <body>
              <h1>Store Metadata Preview</h1>
              <div class="section">
                <h2>Basic Info</h2>
                <p><strong>Shop Name:</strong> ${c.shopName||"Not set"}</p>
                <p><strong>Description:</strong> ${c.description||"Not set"}</p>
              </div>
              
              <div class="section">
                <h2>SEO Metadata</h2>
                <pre>${JSON.stringify(c.seoMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>AI Metadata</h2>
                <pre>${JSON.stringify(c.aiMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Organization Schema</h2>
                <pre>${JSON.stringify(c.organizationSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Local Business Schema</h2>
                <pre>${JSON.stringify(c.localBusinessSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Raw Data</h2>
                <pre>${JSON.stringify(c,null,2)}</pre>
              </div>
            </body>
          </html>
        `),g.document.close()}else throw new Error("No preview data available")}catch(a){p(`Preview failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{E(!1)}}async function W(){A(!0);try{s({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}}),await w(),p("Metadata cleared successfully!")}catch(e){p(`Clear failed: ${(e==null?void 0:e.message)||"Unknown error"}`)}finally{A(!1)}}return _&&!h?t.jsx(S,{children:t.jsx(m,{padding:"400",children:t.jsx(j,{children:"Loading store data..."})})}):(h==null?void 0:h.plan)==="Starter"?t.jsx(Y,{status:"warning",children:t.jsx(j,{children:"Store metadata features are available starting from the Professional plan."})}):t.jsxs(M,{children:[t.jsx(M.Section,{children:t.jsx(S,{title:"Basic Store Information",children:t.jsx(m,{padding:"400",children:t.jsxs(x,{children:[t.jsx(l,{label:"SEO Title",value:o.seo.title,onChange:e=>s(a=>({...a,seo:{...a.seo,title:e}})),helpText:"Title for search engines (max 70 chars)",maxLength:70}),t.jsx(l,{label:"Meta Description",value:o.seo.metaDescription,onChange:e=>s(a=>({...a,seo:{...a.seo,metaDescription:e}})),helpText:"Description for search results (150-160 chars)",maxLength:160,multiline:3}),t.jsx(l,{label:"Keywords",value:o.seo.keywords,onChange:e=>s(a=>({...a,seo:{...a.seo,keywords:e}})),helpText:"Comma-separated keywords"})]})})})}),t.jsx(M.Section,{children:t.jsx(S,{title:"AI Metadata",children:t.jsx(m,{padding:"400",children:t.jsxs(x,{children:[t.jsxs(x.Group,{children:[t.jsx(l,{label:"Business Type",value:o.aiMetadata.businessType,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,businessType:e}})),placeholder:"e.g., Fashion Retailer, Electronics Store"}),t.jsx(l,{label:"Target Audience",value:o.aiMetadata.targetAudience,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,targetAudience:e}})),placeholder:"e.g., Young professionals, Parents"})]}),t.jsx(l,{label:"Unique Selling Points",value:o.aiMetadata.uniqueSellingPoints,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,uniqueSellingPoints:e}})),helpText:"Comma-separated list",multiline:2}),t.jsx(l,{label:"Brand Voice",value:o.aiMetadata.brandVoice,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,brandVoice:e}})),placeholder:"e.g., Professional, Friendly, Casual"}),t.jsx(l,{label:"Primary Categories",value:o.aiMetadata.primaryCategories,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,primaryCategories:e}})),helpText:"Main product categories, comma-separated"}),t.jsx(l,{label:"Shipping Information",value:o.aiMetadata.shippingInfo,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,shippingInfo:e}})),multiline:2}),t.jsx(l,{label:"Return Policy",value:o.aiMetadata.returnPolicy,onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,returnPolicy:e}})),multiline:2}),t.jsx(Q,{}),t.jsx(j,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),t.jsx(j,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),t.jsx(l,{label:"Supported Languages",value:((R=o.aiMetadata.languages)==null?void 0:R.join(", "))||"",onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,languages:e.split(",").map(n=>n.trim()).filter(n=>n)}})),helpText:"Comma-separated language codes (e.g., en, bg, ro, de)",multiline:2}),t.jsx(l,{label:"Supported Currencies",value:((v=o.aiMetadata.supportedCurrencies)==null?void 0:v.join(", "))||"",onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,supportedCurrencies:e.split(",").map(n=>n.trim()).filter(n=>n)}})),helpText:"Comma-separated currency codes (e.g., EUR, BGN, RON)"}),t.jsx(l,{label:"Shipping Regions",value:((O=o.aiMetadata.shippingRegions)==null?void 0:O.join(", "))||"",onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,shippingRegions:e.split(",").map(n=>n.trim()).filter(n=>n)}})),helpText:"Comma-separated regions (e.g., EU, Worldwide, Bulgaria, Romania)",multiline:2}),t.jsx(l,{label:"Cultural Considerations",value:o.aiMetadata.culturalConsiderations||"",onChange:e=>s(a=>({...a,aiMetadata:{...a.aiMetadata,culturalConsiderations:e}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),((P=h==null?void 0:h.features)==null?void 0:P.organizationSchema)&&t.jsx(M.Section,{children:t.jsx(S,{title:"Organization Schema",children:t.jsxs(m,{padding:"400",children:[t.jsx(q,{label:"Enable Organization Schema",checked:o.organizationSchema.enabled,onChange:e=>s(a=>({...a,organizationSchema:{...a.organizationSchema,enabled:e}}))}),o.organizationSchema.enabled&&t.jsx(m,{paddingBlockStart:"400",children:t.jsxs(x,{children:[t.jsxs(x.Group,{children:[t.jsx(l,{label:"Organization Name",value:o.organizationSchema.name,onChange:e=>s(a=>({...a,organizationSchema:{...a.organizationSchema,name:e}}))}),t.jsx(l,{label:"Contact Email",value:o.organizationSchema.email,onChange:e=>s(a=>({...a,organizationSchema:{...a.organizationSchema,email:e}})),type:"email"})]}),t.jsx(l,{label:"Phone",value:o.organizationSchema.phone,onChange:e=>s(a=>({...a,organizationSchema:{...a.organizationSchema,phone:e}})),type:"tel"}),t.jsx(l,{label:"Logo URL",value:o.organizationSchema.logo,onChange:e=>s(a=>({...a,organizationSchema:{...a.organizationSchema,logo:e}})),type:"url"}),t.jsx(l,{label:"Social Media Links",value:o.organizationSchema.sameAs,onChange:e=>s(a=>({...a,organizationSchema:{...a.organizationSchema,sameAs:e}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}),(($=h==null?void 0:h.features)==null?void 0:$.localBusinessSchema)&&t.jsx(M.Section,{children:t.jsx(S,{title:"Local Business Schema",children:t.jsxs(m,{padding:"400",children:[t.jsx(q,{label:"Enable Local Business Schema",checked:o.localBusinessSchema.enabled,onChange:e=>s(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,enabled:e}}))}),o.localBusinessSchema.enabled&&t.jsx(m,{paddingBlockStart:"400",children:t.jsxs(x,{children:[t.jsx(l,{label:"Price Range",value:o.localBusinessSchema.priceRange,onChange:e=>s(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,priceRange:e}})),helpText:"e.g., $, $$, $$$, $$$$"}),t.jsx(l,{label:"Opening Hours",value:o.localBusinessSchema.openingHours,onChange:e=>s(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,openingHours:e}})),helpText:"e.g., Mo-Fr 09:00-18:00, Sa 10:00-16:00",multiline:2})]})})]})})}),t.jsx(M.Section,{children:t.jsx(S,{children:t.jsx(m,{padding:"400",children:t.jsxs(Z,{gap:"300",children:[t.jsx(z,{onClick:w,loading:J,primary:!0,children:"Save Metadata"}),t.jsx(z,{onClick:X,loading:F,children:"Preview Metadata"}),t.jsx(z,{onClick:W,loading:G,destructive:!0,children:"Clear Metadata"})]})})})}),k&&t.jsx(aa,{content:k,onDismiss:()=>p("")})]})}export{sa as default};
