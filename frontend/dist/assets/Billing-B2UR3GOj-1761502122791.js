import{j as e}from"./app-bridge-B-3NgS9r-1761502122791.js";import{r as s}from"./react-vendor-tAaa2TlE-1761502122791.js";import{L as h,C,a as u,I as j,o as I,T as t,d as y,e as l,g as V,D as P,B as E,M as p,x as _,j as Q}from"./polaris-CBdaQbu4-1761502122791.js";const B=[10,20,50,100];function re({shop:S}){var $,D,W;const[O,U]=s.useState(!0),[i,N]=s.useState(null),[x,L]=s.useState(null),[Y,m]=s.useState(!1),[z,b]=s.useState(!1),[H,v]=s.useState(!1),[f,k]=s.useState(""),[w,T]=s.useState(B[0]),[A,M]=s.useState(!1),[F,c]=s.useState(null),R=s.useCallback(async()=>{try{U(!0),c(null);const r=await fetch(`/api/billing/info?shop=${S}`,{headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP ${r.status}`);const a=await r.json();N(a)}catch(r){console.error("[Billing] Error fetching info:",r),c("Failed to load billing information")}finally{U(!1)}},[S]);s.useEffect(()=>{R()},[R]);const q=async r=>{var a;try{M(!0),c(null);const o=await fetch("/api/billing/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:S,plan:r,endTrial:((a=i==null?void 0:i.subscription)==null?void 0:a.inTrial)||!1})}),g=await o.json();if(!o.ok)throw new Error(g.error||"Failed to create subscription");g.confirmationUrl&&(window.top.location.href=g.confirmationUrl)}catch(o){console.error("[Billing] Subscribe error:",o),c(o.message)}finally{M(!1),m(!1)}},G=async r=>{try{M(!0),c(null);const a=await fetch("/api/billing/tokens/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:S,amount:parseFloat(r)})}),o=await a.json();if(!a.ok)throw new Error(o.error||"Failed to purchase tokens");o.confirmationUrl&&(window.top.location.href=o.confirmationUrl)}catch(a){console.error("[Billing] Purchase error:",a),c(a.message)}finally{M(!1),b(!1)}},J=r=>{const a=r*.6;return Math.floor(a/.1*1e6)};if(O)return e.jsx(e.Fragment,{children:e.jsx(h,{children:e.jsx(h.Section,{children:e.jsx(C,{children:e.jsx(u,{padding:"800",children:e.jsxs(j,{align:"center",blockAlign:"center",children:[e.jsx(I,{size:"large"}),e.jsx(t,{variant:"bodyMd",children:"Loading billing information..."})]})})})})})});const n=i==null?void 0:i.subscription,d=i==null?void 0:i.tokens,K=(i==null?void 0:i.plans)||[];return console.log("[Billing] Current plan:",n==null?void 0:n.plan,"Type:",typeof(n==null?void 0:n.plan)),e.jsxs(e.Fragment,{children:[e.jsxs(h,{children:[F&&e.jsx(h.Section,{children:e.jsx(y,{title:"Error",tone:"critical",onDismiss:()=>c(null),children:e.jsx("p",{children:F})})}),(n==null?void 0:n.inTrial)&&e.jsx(h.Section,{children:e.jsx(y,{title:"Trial Period Active",tone:"info",action:{content:"Activate Plan",onAction:()=>m(!0)},children:e.jsxs("p",{children:["Your trial ends on ",new Date(n.trialEndsAt).toLocaleDateString(),". Activate a plan to continue using all features after ",new Date(n.trialEndsAt).toLocaleDateString(),"."]})})}),e.jsx(h.Section,{children:e.jsx(C,{children:e.jsx(l,{gap:"400",children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},children:K.map(r=>{var a;return e.jsx(C,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",minHeight:"400px",gap:"12px"},children:[e.jsxs(j,{align:"space-between",blockAlign:"center",children:[e.jsx(t,{variant:"headingMd",children:r.name}),(n==null?void 0:n.plan)===r.key&&e.jsx(V,{tone:"success",children:"Current"})]}),e.jsxs(t,{variant:"heading2xl",children:["$",r.price]}),e.jsx(t,{variant:"bodySm",tone:"subdued",children:"per month"}),e.jsx(P,{}),e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Optimize up to ",e.jsx("strong",{children:((a=r.productLimit)==null?void 0:a.toLocaleString())||"N/A"})," products in up to ",e.jsx("strong",{children:r.languageLimit||1})," ",r.languageLimit===1?"language":"languages"]}),r.features&&r.features.length>0&&e.jsxs(u,{children:[e.jsx(t,{variant:"bodySm",fontWeight:"semibold",children:"Features:"}),e.jsx(l,{gap:"100",children:r.features.map((o,g)=>e.jsx(t,{variant:"bodySm",tone:"subdued",children:o.startsWith("All from")||o.startsWith("âœ“")?o:`âœ“ ${o}`},g))})]}),e.jsx("div",{style:{flexGrow:1}}),(n==null?void 0:n.plan)===r.key?e.jsx(u,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",style:{marginTop:"auto"},children:e.jsx(t,{variant:"bodySm",alignment:"center",tone:"subdued",fontWeight:"medium",children:"Current Plan"})}):e.jsx(E,{variant:"primary",fullWidth:!0,onClick:()=>{L(r),m(!0)},children:"Select Plan"})]})},r.key)})})})})}),e.jsx(h.Section,{variant:"oneThird",children:e.jsx(C,{children:e.jsxs(l,{gap:"400",children:[e.jsx(t,{variant:"headingMd",children:"Token Balance"}),e.jsx(P,{}),e.jsxs(l,{gap:"300",children:[e.jsxs(u,{children:[e.jsx(t,{variant:"heading2xl",alignment:"center",children:(($=d==null?void 0:d.balance)==null?void 0:$.toLocaleString())||0}),e.jsx(t,{variant:"bodySm",tone:"subdued",alignment:"center",children:"tokens available"}),(()=>{var a;const r=(a=n==null?void 0:n.plan)==null?void 0:a.toLowerCase().trim();return console.log("[Billing] Current plan key:",r),r==="growth extra"||r==="enterprise"?e.jsxs(t,{variant:"bodySm",tone:"subdued",alignment:"center",children:["(",r==="growth extra"?"100M":"300M"," included this cycle)"]}):null})()]}),e.jsxs(j,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:(()=>{var a;const r=(a=n==null?void 0:n.plan)==null?void 0:a.toLowerCase().trim();return r==="growth extra"||r==="enterprise"?"Additional Purchased":"Purchased"})()}),e.jsx(t,{variant:"bodySm",children:((D=d==null?void 0:d.totalPurchased)==null?void 0:D.toLocaleString())||0})]}),e.jsxs(j,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Used"}),e.jsx(t,{variant:"bodySm",children:((W=d==null?void 0:d.totalUsed)==null?void 0:W.toLocaleString())||0})]}),e.jsx(P,{}),e.jsx(E,{variant:"primary",fullWidth:!0,onClick:()=>{console.log("[Billing] Buy Tokens clicked. Plan:",n==null?void 0:n.plan,"Comparison:",(n==null?void 0:n.plan)==="starter"),(n==null?void 0:n.plan)==="starter"?(console.log("[Billing] Showing upgrade modal for Starter plan"),v(!0)):(console.log("[Billing] Showing token purchase modal"),b(!0))},children:"Buy Tokens"}),e.jsx(u,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:e.jsxs(l,{gap:"100",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"ðŸ’¡ Tokens enable AI features"}),e.jsx(t,{variant:"bodySm",tone:"subdued",children:"â™»ï¸ Never expire, roll over monthly"})]})})]})]})})})]}),e.jsx(p,{open:Y,onClose:()=>{m(!1),L(null)},title:"Confirm Plan Selection",primaryAction:{content:A?"Processing...":"Confirm",loading:A,onAction:()=>q((x==null?void 0:x.key)||(n==null?void 0:n.plan))},secondaryActions:[{content:"Cancel",onAction:()=>{m(!1),L(null)}}],children:e.jsx(p.Section,{children:e.jsxs(l,{gap:"400",children:[e.jsxs(t,{children:["You are about to subscribe to the ",e.jsx("strong",{children:(x==null?void 0:x.name)||(n==null?void 0:n.plan)})," plan."]}),(n==null?void 0:n.inTrial)&&e.jsx(y,{tone:"warning",children:e.jsx("p",{children:"This will end your trial period and start billing immediately."})})]})})}),e.jsx(p,{open:z,onClose:()=>{b(!1),k(""),T(B[0])},title:"Purchase Tokens",primaryAction:{content:A?"Processing...":"Purchase",loading:A,onAction:()=>G(f||w)},secondaryActions:[{content:"Cancel",onAction:()=>{b(!1),k(""),T(B[0])}}],children:e.jsx(p.Section,{children:e.jsxs(l,{gap:"400",children:[e.jsx(t,{variant:"headingMd",children:"Select Amount"}),e.jsx(_,{variant:"segmented",children:B.map(r=>e.jsxs(E,{pressed:w===r&&!f,onClick:()=>{T(r),k("")},children:["$",r]},r))}),e.jsx(t,{variant:"bodyMd",tone:"subdued",children:"Or enter a custom amount (multiples of $5)"}),e.jsx(Q,{type:"number",value:f,onChange:r=>{k(r),T(null)},placeholder:"Enter amount",prefix:"$",min:5,step:5,autoComplete:"off"}),e.jsx(u,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(l,{gap:"200",children:[e.jsxs(j,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",children:"Amount"}),e.jsxs(t,{variant:"bodyMd",fontWeight:"semibold",children:["$",f||w]})]}),e.jsxs(j,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",children:"Tokens"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:J(parseFloat(f||w)).toLocaleString()})]}),e.jsx(P,{}),e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Tokens never expire and roll over indefinitely"})]})}),(n==null?void 0:n.inTrial)&&e.jsx(y,{tone:"info",children:e.jsx("p",{children:"Your trial will continue after purchasing tokens."})})]})})}),e.jsx(p,{open:H,onClose:()=>v(!1),title:"Upgrade Required",primaryAction:{content:"View Plans",onAction:()=>{v(!1),window.scrollTo({top:0,behavior:"smooth"})}},secondaryActions:[{content:"Cancel",onAction:()=>v(!1)}],children:e.jsx(p.Section,{children:e.jsxs(l,{gap:"400",children:[e.jsxs(t,{variant:"bodyLg",children:["Token purchases require ",e.jsx("strong",{children:"Professional"})," plan or higher."]}),e.jsxs(t,{variant:"bodyMd",tone:"subdued",children:["Your current plan: ",e.jsx("strong",{children:"Starter"})]}),e.jsx(u,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(l,{gap:"200",children:[e.jsx(t,{variant:"headingSm",children:"Upgrade to unlock:"}),e.jsx(t,{variant:"bodyMd",children:"âœ“ Token purchases"}),e.jsx(t,{variant:"bodyMd",children:"âœ“ AI-enhanced optimization"}),e.jsx(t,{variant:"bodyMd",children:"âœ“ Store Metadata for AI Search"}),e.jsx(t,{variant:"bodyMd",children:"âœ“ More AI bot access"}),e.jsx(t,{variant:"bodyMd",children:"âœ“ Higher product limits"})]})}),e.jsx(y,{tone:"info",children:e.jsx("p",{children:"Professional plan starts at $15.99/month with up to 250 products."})})]})})})]})}export{re as default};
