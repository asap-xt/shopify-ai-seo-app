import{j as e}from"./app-bridge-BwvpC9PL-1760728613190.js";import{r as h}from"./react-vendor-tAaa2TlE-1760728613190.js";import{m as ee}from"./sessionFetch-CJepNHo3-1760728613190.js";import{L as g,C as u,a as r,T as n,d as ne,e as s,f as A,I as d,B as c,D as m,g as ae,h as O,i as ie}from"./polaris-CPn8fw4U-1760728613190.js";const te=(v,x="")=>{try{return new URLSearchParams(window.location.search).get(v)||x}catch{return x}};function ce({shop:v}){var T,W,I,$,N,R,F,V;const x=v||te("shop",""),j=h.useMemo(()=>ee(),[]),p=i=>{const o=new URLSearchParams(window.location.search),y=o.toString()?`?${o.toString()}`:"";window.location.href=`${i}${y}`},[_,D]=h.useState(!0),[a,G]=h.useState(null),[t,U]=h.useState(null),[f,q]=h.useState(null),[l,k]=h.useState(null),[b,M]=h.useState(!1),[Q,P]=h.useState(!1),[S,Y]=h.useState(!1);h.useEffect(()=>{E(),H()},[x]),h.useEffect(()=>{l&&l.autoSyncEnabled&&!l.synced&&w()},[l]);const E=async()=>{try{D(!0);const[i,o]=await Promise.all([j(`/api/dashboard/stats?shop=${x}`),j(`/api/billing/tokens/balance?shop=${x}`)]);i&&(G(i),U(i.subscription)),o&&q(o)}catch(i){console.error("[Dashboard] Error loading data:",i)}finally{D(!1)}},H=async()=>{try{const i=await j(`/api/dashboard/sync-status?shop=${x}`);i&&(k(i),P(i.autoSyncEnabled||!1))}catch(i){console.error("[Dashboard] Error loading sync status:",i)}},w=async()=>{try{M(!0);const i=await j(`/api/dashboard/sync?shop=${x}`,{method:"POST"});if(console.log("[Dashboard] Sync start response:",i),i.ok){const o=setInterval(async()=>{const y=await j(`/api/dashboard/sync-status?shop=${x}`);y&&(k(y),y.inProgress||(clearInterval(o),M(!1),E()))},2e3)}}catch(i){console.error("[Dashboard] Error syncing:",i),M(!1)}},J=async i=>{try{(await j.post(`/api/dashboard/auto-sync?shop=${x}`,{enabled:i})).ok&&(P(i),k({...l,autoSyncEnabled:i}))}catch(o){console.error("[Dashboard] Error toggling auto-sync:",o)}},z=((T=a==null?void 0:a.products)==null?void 0:T.total)>0?Math.round(a.products.optimized/a.products.total*100):0,C=((W=a==null?void 0:a.collections)==null?void 0:W.total)>0?Math.round(a.collections.optimized/a.collections.total*100):0,L=["growth","growth_extra","enterprise"].includes(t==null?void 0:t.plan),K=["professional","growth","growth_extra","enterprise"].includes(t==null?void 0:t.plan),X=(t==null?void 0:t.plan)==="enterprise",Z=["growth_extra","enterprise"].includes(t==null?void 0:t.plan);if(_)return e.jsx(g,{children:e.jsx(g.Section,{children:e.jsx(u,{children:e.jsx(r,{padding:"400",children:e.jsx(n,{children:"Loading dashboard..."})})})})});const B=!(l!=null&&l.synced);return e.jsxs(g,{children:[e.jsx(g.Section,{children:e.jsx(n,{variant:"headingLg",as:"h1",children:"Store Overview"})}),B&&e.jsx(g.Section,{children:e.jsx(ne,{title:"Sync your store",tone:"info",action:{content:b?"Syncing...":"Sync Now",onAction:w,loading:b},children:e.jsxs(s,{gap:"200",children:[e.jsx(n,{children:"Sync products, collections, languages, and markets to get started with AI optimization."}),b&&e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(A,{progress:50,size:"small",tone:"highlight"}),e.jsx(r,{paddingBlockStart:"100",children:e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Fetching store data..."})})]})]})})}),!B&&l&&e.jsx(g.Section,{children:e.jsx(u,{children:e.jsxs(s,{gap:"300",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"Store Sync"}),e.jsx(r,{paddingBlockStart:"050",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["Last synced: ",l.lastSyncDate?new Date(l.lastSyncDate).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"]})})]}),e.jsx(c,{onClick:w,loading:b,children:"Sync Now"})]}),e.jsx(m,{}),e.jsx(ae,{label:"Auto-sync on load",checked:Q,onChange:J,helpText:"Automatically sync store data when you open the dashboard"})]})})}),e.jsx(g.Section,{children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"16px"},children:[e.jsx(u,{children:e.jsxs(s,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Products"}),e.jsxs(s,{gap:"200",children:[e.jsxs(d,{align:"space-between",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Total"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:((I=a==null?void 0:a.products)==null?void 0:I.total)||0})]}),e.jsxs(d,{align:"space-between",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Optimized"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:(($=a==null?void 0:a.products)==null?void 0:$.optimized)||0})]}),e.jsx(m,{}),e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(A,{progress:z,size:"small",tone:z===100?"success":"primary"}),e.jsx(r,{paddingBlockStart:"100",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[z,"% optimized"]})})]})]})]})}),L&&e.jsx(u,{children:e.jsxs(s,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Collections"}),e.jsxs(s,{gap:"200",children:[e.jsxs(d,{align:"space-between",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Total"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:((N=a==null?void 0:a.collections)==null?void 0:N.total)||0})]}),e.jsxs(d,{align:"space-between",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Optimized"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:((R=a==null?void 0:a.collections)==null?void 0:R.optimized)||0})]}),e.jsx(m,{}),e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(A,{progress:C,size:"small",tone:C===100?"success":"primary"}),e.jsx(r,{paddingBlockStart:"100",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[C,"% optimized"]})})]})]})]})}),e.jsx(u,{children:e.jsxs(s,{gap:"400",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{variant:"headingMd",children:"Languages"}),(a==null?void 0:a.storeMarkets)&&a.storeMarkets.length>0&&e.jsxs(O,{tone:"info",children:[a.storeMarkets.length," markets"]})]}),e.jsx(s,{gap:"200",children:a!=null&&a.languages&&a.languages.length>0?e.jsxs(e.Fragment,{children:[a.languages.slice(0,3).map((i,o)=>e.jsxs(d,{align:"space-between",children:[e.jsxs(n,{variant:"bodyMd",tone:"subdued",children:[i.name||i.code," ",i.primary&&"â˜…"]}),e.jsx(O,{tone:i.optimizedCount>0?"success":"subdued",children:i.optimizedCount||0})]},o)),a.languages.length>3&&e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["+",a.languages.length-3," more..."]})]}):e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"No language data"})}),(a==null?void 0:a.storeMarkets)&&a.storeMarkets.length>0&&e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(m,{}),e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["Markets: ",a.storeMarkets.slice(0,2).map(i=>i.name).join(", "),a.storeMarkets.length>2?` +${a.storeMarkets.length-2}`:""]})})]})]})})]})}),e.jsx(g.Section,{children:e.jsxs(d,{gap:"400",wrap:!0,children:[e.jsx("div",{style:{flex:"1",minWidth:"300px"},children:e.jsx(u,{children:e.jsxs(s,{gap:"300",children:[e.jsx(n,{variant:"headingMd",children:"Last Optimization"}),e.jsx(n,{variant:"bodyLg",fontWeight:"semibold",children:a!=null&&a.lastOptimization?new Date(a.lastOptimization).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}),e.jsx(c,{onClick:()=>p("/ai-seo/products"),children:"Optimize Now"})]})})}),e.jsx("div",{style:{flex:"1",minWidth:"300px"},children:e.jsx(u,{children:e.jsxs(s,{gap:"300",children:[e.jsx(n,{variant:"headingMd",children:"Token Balance"}),e.jsxs(n,{variant:"bodyLg",fontWeight:"semibold",children:[((F=f==null?void 0:f.balance)==null?void 0:F.toLocaleString())||0," tokens"]}),((t==null?void 0:t.plan)==="growth_extra"||(t==null?void 0:t.plan)==="enterprise")&&e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[(t==null?void 0:t.plan)==="growth_extra"?"100M":"300M"," included monthly"]}),e.jsx(c,{variant:"primary",onClick:()=>p("/billing"),children:"Manage Tokens"})]})})})]})}),e.jsx(g.Section,{children:e.jsx(u,{children:e.jsxs(s,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Quick Actions"}),e.jsxs(d,{gap:"300",wrap:!0,children:[e.jsx(c,{onClick:()=>p("/ai-seo/products"),children:"Optimize Products"}),L&&e.jsx(c,{onClick:()=>p("/ai-seo/collections"),children:"Optimize Collections"}),!B&&e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:()=>p("/ai-seo/sitemap"),children:Z?"Regenerate Sitemap":"View Sitemap"}),X&&e.jsx(c,{onClick:()=>p("/ai-seo/schema-data"),children:"Regenerate Schemas"})]}),K&&e.jsx(c,{onClick:()=>p("/ai-seo/store-metadata"),children:"Store Info"})]})]})})}),e.jsx(g.Section,{children:e.jsx(u,{children:e.jsxs(s,{gap:"300",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(n,{variant:"headingMd",children:"Current Plan"}),e.jsx(r,{paddingBlockStart:"100",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["$",(t==null?void 0:t.price)||0,"/month"]})})]}),e.jsx(O,{tone:"info",size:"large",children:((V=t==null?void 0:t.plan)==null?void 0:V.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsx(c,{onClick:()=>p("/billing"),children:"View Plans & Billing"})]})})}),e.jsx(g.Section,{children:e.jsx(u,{children:e.jsxs(s,{gap:"300",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{variant:"headingMd",children:"Getting Started"}),e.jsxs(c,{onClick:()=>Y(!S),disclosure:S?"up":"down",children:[S?"Hide":"Show"," Guide"]})]}),e.jsx(ie,{open:S,id:"onboarding-collapsible",transition:{duration:"200ms",timingFunction:"ease-in-out"},children:e.jsx(r,{paddingBlockStart:"300",children:e.jsxs(s,{gap:"400",children:[e.jsx(m,{}),e.jsxs(s,{gap:"300",children:[e.jsx(n,{variant:"headingMd",as:"h3",children:"Quick Start Guide"}),e.jsxs(s,{gap:"200",children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"1. Sync Your Store"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:'Click "Sync Now" to fetch your products, collections, and languages from Shopify. This is required before you can start optimizing.'}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"2. Choose a Plan"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Visit Plans & Billing to select the plan that fits your store size. Each plan includes different limits for products, languages, and features."}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"3. Optimize Your Products"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:'Go to "Search Optimization for AI" â†’ Products tab. Select products and click "AI Enhance" to generate SEO-optimized titles, descriptions, and metadata.'}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"4. Generate AI Sitemap"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Navigate to Sitemap tab and generate your AI-optimized sitemap. This helps AI search engines discover and index your products."}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"5. Monitor & Improve"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Return to Dashboard regularly to track optimization progress and token usage. Enable auto-sync to keep your data fresh."})]})]}),e.jsx(m,{}),e.jsxs(s,{gap:"200",children:[e.jsx(n,{variant:"headingMd",as:"h3",children:"Video Tutorial"}),e.jsx(r,{padding:"400",background:"bg-surface-secondary",borderRadius:"200",children:e.jsxs(s,{gap:"200",inlineAlign:"center",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",alignment:"center",children:"Video tutorial coming soon"}),e.jsx(n,{variant:"bodySm",tone:"subdued",alignment:"center",children:"[Embedded video will be added here]"})]})})]}),e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(d,{gap:"200",children:[e.jsx(c,{variant:"primary",onClick:()=>p("/ai-seo/products"),children:"Start Optimizing"}),e.jsx(c,{onClick:()=>p("/billing"),children:"View Plans"})]})})]})})})]})})})]})}export{ce as default};
