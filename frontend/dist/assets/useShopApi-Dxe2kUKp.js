import{r as t}from"./react-vendor-BLtYaay5.js";import{a as e}from"./app-bridge-DUY42B6P.js";function a(){const t=new URLSearchParams(window.location.search),a=t.get("shop")||void 0,s=t.get("id_token")||void 0;return async function(t,{method:o="GET",params:r,body:n,headers:c}={}){const i=new URL(t,window.location.origin),h=new URLSearchParams(r||{}),p=/\/shop\/[^/?]+/.test(i.pathname),u=i.searchParams.has("shop")||h.has("shop");p||u||!a||h.set("shop",a),[...h.keys()].length&&(i.search=(i.search?i.search+"&":"?")+h.toString());const d={...c};if(s&&(d.Authorization=`Bearer ${s}`),"GET"===o||d["Content-Type"]||(d["Content-Type"]="application/json"),!s)try{const t=await e.getSessionToken();t&&(d.Authorization=`Bearer ${t}`)}catch(w){}const m=await fetch(i.toString(),{method:o,headers:d,body:"GET"!==o&&n?JSON.stringify(n):void 0});if(!m.ok){let t;if((m.headers.get("content-type")||"").includes("application/json"))try{t=await m.json()}catch{t={error:await m.text().catch(()=>m.statusText)}}else t={error:await m.text().catch(()=>m.statusText)};if(402===m.status&&t){const e=new Error(t.error||t.message||"Payment Required");throw e.status=402,Object.assign(e,t),e}const e=new Error(t.error||t.message||m.statusText);throw e.status=m.status,e}return(m.headers.get("content-type")||"").includes("application/json")?m.json():m.text()}}function s(){const e=((t,e="")=>{try{return new URLSearchParams(window.location.search).get(t)||e}catch{return e}})("shop","");return{api:t.useMemo(()=>async(t,s={})=>{const o=new URL(t,window.location.origin);return!o.searchParams.has("shop")&&e&&o.searchParams.set("shop",e),"POST"===s.method||s.body?async function(t,e,s={}){return a()(t,{method:"POST",body:e,...s})}(o.pathname+o.search,s.body||{},s):async function(t,e={}){return a()(t,e)}(o.pathname+o.search,s)},[e]),shop:e}}export{s as u};
