import{j as e}from"./app-bridge-Kj-wCZq6-1759210997866.js";import{r as u}from"./react-vendor-tAaa2TlE-1759210997866.js";import{m as Da}from"./index-Bjp30MRE-1759210997866.js";import{C as M,a as c,T as S,h as xa,L as j,B as T,s as b,i as o,D as Pa,f as ya,I as Ma,t as $a,k as Oa}from"./polaris-B3K3dy5t-1759210997866.js";const La=(B,d="")=>{try{return new URLSearchParams(window.location.search).get(B)||d}catch{return d}};function qa({shop:B}){var N,_,U,q,F;const d=B||La("shop",""),[ja,R]=u.useState(!1),[ba,D]=u.useState(!1),[P,f]=u.useState(""),[g,Ca]=u.useState(null),z=u.useMemo(()=>Da({}),[]),[va,$]=u.useState(!1),[wa,O]=u.useState(!1),[x,za]=u.useState({title:"",description:""}),[Ta,L]=u.useState(!1),[i,n]=u.useState({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}});u.useEffect(()=>{d&&I()},[d,z]);async function I(){var t,a,l,s,C,p,m,J;R(!0);try{const y=`/api/store/generate?shop=${encodeURIComponent(d)}`,h=await z(y,{headers:{"X-Shop":d}});Ca(h),za({title:((t=h.shopifyDefaults)==null?void 0:t.title)||"",description:((a=h.shopifyDefaults)==null?void 0:a.description)||""});const r=h.existingMetadata||{},A=((s=(l=r.seo_metadata)==null?void 0:l.value)==null?void 0:s.title)||"",E=((p=(C=r.seo_metadata)==null?void 0:C.value)==null?void 0:p.metaDescription)||"",Ea=A&&A!==((m=h.shopifyDefaults)==null?void 0:m.title),Ra=E&&E!==((J=h.shopifyDefaults)==null?void 0:J.description);L(Ea||Ra),n(v=>{var V,H,G,W,X,K,Y,Q,Z,aa,ea,ta,ia,na,sa,oa,la,ra,ca,da,ha,ua,ga,pa,ma,Sa,fa;return{...v,seo:{...v.seo,title:A,metaDescription:E,keywords:Array.isArray((H=(V=r.seo_metadata)==null?void 0:V.value)==null?void 0:H.keywords)?r.seo_metadata.value.keywords.join(", "):((W=(G=r.seo_metadata)==null?void 0:G.value)==null?void 0:W.keywords)||""},aiMetadata:{...v.aiMetadata,...((X=r.ai_metadata)==null?void 0:X.value)||{},languages:((Q=(Y=(K=r.ai_metadata)==null?void 0:K.value)==null?void 0:Y.languages)==null?void 0:Q.length)>0?r.ai_metadata.value.languages:(((Z=h.shopInfo)==null?void 0:Z.locales)||[]).filter(w=>w.published).map(w=>w.locale),supportedCurrencies:((ta=(ea=(aa=r.ai_metadata)==null?void 0:aa.value)==null?void 0:ea.supportedCurrencies)==null?void 0:ta.length)>0?r.ai_metadata.value.supportedCurrencies:((ia=h.shopInfo)==null?void 0:ia.currencies)||["EUR"],shippingRegions:((oa=(sa=(na=r.ai_metadata)==null?void 0:na.value)==null?void 0:sa.shippingRegions)==null?void 0:oa.length)>0?r.ai_metadata.value.shippingRegions:(((la=h.shopInfo)==null?void 0:la.markets)||[]).map(w=>w.name)},organizationSchema:{...v.organizationSchema,...((ra=r.organization_schema)==null?void 0:ra.value)||{},enabled:((da=(ca=r.organization_schema)==null?void 0:ca.value)==null?void 0:da.enabled)===!0,name:((ua=(ha=r.organization_schema)==null?void 0:ha.value)==null?void 0:ua.name)||((ga=h.shopInfo)==null?void 0:ga.name)||"",email:((ma=(pa=r.organization_schema)==null?void 0:pa.value)==null?void 0:ma.email)||((Sa=h.shopInfo)==null?void 0:Sa.email)||""},localBusinessSchema:((fa=r.local_business_schema)==null?void 0:fa.value)||v.localBusinessSchema}})}catch(y){console.error("[StoreMeta] Load error:",y),f(`Load failed: ${(y==null?void 0:y.message)||"Unknown error"}`)}finally{R(!1)}}function Ba(){n(t=>({...t,seo:{...t.seo,title:"",metaDescription:""}})),L(!1),f("Synced with Shopify store settings")}async function k(){D(!0);try{const t=`/api/store/apply?shop=${encodeURIComponent(d)}`;console.log("[StoreMeta] SAVE",t);const a=await z(t,{method:"POST",headers:{"X-Shop":d},body:{metadata:i,options:{updateSeo:!0,updateAiMetadata:!0,updateOrganization:i.organizationSchema.enabled,updateLocalBusiness:i.localBusinessSchema.enabled}}});console.log("[StoreMeta] SAVE ok",{url:t,ok:a==null?void 0:a.ok}),f("Metadata saved successfully!"),await I()}catch(t){console.error("[StoreMeta] SAVE error",(t==null?void 0:t.debug)||t,t),f(`Save failed: ${(t==null?void 0:t.message)||"Unknown error"}`)}finally{D(!1)}}async function ka(){var t;$(!0);try{await k();const l=await z("/graphql",{method:"POST",headers:{"X-Shop":d},body:{query:`
        query GetStoreMetadata($shop: String!) {
          storeMetadata(shop: $shop) {
            shopName
            description
            seoMetadata
            aiMetadata
            organizationSchema
            localBusinessSchema
          }
        }
      `,variables:{shop:d}}});if(l.error)throw new Error(l.error);const s=(t=l.data)==null?void 0:t.storeMetadata;if(s){const C=window.open("","_blank");console.log("[STORE-METADATA] Raw preview data:",s),console.log("[STORE-METADATA] seoMetadata raw:",s.seoMetadata),console.log("[STORE-METADATA] aiMetadata raw:",s.aiMetadata),console.log("[STORE-METADATA] organizationSchema raw:",s.organizationSchema);const p={shopName:s.shopName,description:s.description,seoMetadata:s.seoMetadata?(()=>{try{return JSON.parse(s.seoMetadata)}catch(m){return console.error("Error parsing seoMetadata:",m),s.seoMetadata}})():null,aiMetadata:s.aiMetadata?(()=>{try{return JSON.parse(s.aiMetadata)}catch(m){return console.error("Error parsing aiMetadata:",m),s.aiMetadata}})():null,organizationSchema:s.organizationSchema?(()=>{try{return JSON.parse(s.organizationSchema)}catch(m){return console.error("Error parsing organizationSchema:",m),s.organizationSchema}})():null,localBusinessSchema:s.localBusinessSchema?(()=>{try{return JSON.parse(s.localBusinessSchema)}catch(m){return console.error("Error parsing localBusinessSchema:",m),s.localBusinessSchema}})():null};C.document.write(`
          <html>
            <head>
              <title>Store Metadata Preview</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
                h1 { color: #333; }
                .section { margin: 20px 0; }
                .section h2 { color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
              </style>
            </head>
            <body>
              <h1>Store Metadata Preview</h1>
              <div class="section">
                <h2>Basic Info</h2>
                <p><strong>Shop Name:</strong> ${p.shopName||"Not set"}</p>
                <p><strong>Description:</strong> ${p.description||"Not set"}</p>
              </div>
              
              <div class="section">
                <h2>SEO Metadata</h2>
                <pre>${JSON.stringify(p.seoMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>AI Metadata</h2>
                <pre>${JSON.stringify(p.aiMetadata,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Organization Schema</h2>
                <pre>${JSON.stringify(p.organizationSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Local Business Schema</h2>
                <pre>${JSON.stringify(p.localBusinessSchema,null,2)}</pre>
              </div>
              
              <div class="section">
                <h2>Raw Data</h2>
                <pre>${JSON.stringify(p,null,2)}</pre>
              </div>
            </body>
          </html>
        `),C.document.close()}else throw new Error("No preview data available")}catch(a){f(`Preview failed: ${(a==null?void 0:a.message)||"Unknown error"}`)}finally{$(!1)}}async function Aa(){O(!0);try{n({seo:{title:"",metaDescription:"",keywords:""},aiMetadata:{businessType:"",targetAudience:"",uniqueSellingPoints:"",brandVoice:"",primaryCategories:"",shippingInfo:"",returnPolicy:"",languages:[],supportedCurrencies:[],shippingRegions:[],culturalConsiderations:""},organizationSchema:{enabled:!1,name:"",email:"",phone:"",logo:"",sameAs:""},localBusinessSchema:{enabled:!1,priceRange:"",openingHours:""}}),await k(),f("Metadata cleared successfully!")}catch(t){f(`Clear failed: ${(t==null?void 0:t.message)||"Unknown error"}`)}finally{O(!1)}}return ja&&!g?e.jsx(M,{children:e.jsx(c,{padding:"400",children:e.jsx(S,{children:"Loading store data..."})})}):(g==null?void 0:g.plan)==="Starter"?e.jsx(xa,{status:"warning",children:e.jsx(S,{children:"Store metadata features are available starting from the Professional plan."})}):e.jsxs(j,{children:[e.jsx(j.Section,{children:e.jsx(M,{title:"Basic Store Information",children:e.jsxs(c,{padding:"400",children:[e.jsx(xa,{tone:"info",children:e.jsxs(c,{children:[e.jsx(S,{variant:"bodyMd",fontWeight:"semibold",children:"From Shopify Settings:"}),e.jsxs(c,{paddingBlockStart:"200",children:[e.jsxs(S,{variant:"bodySm",tone:"subdued",children:["Store name: ",e.jsx(S,{as:"span",fontWeight:"medium",children:x.title||"Not set"})]}),e.jsxs(S,{variant:"bodySm",tone:"subdued",children:["Meta description: ",e.jsx(S,{as:"span",fontWeight:"medium",children:x.description?x.description.substring(0,100)+(x.description.length>100?"...":""):"Not set"})]})]}),Ta&&e.jsx(c,{paddingBlockStart:"300",children:e.jsx(T,{size:"slim",onClick:Ba,children:"Sync from Shopify"})})]})}),e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(b,{children:[e.jsx(o,{label:"Store Title (for AI/SEO)",value:i.seo.title,onChange:t=>n(a=>({...a,seo:{...a.seo,title:t}})),placeholder:x.title,helpText:"Leave empty to use Shopify store name",maxLength:100}),e.jsx(o,{label:"Store Description (for AI/SEO)",value:i.seo.metaDescription,onChange:t=>n(a=>({...a,seo:{...a.seo,metaDescription:t}})),placeholder:x.description,helpText:"Leave empty to use Shopify meta description",maxLength:300,multiline:3}),e.jsx(o,{label:"Keywords",value:i.seo.keywords,onChange:t=>n(a=>({...a,seo:{...a.seo,keywords:t}})),helpText:"Comma-separated keywords (optional)"})]})})]})})}),e.jsx(j.Section,{children:e.jsx(M,{title:"AI Metadata",children:e.jsx(c,{padding:"400",children:e.jsxs(b,{children:[e.jsxs(b.Group,{children:[e.jsx(o,{label:"Business Type",value:i.aiMetadata.businessType,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,businessType:t}})),placeholder:"e.g., Fashion Retailer, Electronics Store",helpText:"Max 3 words"}),e.jsx(o,{label:"Target Audience",value:i.aiMetadata.targetAudience,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,targetAudience:t}})),placeholder:"e.g., Young professionals, Parents"})]}),e.jsx(o,{label:"Unique Selling Points",value:i.aiMetadata.uniqueSellingPoints,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,uniqueSellingPoints:t}})),helpText:"Comma-separated list",multiline:2}),e.jsx(o,{label:"Brand Voice",value:i.aiMetadata.brandVoice,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,brandVoice:t}})),placeholder:"e.g., Professional, Friendly, Casual"}),e.jsx(o,{label:"Primary Categories",value:i.aiMetadata.primaryCategories,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,primaryCategories:t}})),helpText:"Main product categories, comma-separated"}),e.jsx(o,{label:"Shipping Information",value:i.aiMetadata.shippingInfo,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,shippingInfo:t}})),helpText:"Shipping costs, delivery times, free shipping thresholds (e.g., Free shipping over $50, 2-3 business days)",multiline:2}),e.jsx(o,{label:"Return Policy",value:i.aiMetadata.returnPolicy,onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,returnPolicy:t}})),multiline:2}),e.jsx(Pa,{}),e.jsx(S,{variant:"headingMd",as:"h3",children:"Languages & Markets"}),e.jsx(S,{variant:"bodyMd",color:"subdued",children:"Automatically populated from Shopify settings"}),e.jsx(o,{label:"Supported Languages",value:((N=i.aiMetadata.languages)==null?void 0:N.join(", "))||"",onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,languages:t.split(",").map(l=>l.trim()).filter(l=>l)}})),helpText:"Comma-separated language codes (e.g., en, de, es, fr)",multiline:2}),e.jsx(o,{label:"Supported Currencies",value:((_=i.aiMetadata.supportedCurrencies)==null?void 0:_.join(", "))||"",onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,supportedCurrencies:t.split(",").map(l=>l.trim()).filter(l=>l)}})),helpText:"Comma-separated currency codes (e.g., EUR, USD, GBP)"}),e.jsx(o,{label:"Shipping Regions",value:((U=i.aiMetadata.shippingRegions)==null?void 0:U.join(", "))||"",onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,shippingRegions:t.split(",").map(l=>l.trim()).filter(l=>l)}})),helpText:"Comma-separated regions (e.g., EU, USA, UK, Canada)",multiline:2}),e.jsx(o,{label:"Cultural Considerations",value:i.aiMetadata.culturalConsiderations||"",onChange:t=>n(a=>({...a,aiMetadata:{...a.aiMetadata,culturalConsiderations:t}})),helpText:"Cultural context for AI models (e.g., European market focus, Local customs)",multiline:2})]})})})}),((q=g==null?void 0:g.features)==null?void 0:q.organizationSchema)&&e.jsx(j.Section,{children:e.jsx(M,{title:"Organization Schema",children:e.jsxs(c,{padding:"400",children:[e.jsx(ya,{label:"Enable Organization Schema",checked:i.organizationSchema.enabled,onChange:t=>n(a=>({...a,organizationSchema:{...a.organizationSchema,enabled:t}}))}),i.organizationSchema.enabled&&e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(b,{children:[e.jsxs(b.Group,{children:[e.jsx(o,{label:"Organization Name",value:i.organizationSchema.name,onChange:t=>n(a=>({...a,organizationSchema:{...a.organizationSchema,name:t}}))}),e.jsx(o,{label:"Contact Email",value:i.organizationSchema.email,onChange:t=>n(a=>({...a,organizationSchema:{...a.organizationSchema,email:t}})),type:"email"})]}),e.jsx(o,{label:"Phone",value:i.organizationSchema.phone,onChange:t=>n(a=>({...a,organizationSchema:{...a.organizationSchema,phone:t}})),type:"tel"}),e.jsx(o,{label:"Logo URL",value:i.organizationSchema.logo,onChange:t=>n(a=>({...a,organizationSchema:{...a.organizationSchema,logo:t}})),type:"url"}),e.jsx(o,{label:"Social Media Links",value:i.organizationSchema.sameAs,onChange:t=>n(a=>({...a,organizationSchema:{...a.organizationSchema,sameAs:t}})),helpText:"Comma-separated URLs",multiline:2})]})})]})})}),((F=g==null?void 0:g.features)==null?void 0:F.localBusinessSchema)&&e.jsx(j.Section,{children:e.jsx(M,{title:"Local Business Schema",children:e.jsxs(c,{padding:"400",children:[e.jsxs(Ma,{align:"start",gap:"200",children:[e.jsx(ya,{label:"Enable Local Business Schema",checked:i.localBusinessSchema.enabled,onChange:t=>n(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,enabled:t}}))}),e.jsx($a,{content:"Optional - only enable if you have physical stores/locations",children:e.jsx(S,{variant:"bodyMd",color:"subdued",children:"ℹ️"})})]}),i.localBusinessSchema.enabled&&e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(b,{children:[e.jsx(o,{label:"Price Range",value:i.localBusinessSchema.priceRange,onChange:t=>n(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,priceRange:t}})),helpText:"e.g., $, $$, $$$, $$$$"}),e.jsx(o,{label:"Opening Hours",value:i.localBusinessSchema.openingHours,onChange:t=>n(a=>({...a,localBusinessSchema:{...a.localBusinessSchema,openingHours:t}})),helpText:"e.g., Mo-Fr 09:00-18:00, Sa 10:00-16:00",multiline:2})]})})]})})}),e.jsx(j.Section,{children:e.jsx(M,{children:e.jsx(c,{padding:"400",children:e.jsxs(Ma,{gap:"300",children:[e.jsx(T,{onClick:k,loading:ba,primary:!0,children:"Save Metadata"}),e.jsx(T,{onClick:ka,loading:va,children:"Preview Metadata"}),e.jsx(T,{onClick:Aa,loading:wa,destructive:!0,children:"Clear Metadata"})]})})})}),P&&e.jsx(Oa,{content:P,onDismiss:()=>f("")})]})}export{qa as default};
