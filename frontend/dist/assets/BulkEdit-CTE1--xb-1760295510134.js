import{j as e}from"./app-bridge-eFHTPypM-1760295510134.js";import{r as a}from"./react-vendor-tAaa2TlE-1760295510134.js";import{u as $t}from"./index-By3QHWvR-1760295510134.js";import{U as Rt,I as Ft}from"./InsufficientTokensModal-B6fC4J8U-1760295510134.js";import{M as y,d as T,T as o,e as Xe,a as d,I as S,f as be,B as L,D as qt,g as V,C as Ze,h as et,i as Ht,S as Gt,P as we,j as Ae,R as _t,k as Vt,l as tt,m as Qt,E as Yt}from"./polaris-JJLT7aFE-1760295510134.js";const Kt=(j,h="")=>{try{return new URLSearchParams(window.location.search).get(j)||h}catch{return h}},ie=j=>{if(!j)return j;const h=String(j).trim();return h.startsWith("gid://")?h:`gid://shopify/Product/${h}`},Nt=j=>{if(!j)return"";const h=String(j).match(/\/(\d+)$/);return h?h[1]:j},R=j=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(j==null?void 0:j.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(j==null?void 0:j.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}};function ns({shop:j}){const{api:h,shop:st}=$t(),c=j||st||Kt("shop","");a.useEffect(()=>{},[c,h]);const[C,H]=a.useState([]),[Z,le]=a.useState(!1),[nt,Ue]=a.useState(1),[at,Pe]=a.useState(!0),[G,We]=a.useState(0),[m,ee]=a.useState([]),[v,ce]=a.useState(!1),[_,$e]=a.useState(""),[M,de]=a.useState("all"),[z,te]=a.useState(""),[ue,Jt]=a.useState("createdAt"),[Q,rt]=a.useState("desc"),[D,he]=a.useState([]),[ot,it]=a.useState([]),[Re,ve]=a.useState(!1),[Fe,Ce]=a.useState(!1),[qe,Ie]=a.useState(!1),[He,ke]=a.useState(!1),[lt,ct]=a.useState(""),[dt,ut]=a.useState([]),[F,pe]=a.useState([]),[O,Ge]=a.useState([]),[Le,Y]=a.useState(!1),[ge,U]=a.useState({current:0,total:0,percent:0}),[_e,K]=a.useState(""),[me,se]=a.useState([]),[ne,Ve]=a.useState({}),[ht,ze]=a.useState(!1),[pt,fe]=a.useState(!1),[gt,ae]=a.useState(!1),[W,re]=a.useState([]),[mt,xe]=a.useState(!1),[Qe,b]=a.useState(""),[Oe,Ye]=a.useState(!1),[w,N]=a.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[I,ft]=a.useState(null),[xt,Se]=a.useState(!1),[je,St]=a.useState(localStorage.getItem("hasVisitedProducts")==="true"),[jt,Me]=a.useState(!1),[yt,Ke]=a.useState(!1),[J,Ee]=a.useState(null),[bt,wt]=a.useState("starter");a.useEffect(()=>{if(!c)return;h("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          modelsSuggested
        }
      }
    `,variables:{shop:c}})}).then(s=>{var u,l,i;if((u=s==null?void 0:s.errors)!=null&&u.length)throw new Error(((l=s.errors[0])==null?void 0:l.message)||"GraphQL error");const n=(i=s==null?void 0:s.data)==null?void 0:i.plansMe,p=(n==null?void 0:n.modelsSuggested)||["anthropic/claude-3.5-sonnet"];ut(p.map(r=>({label:r,value:r}))),ct(p[0]),ft((n==null?void 0:n.plan)||"starter")}).catch(s=>console.error("[BULK-EDIT] GraphQL plansMe failed:",s))},[c,h]),a.useEffect(()=>{if(!c)return;const t=new Promise((s,n)=>{setTimeout(()=>n(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([h(`/api/languages/shop/${c}`),t]).then(s=>{const n=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];Ge(n.includes("en")?n:["en",...n])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),Ge(["en"])})},[c,h]),a.useEffect(()=>{c&&h("/api/products/tags/list",{shop:c}).then(t=>it((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[c,h]);const q=a.useCallback(async(t=1,s=!1,n=null)=>{var p,u,l;le(!0);try{const i=new URLSearchParams({shop:c,page:t,limit:50,...M!=="all"&&{optimized:M},..._&&{search:_},...z&&{languageFilter:z},...D.length>0&&{tags:D.join(",")},sortBy:ue,sortOrder:Q,...n&&{_t:n}}),r=await h(`/api/products/list?${i}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((p=r.products)==null?void 0:p.length)>0,H(s?f=>[...f,...r.products]:r.products||[]),Ue(t),Pe(((u=r.pagination)==null?void 0:u.hasNext)||!1),We(((l=r.pagination)==null?void 0:l.total)||0)}catch(i){H(s?C:[]),Pe(!1),b(`Error loading products: ${i.message}`)}finally{le(!1)}},[c,M,_,z,D,ue,Q]);a.useEffect(()=>{c&&q(1,!1,null)},[c,q,M,z,D,ue,Q]),a.useEffect(()=>{!je&&c&&(localStorage.setItem("hasVisitedProducts","true"),St(!0))},[je,c]),a.useEffect(()=>{C.length===0&&!Z&&c&&!je&&Se(!0)},[C.length,Z,c,je]);const Ne=a.useCallback(t=>{$e(t)},[]);a.useEffect(()=>{const t=setTimeout(()=>{c&&q(1,!1,null)},500);return()=>clearTimeout(t)},[_]);const At=a.useCallback(t=>{ee(t),t.length===0&&ce(!1)},[]),Je=a.useCallback(t=>{ce(t),ee(t?C.map(s=>s.id):[])},[C]),Pt=()=>{if(m.length===0&&!v){b("Please select products first");return}fe(!0)},vt=()=>{if(m.length===0&&!v){b("Please select products first");return}re([]),ae(!0)},Ct=()=>{const s=C.filter(u=>m.includes(u.id)).filter(u=>{var l,i;return((i=(l=u.optimizationSummary)==null?void 0:l.optimizedLanguages)==null?void 0:i.length)>0}),n=async()=>{N({processing:!0,current:0,total:s.length,currentItem:"",results:null});const u={successful:0,failed:0,skipped:0};for(let l=0;l<s.length;l++){const i=s[l];N(r=>({...r,current:l,currentItem:i.title}));try{const r=await h("/ai-enhance/product",{method:"POST",shop:c,body:{shop:c,productId:i.gid||ie(i.id),languages:i.optimizationSummary.optimizedLanguages}});if(r.results&&r.results.length>0){const f={shop:c,productId:i.gid||ie(i.id),results:r.results.filter(x=>x.bullets&&x.faq).map(x=>({language:x.language,seo:{...x.updatedSeo,bullets:x.bullets||[],faq:x.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},k=await h("/api/seo/apply-multi",{method:"POST",shop:c,body:f});u.successful++}else u.failed++}catch(r){if(console.error("Enhancement error:",r),r.status===402||r.requiresPurchase||r.trialRestriction){N({processing:!1,current:0,total:0,currentItem:"",results:null}),Ee(r),wt(r.currentPlan||I||"starter"),r.trialRestriction?Me(!0):Ke(!0);return}u.failed++}N(r=>({...r,current:l+1}))}N(l=>({...l,processing:!1,results:u})),b(`AI enhancement complete! ${u.successful} products enhanced.`)},p=()=>{Ye(!1),N({processing:!1,current:0,total:0,currentItem:"",results:null}),w.results&&w.results.successful>0&&q(1,!1,null)};return!w.processing&&!w.results?e.jsx(y,{open:Oe,title:"AI Enhanced add-ons for AI Search",onClose:p,primaryAction:{content:"Start AI Enhancement",onAction:n},secondaryActions:[{content:"Cancel",onAction:p}],children:e.jsx(y.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsxs(o,{variant:"bodyMd",children:["AI enhancement will improve bullets and FAQ for ",s.length," products."]}),e.jsx(o,{variant:"bodySm",tone:"subdued",children:"Note: AI enhancement is only available for Growth Extra and Enterprise plans."})]})})}):w.processing?e.jsx(y,{open:Oe,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(y.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsxs(o,{variant:"bodyMd",children:["Processing: ",w.currentItem]}),e.jsx(Xe,{progress:w.current/w.total*100}),e.jsxs(o,{variant:"bodySm",tone:"subdued",children:[w.current," of ",w.total," products (",Math.round(w.current/w.total*100),"%)"]})]})})}):w.results!==null?e.jsx(y,{open:Oe,title:"AI Enhancement Results",onClose:p,primaryAction:{content:"Done",onAction:p},children:e.jsx(y.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsxs(S,{gap:"400",children:[e.jsxs(d,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"success",children:w.results.successful})]}),e.jsxs(d,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:w.results.failed})]}),e.jsxs(d,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"info",children:w.results.skipped})]})]}),w.results.skippedDueToPlan>0&&e.jsx(d,{paddingBlockStart:"300",children:e.jsx(o,{variant:"bodySm",tone:"subdued",children:"AI enhancement is only available for Growth Extra and Enterprise plans."})})]})})}):null},It=async()=>{var s;if(!F.length){b("Please select at least one language");return}let t=lt;(!t||!t.trim())&&(t=((s=dt[0])==null?void 0:s.value)||"anthropic/claude-3.5-sonnet"),fe(!1),Y(!0),U({current:0,total:0,percent:0}),se([]),Ve({});try{let n=[];v?n=(await h(`/api/products/list?shop=${encodeURIComponent(c)}&limit=1000&fields=id`)).products||[]:n=C.filter(g=>m.includes(g.id));const p=R(I),u=n.length;n=n.slice(0,p);const l=n.length,i=u-l;U({current:0,total:l,percent:0});const r=5,f={};for(let g=0;g<n.length;g+=r){const A=n.slice(g,Math.min(g+r,n.length)).map(async P=>{var X;K(P.title||P.handle||"Product");try{const ye=P.gid||ie(P.productId||P.id),De=((X=P.optimizationSummary)==null?void 0:X.optimizedLanguages)||[],Be=F.filter(Wt=>!De.includes(Wt));if(Be.length===0){f[P.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Ut=await h("/api/seo/generate-multi",{method:"POST",shop:c,body:{shop:c,productId:ye,model:t,languages:Be}});f[P.id]={success:!0,data:Ut,languages:Be}}catch(ye){f[P.id]={success:!1,error:ye.message},se(De=>[...De,{product:P.title,error:ye.message}])}});await Promise.all(A);const E=Math.min(g+r,n.length),oe=Math.round(E/l*100);U({current:E,total:l,percent:oe})}Ve(f),ze(!0);const k=Object.keys(f).filter(g=>f[g].success&&!f[g].skipped).length,x=Object.keys(f).filter(g=>f[g].skipped).length;let $=`Generated Optimization for AI Search for ${k} products`;x>0&&($+=` (${x} already optimised)`),i>0&&($+=` (${i} skipped due to plan limit)`),b($)}catch(n){b(`Error: ${n.message}`)}finally{Y(!1),K("")}},kt=async()=>{var t,s;Y(!0),U({current:0,total:0,percent:0});try{const n=Object.entries(ne).filter(([i,r])=>r.success&&!r.skipped),p=n.length;U({current:0,total:p,percent:0});for(let i=0;i<n.length;i++){const[r,f]=n[i],k=C.find(g=>g.id===r);if(!k)continue;K(k.title||"Product");try{const g=k.gid||ie(k.productId||k.id),B=await h("/api/seo/apply-multi",{method:"POST",shop:c,body:{shop:c,productId:g,results:f.data.results.filter(A=>A==null?void 0:A.seo).map(A=>({language:A.language,seo:A.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});B.appliedLanguages&&B.appliedLanguages.length>0&&H(A=>A.map(E=>{var oe;if(E.id===r){const P=((oe=E.optimizationSummary)==null?void 0:oe.optimizedLanguages)||[],X=[...new Set([...P,...B.appliedLanguages])];return{...E,optimizationSummary:{...E.optimizationSummary,optimizedLanguages:X,optimized:!0,lastOptimized:new Date().toISOString()}}}return E}))}catch(g){se(B=>[...B,{product:k.title,error:`Apply failed: ${g.message}`}])}const x=i+1,$=Math.round(x/p*100);U({current:x,total:p,percent:$})}b("AI Search Optimisation applied successfully!"),ze(!1),ee([]),ce(!1),await new Promise(i=>setTimeout(i,1e3)),H([]);const u=new URLSearchParams({shop:c,page:1,limit:50,...M!=="all"&&{optimized:M},..._&&{search:_},...z&&{languageFilter:z},...D.length>0&&{tags:D.join(",")},sortBy:ue,sortOrder:Q,_t:Date.now()}),l=await h(`/api/products/list?${u}`,{shop:c,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});H(l.products||[]),Ue(1),Pe(((t=l.pagination)==null?void 0:t.hasNext)||!1),We(((s=l.pagination)==null?void 0:s.total)||0)}catch(n){b(`Error applying AI Search Optimisation: ${n.message}`)}finally{Y(!1),K("")}},Lt=async()=>{var t;if(!W.length){b("Please select at least one language to delete");return}ae(!1),xe(!1),Y(!0),U({current:0,total:0,percent:0}),se([]);try{let s=[];v?s=(await h(`/api/products/list?shop=${encodeURIComponent(c)}&limit=1000&fields=id`)).products||[]:s=C.filter(l=>m.includes(l.id));const n=s.length;U({current:0,total:n,percent:0});let p=0,u=0;for(let l=0;l<s.length;l++){const i=s[l];K(i.title||i.handle||"Product");try{const k=i.gid||ie(i.productId||i.id),x=((t=i.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],$=W.filter(B=>x&&x.length>0&&x.includes(B));if($.length===0){u++;continue}const g=await h("/api/seo/delete-multi",{method:"POST",shop:c,body:{shop:c,productId:k,languages:$}});g.deletedLanguages&&g.deletedLanguages.length>0&&H(B=>B.map(A=>{var E;if(A.id===i.id){const P=(((E=A.optimizationSummary)==null?void 0:E.optimizedLanguages)||[]).filter(X=>!g.deletedLanguages.includes(X));return{...A,optimizationSummary:{...A.optimizationSummary,optimizedLanguages:P,optimized:P.length>0,lastOptimized:P.length>0?A.optimizationSummary.lastOptimized:null}}}return A})),p++,g.deletedLanguages&&g.deletedLanguages.length>0&&await h("/api/products/verify-after-delete",{method:"POST",shop:c,body:{shop:c,productIds:[k],deletedLanguages:g.deletedLanguages}})}catch(k){se(x=>[...x,{product:i.title,error:k.message}])}const r=l+1,f=Math.round(r/n*100);U({current:r,total:n,percent:f})}ee([]),ce(!1),u>0?b(`Deleted Optimization for AI Search from ${p} products (${u} had no optimisation to delete)`):b(`Deleted Optimization for AI Search from ${p} products`),setTimeout(()=>{const l=Date.now();q(1,!1,l)},500)}catch(s){b(`Error: ${s.message}`)}finally{Y(!1),K("")}},zt=t=>{var l,i;const s=t,n=Nt(s.productId||s.id),p=((l=s.optimizationSummary)==null?void 0:l.optimizedLanguages)||[],u=(i=s.images)!=null&&i[0]?e.jsx(tt,{source:s.images[0].url||s.images[0].src||s.images[0],alt:s.title,size:"small"}):s.imageUrl?e.jsx(tt,{source:s.imageUrl,alt:s.title,size:"small"}):e.jsx(d,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Qt,{id:s.id,url:"",media:u,accessibilityLabel:`View details for ${s.title}`,children:e.jsxs(S,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(d,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:s.title}),e.jsxs(o,{variant:"bodySm",tone:"subdued",children:["ID: ",n]})]}),e.jsx(d,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(S,{gap:"100",children:O.length>0?O.map(r=>{const f=p.includes(r);return e.jsx(V,{tone:f?"success":"subdued",size:"small",children:r.toUpperCase()},r)}):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),p.map(r=>e.jsx(V,{tone:"success",size:"small",children:r.toUpperCase()},r)))})}),e.jsx(d,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(V,{tone:"success",children:"Active"})})]})})},Ot=Le&&e.jsx(y,{open:Le,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(y.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsx(o,{variant:"bodyMd",children:_e?`Processing: ${_e}`:"Preparing..."}),e.jsx(Xe,{progress:ge.percent}),e.jsxs(o,{variant:"bodySm",tone:"subdued",children:[ge.current," of ",ge.total," products (",ge.percent,"%)"]})]})})}),Mt=e.jsx(y,{open:pt,title:"Select Languages",onClose:()=>{fe(!1),pe([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:It,disabled:F.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{fe(!1),pe([])}}],children:e.jsx(y.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsxs(o,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",v?"all":m.length," selected products:"]}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(S,{gap:"200",wrap:!0,children:O.map(t=>e.jsx(be,{label:t.toUpperCase(),checked:F.includes(t),onChange:s=>{pe(s?[...F,t]:F.filter(n=>n!==t))}},t))})}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(L,{plain:!0,onClick:()=>{pe(F.length===O.length?[]:[...O])},children:F.length===O.length?"Deselect all":"Select all"})}),e.jsx(o,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Et=e.jsx(y,{open:ht&&!Le,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:kt,disabled:!Object.values(ne).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>ze(!1)}],children:e.jsx(y.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsxs(S,{gap:"400",children:[e.jsxs(d,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(ne).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(d,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(ne).filter(t=>t.skipped).length})]}),e.jsxs(d,{children:[e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(o,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(ne).filter(t=>!t.success).length})]})]}),me.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(qt,{}),e.jsx(o,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(d,{maxHeight:"200px",overflowY:"scroll",children:[me.slice(0,10).map((t,s)=>e.jsxs(o,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),me.length>10&&e.jsxs(o,{variant:"bodySm",tone:"subdued",children:["... and ",me.length-10," more errors"]})]})]})]})})}),Tt=e.jsx(y,{open:gt,title:"Delete Optimization for AI Search",onClose:()=>{ae(!1),re([])},primaryAction:{content:"Continue",onAction:()=>{ae(!1),xe(!0)},disabled:W.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{ae(!1),re([])}}],children:e.jsx(y.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsxs(o,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",v?"all":m.length," selected products:"]}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(S,{gap:"200",wrap:!0,children:O.map(t=>e.jsx(be,{label:t.toUpperCase(),checked:W.includes(t),onChange:s=>{re(s?[...W,t]:W.filter(n=>n!==t))}},t))})}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(L,{plain:!0,onClick:()=>{re(W.length===O.length?[]:[...O])},children:W.length===O.length?"Deselect all":"Select all"})}),e.jsx(o,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Dt=e.jsx(y,{open:mt,title:"Confirm Deletion",onClose:()=>{xe(!1)},primaryAction:{content:"Delete",onAction:Lt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>xe(!1)}],children:e.jsx(y.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsx(o,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(d,{paddingBlock:"200",children:e.jsx(S,{gap:"100",children:W.map(t=>e.jsx(V,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(o,{variant:"bodyMd",children:["This will delete optimisation from ",v?"ALL":m.length," selected products."]}),e.jsx(o,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Te=async()=>{try{le(!0),b("Syncing products from Shopify...");const t=await h("/api/products/sync",{method:"POST",shop:c});if(t.success){const s=t.productsCount||t.synced||0;b(`✅ Synced ${s} products successfully!`),setTimeout(()=>{q(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),b(`❌ Sync failed: ${t.message}`)}finally{le(!1)}},Bt=e.jsx(Yt,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{$e(""),de("all"),te(""),he([]),q(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Te},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{children:e.jsxs(d,{padding:"400",children:[e.jsxs(T,{gap:"300",children:[I&&e.jsx(et,{tone:"info",children:e.jsxs(S,{gap:"200",align:"space-between",children:[e.jsxs(o,{children:["Your ",e.jsx("strong",{children:I})," plan includes up to"," ",e.jsx("strong",{children:R(I)})," products for SEO optimization.",G>R(I)&&e.jsxs(e.Fragment,{children:[" You have ",G," products, so only the first ",R(I)," will be processed."]})]}),(m.length>0||v)&&e.jsxs(o,{children:["Selected: ",v?Math.min(G,R(I)):m.length,"/",R(I)]})]})}),I&&(m.length>R(I)||v&&G>R(I))&&e.jsx(et,{tone:"warning",children:e.jsxs(S,{gap:"200",align:"space-between",children:[e.jsxs(o,{children:[e.jsx("strong",{children:"Plan Limit Exceeded:"})," You've selected more products than your ",I," plan allows. Only the first ",R(I)," products will be processed."]}),e.jsx(L,{size:"micro",onClick:()=>Me(!0),children:"Upgrade Plan"})]})}),e.jsxs(S,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(d,{minWidth:"400px",children:e.jsx(Ht,{label:"",placeholder:"Search by product ID, name, or details...",value:_,onChange:Ne,prefix:e.jsx(Gt,{}),clearButton:!0,onClearButtonClick:()=>Ne("")})}),e.jsx(d,{width:"320px",children:e.jsx(L,{primary:!0,onClick:Pt,disabled:m.length===0&&!v,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(S,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(L,{onClick:Te,disabled:Z,size:"medium",children:"Sync Products"}),e.jsx(d,{width:"320px",children:e.jsxs(T,{gap:"200",align:"end",children:[m.length===0&&!v||!C.filter(n=>m.includes(n.id)).some(n=>{var p,u;return((u=(p=n.optimizationSummary)==null?void 0:p.optimizedLanguages)==null?void 0:u.length)>0})?null:e.jsx(L,{onClick:()=>Ye(!0),disabled:m.length===0&&!v,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(L,{onClick:vt,disabled:m.length===0&&!v||!C.filter(n=>m.includes(n.id)).some(n=>{var p,u;return((u=(p=n.optimizationSummary)==null?void 0:p.optimizedLanguages)==null?void 0:u.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),G>0&&e.jsx(d,{paddingBlockStart:"300",children:e.jsx(be,{label:`Select all ${G} products in your store`,checked:v,onChange:Je})})]})}),e.jsx(d,{paddingBlockStart:"400",children:e.jsxs(Ze,{children:[e.jsxs(d,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(S,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(S,{gap:"200",wrap:!0,children:[e.jsx(we,{active:Re,activator:e.jsx(L,{disclosure:"down",onClick:()=>ve(!Re),removeUnderline:!0,children:e.jsxs(S,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),M!=="all"&&e.jsx(d,{onClick:t=>{t.stopPropagation(),de("all")},children:e.jsx(o,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ve(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(Ae,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[M],onChange:t=>{de(t[0]),te(""),ve(!1)}})})}),e.jsx(we,{active:Fe,activator:e.jsx(L,{disclosure:"down",onClick:()=>Ce(!Fe),removeUnderline:!0,children:e.jsxs(S,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),z&&e.jsx(d,{onClick:t=>{t.stopPropagation(),te("")},children:e.jsx(o,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Ce(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(Ae,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...O.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...O.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:z?[z]:[],onChange:t=>{te(t[0]||""),Ce(!1)}})})}),e.jsx(we,{active:qe,activator:e.jsx(L,{disclosure:"down",onClick:()=>Ie(!qe),removeUnderline:!0,children:e.jsxs(S,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),D.length>0&&e.jsx(d,{onClick:t=>{t.stopPropagation(),he([])},children:e.jsx(o,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>Ie(!1),children:e.jsxs(d,{padding:"300",minWidth:"200px",children:[e.jsx(Ae,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:ot.map(t=>({label:t,value:t})),selected:D,onChange:t=>{he(t)}}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(L,{size:"slim",onClick:()=>Ie(!1),children:"Apply"})})]})})]}),e.jsx(we,{active:He,activator:e.jsx(L,{disclosure:"down",onClick:()=>ke(!He),removeUnderline:!0,children:e.jsx(S,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:Q==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>ke(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(Ae,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[Q],onChange:t=>{rt(t[0]),ke(!1)}})})})]}),(M!=="all"||z||D.length>0)&&e.jsx(d,{paddingBlockStart:"200",children:e.jsxs(S,{gap:"100",wrap:!0,children:[M!=="all"&&e.jsx(V,{onRemove:()=>de("all"),children:M==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),z&&e.jsx(V,{onRemove:()=>te(""),children:z.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),D.map(t=>e.jsxs(V,{onRemove:()=>he(s=>s.filter(n=>n!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(d,{children:[e.jsx(d,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(S,{gap:"200",align:"start",children:[e.jsx(be,{checked:m.length===C.length&&C.length>0,onChange:Je,label:""}),e.jsxs(o,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",m.length>0&&` (${m.length} selected products)`]})]})}),e.jsx(_t,{resourceName:{singular:"product",plural:"products"},items:C,renderItem:zt,selectedItems:m,onSelectionChange:At,selectable:!0,loading:Z,totalItemsCount:G,emptyState:Bt,showHeader:!1})]}),at&&!Z&&e.jsx(d,{padding:"400",textAlign:"center",children:e.jsx(L,{onClick:()=>q(nt+1,!0,null),children:"Load more"})})]})}),Ot,Mt,Et,Tt,Dt,Ct(),e.jsx(y,{open:xt,onClose:()=>Se(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Se(!1),Te()}},secondaryActions:[{content:"Skip for now",onAction:()=>Se(!1)}],children:e.jsx(y.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsx(o,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(o,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Rt,{open:jt,onClose:()=>{Me(!1),Ee(null)},featureName:"AI Enhancement",currentPlan:bt}),J&&e.jsx(Ft,{open:yt,onClose:()=>{Ke(!1),Ee(null)},tokensRequired:J.tokensRequired,tokensAvailable:J.tokensAvailable,feature:"AI-Enhanced Products",shop:c,needsUpgrade:J.needsUpgrade,minimumPlan:J.minimumPlanForFeature,currentPlan:J.currentPlan}),Qe&&e.jsx(Vt,{content:Qe,onDismiss:()=>b("")})]})}export{ns as default};
