import{r as e,j as t}from"./react-vendor-BXVC7v0l.js";import{m as n}from"./sessionFetch-D9GLXCk5.js";import{S as s,U as l}from"./StoreMetadataBanner-_-ut6CwW.js";import{I as i,T as a,a as o}from"./TokenPurchaseModal-DozAvzCY.js";import{M as r,a as c,T as d,e as u,d as h,b as p,B as g,I as m,g as x,D as f,f as j,C as S,h as y,S as b,j as v,k as w,R as C,l as A,n as k,E as P}from"./polaris-CyaoFo5Q.js";import"./app-bridge-DUY42B6P.js";import"./vendor-Cs_VgJ2r.js";import"./index-BckCe7D9.js";function I({shop:I,globalPlan:O}){var M,E,z;const $=I||((e,t="")=>{try{return new URLSearchParams(window.location.search).get(e)||t}catch{return t}})("shop",""),L=e.useMemo(()=>n(),[]),[T,W]=e.useState([]),[R,U]=e.useState(!1),[D,N]=e.useState(0),[q,B]=e.useState([]),[_,F]=e.useState(!1),[H,J]=e.useState(""),[K,G]=e.useState(""),[Y,Z]=e.useState("all"),[Q,V]=e.useState(""),[X,ee]=e.useState([]),[te,ne]=e.useState([]),[se,le]=e.useState(!1),[ie,ae]=e.useState(!1),[oe,re]=e.useState(!1),[ce,de]=e.useState(!1),[ue,he]=e.useState("updatedAt"),[pe,ge]=e.useState("desc"),[me,xe]=e.useState(""),[fe,je]=e.useState([]),[Se,ye]=e.useState([]),[be,ve]=e.useState([]),[we,Ce]=e.useState(!1),[Ae,ke]=e.useState({current:0,total:0,percent:0}),[Pe,Ie]=e.useState(""),[Oe,Me]=e.useState([]),[Ee,ze]=e.useState(!1),[$e,Le]=e.useState(null),[Te,We]=e.useState(!1),[Re,Ue]=e.useState(""),[De,Ne]=e.useState(!1),[qe,Be]=e.useState([]),[_e,Fe]=e.useState(!1),[He,Je]=e.useState(!1),[Ke,Ge]=e.useState(!1),[Ye,Ze]=e.useState(!1),[Qe,Ve]=e.useState([]),[Xe,et]=e.useState({}),[tt,nt]=e.useState(!1),[st,lt]=e.useState(!1),[it,at]=e.useState({}),[ot,rt]=e.useState(!1),[ct,dt]=e.useState(null),[ut,ht]=e.useState(!1),[pt,gt]=e.useState(""),[mt,xt]=e.useState(!1),[ft,jt]=e.useState(!1),[St,yt]=e.useState(!1),[bt,vt]=e.useState(!1),[wt,Ct]=e.useState(!1),[At,kt]=e.useState(null),[Pt,It]=e.useState("starter"),[Ot,Mt]=e.useState(1),[Et,zt]=e.useState(!1);e.useEffect(()=>{if(O&&"object"==typeof O&&!Et&&"starter"===Pt)if(O.planKey&&""!==O.planKey){It(O.planKey);const e=O.language_limit||1;Mt(e)}else if(O.plan&&""!==O.plan){const e=O.plan.toLowerCase().replace(/\s+/g,"-");It(e);const t=O.language_limit||1;Mt(t)}},[O,Pt,Et]);const[$t,Lt]=e.useState({processing:!1,current:0,total:0,currentItem:"",results:null});e.useEffect(()=>{if(!$)return;L("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n      query PlansMe($shop:String!) {\n        plansMe(shop:$shop) {\n          plan\n          planKey\n          modelsSuggested\n          language_limit\n          product_limit\n        }\n      }\n    ",variables:{shop:$}})}).then(e=>{var t,n,s;if(null==(t=null==e?void 0:e.errors)?void 0:t.length)throw new Error((null==(n=e.errors[0])?void 0:n.message)||"GraphQL error");const l=null==(s=null==e?void 0:e.data)?void 0:s.plansMe,i=(null==l?void 0:l.modelsSuggested)||["google/gemini-1.5-flash"];je(i.map(e=>({label:e,value:e}))),xe(i[0]),It((null==l?void 0:l.planKey)||"starter");const a=(null==l?void 0:l.language_limit)||1;Mt(a),zt(!0)}).catch(e=>{gt(`Error loading models: ${e.message}`),zt(!0)})},[$,L]),e.useEffect(()=>{$&&L(`/api/languages/shop/${$}?shop=${$}`).then(e=>{const t=(null==e?void 0:e.shopLanguages)||["en"];ve(t),ye([])}).catch(e=>{ve(["en"]),ye([])})},[$,L]);const Tt=e.useCallback(async()=>{U(!0);try{const e=`/collections/list-graphql?${new URLSearchParams({shop:$,...K&&{search:K},..."all"!==Y&&{optimized:Y},sortBy:ue,sortOrder:pe})}`;let t=(await L(e)).collections||[];if(K){const e=K.toLowerCase();t=t.filter(t=>t.title.toLowerCase().includes(e)||t.handle.toLowerCase().includes(e))}"all"!==Y&&(t=t.filter(e=>"true"===Y?e.hasSeoData:!e.hasSeoData)),W(t),N(t.length)}catch(e){gt(`Error loading collections: ${e.message}`)}finally{U(!1)}},[$,K,Y,ue,pe,L]);e.useEffect(()=>{$&&(Tt(),Je(!1))},[$,Y,ue,pe,Tt]),e.useEffect(()=>{const e=setTimeout(()=>{$&&Tt()},500);return()=>clearTimeout(e)},[K]);const Wt=e.useCallback(e=>{B(e);const t=e.some(e=>{const t=T.find(t=>t.id===e);return null==t?void 0:t.hasSeoData});Je(t),0===e.length&&F(!1)},[T]),Rt=e.useCallback(e=>{if(F(e),e){B(T.map(e=>e.id));const e=T.some(e=>e.hasSeoData);Je(e)}else B([]),Je(!1)},[T]),Ut=e.useMemo(()=>{var e;if(_)return Se.length>Ot;const t=T.filter(e=>q.includes(e.id));if(0===t.length)return Se.length>Ot;for(const n of t){const t=(null==(e=n.optimizationSummary)?void 0:e.optimizedLanguages)||[],s=Se.filter(e=>!t.includes(e));if(t.length+s.length>Ot)return!0}return!1},[T,q,_,Ot,Se]),Dt=async()=>{const e=T.filter(e=>q.includes(e.id)).filter(e=>{var t;return(null==(t=e.optimizedLanguages)?void 0:t.length)>0});if(0===e.length)return void gt("Please select collections with Basic SEO optimization");xt(!0),Lt({processing:!0,current:0,total:e.length,currentItem:"",results:null});const t={successful:0,failed:0,skipped:0};for(let s=0;s<e.length;s++){const l=e[s];Lt(e=>({...e,current:s,currentItem:l.title}));try{const e=l.optimizedLanguages||[];if(0===e.length){t.skipped++;continue}const n=await L(`/ai-enhance/collection/${encodeURIComponent(l.id)}`,{method:"POST",shop:$,body:{shop:$,languages:e}});n&&n.ok?t.successful++:t.failed++}catch(n){if(403===n.status)return Lt({processing:!1,current:0,total:0,currentItem:"",results:null}),kt(n),It(n.currentPlan||Pt||"starter"),void jt(!0);if(402===n.status||n.requiresPurchase||n.trialRestriction)return Lt({processing:!1,current:0,total:0,currentItem:"",results:null}),kt(n),It(n.currentPlan||Pt||"starter"),void(n.trialRestriction&&n.requiresActivation?vt(!0):n.trialRestriction?jt(!0):yt(!0));t.failed++}Lt(e=>({...e,current:s+1}))}Lt(e=>({...e,processing:!1,results:t})),gt(`AI enhancement complete! ${t.successful} collections enhanced.`)},Nt=we&&!$t.processing&&t.jsx(r,{open:we,title:"Processing Collections",onClose:()=>{},noScroll:!0,children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsx(d,{variant:"bodyMd",children:Pe?`Processing: ${Pe}`:"Preparing..."}),t.jsx(u,{progress:Ae.percent}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:[Ae.current," of ",Ae.total," collections (",Ae.percent,"%)"]})]})})}),qt=t.jsx(r,{open:st,title:"Select Languages",primaryAction:{content:"Generate Optimization for AI Search",onAction:async()=>{var e;if(Se.length){lt(!1),Ce(!0),ke({current:0,total:0,percent:0}),Me([]),et({});try{const n=_?T:T.filter(e=>q.includes(e.id)),s=n.length;ke({current:0,total:s,percent:0});const l={};for(let a=0;a<n.length;a++){const i=n[a];Ie(i.title);try{const e=await L("/seo/generate-collection-multi",{method:"POST",shop:$,body:JSON.stringify({shop:$,collectionId:i.id,model:me,languages:Se})});l[i.id]={success:!0,data:e}}catch(t){if(403===t.status||(null==(e=t.message)?void 0:e.includes("requires Professional plan")))return Ce(!1),Ie(""),kt({error:t.message||"Collections SEO requires Professional plan or higher",currentPlan:t.currentPlan||Pt||"starter",upgradeMessage:t.upgradeMessage||"Upgrade to Professional plan to optimize collections for AI search"}),void jt(!0);l[i.id]={success:!1,error:t.message},Me(e=>[...e,{collection:i.title,error:t.message}])}const o=a+1,r=Math.round(o/s*100);ke({current:o,total:s,percent:r})}et(l),nt(!0);const i=Object.values(l).filter(e=>e.success).length;gt(`Generated optimization for ${i} collections`)}catch(t){gt(`Error: ${t.message}`)}finally{Ce(!1),Ie("")}}else gt("Please select at least one language")},disabled:0===Se.length||Ut},secondaryActions:[{content:"Cancel",onAction:()=>lt(!1)}],children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"300",children:[t.jsxs(d,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",_?"all":q.length," selected collections:"]}),Ut&&t.jsx(h,{tone:"warning",title:"Language limit exceeded",children:t.jsxs(c,{gap:"200",children:[t.jsxs(d,{variant:"bodyMd",children:["Your ",Pt," plan supports up to ",Ot," language",Ot>1?"s":""," per collection.",1===q.length&&(null==(z=null==(E=null==(M=T.find(e=>e.id===q[0]))?void 0:M.optimizationSummary)?void 0:E.optimizedLanguages)?void 0:z.length)>0&&t.jsxs(t.Fragment,{children:[" This collection already has ",T.find(e=>e.id===q[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),t.jsx(d,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),t.jsx(p,{variant:"primary",onClick:()=>{const e=new URLSearchParams(window.location.search),t=e.toString()?`?${e.toString()}`:"";window.location.href=`/billing${t}`},children:"Upgrade Plan"})]})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"200",wrap:!0,children:be.map(e=>t.jsx(x,{label:e.toUpperCase(),checked:Se.includes(e),onChange:t=>{ye(t?[...Se,e]:Se.filter(t=>t!==e))}},e))})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(p,{plain:!0,onClick:()=>{Se.length===be.length?ye([]):be.length>Ot?(ye([...be]),gt(`You selected ${be.length} languages. Your ${Pt} plan supports ${Ot}. Please deselect or upgrade.`)):ye([...be])},children:Se.length===be.length?"Deselect all":"Select all"})})]})})}),Bt=t.jsx(r,{open:tt&&!we,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:async()=>{var e;Ce(!0),ke({current:0,total:0,percent:0});try{const n=Object.entries(Xe).filter(([e,t])=>t.success),s=n.length;ke({current:0,total:s,percent:0});for(let l=0;l<n.length;l++){const[i,a]=n[l],o=T.find(e=>e.id===i);if(!o)continue;Ie(o.title);try{if(!(null==(e=a.data)?void 0:e.results)||!Array.isArray(a.data.results))throw new Error("Invalid results structure");const t=await L("/seo/apply-collection-multi",{method:"POST",shop:$,body:{shop:$,collectionId:i,results:a.data.results.map(e=>({language:e.language,seo:e.data})),options:{updateTitle:!0,updateDescription:!0,updateSeo:!0,updateMetafields:!0}}});if(!(null==t?void 0:t.ok))throw new Error((null==t?void 0:t.error)||"Apply failed")}catch(t){Oe.push({id:o.id,title:o.title,message:t.message})}const r=l+1,c=Math.round(r/s*100);ke({current:r,total:s,percent:c})}gt("Optimization applied successfully!"),nt(!1),et({}),B([]),await Tt(),F(!1)}catch(t){gt(`Error applying optimization: ${t.message}`)}finally{Ce(!1),Ie("")}},disabled:!Object.values(Xe).some(e=>e.success)},secondaryActions:[{content:"Cancel",onAction:()=>nt(!1)}],children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"300",children:[t.jsxs(m,{gap:"400",children:[t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(Xe).filter(e=>e.success&&!e.skipped).length})]}),t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(Xe).filter(e=>e.skipped).length})]}),t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(Xe).filter(e=>!e.success&&!e.skipped).length})]})]}),Oe.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(f,{}),t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),t.jsxs(g,{maxHeight:"200px",overflowY:"scroll",children:[Oe.slice(0,10).map((e,n)=>t.jsxs(d,{variant:"bodySm",tone:"critical",children:[e.collection,": ",e.error]},n)),Oe.length>10&&t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["... and ",Oe.length-10," more errors"]})]})]})]})})}),_t=t.jsx(r,{open:ot,title:"SEO Data Preview",secondaryActions:[{content:"Close",onAction:()=>{rt(!1),dt(null)}}],children:t.jsx(r.Section,{children:t.jsx(g,{children:t.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",backgroundColor:"#f6f6f7",padding:"12px",borderRadius:"4px",maxHeight:"400px",overflow:"auto"},children:ct?JSON.stringify(ct,null,2):""})})})}),Ft=t.jsx(r,{open:De,title:"Delete Optimization for AI Search",onClose:()=>{Ne(!1),Be([])},primaryAction:{content:"Continue",onAction:()=>{Ve(qe),Ne(!1),Ze(!0)},disabled:0===qe.length},secondaryActions:[{content:"Cancel",onAction:()=>{Ne(!1),Be([])}}],children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsxs(d,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",_?D:q.length," selected collections:"]}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"400",wrap:!1,children:be.map(e=>t.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[t.jsx("input",{type:"checkbox",checked:qe.includes(e),onChange:t=>{Be(t.target.checked?[...qe,e]:qe.filter(t=>t!==e))},style:{marginRight:"8px",width:"18px",height:"18px",cursor:"pointer"}}),t.jsx(d,{variant:"bodyMd",children:e.toUpperCase()})]},e))})}),t.jsx(g,{children:t.jsx(p,{plain:!0,onClick:()=>{Be(qe.length===be.length?[]:[...be])},children:"Select all"})}),t.jsx(g,{paddingBlockStart:"300",children:t.jsx(d,{variant:"bodySm",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})})]})})}),Ht=t.jsx(r,{open:Ye,title:"Confirm Deletion",onClose:()=>{Ze(!1),Ve([])},primaryAction:{content:"Delete",destructive:!0,onAction:async()=>{Ze(!1),setTimeout(()=>{(async(e=[])=>{Fe(!0),Ue("");try{const n=_?T:T.filter(e=>q.includes(e.id)),s=n.length*e.length;let l=0;const i=[];for(const a of n)for(const n of e)try{await L("/collections/delete-seo",{method:"DELETE",shop:$,body:{shop:$,collectionId:a.id,language:n}})}catch(t){i.push({id:a.id,title:a.title,message:t.message})}finally{l++,ke({current:l,total:s,percent:Math.round(l/s*100)})}gt(`Deleted optimization for ${e.join(", ").toUpperCase()}`),setTimeout(async()=>{await Tt(),B([]),F(!1),Je(!1)},100)}catch(t){gt(`Delete error: ${t.message}`)}finally{Fe(!1),Ve([]),Be([])}})(Qe)},100)}},secondaryActions:[{content:"Cancel",onAction:()=>{Ze(!1),Ve([]),Be([])}}],children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsx(d,{variant:"bodyMd",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"200",children:Qe.map(e=>t.jsx(j,{tone:"warning",children:e.toUpperCase()},e))})}),t.jsxs(d,{variant:"bodyMd",children:["This will delete optimisation from ",_?D:q.length," selected collections."]}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(d,{variant:"bodySm",tone:"critical",children:"This action cannot be undone."})})]})})}),Jt=_e&&t.jsx(r,{open:_e,title:"Deleting SEO Data",onClose:()=>{},noScroll:!0,children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsx(d,{variant:"bodyMd",children:"Deleting selected languages..."}),t.jsx(u,{progress:Ae.percent}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:[Ae.current," of ",Ae.total," operations (",Ae.percent,"%)"]})]})})}),Kt=t.jsx(P,{heading:"No collections found",action:{content:"Clear filters",onAction:()=>{G(""),Z("all"),Tt()}},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:t.jsx("p",{children:"Try adjusting your filters or search terms"})});return t.jsxs(t.Fragment,{children:[t.jsx(s,{globalPlan:O}),t.jsx(S,{children:t.jsx(g,{padding:"400",children:t.jsxs(c,{gap:"300",children:[t.jsxs(m,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[t.jsx(g,{minWidth:"400px",children:t.jsx(y,{label:"",placeholder:"Search by collection name...",value:K,onChange:G,prefix:t.jsx(b,{}),clearButton:!0,onClearButtonClick:()=>G("")})}),t.jsx(g,{width:"320px",children:t.jsx(p,{primary:!0,onClick:()=>{0!==q.length||_?lt(!0):gt("Please select collections first")},disabled:0===q.length&&!_,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),t.jsxs(m,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[t.jsx(p,{onClick:async()=>{try{Ge(!0);const e=await L(`/api/collections/sync?shop=${$}`,{method:"POST"});(null==e?void 0:e.success)?(gt("Collections synced successfully!"),await Tt()):gt("Failed to sync collections")}catch(e){gt("Error syncing collections")}finally{Ge(!1)}},disabled:Ke||R,size:"medium",children:Ke?"Syncing...":"Sync Collections"}),t.jsx(g,{width:"320px",children:t.jsxs(c,{gap:"200",align:"end",children:[(()=>{if(0===q.length&&!_)return null;if(!T.filter(e=>q.includes(e.id)).some(e=>{var t;return(null==(t=e.optimizedLanguages)?void 0:t.length)>0}))return null;const e="starter"===Pt.toLowerCase().replace(/_/g," ");return t.jsx(p,{onClick:e?()=>{kt({error:"Collections require Professional plan or higher",message:"Upgrade to Professional plan to access Collections optimization",minimumPlanRequired:"Professional"}),jt(!0)}:Dt,disabled:0===q.length&&!_,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),t.jsx(p,{outline:!0,destructive:!0,onClick:()=>Ne(!0),disabled:0===q.length||!He,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]})})}),t.jsx(g,{paddingBlockStart:"400",children:t.jsxs(S,{children:[t.jsxs(g,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[t.jsxs(m,{gap:"200",wrap:!0,align:"space-between",children:[t.jsx(m,{gap:"200",wrap:!0,children:t.jsx(v,{active:se,activator:t.jsx(p,{disclosure:"down",onClick:()=>le(!se),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"AI Search Status"}),"all"!==Y&&t.jsx(g,{onClick:e=>{e.stopPropagation(),Z("all")},children:t.jsx(d,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>le(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(w,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All collections",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[Y],onChange:e=>{Z(e[0]),le(!1)}})})})}),t.jsx(v,{active:ce,activator:t.jsx(p,{disclosure:"down",onClick:()=>de(!ce),removeUnderline:!0,children:t.jsx(m,{gap:"100",blockAlign:"center",children:t.jsxs("span",{children:["updatedAt"===ue&&"desc"===pe&&"Newest first","updatedAt"===ue&&"asc"===pe&&"Oldest first","title"===ue&&"asc"===pe&&"Name A-Z","title"===ue&&"desc"===pe&&"Name Z-A","productsCount"===ue&&"desc"===pe&&"Most products","productsCount"===ue&&"asc"===pe&&"Least products"]})})}),onClose:()=>de(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(w,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"updatedAt_desc"},{label:"Oldest first",value:"updatedAt_asc"},{label:"Name A-Z",value:"title_asc"},{label:"Name Z-A",value:"title_desc"},{label:"Most products",value:"productsCount_desc"},{label:"Least products",value:"productsCount_asc"}],selected:[`${ue}_${pe}`],onChange:e=>{const[t,n]=e[0].split("_");he(t),ge(n),de(!1)}})})})]}),"all"!==Y&&t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"100",wrap:!0,children:t.jsx(j,{onRemove:()=>Z("all"),children:"true"===Y?"Has AI Search Optimisation":"No AI Search Optimisation"})})})]}),D>0&&t.jsx(g,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:t.jsx(x,{label:`Select all ${D} collections`,checked:_,onChange:Rt})}),t.jsx(C,{resourceName:{singular:"collection",plural:"collections"},items:T,renderItem:e=>{var n,s;const l=(null==(n=Xe[e.id])?void 0:n.success)||it[e.id],i=(null==(s=Xe[e.id])?void 0:s.data)||it[e.id],a=e.optimizedLanguages||[],o=t.jsx(g,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return t.jsx(k,{id:e.id,media:o,accessibilityLabel:`View details for ${e.title}`,children:t.jsxs(m,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[t.jsxs(g,{style:{flex:"1 1 30%",minWidth:"200px"},children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:e.title}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["Handle: ",e.handle]})]}),t.jsx(g,{style:{flex:"0 0 15%",minWidth:"100px",textAlign:"center"},children:t.jsxs(d,{variant:"bodyMd",children:[e.productsCount," products"]})}),t.jsx(g,{style:{flex:"0 0 25%",minWidth:"160px"},children:t.jsx(m,{gap:"100",wrap:!0,children:e.hasSeoData?t.jsxs(t.Fragment,{children:[be.map(e=>t.jsx(j,{tone:a.includes(e)?"success":"subdued",size:"small",children:e.toUpperCase()},e)),e.aiEnhanced&&t.jsx(j,{tone:"info",size:"small",children:"AI✨"})]}):t.jsx(j,{tone:"subdued",children:"No AI Search Optimisation"})})}),t.jsxs(g,{style:{flex:"0 0 15%",minWidth:"120px"},children:[l&&t.jsx(p,{size:"slim",onClick:()=>{dt(i),rt(!0)},children:"Preview JSON"}),!l&&e.hasSeoData&&t.jsx(p,{size:"slim",loading:ut,onClick:()=>(async e=>{ht(!0);try{const t=`/collections/${e.split("/").pop()}/seo-data?shop=${encodeURIComponent($)}`,n=await L(t);dt(n),rt(!0)}catch(t){gt(404===(null==t?void 0:t.status)?"No SEO data found for this collection":"Failed to load SEO data")}finally{ht(!1)}})(e.id),children:"Preview JSON"})]})]})})},selectedItems:q,onSelectionChange:Wt,selectable:!0,loading:R,totalItemsCount:D,emptyState:Kt,showHeader:!1},`collections-${T.length}-${q.length}`)]})}),Nt,qt,Bt,_t,Ft,Ht,Jt,(()=>{T.filter(e=>q.includes(e.id)).filter(e=>{var t;return(null==(t=e.optimizedLanguages)?void 0:t.length)>0});const e=()=>{const e=$t.results;xt(!1),Lt({processing:!1,current:0,total:0,currentItem:"",results:null}),e&&e.successful>0&&setTimeout(()=>{W([]),Tt()},1500)};return $t.processing?t.jsx(r,{open:mt,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsxs(d,{variant:"bodyMd",children:["Processing: ",$t.currentItem]}),t.jsx(u,{progress:$t.current/$t.total*100}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:[$t.current," of ",$t.total," collections (",Math.round($t.current/$t.total*100),"%)"]})]})})}):null!==$t.results?t.jsx(r,{open:mt,title:"AI Enhancement Results",onClose:e,primaryAction:{content:"Done",onAction:e},children:t.jsx(r.Section,{children:t.jsx(c,{gap:"300",children:t.jsxs(m,{gap:"400",children:[t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"success",children:$t.results.successful})]}),t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:$t.results.failed})]}),t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"info",children:$t.results.skipped})]})]})})})}):null})(),t.jsx(l,{open:ft,onClose:()=>jt(!1),featureName:"Collections AI Enhancement",currentPlan:Pt,errorMessage:(null==At?void 0:At.error)||(null==At?void 0:At.message),minimumPlanRequired:null==At?void 0:At.minimumPlanRequired}),At&&t.jsxs(t.Fragment,{children:[t.jsx(i,{open:St,onClose:()=>{yt(!1),kt(null)},tokensRequired:At.tokensRequired||0,tokensAvailable:At.tokensAvailable||0,tokensNeeded:At.tokensNeeded||0,feature:"ai-seo-collection",shop:$,needsUpgrade:At.needsUpgrade||!1,minimumPlan:At.minimumPlanForFeature||null,currentPlan:At.currentPlan||Pt,returnTo:"/ai-seo/collections",onBuyTokens:()=>{yt(!1),Ct(!0)}}),t.jsx(a,{open:bt,onClose:()=>{vt(!1),kt(null)},feature:At.feature||"ai-seo-collection",trialEndsAt:At.trialEndsAt,currentPlan:At.currentPlan||Pt,tokensRequired:At.tokensRequired||0,onActivatePlan:async()=>{try{const e=await L("/api/billing/activate",{method:"POST",body:JSON.stringify({shop:$,endTrial:!0,returnTo:"/ai-seo/collections"})});if(e.requiresApproval&&e.confirmationUrl)return void(window.top.location.href=e.confirmationUrl);window.location.reload()}catch(e){const t=new URLSearchParams(window.location.search),n=t.get("host"),s=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent($)}&embedded=${s}&host=${encodeURIComponent(n)}`}},onPurchaseTokens:()=>{vt(!1),Ct(!0)}})]}),t.jsx(o,{open:wt,onClose:()=>{Ct(!1),kt(null)},shop:$,returnTo:"/ai-seo/collections",inTrial:!!(null==At?void 0:At.trialEndsAt)}),pt&&t.jsx(A,{content:pt,onDismiss:()=>gt("")})]})}export{I as default};
