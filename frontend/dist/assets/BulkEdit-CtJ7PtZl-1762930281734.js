import{j as e}from"./app-bridge-CWybk-XY-1762930281734.js";import{r as a}from"./react-vendor-tAaa2TlE-1762930281734.js";import{u as Xt}from"./useShopApi-Bh2eyCWg-1762930281734.js";import{S as Zt,U as es}from"./StoreMetadataBanner-D_ljbg2c-1762930281734.js";import{I as ts}from"./InsufficientTokensModal-DnHoVwPs-1762930281734.js";import{M as k,a as P,B as u,T as r,I as j,f as $,d as ye,D as xt,e as gt,b as E,g as Ee,C as mt,h as ss,S as ns,i as Te,j as Re,R as as,k as rs,l as ft,m as is,E as os}from"./polaris-BFriSeYO-1762930281734.js";function ls({open:C,onClose:f,feature:w,trialEndsAt:be,currentPlan:d,tokensRequired:y,onActivatePlan:F,onPurchaseTokens:ee}){const[A,we]=a.useState(null),[re,Ae]=a.useState(!1),de=async()=>{Ae(!0);try{A==="plan"?await F():A==="tokens"&&await ee()}catch(h){console.error("[Trial Modal] Action failed:",h)}finally{Ae(!1)}},ve={"ai-seo-product-basic":"AI SEO Optimization (Products)","ai-seo-product-enhanced":"AI SEO Optimization (Products - Enhanced)","ai-seo-collection":"AI SEO Optimization (Collections)","ai-testing-simulation":"AI Testing & Simulation","ai-schema-advanced":"Advanced Schema Data","ai-sitemap-optimized":"AI-Optimized Sitemap"}[w]||"This feature";return e.jsx(k,{open:C,onClose:f,title:"ðŸ”“ Activate Feature",primaryAction:{content:re?"Processing...":A==="plan"?"Activate Plan":A==="tokens"?"Purchase Tokens":"Continue",disabled:!A,loading:re,onAction:de},secondaryActions:[{content:"Cancel",onAction:f,disabled:re}],children:e.jsx(k.Section,{children:e.jsxs(P,{gap:"400",children:[e.jsx(u,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(P,{gap:"200",children:[e.jsx(r,{variant:"headingMd",children:ve}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"This AI-enhanced feature requires tokens or an active plan."}),y>0&&e.jsxs(j,{align:"space-between",children:[e.jsx(r,{variant:"bodySm",children:"Estimated cost:"}),e.jsxs($,{tone:"info",children:[y.toLocaleString()," tokens"]})]})]})}),e.jsx(ye,{tone:"info",children:e.jsxs(P,{gap:"200",children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"You are currently in trial period"}),e.jsxs(r,{variant:"bodySm",children:["Trial ends: ",new Date(be).toLocaleDateString()]}),e.jsxs(r,{variant:"bodySm",children:["Current plan: ",e.jsx("strong",{children:d})]})]})}),e.jsx(xt,{}),e.jsxs(P,{gap:"300",children:[e.jsx(r,{variant:"headingMd",children:"Choose how to proceed:"}),e.jsx(u,{padding:"400",borderWidth:"025",borderColor:A==="plan"?"border-brand":"border",borderRadius:"200",background:A==="plan"?"bg-surface-selected":"bg-surface",onClick:()=>we("plan"),style:{cursor:"pointer"},children:e.jsxs(P,{gap:"200",children:[e.jsxs(j,{align:"space-between",blockAlign:"center",children:[e.jsxs(j,{gap:"200",blockAlign:"center",children:[e.jsx(r,{variant:"bodyLg",children:A==="plan"?"âœ…":"â¬œ"}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"End Trial & Activate Plan"})]}),A==="plan"&&e.jsx($,{tone:"success",children:"Selected"})]}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["â€¢ Immediate billing for your ",d," plan"]}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"â€¢ Unlock all plan features now"}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"â€¢ You can purchase additional tokens anytime"}),d==="growth extra"||d==="enterprise"?e.jsx(r,{variant:"bodySm",tone:"success",fontWeight:"semibold",children:"â€¢ Includes monthly tokens in plan price"}):null]})}),e.jsx(u,{padding:"400",borderWidth:"025",borderColor:A==="tokens"?"border-brand":"border",borderRadius:"200",background:A==="tokens"?"bg-surface-selected":"bg-surface",onClick:()=>we("tokens"),style:{cursor:"pointer"},children:e.jsxs(P,{gap:"200",children:[e.jsxs(j,{align:"space-between",blockAlign:"center",children:[e.jsxs(j,{gap:"200",blockAlign:"center",children:[e.jsx(r,{variant:"bodyLg",children:A==="tokens"?"âœ…":"â¬œ"}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Purchase Tokens Only"})]}),A==="tokens"&&e.jsx($,{tone:"success",children:"Selected"})]}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["â€¢ Your trial continues until ",new Date(be).toLocaleDateString()]}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"â€¢ One-time purchase (starting from $5)"}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"â€¢ Tokens never expire"}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"â€¢ Plan activates automatically after trial"})]})})]}),A==="plan"&&e.jsx(ye,{tone:"warning",children:e.jsx(r,{variant:"bodySm",children:"Your trial will end immediately and you will be charged for the first billing period."})})]})})})}const cs=(C,f="")=>{try{return new URLSearchParams(window.location.search).get(C)||f}catch{return f}},je=C=>{if(!C)return C;const f=String(C).trim();return f.startsWith("gid://")?f:`gid://shopify/Product/${f}`},ds=C=>{if(!C)return"";const f=String(C).match(/\/(\d+)$/);return f?f[1]:C},$e=C=>C<=70?"Starter":C<=200?"Professional":C<=450?"Growth":C<=750?"Growth Extra":"Enterprise";function Ss({shop:C,globalPlan:f}){var ut,ht,pt;const{api:w,shop:be}=Xt(),d=C||be||cs("shop","");a.useEffect(()=>{},[d,w]);const[y,F]=a.useState([]),[ee,A]=a.useState(!1),[we,re]=a.useState(1),[Ae,de]=a.useState(!0),[D,ve]=a.useState(0),[h,ie]=a.useState([]),[b,ue]=a.useState(!1),[te,Qe]=a.useState(""),[B,Pe]=a.useState("all"),[U,he]=a.useState(""),[Ce,us]=a.useState("createdAt"),[oe,St]=a.useState("desc"),[N,Ie]=a.useState([]),[jt,yt]=a.useState([]),[Je,De]=a.useState(!1),[Xe,Ue]=a.useState(!1),[Ze,We]=a.useState(!1),[et,Be]=a.useState(!1),[bt,wt]=a.useState(""),[At,vt]=a.useState([]),[W,le]=a.useState([]),[z,tt]=a.useState([]),[qe,se]=a.useState(!1),[ke,_]=a.useState({current:0,total:0,percent:0}),[st,ce]=a.useState(""),[Le,pe]=a.useState([]),[ge,nt]=a.useState({}),[Pt,Fe]=a.useState(!1),[Ct,me]=a.useState(!1),[It,fe]=a.useState(!1),[K,xe]=a.useState([]),[kt,ze]=a.useState(!1),[at,I]=a.useState(""),[rt,it]=a.useState(!1),[L,ne]=a.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[Y,Lt]=a.useState(null),[O,zt]=a.useState(70),[J,Ne]=a.useState(1),[Ot,Oe]=a.useState(!1),[Me,Mt]=a.useState(localStorage.getItem("hasVisitedProducts")==="true"),[_e,X]=a.useState(!1),[Et,Ye]=a.useState(!1),[Tt,ot]=a.useState(!1),[m,G]=a.useState(null),[V,Se]=a.useState("starter");a.useEffect(()=>{if(!(!f||typeof f!="object")){if(f.planKey&&f.planKey!==""){Se(f.planKey);const n={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[f.planKey.toLowerCase()]||1;Ne(n)}else if(f.plan&&f.plan!==""){const t=f.plan.toLowerCase().replace(/\s+/g,"-");Se(t);const s={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[t]||1;Ne(s)}}},[f]),a.useEffect(()=>{_e&&Y&&(b?D:h.length)<=O&&(X(!1),G(null))},[h.length,b,D,_e,Y]),a.useEffect(()=>{if(!d)return;w("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
          language_limit
        }
      }
    `,variables:{shop:d}})}).then(n=>{var i,l,c;if((i=n==null?void 0:n.errors)!=null&&i.length)throw new Error(((l=n.errors[0])==null?void 0:l.message)||"GraphQL error");const s=(c=n==null?void 0:n.data)==null?void 0:c.plansMe,p=(s==null?void 0:s.modelsSuggested)||["anthropic/claude-3.5-sonnet"];vt(p.map(o=>({label:o,value:o}))),wt(p[0]),Lt((s==null?void 0:s.plan)||"starter"),Se((s==null?void 0:s.planKey)||"starter"),zt((s==null?void 0:s.product_limit)||70),Ne((s==null?void 0:s.language_limit)||1)}).catch(n=>console.error("[BULK-EDIT] GraphQL plansMe failed:",n))},[d,w]),a.useEffect(()=>{if(!d)return;const t=new Promise((n,s)=>{setTimeout(()=>s(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([w(`/api/languages/shop/${d}`),t]).then(n=>{const s=Array.isArray(n==null?void 0:n.shopLanguages)&&n.shopLanguages.length?n.shopLanguages:["en"];tt(s.includes("en")?s:["en",...s])}).catch(n=>{console.error("[BULK-EDIT] Languages API error:",n),tt(["en"])})},[d,w]),a.useEffect(()=>{d&&w("/api/products/tags/list",{shop:d}).then(t=>yt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[d,w]);const ae=a.useCallback(async(t=1,n=!1,s=null)=>{var p,i,l,c;A(!0);try{const o=new URLSearchParams({shop:d,page:t,limit:50,...B!=="all"&&{optimized:B},...te&&{search:te},...U&&{languageFilter:U},...N.length>0&&{tags:N.join(",")},sortBy:Ce,sortOrder:oe,...s&&{_t:s}}),x=await w(`/api/products/list?${o}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((p=x.products)==null?void 0:p.length)>0,((i=x.products)==null?void 0:i.length)>0&&x.products.forEach((S,M)=>{}),F(n?S=>[...S,...x.products]:x.products||[]),re(t),de(((l=x.pagination)==null?void 0:l.hasNext)||!1),ve(((c=x.pagination)==null?void 0:c.total)||0)}catch(o){F(n?y:[]),de(!1),I(`Error loading products: ${o.message}`)}finally{A(!1)}},[d,B,te,U,N,Ce,oe]);a.useEffect(()=>{d&&ae(1,!1,null)},[d,B,U,N,Ce,oe]),a.useEffect(()=>{!Me&&d&&(localStorage.setItem("hasVisitedProducts","true"),Mt(!0))},[Me,d]),a.useEffect(()=>{y.length===0&&!ee&&d&&!Me&&Oe(!0)},[y.length,ee,d,Me]),a.useEffect(()=>{},[y,h]);const lt=a.useCallback(t=>{Qe(t)},[]);a.useEffect(()=>{const t=setTimeout(()=>{d&&ae(1,!1,null)},500);return()=>clearTimeout(t)},[te]);const Rt=a.useCallback(t=>{ie(t),t.length===0&&ue(!1)},[]),ct=a.useCallback(t=>{ue(t),ie(t?y.map(n=>n.id):[])},[y]),dt=a.useMemo(()=>{var n;if(b)return W.length>J;const t=y.filter(s=>h.includes(s.id));if(t.length===0)return W.length>J;for(const s of t){const p=((n=s.optimizationSummary)==null?void 0:n.optimizedLanguages)||[],i=W.filter(c=>!p.includes(c));if(p.length+i.length>J)return!0}return!1},[y,h,b,J,W]),$t=()=>{if(h.length===0&&!b){I("Please select products first");return}me(!0)},Dt=()=>{if(h.length===0&&!b){I("Please select products first");return}xe([]),fe(!0)},Ut=async()=>{const t=y.filter(l=>h.includes(l.id)),n=t.filter(l=>{var c,o;return((o=(c=l.optimizationSummary)==null?void 0:c.optimizedLanguages)==null?void 0:o.length)>0}),s=t.filter(l=>{var c,o;return!((o=(c=l.optimizationSummary)==null?void 0:c.optimizedLanguages)!=null&&o.length)}),p=n.length;if(p>O){const l=$e(p);G({error:"Product limit exceeded",message:`Your ${Y} plan supports up to ${O} products for AI Enhancement. You have selected ${p} products with Basic SEO.`,minimumPlanRequired:l,currentPlan:Y,features:[`Optimize up to ${O} products`,"All features from your current plan",l==="Growth Extra"||l==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",l==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),X(!0);return}it(!0),ne({processing:!0,current:0,total:n.length,currentItem:"",results:null});const i={successful:0,failed:0,skipped:s.length,skipReasons:s.length>0?[`${s.length} product(s): No Basic Optimization`]:[]};for(let l=0;l<n.length;l++){const c=n[l];ne(o=>({...o,current:l,currentItem:c.title}));try{const o=c.gid||je(c.id);if(!o){console.error("[AI-ENHANCE] Missing product GID, skipping:",c),i.failed++;continue}const x=await w("/ai-enhance/product",{method:"POST",shop:d,body:{shop:d,productId:o,languages:c.optimizationSummary.optimizedLanguages}});if(x.results&&x.results.length>0){const S={shop:d,productId:c.gid||je(c.id),results:x.results.filter(g=>g.bullets&&g.faq).map(g=>({language:g.language,seo:{...g.updatedSeo,bullets:g.bullets||[],faq:g.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},M=await w("/api/seo/apply-multi",{method:"POST",shop:d,body:S});i.successful++}else i.failed++}catch(o){if(o.status===403){ne({processing:!1,current:0,total:0,currentItem:"",results:null}),G({...o,message:o.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),Se(o.currentPlan||V),o.needsUpgrade===!1&&o.requiresPurchase?Ye(!0):X(!0);return}if(o.status===402||o.requiresPurchase||o.trialRestriction){ne({processing:!1,current:0,total:0,currentItem:"",results:null}),G(o),Se(o.currentPlan||Y||"starter"),o.trialRestriction&&o.requiresActivation?ot(!0):o.trialRestriction?X(!0):Ye(!0);return}i.failed++}ne(o=>({...o,current:l+1}))}ne(l=>({...l,processing:!1,results:i})),I(`AI enhancement complete! ${i.successful} products enhanced.`)},Ge=()=>{const t=L.results;it(!1),ne({processing:!1,current:0,total:0,currentItem:"",results:null}),t&&t.successful>0&&setTimeout(()=>{F([]),ae(1,!1,Date.now())},1500)},Wt=()=>L.processing?e.jsx(k,{open:rt,title:"Processing AI Enhancement",onClose:Ge,noScroll:!0,children:e.jsx(k.Section,{children:e.jsxs(P,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",L.currentItem]}),e.jsx(gt,{progress:L.current/L.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[L.current," of ",L.total," products (",Math.round(L.current/L.total*100),"%)"]})]})})}):L.results!==null?e.jsx(k,{open:rt,title:"AI Enhancement Results",onClose:Ge,primaryAction:{content:"Done",onAction:Ge},children:e.jsx(k.Section,{children:e.jsxs(P,{gap:"400",children:[e.jsxs(j,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:L.results.successful})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:L.results.failed})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:L.results.skipped})]})]}),L.results.skipReasons&&L.results.skipReasons.length>0&&e.jsxs(P,{gap:"200",children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped products:"}),L.results.skipReasons.map((t,n)=>e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["â€¢ ",t]},n))]})]})})}):null,Bt=async()=>{var n;if(!W.length){I("Please select at least one language");return}let t=bt;(!t||!t.trim())&&(t=((n=At[0])==null?void 0:n.value)||"anthropic/claude-3.5-sonnet"),se(!0),_({current:0,total:0,percent:0}),pe([]),nt({});try{let s=[];b?s=(await w(`/api/products/list?shop=${encodeURIComponent(d)}&limit=1000&fields=id`)).products||[]:s=y.filter(g=>h.includes(g.id));const p=s.length;if(p>O){se(!1),_({current:0,total:0,percent:0}),me(!1);const g=$e(p);G({error:"Product limit exceeded",message:`Your ${V} plan supports up to ${O} products for SEO optimization. You have selected ${p} products.`,minimumPlanRequired:g,currentPlan:V,features:["Optimize more products","All features from your current plan",g==="Growth Extra"||g==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",g==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),X(!0);return}me(!1);const i=p,l=0;_({current:0,total:i,percent:0});const c=5,o={};for(let g=0;g<s.length;g+=c){const q=s.slice(g,Math.min(g+c,s.length)).map(async R=>{var Q;ce(R.title||R.handle||"Product");try{const Z=R.gid||je(R.productId||R.id),Ke=((Q=R.optimizationSummary)==null?void 0:Q.optimizedLanguages)||[],Ve=W.filter(Jt=>!Ke.includes(Jt));if(Ve.length===0){o[R.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Qt=await w("/api/seo/generate-multi",{method:"POST",shop:d,body:{shop:d,productId:Z,model:t,languages:Ve}});o[R.id]={success:!0,data:Qt,languages:Ve}}catch(Z){o[R.id]={success:!1,error:Z.message},pe(Ke=>[...Ke,{product:R.title,error:Z.message}])}});await Promise.all(q);const v=Math.min(g+c,s.length),H=Math.round(v/i*100);_({current:v,total:i,percent:H})}nt(o),Fe(!0);const x=Object.keys(o).filter(g=>o[g].success&&!o[g].skipped).length,S=Object.keys(o).filter(g=>o[g].skipped).length;let M=`Generated Optimization for AI Search for ${x} products`;S>0&&(M+=` (${S} already optimised)`),l>0,I(M)}catch(s){I(`Error: ${s.message}`)}finally{se(!1),ce("")}},qt=async()=>{var t,n;se(!0),_({current:0,total:0,percent:0});try{const s=Object.entries(ge).filter(([c,o])=>o.success&&!o.skipped),p=s.length;_({current:0,total:p,percent:0});for(let c=0;c<s.length;c++){const[o,x]=s[c],S=y.find(T=>T.id===o);if(!S)continue;ce(S.title||"Product");try{const T=S.gid||je(S.productId||S.id),q=await w("/api/seo/apply-multi",{method:"POST",shop:d,body:{shop:d,productId:T,results:x.data.results.filter(v=>v==null?void 0:v.seo).map(v=>({language:v.language,seo:v.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});q.appliedLanguages&&q.appliedLanguages.length>0&&F(v=>v.map(H=>{var R;if(H.id===o){const Q=((R=H.optimizationSummary)==null?void 0:R.optimizedLanguages)||[],Z=[...new Set([...Q,...q.appliedLanguages])];return{...H,optimizationSummary:{...H.optimizationSummary,optimizedLanguages:Z,optimized:!0,lastOptimized:new Date().toISOString()}}}return H}))}catch(T){pe(q=>[...q,{product:S.title,error:`Apply failed: ${T.message}`}])}const M=c+1,g=Math.round(M/p*100);_({current:M,total:p,percent:g})}I("AI Search Optimisation applied successfully!"),Fe(!1),ie([]),ue(!1),await new Promise(c=>setTimeout(c,1e3)),F([]);const i=new URLSearchParams({shop:d,page:1,limit:50,...B!=="all"&&{optimized:B},...te&&{search:te},...U&&{languageFilter:U},...N.length>0&&{tags:N.join(",")},sortBy:Ce,sortOrder:oe,_t:Date.now()}),l=await w(`/api/products/list?${i}`,{shop:d,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});F(l.products||[]),re(1),de(((t=l.pagination)==null?void 0:t.hasNext)||!1),ve(((n=l.pagination)==null?void 0:n.total)||0)}catch(s){I(`Error applying AI Search Optimisation: ${s.message}`)}finally{se(!1),ce("")}},Ft=async()=>{var t;if(!K.length){I("Please select at least one language to delete");return}fe(!1),ze(!1),se(!0),_({current:0,total:0,percent:0}),pe([]);try{let n=[];b?n=(await w(`/api/products/list?shop=${encodeURIComponent(d)}&limit=1000&fields=id`)).products||[]:n=y.filter(l=>h.includes(l.id));const s=n.length;_({current:0,total:s,percent:0});let p=0,i=0;for(let l=0;l<n.length;l++){const c=n[l];ce(c.title||c.handle||"Product");try{const S=c.gid||je(c.productId||c.id),M=((t=c.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],g=K.filter(q=>M&&M.length>0&&M.includes(q));if(g.length===0){i++;continue}const T=await w("/api/seo/delete-multi",{method:"POST",shop:d,body:{shop:d,productId:S,languages:g}});T.deletedLanguages&&T.deletedLanguages.length>0&&F(q=>q.map(v=>{var H;if(v.id===c.id){const Q=(((H=v.optimizationSummary)==null?void 0:H.optimizedLanguages)||[]).filter(Z=>!T.deletedLanguages.includes(Z));return{...v,optimizationSummary:{...v.optimizationSummary,optimizedLanguages:Q,optimized:Q.length>0,aiEnhanced:Q.length>0?v.optimizationSummary.aiEnhanced:!1,lastOptimized:Q.length>0?v.optimizationSummary.lastOptimized:null}}}return v})),p++,T.deletedLanguages&&T.deletedLanguages.length>0&&await w("/api/products/verify-after-delete",{method:"POST",shop:d,body:{shop:d,productIds:[S],deletedLanguages:T.deletedLanguages}})}catch(S){pe(M=>[...M,{product:c.title,error:S.message}])}const o=l+1,x=Math.round(o/s*100);_({current:o,total:s,percent:x})}ie([]),ue(!1),i>0?I(`Deleted Optimization for AI Search from ${p} products (${i} had no optimisation to delete)`):I(`Deleted Optimization for AI Search from ${p} products`),setTimeout(()=>{const l=Date.now();ae(1,!1,l)},500)}catch(n){I(`Error: ${n.message}`)}finally{se(!1),ce("")}},Nt=t=>{var n,s,p;try{const i=t,l=ds(i.productId||i.id),c=((n=i.optimizationSummary)==null?void 0:n.optimizedLanguages)||[],o=(s=i.images)!=null&&s[0]?e.jsx(ft,{source:i.images[0].url||i.images[0].src||i.images[0],alt:i.title,size:"small"}):i.imageUrl?e.jsx(ft,{source:i.imageUrl,alt:i.title,size:"small"}):e.jsx(u,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(is,{id:i.id,media:o,accessibilityLabel:`View details for ${i.title}`,onClick:x=>{},children:e.jsxs(j,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(u,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:i.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["ID: ",l]})]}),e.jsx(u,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsxs(j,{gap:"100",wrap:!0,children:[(()=>{if(z.length>0)return z.map(x=>{const S=c.includes(x),M=i.status==="DRAFT";return e.jsx($,{tone:M?"subdued":S?"success":"subdued",size:"small",children:x.toUpperCase()},x)});{const x=i.status==="DRAFT";return c.map(S=>e.jsx($,{tone:x?"subdued":"success",size:"small",children:S.toUpperCase()},S))}})(),((p=i.optimizationSummary)==null?void 0:p.aiEnhanced)&&i.status!=="DRAFT"&&e.jsx($,{tone:"info",size:"small",children:"AIâœ¨"})]})}),e.jsx(u,{style:{flex:"0 0 20%",minWidth:"120px",textAlign:"center"},children:i.status==="ACTIVE"?e.jsx($,{tone:"success",children:"Active"}):i.status==="DRAFT"?e.jsx($,{children:"Draft"}):i.status==="ARCHIVED"?e.jsx($,{tone:"warning",children:"Archived"}):e.jsx($,{children:i.status||"Unknown"})})]})})}catch(i){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",i),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},_t=qe&&e.jsx(k,{open:qe,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(k.Section,{children:e.jsxs(P,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:st?`Processing: ${st}`:"Preparing..."}),e.jsx(gt,{progress:ke.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[ke.current," of ",ke.total," products (",ke.percent,"%)"]})]})})}),Yt=e.jsx(k,{open:Ct,title:"Select Languages",onClose:()=>{me(!1),le([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Bt,disabled:W.length===0||dt},secondaryActions:[{content:"Cancel",onAction:()=>{me(!1),le([])}}],children:e.jsx(k.Section,{children:e.jsxs(P,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",b?"all":h.length," selected products:"]}),dt&&e.jsx(ye,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(P,{gap:"200",children:[e.jsxs(r,{variant:"bodyMd",children:["Your ",V," plan supports up to ",J," language",J>1?"s":""," per product.",h.length===1&&((pt=(ht=(ut=y.find(t=>t.id===h[0]))==null?void 0:ut.optimizationSummary)==null?void 0:ht.optimizedLanguages)==null?void 0:pt.length)>0&&e.jsxs(e.Fragment,{children:[" This product already has ",y.find(t=>t.id===h[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(r,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(E,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),n=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${n}`},children:"Upgrade Plan"})]})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(j,{gap:"200",wrap:!0,children:z.map(t=>e.jsx(Ee,{label:t.toUpperCase(),checked:W.includes(t),onChange:n=>{le(n?[...W,t]:W.filter(s=>s!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(E,{plain:!0,onClick:()=>{W.length===z.length?le([]):z.length>J?(le([...z]),I(`You selected ${z.length} languages. Your ${V} plan supports ${J}. Please deselect or upgrade.`)):le([...z])},children:W.length===z.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Gt=e.jsx(k,{open:Pt&&!qe,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:qt,disabled:!Object.values(ge).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Fe(!1)}],children:e.jsx(k.Section,{children:e.jsxs(P,{gap:"300",children:[e.jsxs(j,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(ge).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(ge).filter(t=>t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(ge).filter(t=>!t.success).length})]})]}),Le.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(xt,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(u,{maxHeight:"200px",overflowY:"scroll",children:[Le.slice(0,10).map((t,n)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},n)),Le.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",Le.length-10," more errors"]})]})]})]})})}),Ht=e.jsx(k,{open:It,title:"Delete Optimization for AI Search",onClose:()=>{fe(!1),xe([])},primaryAction:{content:"Continue",onAction:()=>{fe(!1),ze(!0)},disabled:K.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{fe(!1),xe([])}}],children:e.jsx(k.Section,{children:e.jsxs(P,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",b?"all":h.length," selected products:"]}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(j,{gap:"200",wrap:!0,children:z.map(t=>e.jsx(Ee,{label:t.toUpperCase(),checked:K.includes(t),onChange:n=>{xe(n?[...K,t]:K.filter(s=>s!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(E,{plain:!0,onClick:()=>{xe(K.length===z.length?[]:[...z])},children:K.length===z.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Kt=e.jsx(k,{open:kt,title:"Confirm Deletion",onClose:()=>{ze(!1)},primaryAction:{content:"Delete",onAction:Ft,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>ze(!1)}],children:e.jsx(k.Section,{children:e.jsxs(P,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(u,{paddingBlock:"200",children:e.jsx(j,{gap:"100",children:K.map(t=>e.jsx($,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",b?"ALL":h.length," selected products."]}),e.jsx(r,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),He=async()=>{try{A(!0),I("Syncing products from Shopify...");const t=await w("/api/products/sync",{method:"POST",shop:d});if(t.success){const n=t.productsCount||t.synced||0;I(`âœ… Synced ${n} products successfully!`),setTimeout(()=>{ae(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),I(`âŒ Sync failed: ${t.message}`)}finally{A(!1)}},Vt=e.jsx(os,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Qe(""),Pe("all"),he(""),Ie([]),ae(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:He},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Zt,{globalPlan:f}),e.jsx(mt,{children:e.jsxs(u,{padding:"400",children:[e.jsxs(P,{gap:"300",children:[Y&&e.jsx(ye,{tone:"info",children:e.jsxs(j,{gap:"200",align:"space-between",children:[e.jsxs(r,{children:["Your ",e.jsx("strong",{children:Y})," plan includes up to"," ",e.jsx("strong",{children:O})," products for SEO optimization.",D>O&&e.jsxs(e.Fragment,{children:[" You have ",D," products, so only the first ",O," will be processed."]})]}),(h.length>0||b)&&e.jsxs(r,{children:["Selected: ",b?Math.min(D,O):h.length,"/",O]})]})}),Y&&(h.length>O||b&&D>O)&&e.jsx(ye,{tone:"critical",children:e.jsxs(P,{gap:"200",children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),e.jsxs(r,{children:["Your ",e.jsx("strong",{children:Y})," plan supports up to ",e.jsx("strong",{children:O})," products. You have selected ",e.jsx("strong",{children:b?D:h.length})," products."]}),e.jsx(r,{children:"Please deselect some products or upgrade your plan to continue."}),e.jsxs(j,{gap:"200",children:[e.jsx(E,{onClick:()=>{ie([]),ue(!1)},children:"Clear Selection"}),e.jsx(E,{variant:"primary",onClick:()=>{G({error:"Product limit exceeded",message:`Your ${Y} plan supports up to ${O} products. Upgrade to ${$e(b?D:h.length)} to optimize more products.`,minimumPlanRequired:$e(b?D:h.length)}),X(!0)},children:"Upgrade Plan"})]})]})}),e.jsxs(j,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(u,{minWidth:"400px",children:e.jsx(ss,{label:"",placeholder:"Search by product ID, name, or details...",value:te,onChange:lt,prefix:e.jsx(ns,{}),clearButton:!0,onClearButtonClick:()=>lt("")})}),e.jsx(u,{width:"320px",children:e.jsx(E,{primary:!0,onClick:$t,disabled:h.length===0&&!b,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(j,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(E,{onClick:He,disabled:ee,size:"medium",children:"Sync Products"}),e.jsx(u,{width:"320px",children:e.jsxs(P,{gap:"200",align:"end",children:[(()=>{if(h.length===0&&!b||!y.filter(p=>h.includes(p.id)).some(p=>{var i,l;return((l=(i=p.optimizationSummary)==null?void 0:i.optimizedLanguages)==null?void 0:l.length)>0}))return null;const s=["professional","professional_plus","professional plus","growth","growth_plus","growth plus","growth_extra","growth extra","enterprise"].includes(V.toLowerCase().replace(/_/g," "));return e.jsx(E,{onClick:s?Ut:()=>{G({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),X(!0)},disabled:h.length===0&&!b,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(E,{onClick:Dt,disabled:h.length===0&&!b||!y.filter(s=>h.includes(s.id)).some(s=>{var p,i;return((i=(p=s.optimizationSummary)==null?void 0:p.optimizedLanguages)==null?void 0:i.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),D>0&&e.jsx(u,{paddingBlockStart:"300",children:e.jsx(Ee,{label:`Select all ${D} products in your store`,checked:b,onChange:ct})})]})}),e.jsx(u,{paddingBlockStart:"400",children:e.jsxs(mt,{children:[e.jsxs(u,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(j,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(j,{gap:"200",wrap:!0,children:[e.jsx(Te,{active:Je,activator:e.jsx(E,{disclosure:"down",onClick:()=>De(!Je),removeUnderline:!0,children:e.jsxs(j,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),B!=="all"&&e.jsx(u,{onClick:t=>{t.stopPropagation(),Pe("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>De(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(Re,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[B],onChange:t=>{Pe(t[0]),he(""),De(!1)}})})}),e.jsx(Te,{active:Xe,activator:e.jsx(E,{disclosure:"down",onClick:()=>Ue(!Xe),removeUnderline:!0,children:e.jsxs(j,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),U&&e.jsx(u,{onClick:t=>{t.stopPropagation(),he("")},children:e.jsx(r,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Ue(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(Re,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...z.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...z.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:U?[U]:[],onChange:t=>{he(t[0]||""),Ue(!1)}})})}),e.jsx(Te,{active:Ze,activator:e.jsx(E,{disclosure:"down",onClick:()=>We(!Ze),removeUnderline:!0,children:e.jsxs(j,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),N.length>0&&e.jsx(u,{onClick:t=>{t.stopPropagation(),Ie([])},children:e.jsx(r,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>We(!1),children:e.jsxs(u,{padding:"300",minWidth:"200px",children:[e.jsx(Re,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:jt.map(t=>({label:t,value:t})),selected:N,onChange:t=>{Ie(t)}}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(E,{size:"slim",onClick:()=>We(!1),children:"Apply"})})]})})]}),e.jsx(Te,{active:et,activator:e.jsx(E,{disclosure:"down",onClick:()=>Be(!et),removeUnderline:!0,children:e.jsx(j,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:oe==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Be(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(Re,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[oe],onChange:t=>{St(t[0]),Be(!1)}})})})]}),(B!=="all"||U||N.length>0)&&e.jsx(u,{paddingBlockStart:"200",children:e.jsxs(j,{gap:"100",wrap:!0,children:[B!=="all"&&e.jsx($,{onRemove:()=>Pe("all"),children:B==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),U&&e.jsx($,{onRemove:()=>he(""),children:U.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),N.map(t=>e.jsxs($,{onRemove:()=>Ie(n=>n.filter(s=>s!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(u,{children:[e.jsx(u,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(j,{gap:"200",align:"start",children:[e.jsx(Ee,{checked:h.length===y.length&&y.length>0,onChange:ct,label:""}),e.jsxs(r,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",h.length>0&&` (${h.length} selected products)`]})]})}),e.jsx(as,{resourceName:{singular:"product",plural:"products"},items:y,renderItem:Nt,selectedItems:h,onSelectionChange:Rt,selectable:!0,loading:ee,totalItemsCount:D,emptyState:Vt,showHeader:!1},`products-${y.length}-${h.length}`)]}),Ae&&!ee&&e.jsx(u,{padding:"400",textAlign:"center",children:e.jsx(E,{onClick:()=>ae(we+1,!0,null),children:"Load more"})})]})}),_t,Yt,Gt,Ht,Kt,Wt(),e.jsx(k,{open:Ot,onClose:()=>Oe(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Oe(!1),He()}},secondaryActions:[{content:"Skip for now",onAction:()=>Oe(!1)}],children:e.jsx(k.Section,{children:e.jsxs(P,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(r,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(es,{open:_e,onClose:()=>{X(!1),G(null)},featureName:(m==null?void 0:m.error)||"Feature",errorMessage:m==null?void 0:m.message,currentPlan:(m==null?void 0:m.currentPlan)||V,minimumPlanRequired:m==null?void 0:m.minimumPlanRequired,features:m==null?void 0:m.features}),m&&e.jsxs(e.Fragment,{children:[e.jsx(ts,{open:Et,onClose:()=>{Ye(!1),G(null)},tokensRequired:m.tokensRequired||0,tokensAvailable:m.tokensAvailable||0,tokensNeeded:m.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:d,needsUpgrade:m.needsUpgrade||!1,minimumPlan:m.minimumPlanForFeature||null,currentPlan:m.currentPlan||V}),e.jsx(ls,{open:Tt,onClose:()=>{ot(!1),G(null)},feature:m.feature||"ai-seo-product-enhanced",trialEndsAt:m.trialEndsAt,currentPlan:m.currentPlan||V,tokensRequired:m.tokensRequired||0,onActivatePlan:()=>{const t=new URLSearchParams(window.location.search),n=t.get("host"),s=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${s}&host=${encodeURIComponent(n)}`},onPurchaseTokens:()=>{const t=new URLSearchParams(window.location.search),n=t.get("host"),s=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${s}&host=${encodeURIComponent(n)}`}})]}),at&&e.jsx(rs,{content:at,onDismiss:()=>I("")})]})}export{Ss as default};
