import{j as e}from"./app-bridge-DzR1_xWd-1760731106121.js";import{r as l}from"./react-vendor-tAaa2TlE-1760731106121.js";import{m as ne}from"./sessionFetch-CJepNHo3-1760731106121.js";import{L as g,C as p,a as o,T as a,d as ae,e as r,f as A,I as d,B as h,D as b,g as te,h as O,i as ie}from"./polaris-cyq9o3NP-1760731106121.js";const se=(k,u="")=>{try{return new URLSearchParams(window.location.search).get(k)||u}catch{return u}};function le({shop:k}){var T,W,I,$,N,R,F,V;const u=k||se("shop",""),m=l.useMemo(()=>ne(),[]),x=t=>{const s=new URLSearchParams(window.location.search),ee=s.toString()?`?${s.toString()}`:"";window.location.href=`${t}${ee}`},[_,D]=l.useState(!0),[n,G]=l.useState(null),[i,U]=l.useState(null),[M,q]=l.useState(null),[c,S]=l.useState(null),[f,y]=l.useState(!1),[Q,w]=l.useState(!1),j=l.useRef(null),[v,Y]=l.useState(!1);l.useEffect(()=>(E(),H(),()=>{j.current&&(clearInterval(j.current),j.current=null)}),[u]),l.useEffect(()=>{c&&c.autoSyncEnabled&&!c.synced&&z()},[c]);const E=async()=>{try{D(!0);const[t,s]=await Promise.all([m(`/api/dashboard/stats?shop=${u}`),m(`/api/billing/tokens/balance?shop=${u}`)]);t&&(G(t),U(t.subscription)),s&&q(s)}catch(t){console.error("[Dashboard] Error loading data:",t)}finally{D(!1)}},H=async()=>{try{const t=await m(`/api/dashboard/sync-status?shop=${u}`);t&&(S(t),w(t.autoSyncEnabled||!1),y(!!t.inProgress))}catch(t){console.error("[Dashboard] Error loading sync status:",t)}},z=async()=>{try{y(!0);const t=await m(`/api/dashboard/sync?shop=${u}`,{method:"POST"});console.log("[Dashboard] Sync start response:",t),t!=null&&t.success||t!=null&&t.inProgress?(j.current&&clearInterval(j.current),j.current=setInterval(async()=>{try{const s=await m(`/api/dashboard/sync-status?shop=${u}`);s&&(S(s),s.inProgress||(j.current&&(clearInterval(j.current),j.current=null),y(!1),E()))}catch(s){console.error("[Dashboard] Poll error:",s)}},2e3)):y(!1)}catch(t){console.error("[Dashboard] Error syncing:",t),y(!1)}},J=async t=>{try{const s=await m(`/api/dashboard/auto-sync?shop=${u}`,{method:"POST",body:{enabled:t}});s!=null&&s.success?(w(!!s.autoSyncEnabled),S({...c||{},autoSyncEnabled:!!s.autoSyncEnabled})):(w(t),S({...c||{},autoSyncEnabled:t}))}catch(s){console.error("[Dashboard] Error toggling auto-sync:",s)}},C=((T=n==null?void 0:n.products)==null?void 0:T.total)>0?Math.round(n.products.optimized/n.products.total*100):0,B=((W=n==null?void 0:n.collections)==null?void 0:W.total)>0?Math.round(n.collections.optimized/n.collections.total*100):0,L=["growth","growth_extra","enterprise"].includes(i==null?void 0:i.plan),K=["professional","growth","growth_extra","enterprise"].includes(i==null?void 0:i.plan),X=(i==null?void 0:i.plan)==="enterprise",Z=["growth_extra","enterprise"].includes(i==null?void 0:i.plan);if(_)return e.jsx(g,{children:e.jsx(g.Section,{children:e.jsx(p,{children:e.jsx(o,{padding:"400",children:e.jsx(a,{children:"Loading dashboard..."})})})})});const P=!(c!=null&&c.synced);return e.jsxs(g,{children:[e.jsx(g.Section,{children:e.jsx(a,{variant:"headingLg",as:"h1",children:"Store Overview"})}),P&&e.jsx(g.Section,{children:e.jsx(ae,{title:"Sync your store",tone:"info",action:{content:f?"Syncing...":"Sync Now",onAction:z,loading:f},children:e.jsxs(r,{gap:"200",children:[e.jsx(a,{children:"Sync products, collections, languages, and markets to get started with AI optimization."}),f&&e.jsxs(o,{paddingBlockStart:"200",children:[e.jsx(A,{progress:50,size:"small",tone:"highlight"}),e.jsx(o,{paddingBlockStart:"100",children:e.jsx(a,{variant:"bodySm",tone:"subdued",children:"Fetching store data..."})})]})]})})}),!P&&c&&e.jsx(g.Section,{children:e.jsx(p,{children:e.jsxs(r,{gap:"300",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(a,{variant:"bodyMd",fontWeight:"semibold",children:"Store Sync"}),e.jsx(o,{paddingBlockStart:"050",children:e.jsxs(a,{variant:"bodySm",tone:"subdued",children:["Last synced: ",c.lastSyncDate?new Date(c.lastSyncDate).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"]})})]}),e.jsx(h,{onClick:z,loading:f,children:"Sync Now"})]}),e.jsx(b,{}),e.jsx(te,{label:"Auto-sync on load",checked:Q,onChange:J,helpText:"Automatically sync store data when you open the dashboard"})]})})}),e.jsx(g.Section,{children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"16px"},children:[e.jsx(p,{children:e.jsxs(r,{gap:"400",children:[e.jsx(a,{variant:"headingMd",children:"Products & Collections"}),e.jsxs(r,{gap:"200",children:[e.jsxs(d,{align:"space-between",children:[e.jsx(a,{variant:"bodyMd",tone:"subdued",children:"Total"}),e.jsx(a,{variant:"bodyMd",fontWeight:"semibold",children:((I=n==null?void 0:n.products)==null?void 0:I.total)||0})]}),e.jsxs(d,{align:"space-between",children:[e.jsx(a,{variant:"bodyMd",tone:"subdued",children:"Optimized"}),e.jsx(a,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:(($=n==null?void 0:n.products)==null?void 0:$.optimized)||0})]}),(n==null?void 0:n.collections)&&e.jsxs(d,{align:"space-between",children:[e.jsx(a,{variant:"bodyMd",tone:"subdued",children:"Collections"}),e.jsxs(a,{variant:"bodyMd",fontWeight:"semibold",children:[n.collections.optimized||0,"/",n.collections.total||0]})]}),e.jsx(b,{}),e.jsxs(o,{paddingBlockStart:"200",children:[e.jsx(A,{progress:C,size:"small",tone:C===100?"success":"primary"}),e.jsx(o,{paddingBlockStart:"100",children:e.jsxs(a,{variant:"bodySm",tone:"subdued",children:[C,"% optimized"]})})]})]})]})}),L&&e.jsx(p,{children:e.jsxs(r,{gap:"400",children:[e.jsx(a,{variant:"headingMd",children:"Collections"}),e.jsxs(r,{gap:"200",children:[e.jsxs(d,{align:"space-between",children:[e.jsx(a,{variant:"bodyMd",tone:"subdued",children:"Total"}),e.jsx(a,{variant:"bodyMd",fontWeight:"semibold",children:((N=n==null?void 0:n.collections)==null?void 0:N.total)||0})]}),e.jsxs(d,{align:"space-between",children:[e.jsx(a,{variant:"bodyMd",tone:"subdued",children:"Optimized"}),e.jsx(a,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:((R=n==null?void 0:n.collections)==null?void 0:R.optimized)||0})]}),e.jsx(b,{}),e.jsxs(o,{paddingBlockStart:"200",children:[e.jsx(A,{progress:B,size:"small",tone:B===100?"success":"primary"}),e.jsx(o,{paddingBlockStart:"100",children:e.jsxs(a,{variant:"bodySm",tone:"subdued",children:[B,"% optimized"]})})]})]})]})}),e.jsx(p,{children:e.jsxs(r,{gap:"400",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsx(a,{variant:"headingMd",children:"Languages"}),(n==null?void 0:n.storeMarkets)&&n.storeMarkets.length>0&&e.jsxs(O,{tone:"info",children:[n.storeMarkets.length," markets"]})]}),e.jsx(r,{gap:"200",children:n!=null&&n.languages&&n.languages.length>0?e.jsxs(e.Fragment,{children:[n.languages.slice(0,3).map((t,s)=>e.jsxs(d,{align:"space-between",children:[e.jsxs(a,{variant:"bodyMd",tone:"subdued",children:[t.name||t.code," ",t.primary&&"★"]}),e.jsx(O,{tone:t.optimizedCount>0?"success":"subdued",children:t.optimizedCount||0})]},s)),n.languages.length>3&&e.jsxs(a,{variant:"bodySm",tone:"subdued",children:["+",n.languages.length-3," more..."]})]}):e.jsx(a,{variant:"bodyMd",tone:"subdued",children:"No language data"})}),(n==null?void 0:n.storeMarkets)&&n.storeMarkets.length>0&&e.jsxs(o,{paddingBlockStart:"200",children:[e.jsx(b,{}),e.jsx(o,{paddingBlockStart:"200",children:e.jsxs(a,{variant:"bodySm",tone:"subdued",children:["Markets: ",n.storeMarkets.slice(0,2).map(t=>t.name).join(", "),n.storeMarkets.length>2?` +${n.storeMarkets.length-2}`:""]})})]})]})})]})}),e.jsx(g.Section,{children:e.jsxs(d,{gap:"400",wrap:!0,children:[e.jsx("div",{style:{flex:"1",minWidth:"300px"},children:e.jsx(p,{children:e.jsxs(r,{gap:"300",children:[e.jsx(a,{variant:"headingMd",children:"Last Optimization"}),e.jsx(a,{variant:"bodyLg",fontWeight:"semibold",children:n!=null&&n.lastOptimization?new Date(n.lastOptimization).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}),e.jsx(h,{onClick:()=>x("/ai-seo/products"),children:"Optimize Now"})]})})}),e.jsx("div",{style:{flex:"1",minWidth:"300px"},children:e.jsx(p,{children:e.jsxs(r,{gap:"300",children:[e.jsx(a,{variant:"headingMd",children:"Token Balance"}),e.jsxs(a,{variant:"bodyLg",fontWeight:"semibold",children:[((F=M==null?void 0:M.balance)==null?void 0:F.toLocaleString())||0," tokens"]}),((i==null?void 0:i.plan)==="growth_extra"||(i==null?void 0:i.plan)==="enterprise")&&e.jsxs(a,{variant:"bodySm",tone:"subdued",children:[(i==null?void 0:i.plan)==="growth_extra"?"100M":"300M"," included monthly"]}),e.jsx(h,{variant:"primary",onClick:()=>x("/billing"),children:"Manage Tokens"})]})})})]})}),e.jsx(g.Section,{children:e.jsx(p,{children:e.jsxs(r,{gap:"400",children:[e.jsx(a,{variant:"headingMd",children:"Quick Actions"}),e.jsxs(d,{gap:"300",wrap:!0,children:[e.jsx(h,{onClick:()=>x("/ai-seo/products"),children:"Optimize Products"}),L&&e.jsx(h,{onClick:()=>x("/ai-seo/collections"),children:"Optimize Collections"}),!P&&e.jsxs(e.Fragment,{children:[e.jsx(h,{onClick:()=>x("/ai-seo/sitemap"),children:Z?"Regenerate Sitemap":"View Sitemap"}),X&&e.jsx(h,{onClick:()=>x("/ai-seo/schema-data"),children:"Regenerate Schemas"})]}),K&&e.jsx(h,{onClick:()=>x("/ai-seo/store-metadata"),children:"Store Info"})]})]})})}),e.jsx(g.Section,{children:e.jsx(p,{children:e.jsxs(r,{gap:"300",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(a,{variant:"headingMd",children:"Current Plan"}),e.jsx(o,{paddingBlockStart:"100",children:e.jsxs(a,{variant:"bodySm",tone:"subdued",children:["$",(i==null?void 0:i.price)||0,"/month"]})})]}),e.jsx(O,{tone:"info",size:"large",children:((V=i==null?void 0:i.plan)==null?void 0:V.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsx(h,{onClick:()=>x("/billing"),children:"View Plans & Billing"})]})})}),e.jsx(g.Section,{children:e.jsx(p,{children:e.jsxs(r,{gap:"300",children:[e.jsxs(d,{align:"space-between",blockAlign:"center",children:[e.jsx(a,{variant:"headingMd",children:"Getting Started"}),e.jsxs(h,{onClick:()=>Y(!v),disclosure:v?"up":"down",children:[v?"Hide":"Show"," Guide"]})]}),e.jsx(ie,{open:v,id:"onboarding-collapsible",transition:{duration:"200ms",timingFunction:"ease-in-out"},children:e.jsx(o,{paddingBlockStart:"300",children:e.jsxs(r,{gap:"400",children:[e.jsx(b,{}),e.jsxs(r,{gap:"300",children:[e.jsx(a,{variant:"headingMd",as:"h3",children:"Quick Start Guide"}),e.jsxs(r,{gap:"200",children:[e.jsx(a,{variant:"bodyMd",fontWeight:"semibold",children:"1. Sync Your Store"}),e.jsx(a,{variant:"bodyMd",tone:"subdued",children:'Click "Sync Now" to fetch your products, collections, and languages from Shopify. This is required before you can start optimizing.'}),e.jsx(a,{variant:"bodyMd",fontWeight:"semibold",children:"2. Choose a Plan"}),e.jsx(a,{variant:"bodyMd",tone:"subdued",children:"Visit Plans & Billing to select the plan that fits your store size. Each plan includes different limits for products, languages, and features."}),e.jsx(a,{variant:"bodyMd",fontWeight:"semibold",children:"3. Optimize Your Products"}),e.jsx(a,{variant:"bodyMd",tone:"subdued",children:'Go to "Search Optimization for AI" → Products tab. Select products and click "AI Enhance" to generate SEO-optimized titles, descriptions, and metadata.'}),e.jsx(a,{variant:"bodyMd",fontWeight:"semibold",children:"4. Generate AI Sitemap"}),e.jsx(a,{variant:"bodyMd",tone:"subdued",children:"Navigate to Sitemap tab and generate your AI-optimized sitemap. This helps AI search engines discover and index your products."}),e.jsx(a,{variant:"bodyMd",fontWeight:"semibold",children:"5. Monitor & Improve"}),e.jsx(a,{variant:"bodyMd",tone:"subdued",children:"Return to Dashboard regularly to track optimization progress and token usage. Enable auto-sync to keep your data fresh."})]})]}),e.jsx(b,{}),e.jsxs(r,{gap:"200",children:[e.jsx(a,{variant:"headingMd",as:"h3",children:"Video Tutorial"}),e.jsx(o,{padding:"400",background:"bg-surface-secondary",borderRadius:"200",children:e.jsxs(r,{gap:"200",inlineAlign:"center",children:[e.jsx(a,{variant:"bodyMd",tone:"subdued",alignment:"center",children:"Video tutorial coming soon"}),e.jsx(a,{variant:"bodySm",tone:"subdued",alignment:"center",children:"[Embedded video will be added here]"})]})})]}),e.jsx(o,{paddingBlockStart:"200",children:e.jsxs(d,{gap:"200",children:[e.jsx(h,{variant:"primary",onClick:()=>x("/ai-seo/products"),children:"Start Optimizing"}),e.jsx(h,{onClick:()=>x("/billing"),children:"View Plans"})]})})]})})})]})})})]})}export{le as default};
