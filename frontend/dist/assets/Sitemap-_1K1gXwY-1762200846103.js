import{j as e}from"./app-bridge-B0xSgToy-1762200846103.js";import{r as o}from"./react-vendor-tAaa2TlE-1762200846103.js";import{m as H}from"./sessionFetch-CJepNHo3-1762200846103.js";import{C as Q,B as r,a as x,d as R,I as u,n as F,T as t,b as G,o as f,p as w,q as X,M as z,k as Y}from"./polaris-DEPti0rg-1762200846103.js";const K=(S,n="")=>{try{return new URLSearchParams(window.location.search).get(S)||n}catch{return n}},C=S=>{const n=(S||"starter").toLowerCase().replace(/\s+/g,"_"),i={starter:{products:100,languages:1},professional:{products:250,languages:2},professional_plus:{products:250,languages:2},growth:{products:700,languages:3},growth_plus:{products:700,languages:3},growth_extra:{products:1e3,languages:6},enterprise:{products:2500,languages:10}};return i[n]||i.starter};function ee({shop:S}){const n=S||K("shop",""),[i,U]=o.useState(null),[v,I]=o.useState(!1),[P,h]=o.useState(""),[l,O]=o.useState(null),[a,A]=o.useState(null),[j,E]=o.useState(!1),b=o.useMemo(()=>H(),[]),[T,M]=o.useState(!1),[B,y]=o.useState(null),[L,_]=o.useState(!1),k=o.useCallback(async()=>{if(n)try{const s=await b(`/api/sitemap/info?shop=${n}`);U(s)}catch(s){h(s.message||"Failed to load sitemap info")}},[n,b]),$=o.useCallback(async()=>{var s,g,m;if(n)try{const d=await b("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
        query PlansMe($shop:String!) {
          plansMe(shop:$shop) {
            shop
            plan
            planKey
            priceUsd
            product_limit
            providersAllowed
            modelsSuggested
            autosyncCron
            trial {
              active
              ends_at
              days_left
            }
          }
        }
      `,variables:{shop:n}})});if((s=d==null?void 0:d.errors)!=null&&s.length)throw new Error(((g=d.errors[0])==null?void 0:g.message)||"GraphQL error");const p=(m=d==null?void 0:d.data)==null?void 0:m.plansMe;O(p||null)}catch{}},[n,b]),q=o.useCallback(async()=>{var s,g,m,c;if(n){I(!0),A(null);try{const d=await fetch(`/api/sitemap/generate?shop=${encodeURIComponent(n)}`,{method:"POST",credentials:"include",headers:{Authorization:`Bearer ${((m=(g=(s=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:s.getState())==null?void 0:g.session)==null?void 0:m.token)||""}`,"Content-Type":"application/json"}});if(d.ok){const p=await d.json();console.log("[SITEMAP] Generation response:",p),p.success?(h(p.message||"Sitemap generation started!"),A(p.job),(c=p.job)!=null&&c.queued&&E(!0)):h(p.message||"Sitemap generation failed")}else{const p=await d.text();h(`Sitemap generation failed: ${p}`)}}catch(d){console.error("[SITEMAP] Generation error:",d),h(d.message||"Sitemap generation failed")}finally{I(!1)}}},[n]),W=o.useCallback(async()=>{if(!(!n||!j))try{const s=await b(`/api/sitemap/status?shop=${n}`);console.log("[SITEMAP] Status:",s),A(s.queue),(s.queue.status==="completed"||s.queue.status==="failed"||s.queue.status==="idle")&&(E(!1),h(s.queue.message||"Sitemap generation completed!"),await k())}catch(s){console.error("[SITEMAP] Status check error:",s)}},[n,j,b,k]);o.useEffect(()=>{if(j){const s=setInterval(W,3e3);return()=>clearInterval(s)}},[j,W]);const D=o.useCallback(async()=>{var s,g,m;if(n){M(!0),_(!0),y(null);try{console.log("[SITEMAP] Loading Sitemap XML...");const c=await fetch(`/api/sitemap/generate?shop=${encodeURIComponent(n)}&force=true&t=${Date.now()}`,{method:"GET",credentials:"include",headers:{Authorization:`Bearer ${((m=(g=(s=window.__SHOPIFY_APP_BRIDGE__)==null?void 0:s.getState())==null?void 0:g.session)==null?void 0:m.token)||""}`}});if(c.ok){console.log("[SITEMAP] Sitemap XML loaded successfully");const d=await c.text();y(d)}else throw new Error(`HTTP ${c.status}: ${c.statusText}`)}catch(c){console.error("[SITEMAP] Error loading sitemap:",c),y(`Error loading sitemap: ${c.message}`)}finally{_(!1)}}},[n]);return o.useEffect(()=>{k(),$()},[k,$]),e.jsxs(Q,{children:[e.jsx(r,{padding:"400",children:e.jsxs(x,{gap:"400",children:[e.jsx(R,{tone:"info",children:e.jsxs("p",{children:["Your ",(l==null?void 0:l.plan)||"Starter"," plan includes up to"," ",e.jsx("strong",{children:(()=>{const s=C(l==null?void 0:l.plan);return`${s.products.toLocaleString()} products in up to ${s.languages} language${s.languages>1?"s":""}`})()}),".",(i==null?void 0:i.productCount)&&i.productCount>C(l==null?void 0:l.plan).products&&e.jsxs(e.Fragment,{children:[" You have ",i.productCount," products, so only the first"," ",C(l==null?void 0:l.plan).products.toLocaleString()," ","will be included in the sitemap."]})]})}),(j||a)&&e.jsx(R,{tone:(a==null?void 0:a.status)==="processing"?"info":(a==null?void 0:a.status)==="failed"?"critical":"success",children:e.jsxs(x,{gap:"200",children:[e.jsxs(u,{gap:"200",blockAlign:"center",children:[j&&e.jsx(F,{size:"small"}),e.jsx(t,{variant:"bodyMd",fontWeight:"medium",children:(a==null?void 0:a.message)||"Processing..."})]}),(a==null?void 0:a.position)>0&&e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Position in queue: ",a.position," | Estimated time: ~",a.estimatedTime,"s"]}),(a==null?void 0:a.queueLength)>0&&e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Queue length: ",a.queueLength," job(s)"]})]})}),e.jsxs(u,{align:"space-between",blockAlign:"center",children:[e.jsxs(r,{children:[e.jsx(t,{variant:"headingMd",as:"h3",children:"Sitemap Generator"}),e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Generate structured sitemap for AI models to discover and index your products"})]}),e.jsx(G,{primary:!0,onClick:q,loading:v,disabled:v,children:v?"Generating...":"Generate Sitemap"})]}),i&&e.jsx(r,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(x,{gap:"300",children:[e.jsx(u,{gap:"200",blockAlign:"center",children:i.generated?e.jsxs(e.Fragment,{children:[e.jsx(f,{source:w,tone:"success"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",tone:"success",children:"Sitemap Active"})]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{source:X}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"No Sitemap Found"})]})}),i.generated&&e.jsxs(x,{gap:"400",children:[e.jsx(r,{children:e.jsxs(x,{gap:"200",children:[e.jsx(r,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(u,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Products included"}),e.jsxs(t,{variant:"bodyMd",fontWeight:"semibold",children:[i.lastProductCount||0," URLs"]})]})}),e.jsx(r,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(u,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"File size"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:i.size?`${(i.size/1024).toFixed(2)} KB`:"Unknown"})]})}),e.jsx(r,{paddingBlockEnd:"200",borderBlockEndWidth:"025",borderColor:"border-subdued",children:e.jsxs(u,{align:"space-between",children:[e.jsx(t,{variant:"bodyMd",color:"subdued",children:"Last updated"}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:i.generatedAt?new Date(i.generatedAt).toLocaleString():"Unknown"})]})})]})}),e.jsx(r,{children:e.jsx(G,{fullWidth:!0,onClick:D,children:"View Sitemap"})})]})]})}),e.jsxs(r,{paddingBlockStart:"400",children:[e.jsx(t,{variant:"headingMd",as:"h4",children:"What's included:"}),e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(x,{gap:"200",children:[e.jsxs(u,{gap:"200",blockAlign:"start",children:[e.jsx(r,{minWidth:"24px",children:e.jsx(f,{source:w,tone:"positive"})}),e.jsx(t,{children:"All active products with structured URLs for AI parsing"})]}),e.jsxs(u,{gap:"200",blockAlign:"start",children:[e.jsx(r,{minWidth:"24px",children:e.jsx(f,{source:w,tone:"positive"})}),e.jsx(t,{children:"Priority rankings to help AI models understand product importance"})]}),e.jsxs(u,{gap:"200",blockAlign:"start",children:[e.jsx(r,{minWidth:"24px",children:e.jsx(f,{source:w,tone:"positive"})}),e.jsx(t,{children:"Multi-language URLs for international AI search coverage"})]}),e.jsxs(u,{gap:"200",blockAlign:"start",children:[e.jsx(r,{minWidth:"24px",children:e.jsx(f,{source:w,tone:"positive"})}),e.jsx(t,{children:"Standard XML format that AI crawlers understand"})]})]})})]}),e.jsxs(r,{paddingBlockStart:"200",children:[e.jsx(t,{variant:"headingMd",as:"h4",children:"How it helps AI models:"}),e.jsx(r,{paddingBlockStart:"200",children:e.jsxs(x,{gap:"200",children:[e.jsx(t,{children:'1. Click "Generate Sitemap" to create a structured map of your products'}),e.jsx(t,{children:"2. The sitemap is automatically saved and available to AI crawlers"}),e.jsx(t,{children:"3. AI models can discover and understand your product catalog structure"}),e.jsx(t,{children:"4. Regenerate when you add new products to keep AI models updated"})]})})]})]})}),T&&e.jsx(z,{open:T,onClose:()=>{M(!1),y(null)},title:"AI-Optimized Sitemap",primaryAction:{content:"Copy",onAction:()=>{navigator.clipboard.writeText(B),h("Copied to clipboard!")},disabled:L},secondaryActions:[{content:"Close",onAction:()=>{M(!1),y(null)}}],children:e.jsx(z.Section,{children:e.jsx(r,{padding:"200",background:"bg-surface-secondary",borderRadius:"100",children:L?e.jsxs(u,{align:"center",gap:"200",children:[e.jsx(F,{size:"small"}),e.jsx(t,{variant:"bodyMd",children:"Loading sitemap XML... This may take a moment for large stores."})]}):e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"12px",margin:0,overflow:"auto",maxHeight:"400px"},children:B})})})}),P&&e.jsx(Y,{content:P,onDismiss:()=>h("")})]})}export{ee as default};
