import{j as e}from"./app-bridge-ArT_Lf8p-1760773727917.js";import{r as d}from"./react-vendor-tAaa2TlE-1760773727917.js";import{m as ye}from"./sessionFetch-CJepNHo3-1760773727917.js";import{L as g,C as x,a as l,T as t,d as $,e as s,f as C,I as c,B as S,D as w,g as be,h as Se,i as fe}from"./polaris-BgE3axv6-1760773727917.js";const ve=(L,h="")=>{try{return new URLSearchParams(window.location.search).get(L)||h}catch{return h}};function Ce({shop:L}){var R,V,G,Y,H,q,Q,J,K,X,Z,ee;const h=L||ve("shop",""),f=d.useMemo(()=>ye(),[]),j=a=>{const o=new URLSearchParams(window.location.search),b=o.toString()?`?${o.toString()}`:"";window.location.href=`${a}${b}`},[se,W]=d.useState(!0),[n,ie]=d.useState(null),[r,de]=d.useState(null),[y,le]=d.useState(null),[i,k]=d.useState(null),[M,v]=d.useState(!1),[ce,B]=d.useState(!1),u=d.useRef(null),[P,he]=d.useState(!1);d.useEffect(()=>(I(),ue(),()=>{u.current&&(clearInterval(u.current),u.current=null)}),[h]),d.useEffect(()=>{i&&i.autoSyncEnabled&&!i.synced&&D()},[i]);const I=async()=>{try{W(!0);const[a,o]=await Promise.all([f(`/api/dashboard/stats?shop=${h}`),f(`/api/billing/tokens/balance?shop=${h}`)]);a&&(ie(a),de(a.subscription)),o&&le(o)}catch(a){console.error("[Dashboard] Error loading data:",a)}finally{W(!1)}},ue=async()=>{try{const a=await f(`/api/dashboard/sync-status?shop=${h}`);a&&(k(a),B(a.autoSyncEnabled||!1),v(!!a.inProgress))}catch(a){console.error("[Dashboard] Error loading sync status:",a)}},D=async()=>{try{v(!0);const a=await f(`/api/dashboard/sync?shop=${h}`,{method:"POST"});console.log("[Dashboard] Sync start response:",a),a!=null&&a.success||a!=null&&a.inProgress?(u.current&&clearInterval(u.current),u.current=setInterval(async()=>{try{const o=await f(`/api/dashboard/sync-status?shop=${h}`);o&&(k(o),o.inProgress||(u.current&&(clearInterval(u.current),u.current=null),v(!1),I()))}catch(o){console.error("[Dashboard] Poll error:",o)}},2e3)):v(!1)}catch(a){console.error("[Dashboard] Error syncing:",a),v(!1)}},ge=async a=>{try{const o=await f(`/api/dashboard/auto-sync?shop=${h}`,{method:"POST",body:{enabled:a}});o!=null&&o.success?(B(!!o.autoSyncEnabled),k({...i||{},autoSyncEnabled:!!o.autoSyncEnabled})):(B(a),k({...i||{},autoSyncEnabled:a}))}catch(o){console.error("[Dashboard] Error toggling auto-sync:",o)}},O=((R=n==null?void 0:n.products)==null?void 0:R.total)>0?Math.round(n.products.optimized/n.products.total*100):0,A=((V=n==null?void 0:n.collections)==null?void 0:V.total)>0?Math.round(n.collections.optimized/n.collections.total*100):0;["growth","growth_extra","enterprise"].includes(r==null?void 0:r.plan),["professional","growth","growth_extra","enterprise"].includes(r==null?void 0:r.plan),r==null||r.plan,["growth_extra","enterprise"].includes(r==null?void 0:r.plan);const N=d.useMemo(()=>({starter:9.99,professional:15.99,growth:29.99,growth_extra:49.99,enterprise:139.99}),[]),_=r!=null&&r.price&&r.price>0?r.price:r!=null&&r.plan?N[r.plan]:void 0,E=a=>{switch(a){case"starter":return{products:100,languages:1};case"professional":return{products:250,languages:2};case"growth":return{products:700,languages:3};case"growth_extra":return{products:1e3,languages:6};case"enterprise":return{products:2500,languages:10};default:return{products:0,languages:0}}},U=a=>({starter:1,professional:2,growth:3,growth_extra:4,enterprise:5})[a]||0,pe=()=>{var te,ae;if(!n)return null;const a=((te=n.products)==null?void 0:te.total)||0,o=((ae=n.languages)==null?void 0:ae.length)||1,b=(r==null?void 0:r.plan)||"starter",xe=U(b),je=["starter","professional","growth","growth_extra","enterprise"];let m=null;for(const re of je){const oe=E(re);if(a<=oe.products&&o<=oe.languages){m=re;break}}if(m||(m="enterprise"),U(m)<=xe)return null;const z=E(b),ne=E(m);let T="";return a>z.products?T=`Your store has ${a} products, exceeding the ${z.products}-product limit of your current plan.`:o>z.languages&&(T=`Your store has ${o} language(s), exceeding the ${z.languages}-language limit of your current plan.`),{plan:m,planName:m.replace("_"," ").toUpperCase(),price:N[m],productLimit:ne.products,languageLimit:ne.languages,reason:T}},p=d.useMemo(()=>pe(),[n,r]),me=d.useMemo(()=>{if(!(r!=null&&r.plan))return!1;const a=r.plan;return!(a!=="professional"&&a!=="growth"||((y==null?void 0:y.balance)||0)>=1e3)},[r,y]);if(se)return e.jsx(g,{children:e.jsx(g.Section,{children:e.jsx(x,{children:e.jsx(l,{padding:"400",children:e.jsx(t,{children:"Loading dashboard..."})})})})});const F=!(i!=null&&i.synced);return e.jsxs(g,{children:[F&&e.jsx(g.Section,{children:e.jsx($,{title:"Sync your store",tone:"info",action:{content:M?"Syncing...":"Sync Now",onAction:D,loading:M},children:e.jsxs(s,{gap:"200",children:[e.jsx(t,{children:"Sync products, collections, languages, and markets to get started with AI optimization."}),M&&e.jsxs(l,{paddingBlockStart:"200",children:[e.jsx(C,{progress:50,size:"small",tone:"highlight"}),e.jsx(l,{paddingBlockStart:"100",children:e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Fetching store data..."})})]})]})})}),!F&&i&&e.jsx(g.Section,{children:e.jsx(x,{children:e.jsxs(s,{gap:"300",children:[e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"Store Sync"}),e.jsx(l,{paddingBlockStart:"050",children:e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Last synced: ",i.lastSyncDate?new Date(i.lastSyncDate).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"]})})]}),e.jsx(S,{onClick:D,loading:M,children:"Sync Now"})]}),e.jsx(w,{}),e.jsx(be,{label:"Auto-sync on load",checked:ce,onChange:ge,helpText:"Automatically sync store data when you open the dashboard"})]})})}),p&&e.jsx(g.Section,{children:e.jsx($,{title:`Upgrade to ${p.planName} Plan`,tone:"warning",action:{content:"View Plans",onAction:()=>j("/billing")},children:e.jsxs(s,{gap:"200",children:[e.jsx(t,{children:p.reason}),e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["The ",p.planName," plan supports up to ",p.productLimit," products in ",p.languageLimit," language",p.languageLimit>1?"s":"","for $",p.price,"/month."]})]})})}),me&&e.jsx(g.Section,{children:e.jsx($,{title:"Buy Tokens to Unlock AI Features",tone:"info",action:{content:"Buy Tokens",onAction:()=>j("/billing")},children:e.jsx(t,{children:"Your current plan uses pay-per-use tokens. Purchase tokens to access AI-enhanced optimization features like SEO generation, bulk editing, and AI Discovery."})})}),e.jsx(g.Section,{children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:"16px"},children:[e.jsxs("div",{style:{display:"grid",gap:16},children:[e.jsx(x,{children:e.jsxs(s,{gap:"400",children:[e.jsx(t,{variant:"headingMd",children:"Products & Collections"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs(s,{gap:"150",children:[e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"Products"}),e.jsxs(c,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Total"}),e.jsx(t,{variant:"bodySm",fontWeight:"semibold",children:((G=n==null?void 0:n.products)==null?void 0:G.total)||0})]}),e.jsxs(c,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Optimized"}),e.jsx(t,{variant:"bodySm",fontWeight:"semibold",tone:"success",children:((Y=n==null?void 0:n.products)==null?void 0:Y.optimized)||0})]}),e.jsxs(c,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Unoptimized"}),e.jsx(t,{variant:"bodySm",fontWeight:"semibold",children:Math.max((((H=n==null?void 0:n.products)==null?void 0:H.total)||0)-(((q=n==null?void 0:n.products)==null?void 0:q.optimized)||0),0)})]}),e.jsxs(l,{paddingBlockStart:"100",children:[e.jsx(C,{progress:O,size:"small",tone:O===100?"success":"primary"}),e.jsx(l,{paddingBlockStart:"050",children:e.jsxs(t,{variant:"bodySm",tone:"subdued",children:[O,"% optimized"]})})]})]}),e.jsxs(s,{gap:"150",children:[e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"Collections"}),e.jsxs(c,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Total"}),e.jsx(t,{variant:"bodySm",fontWeight:"semibold",children:((Q=n==null?void 0:n.collections)==null?void 0:Q.total)||0})]}),e.jsxs(c,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Optimized"}),e.jsx(t,{variant:"bodySm",fontWeight:"semibold",tone:"success",children:((J=n==null?void 0:n.collections)==null?void 0:J.optimized)||0})]}),e.jsxs(c,{align:"space-between",children:[e.jsx(t,{variant:"bodySm",tone:"subdued",children:"Unoptimized"}),e.jsx(t,{variant:"bodySm",fontWeight:"semibold",children:Math.max((((K=n==null?void 0:n.collections)==null?void 0:K.total)||0)-(((X=n==null?void 0:n.collections)==null?void 0:X.optimized)||0),0)})]}),e.jsxs(l,{paddingBlockStart:"100",children:[e.jsx(C,{progress:A,size:"small",tone:A===100?"success":"primary"}),e.jsx(l,{paddingBlockStart:"050",children:e.jsxs(t,{variant:"bodySm",tone:"subdued",children:[A,"% optimized"]})})]})]})]}),e.jsx(w,{}),e.jsx(c,{align:"space-between",children:e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Last synced: ",i!=null&&i.lastSyncDate?new Date(i.lastSyncDate).toLocaleString():"Never"]})})]})}),e.jsx(x,{style:{height:220,minHeight:220},children:e.jsxs(s,{gap:"300",children:[e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(t,{variant:"headingMd",children:"Current Plan"}),e.jsx(l,{paddingBlockStart:"100",children:e.jsxs(t,{variant:"bodySm",tone:"subdued",children:[_?`$${_.toFixed(2)}`:"â€”","/month"]})})]}),e.jsx(Se,{tone:"info",size:"large",children:((Z=r==null?void 0:r.plan)==null?void 0:Z.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsx(S,{onClick:()=>j("/billing"),children:"View Plans & Billing"})]})})]}),e.jsxs("div",{style:{display:"grid",gap:16},children:[e.jsx(x,{children:e.jsxs(s,{gap:"400",children:[e.jsx(t,{variant:"headingMd",children:"Languages & Markets"}),e.jsx(s,{gap:"200",children:n!=null&&n.languages&&n.languages.length>0?e.jsxs(e.Fragment,{children:[n.languages.slice().sort((a,o)=>(o.primary?1:0)-(a.primary?1:0)||(o.totalCount||0)-(a.totalCount||0)).slice(0,3).map((a,o)=>{const b=a.totalCount>0?Math.round(a.optimizedCount/a.totalCount*100):0;return e.jsxs(s,{gap:"050",children:[e.jsxs(c,{align:"space-between",children:[e.jsxs(t,{variant:"bodyMd",tone:"subdued",children:[a.name||a.code," ",a.primary?"â˜…":""]}),e.jsxs(t,{variant:"bodySm",fontWeight:"semibold",children:[a.optimizedCount||0,"/",a.totalCount||0]})]}),e.jsx(C,{progress:b,size:"small",tone:b===100?"success":"primary"})]},o)}),n.languages.length>3&&e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["+",n.languages.length-3," more..."]})]}):e.jsx(t,{variant:"bodyMd",tone:"subdued",children:"No language data"})}),(n==null?void 0:n.storeMarkets)&&n.storeMarkets.length>0&&e.jsxs(l,{paddingBlockStart:"200",children:[e.jsx(w,{}),e.jsx(l,{paddingBlockStart:"200",children:e.jsxs(t,{variant:"bodySm",tone:"subdued",children:["Markets: ",n.storeMarkets.slice(0,2).map(a=>a.name).join(", "),n.storeMarkets.length>2?` +${n.storeMarkets.length-2}`:""]})})]})]})}),e.jsx(x,{children:e.jsxs(s,{gap:"300",children:[e.jsx(t,{variant:"headingMd",children:"Last Optimization"}),e.jsx(t,{variant:"bodyLg",fontWeight:"semibold",children:n!=null&&n.lastOptimization?new Date(n.lastOptimization).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}),e.jsx(S,{onClick:()=>j("/ai-seo/products"),children:"Optimize Now"})]})}),e.jsx(x,{style:{height:220,minHeight:220},children:e.jsxs(s,{gap:"300",children:[e.jsx(t,{variant:"headingMd",children:"Token Balance"}),e.jsxs(t,{variant:"bodyLg",fontWeight:"semibold",children:[((ee=y==null?void 0:y.balance)==null?void 0:ee.toLocaleString())||0," tokens"]}),((r==null?void 0:r.plan)==="growth_extra"||(r==null?void 0:r.plan)==="enterprise")&&e.jsxs(t,{variant:"bodySm",tone:"subdued",children:[(r==null?void 0:r.plan)==="growth_extra"?"100M":"300M"," included monthly"]}),e.jsx(S,{onClick:()=>j("/billing"),children:"Manage Tokens"})]})})]})]})}),e.jsx(g.Section,{children:e.jsx(x,{children:e.jsxs(s,{gap:"300",children:[e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsx(t,{variant:"headingMd",children:"Getting Started"}),e.jsxs(S,{onClick:()=>he(!P),disclosure:P?"up":"down",children:[P?"Hide":"Show"," Guide"]})]}),e.jsx(fe,{open:P,id:"onboarding-collapsible",transition:{duration:"200ms",timingFunction:"ease-in-out"},children:e.jsx(l,{paddingBlockStart:"300",children:e.jsxs(s,{gap:"400",children:[e.jsx(w,{}),e.jsxs(s,{gap:"300",children:[e.jsx(t,{variant:"headingMd",as:"h3",children:"Quick Start Guide"}),e.jsxs(s,{gap:"200",children:[e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"1. Sync Your Store"}),e.jsx(t,{variant:"bodyMd",tone:"subdued",children:'Click "Sync Now" to fetch your products, collections, and languages from Shopify. This is required before you can start optimizing.'}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"2. Choose a Plan"}),e.jsx(t,{variant:"bodyMd",tone:"subdued",children:"Visit Plans & Billing to select the plan that fits your store size. Each plan includes different limits for products, languages, and features."}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"3. Optimize Your Products"}),e.jsx(t,{variant:"bodyMd",tone:"subdued",children:'Go to "Search Optimization for AI" â†’ Products tab. Select products and click "AI Enhance" to generate SEO-optimized titles, descriptions, and metadata.'}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"4. Generate AI Sitemap"}),e.jsx(t,{variant:"bodyMd",tone:"subdued",children:"Navigate to Sitemap tab and generate your AI-optimized sitemap. This helps AI search engines discover and index your products."}),e.jsx(t,{variant:"bodyMd",fontWeight:"semibold",children:"5. Monitor & Improve"}),e.jsx(t,{variant:"bodyMd",tone:"subdued",children:"Return to Dashboard regularly to track optimization progress and token usage. Enable auto-sync to keep your data fresh."})]})]}),e.jsx(w,{}),e.jsxs(s,{gap:"200",children:[e.jsx(t,{variant:"headingMd",as:"h3",children:"Video Tutorial"}),e.jsx(l,{padding:"400",background:"bg-surface-secondary",borderRadius:"200",children:e.jsxs(s,{gap:"200",inlineAlign:"center",children:[e.jsx(t,{variant:"bodyMd",tone:"subdued",alignment:"center",children:"Video tutorial coming soon"}),e.jsx(t,{variant:"bodySm",tone:"subdued",alignment:"center",children:"[Embedded video will be added here]"})]})})]}),e.jsx(l,{paddingBlockStart:"200",children:e.jsxs(c,{gap:"200",children:[e.jsx(S,{variant:"primary",onClick:()=>j("/ai-seo/products"),children:"Start Optimizing"}),e.jsx(S,{onClick:()=>j("/billing"),children:"View Plans"})]})})]})})})]})})})]})}export{Ce as default};
