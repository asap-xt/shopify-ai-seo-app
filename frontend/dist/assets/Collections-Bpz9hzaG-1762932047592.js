import{j as e}from"./app-bridge-Bu4-VK8z-1762932047592.js";import{r as o}from"./react-vendor-tAaa2TlE-1762932047592.js";import{m as Pt}from"./sessionFetch-CJepNHo3-1762932047592.js";import{S as kt,U as Ot}from"./StoreMetadataBanner-De2IoXFk-1762932047592.js";import{I as It}from"./InsufficientTokensModal-C6k4hgzn-1762932047592.js";import{T as Et}from"./TrialActivationModal-TQpCYg_p-1762932047592.js";import{M as S,a as L,T as r,e as me,d as Tt,b as M,B as c,I as w,g as Fe,D as Dt,f as V,C as _e,h as zt,S as $t,i as qe,j as Ke,R as Rt,k as Bt,m as Ut,E as Wt}from"./polaris-bceqWWV4-1762932047592.js";const Nt=(le,j="")=>{try{return new URLSearchParams(window.location.search).get(le)||j}catch{return j}};function ms({shop:le,globalPlan:j}){var Ue,We,Ne;const d=le||Nt("shop",""),b=o.useMemo(()=>Pt(),[]),[f,Se]=o.useState([]),[xe,je]=o.useState(!1),[q,He]=o.useState(0),[p,K]=o.useState([]),[C,X]=o.useState(!1),[Ft,_t]=o.useState(""),[z,ae]=o.useState(""),[P,ee]=o.useState("all"),[qt,Kt]=o.useState(""),[Ht,Jt]=o.useState([]),[Gt,Yt]=o.useState([]),[ye,re]=o.useState(!1),[Zt,Qt]=o.useState(!1),[Vt,Xt]=o.useState(!1),[we,ie]=o.useState(!1),[k,Je]=o.useState("updatedAt"),[O,Ge]=o.useState("desc"),[Ye,Ze]=o.useState(""),[es,Qe]=o.useState([]),[v,U]=o.useState([]),[A,be]=o.useState([]),[ce,H]=o.useState(!1),[E,$]=o.useState({current:0,total:0,percent:0}),[Ce,J]=o.useState(""),[G,ve]=o.useState([]),[ts,ss]=o.useState(!1),[ns,os]=o.useState(null),[ls,as]=o.useState(!1),[rs,Ve]=o.useState(""),[Xe,te]=o.useState(!1),[W,N]=o.useState([]),[Ae,Le]=o.useState(!1),[et,Y]=o.useState(!1),[Me,Pe]=o.useState(!1),[tt,se]=o.useState(!1),[ke,ne]=o.useState([]),[R,de]=o.useState({}),[st,ue]=o.useState(!1),[nt,he]=o.useState(!1),[Oe,is]=o.useState({}),[ot,pe]=o.useState(!1),[Ie,ge]=o.useState(null),[lt,Ee]=o.useState(!1),[Te,m]=o.useState(""),[De,ze]=o.useState(!1),[at,Z]=o.useState(!1),[rt,$e]=o.useState(!1),[it,Re]=o.useState(!1),[g,F]=o.useState(null),[I,Q]=o.useState("starter"),[T,fe]=o.useState(1);o.useEffect(()=>{if(!(!j||typeof j!="object")){if(j.planKey&&j.planKey!==""){Q(j.planKey);const s={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[j.planKey.toLowerCase()]||1;fe(s)}else if(j.plan&&j.plan!==""){const t=j.plan.toLowerCase().replace(/\s+/g,"-");Q(t);const n={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[t]||1;fe(n)}}},[j]);const[y,B]=o.useState({processing:!1,current:0,total:0,currentItem:"",results:null});o.useEffect(()=>{if(!d)return;b("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
        }
      }
    `,variables:{shop:d}})}).then(s=>{var u,x,_;if((u=s==null?void 0:s.errors)!=null&&u.length)throw new Error(((x=s.errors[0])==null?void 0:x.message)||"GraphQL error");const n=(_=s==null?void 0:s.data)==null?void 0:_.plansMe,l=(n==null?void 0:n.modelsSuggested)||["google/gemini-1.5-flash"];Qe(l.map(h=>({label:h,value:h}))),Ze(l[0]),Q((n==null?void 0:n.planKey)||"starter");const i=((n==null?void 0:n.planKey)||"starter").toLowerCase();fe({starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[i]||1)}).catch(s=>m(`Error loading models: ${s.message}`))},[d,b]),o.useEffect(()=>{d&&b(`/api/languages/shop/${d}?shop=${d}`).then(t=>{const s=(t==null?void 0:t.shopLanguages)||["en"];be(s),U([])}).catch(t=>{console.error("[COLLECTIONS] Languages API error:",t),be(["en"]),U([])})},[d,b]);const ct=async()=>{try{Pe(!0);const t=await b(`/api/collections/sync?shop=${d}`,{method:"POST"});t!=null&&t.success?(m("Collections synced successfully!"),await D()):(console.error("[COLLECTIONS] Sync failed:",t),m("Failed to sync collections"))}catch(t){console.error("[COLLECTIONS] Sync error:",t),m("Error syncing collections")}finally{Pe(!1)}},D=o.useCallback(async()=>{je(!0);try{const s=`/collections/list-graphql?${new URLSearchParams({shop:d,...z&&{search:z},...P!=="all"&&{optimized:P},sortBy:k,sortOrder:O})}`;let l=(await b(s)).collections||[];if(z){const i=z.toLowerCase();l=l.filter(a=>a.title.toLowerCase().includes(i)||a.handle.toLowerCase().includes(i))}P!=="all"&&(l=l.filter(i=>P==="true"?i.hasSeoData:!i.hasSeoData)),Se(l),He(l.length)}catch(t){m(`Error loading collections: ${t.message}`)}finally{je(!1)}},[d,z,P,k,O,b]);o.useEffect(()=>{d&&(D(),Y(!1))},[d,P,k,O,D]),o.useEffect(()=>{const t=setTimeout(()=>{d&&D()},500);return()=>clearTimeout(t)},[z]);const dt=o.useCallback(t=>{K(t);const s=t.some(n=>{const l=f.find(i=>i.id===n);return l==null?void 0:l.hasSeoData});Y(s),t.length===0&&X(!1)},[f]),ut=o.useCallback(t=>{if(X(t),t){K(f.map(n=>n.id));const s=f.some(n=>n.hasSeoData);Y(s)}else K([]),Y(!1)},[f]),ht=async t=>{Ee(!0);try{const s=`/collections/${t.split("/").pop()}/seo-data?shop=${encodeURIComponent(d)}`,n=await b(s);ge(n),pe(!0)}catch(s){m((s==null?void 0:s.status)===404?"No SEO data found for this collection":"Failed to load SEO data")}finally{Ee(!1)}},Be=o.useMemo(()=>{var s;if(C)return v.length>T;const t=f.filter(n=>p.includes(n.id));if(t.length===0)return v.length>T;for(const n of t){const l=((s=n.optimizationSummary)==null?void 0:s.optimizedLanguages)||[],i=v.filter(u=>!l.includes(u));if(l.length+i.length>T)return!0}return!1},[f,p,C,T,v]),pt=()=>{if(p.length===0&&!C){m("Please select collections first");return}he(!0)},gt=async()=>{const s=f.filter(l=>p.includes(l.id)).filter(l=>{var i;return((i=l.optimizedLanguages)==null?void 0:i.length)>0});if(s.length===0){m("Please select collections with Basic SEO optimization");return}ze(!0),B({processing:!0,current:0,total:s.length,currentItem:"",results:null});const n={successful:0,failed:0,skipped:0};for(let l=0;l<s.length;l++){const i=s[l];B(a=>({...a,current:l,currentItem:i.title}));try{const a=i.optimizedLanguages||[];if(a.length===0){n.skipped++;continue}const u=await b(`/ai-enhance/collection/${encodeURIComponent(i.id)}`,{method:"POST",shop:d,body:{shop:d,languages:a}});u&&u.ok?n.successful++:n.failed++}catch(a){if(a.status===403){B({processing:!1,current:0,total:0,currentItem:"",results:null}),F(a),Q(a.currentPlan||I||"starter"),Z(!0);return}if(a.status===402||a.requiresPurchase||a.trialRestriction){B({processing:!1,current:0,total:0,currentItem:"",results:null}),F(a),Q(a.currentPlan||I||"starter"),a.trialRestriction&&a.requiresActivation?Re(!0):a.trialRestriction?Z(!0):$e(!0);return}n.failed++}B(a=>({...a,current:l+1}))}B(l=>({...l,processing:!1,results:n})),m(`AI enhancement complete! ${n.successful} collections enhanced.`)},ft=()=>{f.filter(n=>p.includes(n.id)).filter(n=>{var l;return((l=n.optimizedLanguages)==null?void 0:l.length)>0});const s=()=>{const n=y.results;ze(!1),B({processing:!1,current:0,total:0,currentItem:"",results:null}),n&&n.successful>0&&setTimeout(()=>{Se([]),D()},1500)};return y.processing?e.jsx(S,{open:De,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",y.currentItem]}),e.jsx(me,{progress:y.current/y.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[y.current," of ",y.total," collections (",Math.round(y.current/y.total*100),"%)"]})]})})}):y.results!==null?e.jsx(S,{open:De,title:"AI Enhancement Results",onClose:s,primaryAction:{content:"Done",onAction:s},children:e.jsx(S.Section,{children:e.jsx(L,{gap:"300",children:e.jsxs(w,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:y.results.successful})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:y.results.failed})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:y.results.skipped})]})]})})})}):null},mt=async()=>{var t;if(!v.length){m("Please select at least one language");return}he(!1),H(!0),$({current:0,total:0,percent:0}),ve([]),de({});try{const s=C?f:f.filter(a=>p.includes(a.id)),n=s.length;$({current:0,total:n,percent:0});const l={};for(let a=0;a<s.length;a++){const u=s[a];J(u.title);try{const h=await b("/seo/generate-collection-multi",{method:"POST",shop:d,body:JSON.stringify({shop:d,collectionId:u.id,model:Ye,languages:v})});l[u.id]={success:!0,data:h}}catch(h){if(h.status===403||(t=h.message)!=null&&t.includes("requires Professional plan")){H(!1),J(""),F({error:h.message||"Collections SEO requires Professional plan or higher",currentPlan:h.currentPlan||I||"starter",upgradeMessage:h.upgradeMessage||"Upgrade to Professional plan to optimize collections for AI search"}),Z(!0);return}l[u.id]={success:!1,error:h.message},ve(oe=>[...oe,{collection:u.title,error:h.message}])}const x=a+1,_=Math.round(x/n*100);$({current:x,total:n,percent:_})}de(l),ue(!0);const i=Object.values(l).filter(a=>a.success).length;m(`Generated optimization for ${i} collections`)}catch(s){m(`Error: ${s.message}`)}finally{H(!1),J("")}},St=async()=>{var t;H(!0),$({current:0,total:0,percent:0});try{const s=Object.entries(R).filter(([l,i])=>i.success),n=s.length;$({current:0,total:n,percent:0});for(let l=0;l<s.length;l++){const[i,a]=s[l],u=f.find(h=>h.id===i);if(!u)continue;J(u.title);try{if(!((t=a.data)!=null&&t.results)||!Array.isArray(a.data.results))throw new Error("Invalid results structure");const h=await b("/seo/apply-collection-multi",{method:"POST",shop:d,body:{shop:d,collectionId:i,results:a.data.results.map(oe=>({language:oe.language,seo:oe.data})),options:{updateTitle:!0,updateDescription:!0,updateSeo:!0,updateMetafields:!0}}});if(!(h!=null&&h.ok))throw new Error((h==null?void 0:h.error)||"Apply failed")}catch(h){console.error("Apply error for collection:",i,h),G.push({id:u.id,title:u.title,message:h.message})}const x=l+1,_=Math.round(x/n*100);$({current:x,total:n,percent:_})}m("Optimization applied successfully!"),ue(!1),de({}),K([]),await D(),X(!1)}catch(s){m(`Error applying optimization: ${s.message}`)}finally{H(!1),J("")}},xt=async(t=[])=>{Le(!0),Ve("");try{const s=C?f:f.filter(a=>p.includes(a.id)),n=s.length*t.length;let l=0;const i=[];for(const a of s)for(const u of t)try{const x=await b("/collections/delete-seo",{method:"DELETE",shop:d,body:{shop:d,collectionId:a.id,language:u}})}catch(x){console.error(`[DELETE-SEO-BULK] Failed to delete ${u} for ${a.title}:`,x),i.push({id:a.id,title:a.title,message:x.message})}finally{l++,$({current:l,total:n,percent:Math.round(l/n*100)})}m(`Deleted optimization for ${t.join(", ").toUpperCase()}`),setTimeout(async()=>{await D(),K([]),X(!1),Y(!1)},100)}catch(s){console.error("[DELETE-SEO-BULK] Error:",s),m(`Delete error: ${s.message}`)}finally{Le(!1),ne([]),N([])}},jt=t=>{var a,u;const s=((a=R[t.id])==null?void 0:a.success)||Oe[t.id],n=((u=R[t.id])==null?void 0:u.data)||Oe[t.id],l=t.optimizedLanguages||[],i=e.jsx(c,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Ut,{id:t.id,media:i,accessibilityLabel:`View details for ${t.title}`,children:e.jsxs(w,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(c,{style:{flex:"1 1 30%",minWidth:"200px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:t.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Handle: ",t.handle]})]}),e.jsx(c,{style:{flex:"0 0 15%",minWidth:"100px",textAlign:"center"},children:e.jsxs(r,{variant:"bodyMd",children:[t.productsCount," products"]})}),e.jsx(c,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(w,{gap:"100",wrap:!0,children:t.hasSeoData?e.jsxs(e.Fragment,{children:[A.map(x=>e.jsx(V,{tone:l.includes(x)?"success":"subdued",size:"small",children:x.toUpperCase()},x)),t.aiEnhanced&&e.jsx(V,{tone:"info",size:"small",children:"AI✨"})]}):e.jsx(V,{tone:"subdued",children:"No AI Search Optimisation"})})}),e.jsxs(c,{style:{flex:"0 0 15%",minWidth:"120px"},children:[s&&e.jsx(M,{size:"slim",onClick:()=>{ge(n),pe(!0)},children:"Preview JSON"}),!s&&t.hasSeoData&&e.jsx(M,{size:"slim",loading:lt,onClick:()=>ht(t.id),children:"Preview JSON"})]})]})})},yt=ce&&!y.processing&&e.jsx(S,{open:ce,title:"Processing Collections",onClose:()=>{},noScroll:!0,children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:Ce?`Processing: ${Ce}`:"Preparing..."}),e.jsx(me,{progress:E.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[E.current," of ",E.total," collections (",E.percent,"%)"]})]})})}),wt=e.jsx(S,{open:nt,title:"Select Languages",primaryAction:{content:"Generate Optimization for AI Search",onAction:mt,disabled:v.length===0||Be},secondaryActions:[{content:"Cancel",onAction:()=>he(!1)}],children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",C?"all":p.length," selected collections:"]}),Be&&e.jsx(Tt,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(L,{gap:"200",children:[e.jsxs(r,{variant:"bodyMd",children:["Your ",I," plan supports up to ",T," language",T>1?"s":""," per collection.",p.length===1&&((Ne=(We=(Ue=f.find(t=>t.id===p[0]))==null?void 0:Ue.optimizationSummary)==null?void 0:We.optimizedLanguages)==null?void 0:Ne.length)>0&&e.jsxs(e.Fragment,{children:[" This collection already has ",f.find(t=>t.id===p[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(r,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(M,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),s=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${s}`},children:"Upgrade Plan"})]})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(w,{gap:"200",wrap:!0,children:A.map(t=>e.jsx(Fe,{label:t.toUpperCase(),checked:v.includes(t),onChange:s=>{U(s?[...v,t]:v.filter(n=>n!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(M,{plain:!0,onClick:()=>{v.length===A.length?U([]):A.length>T?(U([...A]),m(`You selected ${A.length} languages. Your ${I} plan supports ${T}. Please deselect or upgrade.`)):U([...A])},children:v.length===A.length?"Deselect all":"Select all"})})]})})}),bt=e.jsx(S,{open:st&&!ce,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:St,disabled:!Object.values(R).some(t=>t.success)},secondaryActions:[{content:"Cancel",onAction:()=>ue(!1)}],children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"300",children:[e.jsxs(w,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(R).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(R).filter(t=>t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(R).filter(t=>!t.success&&!t.skipped).length})]})]}),G.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Dt,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(c,{maxHeight:"200px",overflowY:"scroll",children:[G.slice(0,10).map((t,s)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.collection,": ",t.error]},s)),G.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",G.length-10," more errors"]})]})]})]})})}),Ct=e.jsx(S,{open:ot,title:"SEO Data Preview",secondaryActions:[{content:"Close",onAction:()=>{pe(!1),ge(null)}}],children:e.jsx(S.Section,{children:e.jsx(c,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",backgroundColor:"#f6f6f7",padding:"12px",borderRadius:"4px",maxHeight:"400px",overflow:"auto"},children:Ie?JSON.stringify(Ie,null,2):""})})})}),vt=e.jsx(S,{open:Xe,title:"Delete Optimization for AI Search",onClose:()=>{te(!1),N([])},primaryAction:{content:"Continue",onAction:()=>{ne(W),te(!1),se(!0)},disabled:W.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{te(!1),N([])}}],children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",C?q:p.length," selected collections:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(w,{gap:"400",wrap:!1,children:A.map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[e.jsx("input",{type:"checkbox",checked:W.includes(t),onChange:s=>{N(s.target.checked?[...W,t]:W.filter(n=>n!==t))},style:{marginRight:"8px",width:"18px",height:"18px",cursor:"pointer"}}),e.jsx(r,{variant:"bodyMd",children:t.toUpperCase()})]},t))})}),e.jsx(c,{children:e.jsx(M,{plain:!0,onClick:()=>{N(W.length===A.length?[]:[...A])},children:"Select all"})}),e.jsx(c,{paddingBlockStart:"300",children:e.jsx(r,{variant:"bodySm",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})})]})})}),At=e.jsx(S,{open:tt,title:"Confirm Deletion",onClose:()=>{se(!1),ne([])},primaryAction:{content:"Delete",destructive:!0,onAction:async()=>{se(!1),setTimeout(()=>{xt(ke)},100)}},secondaryActions:[{content:"Cancel",onAction:()=>{se(!1),ne([]),N([])}}],children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(w,{gap:"200",children:ke.map(t=>e.jsx(V,{tone:"warning",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",C?q:p.length," selected collections."]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(r,{variant:"bodySm",tone:"critical",children:"This action cannot be undone."})})]})})}),Lt=Ae&&e.jsx(S,{open:Ae,title:"Deleting SEO Data",onClose:()=>{},noScroll:!0,children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:"Deleting selected languages..."}),e.jsx(me,{progress:E.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[E.current," of ",E.total," operations (",E.percent,"%)"]})]})})}),Mt=e.jsx(Wt,{heading:"No collections found",action:{content:"Clear filters",onAction:()=>{ae(""),ee("all"),D()}},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms"})});return e.jsxs(e.Fragment,{children:[e.jsx(kt,{globalPlan:j}),e.jsx(_e,{children:e.jsx(c,{padding:"400",children:e.jsxs(L,{gap:"300",children:[e.jsxs(w,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(c,{minWidth:"400px",children:e.jsx(zt,{label:"",placeholder:"Search by collection name...",value:z,onChange:ae,prefix:e.jsx($t,{}),clearButton:!0,onClearButtonClick:()=>ae("")})}),e.jsx(c,{width:"320px",children:e.jsx(M,{primary:!0,onClick:pt,disabled:p.length===0&&!C,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(w,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(M,{onClick:ct,disabled:Me||xe,size:"medium",children:Me?"Syncing...":"Sync Collections"}),e.jsx(c,{width:"320px",children:e.jsxs(L,{gap:"200",align:"end",children:[(()=>{if(p.length===0&&!C||!f.filter(l=>p.includes(l.id)).some(l=>{var i;return((i=l.optimizedLanguages)==null?void 0:i.length)>0}))return null;const n=I.toLowerCase().replace(/_/g," ")==="starter";return e.jsx(M,{onClick:n?()=>{F({error:"Collections require Professional plan or higher",message:"Upgrade to Professional plan to access Collections optimization",minimumPlanRequired:"Professional"}),Z(!0)}:gt,disabled:p.length===0&&!C,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(M,{outline:!0,destructive:!0,onClick:()=>te(!0),disabled:p.length===0||!et,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]})})}),e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(_e,{children:[e.jsxs(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(w,{gap:"200",wrap:!0,align:"space-between",children:[e.jsx(w,{gap:"200",wrap:!0,children:e.jsx(qe,{active:ye,activator:e.jsx(M,{disclosure:"down",onClick:()=>re(!ye),removeUnderline:!0,children:e.jsxs(w,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),P!=="all"&&e.jsx(c,{onClick:t=>{t.stopPropagation(),ee("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>re(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Ke,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All collections",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[P],onChange:t=>{ee(t[0]),re(!1)}})})})}),e.jsx(qe,{active:we,activator:e.jsx(M,{disclosure:"down",onClick:()=>ie(!we),removeUnderline:!0,children:e.jsx(w,{gap:"100",blockAlign:"center",children:e.jsxs("span",{children:[k==="updatedAt"&&O==="desc"&&"Newest first",k==="updatedAt"&&O==="asc"&&"Oldest first",k==="title"&&O==="asc"&&"Name A-Z",k==="title"&&O==="desc"&&"Name Z-A",k==="productsCount"&&O==="desc"&&"Most products",k==="productsCount"&&O==="asc"&&"Least products"]})})}),onClose:()=>ie(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(Ke,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"updatedAt_desc"},{label:"Oldest first",value:"updatedAt_asc"},{label:"Name A-Z",value:"title_asc"},{label:"Name Z-A",value:"title_desc"},{label:"Most products",value:"productsCount_desc"},{label:"Least products",value:"productsCount_asc"}],selected:[`${k}_${O}`],onChange:t=>{const[s,n]=t[0].split("_");Je(s),Ge(n),ie(!1)}})})})]}),P!=="all"&&e.jsx(c,{paddingBlockStart:"200",children:e.jsx(w,{gap:"100",wrap:!0,children:e.jsx(V,{onRemove:()=>ee("all"),children:P==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"})})})]}),q>0&&e.jsx(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:e.jsx(Fe,{label:`Select all ${q} collections`,checked:C,onChange:ut})}),e.jsx(Rt,{resourceName:{singular:"collection",plural:"collections"},items:f,renderItem:jt,selectedItems:p,onSelectionChange:dt,selectable:!0,loading:xe,totalItemsCount:q,emptyState:Mt,showHeader:!1},`collections-${f.length}-${p.length}`)]})}),yt,wt,bt,Ct,vt,At,Lt,ft(),e.jsx(Ot,{open:at,onClose:()=>Z(!1),featureName:"Collections AI Enhancement",currentPlan:I,errorMessage:(g==null?void 0:g.error)||(g==null?void 0:g.message),minimumPlanRequired:g==null?void 0:g.minimumPlanRequired}),g&&e.jsxs(e.Fragment,{children:[e.jsx(It,{open:rt,onClose:()=>{$e(!1),F(null)},tokensRequired:g.tokensRequired||0,tokensAvailable:g.tokensAvailable||0,tokensNeeded:g.tokensNeeded||0,feature:"ai-seo-collection",shop:d,needsUpgrade:g.needsUpgrade||!1,minimumPlan:g.minimumPlanForFeature||null,currentPlan:g.currentPlan||I}),e.jsx(Et,{open:it,onClose:()=>{Re(!1),F(null)},feature:g.feature||"ai-seo-collection",trialEndsAt:g.trialEndsAt,currentPlan:g.currentPlan||I,tokensRequired:g.tokensRequired||0,onActivatePlan:()=>{const t=new URLSearchParams(window.location.search),s=t.get("host"),n=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${n}&host=${encodeURIComponent(s)}`},onPurchaseTokens:()=>{const t=new URLSearchParams(window.location.search),s=t.get("host"),n=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${n}&host=${encodeURIComponent(s)}`}})]}),Te&&e.jsx(Bt,{content:Te,onDismiss:()=>m("")})]})}export{ms as default};
