import{j as e}from"./app-bridge-DKTeCwb4-1758480493547.js";import{r as n}from"./react-vendor-tAaa2TlE-1758480493547.js";import{u as Tt}from"./index-DJwAw2oH-1758480493547.js";import{U as Dt}from"./UpgradeModal-nYgfxNvA-1758480493547.js";import{M as b,d as M,T as r,e as Ge,a as u,I,f as De,B as k,D as zt,g as G,C as qe,h as Ot,i as kt,S as Bt,P as xe,j as je,R as Ut,k as Mt,l as Ve,m as $t,E as Kt}from"./polaris-DWV2204W-1758480493547.js";const Nt=(w,p="")=>{try{return new URLSearchParams(window.location.search).get(w)||p}catch{return p}},ze=w=>{if(!w)return w;const p=String(w).trim();return p.startsWith("gid://")?p:`gid://shopify/Product/${p}`},Wt=w=>{if(!w)return"";const p=String(w).match(/\/(\d+)$/);return p?p[1]:w},ae=w=>{switch(w==null?void 0:w.toLowerCase()){case"starter":return 50;case"growth":return 1e3;case"growth extra":return 2e3;case"professional":return 1500;case"enterprise":return 1e4;default:return 50}};function Jt({shop:w}){const{api:p,shop:Je}=Tt(),i=w||Je||Nt("shop","");n.useEffect(()=>{console.log("[BULK-EDIT] Component mounted"),console.log("[BULK-EDIT] Shop:",i),console.log("[BULK-EDIT] API function available:",typeof p=="function")},[i,p]);const[C,R]=n.useState([]),[Q,le]=n.useState(!1),[Ye,Oe]=n.useState(1),[Qe,ye]=n.useState(!0),[q,ke]=n.useState(0),[L,X]=n.useState([]),[T,ie]=n.useState(!1),[F,Be]=n.useState(""),[B,re]=n.useState("all"),[z,Z]=n.useState(""),[ce,_t]=n.useState("createdAt"),[V,Xe]=n.useState("desc"),[$,de]=n.useState([]),[Ze,et]=n.useState([]),[Ue,be]=n.useState(!1),[Me,Le]=n.useState(!1),[$e,Ee]=n.useState(!1),[Ke,Ae]=n.useState(!1),[tt,st]=n.useState(""),[Ht,nt]=n.useState([]),[_,ue]=n.useState([]),[v,Ne]=n.useState([]),[Ie,J]=n.useState(!1),[ge,N]=n.useState({current:0,total:0,percent:0}),[We,Y]=n.useState(""),[pe,ee]=n.useState([]),[te,_e]=n.useState({}),[ot,Pe]=n.useState(!1),[at,he]=n.useState(!1),[lt,se]=n.useState(!1),[W,ne]=n.useState([]),[it,me]=n.useState(!1),[He,j]=n.useState(""),[we,ve]=n.useState(!1),[E,oe]=n.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[K,rt]=n.useState(null),[ct,fe]=n.useState(!1),[Se,dt]=n.useState(localStorage.getItem("hasVisitedProducts")==="true"),[ut,Re]=n.useState(!1),[gt,pt]=n.useState("starter");n.useEffect(()=>{i&&p("/plans/me",{shop:i}).then(t=>{const s=(t==null?void 0:t.modelsSuggested)||["anthropic/claude-3.5-sonnet"];nt(s.map(o=>({label:o,value:o}))),st(s[0]),rt((t==null?void 0:t.plan)||"starter")}).catch(t=>console.error("[BULK-EDIT] /plans/me failed:",t))},[i,p]),n.useEffect(()=>{if(console.log("[BULK-EDIT] Languages useEffect triggered",{shop:i,api:!!p}),!i){console.log("[BULK-EDIT] No shop, skipping languages load");return}console.log("[BULK-EDIT] Making languages API call to:",`/api/languages/shop/${i}`),console.log("[BULK-EDIT] About to call api() function");const t=new Promise((s,o)=>{setTimeout(()=>o(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([p(`/api/languages/shop/${i}`),t]).then(s=>{console.log("[BULK-EDIT] Languages API response:",s);const o=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];console.log("[BULK-EDIT] Setting available languages to:",o.includes("en")?o:["en",...o]),Ne(o.includes("en")?o:["en",...o])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),console.error("[BULK-EDIT] Error details:",s.message,s.stack),Ne(["en"])})},[i,p]),n.useEffect(()=>{i&&p("/api/products/tags/list",{shop:i}).then(t=>et((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[i,p]);const H=n.useCallback(async(t=1,s=!1,o=null)=>{var c,d,S,l;console.log(`[BULK-EDIT-LOAD] loadProducts called with pageNum: ${t}, append: ${s}, timestamp: ${o}`),console.log("[BULK-EDIT-LOAD] Current products state:",C.length),le(!0);try{const a=new URLSearchParams({shop:i,page:t,limit:50,...B!=="all"&&{optimized:B},...F&&{search:F},...z&&{languageFilter:z},...$.length>0&&{tags:$.join(",")},sortBy:ce,sortOrder:V,...o&&{_t:o}}),g=await p(`/api/products/list?${a}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log(`[BULK-EDIT-LOAD] API returned ${((c=g.products)==null?void 0:c.length)||0} products`),((d=g.products)==null?void 0:d.length)>0&&console.log("[BULK-EDIT-LOAD] First product data:",{id:g.products[0]._id,title:g.products[0].title,optimizationSummary:g.products[0].optimizationSummary}),R(s?x=>[...x,...g.products]:g.products||[]),Oe(t),ye(((S=g.pagination)==null?void 0:S.hasNext)||!1),ke(((l=g.pagination)==null?void 0:l.total)||0)}catch(a){R(s?C:[]),ye(!1),j(`Error loading products: ${a.message}`)}finally{le(!1)}},[i,B,F,z,$,ce,V]);n.useEffect(()=>{i&&H(1,!1,null)},[i,H,B,z,$,ce,V]),n.useEffect(()=>{!Se&&i&&(localStorage.setItem("hasVisitedProducts","true"),dt(!0))},[Se,i]),n.useEffect(()=>{C.length===0&&!Q&&i&&!Se&&fe(!0)},[C.length,Q,i,Se]);const Fe=n.useCallback(t=>{Be(t)},[]);n.useEffect(()=>{const t=setTimeout(()=>{i&&H(1,!1,null)},500);return()=>clearTimeout(t)},[F]);const ht=n.useCallback(t=>{X(t),t.length===0&&ie(!1)},[]),mt=n.useCallback(t=>{ie(t),X(t?C.map(s=>s._id):[])},[C]),ft=()=>{if(L.length===0&&!T){j("Please select products first");return}he(!0)},St=()=>{if(L.length===0&&!T){j("Please select products first");return}ne([]),se(!0)},xt=()=>{const s=C.filter(d=>L.includes(d._id)).filter(d=>{var S,l;return((l=(S=d.optimizationSummary)==null?void 0:S.optimizedLanguages)==null?void 0:l.length)>0}),o=async()=>{var S;if(console.log("üîç [AI-ENHANCE] handleStartEnhancement called with products:",s),K&&!["Growth Extra","Enterprise"].includes(K)){pt(K),ve(!1),Re(!0);return}oe({processing:!0,current:0,total:s.length,currentItem:"",results:null});const d={successful:0,failed:0,skipped:0,skippedDueToPlan:0};for(let l=0;l<s.length;l++){const a=s[l];oe(g=>({...g,current:l,currentItem:a.title}));try{if(!(await p("/ai-enhance/check-eligibility",{method:"POST",shop:i,body:{shop:i}})).eligible){d.skipped++,d.skippedDueToPlan++;continue}const x=await p("/ai-enhance/product",{method:"POST",shop:i,body:{shop:i,productId:a.gid||`gid://shopify/Product/${a.productId}`,languages:a.optimizationSummary.optimizedLanguages}});if(console.log(`üîç [AI-ENHANCE] Product ${a.productId} enhance data:`,x),x.results&&x.results.length>0){const O={shop:i,productId:a.gid||`gid://shopify/Product/${a.productId}`,results:x.results.filter(f=>f.bullets&&f.faq).map(f=>{var D;const A=`seo_ai.seo__${f.language}`,y=(D=a.metafields)==null?void 0:D.find(U=>U.key===A);let h={};if(y!=null&&y.value)try{h=JSON.parse(y.value)}catch(U){console.warn(`Failed to parse metafield for ${f.language}:`,U),h={}}console.log(`üîç [AI-ENHANCE] Language ${f.language} - existing metafield SEO:`,JSON.stringify(h,null,2)),console.log(`üîç [AI-ENHANCE] Language ${f.language} - AI bullets:`,f.bullets),console.log(`üîç [AI-ENHANCE] Language ${f.language} - AI FAQ:`,f.faq);const P={language:f.language,seo:{title:h.title||`Product ${a.productId}`,metaDescription:h.metaDescription||"Product description",slug:h.slug||`product-${a.productId}`,bodyHtml:h.bodyHtml||"<p>Product description</p>",bullets:f.bullets||[],faq:f.faq||[],imageAlt:h.imageAlt||[],jsonLd:h.jsonLd||{}}};return console.log(`üîç [AI-ENHANCE] Language ${f.language} - final seo result:`,JSON.stringify(P.seo,null,2)),P}),options:{updateBullets:!0,updateFaq:!0}};console.log(`üîç [AI-ENHANCE] Applying data for product ${a.productId}:`,O),console.log("üîç [AI-ENHANCE] First result SEO object:",JSON.stringify((S=O.results[0])==null?void 0:S.seo,null,2));const m=await p("/api/seo/apply-multi",{method:"POST",shop:i,body:O});console.log(`üîç [AI-ENHANCE] Apply result for product ${a.productId}:`,m),d.successful++}else console.log(`üîç [AI-ENHANCE] No valid results for product ${a.productId}:`,x),d.failed++}catch(g){console.error("Enhancement error:",g),d.failed++}oe(g=>({...g,current:l+1}))}oe(l=>({...l,processing:!1,results:d})),j(`AI enhancement complete! ${d.successful} products enhanced.`)},c=()=>{ve(!1),oe({processing:!1,current:0,total:0,currentItem:"",results:null}),E.results&&E.results.successful>0&&H(1,!1,null)};return!E.processing&&!E.results?e.jsx(b,{open:we,title:"AI Enhanced add-ons for AI Search",onClose:c,primaryAction:{content:"Start AI Enhancement",onAction:o},secondaryActions:[{content:"Cancel",onAction:c}],children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["AI enhancement will improve bullets and FAQ for ",s.length," products."]}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI enhancement is only available for Growth Extra and Enterprise plans."})]})})}):E.processing?e.jsx(b,{open:we,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",E.currentItem]}),e.jsx(Ge,{progress:E.current/E.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[E.current," of ",E.total," products (",Math.round(E.current/E.total*100),"%)"]})]})})}):E.results!==null?e.jsx(b,{open:we,title:"AI Enhancement Results",onClose:c,primaryAction:{content:"Done",onAction:c},children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(I,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:E.results.successful})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:E.results.failed})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:E.results.skipped})]})]}),E.results.skippedDueToPlan>0&&e.jsx(u,{paddingBlockStart:"300",children:e.jsx(r,{variant:"bodySm",tone:"subdued",children:"AI enhancement is only available for Growth Extra and Enterprise plans."})})]})})}):null},jt=async()=>{if(!_.length){j("Please select at least one language");return}he(!1),J(!0),N({current:0,total:0,percent:0}),ee([]),_e({});try{let t=[];T?t=(await p(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:t=C.filter(l=>L.includes(l._id));const s=t.length;N({current:0,total:s,percent:0});const o=5,c={};for(let l=0;l<t.length;l+=o){const g=t.slice(l,Math.min(l+o,t.length)).map(async m=>{var f;Y(m.title||m.handle||"Product");try{const A=m.gid||ze(m.productId||m.id),y=((f=m.optimizationSummary)==null?void 0:f.optimizedLanguages)||[],h=_.filter(D=>!y.includes(D));if(h.length===0){c[m._id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const P=await p("/api/seo/generate-multi",{method:"POST",shop:i,body:{shop:i,productId:A,model:tt,languages:h}});c[m._id]={success:!0,data:P,languages:h}}catch(A){c[m._id]={success:!1,error:A.message},ee(y=>[...y,{product:m.title,error:A.message}])}});await Promise.all(g);const x=Math.min(l+o,t.length),O=Math.round(x/s*100);N({current:x,total:s,percent:O})}_e(c),Pe(!0);const d=Object.keys(c).filter(l=>c[l].success&&!c[l].skipped).length,S=Object.keys(c).filter(l=>c[l].skipped).length;S>0?j(`Generated Optimization for AI Search for ${d} products (${S} already optimised)`):j(`Generated Optimization for AI Search for ${d} products`)}catch(t){j(`Error: ${t.message}`)}finally{J(!1),Y("")}},yt=async()=>{var t,s,o,c;J(!0),N({current:0,total:0,percent:0});try{const d=Object.entries(te).filter(([g,x])=>x.success&&!x.skipped),S=d.length;N({current:0,total:S,percent:0});for(let g=0;g<d.length;g++){const[x,O]=d[g],m=C.find(y=>y._id===x);if(!m)continue;Y(m.title||"Product");try{const y=m.gid||ze(m.productId||m.id),h=await p("/api/seo/apply-multi",{method:"POST",shop:i,body:{shop:i,productId:y,results:O.data.results.filter(P=>P==null?void 0:P.seo).map(P=>({language:P.language,seo:P.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});h.appliedLanguages&&h.appliedLanguages.length>0&&(console.log(`[BULK-EDIT] Optimistic update for product ${x}, languages:`,h.appliedLanguages),R(P=>P.map(D=>{var U;if(D._id===x){const Te=((U=D.optimizationSummary)==null?void 0:U.optimizedLanguages)||[],Ct=[...new Set([...Te,...h.appliedLanguages])];return{...D,optimizationSummary:{...D.optimizationSummary,optimizedLanguages:Ct,optimized:!0,lastOptimized:new Date().toISOString()}}}return D})))}catch(y){ee(h=>[...h,{product:m.title,error:`Apply failed: ${y.message}`}])}const f=g+1,A=Math.round(f/S*100);N({current:f,total:S,percent:A})}j("AI Search Optimisation applied successfully!"),Pe(!1),X([]),ie(!1),console.log("[BULK-EDIT] Waiting for database propagation..."),await new Promise(g=>setTimeout(g,1e3)),console.log("[BULK-EDIT] Clearing products state before reload..."),R([]),console.log("[BULK-EDIT] Reloading products with cache bypass...");const l=new URLSearchParams({shop:i,page:1,limit:50,...B!=="all"&&{optimized:B},...F&&{search:F},...z&&{languageFilter:z},...$.length>0&&{tags:$.join(",")},sortBy:ce,sortOrder:V,_t:Date.now()}),a=await p(`/api/products/list?${l}`,{shop:i,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log("[BULK-EDIT] Products reloaded, first product:",(t=a.products[0])==null?void 0:t.title),console.log("[BULK-EDIT] First product optimization summary:",(s=a.products[0])==null?void 0:s.optimizationSummary),R(a.products||[]),Oe(1),ye(((o=a.pagination)==null?void 0:o.hasNext)||!1),ke(((c=a.pagination)==null?void 0:c.total)||0)}catch(d){j(`Error applying AI Search Optimisation: ${d.message}`)}finally{J(!1),Y("")}},bt=async()=>{var t,s;if(!W.length){j("Please select at least one language to delete");return}se(!1),me(!1),J(!0),N({current:0,total:0,percent:0}),ee([]);try{let o=[];T?o=(await p(`/api/products/list?shop=${encodeURIComponent(i)}&limit=1000&fields=id`)).products||[]:o=C.filter(l=>L.includes(l._id));const c=o.length;N({current:0,total:c,percent:0});let d=0,S=0;for(let l=0;l<o.length;l++){const a=o[l];Y(a.title||a.handle||"Product");try{const O=a.gid||ze(a.productId||a.id),m=((t=a.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],f=W.filter(y=>m&&m.length>0&&m.includes(y));if(console.log("[BULK-DELETE] Product optimized languages:",m),console.log("[BULK-DELETE] Languages to delete:",f),f.length===0){S++;continue}const A=await p("/api/seo/delete-multi",{method:"POST",shop:i,body:{shop:i,productId:O,languages:f}});console.log("[BULK-DELETE] Delete response:",A),console.log("[BULK-DELETE] Deleted languages:",A.deletedLanguages),A.deletedLanguages&&A.deletedLanguages.length>0&&(console.log("[BULK-DELETE] Before optimistic update, product:",a),console.log("[BULK-DELETE] Current optimized languages:",(s=a.optimizationSummary)==null?void 0:s.optimizedLanguages),R(y=>y.map(h=>{var P;if(h._id===a._id){const D=((P=h.optimizationSummary)==null?void 0:P.optimizedLanguages)||[],U=D.filter(Te=>!A.deletedLanguages.includes(Te));return console.log("[BULK-DELETE] Updating product:",h._id),console.log("[BULK-DELETE] Languages before:",D),console.log("[BULK-DELETE] Languages after:",U),{...h,optimizationSummary:{...h.optimizationSummary,optimizedLanguages:U,optimized:U.length>0,lastOptimized:U.length>0?h.optimizationSummary.lastOptimized:null}}}return h})),console.log("[BULK-DELETE] State updated, checking first product:",C[0])),d++,A.deletedLanguages&&A.deletedLanguages.length>0&&await p("/api/products/verify-after-delete",{method:"POST",shop:i,body:{shop:i,productIds:[O],deletedLanguages:A.deletedLanguages}})}catch(O){ee(m=>[...m,{product:a.title,error:O.message}])}const g=l+1,x=Math.round(g/c*100);N({current:g,total:c,percent:x})}X([]),ie(!1),S>0?j(`Deleted Optimization for AI Search from ${d} products (${S} had no optimisation to delete)`):j(`Deleted Optimization for AI Search from ${d} products`),console.log("[BULK-DELETE] Operation successful!"),setTimeout(()=>{console.log("[BULK-DELETE] Triggering reload with timestamp");const l=Date.now();H(1,!1,l)},500)}catch(o){j(`Error: ${o.message}`)}finally{J(!1),Y("")}},Lt=t=>{var S,l;const s=t,o=Wt(s.productId||s.id),c=((S=s.optimizationSummary)==null?void 0:S.optimizedLanguages)||[];console.log(`[BULK-EDIT] Rendering product: "${s.title}"`),console.log("[BULK-EDIT] optimizationSummary:",s.optimizationSummary),console.log("[BULK-EDIT] optimizedLanguages:",c),console.log("[BULK-EDIT] availableLanguages:",v);const d=(l=s.images)!=null&&l[0]?e.jsx(Ve,{source:s.images[0].url||s.images[0].src||s.images[0],alt:s.title,size:"small"}):s.imageUrl?e.jsx(Ve,{source:s.imageUrl,alt:s.title,size:"small"}):e.jsx(u,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx($t,{id:s._id,url:"",media:d,accessibilityLabel:`View details for ${s.title}`,children:e.jsxs(I,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(u,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:s.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["ID: ",o]})]}),e.jsx(u,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(I,{gap:"100",children:(console.log(`[BULK-EDIT] Rendering badges for "${s.title}"`),console.log("[BULK-EDIT] availableLanguages.length:",v.length),console.log("[BULK-EDIT] availableLanguages:",v),console.log("[BULK-EDIT] optimizedLanguages:",c),v.length>0?(console.log("[BULK-EDIT] Using availableLanguages.map"),v.map(a=>{const g=c.includes(a);return console.log(`[BULK-EDIT] Language ${a}: optimized=${g}`),e.jsx(G,{tone:g?"success":"subdued",size:"small",children:a.toUpperCase()},a)})):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),c.map(a=>e.jsx(G,{tone:"success",size:"small",children:a.toUpperCase()},a))))})}),e.jsx(u,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(G,{tone:"success",children:"Active"})})]})})},Et=Ie&&e.jsx(b,{open:Ie,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:We?`Processing: ${We}`:"Preparing..."}),e.jsx(Ge,{progress:ge.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[ge.current," of ",ge.total," products (",ge.percent,"%)"]})]})})}),At=e.jsx(b,{open:at,title:"Select Languages",onClose:()=>{he(!1),ue([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:jt,disabled:_.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{he(!1),ue([])}}],children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",T?"all":L.length," selected products:"]}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(I,{gap:"200",wrap:!0,children:v.map(t=>e.jsx(De,{label:t.toUpperCase(),checked:_.includes(t),onChange:s=>{ue(s?[..._,t]:_.filter(o=>o!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{ue(_.length===v.length?[]:[...v])},children:_.length===v.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),It=e.jsx(b,{open:ot&&!Ie,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:yt,disabled:!Object.values(te).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Pe(!1)}],children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(I,{gap:"400",children:[e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(te).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(te).filter(t=>t.skipped).length})]}),e.jsxs(u,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(te).filter(t=>!t.success).length})]})]}),pe.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(zt,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(u,{maxHeight:"200px",overflowY:"scroll",children:[pe.slice(0,10).map((t,s)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),pe.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",pe.length-10," more errors"]})]})]})]})})}),Pt=e.jsx(b,{open:lt,title:"Delete Optimization for AI Search",onClose:()=>{se(!1),ne([])},primaryAction:{content:"Continue",onAction:()=>{se(!1),me(!0)},disabled:W.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{se(!1),ne([])}}],children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",T?"all":L.length," selected products:"]}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(I,{gap:"200",wrap:!0,children:v.map(t=>e.jsx(De,{label:t.toUpperCase(),checked:W.includes(t),onChange:s=>{ne(s?[...W,t]:W.filter(o=>o!==t))}},t))})}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{ne(W.length===v.length?[]:[...v])},children:W.length===v.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),wt=e.jsx(b,{open:it,title:"Confirm Deletion",onClose:()=>{me(!1)},primaryAction:{content:"Delete",onAction:bt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>me(!1)}],children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(u,{paddingBlock:"200",children:e.jsx(I,{gap:"100",children:W.map(t=>e.jsx(G,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",T?"ALL":L.length," selected products."]}),e.jsx(r,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),Ce=async()=>{try{le(!0),j("Syncing products from Shopify...");const t=await p("/api/products/sync",{method:"POST",shop:i});if(t.success)j(`‚úÖ Synced ${t.synced} products successfully!`),setTimeout(()=>{H(1,!1,Date.now())},1e3);else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),j(`‚ùå Sync failed: ${t.message}`)}finally{le(!1)}},vt=e.jsx(Kt,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Be(""),re("all"),Z(""),de([]),H(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:Ce},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(qe,{children:e.jsxs(u,{padding:"400",children:[e.jsxs(M,{gap:"300",children:[K&&e.jsx(Ot,{tone:"info",children:e.jsxs(I,{gap:"200",align:"space-between",children:[e.jsxs(r,{children:["Your ",e.jsx("strong",{children:K})," plan includes up to"," ",e.jsx("strong",{children:ae(K)})," products for SEO optimization.",q>ae(K)&&e.jsxs(e.Fragment,{children:[" You have ",q," products, so only the first ",ae(K)," will be processed."]})]}),(L.length>0||T)&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Selected: ",T?Math.min(q,ae(K)):L.length,"/",ae(K)]})]})}),e.jsxs(I,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(u,{minWidth:"400px",children:e.jsx(kt,{label:"",placeholder:"Search by product ID, name, or details...",value:F,onChange:Fe,prefix:e.jsx(Bt,{}),clearButton:!0,onClearButtonClick:()=>Fe("")})}),e.jsx(u,{width:"320px",children:e.jsx(k,{primary:!0,onClick:ft,disabled:L.length===0&&!T,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(I,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(k,{onClick:Ce,disabled:Q,size:"medium",children:"Sync Products"}),e.jsx(u,{width:"320px",children:e.jsxs(M,{gap:"200",align:"end",children:[L.length===0&&!T||!C.filter(o=>L.includes(o._id)).some(o=>{var c,d;return((d=(c=o.optimizationSummary)==null?void 0:c.optimizedLanguages)==null?void 0:d.length)>0})?null:e.jsx(k,{onClick:()=>ve(!0),disabled:L.length===0&&!T,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(k,{onClick:St,disabled:L.length===0&&!T||!C.filter(o=>L.includes(o._id)).some(o=>{var c,d;return((d=(c=o.optimizationSummary)==null?void 0:c.optimizedLanguages)==null?void 0:d.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),q>0&&e.jsx(u,{paddingBlockStart:"300",children:e.jsx(De,{label:`Select all ${q} products in your store`,checked:T,onChange:mt})})]})}),e.jsx(u,{paddingBlockStart:"400",children:e.jsxs(qe,{children:[e.jsxs(u,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(I,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(I,{gap:"200",wrap:!0,children:[e.jsx(xe,{active:Ue,activator:e.jsx(k,{disclosure:"down",onClick:()=>be(!Ue),removeUnderline:!0,children:e.jsxs(I,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),B!=="all"&&e.jsx(u,{onClick:t=>{t.stopPropagation(),re("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>be(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(je,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[B],onChange:t=>{re(t[0]),Z(""),be(!1)}})})}),e.jsx(xe,{active:Me,activator:e.jsx(k,{disclosure:"down",onClick:()=>Le(!Me),removeUnderline:!0,children:e.jsxs(I,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),z&&e.jsx(u,{onClick:t=>{t.stopPropagation(),Z("")},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>Le(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(je,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...v.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...v.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:z?[z]:[],onChange:t=>{Z(t[0]||""),Le(!1)}})})}),e.jsx(xe,{active:$e,activator:e.jsx(k,{disclosure:"down",onClick:()=>Ee(!$e),removeUnderline:!0,children:e.jsxs(I,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),$.length>0&&e.jsx(u,{onClick:t=>{t.stopPropagation(),de([])},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>Ee(!1),children:e.jsxs(u,{padding:"300",minWidth:"200px",children:[e.jsx(je,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:Ze.map(t=>({label:t,value:t})),selected:$,onChange:t=>{de(t)}}),e.jsx(u,{paddingBlockStart:"200",children:e.jsx(k,{size:"slim",onClick:()=>Ee(!1),children:"Apply"})})]})})]}),e.jsx(xe,{active:Ke,activator:e.jsx(k,{disclosure:"down",onClick:()=>Ae(!Ke),removeUnderline:!0,children:e.jsx(I,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:V==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Ae(!1),children:e.jsx(u,{padding:"300",minWidth:"200px",children:e.jsx(je,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[V],onChange:t=>{Xe(t[0]),Ae(!1)}})})})]}),(B!=="all"||z||$.length>0)&&e.jsx(u,{paddingBlockStart:"200",children:e.jsxs(I,{gap:"100",wrap:!0,children:[B!=="all"&&e.jsx(G,{onRemove:()=>re("all"),children:B==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),z&&e.jsx(G,{onRemove:()=>Z(""),children:z.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),$.map(t=>e.jsxs(G,{onRemove:()=>de(s=>s.filter(o=>o!==t)),children:["Tag: ",t]},t))]})})]}),e.jsx(Ut,{resourceName:{singular:"product",plural:"products"},items:C,renderItem:Lt,selectedItems:L,onSelectionChange:ht,selectable:!0,loading:Q,totalItemsCount:q,emptyState:vt,showHeader:!1}),Qe&&!Q&&e.jsx(u,{padding:"400",textAlign:"center",children:e.jsx(k,{onClick:()=>H(Ye+1,!0,null),children:"Load more"})})]})}),Et,At,It,Pt,wt,xt(),e.jsx(b,{open:ct,onClose:()=>fe(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{fe(!1),Ce()}},secondaryActions:[{content:"Skip for now",onAction:()=>fe(!1)}],children:e.jsx(b.Section,{children:e.jsxs(M,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(r,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Dt,{open:ut,onClose:()=>Re(!1),featureName:"AI Enhancement",currentPlan:gt}),He&&e.jsx(Mt,{content:He,onDismiss:()=>j("")})]})}export{Jt as default};
