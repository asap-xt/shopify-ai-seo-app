import{j as e}from"./app-bridge-D6Zvji4j-1762724396593.js";import{r as a}from"./react-vendor-tAaa2TlE-1762724396593.js";import{u as Vt}from"./useShopApi-_tGqyBex-1762724396593.js";import{S as Qt,U as Jt}from"./StoreMetadataBanner-CRFj533E-1762724396593.js";import{I as Xt}from"./InsufficientTokensModal-CL4zMWE7-1762724396593.js";import{M as E,a as T,T as c,e as dt,d as He,b as k,B as p,I as w,g as ve,D as Zt,f as X,C as ut,h as es,S as ts,i as Ie,j as Ee,R as ss,k as ns,l as pt,m as rs,E as as}from"./polaris-DJv8T-oY-1762724396593.js";const os=(v,j="")=>{try{return new URLSearchParams(window.location.search).get(v)||j}catch{return j}},fe=v=>{if(!v)return v;const j=String(v).trim();return j.startsWith("gid://")?j:`gid://shopify/Product/${j}`},is=v=>{if(!v)return"";const j=String(v).match(/\/(\d+)$/);return j?j[1]:v},Le=v=>v<=70?"Starter":v<=200?"Professional":v<=450?"Growth":v<=750?"Growth Extra":"Enterprise";function ms({shop:v,globalPlan:j}){var it,lt,ct;const{api:A,shop:ht}=Vt(),d=v||ht||os("shop","");a.useEffect(()=>{},[d,A]);const[y,Y]=a.useState([]),[ie,xe]=a.useState(!1),[gt,_e]=a.useState(1),[mt,ze]=a.useState(!0),[R,Fe]=a.useState(0),[h,ne]=a.useState([]),[x,le]=a.useState(!1),[Z,Ye]=a.useState(""),[B,Se]=a.useState("all"),[$,ce]=a.useState(""),[je,ls]=a.useState("createdAt"),[re,ft]=a.useState("desc"),[N,ye]=a.useState([]),[xt,St]=a.useState([]),[Ke,ke]=a.useState(!1),[Ve,Oe]=a.useState(!1),[Qe,Me]=a.useState(!1),[Je,Te]=a.useState(!1),[jt,yt]=a.useState(""),[bt,Pt]=a.useState([]),[D,ae]=a.useState([]),[L,Xe]=a.useState([]),[Re,ee]=a.useState(!1),[be,W]=a.useState({current:0,total:0,percent:0}),[Ze,oe]=a.useState(""),[Pe,de]=a.useState([]),[ue,et]=a.useState({}),[wt,$e]=a.useState(!1),[At,pe]=a.useState(!1),[Ct,he]=a.useState(!1),[H,ge]=a.useState([]),[vt,we]=a.useState(!1),[tt,C]=a.useState(""),[st,nt]=a.useState(!1),[I,te]=a.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[q,It]=a.useState(null),[z,Et]=a.useState(70),[K,De]=a.useState(1),[Lt,Ae]=a.useState(!1),[Ce,zt]=a.useState(localStorage.getItem("hasVisitedProducts")==="true"),[Ue,V]=a.useState(!1),[kt,Be]=a.useState(!1),[S,_]=a.useState(null),[Q,me]=a.useState("starter");a.useEffect(()=>{if(!(!j||typeof j!="object")){if(j.planKey&&j.planKey!==""){me(j.planKey);const n={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[j.planKey.toLowerCase()]||1;De(n)}else if(j.plan&&j.plan!==""){const t=j.plan.toLowerCase().replace(/\s+/g,"-");me(t);const s={starter:1,professional:2,"professional plus":2,professional_plus:2,growth:3,"growth plus":3,growth_plus:3,"growth extra":6,growth_extra:6,enterprise:10}[t]||1;De(s)}}},[j]),a.useEffect(()=>{Ue&&q&&(x?R:h.length)<=z&&(V(!1),_(null))},[h.length,x,R,Ue,q]),a.useEffect(()=>{if(!d)return;A("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
          product_limit
          language_limit
        }
      }
    `,variables:{shop:d}})}).then(n=>{var i,g,o;if((i=n==null?void 0:n.errors)!=null&&i.length)throw new Error(((g=n.errors[0])==null?void 0:g.message)||"GraphQL error");const s=(o=n==null?void 0:n.data)==null?void 0:o.plansMe,u=(s==null?void 0:s.modelsSuggested)||["anthropic/claude-3.5-sonnet"];Pt(u.map(l=>({label:l,value:l}))),yt(u[0]),It((s==null?void 0:s.plan)||"starter"),me((s==null?void 0:s.planKey)||"starter"),Et((s==null?void 0:s.product_limit)||70),De((s==null?void 0:s.language_limit)||1)}).catch(n=>console.error("[BULK-EDIT] GraphQL plansMe failed:",n))},[d,A]),a.useEffect(()=>{if(!d)return;const t=new Promise((n,s)=>{setTimeout(()=>s(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([A(`/api/languages/shop/${d}`),t]).then(n=>{const s=Array.isArray(n==null?void 0:n.shopLanguages)&&n.shopLanguages.length?n.shopLanguages:["en"];Xe(s.includes("en")?s:["en",...s])}).catch(n=>{console.error("[BULK-EDIT] Languages API error:",n),Xe(["en"])})},[d,A]),a.useEffect(()=>{d&&A("/api/products/tags/list",{shop:d}).then(t=>St((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[d,A]);const se=a.useCallback(async(t=1,n=!1,s=null)=>{var u,i,g,o;xe(!0);try{const l=new URLSearchParams({shop:d,page:t,limit:50,...B!=="all"&&{optimized:B},...Z&&{search:Z},...$&&{languageFilter:$},...N.length>0&&{tags:N.join(",")},sortBy:je,sortOrder:re,...s&&{_t:s}}),r=await A(`/api/products/list?${l}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});((u=r.products)==null?void 0:u.length)>0,((i=r.products)==null?void 0:i.length)>0&&r.products.forEach((f,O)=>{}),Y(n?f=>[...f,...r.products]:r.products||[]),_e(t),ze(((g=r.pagination)==null?void 0:g.hasNext)||!1),Fe(((o=r.pagination)==null?void 0:o.total)||0)}catch(l){Y(n?y:[]),ze(!1),C(`Error loading products: ${l.message}`)}finally{xe(!1)}},[d,B,Z,$,N,je,re]);a.useEffect(()=>{d&&se(1,!1,null)},[d,B,$,N,je,re]),a.useEffect(()=>{!Ce&&d&&(localStorage.setItem("hasVisitedProducts","true"),zt(!0))},[Ce,d]),a.useEffect(()=>{y.length===0&&!ie&&d&&!Ce&&Ae(!0)},[y.length,ie,d,Ce]),a.useEffect(()=>{},[y,h]);const rt=a.useCallback(t=>{Ye(t)},[]);a.useEffect(()=>{const t=setTimeout(()=>{d&&se(1,!1,null)},500);return()=>clearTimeout(t)},[Z]);const Ot=a.useCallback(t=>{ne(t),t.length===0&&le(!1)},[y]),at=a.useCallback(t=>{le(t),ne(t?y.map(n=>n.id):[])},[y]),ot=a.useMemo(()=>{var n;if(x)return D.length>K;const t=y.filter(s=>h.includes(s.id));if(t.length===0)return D.length>K;for(const s of t){const u=((n=s.optimizationSummary)==null?void 0:n.optimizedLanguages)||[],i=D.filter(o=>!u.includes(o));if(u.length+i.length>K)return!0}return!1},[y,h,x,K,D]),Mt=()=>{if(h.length===0&&!x){C("Please select products first");return}pe(!0)},Tt=()=>{if(h.length===0&&!x){C("Please select products first");return}ge([]),he(!0)},Rt=async()=>{var g;const t=y.filter(o=>h.includes(o.id)),n=t.filter(o=>{var l,r;return((r=(l=o.optimizationSummary)==null?void 0:l.optimizedLanguages)==null?void 0:r.length)>0}),s=t.filter(o=>{var l,r;return!((r=(l=o.optimizationSummary)==null?void 0:l.optimizedLanguages)!=null&&r.length)}),u=n.length;if(u>z){const o=Le(u);_({error:"Product limit exceeded",message:`Your ${q} plan supports up to ${z} products for AI Enhancement. You have selected ${u} products with Basic SEO.`,minimumPlanRequired:o,currentPlan:q,features:[`Optimize up to ${z} products`,"All features from your current plan",o==="Growth Extra"||o==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",o==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),V(!0);return}nt(!0),te({processing:!0,current:0,total:n.length,currentItem:"",results:null});const i={successful:0,failed:0,skipped:s.length,skipReasons:s.length>0?[`${s.length} product(s): No Basic Optimization`]:[]};for(let o=0;o<n.length;o++){const l=n[o];te(r=>({...r,current:o,currentItem:l.title}));try{const r=l.gid||fe(l.id);if(console.log(`[AI-ENHANCE] Product #${o+1}:`,{title:l.title,id:l.id,gid:l.gid,calculatedGid:r,languages:(g=l.optimizationSummary)==null?void 0:g.optimizedLanguages}),!r){console.error("[AI-ENHANCE] Missing product GID, skipping:",l),i.failed++;continue}const f=await A("/ai-enhance/product",{method:"POST",shop:d,body:{shop:d,productId:r,languages:l.optimizationSummary.optimizedLanguages}});if(f.results&&f.results.length>0){const O={shop:d,productId:l.gid||fe(l.id),results:f.results.filter(b=>b.bullets&&b.faq).map(b=>({language:b.language,seo:{...b.updatedSeo,bullets:b.bullets||[],faq:b.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}},m=await A("/api/seo/apply-multi",{method:"POST",shop:d,body:O});i.successful++}else i.failed++}catch(r){if(console.error("âŒ [AI-ENHANCE] Enhancement error:",r),console.error("ðŸ” [AI-ENHANCE DEBUG] Error type:",typeof r),console.error("ðŸ” [AI-ENHANCE DEBUG] Error.status:",r.status,"Type:",typeof r.status),console.error("ðŸ” [AI-ENHANCE DEBUG] Error.requiresPurchase:",r.requiresPurchase),console.error("ðŸ” [AI-ENHANCE DEBUG] Error.trialRestriction:",r.trialRestriction),console.error("ðŸ” [AI-ENHANCE DEBUG] Full error object:",JSON.stringify(r,Object.getOwnPropertyNames(r))),console.error("ðŸ” [AI-ENHANCE DEBUG] Error details:",{status:r.status,trialRestriction:r.trialRestriction,needsUpgrade:r.needsUpgrade,requiresPurchase:r.requiresPurchase,message:r.message,currentPlan:r.currentPlan}),r.status===403){te({processing:!1,current:0,total:0,currentItem:"",results:null}),_({...r,message:r.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),me(r.currentPlan||Q),r.needsUpgrade===!1&&r.requiresPurchase?Be(!0):V(!0);return}if(r.status===402||r.requiresPurchase||r.trialRestriction){te({processing:!1,current:0,total:0,currentItem:"",results:null}),_(r),me(r.currentPlan||q||"starter"),r.trialRestriction?V(!0):Be(!0);return}i.failed++}te(r=>({...r,current:o+1}))}te(o=>({...o,processing:!1,results:i})),C(`AI enhancement complete! ${i.successful} products enhanced.`)},Ne=()=>{const t=I.results;nt(!1),te({processing:!1,current:0,total:0,currentItem:"",results:null}),t&&t.successful>0&&setTimeout(()=>{Y([]),se(1,!1,Date.now())},1500)},$t=()=>I.processing?e.jsx(E,{open:st,title:"Processing AI Enhancement",onClose:Ne,noScroll:!0,children:e.jsx(E.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsxs(c,{variant:"bodyMd",children:["Processing: ",I.currentItem]}),e.jsx(dt,{progress:I.current/I.total*100}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:[I.current," of ",I.total," products (",Math.round(I.current/I.total*100),"%)"]})]})})}):I.results!==null?e.jsx(E,{open:st,title:"AI Enhancement Results",onClose:Ne,primaryAction:{content:"Done",onAction:Ne},children:e.jsx(E.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsxs(w,{gap:"400",children:[e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:I.results.successful})]}),e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:I.results.failed})]}),e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:I.results.skipped})]})]}),I.results.skipReasons&&I.results.skipReasons.length>0&&e.jsxs(T,{gap:"200",children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped products:"}),I.results.skipReasons.map((t,n)=>e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["â€¢ ",t]},n))]})]})})}):null,Dt=async()=>{var n;if(!D.length){C("Please select at least one language");return}let t=jt;(!t||!t.trim())&&(t=((n=bt[0])==null?void 0:n.value)||"anthropic/claude-3.5-sonnet"),ee(!0),W({current:0,total:0,percent:0}),de([]),et({});try{let s=[];x?s=(await A(`/api/products/list?shop=${encodeURIComponent(d)}&limit=1000&fields=id`)).products||[]:s=y.filter(m=>h.includes(m.id));const u=s.length;if(u>z){ee(!1),W({current:0,total:0,percent:0}),pe(!1);const m=Le(u);_({error:"Product limit exceeded",message:`Your ${Q} plan supports up to ${z} products for SEO optimization. You have selected ${u} products.`,minimumPlanRequired:m,currentPlan:Q,features:["Optimize more products","All features from your current plan",m==="Growth Extra"||m==="Enterprise"?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons",m==="Enterprise"?"Advanced Schema Data":null].filter(Boolean)}),V(!0);return}pe(!1);const i=u,g=0;W({current:0,total:i,percent:0});const o=5,l={};for(let m=0;m<s.length;m+=o){const U=s.slice(m,Math.min(m+o,s.length)).map(async M=>{var F;oe(M.title||M.handle||"Product");try{const J=M.gid||fe(M.productId||M.id),qe=((F=M.optimizationSummary)==null?void 0:F.optimizedLanguages)||[],Ge=D.filter(Kt=>!qe.includes(Kt));if(Ge.length===0){l[M.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const Yt=await A("/api/seo/generate-multi",{method:"POST",shop:d,body:{shop:d,productId:J,model:t,languages:Ge}});l[M.id]={success:!0,data:Yt,languages:Ge}}catch(J){l[M.id]={success:!1,error:J.message},de(qe=>[...qe,{product:M.title,error:J.message}])}});await Promise.all(U);const P=Math.min(m+o,s.length),G=Math.round(P/i*100);W({current:P,total:i,percent:G})}et(l),$e(!0);const r=Object.keys(l).filter(m=>l[m].success&&!l[m].skipped).length,f=Object.keys(l).filter(m=>l[m].skipped).length;let O=`Generated Optimization for AI Search for ${r} products`;f>0&&(O+=` (${f} already optimised)`),g>0,C(O)}catch(s){C(`Error: ${s.message}`)}finally{ee(!1),oe("")}},Ut=async()=>{var t,n;ee(!0),W({current:0,total:0,percent:0});try{const s=Object.entries(ue).filter(([o,l])=>l.success&&!l.skipped),u=s.length;W({current:0,total:u,percent:0});for(let o=0;o<s.length;o++){const[l,r]=s[o],f=y.find(b=>b.id===l);if(!f)continue;oe(f.title||"Product");try{const b=f.gid||fe(f.productId||f.id),U=await A("/api/seo/apply-multi",{method:"POST",shop:d,body:{shop:d,productId:b,results:r.data.results.filter(P=>P==null?void 0:P.seo).map(P=>({language:P.language,seo:P.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});U.appliedLanguages&&U.appliedLanguages.length>0&&Y(P=>P.map(G=>{var M;if(G.id===l){const F=((M=G.optimizationSummary)==null?void 0:M.optimizedLanguages)||[],J=[...new Set([...F,...U.appliedLanguages])];return{...G,optimizationSummary:{...G.optimizationSummary,optimizedLanguages:J,optimized:!0,lastOptimized:new Date().toISOString()}}}return G}))}catch(b){de(U=>[...U,{product:f.title,error:`Apply failed: ${b.message}`}])}const O=o+1,m=Math.round(O/u*100);W({current:O,total:u,percent:m})}C("AI Search Optimisation applied successfully!"),$e(!1),ne([]),le(!1),await new Promise(o=>setTimeout(o,1e3)),Y([]);const i=new URLSearchParams({shop:d,page:1,limit:50,...B!=="all"&&{optimized:B},...Z&&{search:Z},...$&&{languageFilter:$},...N.length>0&&{tags:N.join(",")},sortBy:je,sortOrder:re,_t:Date.now()}),g=await A(`/api/products/list?${i}`,{shop:d,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});Y(g.products||[]),_e(1),ze(((t=g.pagination)==null?void 0:t.hasNext)||!1),Fe(((n=g.pagination)==null?void 0:n.total)||0)}catch(s){C(`Error applying AI Search Optimisation: ${s.message}`)}finally{ee(!1),oe("")}},Bt=async()=>{var t;if(!H.length){C("Please select at least one language to delete");return}he(!1),we(!1),ee(!0),W({current:0,total:0,percent:0}),de([]);try{let n=[];x?n=(await A(`/api/products/list?shop=${encodeURIComponent(d)}&limit=1000&fields=id`)).products||[]:n=y.filter(g=>h.includes(g.id));const s=n.length;W({current:0,total:s,percent:0});let u=0,i=0;for(let g=0;g<n.length;g++){const o=n[g];oe(o.title||o.handle||"Product");try{const f=o.gid||fe(o.productId||o.id),O=((t=o.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],m=H.filter(U=>O&&O.length>0&&O.includes(U));if(m.length===0){i++;continue}const b=await A("/api/seo/delete-multi",{method:"POST",shop:d,body:{shop:d,productId:f,languages:m}});b.deletedLanguages&&b.deletedLanguages.length>0&&Y(U=>U.map(P=>{var G;if(P.id===o.id){const F=(((G=P.optimizationSummary)==null?void 0:G.optimizedLanguages)||[]).filter(J=>!b.deletedLanguages.includes(J));return{...P,optimizationSummary:{...P.optimizationSummary,optimizedLanguages:F,optimized:F.length>0,aiEnhanced:F.length>0?P.optimizationSummary.aiEnhanced:!1,lastOptimized:F.length>0?P.optimizationSummary.lastOptimized:null}}}return P})),u++,b.deletedLanguages&&b.deletedLanguages.length>0&&await A("/api/products/verify-after-delete",{method:"POST",shop:d,body:{shop:d,productIds:[f],deletedLanguages:b.deletedLanguages}})}catch(f){de(O=>[...O,{product:o.title,error:f.message}])}const l=g+1,r=Math.round(l/s*100);W({current:l,total:s,percent:r})}ne([]),le(!1),i>0?C(`Deleted Optimization for AI Search from ${u} products (${i} had no optimisation to delete)`):C(`Deleted Optimization for AI Search from ${u} products`),setTimeout(()=>{const g=Date.now();se(1,!1,g)},500)}catch(n){C(`Error: ${n.message}`)}finally{ee(!1),oe("")}},Nt=t=>{var n,s,u;try{const i=t,g=is(i.productId||i.id),o=((n=i.optimizationSummary)==null?void 0:n.optimizedLanguages)||[],l=(s=i.images)!=null&&s[0]?e.jsx(pt,{source:i.images[0].url||i.images[0].src||i.images[0],alt:i.title,size:"small"}):i.imageUrl?e.jsx(pt,{source:i.imageUrl,alt:i.title,size:"small"}):e.jsx(p,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(rs,{id:i.id,media:l,accessibilityLabel:`View details for ${i.title}`,onClick:r=>{},children:e.jsxs(w,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(p,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:i.title}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["ID: ",g]})]}),e.jsx(p,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsxs(w,{gap:"100",wrap:!0,children:[L.length>0?L.map(r=>{const f=o.includes(r);return e.jsx(X,{tone:f?"success":"subdued",size:"small",children:r.toUpperCase()},r)}):o.map(r=>e.jsx(X,{tone:"success",size:"small",children:r.toUpperCase()},r)),((u=i.optimizationSummary)==null?void 0:u.aiEnhanced)&&e.jsx(X,{tone:"info",size:"small",children:"AIâœ¨"})]})}),e.jsx(p,{style:{flex:"0 0 20%",minWidth:"120px",textAlign:"center"},children:e.jsx(X,{tone:"success",children:"Active"})})]})})}catch(i){return console.error("[BULK-EDIT-RENDER] ERROR rendering product:",i),console.error("[BULK-EDIT-RENDER] Product data:",t),null}},Wt=Re&&e.jsx(E,{open:Re,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(E.Section,{children:e.jsxs(T,{gap:"400",children:[e.jsx(c,{variant:"bodyMd",children:Ze?`Processing: ${Ze}`:"Preparing..."}),e.jsx(dt,{progress:be.percent}),e.jsxs(c,{variant:"bodySm",tone:"subdued",children:[be.current," of ",be.total," products (",be.percent,"%)"]})]})})}),qt=e.jsx(E,{open:At,title:"Select Languages",onClose:()=>{pe(!1),ae([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:Dt,disabled:D.length===0||ot},secondaryActions:[{content:"Cancel",onAction:()=>{pe(!1),ae([])}}],children:e.jsx(E.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsxs(c,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",x?"all":h.length," selected products:"]}),ot&&e.jsx(He,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(T,{gap:"200",children:[e.jsxs(c,{variant:"bodyMd",children:["Your ",Q," plan supports up to ",K," language",K>1?"s":""," per product.",h.length===1&&((ct=(lt=(it=y.find(t=>t.id===h[0]))==null?void 0:it.optimizationSummary)==null?void 0:lt.optimizedLanguages)==null?void 0:ct.length)>0&&e.jsxs(e.Fragment,{children:[" This product already has ",y.find(t=>t.id===h[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(c,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(k,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),n=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${n}`},children:"Upgrade Plan"})]})}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(w,{gap:"200",wrap:!0,children:L.map(t=>e.jsx(ve,{label:t.toUpperCase(),checked:D.includes(t),onChange:n=>{ae(n?[...D,t]:D.filter(s=>s!==t))}},t))})}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{D.length===L.length?ae([]):L.length>K?(ae([...L]),C(`You selected ${L.length} languages. Your ${Q} plan supports ${K}. Please deselect or upgrade.`)):ae([...L])},children:D.length===L.length?"Deselect all":"Select all"})}),e.jsx(c,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Gt=e.jsx(E,{open:wt&&!Re,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:Ut,disabled:!Object.values(ue).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>$e(!1)}],children:e.jsx(E.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsxs(w,{gap:"400",children:[e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(ue).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(ue).filter(t=>t.skipped).length})]}),e.jsxs(p,{children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(ue).filter(t=>!t.success).length})]})]}),Pe.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Zt,{}),e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(p,{maxHeight:"200px",overflowY:"scroll",children:[Pe.slice(0,10).map((t,n)=>e.jsxs(c,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},n)),Pe.length>10&&e.jsxs(c,{variant:"bodySm",tone:"subdued",children:["... and ",Pe.length-10," more errors"]})]})]})]})})}),Ht=e.jsx(E,{open:Ct,title:"Delete Optimization for AI Search",onClose:()=>{he(!1),ge([])},primaryAction:{content:"Continue",onAction:()=>{he(!1),we(!0)},disabled:H.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{he(!1),ge([])}}],children:e.jsx(E.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsxs(c,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",x?"all":h.length," selected products:"]}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(w,{gap:"200",wrap:!0,children:L.map(t=>e.jsx(ve,{label:t.toUpperCase(),checked:H.includes(t),onChange:n=>{ge(n?[...H,t]:H.filter(s=>s!==t))}},t))})}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{ge(H.length===L.length?[]:[...L])},children:H.length===L.length?"Deselect all":"Select all"})}),e.jsx(c,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),_t=e.jsx(E,{open:vt,title:"Confirm Deletion",onClose:()=>{we(!1)},primaryAction:{content:"Delete",onAction:Bt,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>we(!1)}],children:e.jsx(E.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsx(c,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(p,{paddingBlock:"200",children:e.jsx(w,{gap:"100",children:H.map(t=>e.jsx(X,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(c,{variant:"bodyMd",children:["This will delete optimisation from ",x?"ALL":h.length," selected products."]}),e.jsx(c,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),We=async()=>{try{xe(!0),C("Syncing products from Shopify...");const t=await A("/api/products/sync",{method:"POST",shop:d});if(t.success){const n=t.productsCount||t.synced||0;C(`âœ… Synced ${n} products successfully!`),setTimeout(()=>{se(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),C(`âŒ Sync failed: ${t.message}`)}finally{xe(!1)}},Ft=e.jsx(as,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Ye(""),Se("all"),ce(""),ye([]),se(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:We},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Qt,{globalPlan:j}),e.jsx(ut,{children:e.jsxs(p,{padding:"400",children:[e.jsxs(T,{gap:"300",children:[q&&e.jsx(He,{tone:"info",children:e.jsxs(w,{gap:"200",align:"space-between",children:[e.jsxs(c,{children:["Your ",e.jsx("strong",{children:q})," plan includes up to"," ",e.jsx("strong",{children:z})," products for SEO optimization.",R>z&&e.jsxs(e.Fragment,{children:[" You have ",R," products, so only the first ",z," will be processed."]})]}),(h.length>0||x)&&e.jsxs(c,{children:["Selected: ",x?Math.min(R,z):h.length,"/",z]})]})}),q&&(h.length>z||x&&R>z)&&e.jsx(He,{tone:"critical",children:e.jsxs(T,{gap:"200",children:[e.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),e.jsxs(c,{children:["Your ",e.jsx("strong",{children:q})," plan supports up to ",e.jsx("strong",{children:z})," products. You have selected ",e.jsx("strong",{children:x?R:h.length})," products."]}),e.jsx(c,{children:"Please deselect some products or upgrade your plan to continue."}),e.jsxs(w,{gap:"200",children:[e.jsx(k,{onClick:()=>{ne([]),le(!1)},children:"Clear Selection"}),e.jsx(k,{variant:"primary",onClick:()=>{_({error:"Product limit exceeded",message:`Your ${q} plan supports up to ${z} products. Upgrade to ${Le(x?R:h.length)} to optimize more products.`,minimumPlanRequired:Le(x?R:h.length)}),V(!0)},children:"Upgrade Plan"})]})]})}),e.jsxs(w,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(p,{minWidth:"400px",children:e.jsx(es,{label:"",placeholder:"Search by product ID, name, or details...",value:Z,onChange:rt,prefix:e.jsx(ts,{}),clearButton:!0,onClearButtonClick:()=>rt("")})}),e.jsx(p,{width:"320px",children:e.jsx(k,{primary:!0,onClick:Mt,disabled:h.length===0&&!x,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(w,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(k,{onClick:We,disabled:ie,size:"medium",children:"Sync Products"}),e.jsx(p,{width:"320px",children:e.jsxs(T,{gap:"200",align:"end",children:[(()=>{if(h.length===0&&!x||!y.filter(u=>h.includes(u.id)).some(u=>{var i,g;return((g=(i=u.optimizationSummary)==null?void 0:i.optimizedLanguages)==null?void 0:g.length)>0}))return null;const s=["professional","professional_plus","professional plus","growth","growth_plus","growth plus","growth_extra","growth extra","enterprise"].includes(Q.toLowerCase().replace(/_/g," "));return e.jsx(k,{onClick:s?Rt:()=>{_({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),V(!0)},disabled:h.length===0&&!x,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(k,{onClick:Tt,disabled:h.length===0&&!x||!y.filter(s=>h.includes(s.id)).some(s=>{var u,i;return((i=(u=s.optimizationSummary)==null?void 0:u.optimizedLanguages)==null?void 0:i.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),R>0&&e.jsx(p,{paddingBlockStart:"300",children:e.jsx(ve,{label:`Select all ${R} products in your store`,checked:x,onChange:at})})]})}),e.jsx(p,{paddingBlockStart:"400",children:e.jsxs(ut,{children:[e.jsxs(p,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(w,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(w,{gap:"200",wrap:!0,children:[e.jsx(Ie,{active:Ke,activator:e.jsx(k,{disclosure:"down",onClick:()=>ke(!Ke),removeUnderline:!0,children:e.jsxs(w,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),B!=="all"&&e.jsx(p,{onClick:t=>{t.stopPropagation(),Se("all")},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>ke(!1),children:e.jsx(p,{padding:"300",minWidth:"200px",children:e.jsx(Ee,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[B],onChange:t=>{Se(t[0]),ce(""),ke(!1)}})})}),e.jsx(Ie,{active:Ve,activator:e.jsx(k,{disclosure:"down",onClick:()=>Oe(!Ve),removeUnderline:!0,children:e.jsxs(w,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),$&&e.jsx(p,{onClick:t=>{t.stopPropagation(),ce("")},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Oe(!1),children:e.jsx(p,{padding:"300",minWidth:"200px",children:e.jsx(Ee,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...L.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...L.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:$?[$]:[],onChange:t=>{ce(t[0]||""),Oe(!1)}})})}),e.jsx(Ie,{active:Qe,activator:e.jsx(k,{disclosure:"down",onClick:()=>Me(!Qe),removeUnderline:!0,children:e.jsxs(w,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),N.length>0&&e.jsx(p,{onClick:t=>{t.stopPropagation(),ye([])},children:e.jsx(c,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>Me(!1),children:e.jsxs(p,{padding:"300",minWidth:"200px",children:[e.jsx(Ee,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:xt.map(t=>({label:t,value:t})),selected:N,onChange:t=>{ye(t)}}),e.jsx(p,{paddingBlockStart:"200",children:e.jsx(k,{size:"slim",onClick:()=>Me(!1),children:"Apply"})})]})})]}),e.jsx(Ie,{active:Je,activator:e.jsx(k,{disclosure:"down",onClick:()=>Te(!Je),removeUnderline:!0,children:e.jsx(w,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:re==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>Te(!1),children:e.jsx(p,{padding:"300",minWidth:"200px",children:e.jsx(Ee,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[re],onChange:t=>{ft(t[0]),Te(!1)}})})})]}),(B!=="all"||$||N.length>0)&&e.jsx(p,{paddingBlockStart:"200",children:e.jsxs(w,{gap:"100",wrap:!0,children:[B!=="all"&&e.jsx(X,{onRemove:()=>Se("all"),children:B==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),$&&e.jsx(X,{onRemove:()=>ce(""),children:$.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),N.map(t=>e.jsxs(X,{onRemove:()=>ye(n=>n.filter(s=>s!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(p,{children:[e.jsx(p,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(w,{gap:"200",align:"start",children:[e.jsx(ve,{checked:h.length===y.length&&y.length>0,onChange:at,label:""}),e.jsxs(c,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",h.length>0&&` (${h.length} selected products)`]})]})}),e.jsx(ss,{resourceName:{singular:"product",plural:"products"},items:y,renderItem:Nt,selectedItems:h,onSelectionChange:Ot,selectable:!0,loading:ie,totalItemsCount:R,emptyState:Ft,showHeader:!1},`products-${y.length}-${h.length}`)]}),mt&&!ie&&e.jsx(p,{padding:"400",textAlign:"center",children:e.jsx(k,{onClick:()=>se(gt+1,!0,null),children:"Load more"})})]})}),Wt,qt,Gt,Ht,_t,$t(),e.jsx(E,{open:Lt,onClose:()=>Ae(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Ae(!1),We()}},secondaryActions:[{content:"Skip for now",onAction:()=>Ae(!1)}],children:e.jsx(E.Section,{children:e.jsxs(T,{gap:"300",children:[e.jsx(c,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(c,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(Jt,{open:Ue,onClose:()=>{V(!1),_(null)},featureName:(S==null?void 0:S.error)||"Feature",errorMessage:S==null?void 0:S.message,currentPlan:(S==null?void 0:S.currentPlan)||Q,minimumPlanRequired:S==null?void 0:S.minimumPlanRequired,features:S==null?void 0:S.features}),S&&e.jsx(Xt,{open:kt,onClose:()=>{Be(!1),_(null)},tokensRequired:S.tokensRequired||0,tokensAvailable:S.tokensAvailable||0,tokensNeeded:S.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:d,needsUpgrade:S.needsUpgrade||!1,minimumPlan:S.minimumPlanForFeature||null,currentPlan:S.currentPlan||Q}),tt&&e.jsx(ns,{content:tt,onDismiss:()=>C("")})]})}export{ms as default};
