import{j as e}from"./app-bridge-BbdgrDeX-1761059742894.js";import{r as d}from"./react-vendor-tAaa2TlE-1761059742894.js";import{m as ke}from"./sessionFetch-CJepNHo3-1761059742894.js";import{L as g,C as j,a as c,T as n,d as O,e as o,f as A,I as l,g as le,B as p,D as k,h as we,i as Me}from"./polaris-CkipzO8Q-1761059742894.js";const Pe=(C,h="")=>{try{return new URLSearchParams(window.location.search).get(C)||h}catch{return h}};function Te({shop:C}){var q,V,H,Q,J,K,X,Z,ee,ne,te,ae;const h=C||Pe("shop",""),f=d.useMemo(()=>ke(),[]),y=a=>{const s=new URLSearchParams(window.location.search),S=s.toString()?`?${s.toString()}`:"";window.location.href=`${a}${S}`},[ce,W]=d.useState(!0),[t,he]=d.useState(null),[r,ue]=d.useState(null),[b,ge]=d.useState(null),[i,B]=d.useState(null),[v,w]=d.useState(!1),[$,M]=d.useState(!1),u=d.useRef(null),U=d.useRef(!1),[P,pe]=d.useState(!1),[me,xe]=d.useState(()=>{try{return localStorage.getItem(`dismissedUpgradeBanner_${h}`)==="true"}catch{return!1}});d.useEffect(()=>(N(),je(),()=>{u.current&&(clearInterval(u.current),u.current=null)}),[h]),d.useEffect(()=>{i&&i.autoSyncEnabled&&!v&&!U.current&&(console.log("[Dashboard] Auto-sync is enabled, triggering sync..."),U.current=!0,D())},[i==null?void 0:i.autoSyncEnabled]);const N=async()=>{try{W(!0);const[a,s]=await Promise.all([f(`/api/dashboard/stats?shop=${h}`),f(`/api/billing/tokens/balance?shop=${h}`)]);a&&(he(a),ue(a.subscription)),s&&ge(s)}catch(a){console.error("[Dashboard] Error loading data:",a)}finally{W(!1)}},je=async()=>{try{const a=await f(`/api/dashboard/sync-status?shop=${h}`);a&&(B(a),M(a.autoSyncEnabled||!1),w(!!a.inProgress))}catch(a){console.error("[Dashboard] Error loading sync status:",a)}},D=async()=>{try{w(!0);const a=await f(`/api/dashboard/sync?shop=${h}`,{method:"POST"});console.log("[Dashboard] Sync start response:",a),a!=null&&a.success||a!=null&&a.inProgress?(u.current&&clearInterval(u.current),u.current=setInterval(async()=>{try{const s=await f(`/api/dashboard/sync-status?shop=${h}`);s&&(B(s),s.inProgress||(u.current&&(clearInterval(u.current),u.current=null),w(!1),N()))}catch(s){console.error("[Dashboard] Poll error:",s)}},2e3)):w(!1)}catch(a){console.error("[Dashboard] Error syncing:",a),w(!1)}},_=async a=>{try{console.log("[Dashboard] Toggling auto-sync to:",a),M(a);const s=await f(`/api/dashboard/auto-sync?shop=${h}`,{method:"POST",body:{enabled:a}});console.log("[Dashboard] Auto-sync toggle response:",s),s!=null&&s.success&&(M(!!s.autoSyncEnabled),B({...i||{},autoSyncEnabled:!!s.autoSyncEnabled}))}catch(s){console.error("[Dashboard] Error toggling auto-sync:",s),M(!a)}},T=((q=t==null?void 0:t.products)==null?void 0:q.total)>0?Math.round(t.products.optimized/t.products.total*100):0,L=((V=t==null?void 0:t.collections)==null?void 0:V.total)>0?Math.round(t.collections.optimized/t.collections.total*100):0;["growth","growth_extra","enterprise"].includes(r==null?void 0:r.plan),["professional","growth","growth_extra","enterprise"].includes(r==null?void 0:r.plan),r==null||r.plan,["growth_extra","enterprise"].includes(r==null?void 0:r.plan);const G=d.useMemo(()=>({starter:9.99,professional:15.99,growth:29.99,growth_extra:49.99,enterprise:139.99}),[]),F=r!=null&&r.price&&r.price>0?r.price:r!=null&&r.plan?G[r.plan]:void 0,I=a=>{switch(a){case"starter":return{products:100,languages:1};case"professional":return{products:250,languages:2};case"growth":return{products:700,languages:3};case"growth_extra":return{products:1e3,languages:6};case"enterprise":return{products:2500,languages:10};default:return{products:0,languages:0}}},R=a=>({starter:1,professional:2,growth:3,growth_extra:4,enterprise:5})[a]||0,ye=()=>{var se,oe;if(!t)return null;const a=((se=t.products)==null?void 0:se.total)||0,s=((oe=t.languages)==null?void 0:oe.length)||1,S=(r==null?void 0:r.plan)||"starter",fe=R(S),ve=["starter","professional","growth","growth_extra","enterprise"];let x=null;for(const ie of ve){const de=I(ie);if(a<=de.products&&s<=de.languages){x=ie;break}}if(x||(x="enterprise"),R(x)<=fe)return null;const z=I(S),re=I(x);let E="";return a>z.products?E=`Your store has ${a} products, exceeding the ${z.products}-product limit of your current plan.`:s>z.languages&&(E=`Your store has ${s} language(s), exceeding the ${z.languages}-language limit of your current plan.`),{plan:x,planName:x.replace("_"," ").toUpperCase(),price:G[x],productLimit:re.products,languageLimit:re.languages,reason:E}},m=d.useMemo(()=>ye(),[t,r]),be=d.useMemo(()=>{if(!(r!=null&&r.plan))return!1;const a=r.plan;return!(a!=="professional"&&a!=="growth"||((b==null?void 0:b.balance)||0)>=1e3)},[r,b]),Se=()=>{try{localStorage.setItem(`dismissedUpgradeBanner_${h}`,"true"),xe(!0)}catch(a){console.error("[Dashboard] Error saving dismissed banner state:",a)}};if(ce)return e.jsx(g,{children:e.jsx(g.Section,{children:e.jsx(j,{children:e.jsx(c,{padding:"400",children:e.jsx(n,{children:"Loading dashboard..."})})})})});const Y=!(i!=null&&i.synced);return e.jsxs(g,{children:[Y&&e.jsx(g.Section,{children:e.jsx(O,{title:"Sync your store",tone:"info",action:{content:v?"Syncing...":"Sync Now",onAction:D,loading:v},children:e.jsxs(o,{gap:"200",children:[e.jsx(n,{children:"Sync products, collections, languages, and markets to get started with AI optimization."}),v&&e.jsxs(c,{paddingBlockStart:"200",children:[e.jsx(A,{progress:50,size:"small",tone:"highlight"}),e.jsx(c,{paddingBlockStart:"100",children:e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Fetching store data..."})})]})]})})}),!Y&&i&&e.jsx(g.Section,{children:e.jsx(j,{children:$?e.jsxs(l,{align:"space-between",blockAlign:"center",gap:"400",children:[e.jsxs(l,{gap:"200",blockAlign:"center",children:[e.jsx(le,{tone:"success",children:"Auto-sync enabled"}),e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["Last synced: ",i.lastSyncDate?new Date(i.lastSyncDate).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"]})]}),e.jsxs(l,{gap:"200",children:[e.jsx(p,{onClick:D,loading:v,size:"slim",children:"Sync Now"}),e.jsx(p,{onClick:()=>_(!1),size:"slim",variant:"plain",children:"Settings"})]})]}):e.jsxs(o,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"Store Sync"}),e.jsx(c,{paddingBlockStart:"050",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["Last synced: ",i.lastSyncDate?new Date(i.lastSyncDate).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"]})})]}),e.jsx(p,{onClick:D,loading:v,children:"Sync Now"})]}),e.jsx(k,{}),e.jsx(we,{label:"Auto-sync on load",checked:$,onChange:_,helpText:"Automatically sync store data when you open the dashboard"})]})})}),m&&!me&&e.jsx(g.Section,{children:e.jsx(O,{title:`Upgrade to ${m.planName} Plan`,tone:"warning",action:{content:"View Plans",onAction:()=>y("/billing")},onDismiss:Se,children:e.jsxs(o,{gap:"200",children:[e.jsx(n,{children:m.reason}),e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["The ",m.planName," plan supports up to ",m.productLimit," products in ",m.languageLimit," language",m.languageLimit>1?"s":"","for $",m.price,"/month."]})]})})}),be&&e.jsx(g.Section,{children:e.jsx(O,{title:"Buy Tokens to Unlock AI Features",tone:"info",action:{content:"Buy Tokens",onAction:()=>y("/billing")},children:e.jsx(n,{children:"Your current plan uses pay-per-use tokens. Purchase tokens to access AI-enhanced optimization features like SEO generation, bulk editing, and AI Discovery."})})}),e.jsx(g.Section,{children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:"16px"},children:[e.jsxs("div",{style:{display:"grid",gap:16},children:[e.jsx(j,{children:e.jsxs(o,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Products & Collections"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs(o,{gap:"150",children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"Products"}),e.jsxs(l,{align:"space-between",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Total"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",children:((H=t==null?void 0:t.products)==null?void 0:H.total)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Optimized"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",tone:"success",children:((Q=t==null?void 0:t.products)==null?void 0:Q.optimized)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Unoptimized"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",children:Math.max((((J=t==null?void 0:t.products)==null?void 0:J.total)||0)-(((K=t==null?void 0:t.products)==null?void 0:K.optimized)||0),0)})]}),e.jsxs(c,{paddingBlockStart:"100",children:[e.jsx(A,{progress:T,size:"small",tone:T===100?"success":"primary"}),e.jsx(c,{paddingBlockStart:"050",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[T,"% optimized"]})})]})]}),e.jsxs(o,{gap:"150",children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"Collections"}),e.jsxs(l,{align:"space-between",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Total"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",children:((X=t==null?void 0:t.collections)==null?void 0:X.total)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Optimized"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",tone:"success",children:((Z=t==null?void 0:t.collections)==null?void 0:Z.optimized)||0})]}),e.jsxs(l,{align:"space-between",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",children:"Unoptimized"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",children:Math.max((((ee=t==null?void 0:t.collections)==null?void 0:ee.total)||0)-(((ne=t==null?void 0:t.collections)==null?void 0:ne.optimized)||0),0)})]}),e.jsxs(c,{paddingBlockStart:"100",children:[e.jsx(A,{progress:L,size:"small",tone:L===100?"success":"primary"}),e.jsx(c,{paddingBlockStart:"050",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[L,"% optimized"]})})]})]})]}),e.jsx(k,{}),e.jsx(l,{align:"space-between",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["Last synced: ",i!=null&&i.lastSyncDate?new Date(i.lastSyncDate).toLocaleString():"Never"]})})]})}),e.jsx(j,{style:{height:220,minHeight:220},children:e.jsxs(o,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs("div",{children:[e.jsx(n,{variant:"headingMd",children:"Current Plan"}),e.jsx(c,{paddingBlockStart:"100",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[F?`$${F.toFixed(2)}`:"—","/month"]})})]}),e.jsx(le,{tone:"info",size:"large",children:((te=r==null?void 0:r.plan)==null?void 0:te.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsx(p,{onClick:()=>y("/billing"),children:"View Plans & Billing"})]})})]}),e.jsxs("div",{style:{display:"grid",gap:16},children:[e.jsx(j,{children:e.jsxs(o,{gap:"400",children:[e.jsx(n,{variant:"headingMd",children:"Languages & Markets"}),e.jsx(o,{gap:"200",children:t!=null&&t.languages&&t.languages.length>0?e.jsxs(e.Fragment,{children:[t.languages.slice().sort((a,s)=>(s.primary?1:0)-(a.primary?1:0)||(s.totalCount||0)-(a.totalCount||0)).slice(0,3).map((a,s)=>{const S=a.totalCount>0?Math.round(a.optimizedCount/a.totalCount*100):0;return e.jsxs(o,{gap:"050",children:[e.jsxs(l,{align:"space-between",children:[e.jsxs(n,{variant:"bodyMd",tone:"subdued",children:[a.name||a.code," ",a.primary?"★":""]}),e.jsxs(n,{variant:"bodySm",fontWeight:"semibold",children:[a.optimizedCount||0,"/",a.totalCount||0]})]}),e.jsx(A,{progress:S,size:"small",tone:S===100?"success":"primary"})]},s)}),t.languages.length>3&&e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["+",t.languages.length-3," more..."]})]}):e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"No language data"})}),(t==null?void 0:t.storeMarkets)&&t.storeMarkets.length>0&&e.jsxs(c,{paddingBlockStart:"200",children:[e.jsx(k,{}),e.jsx(c,{paddingBlockStart:"200",children:e.jsxs(n,{variant:"bodySm",tone:"subdued",children:["Markets: ",t.storeMarkets.slice(0,2).map(a=>a.name).join(", "),t.storeMarkets.length>2?` +${t.storeMarkets.length-2}`:""]})})]})]})}),e.jsx(j,{children:e.jsxs(o,{gap:"300",children:[e.jsx(n,{variant:"headingMd",children:"Last Optimization"}),e.jsx(n,{variant:"bodyLg",fontWeight:"semibold",children:t!=null&&t.lastOptimization?new Date(t.lastOptimization).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}),e.jsx(p,{onClick:()=>y("/ai-seo/products"),children:"Optimize Now"})]})}),e.jsx(j,{style:{height:220,minHeight:220},children:e.jsxs(o,{gap:"300",children:[e.jsx(n,{variant:"headingMd",children:"Token Balance"}),e.jsxs(n,{variant:"bodyLg",fontWeight:"semibold",children:[((ae=b==null?void 0:b.balance)==null?void 0:ae.toLocaleString())||0," tokens"]}),((r==null?void 0:r.plan)==="growth_extra"||(r==null?void 0:r.plan)==="enterprise")&&e.jsxs(n,{variant:"bodySm",tone:"subdued",children:[(r==null?void 0:r.plan)==="growth_extra"?"100M":"300M"," included monthly"]}),e.jsx(p,{onClick:()=>y("/billing"),children:"Manage Tokens"})]})})]})]})}),e.jsx(g.Section,{children:e.jsx(j,{children:e.jsxs(o,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{variant:"headingMd",children:"Getting Started"}),e.jsxs(p,{onClick:()=>pe(!P),disclosure:P?"up":"down",children:[P?"Hide":"Show"," Guide"]})]}),e.jsx(Me,{open:P,id:"onboarding-collapsible",transition:{duration:"200ms",timingFunction:"ease-in-out"},children:e.jsx(c,{paddingBlockStart:"300",children:e.jsxs(o,{gap:"400",children:[e.jsx(k,{}),e.jsxs(o,{gap:"300",children:[e.jsx(n,{variant:"headingMd",as:"h3",children:"What This App Does"}),e.jsxs(n,{variant:"bodyMd",tone:"subdued",children:["This app helps optimize your Shopify store for ",e.jsx("strong",{children:"AI search engines"})," (like ChatGPT, Claude, Perplexity) by structuring your existing product data in a format that AI bots can easily understand and reference."]}),e.jsxs(n,{variant:"bodyMd",tone:"subdued",children:[e.jsx("strong",{children:"Important:"})," This app primarily ",e.jsx("strong",{children:"structures"})," your existing data rather than creating new content. AI-enhanced features are supplementary and require additional tokens (unless you're on Growth Extra or Enterprise plans)."]})]}),e.jsx(k,{}),e.jsxs(o,{gap:"300",children:[e.jsx(n,{variant:"headingMd",as:"h3",children:"Quick Start Guide"}),e.jsxs(o,{gap:"200",children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"1. Sync Your Store Data"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:'Click "Sync Now" to fetch your products, collections, languages, and markets from Shopify. This is required before you can start optimizing. Enable "Auto-sync on load" to keep your data fresh.'}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"2. Plan Selection & Token Management"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:'Plan selection happens during app installation. Visit "Plans & Billing" to upgrade your plan or purchase additional tokens for AI-enhanced features (Professional/Growth plans).'}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"3. Structure Your Product Data"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:'Go to "Search Optimization for AI" → Products tab. Select products and click "AI Enhance" to structure existing titles, descriptions, and metadata for better AI consumption.'}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"4. Configure Store Metadata"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:'Go to "Store Metadata" to configure store description, keywords, business information, and contact details (Professional+ plans).'}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"5. Generate AI Sitemap"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Navigate to Sitemap tab and generate your AI-optimized sitemap. This helps AI search engines discover and index your products (Growth Extra+ plans)."}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"6. AI-Enhanced Features (Optional)"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Use AI Testing and AI Discovery Endpoints for advanced optimization. These features require additional tokens unless you're on Growth Extra or Enterprise plans."}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",children:"7. Monitor & Improve"}),e.jsx(n,{variant:"bodyMd",tone:"subdued",children:"Return to Dashboard regularly to track optimization progress, monitor token usage, and review plan recommendations."})]})]}),e.jsx(k,{}),e.jsxs(o,{gap:"200",children:[e.jsx(n,{variant:"headingMd",as:"h3",children:"Video Tutorial"}),e.jsx(c,{padding:"400",background:"bg-surface-secondary",borderRadius:"200",children:e.jsxs(o,{gap:"200",inlineAlign:"center",children:[e.jsx(n,{variant:"bodyMd",tone:"subdued",alignment:"center",children:"Video tutorial coming soon"}),e.jsx(n,{variant:"bodySm",tone:"subdued",alignment:"center",children:"[Embedded video will be added here]"})]})})]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsxs(l,{gap:"200",children:[e.jsx(p,{variant:"primary",onClick:()=>y("/ai-seo/products"),children:"Start Optimizing"}),e.jsx(p,{onClick:()=>y("/billing"),children:"View Plans"})]})})]})})})]})})})]})}export{Te as default};
