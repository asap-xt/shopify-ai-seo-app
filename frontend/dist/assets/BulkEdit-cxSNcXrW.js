import{r as e,j as t}from"./react-vendor-BXVC7v0l.js";import{u as n}from"./useShopApi-BPGAW5iN.js";import{S as s,U as a}from"./StoreMetadataBanner-_-ut6CwW.js";import{I as i,T as r,a as l}from"./TokenPurchaseModal-DozAvzCY.js";import{M as o,a as d,T as c,e as u,d as p,b as h,B as g,I as m,g as f,f as x,C as j,h as S,S as y,i as v,j as b,k as A,R as P,l as w,m as k,n as C,E as I}from"./polaris-CyaoFo5Q.js";import"./app-bridge-DUY42B6P.js";import"./vendor-Cs_VgJ2r.js";const z=e=>{if(!e)return e;const t=String(e).trim();return t.startsWith("gid://")?t:`gid://shopify/Product/${t}`},$=e=>e<=70?"Starter":e<=200?"Professional":e<=450?"Growth":e<=750?"Growth Extra":"Enterprise";function E({shop:E,globalPlan:O}){var L,T,R;const{api:M,shop:U}=n(),q=E||U||((e,t="")=>{try{return new URLSearchParams(window.location.search).get(e)||t}catch{return t}})("shop","");e.useEffect(()=>{},[q,M]);const[D,W]=e.useState([]),[B,F]=e.useState(!1),[_,N]=e.useState(1),[Y,H]=e.useState(!0),[G,K]=e.useState(0),[V,J]=e.useState([]),[Q,X]=e.useState(!1),[Z,ee]=e.useState(""),[te,ne]=e.useState("all"),[se,ae]=e.useState(""),[ie,re]=e.useState("createdAt"),[le,oe]=e.useState("desc"),[de,ce]=e.useState([]),[ue,pe]=e.useState([]),[he,ge]=e.useState(!1),[me,fe]=e.useState(!1),[xe,je]=e.useState(!1),[Se,ye]=e.useState(!1),[ve,be]=e.useState(""),[Ae,Pe]=e.useState([]),[we,ke]=e.useState([]),[Ce,Ie]=e.useState([]),[ze,$e]=e.useState(!1),[Ee,Oe]=e.useState({current:0,total:0,percent:0}),[Le,Te]=e.useState(""),[Re,Me]=e.useState([]),[Ue,qe]=e.useState(!1),[De,We]=e.useState(!1),[Be,Fe]=e.useState([]),[_e,Ne]=e.useState(!1),[Ye,He]=e.useState(""),[Ge,Ke]=e.useState(!1),[Ve,Je]=e.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[Qe,Xe]=e.useState({inProgress:!1,status:"idle",phase:null,message:null,totalProducts:0,processedProducts:0,successfulProducts:0,failedProducts:0,skippedProducts:0}),[Ze,et]=e.useState(null),[tt,nt]=e.useState(null),[st,at]=e.useState(70),[it,rt]=e.useState(1),[lt,ot]=e.useState(!1),[dt,ct]=e.useState("true"===localStorage.getItem("hasVisitedProducts")),[ut,pt]=e.useState(!1),[ht,gt]=e.useState(!1),[mt,ft]=e.useState(!1),[xt,jt]=e.useState(!1),[St,yt]=e.useState(null),[vt,bt]=e.useState("starter"),[At,Pt]=e.useState(!1),wt=e.useCallback(async()=>{var e,t;try{const n=await M(`/api/seo/job-status?shop=${q}`);if(Xe(n),"completed"===n.status||"failed"===n.status)if(Ze&&(clearInterval(Ze),et(null)),"completed"===n.status){const s=`Applied AIEO to ${n.successfulProducts} product${1!==n.successfulProducts?"s":""}`+(n.skippedProducts>0?` (${n.skippedProducts} skipped)`:"")+(n.failedProducts>0?` (${n.failedProducts} failed)`:"");He(s);const a=new URLSearchParams({shop:q,page:1,limit:50,..."all"!==te&&{optimized:te},...Z&&{search:Z},sortBy:ie,sortOrder:le,_t:Date.now()}),i=await M(`/api/products/list?${a}`,{shop:q});W(i.products||[]),N(1),H((null==(e=i.pagination)?void 0:e.hasNext)||!1),K((null==(t=i.pagination)?void 0:t.total)||0)}else"failed"===n.status&&He(`AIEO optimization failed: ${n.message||"Unknown error"}`);return n}catch(n){}},[q,M,Ze,te,Z,ie,le]),kt=e.useCallback(()=>{Ze&&clearInterval(Ze),wt();const e=setInterval(()=>{wt()},5e3);et(e)},[wt,Ze]);e.useEffect(()=>()=>{Ze&&clearInterval(Ze)},[Ze]),e.useEffect(()=>{q&&M&&wt().then(e=>{(null==e?void 0:e.inProgress)&&kt()})},[q]),e.useEffect(()=>{if(O&&"object"==typeof O&&!At&&"starter"===vt)if(O.planKey&&""!==O.planKey){bt(O.planKey);const e=O.language_limit||1;rt(e)}else if(O.plan&&""!==O.plan){const e=O.plan.toLowerCase().replace(/\s+/g,"-");bt(e);const t=O.language_limit||1;rt(t)}},[O,vt,At]),e.useEffect(()=>{if(ut&&tt){(Q?G:V.length)<=st&&(pt(!1),yt(null))}},[V.length,Q,G,ut,tt]),e.useEffect(()=>{if(!q)return;M("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n      query PlansMe($shop:String!) {\n        plansMe(shop:$shop) {\n          plan\n          planKey\n          modelsSuggested\n          product_limit\n          language_limit\n        }\n      }\n    ",variables:{shop:q}})}).then(e=>{var t,n,s;if(null==(t=null==e?void 0:e.errors)?void 0:t.length)throw new Error((null==(n=e.errors[0])?void 0:n.message)||"GraphQL error");const a=null==(s=null==e?void 0:e.data)?void 0:s.plansMe,i=(null==a?void 0:a.modelsSuggested)||["anthropic/claude-3.5-sonnet"];Pe(i.map(e=>({label:e,value:e}))),be(i[0]),nt((null==a?void 0:a.plan)||"starter"),bt((null==a?void 0:a.planKey)||"starter");const r=(null==a?void 0:a.product_limit)||70,l=(null==a?void 0:a.language_limit)||1;at(r),rt(l),Pt(!0)}).catch(e=>{Pt(!0)})},[q,M]),e.useEffect(()=>{if(!q)return;const e=new Promise((e,t)=>{setTimeout(()=>t(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([M(`/api/languages/shop/${q}`),e]).then(e=>{const t=Array.isArray(null==e?void 0:e.shopLanguages)&&e.shopLanguages.length?e.shopLanguages:["en"];Ie(t.includes("en")?t:["en",...t])}).catch(e=>{Ie(["en"])})},[q,M]),e.useEffect(()=>{q&&M("/api/products/tags/list",{shop:q}).then(e=>pe((null==e?void 0:e.tags)||[])).catch(e=>{})},[q,M]);const Ct=e.useCallback(async(e=1,t=!1,n=null)=>{var s,a,i,r;F(!0);try{const l=new URLSearchParams({shop:q,page:e,limit:50,..."all"!==te&&{optimized:te},...Z&&{search:Z},...se&&{languageFilter:se},...de.length>0&&{tags:de.join(",")},sortBy:ie,sortOrder:le,...n&&{_t:n}}),o=await M(`/api/products/list?${l}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});null==(s=o.products)||s.length,(null==(a=o.products)?void 0:a.length)>0&&o.products.forEach((e,t)=>{}),W(t?e=>[...e,...o.products]:o.products||[]),N(e),H((null==(i=o.pagination)?void 0:i.hasNext)||!1),K((null==(r=o.pagination)?void 0:r.total)||0)}catch(l){W(t?D:[]),H(!1),He(`Error loading products: ${l.message}`)}finally{F(!1)}},[q,te,Z,se,de,ie,le]);e.useEffect(()=>{q&&Ct(1,!1,null)},[q,te,se,de,ie,le]),e.useEffect(()=>{!dt&&q&&(localStorage.setItem("hasVisitedProducts","true"),ct(!0))},[dt,q]),e.useEffect(()=>{0!==D.length||B||!q||dt||ot(!0)},[D.length,B,q,dt]),e.useEffect(()=>{},[D,V]);const It=e.useCallback(e=>{ee(e)},[]);e.useEffect(()=>{const e=setTimeout(()=>{q&&Ct(1,!1,null)},500);return()=>clearTimeout(e)},[Z]);const zt=e.useCallback(e=>{J(e),0===e.length&&X(!1)},[]),$t=e.useCallback(e=>{X(e),J(e?D.map(e=>e.id):[])},[D]),Et=e.useMemo(()=>{var e;if(Q)return we.length>it;const t=D.filter(e=>V.includes(e.id));if(0===t.length)return we.length>it;for(const n of t){const t=(null==(e=n.optimizationSummary)?void 0:e.optimizedLanguages)||[],s=we.filter(e=>!t.includes(e));if(t.length+s.length>it)return!0}return!1},[D,V,Q,it,we]),Ot=async()=>{const e=D.filter(e=>V.includes(e.id)),t=e.filter(e=>{var t,n;return(null==(n=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:n.length)>0}),n=e.filter(e=>{var t,n;return!(null==(n=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:n.length)}),s=t.length;if(s>st){const e=$(s);return yt({error:"Product limit exceeded",message:`Your ${tt} plan supports up to ${st} products for AI Enhancement. You have selected ${s} products with Basic SEO.`,minimumPlanRequired:e,currentPlan:tt,features:[`Optimize up to ${st} products`,"All features from your current plan","Growth Extra"===e||"Enterprise"===e?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons","Enterprise"===e?"Advanced Schema Data":null].filter(Boolean)}),void pt(!0)}Ke(!0),Je({processing:!0,current:0,total:t.length,currentItem:"",results:null});const a={successful:0,failed:0,skipped:n.length,skipReasons:n.length>0?[`${n.length} product(s): No Basic Optimization`]:[]};for(let r=0;r<t.length;r++){const e=t[r];Je(t=>({...t,current:r,currentItem:e.title}));try{const t=e.gid||z(e.id);if(!t){a.failed++;continue}const n=await M("/ai-enhance/product",{method:"POST",shop:q,body:{shop:q,productId:t,languages:e.optimizationSummary.optimizedLanguages}});if(n.results&&n.results.length>0){const t={shop:q,productId:e.gid||z(e.id),results:n.results.filter(e=>e.bullets&&e.faq).map(e=>({language:e.language,seo:{...e.updatedSeo,bullets:e.bullets||[],faq:e.faq||[]}})),options:{updateBullets:!0,updateFaq:!0}};await M("/api/seo/apply-multi",{method:"POST",shop:q,body:t});a.successful++}else a.failed++}catch(i){if(403===i.status)return Je({processing:!1,current:0,total:0,currentItem:"",results:null}),yt({...i,message:i.message||"AI-enhanced add-ons for Products require Professional plan or higher"}),bt(i.currentPlan||vt),void(!1===i.needsUpgrade&&i.requiresPurchase?gt(!0):pt(!0));if(402===i.status||i.requiresPurchase||i.trialRestriction)return Je({processing:!1,current:0,total:0,currentItem:"",results:null}),yt(i),bt(i.currentPlan||tt||"starter"),void(i.trialRestriction&&i.requiresActivation?ft(!0):i.trialRestriction?pt(!0):gt(!0));a.failed++}Je(e=>({...e,current:r+1}))}Je(e=>({...e,processing:!1,results:a})),He(`AI enhancement complete! ${a.successful} products enhanced.`)},Lt=()=>{const e=Ve.results;Ke(!1),Je({processing:!1,current:0,total:0,currentItem:"",results:null}),e&&e.successful>0&&setTimeout(()=>{W([]),Ct(1,!1,Date.now())},1500)},Tt=ze&&t.jsx(o,{open:ze,title:"Processing Products",onClose:()=>{},noScroll:!0,children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"400",children:[t.jsx(c,{variant:"bodyMd",children:Le?`Processing: ${Le}`:"Preparing..."}),t.jsx(u,{progress:Ee.percent}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:[Ee.current," of ",Ee.total," products (",Ee.percent,"%)"]})]})})}),Rt=t.jsx(o,{open:Ue,title:"Select Languages",onClose:()=>{qe(!1),ke([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:async()=>{var e;if(!we.length)return void He("Please select at least one language");let t=ve;t&&t.trim()||(t=(null==(e=Ae[0])?void 0:e.value)||"anthropic/claude-3.5-sonnet");try{let e=[];if(Q){e=(await M(`/api/products/list?shop=${encodeURIComponent(q)}&limit=1000&fields=id`)).products||[]}else e=D.filter(e=>V.includes(e.id));const n=e.length;if(n>st){qe(!1);const e=$(n);return yt({error:"Product limit exceeded",message:`Your ${vt} plan supports up to ${st} products for SEO optimization. You have selected ${n} products.`,minimumPlanRequired:e,currentPlan:vt,features:["Optimize more products","All features from your current plan","Growth Extra"===e||"Enterprise"===e?"AI-enhanced add-ons at no extra cost":"Access to AI-enhanced add-ons","Enterprise"===e?"Advanced Schema Data":null].filter(Boolean)}),void pt(!0)}qe(!1);const s=e.map(e=>{var t;return{productId:e.gid||z(e.productId||e.id),languages:we,existingLanguages:(null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)||[]}}),a=await M("/api/seo/generate-apply-batch",{method:"POST",shop:q,body:{shop:q,products:s,model:t}});a.queued?(J([]),X(!1),He(`Optimizing ${s.length} products in background...`),kt()):He(a.message||"Failed to queue optimization job")}catch(n){He(`Error: ${n.message}`)}},disabled:0===we.length||Et},secondaryActions:[{content:"Cancel",onAction:()=>{qe(!1),ke([])}}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsxs(c,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",Q?"all":V.length," selected products:"]}),Et&&t.jsx(p,{tone:"warning",title:"Language limit exceeded",children:t.jsxs(d,{gap:"200",children:[t.jsxs(c,{variant:"bodyMd",children:["Your ",vt," plan supports up to ",it," language",it>1?"s":""," per product.",1===V.length&&(null==(R=null==(T=null==(L=D.find(e=>e.id===V[0]))?void 0:L.optimizationSummary)?void 0:T.optimizedLanguages)?void 0:R.length)>0&&t.jsxs(t.Fragment,{children:[" This product already has ",D.find(e=>e.id===V[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),t.jsx(c,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),t.jsx(h,{variant:"primary",onClick:()=>{const e=new URLSearchParams(window.location.search),t=e.toString()?`?${e.toString()}`:"";window.location.href=`/billing${t}`},children:"Upgrade Plan"})]})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"200",wrap:!0,children:Ce.map(e=>t.jsx(f,{label:e.toUpperCase(),checked:we.includes(e),onChange:t=>{ke(t?[...we,e]:we.filter(t=>t!==e))}},e))})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(h,{plain:!0,onClick:()=>{we.length===Ce.length?ke([]):Ce.length>it?(ke([...Ce]),He(`You selected ${Ce.length} languages. Your ${vt} plan supports ${it}. Please deselect or upgrade.`)):ke([...Ce])},children:we.length===Ce.length?"Deselect all":"Select all"})}),t.jsx(c,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Mt=t.jsx(o,{open:De,title:"Delete Optimization for AI Search",onClose:()=>{We(!1),Fe([])},primaryAction:{content:"Continue",onAction:()=>{We(!1),Ne(!0)},disabled:0===Be.length,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{We(!1),Fe([])}}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsxs(c,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",Q?"all":V.length," selected products:"]}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"200",wrap:!0,children:Ce.map(e=>t.jsx(f,{label:e.toUpperCase(),checked:Be.includes(e),onChange:t=>{Fe(t?[...Be,e]:Be.filter(t=>t!==e))}},e))})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(h,{plain:!0,onClick:()=>{Fe(Be.length===Ce.length?[]:[...Ce])},children:Be.length===Ce.length?"Deselect all":"Select all"})}),t.jsx(c,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),Ut=t.jsx(o,{open:_e,title:"Confirm Deletion",onClose:()=>{Ne(!1)},primaryAction:{content:"Delete",onAction:async()=>{var e;if(Be.length){We(!1),Ne(!1),$e(!0),Oe({current:0,total:0,percent:0}),Me([]);try{let n=[];if(Q){n=(await M(`/api/products/list?shop=${encodeURIComponent(q)}&limit=1000&fields=id`)).products||[]}else n=D.filter(e=>V.includes(e.id));const s=n.length;Oe({current:0,total:s,percent:0});let a=0,i=0;for(let r=0;r<n.length;r++){const l=n[r];Te(l.title||l.handle||"Product");try{const t=l.gid||z(l.productId||l.id),n=(null==(e=l.optimizationSummary)?void 0:e.optimizedLanguages)||[],s=Be.filter(e=>n&&n.length>0&&n.includes(e));if(0===s.length){i++;continue}const r=await M("/api/seo/delete-multi",{method:"POST",shop:q,body:{shop:q,productId:t,languages:s}});r.deletedLanguages&&r.deletedLanguages.length>0&&W(e=>e.map(e=>{var t;if(e.id===l.id){const n=((null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)||[]).filter(e=>!r.deletedLanguages.includes(e));return{...e,optimizationSummary:{...e.optimizationSummary,optimizedLanguages:n,optimized:n.length>0,aiEnhanced:n.length>0&&e.optimizationSummary.aiEnhanced,lastOptimized:n.length>0?e.optimizationSummary.lastOptimized:null}}}return e})),a++,r.deletedLanguages&&r.deletedLanguages.length>0&&await M("/api/products/verify-after-delete",{method:"POST",shop:q,body:{shop:q,productIds:[t],deletedLanguages:r.deletedLanguages}})}catch(t){Me(e=>[...e,{product:l.title,error:t.message}])}const o=r+1,d=Math.round(o/s*100);Oe({current:o,total:s,percent:d})}J([]),X(!1),He(i>0?`Deleted Optimization for AI Search from ${a} products (${i} had no optimisation to delete)`:`Deleted Optimization for AI Search from ${a} products`),setTimeout(()=>{const e=Date.now();Ct(1,!1,e)},500)}catch(t){He(`Error: ${t.message}`)}finally{$e(!1),Te("")}}else He("Please select at least one language to delete")},destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>Ne(!1)}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsx(c,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),t.jsx(g,{paddingBlock:"200",children:t.jsx(m,{gap:"100",children:Be.map(e=>t.jsx(x,{tone:"critical",children:e.toUpperCase()},e))})}),t.jsxs(c,{variant:"bodyMd",children:["This will delete optimisation from ",Q?"ALL":V.length," selected products."]}),t.jsx(c,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),qt=async()=>{try{F(!0),He("Syncing products from Shopify...");const e=await M("/api/products/sync",{method:"POST",shop:q});if(!e.success)throw new Error(e.error||"Sync failed");{const t=e.productsCount||e.synced||0;He(`✅ Synced ${t} products successfully!`),setTimeout(()=>{Ct(1,!1,Date.now())},1e3)}}catch(e){He(`❌ Sync failed: ${e.message}`)}finally{F(!1)}},Dt=t.jsx(I,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{ee(""),ne("all"),ae(""),ce([]),Ct(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:qt},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:t.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return t.jsxs(t.Fragment,{children:[t.jsx(s,{globalPlan:O}),t.jsx(j,{children:t.jsxs(g,{padding:"400",children:[t.jsxs(d,{gap:"300",children:[tt&&t.jsx(p,{tone:"info",children:t.jsxs(m,{gap:"200",align:"space-between",children:[t.jsxs(c,{children:["Your ",t.jsx("strong",{children:tt})," plan includes up to"," ",t.jsx("strong",{children:st})," products for SEO optimization.",G>st&&t.jsxs(t.Fragment,{children:[" You have ",G," products, so only the first ",st," will be processed."]})]}),(V.length>0||Q)&&t.jsxs(c,{children:["Selected: ",Q?Math.min(G,st):V.length,"/",st]})]})}),tt&&(V.length>st||Q&&G>st)&&t.jsx(p,{tone:"critical",children:t.jsxs(d,{gap:"200",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Product limit exceeded"}),t.jsxs(c,{children:["Your ",t.jsx("strong",{children:tt})," plan supports up to ",t.jsx("strong",{children:st})," products. You have selected ",t.jsx("strong",{children:Q?G:V.length})," products."]}),t.jsx(c,{children:"Please deselect some products or upgrade your plan to continue."}),t.jsxs(m,{gap:"200",children:[t.jsx(h,{onClick:()=>{J([]),X(!1)},children:"Clear Selection"}),t.jsx(h,{variant:"primary",onClick:()=>{yt({error:"Product limit exceeded",message:`Your ${tt} plan supports up to ${st} products. Upgrade to ${$(Q?G:V.length)} to optimize more products.`,minimumPlanRequired:$(Q?G:V.length)}),pt(!0)},children:"Upgrade Plan"})]})]})}),t.jsxs(m,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[t.jsx(g,{minWidth:"400px",children:t.jsx(S,{label:"",placeholder:"Search by product ID, name, or details...",value:Z,onChange:It,prefix:t.jsx(y,{}),clearButton:!0,onClearButtonClick:()=>It("")})}),t.jsx(g,{width:"320px",children:t.jsx(h,{primary:!0,onClick:()=>{0!==V.length||Q?qe(!0):He("Please select products first")},disabled:0===V.length&&!Q,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),t.jsxs(m,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[t.jsx(h,{onClick:qt,disabled:B,size:"medium",children:"Sync Products"}),t.jsx(g,{width:"320px",children:t.jsxs(d,{gap:"200",align:"end",children:[(()=>{if(0===V.length&&!Q)return null;if(!D.filter(e=>V.includes(e.id)).some(e=>{var t,n;return(null==(n=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:n.length)>0}))return null;const e=["professional","professional_plus","professional plus","growth","growth_plus","growth plus","growth_extra","growth extra","enterprise"].includes(vt.toLowerCase().replace(/_/g," "));return t.jsx(h,{onClick:e?Ot:()=>{yt({error:"AI Enhancement requires a higher plan",message:"Upgrade to Professional plan to access AI-enhanced optimization for Products",minimumPlanRequired:"Professional"}),pt(!0)},disabled:0===V.length&&!Q,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),t.jsx(h,{onClick:()=>{0!==V.length||Q?(Fe([]),We(!0)):He("Please select products first")},disabled:0===V.length&&!Q||!D.filter(e=>V.includes(e.id)).some(e=>{var t,n;return(null==(n=null==(t=e.optimizationSummary)?void 0:t.optimizedLanguages)?void 0:n.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),G>0&&t.jsx(g,{paddingBlockStart:"300",children:t.jsx(f,{label:`Select all ${G} products in your store`,checked:Q,onChange:$t})})]})}),(Qe.inProgress||"completed"===Qe.status||"failed"===Qe.status)&&t.jsx(g,{paddingBlockStart:"400",children:t.jsx(j,{children:t.jsx(g,{padding:"400",children:Qe.inProgress?t.jsxs(m,{gap:"300",align:"start",blockAlign:"center",children:[t.jsx(v,{size:"small"}),t.jsxs(d,{gap:"100",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"generate"===Qe.phase?"Generating AIEO...":"Applying AIEO..."}),t.jsx(c,{variant:"bodySm",tone:"subdued",children:Qe.message||`Processing ${Qe.processedProducts}/${Qe.totalProducts} products`}),Qe.totalProducts>0&&t.jsx(g,{paddingBlockStart:"100",children:t.jsx(u,{progress:Qe.processedProducts/Qe.totalProducts*100,size:"small"})})]})]}):"completed"===Qe.status?t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"success",children:"Completed"}),t.jsxs(c,{variant:"bodyMd",children:["Applied AIEO to ",Qe.successfulProducts," product",1!==Qe.successfulProducts?"s":"",Qe.skippedProducts>0&&t.jsxs(c,{as:"span",tone:"subdued",children:[" (",Qe.skippedProducts," skipped)"]}),Qe.failedProducts>0&&t.jsxs(c,{as:"span",tone:"critical",children:[" (",Qe.failedProducts," failed)"]})]}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["· ",Qe.completedAt&&(()=>{const e=new Date(Qe.completedAt),t=new Date-e,n=Math.floor(t/6e4),s=Math.floor(t/36e5),a=Math.floor(t/864e5);return n<1?"Just now":n<60?`${n} min${n>1?"s":""} ago`:s<24?`${s} hour${s>1?"s":""} ago`:`${a} day${a>1?"s":""} ago`})()]})]}):t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(x,{tone:"critical",children:"Failed"}),t.jsx(c,{variant:"bodyMd",tone:"critical",children:Qe.message||"Optimization failed"}),Qe.successfulProducts>0&&t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["· ",Qe.successfulProducts," succeeded before failure"]})]})})})}),t.jsx(g,{paddingBlockStart:"400",children:t.jsxs(j,{children:[t.jsxs(g,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[t.jsxs(m,{gap:"200",wrap:!0,align:"space-between",children:[t.jsxs(m,{gap:"200",wrap:!0,children:[t.jsx(b,{active:he,activator:t.jsx(h,{disclosure:"down",onClick:()=>ge(!he),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"AI Search Status"}),"all"!==te&&t.jsx(g,{onClick:e=>{e.stopPropagation(),ne("all")},children:t.jsx(c,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ge(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(A,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[te],onChange:e=>{ne(e[0]),ae(""),ge(!1)}})})}),t.jsx(b,{active:me,activator:t.jsx(h,{disclosure:"down",onClick:()=>fe(!me),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"Language Status"}),se&&t.jsx(g,{onClick:e=>{e.stopPropagation(),ae("")},children:t.jsx(c,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>fe(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(A,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...Ce.map(e=>({label:`Has ${e.toUpperCase()}`,value:`has_${e}`})),...Ce.map(e=>({label:`Missing ${e.toUpperCase()}`,value:`missing_${e}`}))],selected:se?[se]:[],onChange:e=>{ae(e[0]||""),fe(!1)}})})}),t.jsx(b,{active:xe,activator:t.jsx(h,{disclosure:"down",onClick:()=>je(!xe),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"Tags"}),de.length>0&&t.jsx(g,{onClick:e=>{e.stopPropagation(),ce([])},children:t.jsx(c,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>je(!1),children:t.jsxs(g,{padding:"300",minWidth:"200px",children:[t.jsx(A,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:ue.map(e=>({label:e,value:e})),selected:de,onChange:e=>{ce(e)}}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(h,{size:"slim",onClick:()=>je(!1),children:"Apply"})})]})})]}),t.jsx(b,{active:Se,activator:t.jsx(h,{disclosure:"down",onClick:()=>ye(!Se),removeUnderline:!0,children:t.jsx(m,{gap:"100",blockAlign:"center",children:t.jsx("span",{children:"desc"===le?"Newest first":"Oldest first"})})}),onClose:()=>ye(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(A,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[le],onChange:e=>{oe(e[0]),ye(!1)}})})})]}),("all"!==te||se||de.length>0)&&t.jsx(g,{paddingBlockStart:"200",children:t.jsxs(m,{gap:"100",wrap:!0,children:["all"!==te&&t.jsx(x,{onRemove:()=>ne("all"),children:"true"===te?"Has AI Search Optimisation":"No AI Search Optimisation"}),se&&t.jsx(x,{onRemove:()=>ae(""),children:se.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())}),de.map(e=>t.jsxs(x,{onRemove:()=>ce(t=>t.filter(t=>t!==e)),children:["Tag: ",e]},e))]})})]}),t.jsxs(g,{children:[t.jsx(g,{paddingBlockEnd:"200",paddingInlineStart:"300",children:t.jsxs(m,{gap:"200",align:"start",children:[t.jsx(f,{checked:V.length===D.length&&D.length>0,onChange:$t,label:""}),t.jsxs(c,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",V.length>0&&` (${V.length} selected products)`]})]})}),t.jsx(P,{resourceName:{singular:"product",plural:"products"},items:D,renderItem:e=>{var n,s,a;try{const i=e,r=(e=>{if(!e)return"";const t=String(e).match(/\/(\d+)$/);return t?t[1]:e})(i.productId||i.id),l=(null==(n=i.optimizationSummary)?void 0:n.optimizedLanguages)||[],o=(null==(s=i.images)?void 0:s[0])?t.jsx(k,{source:i.images[0].url||i.images[0].src||i.images[0],alt:i.title,size:"small"}):i.imageUrl?t.jsx(k,{source:i.imageUrl,alt:i.title,size:"small"}):t.jsx(g,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return t.jsx(C,{id:i.id,media:o,accessibilityLabel:`View details for ${i.title}`,onClick:e=>{},children:t.jsxs(m,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[t.jsxs(g,{style:{flex:"1 1 40%",minWidth:"250px"},children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:i.title}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["ID: ",r]})]}),t.jsx(g,{style:{flex:"0 0 25%",minWidth:"160px"},children:t.jsxs(m,{gap:"100",wrap:!0,children:[(()=>{if(Ce.length>0)return Ce.map(e=>{const n=l.includes(e),s="DRAFT"===i.status;return t.jsx(x,{tone:s?"subdued":n?"success":"subdued",size:"small",children:e.toUpperCase()},e)});{const e="DRAFT"===i.status;return l.map(n=>t.jsx(x,{tone:e?"subdued":"success",size:"small",children:n.toUpperCase()},n))}})(),(null==(a=i.optimizationSummary)?void 0:a.aiEnhanced)&&"DRAFT"!==i.status&&t.jsx(x,{tone:"info",size:"small",children:"AI✨"})]})}),t.jsx(g,{style:{flex:"0 0 20%",minWidth:"120px",textAlign:"center"},children:"ACTIVE"===i.status?t.jsx(x,{tone:"success",children:"Active"}):"DRAFT"===i.status?t.jsx(x,{children:"Draft"}):"ARCHIVED"===i.status?t.jsx(x,{tone:"warning",children:"Archived"}):t.jsx(x,{children:i.status||"Unknown"})})]})})}catch(i){return null}},selectedItems:V,onSelectionChange:zt,selectable:!0,loading:B,totalItemsCount:G,emptyState:Dt,showHeader:!1},`products-${D.length}-${V.length}`)]}),Y&&!B&&t.jsx(g,{padding:"400",textAlign:"center",children:t.jsx(h,{onClick:()=>Ct(_+1,!0,null),children:"Load more"})})]})}),Tt,Rt,Mt,Ut,Ve.processing?t.jsx(o,{open:Ge,title:"Processing AI Enhancement",onClose:Lt,noScroll:!0,children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"400",children:[t.jsxs(c,{variant:"bodyMd",children:["Processing: ",Ve.currentItem]}),t.jsx(u,{progress:Ve.current/Ve.total*100}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:[Ve.current," of ",Ve.total," products (",Math.round(Ve.current/Ve.total*100),"%)"]})]})})}):null!==Ve.results?t.jsx(o,{open:Ge,title:"AI Enhancement Results",onClose:Lt,primaryAction:{content:"Done",onAction:Lt},children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"400",children:[t.jsxs(m,{gap:"400",children:[t.jsxs(g,{children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),t.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Ve.results.successful})]}),t.jsxs(g,{children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),t.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Ve.results.failed})]}),t.jsxs(g,{children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),t.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Ve.results.skipped})]})]}),Ve.results.skipReasons&&Ve.results.skipReasons.length>0&&t.jsxs(d,{gap:"200",children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped products:"}),Ve.results.skipReasons.map((e,n)=>t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["• ",e]},n))]})]})})}):null,t.jsx(o,{open:lt,onClose:()=>ot(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{ot(!1),qt()}},secondaryActions:[{content:"Skip for now",onAction:()=>ot(!1)}],children:t.jsx(o.Section,{children:t.jsxs(d,{gap:"300",children:[t.jsx(c,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),t.jsx(c,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),t.jsx(a,{open:ut,onClose:()=>{pt(!1),yt(null)},featureName:(null==St?void 0:St.error)||"Feature",errorMessage:null==St?void 0:St.message,currentPlan:(null==St?void 0:St.currentPlan)||vt,minimumPlanRequired:null==St?void 0:St.minimumPlanRequired,features:null==St?void 0:St.features}),St&&t.jsxs(t.Fragment,{children:[t.jsx(i,{open:ht,onClose:()=>{gt(!1),yt(null)},tokensRequired:St.tokensRequired||0,tokensAvailable:St.tokensAvailable||0,tokensNeeded:St.tokensNeeded||0,feature:"ai-seo-product-enhanced",shop:q,needsUpgrade:St.needsUpgrade||!1,minimumPlan:St.minimumPlanForFeature||null,currentPlan:St.currentPlan||vt,returnTo:"/ai-seo",onBuyTokens:()=>{gt(!1),jt(!0)}}),t.jsx(r,{open:mt,onClose:()=>{ft(!1),yt(null)},feature:St.feature||"ai-seo-product-enhanced",trialEndsAt:St.trialEndsAt,currentPlan:St.currentPlan||vt,tokensRequired:St.tokensRequired||0,onActivatePlan:async()=>{try{const e=await M("/api/billing/activate",{method:"POST",body:{shop:q,endTrial:!0,returnTo:"/ai-seo"}});if(e.requiresApproval&&e.confirmationUrl)return void(window.top.location.href=e.confirmationUrl);window.location.reload()}catch(e){const t=new URLSearchParams(window.location.search),n=t.get("host"),s=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(q)}&embedded=${s}&host=${encodeURIComponent(n)}`}},onPurchaseTokens:()=>{ft(!1),jt(!0)}})]}),t.jsx(l,{open:xt,onClose:()=>{jt(!1),yt(null)},shop:q,returnTo:"/ai-seo",inTrial:!!(null==St?void 0:St.trialEndsAt)}),Ye&&t.jsx(w,{content:Ye,onDismiss:()=>He("")})]})}export{E as default};
