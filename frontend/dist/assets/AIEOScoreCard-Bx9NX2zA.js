import{r as e,j as t}from"./react-vendor-BLtYaay5.js";import{C as s,B as a,a as i,I as o,T as n,b as r,D as l,e as d,d as c}from"./polaris-BgbORwUH.js";const u={productsJson:"Products JSON Feed",basicSitemap:"Basic Sitemap",robotsTxt:"robots.txt.liquid",schemaData:"Schema Data (theme.liquid)",welcomePage:"AI Welcome Page",collectionsJson:"Collections JSON Feed",storeMetadata:"Store Metadata",aiSitemap:"AI-Enhanced Sitemap",advancedSchemaApi:"Advanced Schema Data",llmsTxt:"LLMs.txt",mcpServer:"MCP Server"};function g({testResults:g={},aiTestResults:p={},stats:h={},shop:m="",api:v=null,onTestsComplete:b=null,onScoreCalculated:x=null}){const[f,y]=e.useState(!1),j=Object.keys(g).length>0,S=e=>{const t=Math.max(0,Math.min(100,e))/100;return`rgb(${Math.round(239+-223*t)}, ${Math.round(68+117*t)}, ${Math.round(68+61*t)})`},M=e.useMemo(()=>((e,t,s,a)=>{var i,o,n,r,l,d,c,u,g,p,h;const m={endpointAvailability:0,aiValidationQuality:0,optimizationCoverage:0,structuredDataQuality:0,total:0},v={productsJson:5,basicSitemap:4,robotsTxt:2,schemaData:2,welcomePage:3,collectionsJson:4,storeMetadata:4,aiSitemap:3,advancedSchemaApi:3,llmsTxt:3,mcpServer:4};let b=0,x=0;for(const[D,O]of Object.entries(e||{})){const e=v[D]||1;x+=e,"success"===O.status?b+=e:"warning"===O.status?b+=.7*e:"locked"===O.status&&(b+=.3*e)}m.endpointAvailability=x>0?Math.round(b/x*30):0;const f={excellent:1,good:.75,fair:.5,poor:.25,unavailable:0,locked:.1};let y=0,j=0;for(const[D,O]of Object.entries(t||{})){if("robotsTxt"===D||"schemaData"===D)continue;const e=(null==(i=O.rating)?void 0:i.toLowerCase())||"unavailable",t=v[D]||1;y+=(f[e]||0)*t,j+=t}m.aiValidationQuality=j>0?Math.round(y/j*40):0;const S=s.totalProducts||0,M=s.optimizedProducts||0,w=s.totalCollections||0,k=s.optimizedCollections||0;let $=0;if(S>0){$+=12*(M/S)}if(w>0){$+=8*(k/w)}else S>0&&($+=8);m.optimizationCoverage=Math.round($);let A=0;if("success"===(null==(o=null==e?void 0:e.schemaData)?void 0:o.status)&&(A+=2),"success"===(null==(n=null==e?void 0:e.storeMetadata)?void 0:n.status)){A+=2;const e=null==(l=null==(r=null==t?void 0:t.storeMetadata)?void 0:r.rating)?void 0:l.toLowerCase();"excellent"===e?A+=2:"good"===e&&(A+=1)}else"locked"===(null==(d=null==e?void 0:e.storeMetadata)?void 0:d.status)&&(A+=.5);"success"===(null==(c=null==e?void 0:e.advancedSchemaApi)?void 0:c.status)&&(A+=1),"success"===(null==(u=null==e?void 0:e.llmsTxt)?void 0:u.status)?A+=1.5:"fair"===(null==(g=null==e?void 0:e.llmsTxt)?void 0:g.status)&&(A+=.75),"success"===(null==(p=null==e?void 0:e.mcpServer)?void 0:p.status)?A+=1.5:"fair"===(null==(h=null==e?void 0:e.mcpServer)?void 0:h.status)&&(A+=.75),m.structuredDataQuality=Math.min(10,Math.round(A)),m.total=Math.min(100,m.endpointAvailability+m.aiValidationQuality+m.optimizationCoverage+m.structuredDataQuality);let C="E",z="#ef4444";m.total>=80?(C="A",z="#10b981"):m.total>=60?(C="B",z="#3b82f6"):m.total>=40?(C="C",z="#f59e0b"):m.total>=20&&(C="D",z="#f97316");const T=[];if(m.endpointAvailability<20){const t=Object.entries(e||{}).filter(([e,t])=>"locked"===t.status).length,s=Object.entries(e||{}).filter(([e,t])=>"error"===t.status||"failed"===t.status).length;t>0&&0===s?T.push("Several AI discovery endpoints are locked due to plan limitations. Upgrade your plan to unlock them."):t>0&&s>0?T.push("Some endpoints are missing or not working. Others are locked due to plan limitations. Fix endpoint issues and upgrade your plan to improve your score."):T.push("Several AI discovery endpoints are missing or not working. Fix endpoint issues to improve your score.")}if(m.aiValidationQuality<30){const e=["robotsTxt","schemaData"];Object.entries(t||{}).filter(([t,s])=>{var a;const i=null==(a=s.rating)?void 0:a.toLowerCase();return("poor"===i||"fair"===i)&&!e.includes(t)}).forEach(([e,t])=>{const s=a[e]||e;t.suggestions?T.push(`${s}: ${t.suggestions}`):t.feedback?T.push(`${s}: ${t.feedback}`):T.push(`${s}: Run "Test with AI Bot" for detailed suggestions.`)})}return m.optimizationCoverage<15&&T.push("Low optimization coverage. Go to Store Optimization for AI to optimize your products and collections."),m.structuredDataQuality<7&&T.push("Structured data needs improvement. Go to Store Optimization for AI → Schema Data to add organization schema and enhance product markup."),(null==e?void 0:e.llmsTxt)&&"success"!==e.llmsTxt.status&&T.push('LLMs.txt is not active. Go to AI Discovery Features and enable "LLMs.txt File", then click Save Settings.'),(null==e?void 0:e.mcpServer)&&"success"!==e.mcpServer.status&&T.push("MCP Server is not responding. Contact support if this persists — AI agents cannot search your products without it."),{score:m.total,grade:C,gradeColor:z,breakdown:m,recommendations:T.length>0?T:["Your store is well-optimized for AI search engines!"]}})(g,p,h,u),[g,p,h]);return e.useEffect(()=>{x&&M&&x(M.score)},[M,x]),M?t.jsx(s,{children:t.jsx(a,{padding:"400",children:t.jsxs(i,{gap:"300",children:[t.jsxs(o,{align:"space-between",blockAlign:"center",children:[t.jsxs(i,{gap:"100",children:[t.jsx(n,{as:"h3",variant:"headingMd",children:"GEO Score"}),t.jsx(n,{variant:"bodySm",tone:"subdued",children:"Generative Engine Optimization rating"})]}),v&&m&&t.jsx(r,{size:"slim",onClick:async()=>{if(v&&m){y(!0);try{const t=await v("/api/ai-testing/run-tests",{method:"POST",body:{shop:m}});if(t.results){try{localStorage.setItem(`ai-test-results-${m}`,JSON.stringify({results:t.results,timestamp:(new Date).toISOString()}))}catch(e){}b&&b(t.results)}}catch(t){}finally{y(!1)}}},loading:f,disabled:f,children:f?"Testing...":j?"Refresh Tests":"Run Basic Tests"})]}),t.jsx(l,{}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px"},children:[t.jsx(a,{style:{width:"138px",height:"138px",borderRadius:"50%",background:(e=>{const t=3.6*e,s=Math.max(0,Math.min(100,e))/100;let a=[];if(s<=.2)a=["#ef4444 0deg",`#ef4444 ${t}deg`,`#e5e7eb ${t}deg`,"#e5e7eb 360deg"];else if(s<=.4){a=["#ef4444 0deg",`#f97316 ${.5*t}deg`,`#f97316 ${t}deg`,`#e5e7eb ${t}deg`,"#e5e7eb 360deg"]}else if(s<=.6){a=["#ef4444 0deg",`#f97316 ${.33*t}deg`,`#f59e0b ${.66*t}deg`,`#f59e0b ${t}deg`,`#e5e7eb ${t}deg`,"#e5e7eb 360deg"]}else if(s<=.8){const e=216;a=["#ef4444 0deg",`#f97316 ${.2*t}deg`,`#f59e0b ${.4*t}deg`,`#22c55e ${Math.max(e,.7*t)}deg`,`#22c55e ${t}deg`,`#e5e7eb ${t}deg`,"#e5e7eb 360deg"]}else{const e=216;a=["#ef4444 0deg",`#f97316 ${.15*t}deg`,`#f59e0b ${.3*t}deg`,`#10b981 ${Math.max(e,.5*t)}deg`,`#10b981 ${t}deg`,`#e5e7eb ${t}deg`,"#e5e7eb 360deg"]}return`conic-gradient(${a.join(", ")})`})(M.score),display:"flex",alignItems:"center",justifyContent:"center",position:"relative",flexShrink:0},children:t.jsx(a,{style:{width:"103.5px",height:"103.5px",borderRadius:"50%",background:"white",position:"absolute",zIndex:1}})}),t.jsxs(i,{gap:"100",children:[t.jsxs(n,{variant:"headingMd",fontWeight:"semibold",style:{color:S(M.score)},children:["GEO Score = ",M.score]}),t.jsxs(n,{variant:"headingMd",fontWeight:"bold",style:{color:S(M.score)},children:["GEO Rating = ",M.grade]})]})]}),t.jsxs(i,{gap:"200",children:[t.jsx(n,{variant:"headingSm",children:"Score Breakdown"}),t.jsxs(i,{gap:"100",children:[t.jsxs(o,{align:"space-between",children:[t.jsx(n,{variant:"bodyMd",children:"Endpoint Availability"}),t.jsxs(n,{variant:"bodyMd",fontWeight:"semibold",children:[M.breakdown.endpointAvailability,"/30"]})]}),t.jsx(d,{progress:Math.round(M.breakdown.endpointAvailability/30*100),size:"small",tone:"success"})]}),t.jsxs(i,{gap:"100",children:[t.jsxs(o,{align:"space-between",children:[t.jsx(n,{variant:"bodyMd",children:"AI Validation Quality"}),t.jsxs(n,{variant:"bodyMd",fontWeight:"semibold",children:[M.breakdown.aiValidationQuality,"/40"]})]}),t.jsx(d,{progress:Math.round(M.breakdown.aiValidationQuality/40*100),size:"small",tone:"success"})]}),t.jsxs(i,{gap:"100",children:[t.jsxs(o,{align:"space-between",children:[t.jsx(n,{variant:"bodyMd",children:"Optimization Coverage"}),t.jsxs(n,{variant:"bodyMd",fontWeight:"semibold",children:[M.breakdown.optimizationCoverage,"/20"]})]}),t.jsx(d,{progress:Math.round(M.breakdown.optimizationCoverage/20*100),size:"small",tone:"success"})]}),t.jsxs(i,{gap:"100",children:[t.jsxs(o,{align:"space-between",children:[t.jsx(n,{variant:"bodyMd",children:"Structured Data Quality"}),t.jsxs(n,{variant:"bodyMd",fontWeight:"semibold",children:[M.breakdown.structuredDataQuality,"/10"]})]}),t.jsx(d,{progress:Math.round(M.breakdown.structuredDataQuality/10*100),size:"small",tone:"success"})]})]})]}),M.recommendations&&M.recommendations.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(l,{}),t.jsxs(i,{gap:"200",children:[t.jsx(n,{variant:"headingSm",children:"Recommendations"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:M.recommendations.map((e,s)=>t.jsx(c,{tone:e.includes("not active")||e.includes("not responding")||e.includes("Missing")?"critical":e.includes("well-optimized")?"success":"warning",children:t.jsx(n,{variant:"bodyMd",children:e})},s))})]})]})]})})}):null}export{g as A};
