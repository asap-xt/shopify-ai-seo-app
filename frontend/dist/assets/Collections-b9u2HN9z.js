import{r as e,j as t}from"./react-vendor-BLtYaay5.js";import{m as n}from"./sessionFetch-D9zn2iVF.js";import{U as s}from"./UpgradeModal-Bz-hPgmd.js";import{I as l,T as i}from"./TrialActivationModal-CmZNJenq.js";import{T as a}from"./TokenPurchaseModal-ChVK648j.js";import{S as o}from"./StoreMetadataBanner-3fUD1Drv.js";import{M as r,a as c,T as d,e as u,d as h,b as p,B as g,I as m,g as x,D as f,f as j,C as b,h as S,S as v,j as y,k as C,l as k,i as A,R as w,m as P,n as $,p as I,E}from"./polaris-BgbORwUH.js";import"./app-bridge-DUY42B6P.js";import"./vendor-L4_WdQez.js";import"./index-SIhijMOo.js";function M({shop:M,globalPlan:O}){var z,T,L,W,R;const D=M||((e,t="")=>{try{return new URLSearchParams(window.location.search).get(e)||t}catch{return t}})("shop",""),U=e.useMemo(()=>n(),[]),[q,B]=e.useState([]),[F,N]=e.useState(!1),[_,H]=e.useState(0),[Y,J]=e.useState(1),[K,Z]=e.useState(50),[G,Q]=e.useState(1),[V,X]=e.useState(!1),[ee,te]=e.useState([]),[ne,se]=e.useState(!1),[le,ie]=e.useState(!1),[ae,oe]=e.useState(!1),[re,ce]=e.useState(""),[de,ue]=e.useState(""),[he,pe]=e.useState("all"),[ge,me]=e.useState(""),[xe,fe]=e.useState([]),[je,be]=e.useState([]),[Se,ve]=e.useState(!1),[ye,Ce]=e.useState(!1),[ke,Ae]=e.useState(!1),[we,Pe]=e.useState(!1),[$e,Ie]=e.useState("updatedAt"),[Ee,Me]=e.useState("desc"),[Oe,ze]=e.useState(""),[Te,Le]=e.useState([]),[We,Re]=e.useState([]),[De,Ue]=e.useState([]),[qe,Be]=e.useState(!1),[Fe,Ne]=e.useState({current:0,total:0,percent:0}),[_e,He]=e.useState(""),[Ye,Je]=e.useState([]),[Ke,Ze]=e.useState(!1),[Ge,Qe]=e.useState(null),[Ve,Xe]=e.useState(!1),[et,tt]=e.useState(""),[nt,st]=e.useState(!1),[lt,it]=e.useState([]),[at,ot]=e.useState(!1),[rt,ct]=e.useState(!1),[dt,ut]=e.useState(!1),[ht,pt]=e.useState(!1),[gt,mt]=e.useState([]),[xt,ft]=e.useState({}),[jt,bt]=e.useState(!1),[St,vt]=e.useState(!1),[yt,Ct]=e.useState({}),[kt,At]=e.useState(!1),[wt,Pt]=e.useState(null),[$t,It]=e.useState(!1),[Et,Mt]=e.useState(""),[Ot,zt]=e.useState(!1),[Tt,Lt]=e.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[Wt,Rt]=e.useState(!1),[Dt,Ut]=e.useState(!1),[qt,Bt]=e.useState(!1),[Ft,Nt]=e.useState(!1),[_t,Ht]=e.useState(null),[Yt,Jt]=e.useState("starter"),[Kt,Zt]=e.useState(1),[Gt,Qt]=e.useState(!1);e.useEffect(()=>{if(O&&"object"==typeof O&&!Gt&&"starter"===Yt)if(O.planKey&&""!==O.planKey){Jt(O.planKey);const e=O.language_limit||1;Zt(e)}else if(O.plan&&""!==O.plan){const e=O.plan.toLowerCase().replace(/\s+/g,"-");Jt(e);const t=O.language_limit||1;Zt(t)}},[O,Yt,Gt]);const[Vt,Xt]=e.useState({inProgress:!1,status:"idle",message:null,totalCollections:0,processedCollections:0,successfulCollections:0,failedCollections:0,skippedCollections:0,completedAt:null,progress:null}),en=e.useRef(null),[tn,nn]=e.useState({inProgress:!1,status:"idle",message:null,totalCollections:0,processedCollections:0,successfulCollections:0,failedCollections:0,skippedCollections:0,completedAt:null,progress:null}),sn=e.useRef(null),ln=e.useRef(null),[an,on]=e.useState(0),[rn,cn]=e.useState(0);e.useEffect(()=>{var e;null!=(null==(e=Vt.progress)?void 0:e.remainingSeconds)&&on(Vt.progress.remainingSeconds)},[null==(z=Vt.progress)?void 0:z.remainingSeconds]),e.useEffect(()=>{var e;null!=(null==(e=tn.progress)?void 0:e.remainingSeconds)&&cn(tn.progress.remainingSeconds)},[null==(T=tn.progress)?void 0:T.remainingSeconds]),e.useEffect(()=>{if(!Vt.inProgress)return;const e=setInterval(()=>{on(e=>Math.max(0,e-1))},1e3);return()=>clearInterval(e)},[Vt.inProgress]),e.useEffect(()=>{if(!tn.inProgress)return;const e=setInterval(()=>{cn(e=>Math.max(0,e-1))},1e3);return()=>clearInterval(e)},[tn.inProgress]),e.useEffect(()=>{if(!D)return;U("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n      query PlansMe($shop:String!) {\n        plansMe(shop:$shop) {\n          plan\n          planKey\n          modelsSuggested\n          language_limit\n          product_limit\n        }\n      }\n    ",variables:{shop:D}})}).then(e=>{var t,n,s;if(null==(t=null==e?void 0:e.errors)?void 0:t.length)throw new Error((null==(n=e.errors[0])?void 0:n.message)||"GraphQL error");const l=null==(s=null==e?void 0:e.data)?void 0:s.plansMe,i=(null==l?void 0:l.modelsSuggested)||["google/gemini-1.5-flash"];Le(i.map(e=>({label:e,value:e}))),ze(i[0]),Jt((null==l?void 0:l.planKey)||"starter");const a=(null==l?void 0:l.language_limit)||1;Zt(a),Qt(!0)}).catch(e=>{Mt(`Error loading models: ${e.message}`),Qt(!0)})},[D,U]),e.useEffect(()=>{D&&U(`/api/languages/shop/${D}?shop=${D}`).then(e=>{const t=(null==e?void 0:e.shopLanguages)||["en"];Ue(t),Re([])}).catch(e=>{Ue(["en"]),Re([])})},[D,U]);const dn=e.useCallback(async(e=1)=>{var t,n,s;N(!0);try{const l=`/collections/list-graphql?${new URLSearchParams({shop:D,page:e,limit:K,...de&&{search:de},..."all"!==he&&{optimized:he},sortBy:$e,sortOrder:Ee})}`,i=await U(l);let a=i.collections||[];if(de){const e=de.toLowerCase();a=a.filter(t=>t.title.toLowerCase().includes(e)||t.handle.toLowerCase().includes(e))}"all"!==he&&(a=a.filter(e=>"true"===he?e.hasSeoData:!e.hasSeoData)),B(a),J(e);const o=(null==(t=i.pagination)?void 0:t.total)||a.length;H(o),X((null==(n=i.pagination)?void 0:n.hasNext)||!1),Q((null==(s=i.pagination)?void 0:s.totalPages)||Math.ceil(o/K)||1)}catch(l){Mt(`Error loading collections: ${l.message}`)}finally{N(!1)}},[D,de,he,$e,Ee,K,U]);e.useEffect(()=>{ln.current=dn},[dn]),e.useEffect(()=>{D&&(dn(1),ct(!1))},[D,he,$e,Ee,K]),e.useEffect(()=>{const e=setTimeout(()=>{D&&dn()},500);return()=>clearTimeout(e)},[de]);const un=e.useCallback(e=>{te(e);const t=e.some(e=>{const t=q.find(t=>t.id===e);return null==t?void 0:t.hasSeoData});ct(t),0===e.length?(se(!1),ie(!1)):e.length<q.length&&ie(!1)},[q]),hn=e.useCallback((e,t=!1)=>{if(se(e),ie(t&&e),e){te(q.map(e=>e.id));const e=q.some(e=>e.hasSeoData);ct(e)}else te([]),ie(!1),ct(!1)},[q]),pn=e.useCallback(()=>{se(!0),ie(!0),te(q.map(e=>e.id));const e=q.some(e=>e.hasSeoData);ct(e),oe(!1)},[q]),gn=e.useCallback(()=>{te([]),se(!1),ie(!1),ct(!1),oe(!1)},[]),mn=e.useCallback(()=>{Y>1&&(dn(Y-1),te([]),se(!1),ie(!1))},[Y,dn]),xn=e.useCallback(()=>{Y<G&&(dn(Y+1),te([]),se(!1),ie(!1))},[Y,G,dn]),fn=e.useCallback(e=>{Z(parseInt(e)),J(1),te([]),se(!1),ie(!1)},[]),jn=e=>{if(!e)return"";const t=Math.floor((new Date-new Date(e))/1e3);if(t<60)return"just now";const n=Math.floor(t/60);if(n<60)return`${n}m ago`;const s=Math.floor(n/60);if(s<24)return`${s}h ago`;return`${Math.floor(s/24)}d ago`},bn=e.useCallback(async()=>{try{const e=await U(`/seo/collection-job-status?shop=${D}&type=seo`);return Xt(t=>(t.inProgress&&!e.inProgress&&("completed"===e.status||"failed"===e.status)&&(en.current&&(clearInterval(en.current),en.current=null),"completed"===e.status?Mt(`Optimized ${e.successfulCollections} collection${1!==e.successfulCollections?"s":""}`):"failed"===e.status&&Mt(`Collection SEO failed: ${e.message||"Unknown error"}`),ln.current&&ln.current()),e)),e}catch(e){}},[D,U]),Sn=e.useCallback(()=>{en.current&&clearInterval(en.current),bn(),en.current=setInterval(()=>{bn()},5e3)},[bn]),vn=e.useCallback(async()=>{try{const e=await U(`/ai-enhance/collection-job-status?shop=${D}`);return nn(t=>(t.inProgress&&!e.inProgress&&("completed"===e.status||"failed"===e.status)&&(sn.current&&(clearInterval(sn.current),sn.current=null),"completed"===e.status?Mt(`AI Enhanced ${e.successfulCollections} collection${1!==e.successfulCollections?"s":""}`):"failed"===e.status&&Mt(`AI Enhancement failed: ${e.message||"Unknown error"}`),ln.current&&ln.current()),e)),e}catch(e){}},[D,U]),yn=e.useCallback(()=>{sn.current&&clearInterval(sn.current),vn(),sn.current=setInterval(()=>{vn()},5e3)},[vn]);e.useEffect(()=>()=>{en.current&&clearInterval(en.current),sn.current&&clearInterval(sn.current)},[]),e.useEffect(()=>{D&&(bn().then(e=>{(null==e?void 0:e.inProgress)&&Sn()}),vn().then(e=>{(null==e?void 0:e.inProgress)&&yn()}))},[D,bn,vn,Sn,yn]);const Cn=e.useMemo(()=>{var e;if(ne)return We.length>Kt;const t=q.filter(e=>ee.includes(e.id));if(0===t.length)return We.length>Kt;for(const n of t){const t=(null==(e=n.optimizationSummary)?void 0:e.optimizedLanguages)||[],s=We.filter(e=>!t.includes(e));if(t.length+s.length>Kt)return!0}return!1},[q,ee,ne,Kt,We]),kn=async()=>{const e=q.filter(e=>ee.includes(e.id)).filter(e=>{var t;return(null==(t=e.optimizedLanguages)?void 0:t.length)>0});if(0===e.length)return void Mt("Please select collections with Basic SEO optimization");const t=e.map(e=>({collectionId:e.id,languages:e.optimizedLanguages||[],title:e.title}));try{const e=await U(`/ai-enhance/collection-batch?shop=${D}`,{method:"POST",body:{shop:D,collections:t}});if(e.queued){const e=t.reduce((e,t)=>{var n;return e+((null==(n=t.languages)?void 0:n.length)||1)},0);Mt(2.8*e>120?`Enhancing ${t.length} collections in background. You'll receive an email when complete. Feel free to navigate away & explore other features.`:`Enhancing ${t.length} collections in background. You can navigate away safely & explore other features.`),te([]),se(!1),yn()}else Mt(e.message||"Failed to queue AI Enhancement job")}catch(n){if(403===n.status)return Ht(n),Jt(n.currentPlan||Yt||"starter"),void Rt(!0);if(402===n.status||n.requiresPurchase||n.trialRestriction)return Ht(n),Jt(n.currentPlan||Yt||"starter"),void(n.trialRestriction&&n.requiresActivation?Bt(!0):n.trialRestriction?Rt(!0):Ut(!0));Mt(`Error: ${n.message||"Failed to start AI Enhancement"}`)}},An=qe&&!Tt.processing&&t.jsx(r,{open:qe,title:"Processing Collections",onClose:()=>{},noScroll:!0,children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsx(d,{variant:"bodyMd",children:_e?`Processing: ${_e}`:"Preparing..."}),t.jsx(u,{progress:Fe.percent}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:[Fe.current," of ",Fe.total," collections (",Fe.percent,"%)"]})]})})}),wn=t.jsx(r,{open:St,title:"Select Languages",primaryAction:{content:"Generate Optimization for AI Search",onAction:async()=>{var e;if(We.length){vt(!1);try{const e=(ne?q:q.filter(e=>ee.includes(e.id))).map(e=>({collectionId:e.id,languages:We,title:e.title})),t=await U(`/seo/collection-generate-apply-batch?shop=${D}`,{method:"POST",body:{shop:D,collections:e,model:Oe||"google/gemini-1.5-flash"}});if(t.queued){const t=1.3*e.length;Mt(t>120?`Optimizing ${e.length} collections in background. You'll receive an email when complete. Feel free to navigate away & explore other features.`:`Optimizing ${e.length} collections in background. You can navigate away safely & explore other features.`),te([]),se(!1),Sn()}else Mt(t.message||"Failed to queue optimization job")}catch(t){if(403===t.status||(null==(e=t.message)?void 0:e.includes("requires Professional plan")))return Ht({error:t.message||"Collections SEO requires Professional plan or higher",currentPlan:t.currentPlan||Yt||"starter",upgradeMessage:t.upgradeMessage||"Upgrade to Professional plan to optimize collections for AI search"}),void Rt(!0);Mt(`Error: ${t.message||"Failed to start optimization"}`)}}else Mt("Please select at least one language")},disabled:0===We.length||Cn},secondaryActions:[{content:"Cancel",onAction:()=>vt(!1)}],children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"300",children:[t.jsxs(d,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",ne?"all":ee.length," selected collections:"]}),Cn&&t.jsx(h,{tone:"warning",title:"Language limit exceeded",children:t.jsxs(c,{gap:"200",children:[t.jsxs(d,{variant:"bodyMd",children:["Your ",Yt," plan supports up to ",Kt," language",Kt>1?"s":""," per collection.",1===ee.length&&(null==(R=null==(W=null==(L=q.find(e=>e.id===ee[0]))?void 0:L.optimizationSummary)?void 0:W.optimizedLanguages)?void 0:R.length)>0&&t.jsxs(t.Fragment,{children:[" This collection already has ",q.find(e=>e.id===ee[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),t.jsx(d,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),t.jsx(p,{variant:"primary",onClick:()=>{const e=new URLSearchParams(window.location.search),t=e.toString()?`?${e.toString()}`:"";window.location.href=`/billing${t}`},children:"Upgrade Plan"})]})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"200",wrap:!0,children:De.map(e=>t.jsx(x,{label:e.toUpperCase(),checked:We.includes(e),onChange:t=>{Re(t?[...We,e]:We.filter(t=>t!==e))}},e))})}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(p,{plain:!0,onClick:()=>{We.length===De.length?Re([]):De.length>Kt?(Re([...De]),Mt(`You selected ${De.length} languages. Your ${Yt} plan supports ${Kt}. Please deselect or upgrade.`)):Re([...De])},children:We.length===De.length?"Deselect all":"Select all"})})]})})}),Pn=t.jsx(r,{open:jt&&!qe,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:async()=>{var e;Be(!0),Ne({current:0,total:0,percent:0});try{const n=Object.entries(xt).filter(([e,t])=>t.success),s=n.length;Ne({current:0,total:s,percent:0});for(let l=0;l<n.length;l++){const[i,a]=n[l],o=q.find(e=>e.id===i);if(!o)continue;He(o.title);try{if(!(null==(e=a.data)?void 0:e.results)||!Array.isArray(a.data.results))throw new Error("Invalid results structure");const t=await U("/seo/apply-collection-multi",{method:"POST",shop:D,body:{shop:D,collectionId:i,results:a.data.results.map(e=>({language:e.language,seo:e.data})),options:{updateTitle:!0,updateDescription:!0,updateSeo:!0,updateMetafields:!0}}});if(!(null==t?void 0:t.ok))throw new Error((null==t?void 0:t.error)||"Apply failed")}catch(t){Ye.push({id:o.id,title:o.title,message:t.message})}const r=l+1,c=Math.round(r/s*100);Ne({current:r,total:s,percent:c})}Mt("Optimization applied successfully!"),bt(!1),ft({}),te([]),await dn(),se(!1)}catch(t){Mt(`Error applying optimization: ${t.message}`)}finally{Be(!1),He("")}},disabled:!Object.values(xt).some(e=>e.success)},secondaryActions:[{content:"Cancel",onAction:()=>bt(!1)}],children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"300",children:[t.jsxs(m,{gap:"400",children:[t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(xt).filter(e=>e.success&&!e.skipped).length})]}),t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(xt).filter(e=>e.skipped).length})]}),t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(xt).filter(e=>!e.success&&!e.skipped).length})]})]}),Ye.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(f,{}),t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),t.jsxs(g,{maxHeight:"200px",overflowY:"scroll",children:[Ye.slice(0,10).map((e,n)=>t.jsxs(d,{variant:"bodySm",tone:"critical",children:[e.collection,": ",e.error]},n)),Ye.length>10&&t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["... and ",Ye.length-10," more errors"]})]})]})]})})}),$n=t.jsx(r,{open:kt,title:"SEO Data Preview",secondaryActions:[{content:"Close",onAction:()=>{At(!1),Pt(null)}}],children:t.jsx(r.Section,{children:t.jsx(g,{children:t.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",backgroundColor:"#f6f6f7",padding:"12px",borderRadius:"4px",maxHeight:"400px",overflow:"auto"},children:wt?JSON.stringify(wt,null,2):""})})})}),In=t.jsx(r,{open:nt,title:"Delete Optimization for AI Search",onClose:()=>{st(!1),it([])},primaryAction:{content:"Continue",onAction:()=>{mt(lt),st(!1),pt(!0)},disabled:0===lt.length},secondaryActions:[{content:"Cancel",onAction:()=>{st(!1),it([])}}],children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsxs(d,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",ne?_:ee.length," selected collections:"]}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"400",wrap:!1,children:De.map(e=>t.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[t.jsx("input",{type:"checkbox",checked:lt.includes(e),onChange:t=>{it(t.target.checked?[...lt,e]:lt.filter(t=>t!==e))},style:{marginRight:"8px",width:"18px",height:"18px",cursor:"pointer"}}),t.jsx(d,{variant:"bodyMd",children:e.toUpperCase()})]},e))})}),t.jsx(g,{children:t.jsx(p,{plain:!0,onClick:()=>{it(lt.length===De.length?[]:[...De])},children:"Select all"})}),t.jsx(g,{paddingBlockStart:"300",children:t.jsx(d,{variant:"bodySm",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})})]})})}),En=t.jsx(r,{open:ht,title:"Confirm Deletion",onClose:()=>{pt(!1),mt([])},primaryAction:{content:"Delete",destructive:!0,onAction:async()=>{pt(!1),setTimeout(()=>{(async(e=[])=>{ot(!0),tt("");try{const n=ne?q:q.filter(e=>ee.includes(e.id)),s=n.length*e.length;let l=0;const i=[];for(const a of n)for(const n of e)try{await U("/collections/delete-seo",{method:"DELETE",shop:D,body:{shop:D,collectionId:a.id,language:n}})}catch(t){i.push({id:a.id,title:a.title,message:t.message})}finally{l++,Ne({current:l,total:s,percent:Math.round(l/s*100)})}Mt(`Deleted optimization for ${e.join(", ").toUpperCase()}`),Xt({inProgress:!1,status:"idle",message:null,totalCollections:0,processedCollections:0,successfulCollections:0,failedCollections:0,skippedCollections:0,completedAt:null}),nn({inProgress:!1,status:"idle",message:null,totalCollections:0,processedCollections:0,successfulCollections:0,failedCollections:0,skippedCollections:0,completedAt:null}),setTimeout(async()=>{await dn(),te([]),se(!1),ct(!1)},100)}catch(t){Mt(`Delete error: ${t.message}`)}finally{ot(!1),mt([]),it([])}})(gt)},100)}},secondaryActions:[{content:"Cancel",onAction:()=>{pt(!1),mt([]),it([])}}],children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsx(d,{variant:"bodyMd",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"200",children:gt.map(e=>t.jsx(j,{tone:"warning",children:e.toUpperCase()},e))})}),t.jsxs(d,{variant:"bodyMd",children:["This will delete optimisation from ",ne?_:ee.length," selected collections."]}),t.jsx(g,{paddingBlockStart:"200",children:t.jsx(d,{variant:"bodySm",tone:"critical",children:"This action cannot be undone."})})]})})}),Mn=at&&t.jsx(r,{open:at,title:"Deleting SEO Data",onClose:()=>{},noScroll:!0,children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsx(d,{variant:"bodyMd",children:"Deleting selected languages..."}),t.jsx(u,{progress:Fe.percent}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:[Fe.current," of ",Fe.total," operations (",Fe.percent,"%)"]})]})})}),On=t.jsx(E,{heading:"No collections found",action:{content:"Clear filters",onAction:()=>{ue(""),pe("all"),dn()}},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:t.jsx("p",{children:"Try adjusting your filters or search terms"})});return t.jsxs(t.Fragment,{children:[t.jsx(o,{globalPlan:O}),t.jsx(b,{children:t.jsx(g,{padding:"400",children:t.jsxs(c,{gap:"300",children:[t.jsxs(m,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[t.jsx(g,{minWidth:"400px",children:t.jsx(S,{label:"",placeholder:"Search by collection name...",value:de,onChange:ue,prefix:t.jsx(v,{}),clearButton:!0,onClearButtonClick:()=>ue("")})}),t.jsx(g,{width:"320px",children:t.jsx(p,{primary:!0,onClick:()=>{0!==ee.length||ne?vt(!0):Mt("Please select collections first")},disabled:0===ee.length&&!ne,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),t.jsxs(m,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[t.jsx(p,{onClick:async()=>{try{ut(!0);const e=await U(`/api/collections/sync?shop=${D}`,{method:"POST"});(null==e?void 0:e.success)?(Mt("Collections synced successfully!"),await dn()):Mt("Failed to sync collections")}catch(e){Mt("Error syncing collections")}finally{ut(!1)}},disabled:dt||F,size:"medium",children:dt?"Syncing...":"Sync Collections"}),t.jsx(g,{width:"320px",children:t.jsxs(c,{gap:"200",align:"end",children:[(()=>{if(0===ee.length&&!ne)return null;if(!q.filter(e=>ee.includes(e.id)).some(e=>{var t;return(null==(t=e.optimizedLanguages)?void 0:t.length)>0}))return null;const e="starter"===Yt.toLowerCase().replace(/_/g," ");return t.jsx(p,{onClick:e?()=>{Ht({error:"Collections require Professional plan or higher",message:"Upgrade to Professional plan to access Collections optimization",minimumPlanRequired:"Professional"}),Rt(!0)}:kn,disabled:0===ee.length&&!ne,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),t.jsx(p,{outline:!0,destructive:!0,onClick:()=>st(!0),disabled:0===ee.length||!rt,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]})})}),t.jsx(g,{paddingBlockStart:"400",children:t.jsxs(b,{children:[t.jsxs(g,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[t.jsxs(m,{gap:"200",wrap:!0,align:"space-between",children:[t.jsx(m,{gap:"200",wrap:!0,children:t.jsx(y,{active:Se,activator:t.jsx(p,{disclosure:"down",onClick:()=>ve(!Se),removeUnderline:!0,children:t.jsxs(m,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"AI Search Status"}),"all"!==he&&t.jsx(g,{onClick:e=>{e.stopPropagation(),pe("all")},children:t.jsx(d,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>ve(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(C,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All collections",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[he],onChange:e=>{pe(e[0]),ve(!1)}})})})}),t.jsx(y,{active:we,activator:t.jsx(p,{disclosure:"down",onClick:()=>Pe(!we),removeUnderline:!0,children:t.jsx(m,{gap:"100",blockAlign:"center",children:t.jsxs("span",{children:["updatedAt"===$e&&"desc"===Ee&&"Newest first","updatedAt"===$e&&"asc"===Ee&&"Oldest first","title"===$e&&"asc"===Ee&&"Name A-Z","title"===$e&&"desc"===Ee&&"Name Z-A","productsCount"===$e&&"desc"===Ee&&"Most products","productsCount"===$e&&"asc"===Ee&&"Least products"]})})}),onClose:()=>Pe(!1),children:t.jsx(g,{padding:"300",minWidth:"200px",children:t.jsx(C,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"updatedAt_desc"},{label:"Oldest first",value:"updatedAt_asc"},{label:"Name A-Z",value:"title_asc"},{label:"Name Z-A",value:"title_desc"},{label:"Most products",value:"productsCount_desc"},{label:"Least products",value:"productsCount_asc"}],selected:[`${$e}_${Ee}`],onChange:e=>{const[t,n]=e[0].split("_");Ie(t),Me(n),Pe(!1)}})})})]}),"all"!==he&&t.jsx(g,{paddingBlockStart:"200",children:t.jsx(m,{gap:"100",wrap:!0,children:t.jsx(j,{onRemove:()=>pe("all"),children:"true"===he?"Has AI Search Optimisation":"No AI Search Optimisation"})})})]}),_>0&&t.jsx(g,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:t.jsx(m,{gap:"200",align:"start",blockAlign:"center",children:t.jsx(y,{active:ae,activator:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},onClick:()=>oe(!ae),children:[t.jsx(x,{checked:ee.length>0&&(ee.length===q.length||le),indeterminate:ee.length>0&&ee.length<q.length&&!le,onChange:hn,label:""}),t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:ee.length>0?le?`All ${_} selected`:`${ee.length} selected`:"Select"}),t.jsx("span",{style:{fontSize:"10px",color:"#637381"},children:"▼"})]}),onClose:()=>oe(!1),preferredAlignment:"left",children:t.jsx(k,{items:[{content:`Select all ${q.length} on this page`,onAction:()=>{hn(!0,!1),oe(!1)},disabled:ee.length===q.length&&!le},{content:`Select all ${_} in this store`,onAction:pn,disabled:le},{content:"Deselect all",onAction:gn,disabled:0===ee.length}]})})})})]})}),(()=>{var e,n,s,l;const i=tn.inProgress||"completed"===tn.status||"failed"===tn.status,a=Vt.inProgress||"completed"===Vt.status||"failed"===Vt.status;return i?t.jsx(g,{paddingBlockStart:"400",children:t.jsx(b,{children:t.jsx(g,{padding:"400",children:tn.inProgress?t.jsxs(c,{gap:"200",children:[t.jsxs(m,{align:"space-between",blockAlign:"center",children:[t.jsxs(m,{gap:"300",blockAlign:"center",children:[t.jsx(A,{size:"small"}),t.jsxs(c,{gap:"100",children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"AI Enhancing Collections..."}),t.jsx(d,{variant:"bodySm",tone:"subdued",children:(()=>{const e=tn.progress;if((null==e?void 0:e.current)&&(null==e?void 0:e.total)){let t=`Enhancing ${e.current}/${e.total} collections`;return rn>=60?t+=` • ~${Math.ceil(rn/60)} min remaining`:rn>0&&(t+=` • ~${rn}s remaining`),t}return tn.message||`Processing ${tn.processedCollections}/${tn.totalCollections} collections`})()})]})]}),t.jsx(p,{onClick:async()=>{try{await U(`/seo/collection-job-cancel?shop=${D}&type=aiEnhance`,{method:"POST"}),Mt("Cancellation requested...")}catch(e){Mt("Failed to cancel")}},size:"slim",variant:"tertiary",children:"Cancel"})]}),(null!=(null==(e=tn.progress)?void 0:e.percent)||tn.totalCollections>0)&&t.jsx(u,{progress:(null==(n=tn.progress)?void 0:n.percent)||tn.processedCollections/tn.totalCollections*100,size:"small"})]}):"completed"===tn.status?t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(j,{tone:"success",children:"AI Enhanced"}),t.jsxs(d,{variant:"bodyMd",children:["Enhanced ",tn.successfulCollections," collection",1!==tn.successfulCollections?"s":"",tn.skippedCollections>0&&t.jsxs(d,{as:"span",tone:"subdued",children:[" (",tn.skippedCollections," skipped)"]}),tn.failedCollections>0&&t.jsxs(d,{as:"span",tone:"critical",children:[" (",tn.failedCollections," failed)"]})]}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["· ",jn(tn.completedAt)]})]}):t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(j,{tone:"critical",children:"AI Enhancement Failed"}),t.jsx(d,{variant:"bodyMd",tone:"critical",children:tn.message||"Enhancement failed"})]})})})}):a?t.jsx(g,{paddingBlockStart:"400",children:t.jsx(b,{children:t.jsx(g,{padding:"400",children:Vt.inProgress?t.jsxs(c,{gap:"200",children:[t.jsxs(m,{align:"space-between",blockAlign:"center",children:[t.jsxs(m,{gap:"300",blockAlign:"center",children:[t.jsx(A,{size:"small"}),t.jsxs(c,{gap:"100",children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Optimizing Collections..."}),t.jsx(d,{variant:"bodySm",tone:"subdued",children:(()=>{const e=Vt.progress;if((null==e?void 0:e.current)&&(null==e?void 0:e.total)){let t=`Processing ${e.current}/${e.total} collections`;return an>=60?t+=` • ~${Math.ceil(an/60)} min remaining`:an>0&&(t+=` • ~${an}s remaining`),t}return Vt.message||`Processing ${Vt.processedCollections}/${Vt.totalCollections} collections`})()})]})]}),t.jsx(p,{onClick:async()=>{try{await U(`/seo/collection-job-cancel?shop=${D}&type=seo`,{method:"POST"}),Mt("Cancellation requested...")}catch(e){Mt("Failed to cancel")}},size:"slim",variant:"tertiary",children:"Cancel"})]}),(null!=(null==(s=Vt.progress)?void 0:s.percent)||Vt.totalCollections>0)&&t.jsx(u,{progress:(null==(l=Vt.progress)?void 0:l.percent)||Vt.processedCollections/Vt.totalCollections*100,size:"small"})]}):"completed"===Vt.status?t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(j,{tone:"success",children:"Completed"}),t.jsxs(d,{variant:"bodyMd",children:["Optimized ",Vt.successfulCollections," collection",1!==Vt.successfulCollections?"s":"",Vt.skippedCollections>0&&t.jsxs(d,{as:"span",tone:"subdued",children:[" (",Vt.skippedCollections," skipped)"]}),Vt.failedCollections>0&&t.jsxs(d,{as:"span",tone:"critical",children:[" (",Vt.failedCollections," failed)"]})]}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["· ",jn(Vt.completedAt)]})]}):t.jsxs(m,{gap:"200",align:"start",blockAlign:"center",children:[t.jsx(j,{tone:"critical",children:"Failed"}),t.jsx(d,{variant:"bodyMd",tone:"critical",children:Vt.message||"Optimization failed"})]})})})}):null})(),t.jsx(g,{paddingBlockStart:"400",children:t.jsxs(b,{children:[t.jsx(w,{resourceName:{singular:"collection",plural:"collections"},items:q,renderItem:e=>{var n,s;const l=(null==(n=xt[e.id])?void 0:n.success)||yt[e.id],i=(null==(s=xt[e.id])?void 0:s.data)||yt[e.id],a=e.optimizedLanguages||[],o=t.jsx(g,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return t.jsx(I,{id:e.id,media:o,accessibilityLabel:`View details for ${e.title}`,children:t.jsxs(m,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[t.jsxs(g,{style:{flex:"1 1 30%",minWidth:"200px"},children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:e.title}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:["Handle: ",e.handle]})]}),t.jsx(g,{style:{flex:"0 0 15%",minWidth:"100px",textAlign:"center"},children:t.jsxs(d,{variant:"bodyMd",children:[e.productsCount," products"]})}),t.jsx(g,{style:{flex:"0 0 25%",minWidth:"160px"},children:t.jsx(m,{gap:"100",wrap:!0,children:e.hasSeoData?t.jsxs(t.Fragment,{children:[De.map(e=>t.jsx(j,{tone:a.includes(e)?"success":"subdued",size:"small",children:e.toUpperCase()},e)),e.aiEnhanced&&t.jsx(j,{tone:"info",size:"small",children:"AI✨"})]}):t.jsx(j,{tone:"subdued",children:"No AI Search Optimisation"})})}),t.jsxs(g,{style:{flex:"0 0 15%",minWidth:"120px"},children:[l&&t.jsx(p,{size:"slim",onClick:()=>{Pt(i),At(!0)},children:"Preview JSON"}),!l&&e.hasSeoData&&t.jsx(p,{size:"slim",loading:$t,onClick:()=>(async e=>{It(!0);try{const t=`/collections/${e.split("/").pop()}/seo-data?shop=${encodeURIComponent(D)}`,n=await U(t);Pt(n),At(!0)}catch(t){Mt(404===(null==t?void 0:t.status)?"No SEO data found for this collection":"Failed to load SEO data")}finally{It(!1)}})(e.id),children:"Preview JSON"})]})]})})},selectedItems:ee,onSelectionChange:un,selectable:!0,loading:F,totalItemsCount:_,emptyState:On,showHeader:!1},`collections-${q.length}-${ee.length}`),_>0&&t.jsx(g,{padding:"400",borderBlockStartWidth:"025",borderColor:"border",children:t.jsxs(m,{align:"space-between",blockAlign:"center",children:[t.jsxs(m,{gap:"200",blockAlign:"center",children:[t.jsx(d,{variant:"bodySm",tone:"subdued",children:"Show"}),t.jsx(P,{label:"",labelHidden:!0,options:[{label:"10",value:"10"},{label:"20",value:"20"},{label:"50",value:"50"},{label:"100",value:"100"}],value:String(K),onChange:fn}),t.jsx(d,{variant:"bodySm",tone:"subdued",children:"per page"})]}),t.jsxs(m,{gap:"200",blockAlign:"center",children:[t.jsxs(d,{variant:"bodySm",tone:"subdued",children:[(Y-1)*K+1,"-",Math.min(Y*K,_)," of ",_]}),t.jsx(p,{icon:t.jsx("span",{children:"‹"}),disabled:Y<=1,onClick:mn,size:"slim"}),t.jsx(p,{icon:t.jsx("span",{children:"›"}),disabled:Y>=G,onClick:xn,size:"slim"})]})]})})]})}),An,wn,Pn,$n,In,En,Mn,(()=>{q.filter(e=>ee.includes(e.id)).filter(e=>{var t;return(null==(t=e.optimizedLanguages)?void 0:t.length)>0});const e=()=>{const e=Tt.results;zt(!1),Lt({processing:!1,current:0,total:0,currentItem:"",results:null}),e&&e.successful>0&&setTimeout(()=>{B([]),dn()},1500)};return Tt.processing?t.jsx(r,{open:Ot,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:t.jsx(r.Section,{children:t.jsxs(c,{gap:"400",children:[t.jsxs(d,{variant:"bodyMd",children:["Processing: ",Tt.currentItem]}),t.jsx(u,{progress:Tt.current/Tt.total*100}),t.jsxs(d,{variant:"bodySm",tone:"subdued",children:[Tt.current," of ",Tt.total," collections (",Math.round(Tt.current/Tt.total*100),"%)"]})]})})}):null!==Tt.results?t.jsx(r,{open:Ot,title:"AI Enhancement Results",onClose:e,primaryAction:{content:"Done",onAction:e},children:t.jsx(r.Section,{children:t.jsx(c,{gap:"300",children:t.jsxs(m,{gap:"400",children:[t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Tt.results.successful})]}),t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Tt.results.failed})]}),t.jsxs(g,{children:[t.jsx(d,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),t.jsx(d,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Tt.results.skipped})]})]})})})}):null})(),t.jsx(s,{open:Wt,onClose:()=>Rt(!1),featureName:"Collections AI Enhancement",currentPlan:Yt,errorMessage:(null==_t?void 0:_t.error)||(null==_t?void 0:_t.message),minimumPlanRequired:null==_t?void 0:_t.minimumPlanRequired}),_t&&t.jsxs(t.Fragment,{children:[t.jsx(l,{open:Dt,onClose:()=>{Ut(!1),Ht(null)},tokensRequired:_t.tokensRequired||0,tokensAvailable:_t.tokensAvailable||0,tokensNeeded:_t.tokensNeeded||0,feature:"ai-seo-collection",shop:D,needsUpgrade:_t.needsUpgrade||!1,minimumPlan:_t.minimumPlanForFeature||null,currentPlan:_t.currentPlan||Yt,returnTo:"/ai-seo/collections",onBuyTokens:()=>{Ut(!1),Nt(!0)}}),t.jsx(i,{open:qt,onClose:()=>{Bt(!1),Ht(null)},feature:_t.feature||"ai-seo-collection",trialEndsAt:_t.trialEndsAt,currentPlan:_t.currentPlan||Yt,tokensRequired:_t.tokensRequired||0,onActivatePlan:async()=>{try{const e=await U("/api/billing/activate",{method:"POST",body:JSON.stringify({shop:D,endTrial:!0,returnTo:"/ai-seo/collections"})});if(e.requiresApproval&&e.confirmationUrl)return void(window.top.location.href=e.confirmationUrl);window.location.reload()}catch(e){const t=new URLSearchParams(window.location.search),n=t.get("host"),s=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(D)}&embedded=${s}&host=${encodeURIComponent(n)}`}},onPurchaseTokens:()=>{Bt(!1),Nt(!0)}})]}),t.jsx(a,{open:Ft,onClose:()=>{Nt(!1),Ht(null)},shop:D,returnTo:"/ai-seo/collections",inTrial:!!(null==_t?void 0:_t.trialEndsAt)}),Et&&t.jsx($,{content:Et,onDismiss:()=>Mt("")})]})}export{M as default};
