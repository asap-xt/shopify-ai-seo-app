import{j as e}from"./app-bridge-CHnOpcYT-1758996270362.js";import{r as n}from"./react-vendor-tAaa2TlE-1758996270362.js";import{u as zt}from"./index-Conk5-n3-1758996270362.js";import{U as kt}from"./UpgradeModal-6X_qgIZB-1758996270362.js";import{M as L,d as $,T as r,e as Ve,a as d,I as y,f as je,B as k,D as Ot,g as Q,C as Qe,h as Ye,i as Bt,S as Ut,P as ye,j as be,R as Mt,k as $t,l as Je,m as Kt,E as Wt}from"./polaris-C5PCKi-C-1758996270362.js";const Nt=(b,p="")=>{try{return new URLSearchParams(window.location.search).get(b)||p}catch{return p}},Oe=b=>{if(!b)return b;const p=String(b).trim();return p.startsWith("gid://")?p:`gid://shopify/Product/${p}`},Rt=b=>{if(!b)return"";const p=String(b).match(/\/(\d+)$/);return p?p[1]:b},R=b=>{if(new URLSearchParams(window.location.search).get("debug_limits")==="true")switch(b==null?void 0:b.toLowerCase()){case"starter":return 5;case"growth":return 10;case"growth extra":return 15;case"professional":return 12;case"enterprise":return 25;default:return 5}switch(b==null?void 0:b.toLowerCase()){case"starter":return 100;case"professional":return 350;case"growth":return 1e3;case"growth extra":return 2500;case"enterprise":return 6e3;default:return 100}};function Yt({shop:b}){const{api:p,shop:Xe}=zt(),l=b||Xe||Nt("shop","");n.useEffect(()=>{console.log("[BULK-EDIT] Component mounted"),console.log("[BULK-EDIT] Shop:",l),console.log("[BULK-EDIT] API function available:",typeof p=="function")},[l,p]);const[I,G]=n.useState([]),[Z,ie]=n.useState(!1),[Ze,Be]=n.useState(1),[et,Le]=n.useState(!0),[q,Ue]=n.useState(0),[x,ee]=n.useState([]),[v,re]=n.useState(!1),[_,Me]=n.useState(""),[B,ce]=n.useState("all"),[O,te]=n.useState(""),[de,Ht]=n.useState("createdAt"),[Y,tt]=n.useState("desc"),[K,ue]=n.useState([]),[st,nt]=n.useState([]),[$e,Ee]=n.useState(!1),[Ke,Ae]=n.useState(!1),[We,Ie]=n.useState(!1),[Ne,we]=n.useState(!1),[ot,at]=n.useState(""),[Ft,lt]=n.useState([]),[H,ge]=n.useState([]),[T,Re]=n.useState([]),[Pe,J]=n.useState(!1),[pe,W]=n.useState({current:0,total:0,percent:0}),[He,X]=n.useState(""),[he,se]=n.useState([]),[ne,Fe]=n.useState({}),[it,Ce]=n.useState(!1),[rt,me]=n.useState(!1),[ct,oe]=n.useState(!1),[N,ae]=n.useState([]),[dt,fe]=n.useState(!1),[Ge,E]=n.useState(""),[ve,Te]=n.useState(!1),[A,le]=n.useState({processing:!1,current:0,total:0,currentItem:"",results:null}),[w,ut]=n.useState(null),[gt,Se]=n.useState(!1),[xe,pt]=n.useState(localStorage.getItem("hasVisitedProducts")==="true"),[ht,De]=n.useState(!1),[mt,ft]=n.useState("starter");n.useEffect(()=>{if(!l)return;p("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          modelsSuggested
        }
      }
    `,variables:{shop:l}})}).then(s=>{var c,h,i;if((c=s==null?void 0:s.errors)!=null&&c.length)throw new Error(((h=s.errors[0])==null?void 0:h.message)||"GraphQL error");const o=(i=s==null?void 0:s.data)==null?void 0:i.plansMe,g=(o==null?void 0:o.modelsSuggested)||["anthropic/claude-3.5-sonnet"];lt(g.map(a=>({label:a,value:a}))),at(g[0]),ut((o==null?void 0:o.plan)||"starter")}).catch(s=>console.error("[BULK-EDIT] GraphQL plansMe failed:",s))},[l,p]),n.useEffect(()=>{if(console.log("[BULK-EDIT] Languages useEffect triggered",{shop:l,api:!!p}),!l){console.log("[BULK-EDIT] No shop, skipping languages load");return}console.log("[BULK-EDIT] Making languages API call to:",`/api/languages/shop/${l}`),console.log("[BULK-EDIT] About to call api() function");const t=new Promise((s,o)=>{setTimeout(()=>o(new Error("API request timeout after 10 seconds")),1e4)});Promise.race([p(`/api/languages/shop/${l}`),t]).then(s=>{console.log("[BULK-EDIT] Languages API response:",s);const o=Array.isArray(s==null?void 0:s.shopLanguages)&&s.shopLanguages.length?s.shopLanguages:["en"];console.log("[BULK-EDIT] Setting available languages to:",o.includes("en")?o:["en",...o]),Re(o.includes("en")?o:["en",...o])}).catch(s=>{console.error("[BULK-EDIT] Languages API error:",s),console.error("[BULK-EDIT] Error details:",s.message,s.stack),Re(["en"])})},[l,p]),n.useEffect(()=>{l&&p("/api/products/tags/list",{shop:l}).then(t=>nt((t==null?void 0:t.tags)||[])).catch(t=>console.error("Failed to load tags:",t))},[l,p]);const F=n.useCallback(async(t=1,s=!1,o=null)=>{var g,c,h,i;console.log(`[BULK-EDIT-LOAD] loadProducts called with pageNum: ${t}, append: ${s}, timestamp: ${o}`),console.log("[BULK-EDIT-LOAD] Current products state:",I.length),ie(!0);try{const a=new URLSearchParams({shop:l,page:t,limit:50,...B!=="all"&&{optimized:B},..._&&{search:_},...O&&{languageFilter:O},...K.length>0&&{tags:K.join(",")},sortBy:de,sortOrder:Y,...o&&{_t:o}}),u=await p(`/api/products/list?${a}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log(`[BULK-EDIT-LOAD] API returned ${((g=u.products)==null?void 0:g.length)||0} products`),((c=u.products)==null?void 0:c.length)>0&&console.log("[BULK-EDIT-LOAD] First product data:",{id:u.products[0].id,_id:u.products[0]._id,title:u.products[0].title,optimizationSummary:u.products[0].optimizationSummary,allKeys:Object.keys(u.products[0])}),G(s?j=>[...j,...u.products]:u.products||[]),Be(t),Le(((h=u.pagination)==null?void 0:h.hasNext)||!1),Ue(((i=u.pagination)==null?void 0:i.total)||0)}catch(a){G(s?I:[]),Le(!1),E(`Error loading products: ${a.message}`)}finally{ie(!1)}},[l,B,_,O,K,de,Y]);n.useEffect(()=>{l&&F(1,!1,null)},[l,F,B,O,K,de,Y]),n.useEffect(()=>{!xe&&l&&(localStorage.setItem("hasVisitedProducts","true"),pt(!0))},[xe,l]),n.useEffect(()=>{I.length===0&&!Z&&l&&!xe&&Se(!0)},[I.length,Z,l,xe]);const qe=n.useCallback(t=>{Me(t)},[]);n.useEffect(()=>{const t=setTimeout(()=>{l&&F(1,!1,null)},500);return()=>clearTimeout(t)},[_]);const St=n.useCallback(t=>{ee(t),t.length===0&&re(!1)},[]),_e=n.useCallback(t=>{re(t),ee(t?I.map(s=>s.id):[])},[I]),xt=()=>{if(x.length===0&&!v){E("Please select products first");return}me(!0)},jt=()=>{if(x.length===0&&!v){E("Please select products first");return}ae([]),oe(!0)},yt=()=>{const s=I.filter(c=>x.includes(c.id)).filter(c=>{var h,i;return((i=(h=c.optimizationSummary)==null?void 0:h.optimizedLanguages)==null?void 0:i.length)>0}),o=async()=>{var h;if(console.log("üîç [AI-ENHANCE] handleStartEnhancement called with products:",s),w&&!["Growth Extra","Enterprise"].includes(w)){ft(w),Te(!1),De(!0);return}le({processing:!0,current:0,total:s.length,currentItem:"",results:null});const c={successful:0,failed:0,skipped:0,skippedDueToPlan:0};for(let i=0;i<s.length;i++){const a=s[i];le(u=>({...u,current:i,currentItem:a.title}));try{if(!(await p("/ai-enhance/check-eligibility",{method:"POST",shop:l,body:{shop:l}})).eligible){c.skipped++,c.skippedDueToPlan++;continue}const j=await p("/ai-enhance/product",{method:"POST",shop:l,body:{shop:l,productId:a.gid||`gid://shopify/Product/${a.productId}`,languages:a.optimizationSummary.optimizedLanguages}});if(console.log(`üîç [AI-ENHANCE] Product ${a.productId} enhance data:`,j),j.results&&j.results.length>0){const f={shop:l,productId:a.gid||`gid://shopify/Product/${a.productId}`,results:j.results.filter(S=>S.bullets&&S.faq).map(S=>{console.log(`üîç [AI-ENHANCE] Language ${S.language} - AI bullets:`,S.bullets),console.log(`üîç [AI-ENHANCE] Language ${S.language} - AI FAQ:`,S.faq),console.log(`üîç [AI-ENHANCE] Language ${S.language} - updatedSeo from AI:`,S.updatedSeo);const C={language:S.language,seo:{...S.updatedSeo,bullets:S.bullets||[],faq:S.faq||[]}};return console.log(`üîç [AI-ENHANCE] Language ${S.language} - final seo result:`,JSON.stringify(C.seo,null,2)),C}),options:{updateBullets:!0,updateFaq:!0}};console.log(`üîç [AI-ENHANCE] Applying data for product ${a.productId}:`,f),console.log("üîç [AI-ENHANCE] First result SEO object:",JSON.stringify((h=f.results[0])==null?void 0:h.seo,null,2));const P=await p("/api/seo/apply-multi",{method:"POST",shop:l,body:f});console.log(`üîç [AI-ENHANCE] Apply result for product ${a.productId}:`,P),c.successful++}else console.log(`üîç [AI-ENHANCE] No valid results for product ${a.productId}:`,j),c.failed++}catch(u){console.error("Enhancement error:",u),c.failed++}le(u=>({...u,current:i+1}))}le(i=>({...i,processing:!1,results:c})),E(`AI enhancement complete! ${c.successful} products enhanced.`)},g=()=>{Te(!1),le({processing:!1,current:0,total:0,currentItem:"",results:null}),A.results&&A.results.successful>0&&F(1,!1,null)};return!A.processing&&!A.results?e.jsx(L,{open:ve,title:"AI Enhanced add-ons for AI Search",onClose:g,primaryAction:{content:"Start AI Enhancement",onAction:o},secondaryActions:[{content:"Cancel",onAction:g}],children:e.jsx(L.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["AI enhancement will improve bullets and FAQ for ",s.length," products."]}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI enhancement is only available for Growth Extra and Enterprise plans."})]})})}):A.processing?e.jsx(L,{open:ve,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(L.Section,{children:e.jsxs($,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",A.currentItem]}),e.jsx(Ve,{progress:A.current/A.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[A.current," of ",A.total," products (",Math.round(A.current/A.total*100),"%)"]})]})})}):A.results!==null?e.jsx(L,{open:ve,title:"AI Enhancement Results",onClose:g,primaryAction:{content:"Done",onAction:g},children:e.jsx(L.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(y,{gap:"400",children:[e.jsxs(d,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:A.results.successful})]}),e.jsxs(d,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:A.results.failed})]}),e.jsxs(d,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:A.results.skipped})]})]}),A.results.skippedDueToPlan>0&&e.jsx(d,{paddingBlockStart:"300",children:e.jsx(r,{variant:"bodySm",tone:"subdued",children:"AI enhancement is only available for Growth Extra and Enterprise plans."})})]})})}):null},bt=async()=>{if(!H.length){E("Please select at least one language");return}me(!1),J(!0),W({current:0,total:0,percent:0}),se([]),Fe({});try{let t=[];v?t=(await p(`/api/products/list?shop=${encodeURIComponent(l)}&limit=1000&fields=id`)).products||[]:t=I.filter(f=>x.includes(f.id));const s=R(w),o=t.length;t=t.slice(0,s);const g=t.length,c=o-g;W({current:0,total:g,percent:0});const h=5,i={};for(let f=0;f<t.length;f+=h){const S=t.slice(f,Math.min(f+h,t.length)).map(async m=>{var D;X(m.title||m.handle||"Product");try{const z=m.gid||Oe(m.productId||m.id),M=((D=m.optimizationSummary)==null?void 0:D.optimizedLanguages)||[],V=H.filter(Dt=>!M.includes(Dt));if(V.length===0){i[m.id]={success:!0,skipped:!0,message:"All selected languages already have AI Search Optimisation"};return}const ke=await p("/api/seo/generate-multi",{method:"POST",shop:l,body:{shop:l,productId:z,model:ot,languages:V}});i[m.id]={success:!0,data:ke,languages:V}}catch(z){i[m.id]={success:!1,error:z.message},se(M=>[...M,{product:m.title,error:z.message}])}});await Promise.all(S);const C=Math.min(f+h,t.length),U=Math.round(C/g*100);W({current:C,total:g,percent:U})}Fe(i),Ce(!0);const a=Object.keys(i).filter(f=>i[f].success&&!i[f].skipped).length,u=Object.keys(i).filter(f=>i[f].skipped).length;let j=`Generated Optimization for AI Search for ${a} products`;u>0&&(j+=` (${u} already optimised)`),c>0&&(j+=` (${c} skipped due to plan limit)`),E(j)}catch(t){E(`Error: ${t.message}`)}finally{J(!1),X("")}},Lt=async()=>{var t,s,o,g;J(!0),W({current:0,total:0,percent:0});try{const c=Object.entries(ne).filter(([u,j])=>j.success&&!j.skipped),h=c.length;W({current:0,total:h,percent:0});for(let u=0;u<c.length;u++){const[j,f]=c[u],P=I.find(U=>U.id===j);if(!P)continue;X(P.title||"Product");try{const U=P.gid||Oe(P.productId||P.id),m=await p("/api/seo/apply-multi",{method:"POST",shop:l,body:{shop:l,productId:U,results:f.data.results.filter(D=>D==null?void 0:D.seo).map(D=>({language:D.language,seo:D.seo})),options:{updateTitle:!0,updateBody:!0,updateSeo:!0,updateBullets:!0,updateFaq:!0,updateAlt:!1,dryRun:!1}}});m.appliedLanguages&&m.appliedLanguages.length>0&&(console.log(`[BULK-EDIT] Optimistic update for product ${j}, languages:`,m.appliedLanguages),G(D=>D.map(z=>{var M;if(z.id===j){const V=((M=z.optimizationSummary)==null?void 0:M.optimizedLanguages)||[],ke=[...new Set([...V,...m.appliedLanguages])];return{...z,optimizationSummary:{...z.optimizationSummary,optimizedLanguages:ke,optimized:!0,lastOptimized:new Date().toISOString()}}}return z})))}catch(U){se(m=>[...m,{product:P.title,error:`Apply failed: ${U.message}`}])}const S=u+1,C=Math.round(S/h*100);W({current:S,total:h,percent:C})}E("AI Search Optimisation applied successfully!"),Ce(!1),ee([]),re(!1),console.log("[BULK-EDIT] Waiting for database propagation..."),await new Promise(u=>setTimeout(u,1e3)),console.log("[BULK-EDIT] Clearing products state before reload..."),G([]),console.log("[BULK-EDIT] Reloading products with cache bypass...");const i=new URLSearchParams({shop:l,page:1,limit:50,...B!=="all"&&{optimized:B},..._&&{search:_},...O&&{languageFilter:O},...K.length>0&&{tags:K.join(",")},sortBy:de,sortOrder:Y,_t:Date.now()}),a=await p(`/api/products/list?${i}`,{shop:l,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});console.log("[BULK-EDIT] Products reloaded, first product:",(t=a.products[0])==null?void 0:t.title),console.log("[BULK-EDIT] First product optimization summary:",(s=a.products[0])==null?void 0:s.optimizationSummary),G(a.products||[]),Be(1),Le(((o=a.pagination)==null?void 0:o.hasNext)||!1),Ue(((g=a.pagination)==null?void 0:g.total)||0)}catch(c){E(`Error applying AI Search Optimisation: ${c.message}`)}finally{J(!1),X("")}},Et=async()=>{var t,s;if(!N.length){E("Please select at least one language to delete");return}oe(!1),fe(!1),J(!0),W({current:0,total:0,percent:0}),se([]);try{let o=[];v?o=(await p(`/api/products/list?shop=${encodeURIComponent(l)}&limit=1000&fields=id`)).products||[]:o=I.filter(i=>x.includes(i.id));const g=o.length;W({current:0,total:g,percent:0});let c=0,h=0;for(let i=0;i<o.length;i++){const a=o[i];X(a.title||a.handle||"Product");try{const f=a.gid||Oe(a.productId||a.id),P=((t=a.optimizationSummary)==null?void 0:t.optimizedLanguages)||[],S=N.filter(U=>P&&P.length>0&&P.includes(U));if(console.log("[BULK-DELETE] Product optimized languages:",P),console.log("[BULK-DELETE] Languages to delete:",S),S.length===0){h++;continue}const C=await p("/api/seo/delete-multi",{method:"POST",shop:l,body:{shop:l,productId:f,languages:S}});console.log("[BULK-DELETE] Delete response:",C),console.log("[BULK-DELETE] Deleted languages:",C.deletedLanguages),C.deletedLanguages&&C.deletedLanguages.length>0&&(console.log("[BULK-DELETE] Before optimistic update, product:",a),console.log("[BULK-DELETE] Current optimized languages:",(s=a.optimizationSummary)==null?void 0:s.optimizedLanguages),G(U=>U.map(m=>{var D;if(m.id===a.id){const z=((D=m.optimizationSummary)==null?void 0:D.optimizedLanguages)||[],M=z.filter(V=>!C.deletedLanguages.includes(V));return console.log("[BULK-DELETE] Updating product:",m.id),console.log("[BULK-DELETE] Languages before:",z),console.log("[BULK-DELETE] Languages after:",M),{...m,optimizationSummary:{...m.optimizationSummary,optimizedLanguages:M,optimized:M.length>0,lastOptimized:M.length>0?m.optimizationSummary.lastOptimized:null}}}return m})),console.log("[BULK-DELETE] State updated, checking first product:",I[0])),c++,C.deletedLanguages&&C.deletedLanguages.length>0&&await p("/api/products/verify-after-delete",{method:"POST",shop:l,body:{shop:l,productIds:[f],deletedLanguages:C.deletedLanguages}})}catch(f){se(P=>[...P,{product:a.title,error:f.message}])}const u=i+1,j=Math.round(u/g*100);W({current:u,total:g,percent:j})}ee([]),re(!1),h>0?E(`Deleted Optimization for AI Search from ${c} products (${h} had no optimisation to delete)`):E(`Deleted Optimization for AI Search from ${c} products`),console.log("[BULK-DELETE] Operation successful!"),setTimeout(()=>{console.log("[BULK-DELETE] Triggering reload with timestamp");const i=Date.now();F(1,!1,i)},500)}catch(o){E(`Error: ${o.message}`)}finally{J(!1),X("")}},At=t=>{var h,i;const s=t,o=Rt(s.productId||s.id),g=((h=s.optimizationSummary)==null?void 0:h.optimizedLanguages)||[];console.log(`[BULK-EDIT] Rendering product: "${s.title}"`),console.log("[BULK-EDIT] optimizationSummary:",s.optimizationSummary),console.log("[BULK-EDIT] optimizedLanguages:",g),console.log("[BULK-EDIT] availableLanguages:",T);const c=(i=s.images)!=null&&i[0]?e.jsx(Je,{source:s.images[0].url||s.images[0].src||s.images[0],alt:s.title,size:"small"}):s.imageUrl?e.jsx(Je,{source:s.imageUrl,alt:s.title,size:"small"}):e.jsx(d,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Kt,{id:s.id,url:"",media:c,accessibilityLabel:`View details for ${s.title}`,children:e.jsxs(y,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(d,{style:{flex:"1 1 40%",minWidth:"250px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:s.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["ID: ",o]})]}),e.jsx(d,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(y,{gap:"100",children:(console.log(`[BULK-EDIT] Rendering badges for "${s.title}"`),console.log("[BULK-EDIT] availableLanguages.length:",T.length),console.log("[BULK-EDIT] availableLanguages:",T),console.log("[BULK-EDIT] optimizedLanguages:",g),T.length>0?(console.log("[BULK-EDIT] Using availableLanguages.map"),T.map(a=>{const u=g.includes(a);return console.log(`[BULK-EDIT] Language ${a}: optimized=${u}`),e.jsx(Q,{tone:u?"success":"subdued",size:"small",children:a.toUpperCase()},a)})):(console.log("[BULK-EDIT] Using fallback optimizedLanguages.map"),g.map(a=>e.jsx(Q,{tone:"success",size:"small",children:a.toUpperCase()},a))))})}),e.jsx(d,{style:{flex:"0 0 20%",minWidth:"100px",textAlign:"center"},children:e.jsx(Q,{tone:"success",children:"Active"})})]})})},It=Pe&&e.jsx(L,{open:Pe,title:"Processing Products",onClose:()=>{},noScroll:!0,children:e.jsx(L.Section,{children:e.jsxs($,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:He?`Processing: ${He}`:"Preparing..."}),e.jsx(Ve,{progress:pe.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[pe.current," of ",pe.total," products (",pe.percent,"%)"]})]})})}),wt=e.jsx(L,{open:rt,title:"Select Languages",onClose:()=>{me(!1),ge([])},primaryAction:{content:"Generate Optimization for AI Search",onAction:bt,disabled:H.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{me(!1),ge([])}}],children:e.jsx(L.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",v?"all":x.length," selected products:"]}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:T.map(t=>e.jsx(je,{label:t.toUpperCase(),checked:H.includes(t),onChange:s=>{ge(s?[...H,t]:H.filter(o=>o!==t))}},t))})}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{ge(H.length===T.length?[]:[...T])},children:H.length===T.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Note: AI Search Optimisation will only be generated for languages that don't already have optimisation."})]})})}),Pt=e.jsx(L,{open:it&&!Pe,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:Lt,disabled:!Object.values(ne).some(t=>t.success&&!t.skipped)},secondaryActions:[{content:"Cancel",onAction:()=>Ce(!1)}],children:e.jsx(L.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(y,{gap:"400",children:[e.jsxs(d,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(ne).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(d,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(ne).filter(t=>t.skipped).length})]}),e.jsxs(d,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(ne).filter(t=>!t.success).length})]})]}),he.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ot,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(d,{maxHeight:"200px",overflowY:"scroll",children:[he.slice(0,10).map((t,s)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.product,": ",t.error]},s)),he.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",he.length-10," more errors"]})]})]})]})})}),Ct=e.jsx(L,{open:ct,title:"Delete Optimization for AI Search",onClose:()=>{oe(!1),ae([])},primaryAction:{content:"Continue",onAction:()=>{oe(!1),fe(!0)},disabled:N.length===0,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>{oe(!1),ae([])}}],children:e.jsx(L.Section,{children:e.jsxs($,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",v?"all":x.length," selected products:"]}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(y,{gap:"200",wrap:!0,children:T.map(t=>e.jsx(je,{label:t.toUpperCase(),checked:N.includes(t),onChange:s=>{ae(s?[...N,t]:N.filter(o=>o!==t))}},t))})}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(k,{plain:!0,onClick:()=>{ae(N.length===T.length?[]:[...T])},children:N.length===T.length?"Deselect all":"Select all"})}),e.jsx(r,{variant:"bodySm",tone:"caution",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})]})})}),vt=e.jsx(L,{open:dt,title:"Confirm Deletion",onClose:()=>{fe(!1)},primaryAction:{content:"Delete",onAction:Et,destructive:!0},secondaryActions:[{content:"Cancel",onAction:()=>fe(!1)}],children:e.jsx(L.Section,{children:e.jsxs($,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",tone:"critical",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(d,{paddingBlock:"200",children:e.jsx(y,{gap:"100",children:N.map(t=>e.jsx(Q,{tone:"critical",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",v?"ALL":x.length," selected products."]}),e.jsx(r,{variant:"bodySm",tone:"critical",fontWeight:"semibold",children:"This action cannot be undone."})]})})}),ze=async()=>{try{ie(!0),E("Syncing products from Shopify...");const t=await p("/api/products/sync",{method:"POST",shop:l});if(t.success){const s=t.productsCount||t.synced||0;E(`‚úÖ Synced ${s} products successfully!`),setTimeout(()=>{F(1,!1,Date.now())},1e3)}else throw new Error(t.error||"Sync failed")}catch(t){console.error("Sync error:",t),E(`‚ùå Sync failed: ${t.message}`)}finally{ie(!1)}},Tt=e.jsx(Wt,{heading:"No products found",action:{content:"Clear filters",onAction:()=>{Me(""),ce("all"),te(""),ue([]),F(1,!1,null)}},secondaryAction:{content:"Sync from Shopify",onAction:ze},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms, or sync products from Shopify"})});return e.jsxs(e.Fragment,{children:[e.jsx(Qe,{children:e.jsxs(d,{padding:"400",children:[e.jsxs($,{gap:"300",children:[w&&e.jsx(Ye,{tone:"info",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(r,{children:["Your ",e.jsx("strong",{children:w})," plan includes up to"," ",e.jsx("strong",{children:R(w)})," products for SEO optimization.",q>R(w)&&e.jsxs(e.Fragment,{children:[" You have ",q," products, so only the first ",R(w)," will be processed."]})]}),(x.length>0||v)&&e.jsxs(r,{children:["Selected: ",v?Math.min(q,R(w)):x.length,"/",R(w)]})]})}),w&&(x.length>R(w)||v&&q>R(w))&&e.jsx(Ye,{tone:"warning",children:e.jsxs(y,{gap:"200",align:"space-between",children:[e.jsxs(r,{children:[e.jsx("strong",{children:"Plan Limit Exceeded:"})," You've selected more products than your ",w," plan allows. Only the first ",R(w)," products will be processed."]}),e.jsx(k,{size:"micro",onClick:()=>De(!0),children:"Upgrade Plan"})]})}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(d,{minWidth:"400px",children:e.jsx(Bt,{label:"",placeholder:"Search by product ID, name, or details...",value:_,onChange:qe,prefix:e.jsx(Ut,{}),clearButton:!0,onClearButtonClick:()=>qe("")})}),e.jsx(d,{width:"320px",children:e.jsx(k,{primary:!0,onClick:xt,disabled:x.length===0&&!v,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(y,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(k,{onClick:ze,disabled:Z,size:"medium",children:"Sync Products"}),e.jsx(d,{width:"320px",children:e.jsxs($,{gap:"200",align:"end",children:[x.length===0&&!v||!I.filter(o=>x.includes(o.id)).some(o=>{var g,c;return((c=(g=o.optimizationSummary)==null?void 0:g.optimizedLanguages)==null?void 0:c.length)>0})?null:e.jsx(k,{onClick:()=>Te(!0),disabled:x.length===0&&!v,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons for AI Search"}),e.jsx(k,{onClick:jt,disabled:x.length===0&&!v||!I.filter(o=>x.includes(o.id)).some(o=>{var g,c;return((c=(g=o.optimizationSummary)==null?void 0:g.optimizedLanguages)==null?void 0:c.length)>0}),destructive:!0,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]}),q>0&&e.jsx(d,{paddingBlockStart:"300",children:e.jsx(je,{label:`Select all ${q} products in your store`,checked:v,onChange:_e})})]})}),e.jsx(d,{paddingBlockStart:"400",children:e.jsxs(Qe,{children:[e.jsxs(d,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(y,{gap:"200",wrap:!0,align:"space-between",children:[e.jsxs(y,{gap:"200",wrap:!0,children:[e.jsx(ye,{active:$e,activator:e.jsx(k,{disclosure:"down",onClick:()=>Ee(!$e),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),B!=="all"&&e.jsx(d,{onClick:t=>{t.stopPropagation(),ce("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>Ee(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(be,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All products",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[B],onChange:t=>{ce(t[0]),te(""),Ee(!1)}})})}),e.jsx(ye,{active:Ke,activator:e.jsx(k,{disclosure:"down",onClick:()=>Ae(!Ke),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Language Status"}),O&&e.jsx(d,{onClick:t=>{t.stopPropagation(),te("")},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>Ae(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(be,{title:"Language Status",titleHidden:!0,choices:[{label:"All languages",value:""},...T.map(t=>({label:`Has ${t.toUpperCase()}`,value:`has_${t}`})),...T.map(t=>({label:`Missing ${t.toUpperCase()}`,value:`missing_${t}`}))],selected:O?[O]:[],onChange:t=>{te(t[0]||""),Ae(!1)}})})}),e.jsx(ye,{active:We,activator:e.jsx(k,{disclosure:"down",onClick:()=>Ie(!We),removeUnderline:!0,children:e.jsxs(y,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"Tags"}),K.length>0&&e.jsx(d,{onClick:t=>{t.stopPropagation(),ue([])},children:e.jsx(r,{as:"span",tone:"subdued",children:"‚úï"})})]})}),onClose:()=>Ie(!1),children:e.jsxs(d,{padding:"300",minWidth:"200px",children:[e.jsx(be,{title:"Tags",titleHidden:!0,allowMultiple:!0,choices:st.map(t=>({label:t,value:t})),selected:K,onChange:t=>{ue(t)}}),e.jsx(d,{paddingBlockStart:"200",children:e.jsx(k,{size:"slim",onClick:()=>Ie(!1),children:"Apply"})})]})})]}),e.jsx(ye,{active:Ne,activator:e.jsx(k,{disclosure:"down",onClick:()=>we(!Ne),removeUnderline:!0,children:e.jsx(y,{gap:"100",blockAlign:"center",children:e.jsx("span",{children:Y==="desc"?"Newest first":"Oldest first"})})}),onClose:()=>we(!1),children:e.jsx(d,{padding:"300",minWidth:"200px",children:e.jsx(be,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"desc"},{label:"Oldest first",value:"asc"}],selected:[Y],onChange:t=>{tt(t[0]),we(!1)}})})})]}),(B!=="all"||O||K.length>0)&&e.jsx(d,{paddingBlockStart:"200",children:e.jsxs(y,{gap:"100",wrap:!0,children:[B!=="all"&&e.jsx(Q,{onRemove:()=>ce("all"),children:B==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"}),O&&e.jsx(Q,{onRemove:()=>te(""),children:O.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}),K.map(t=>e.jsxs(Q,{onRemove:()=>ue(s=>s.filter(o=>o!==t)),children:["Tag: ",t]},t))]})})]}),e.jsxs(d,{children:[e.jsx(d,{paddingBlockEnd:"200",paddingInlineStart:"300",children:e.jsxs(y,{gap:"200",align:"start",children:[e.jsx(je,{checked:x.length===I.length&&I.length>0,onChange:_e,label:""}),e.jsxs(r,{variant:"bodyMd",fontWeight:"semibold",children:["Select all",x.length>0&&` (${x.length} selected products)`]})]})}),e.jsx(Mt,{resourceName:{singular:"product",plural:"products"},items:I,renderItem:At,selectedItems:x,onSelectionChange:St,selectable:!0,loading:Z,totalItemsCount:q,emptyState:Tt,showHeader:!1})]}),et&&!Z&&e.jsx(d,{padding:"400",textAlign:"center",children:e.jsx(k,{onClick:()=>F(Ze+1,!0,null),children:"Load more"})})]})}),It,wt,Pt,Ct,vt,yt(),e.jsx(L,{open:gt,onClose:()=>Se(!1),title:"Sync your products",primaryAction:{content:"Sync Products",onAction:()=>{Se(!1),ze()}},secondaryActions:[{content:"Skip for now",onAction:()=>Se(!1)}],children:e.jsx(L.Section,{children:e.jsxs($,{gap:"300",children:[e.jsx(r,{variant:"bodyMd",children:"To get started with AI SEO optimization, you need to sync your products from Shopify first."}),e.jsx(r,{variant:"bodyMd",children:"This will import all your products so you can optimize them for better search visibility."})]})})}),e.jsx(kt,{open:ht,onClose:()=>De(!1),featureName:"AI Enhancement",currentPlan:mt}),Ge&&e.jsx($t,{content:Ge,onDismiss:()=>E("")})]})}export{Yt as default};
