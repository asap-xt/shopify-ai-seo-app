import{r as e,j as t}from"./react-vendor-BXVC7v0l.js";import{m as n}from"./sessionFetch-kQ0erppk.js";import{S as s,U as l}from"./StoreMetadataBanner-Cnf5DXyn.js";import{I as i}from"./InsufficientTokensModal-D0S-AnP8.js";import{T as a}from"./TrialActivationModal-BmJSzwDA.js";import{M as o,a as r,T as c,e as d,d as u,b as h,B as p,I as g,g as m,D as x,f,C as j,h as S,S as b,i as y,j as v,R as w,k as C,m as A,E as k}from"./polaris-DIPq0--Z.js";import"./app-bridge-DUY42B6P.js";import"./vendor-Cs_VgJ2r.js";import"./index-xfv8MV1x.js";function P({shop:P,globalPlan:I}){var O,M,$;const z=P||((e,t="")=>{try{return new URLSearchParams(window.location.search).get(e)||t}catch{return t}})("shop",""),E=e.useMemo(()=>n(),[]),[L,R]=e.useState([]),[T,U]=e.useState(!1),[W,D]=e.useState(0),[N,q]=e.useState([]),[B,_]=e.useState(!1),[F,H]=e.useState(""),[J,K]=e.useState(""),[G,Y]=e.useState("all"),[Z,Q]=e.useState(""),[V,X]=e.useState([]),[ee,te]=e.useState([]),[ne,se]=e.useState(!1),[le,ie]=e.useState(!1),[ae,oe]=e.useState(!1),[re,ce]=e.useState(!1),[de,ue]=e.useState("updatedAt"),[he,pe]=e.useState("desc"),[ge,me]=e.useState(""),[xe,fe]=e.useState([]),[je,Se]=e.useState([]),[be,ye]=e.useState([]),[ve,we]=e.useState(!1),[Ce,Ae]=e.useState({current:0,total:0,percent:0}),[ke,Pe]=e.useState(""),[Ie,Oe]=e.useState([]),[Me,$e]=e.useState(!1),[ze,Ee]=e.useState(null),[Le,Re]=e.useState(!1),[Te,Ue]=e.useState(""),[We,De]=e.useState(!1),[Ne,qe]=e.useState([]),[Be,_e]=e.useState(!1),[Fe,He]=e.useState(!1),[Je,Ke]=e.useState(!1),[Ge,Ye]=e.useState(!1),[Ze,Qe]=e.useState([]),[Ve,Xe]=e.useState({}),[et,tt]=e.useState(!1),[nt,st]=e.useState(!1),[lt,it]=e.useState({}),[at,ot]=e.useState(!1),[rt,ct]=e.useState(null),[dt,ut]=e.useState(!1),[ht,pt]=e.useState(""),[gt,mt]=e.useState(!1),[xt,ft]=e.useState(!1),[jt,St]=e.useState(!1),[bt,yt]=e.useState(!1),[vt,wt]=e.useState(null),[Ct,At]=e.useState("starter"),[kt,Pt]=e.useState(1),[It,Ot]=e.useState(!1);e.useEffect(()=>{if(I&&"object"==typeof I&&!It&&"starter"===Ct)if(I.planKey&&""!==I.planKey){At(I.planKey);const e=I.language_limit||1;Pt(e)}else if(I.plan&&""!==I.plan){const e=I.plan.toLowerCase().replace(/\s+/g,"-");At(e);const t=I.language_limit||1;Pt(t)}},[I,Ct,It]);const[Mt,$t]=e.useState({processing:!1,current:0,total:0,currentItem:"",results:null});e.useEffect(()=>{if(!z)return;E("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n      query PlansMe($shop:String!) {\n        plansMe(shop:$shop) {\n          plan\n          planKey\n          modelsSuggested\n          language_limit\n          product_limit\n        }\n      }\n    ",variables:{shop:z}})}).then(e=>{var t,n,s;if(null==(t=null==e?void 0:e.errors)?void 0:t.length)throw new Error((null==(n=e.errors[0])?void 0:n.message)||"GraphQL error");const l=null==(s=null==e?void 0:e.data)?void 0:s.plansMe,i=(null==l?void 0:l.modelsSuggested)||["google/gemini-1.5-flash"];fe(i.map(e=>({label:e,value:e}))),me(i[0]),At((null==l?void 0:l.planKey)||"starter");const a=(null==l?void 0:l.language_limit)||1;Pt(a),Ot(!0)}).catch(e=>{pt(`Error loading models: ${e.message}`),Ot(!0)})},[z,E]),e.useEffect(()=>{z&&E(`/api/languages/shop/${z}?shop=${z}`).then(e=>{const t=(null==e?void 0:e.shopLanguages)||["en"];ye(t),Se([])}).catch(e=>{ye(["en"]),Se([])})},[z,E]);const zt=e.useCallback(async()=>{U(!0);try{const e=`/collections/list-graphql?${new URLSearchParams({shop:z,...J&&{search:J},..."all"!==G&&{optimized:G},sortBy:de,sortOrder:he})}`;let t=(await E(e)).collections||[];if(J){const e=J.toLowerCase();t=t.filter(t=>t.title.toLowerCase().includes(e)||t.handle.toLowerCase().includes(e))}"all"!==G&&(t=t.filter(e=>"true"===G?e.hasSeoData:!e.hasSeoData)),R(t),D(t.length)}catch(e){pt(`Error loading collections: ${e.message}`)}finally{U(!1)}},[z,J,G,de,he,E]);e.useEffect(()=>{z&&(zt(),He(!1))},[z,G,de,he,zt]),e.useEffect(()=>{const e=setTimeout(()=>{z&&zt()},500);return()=>clearTimeout(e)},[J]);const Et=e.useCallback(e=>{q(e);const t=e.some(e=>{const t=L.find(t=>t.id===e);return null==t?void 0:t.hasSeoData});He(t),0===e.length&&_(!1)},[L]),Lt=e.useCallback(e=>{if(_(e),e){q(L.map(e=>e.id));const e=L.some(e=>e.hasSeoData);He(e)}else q([]),He(!1)},[L]),Rt=e.useMemo(()=>{var e;if(B)return je.length>kt;const t=L.filter(e=>N.includes(e.id));if(0===t.length)return je.length>kt;for(const n of t){const t=(null==(e=n.optimizationSummary)?void 0:e.optimizedLanguages)||[],s=je.filter(e=>!t.includes(e));if(t.length+s.length>kt)return!0}return!1},[L,N,B,kt,je]),Tt=async()=>{const e=L.filter(e=>N.includes(e.id)).filter(e=>{var t;return(null==(t=e.optimizedLanguages)?void 0:t.length)>0});if(0===e.length)return void pt("Please select collections with Basic SEO optimization");mt(!0),$t({processing:!0,current:0,total:e.length,currentItem:"",results:null});const t={successful:0,failed:0,skipped:0};for(let s=0;s<e.length;s++){const l=e[s];$t(e=>({...e,current:s,currentItem:l.title}));try{const e=l.optimizedLanguages||[];if(0===e.length){t.skipped++;continue}const n=await E(`/ai-enhance/collection/${encodeURIComponent(l.id)}`,{method:"POST",shop:z,body:{shop:z,languages:e}});n&&n.ok?t.successful++:t.failed++}catch(n){if(403===n.status)return $t({processing:!1,current:0,total:0,currentItem:"",results:null}),wt(n),At(n.currentPlan||Ct||"starter"),void ft(!0);if(402===n.status||n.requiresPurchase||n.trialRestriction)return $t({processing:!1,current:0,total:0,currentItem:"",results:null}),wt(n),At(n.currentPlan||Ct||"starter"),void(n.trialRestriction&&n.requiresActivation?yt(!0):n.trialRestriction?ft(!0):St(!0));t.failed++}$t(e=>({...e,current:s+1}))}$t(e=>({...e,processing:!1,results:t})),pt(`AI enhancement complete! ${t.successful} collections enhanced.`)},Ut=ve&&!Mt.processing&&t.jsx(o,{open:ve,title:"Processing Collections",onClose:()=>{},noScroll:!0,children:t.jsx(o.Section,{children:t.jsxs(r,{gap:"400",children:[t.jsx(c,{variant:"bodyMd",children:ke?`Processing: ${ke}`:"Preparing..."}),t.jsx(d,{progress:Ce.percent}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:[Ce.current," of ",Ce.total," collections (",Ce.percent,"%)"]})]})})}),Wt=t.jsx(o,{open:nt,title:"Select Languages",primaryAction:{content:"Generate Optimization for AI Search",onAction:async()=>{var e;if(je.length){st(!1),we(!0),Ae({current:0,total:0,percent:0}),Oe([]),Xe({});try{const n=B?L:L.filter(e=>N.includes(e.id)),s=n.length;Ae({current:0,total:s,percent:0});const l={};for(let a=0;a<n.length;a++){const i=n[a];Pe(i.title);try{const e=await E("/seo/generate-collection-multi",{method:"POST",shop:z,body:JSON.stringify({shop:z,collectionId:i.id,model:ge,languages:je})});l[i.id]={success:!0,data:e}}catch(t){if(403===t.status||(null==(e=t.message)?void 0:e.includes("requires Professional plan")))return we(!1),Pe(""),wt({error:t.message||"Collections SEO requires Professional plan or higher",currentPlan:t.currentPlan||Ct||"starter",upgradeMessage:t.upgradeMessage||"Upgrade to Professional plan to optimize collections for AI search"}),void ft(!0);l[i.id]={success:!1,error:t.message},Oe(e=>[...e,{collection:i.title,error:t.message}])}const o=a+1,r=Math.round(o/s*100);Ae({current:o,total:s,percent:r})}Xe(l),tt(!0);const i=Object.values(l).filter(e=>e.success).length;pt(`Generated optimization for ${i} collections`)}catch(t){pt(`Error: ${t.message}`)}finally{we(!1),Pe("")}}else pt("Please select at least one language")},disabled:0===je.length||Rt},secondaryActions:[{content:"Cancel",onAction:()=>st(!1)}],children:t.jsx(o.Section,{children:t.jsxs(r,{gap:"300",children:[t.jsxs(c,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",B?"all":N.length," selected collections:"]}),Rt&&t.jsx(u,{tone:"warning",title:"Language limit exceeded",children:t.jsxs(r,{gap:"200",children:[t.jsxs(c,{variant:"bodyMd",children:["Your ",Ct," plan supports up to ",kt," language",kt>1?"s":""," per collection.",1===N.length&&(null==($=null==(M=null==(O=L.find(e=>e.id===N[0]))?void 0:O.optimizationSummary)?void 0:M.optimizedLanguages)?void 0:$.length)>0&&t.jsxs(t.Fragment,{children:[" This collection already has ",L.find(e=>e.id===N[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),t.jsx(c,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),t.jsx(h,{variant:"primary",onClick:()=>{const e=new URLSearchParams(window.location.search),t=e.toString()?`?${e.toString()}`:"";window.location.href=`/billing${t}`},children:"Upgrade Plan"})]})}),t.jsx(p,{paddingBlockStart:"200",children:t.jsx(g,{gap:"200",wrap:!0,children:be.map(e=>t.jsx(m,{label:e.toUpperCase(),checked:je.includes(e),onChange:t=>{Se(t?[...je,e]:je.filter(t=>t!==e))}},e))})}),t.jsx(p,{paddingBlockStart:"200",children:t.jsx(h,{plain:!0,onClick:()=>{je.length===be.length?Se([]):be.length>kt?(Se([...be]),pt(`You selected ${be.length} languages. Your ${Ct} plan supports ${kt}. Please deselect or upgrade.`)):Se([...be])},children:je.length===be.length?"Deselect all":"Select all"})})]})})}),Dt=t.jsx(o,{open:et&&!ve,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:async()=>{var e;we(!0),Ae({current:0,total:0,percent:0});try{const n=Object.entries(Ve).filter(([e,t])=>t.success),s=n.length;Ae({current:0,total:s,percent:0});for(let l=0;l<n.length;l++){const[i,a]=n[l],o=L.find(e=>e.id===i);if(!o)continue;Pe(o.title);try{if(!(null==(e=a.data)?void 0:e.results)||!Array.isArray(a.data.results))throw new Error("Invalid results structure");const t=await E("/seo/apply-collection-multi",{method:"POST",shop:z,body:{shop:z,collectionId:i,results:a.data.results.map(e=>({language:e.language,seo:e.data})),options:{updateTitle:!0,updateDescription:!0,updateSeo:!0,updateMetafields:!0}}});if(!(null==t?void 0:t.ok))throw new Error((null==t?void 0:t.error)||"Apply failed")}catch(t){Ie.push({id:o.id,title:o.title,message:t.message})}const r=l+1,c=Math.round(r/s*100);Ae({current:r,total:s,percent:c})}pt("Optimization applied successfully!"),tt(!1),Xe({}),q([]),await zt(),_(!1)}catch(t){pt(`Error applying optimization: ${t.message}`)}finally{we(!1),Pe("")}},disabled:!Object.values(Ve).some(e=>e.success)},secondaryActions:[{content:"Cancel",onAction:()=>tt(!1)}],children:t.jsx(o.Section,{children:t.jsxs(r,{gap:"300",children:[t.jsxs(g,{gap:"400",children:[t.jsxs(p,{children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),t.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values(Ve).filter(e=>e.success&&!e.skipped).length})]}),t.jsxs(p,{children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),t.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values(Ve).filter(e=>e.skipped).length})]}),t.jsxs(p,{children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),t.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values(Ve).filter(e=>!e.success&&!e.skipped).length})]})]}),Ie.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(x,{}),t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),t.jsxs(p,{maxHeight:"200px",overflowY:"scroll",children:[Ie.slice(0,10).map((e,n)=>t.jsxs(c,{variant:"bodySm",tone:"critical",children:[e.collection,": ",e.error]},n)),Ie.length>10&&t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["... and ",Ie.length-10," more errors"]})]})]})]})})}),Nt=t.jsx(o,{open:at,title:"SEO Data Preview",secondaryActions:[{content:"Close",onAction:()=>{ot(!1),ct(null)}}],children:t.jsx(o.Section,{children:t.jsx(p,{children:t.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",backgroundColor:"#f6f6f7",padding:"12px",borderRadius:"4px",maxHeight:"400px",overflow:"auto"},children:rt?JSON.stringify(rt,null,2):""})})})}),qt=t.jsx(o,{open:We,title:"Delete Optimization for AI Search",onClose:()=>{De(!1),qe([])},primaryAction:{content:"Continue",onAction:()=>{Qe(Ne),De(!1),Ye(!0)},disabled:0===Ne.length},secondaryActions:[{content:"Cancel",onAction:()=>{De(!1),qe([])}}],children:t.jsx(o.Section,{children:t.jsxs(r,{gap:"400",children:[t.jsxs(c,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",B?W:N.length," selected collections:"]}),t.jsx(p,{paddingBlockStart:"200",children:t.jsx(g,{gap:"400",wrap:!1,children:be.map(e=>t.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[t.jsx("input",{type:"checkbox",checked:Ne.includes(e),onChange:t=>{qe(t.target.checked?[...Ne,e]:Ne.filter(t=>t!==e))},style:{marginRight:"8px",width:"18px",height:"18px",cursor:"pointer"}}),t.jsx(c,{variant:"bodyMd",children:e.toUpperCase()})]},e))})}),t.jsx(p,{children:t.jsx(h,{plain:!0,onClick:()=>{qe(Ne.length===be.length?[]:[...be])},children:"Select all"})}),t.jsx(p,{paddingBlockStart:"300",children:t.jsx(c,{variant:"bodySm",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})})]})})}),Bt=t.jsx(o,{open:Ge,title:"Confirm Deletion",onClose:()=>{Ye(!1),Qe([])},primaryAction:{content:"Delete",destructive:!0,onAction:async()=>{Ye(!1),setTimeout(()=>{(async(e=[])=>{_e(!0),Ue("");try{const n=B?L:L.filter(e=>N.includes(e.id)),s=n.length*e.length;let l=0;const i=[];for(const a of n)for(const n of e)try{await E("/collections/delete-seo",{method:"DELETE",shop:z,body:{shop:z,collectionId:a.id,language:n}})}catch(t){i.push({id:a.id,title:a.title,message:t.message})}finally{l++,Ae({current:l,total:s,percent:Math.round(l/s*100)})}pt(`Deleted optimization for ${e.join(", ").toUpperCase()}`),setTimeout(async()=>{await zt(),q([]),_(!1),He(!1)},100)}catch(t){pt(`Delete error: ${t.message}`)}finally{_e(!1),Qe([]),qe([])}})(Ze)},100)}},secondaryActions:[{content:"Cancel",onAction:()=>{Ye(!1),Qe([]),qe([])}}],children:t.jsx(o.Section,{children:t.jsxs(r,{gap:"400",children:[t.jsx(c,{variant:"bodyMd",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),t.jsx(p,{paddingBlockStart:"200",children:t.jsx(g,{gap:"200",children:Ze.map(e=>t.jsx(f,{tone:"warning",children:e.toUpperCase()},e))})}),t.jsxs(c,{variant:"bodyMd",children:["This will delete optimisation from ",B?W:N.length," selected collections."]}),t.jsx(p,{paddingBlockStart:"200",children:t.jsx(c,{variant:"bodySm",tone:"critical",children:"This action cannot be undone."})})]})})}),_t=Be&&t.jsx(o,{open:Be,title:"Deleting SEO Data",onClose:()=>{},noScroll:!0,children:t.jsx(o.Section,{children:t.jsxs(r,{gap:"400",children:[t.jsx(c,{variant:"bodyMd",children:"Deleting selected languages..."}),t.jsx(d,{progress:Ce.percent}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:[Ce.current," of ",Ce.total," operations (",Ce.percent,"%)"]})]})})}),Ft=t.jsx(k,{heading:"No collections found",action:{content:"Clear filters",onAction:()=>{K(""),Y("all"),zt()}},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:t.jsx("p",{children:"Try adjusting your filters or search terms"})});return t.jsxs(t.Fragment,{children:[t.jsx(s,{globalPlan:I}),t.jsx(j,{children:t.jsx(p,{padding:"400",children:t.jsxs(r,{gap:"300",children:[t.jsxs(g,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[t.jsx(p,{minWidth:"400px",children:t.jsx(S,{label:"",placeholder:"Search by collection name...",value:J,onChange:K,prefix:t.jsx(b,{}),clearButton:!0,onClearButtonClick:()=>K("")})}),t.jsx(p,{width:"320px",children:t.jsx(h,{primary:!0,onClick:()=>{0!==N.length||B?st(!0):pt("Please select collections first")},disabled:0===N.length&&!B,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),t.jsxs(g,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[t.jsx(h,{onClick:async()=>{try{Ke(!0);const e=await E(`/api/collections/sync?shop=${z}`,{method:"POST"});(null==e?void 0:e.success)?(pt("Collections synced successfully!"),await zt()):pt("Failed to sync collections")}catch(e){pt("Error syncing collections")}finally{Ke(!1)}},disabled:Je||T,size:"medium",children:Je?"Syncing...":"Sync Collections"}),t.jsx(p,{width:"320px",children:t.jsxs(r,{gap:"200",align:"end",children:[(()=>{if(0===N.length&&!B)return null;if(!L.filter(e=>N.includes(e.id)).some(e=>{var t;return(null==(t=e.optimizedLanguages)?void 0:t.length)>0}))return null;const e="starter"===Ct.toLowerCase().replace(/_/g," ");return t.jsx(h,{onClick:e?()=>{wt({error:"Collections require Professional plan or higher",message:"Upgrade to Professional plan to access Collections optimization",minimumPlanRequired:"Professional"}),ft(!0)}:Tt,disabled:0===N.length&&!B,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),t.jsx(h,{outline:!0,destructive:!0,onClick:()=>De(!0),disabled:0===N.length||!Fe,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]})})}),t.jsx(p,{paddingBlockStart:"400",children:t.jsxs(j,{children:[t.jsxs(p,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[t.jsxs(g,{gap:"200",wrap:!0,align:"space-between",children:[t.jsx(g,{gap:"200",wrap:!0,children:t.jsx(y,{active:ne,activator:t.jsx(h,{disclosure:"down",onClick:()=>se(!ne),removeUnderline:!0,children:t.jsxs(g,{gap:"100",blockAlign:"center",children:[t.jsx("span",{children:"AI Search Status"}),"all"!==G&&t.jsx(p,{onClick:e=>{e.stopPropagation(),Y("all")},children:t.jsx(c,{as:"span",tone:"subdued",children:"✕"})})]})}),onClose:()=>se(!1),children:t.jsx(p,{padding:"300",minWidth:"200px",children:t.jsx(v,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All collections",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[G],onChange:e=>{Y(e[0]),se(!1)}})})})}),t.jsx(y,{active:re,activator:t.jsx(h,{disclosure:"down",onClick:()=>ce(!re),removeUnderline:!0,children:t.jsx(g,{gap:"100",blockAlign:"center",children:t.jsxs("span",{children:["updatedAt"===de&&"desc"===he&&"Newest first","updatedAt"===de&&"asc"===he&&"Oldest first","title"===de&&"asc"===he&&"Name A-Z","title"===de&&"desc"===he&&"Name Z-A","productsCount"===de&&"desc"===he&&"Most products","productsCount"===de&&"asc"===he&&"Least products"]})})}),onClose:()=>ce(!1),children:t.jsx(p,{padding:"300",minWidth:"200px",children:t.jsx(v,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"updatedAt_desc"},{label:"Oldest first",value:"updatedAt_asc"},{label:"Name A-Z",value:"title_asc"},{label:"Name Z-A",value:"title_desc"},{label:"Most products",value:"productsCount_desc"},{label:"Least products",value:"productsCount_asc"}],selected:[`${de}_${he}`],onChange:e=>{const[t,n]=e[0].split("_");ue(t),pe(n),ce(!1)}})})})]}),"all"!==G&&t.jsx(p,{paddingBlockStart:"200",children:t.jsx(g,{gap:"100",wrap:!0,children:t.jsx(f,{onRemove:()=>Y("all"),children:"true"===G?"Has AI Search Optimisation":"No AI Search Optimisation"})})})]}),W>0&&t.jsx(p,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:t.jsx(m,{label:`Select all ${W} collections`,checked:B,onChange:Lt})}),t.jsx(w,{resourceName:{singular:"collection",plural:"collections"},items:L,renderItem:e=>{var n,s;const l=(null==(n=Ve[e.id])?void 0:n.success)||lt[e.id],i=(null==(s=Ve[e.id])?void 0:s.data)||lt[e.id],a=e.optimizedLanguages||[],o=t.jsx(p,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return t.jsx(A,{id:e.id,media:o,accessibilityLabel:`View details for ${e.title}`,children:t.jsxs(g,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[t.jsxs(p,{style:{flex:"1 1 30%",minWidth:"200px"},children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:e.title}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:["Handle: ",e.handle]})]}),t.jsx(p,{style:{flex:"0 0 15%",minWidth:"100px",textAlign:"center"},children:t.jsxs(c,{variant:"bodyMd",children:[e.productsCount," products"]})}),t.jsx(p,{style:{flex:"0 0 25%",minWidth:"160px"},children:t.jsx(g,{gap:"100",wrap:!0,children:e.hasSeoData?t.jsxs(t.Fragment,{children:[be.map(e=>t.jsx(f,{tone:a.includes(e)?"success":"subdued",size:"small",children:e.toUpperCase()},e)),e.aiEnhanced&&t.jsx(f,{tone:"info",size:"small",children:"AI✨"})]}):t.jsx(f,{tone:"subdued",children:"No AI Search Optimisation"})})}),t.jsxs(p,{style:{flex:"0 0 15%",minWidth:"120px"},children:[l&&t.jsx(h,{size:"slim",onClick:()=>{ct(i),ot(!0)},children:"Preview JSON"}),!l&&e.hasSeoData&&t.jsx(h,{size:"slim",loading:dt,onClick:()=>(async e=>{ut(!0);try{const t=`/collections/${e.split("/").pop()}/seo-data?shop=${encodeURIComponent(z)}`,n=await E(t);ct(n),ot(!0)}catch(t){pt(404===(null==t?void 0:t.status)?"No SEO data found for this collection":"Failed to load SEO data")}finally{ut(!1)}})(e.id),children:"Preview JSON"})]})]})})},selectedItems:N,onSelectionChange:Et,selectable:!0,loading:T,totalItemsCount:W,emptyState:Ft,showHeader:!1},`collections-${L.length}-${N.length}`)]})}),Ut,Wt,Dt,Nt,qt,Bt,_t,(()=>{L.filter(e=>N.includes(e.id)).filter(e=>{var t;return(null==(t=e.optimizedLanguages)?void 0:t.length)>0});const e=()=>{const e=Mt.results;mt(!1),$t({processing:!1,current:0,total:0,currentItem:"",results:null}),e&&e.successful>0&&setTimeout(()=>{R([]),zt()},1500)};return Mt.processing?t.jsx(o,{open:gt,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:t.jsx(o.Section,{children:t.jsxs(r,{gap:"400",children:[t.jsxs(c,{variant:"bodyMd",children:["Processing: ",Mt.currentItem]}),t.jsx(d,{progress:Mt.current/Mt.total*100}),t.jsxs(c,{variant:"bodySm",tone:"subdued",children:[Mt.current," of ",Mt.total," collections (",Math.round(Mt.current/Mt.total*100),"%)"]})]})})}):null!==Mt.results?t.jsx(o,{open:gt,title:"AI Enhancement Results",onClose:e,primaryAction:{content:"Done",onAction:e},children:t.jsx(o.Section,{children:t.jsx(r,{gap:"300",children:t.jsxs(g,{gap:"400",children:[t.jsxs(p,{children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),t.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Mt.results.successful})]}),t.jsxs(p,{children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),t.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Mt.results.failed})]}),t.jsxs(p,{children:[t.jsx(c,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),t.jsx(c,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Mt.results.skipped})]})]})})})}):null})(),t.jsx(l,{open:xt,onClose:()=>ft(!1),featureName:"Collections AI Enhancement",currentPlan:Ct,errorMessage:(null==vt?void 0:vt.error)||(null==vt?void 0:vt.message),minimumPlanRequired:null==vt?void 0:vt.minimumPlanRequired}),vt&&t.jsxs(t.Fragment,{children:[t.jsx(i,{open:jt,onClose:()=>{St(!1),wt(null)},tokensRequired:vt.tokensRequired||0,tokensAvailable:vt.tokensAvailable||0,tokensNeeded:vt.tokensNeeded||0,feature:"ai-seo-collection",shop:z,needsUpgrade:vt.needsUpgrade||!1,minimumPlan:vt.minimumPlanForFeature||null,currentPlan:vt.currentPlan||Ct,returnTo:"/ai-seo/collections"}),t.jsx(a,{open:bt,onClose:()=>{yt(!1),wt(null)},feature:vt.feature||"ai-seo-collection",trialEndsAt:vt.trialEndsAt,currentPlan:vt.currentPlan||Ct,tokensRequired:vt.tokensRequired||0,onActivatePlan:async()=>{try{const e=await E("/api/billing/activate",{method:"POST",body:JSON.stringify({shop:z,endTrial:!0,returnTo:"/ai-seo/collections"})});if(e.requiresApproval&&e.confirmationUrl)return void(window.top.location.href=e.confirmationUrl);window.location.reload()}catch(e){const t=new URLSearchParams(window.location.search),n=t.get("host"),s=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(z)}&embedded=${s}&host=${encodeURIComponent(n)}`}},onPurchaseTokens:()=>{const e=new URLSearchParams(window.location.search),t=e.get("host"),n=e.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(z)}&embedded=${n}&host=${encodeURIComponent(t)}&returnTo=${encodeURIComponent("/ai-seo/collections")}`}})]}),ht&&t.jsx(C,{content:ht,onDismiss:()=>pt("")})]})}export{P as default};
