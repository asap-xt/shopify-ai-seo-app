const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-DFvIJXAC-1760773887855.js","assets/app-bridge-BvoR4-e1-1760773887855.js","assets/react-vendor-tAaa2TlE-1760773887855.js","assets/sessionFetch-CJepNHo3-1760773887855.js","assets/polaris-CFjaXhex-1760773887855.js","assets/BulkEdit-BDV3B99m-1760773887855.js","assets/StoreMetadataBanner-Cvanrp3w-1760773887855.js","assets/Collections-CEB9jqKE-1760773887855.js","assets/Sitemap-C5RJNzvB-1760773887855.js","assets/StoreMetadata-B_xd7Fu9-1760773887855.js","assets/SchemaData-Dth070Ix-1760773887855.js","assets/Settings-86zvno6v-1760773887855.js","assets/AiTesting-BJy-RmDb-1760773887855.js","assets/Billing-C7WYHB3g-1760773887855.js","assets/CleanUninstall-BW8zTo_4-1760773887855.js"])))=>i.map(i=>d[i]);
import{j as t}from"./app-bridge-BvoR4-e1-1760773887855.js";import{a as B,r as d,R as m}from"./react-vendor-tAaa2TlE-1760773887855.js";import{P as W,A as G,B as V,I as v,T as y,a as S,C as M,b as F,F as K,c as Y}from"./polaris-CFjaXhex-1760773887855.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const e of n)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function c(n){const e={};return n.integrity&&(e.integrity=n.integrity),n.referrerPolicy&&(e.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?e.credentials="include":n.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function a(n){if(n.ep)return;n.ep=!0;const e=c(n);fetch(n.href,e)}})();var U,T=B;U=T.createRoot,T.hydrateRoot;const H="modulepreload",q=function(o){return"/"+o},O={},u=function(s,c,a){let n=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));n=Promise.allSettled(c.map(i=>{if(i=q(i),i in O)return;O[i]=!0;const h=i.endsWith(".css"),j=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${j}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":H,h||(p.as="script"),p.crossOrigin="",p.href=i,l&&p.setAttribute("nonce",l),document.head.appendChild(p),h)return new Promise((_,f)=>{p.addEventListener("load",_),p.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})}))}function e(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return n.then(r=>{for(const l of r||[])l.status==="rejected"&&e(l.reason);return s().catch(e)})},I=["en","de","es","fr"],k={en:"ðŸ‡¬ðŸ‡§",de:"ðŸ‡©ðŸ‡ª",es:"ðŸ‡ªðŸ‡¸",fr:"ðŸ‡«ðŸ‡·"},N={en:"English",de:"Deutsch",es:"EspaÃ±ol",fr:"FranÃ§ais"};function J({lang:o="en",setLang:s,t:c}){const[a,n]=d.useState(!1);d.useEffect(()=>{if(!I.includes(o)){try{localStorage.setItem("app_lang","en")}catch{}typeof s=="function"&&s("en")}},[o,s]);const e=I.includes(o)?o:"en",r=t.jsx(V,{onClick:()=>n(i=>!i),disclosure:!0,children:t.jsxs(v,{gap:"200",blockAlign:"center",children:[t.jsx("span",{"aria-hidden":!0,children:k[e]}),t.jsx(y,{as:"span",variant:"bodyMd",children:N[e]})]})}),l=d.useMemo(()=>I.map(i=>({content:`${k[i]} ${N[i]}`,active:i===e,onAction:()=>{try{localStorage.setItem("app_lang",i)}catch{}typeof s=="function"&&s(i),n(!1)}})),[e,s]);return t.jsx(W,{active:a,activator:r,onClose:()=>n(!1),autofocusTarget:"first-node",children:t.jsx(G,{items:l})})}function Q({sectionTitle:o,lang:s,setLang:c,t:a}){return t.jsx(S,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",background:"bg",children:t.jsxs(v,{align:"space-between",blockAlign:"center",children:[t.jsx(y,{as:"h1",variant:"headingLg",children:o}),t.jsx(J,{lang:s,setLang:c,t:a})]})})}const D="en",b={en:()=>u(()=>import("./en-DY--Skhq-1760773887855.js"),[]),de:()=>u(()=>import("./de-BYtsvH6H-1760773887855.js"),[]),es:()=>u(()=>import("./es-Cshzw9pa-1760773887855.js"),[]),fr:()=>u(()=>import("./fr-DGTXCiho-1760773887855.js"),[])},$=Object.keys(b);function X(){try{const o=localStorage.getItem("app_lang");return $.includes(o)?o:null}catch{return null}}function Z(o){try{localStorage.setItem("app_lang",o)}catch{}}function ee(){const[o,s]=d.useState(()=>X()||D),[c,a]=d.useState({});d.useEffect(()=>{let e=!1;async function r(){const i=await(b[o]||b[D])();e||a(i.default||i)}return r(),Z(o),()=>{e=!0}},[o]);const n=d.useMemo(()=>(e,r="")=>{const l=e==null?void 0:e.split(".").reduce((i,h)=>i&&i[h]!==void 0?i[h]:void 0,c);return l!=null?String(l):r||e},[c]);return{lang:o,setLang:s,t:n,dict:c,langs:$}}const te=m.lazy(()=>u(()=>import("./Dashboard-DFvIJXAC-1760773887855.js"),__vite__mapDeps([0,1,2,3,4]))),oe=m.lazy(()=>u(()=>import("./BulkEdit-BDV3B99m-1760773887855.js"),__vite__mapDeps([5,1,2,6,4]))),ne=m.lazy(()=>u(()=>import("./Collections-CEB9jqKE-1760773887855.js"),__vite__mapDeps([7,1,2,3,6,4]))),re=m.lazy(()=>u(()=>import("./Sitemap-C5RJNzvB-1760773887855.js"),__vite__mapDeps([8,1,2,3,4]))),se=m.lazy(()=>u(()=>import("./StoreMetadata-B_xd7Fu9-1760773887855.js"),__vite__mapDeps([9,1,2,3,4]))),ae=m.lazy(()=>u(()=>import("./SchemaData-Dth070Ix-1760773887855.js"),__vite__mapDeps([10,1,2,3,4]))),ie=m.lazy(()=>(console.log("[APP] ===== LOADING SETTINGS COMPONENT ====="),u(()=>import("./Settings-86zvno6v-1760773887855.js"),__vite__mapDeps([11,1,2,3,4])))),ce=m.lazy(()=>u(()=>import("./AiTesting-BJy-RmDb-1760773887855.js"),__vite__mapDeps([12,1,2,3,4]))),le=m.lazy(()=>u(()=>import("./Billing-C7WYHB3g-1760773887855.js"),__vite__mapDeps([13,1,2,4]))),de=m.lazy(()=>u(()=>import("./CleanUninstall-BW8zTo_4-1760773887855.js"),__vite__mapDeps([14,1,2,3,4]))),ue={Polaris:{ResourceList:{sortingLabel:"Sort by"}}},z=(o,s="")=>{try{return new URLSearchParams(window.location.search).get(o)||s}catch{return s}};function he(){const o=a=>{const n=a.replace(/^\/apps\/[^/]+/,"")||"/";return console.log("[useRoute] Normalized path:",a,"â†’",n),n},[s,c]=d.useState(o(window.location.pathname));return d.useEffect(()=>{const a=()=>{const e=o(window.location.pathname);console.log("[useRoute] Location changed to:",e),c(e)};window.addEventListener("popstate",a);const n=e=>{if(console.log("[useRoute] ===== CLICK DETECTED ====="),console.log("[useRoute] e.target:",e.target),console.log("[useRoute] e.target.tagName:",e.target.tagName),console.log('[useRoute] e.target.closest("input"):',e.target.closest("input")),console.log('[useRoute] e.target.closest("button"):',e.target.closest("button")),console.log('[useRoute] e.target.closest("a"):',e.target.closest("a")),e.target.tagName!=="A"){console.log("[useRoute] Ignoring non-A click");return}const r=e.target;if(r&&r.href&&r.href.startsWith(window.location.origin)){const l=new URL(r.href).pathname;console.log("[useRoute] Navigation click detected, new path:",l),setTimeout(()=>a(),0)}};return document.addEventListener("click",n),()=>{window.removeEventListener("popstate",a),document.removeEventListener("click",n)}},[]),{path:s}}function pe({active:o,shop:s}){o==="/"||o.startsWith("/dashboard"),o.startsWith("/ai-seo"),o.startsWith("/billing"),o.startsWith("/settings");const a=new URLSearchParams(window.location.search).get("host"),n=new URLSearchParams;s&&n.set("shop",s),a&&n.set("host",a);const e=n.toString()?`?${n.toString()}`:"";return t.jsxs("ui-nav-menu",{children:[t.jsx("a",{href:`/${e}`,rel:"home",children:"Home"}),t.jsx("a",{href:`/dashboard${e}`,children:"Dashboard"}),t.jsx("a",{href:`/ai-seo${e}`,children:"Search Optimization for AI"}),t.jsx("a",{href:`/settings${e}`,children:"Settings"}),t.jsx("a",{href:`/ai-testing${e}`,children:"AI Testing"}),t.jsx("a",{href:`/billing${e}`,children:"Plans & Billing"}),t.jsx("a",{href:`/clean-uninstall${e}`,children:"Clean & Uninstall"})]})}const fe=m.memo(({shop:o,plan:s})=>{const c=o||z("shop",""),a=window.location.pathname,e=a==="/ai-seo"||a==="/ai-seo/products"?"products":a==="/ai-seo/collections"?"collections":a==="/ai-seo/sitemap"?"sitemap":a==="/ai-seo/store-metadata"?"store-metadata":a==="/ai-seo/schema-data"?"schema-data":"products",r=l=>{const i=new URLSearchParams(window.location.search),h=i.toString()?`?${i.toString()}`:"";return l==="products"?`/ai-seo${h}`:`/ai-seo/${l}${h}`};return t.jsxs("div",{children:[t.jsx(S,{paddingBlockEnd:"400",children:t.jsx(M,{children:t.jsx(S,{padding:"200",children:t.jsxs(v,{gap:"100",children:[t.jsx("a",{href:r("products"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:e==="products"?"#008060":"#f6f6f7",color:e==="products"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Products"}),t.jsx("a",{href:r("collections"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:e==="collections"?"#008060":"#f6f6f7",color:e==="collections"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Collections"}),t.jsx("a",{href:r("sitemap"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:e==="sitemap"?"#008060":"#f6f6f7",color:e==="sitemap"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Sitemap"}),t.jsx("a",{href:r("store-metadata"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:e==="store-metadata"?"#008060":"#f6f6f7",color:e==="store-metadata"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Store metadata"}),t.jsx("a",{href:r("schema-data"),style:{padding:"8px 16px",borderRadius:"4px",backgroundColor:e==="schema-data"?"#008060":"#f6f6f7",color:e==="schema-data"?"white":"#202223",textDecoration:"none",display:"inline-block"},children:"Schema Data"})]})})})}),t.jsxs("div",{children:[e==="products"&&t.jsx(oe,{shop:c,globalPlan:s}),e==="collections"&&t.jsx(ne,{shop:c,globalPlan:s}),e==="sitemap"&&t.jsx(re,{shop:c}),e==="store-metadata"&&t.jsx(se,{shop:c}),e==="schema-data"&&t.jsx(ae,{shop:c})]})]})});function ge(){const{path:o}=he(),{lang:s,setLang:c,t:a}=ee(),n=!!new URLSearchParams(window.location.search).get("host"),e=z("shop",""),[r,l]=d.useState(null);d.useEffect(()=>{const j=async()=>{const _=new URLSearchParams(window.location.search),f=_.get("shop"),P=_.get("id_token");if(f&&P)try{console.log("[APP] Performing initial token exchange for shop:",f);const g=await fetch("/token-exchange",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:f,id_token:P})});if(!g.ok){const L=await g.json();console.error("[APP] Token exchange failed:",L);return}const A=await g.json();console.log("[APP] Token exchange successful:",A);const E=new URL(window.location);E.searchParams.delete("id_token"),window.history.replaceState({},"",E),await p(f)}catch(g){console.error("[APP] Token exchange error:",g)}else f&&await p(f)},p=async _=>{var f;try{const g=await fetch("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
          query PlansMe($shop:String!) {
            plansMe(shop:$shop) {
              shop
              plan
              planKey
              priceUsd
              product_limit
              providersAllowed
              modelsSuggested
              trial {
                active
                ends_at
                days_left
              }
            }
          }
        `,variables:{shop:_}})});if(g.status===202&&(await g.json()).error==="token_exchange_required"){console.log("[APP] Token exchange required, but no id_token available"),window.location.href=`/auth?shop=${encodeURIComponent(_)}`;return}if(!g.ok){console.error("[APP] Failed to load plans:",await g.text());return}const A=await g.json(),E=(f=A==null?void 0:A.data)==null?void 0:f.plansMe;E&&l(E)}catch(P){console.error("[APP] Error loading initial data:",P)}};j()},[]);const i=d.useMemo(()=>o.startsWith("/ai-seo")?"Search Optimization for AI":o.startsWith("/billing")?"Plans & Billing":o.startsWith("/settings")?"Settings":o.startsWith("/ai-testing")?"AI Testing":o.startsWith("/clean-uninstall")?"Clean & Uninstall":"Dashboard",[o]),h=()=>o==="/"||o==="/dashboard"?t.jsx(te,{shop:e}):o.startsWith("/ai-seo")?t.jsx(fe,{shop:e,plan:r}):o==="/billing"?t.jsx(le,{shop:e}):o==="/settings"?(console.log("[APP] ===== RENDERING SETTINGS PAGE ====="),t.jsx(ie,{shop:e})):o==="/ai-testing"?(console.log("[APP] ===== RENDERING AI TESTING PAGE ====="),console.log("[APP] Path:",o),console.log("[APP] Shop:",e),t.jsx(ce,{shop:e})):o==="/clean-uninstall"?t.jsx(de,{shop:e}):t.jsx(M,{children:t.jsxs(S,{padding:"400",children:[t.jsx(y,{variant:"headingMd",children:"Page not found"}),t.jsx(S,{paddingBlockStart:"200",children:t.jsxs(y,{children:['The page "',o,'" does not exist.']})})]})});return t.jsxs(F,{i18n:ue,children:[n&&t.jsx(pe,{active:o,shop:e}),t.jsx(K,{children:t.jsxs(Y,{children:[t.jsx(Q,{sectionTitle:i,lang:s,setLang:c,t:a,shop:e}),h()]})})]})}const R=new URLSearchParams(window.location.search),w=R.get("host"),x=R.get("shop"),C=R.get("embedded")==="1";console.log("[MAIN] Public App - Host:",w,"Shop:",x);console.log("[MAIN] Full URL:",window.location.href);function me(){const[o,s]=d.useState(!1),c=d.useMemo(()=>(console.log("[MAIN] Checking for API key..."),console.log("[MAIN] window.__SHOPIFY_API_KEY:",window.__SHOPIFY_API_KEY),console.log("[MAIN] import.meta.env.VITE_SHOPIFY_API_KEY:","2749a2f6d38ff5796ed256b5c9dc70a1"),window.__SHOPIFY_API_KEY?(console.log("[MAIN] Using injected API key:",window.__SHOPIFY_API_KEY),window.__SHOPIFY_API_KEY):(console.log("[MAIN] Using env API key:","2749a2f6d38ff5796ed256b5c9dc70a1"),"2749a2f6d38ff5796ed256b5c9dc70a1")),[]);return d.useEffect(()=>{setTimeout(()=>s(!0),100)},[]),!C||!w||!x?(console.log("[MAIN] Not embedded or missing params"),t.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[t.jsx("h1",{children:"Error: App must be loaded from Shopify Admin"}),t.jsxs("p",{children:["Shop: ",x||"Missing"]}),t.jsxs("p",{children:["Host: ",w||"Missing"]}),t.jsxs("p",{children:["Embedded: ",C?"Yes":"No"]}),t.jsx("a",{href:`https://admin.shopify.com/store/${x==null?void 0:x.replace(".myshopify.com","")}/apps`,children:"Go to Shopify Admin"})]})):c?(console.log("[MAIN] App config:",{apiKey:c?"SET":"MISSING",host:w?"SET":"MISSING",shop:x?"SET":"MISSING"}),o?t.jsx(ge,{}):t.jsx("div",{children:"Loading..."})):t.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[t.jsx("h1",{children:"Configuration Error"}),t.jsx("p",{children:"Shopify API key is not configured."}),t.jsx("p",{children:"Please contact support."})]})}U(document.getElementById("root")).render(t.jsx(me,{}));export{ee as u};
