[build]
builder = "NIXPACKS"
buildCommand = "echo '=== CLEAN BUILD ===' && rm -rf frontend/dist && npm install && cd frontend && rm -rf dist && npm install && npm run build && echo '=== VERIFYING BUILD ===' && ls -la dist/assets/index-*.js && grep -o 'index-[a-zA-Z0-9_-]*\\.js' dist/index.html && echo '=== FORCING OVERWRITE ===' && touch dist/index.html && cd .."

[deploy]
startCommand = "npm start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[healthcheck]
path = "/health"
port = 8080
initialDelaySeconds = 10
timeoutSeconds = 30
periodSeconds = 10
successThreshold = 1
failureThreshold = 3