# üéÅ –°–∏—Å—Ç–µ–º–∞ –∑–∞ Billing, –ü—Ä–æ–º–æ—Ü–∏–∏ –∏ –ë–µ–∑–ø–ª–∞—Ç–µ–Ω –î–æ—Å—Ç—ä–ø

## üìã –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ
1. [–û–±–∑–æ—Ä –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞](#–æ–±–∑–æ—Ä-–Ω–∞-—Å–∏—Å—Ç–µ–º–∞—Ç–∞)
2. [3 –Ω–∞—á–∏–Ω–∞ –∑–∞ –±–µ–∑–ø–ª–∞—Ç–µ–Ω –¥–æ—Å—Ç—ä–ø](#3-–Ω–∞—á–∏–Ω–∞-–∑–∞-–±–µ–∑–ø–ª–∞—Ç–µ–Ω-–¥–æ—Å—Ç—ä–ø)
3. [–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –ª–∏–Ω–∫–æ–≤–µ (URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∏)](#–º–∞—Ä–∫–µ—Ç–∏–Ω–≥-–ª–∏–Ω–∫–æ–≤–µ-url-–ø–∞—Ä–∞–º–µ—Ç—Ä–∏)
4. [Promo –∫–æ–¥–æ–≤–µ](#promo-–∫–æ–¥–æ–≤–µ)
5. [Allowlist (—Ä—ä—á–µ–Ω —Å–ø–∏—Å—ä–∫)](#allowlist-—Ä—ä—á–µ–Ω-—Å–ø–∏—Å—ä–∫)
6. [EXEMPT_SHOPS (env variable)](#exempt_shops-env-variable)
7. [–ö–∞–∫ –¥–∞ —Ç–µ—Å—Ç–≤–∞–º](#–∫–∞–∫-–¥–∞-—Ç–µ—Å—Ç–≤–∞–º)
8. [Admin API Reference](#admin-api-reference)

---

## –û–±–∑–æ—Ä –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞

–°–∏—Å—Ç–µ–º–∞—Ç–∞ –ø–æ–∑–≤–æ–ª—è–≤–∞ **3 –Ω–∞—á–∏–Ω–∞** –¥–∞ –¥–∞–¥–µ—à –±–µ–∑–ø–ª–∞—Ç–µ–Ω –∏–ª–∏ –ø—Ä–æ–º–æ—Ü–∏–æ–Ω–∞–ª–µ–Ω –¥–æ—Å—Ç—ä–ø –Ω–∞ –º–∞–≥–∞–∑–∏–Ω–∏:

| –ú–µ—Ç–æ–¥ | –ö–æ–≥–∞ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ | –ö–æ–π –≥–æ –∑–∞–¥–µ–π—Å—Ç–≤–∞ |
|-------|------------------|------------------|
| **EXEMPT_SHOPS** | –¢–≤–æ–∏ –º–∞–≥–∞–∑–∏–Ω–∏, –ø–∞—Ä—Ç–Ω—å–æ—Ä–∏, –ø–æ—Å—Ç–æ—è–Ω–µ–Ω –±–µ–∑–ø–ª–∞—Ç–µ–Ω –¥–æ—Å—Ç—ä–ø | –¢–∏ (–≤ Railway variables) |
| **Promo –∫–æ–¥–æ–≤–µ** | –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∫–∞–º–ø–∞–Ω–∏–∏, –µ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∏ –ø—Ä–æ–º–æ—Ü–∏–∏ | –ö–ª–∏–µ–Ω—Ç—ä—Ç –≤—ä–≤–µ–∂–¥–∞ –∫–æ–¥ |
| **Allowlist** | –†—ä—á–Ω–æ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω –º–∞–≥–∞–∑–∏–Ω | –¢–∏ (—á—Ä–µ–∑ API) |
| **URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∏** | Tracking –Ω–∞ –∫–∞–º–ø–∞–Ω–∏–∏ + –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏ –ø—Ä–æ–º–æ—Ü–∏–∏ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç –ª–∏–Ω–∫–∞ |

---

## 3 –Ω–∞—á–∏–Ω–∞ –∑–∞ –±–µ–∑–ø–ª–∞—Ç–µ–Ω –¥–æ—Å—Ç—ä–ø

### üî¥ –†–∞–∑–ª–∏–∫–∞ –º–µ–∂–¥—É —Ç—è—Ö:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                     ‚îÇ
‚îÇ  EXEMPT_SHOPS (env variable)                                        ‚îÇ
‚îÇ  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê                                       ‚îÇ
‚îÇ  ‚Ä¢ –ü–æ—Å—Ç–æ—è–Ω–µ–Ω –±–µ–∑–ø–ª–∞—Ç–µ–Ω Enterprise –¥–æ—Å—Ç—ä–ø                            ‚îÇ
‚îÇ  ‚Ä¢ –ù–∏–∫–æ–≥–∞ –Ω–µ —Å–µ —Ç–∞–∫—Å—É–≤–∞                                             ‚îÇ
‚îÇ  ‚Ä¢ –î–æ–±–∞–≤—è—à —Ä—ä—á–Ω–æ –≤ Railway                                          ‚îÇ
‚îÇ  ‚Ä¢ –ü—Ä–∏–º–µ—Ä: —Ç–≤–æ–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–∏ –º–∞–≥–∞–∑–∏–Ω–∏, –ø–∞—Ä—Ç–Ω—å–æ—Ä–∏                       ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ  Promo –∫–æ–¥–æ–≤–µ                                                       ‚îÇ
‚îÇ  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê                                                      ‚îÇ
‚îÇ  ‚Ä¢ –ì–µ–Ω–µ—Ä–∏—Ä–∞—à –∫–æ–¥–æ–≤–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª–Ω–æ                                   ‚îÇ
‚îÇ  ‚Ä¢ –ö–ª–∏–µ–Ω—Ç—ä—Ç –≤—ä–≤–µ–∂–¥–∞ –∫–æ–¥–∞ –ø—Ä–∏ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è                             ‚îÇ
‚îÇ  ‚Ä¢ –ò–º–∞ –ª–∏–º–∏—Ç –Ω–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–∏—è –∏ —Å—Ä–æ–∫ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç                     ‚îÇ
‚îÇ  ‚Ä¢ –ü—Ä–∏–º–µ—Ä: LAUNCH2025, FREEMONTH, PARTNER50                         ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ  Allowlist                                                          ‚îÇ
‚îÇ  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê                                                          ‚îÇ
‚îÇ  ‚Ä¢ –î–æ–±–∞–≤—è—à –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω –º–∞–≥–∞–∑–∏–Ω —Ä—ä—á–Ω–æ —á—Ä–µ–∑ API                         ‚îÇ
‚îÇ  ‚Ä¢ –ó–∞ —Å–ø–µ—Ü–∏–∞–ª–Ω–∏ —Å–ª—É—á–∞–∏ (–∏–Ω—Ñ–ª—É–µ–Ω—Å—ä—Ä–∏, –ø–æ–¥–¥—Ä—ä–∂–∫–∞)                     ‚îÇ
‚îÇ  ‚Ä¢ –ò–º–∞ —Å—Ä–æ–∫ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç                                            ‚îÇ
‚îÇ  ‚Ä¢ –ü—Ä–∏–º–µ—Ä: –¥–∞–≤–∞—à 30 –¥–Ω–∏ –±–µ–∑–ø–ª–∞—Ç–Ω–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç —Å –ø—Ä–æ–±–ª–µ–º               ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ  URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ (–º–∞—Ä–∫–µ—Ç–∏–Ω–≥ –ª–∏–Ω–∫–æ–≤–µ)                                  ‚îÇ
‚îÇ  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê                                  ‚îÇ
‚îÇ  ‚Ä¢ Tracking –æ—Ç–∫—ä–¥–µ –∏–¥–≤–∞ –∫–ª–∏–µ–Ω—Ç—ä—Ç                                    ‚îÇ
‚îÇ  ‚Ä¢ –ú–æ–∂–µ –¥–∞ —Å—ä–¥—ä—Ä–∂–∞ promo –∫–æ–¥ –≤ –ª–∏–Ω–∫–∞                                ‚îÇ
‚îÇ  ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–µ –ø—Ä–∏–ª–∞–≥–∞ –ø—Ä–∏ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è                            ‚îÇ
‚îÇ  ‚Ä¢ –ü—Ä–∏–º–µ—Ä: ?ref=facebook&promo=SUMMER30                             ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –ª–∏–Ω–∫–æ–≤–µ (URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∏)

### –ö–∞–∫–≤–æ –µ —Ç–æ–≤–∞?

–ö–æ–≥–∞—Ç–æ —Å–ø–æ–¥–µ–ª—è—à –ª–∏–Ω–∫ –∫—ä–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ, –º–æ–∂–µ—à –¥–∞ –¥–æ–±–∞–≤–∏—à –ø–∞—Ä–∞–º–µ—Ç—Ä–∏, –∫–æ–∏—Ç–æ:
1. **Tracking** - –¥–∞ –∑–Ω–∞–µ—à –æ—Ç–∫—ä–¥–µ –∏–¥–≤–∞—Ç –∫–ª–∏–µ–Ω—Ç–∏—Ç–µ
2. **Promo** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–∞ —Å–µ –ø—Ä–∏–ª–æ–∂–∏ –ø—Ä–æ–º–æ—Ü–∏—è

### –§–æ—Ä–º–∞—Ç –Ω–∞ –ª–∏–Ω–∫–∞:

```
https://apps.shopify.com/—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?ref=–ò–ó–¢–û–ß–ù–ò–ö&promo=–ö–û–î
```

### –ü—Ä–∏–º–µ—Ä–∏:

```bash
# –°–∞–º–æ tracking (–±–µ–∑ –ø—Ä–æ–º–æ—Ü–∏—è)
https://apps.shopify.com/—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?ref=facebook_ad

# –°–∞–º–æ tracking —Å campaign
https://apps.shopify.com/—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?campaign=launch2025

# Promo –∫–æ–¥ –≤ –ª–∏–Ω–∫–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–µ –ø—Ä–∏–ª–∞–≥–∞)
https://apps.shopify.com/—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?promo=FREEMONTH

# –ö–æ–º–±–∏–Ω–∞—Ü–∏—è - tracking + promo
https://apps.shopify.com/—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?ref=partner_agency&promo=AGENCY30

# –ó–∞ –ø–∞—Ä—Ç–Ω—å–æ—Ä—Å–∫–∞ –∞–≥–µ–Ω—Ü–∏—è
https://apps.shopify.com/—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?ref=agency_webdesign&promo=WEBDESIGN2025
```

### –ö–∞–∫–≤–æ —Å–µ —Å–ª—É—á–≤–∞ –ø—Ä–∏ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è:

1. –ö–ª–∏–µ–Ω—Ç—ä—Ç –∫–ª–∏–∫–≤–∞ –ª–∏–Ω–∫–∞
2. –°–∏—Å—Ç–µ–º–∞—Ç–∞ –∑–∞–ø–æ–º–Ω—è `ref` –∏ `promo` –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—Ç–µ
3. –ü—Ä–∏ OAuth callback:
   - –ü—Ä–æ–≤–µ—Ä—è–≤–∞ —Å–µ –¥–∞–ª–∏ `promo` –∫–æ–¥—ä—Ç –µ –≤–∞–ª–∏–¥–µ–Ω
   - –ê–∫–æ –µ –≤–∞–ª–∏–¥–µ–Ω - –ø—Ä–∏–ª–∞–≥–∞ —Å–µ (—É–¥—ä–ª–∂–µ–Ω trial, –±–µ–∑–ø–ª–∞—Ç–µ–Ω –¥–æ—Å—Ç—ä–ø, –∏ —Ç.–Ω.)
   - `ref` —Å–µ –∑–∞–ø–∏—Å–≤–∞ –≤ –±–∞–∑–∞—Ç–∞ –∑–∞ analytics

### –ö–∞–∫–≤–æ —Å–µ –∑–∞–ø–∏—Å–≤–∞ –≤ –±–∞–∑–∞—Ç–∞:

–í `Shop` –¥–æ–∫—É–º–µ–Ω—Ç–∞:
```javascript
{
  shop: "example.myshopify.com",
  campaignSource: "facebook_ad",     // –æ—Ç ?ref= –ø–∞—Ä–∞–º–µ—Ç—ä—Ä–∞
  promoCode: "FREEMONTH",            // –æ—Ç ?promo= –ø–∞—Ä–∞–º–µ—Ç—ä—Ä–∞
  promoType: "free_month",           // —Ç–∏–ø—ä—Ç –Ω–∞ –ø—Ä–æ–º–æ—Ü–∏—è—Ç–∞
  hasPromoEligibility: true          // –∏–º–∞ –ª–∏ –∞–∫—Ç–∏–≤–Ω–∞ –ø—Ä–æ–º–æ—Ü–∏—è
}
```

---

## Promo –∫–æ–¥–æ–≤–µ

### –¢–∏–ø–æ–≤–µ promo –∫–æ–¥–æ–≤–µ:

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–∞–∫–≤–æ –ø–æ–ª—É—á–∞–≤–∞ –∫–ª–∏–µ–Ω—Ç—ä—Ç |
|-----|----------|-------------------------|
| `free_trial_extended` | –£–¥—ä–ª–∂–µ–Ω trial –ø–µ—Ä–∏–æ–¥ | –ù–∞–ø—Ä–∏–º–µ—Ä 30 –¥–Ω–∏ –≤–º–µ—Å—Ç–æ 5 |
| `free_month` | 1 –º–µ—Å–µ—Ü –±–µ–∑–ø–ª–∞—Ç–Ω–æ | 30 –¥–Ω–∏ trial |
| `free_enterprise` | –ë–µ–∑–ø–ª–∞—Ç–µ–Ω Enterprise | –ü—ä–ª–µ–Ω –¥–æ—Å—Ç—ä–ø, –±–µ–∑ —Ç–∞–∫—Å—É–≤–∞–Ω–µ |
| `discount_percent` | –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞ –æ—Ç—Å—Ç—ä–ø–∫–∞ | –ó–∞–ø–∏—Å–≤–∞ —Å–µ –∑–∞ —Å–ø—Ä–∞–≤–∫–∞* |

*Shopify –Ω–µ –ø–æ–¥–¥—ä—Ä–∂–∞ –¥–∏—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∏ –æ—Ç—Å—Ç—ä–ø–∫–∞ –≤ Billing API, –Ω–æ –º–æ–∂–µ—à –¥–∞ –≥–æ –∏–∑–ø–æ–ª–∑–≤–∞—à –∑–∞ tracking.

### –ö–∞–∫ –¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞—à promo –∫–æ–¥–æ–≤–µ:

```bash
# –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ 10 –∫–æ–¥–∞ –∑–∞ 30-–¥–Ω–µ–≤–µ–Ω –±–µ–∑–ø–ª–∞—Ç–µ–Ω trial
curl -X POST https://—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.railway.app/api/billing/admin/promo/generate \
  -H "Authorization: Bearer –¢–í–û–Ø–¢_ADMIN_SECRET" \
  -H "Content-Type: application/json" \
  -d '{
    "count": 10,
    "prefix": "LAUNCH",
    "type": "free_month",
    "trialDays": 30,
    "maxUses": 1,
    "expiresInDays": 90,
    "campaign": "launch2025",
    "notes": "–ö–æ–¥–æ–≤–µ –∑–∞ launch –∫–∞–º–ø–∞–Ω–∏—è"
  }'
```

**–û—Ç–≥–æ–≤–æ—Ä:**
```json
{
  "success": true,
  "count": 10,
  "codes": [
    "LAUNCH-A3F2B1C4",
    "LAUNCH-D5E6F7G8",
    "LAUNCH-H9I0J1K2",
    ...
  ]
}
```

### –ö–∞–∫ –∫–ª–∏–µ–Ω—Ç—ä—Ç –∏–∑–ø–æ–ª–∑–≤–∞ promo –∫–æ–¥:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –í URL-–∞**
```
https://apps.shopify.com/—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?promo=LAUNCH-A3F2B1C4
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–∏ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è** (–∞–∫–æ –¥–æ–±–∞–≤–∏—à UI –∑–∞ –≤—ä–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ –∫–æ–¥ –≤ billing —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞)

---

## Allowlist (—Ä—ä—á–µ–Ω —Å–ø–∏—Å—ä–∫)

### –ö–æ–≥–∞ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞—à Allowlist:

- –ö–ª–∏–µ–Ω—Ç —Å –ø—Ä–æ–±–ª–µ–º, –Ω–∞ –∫–æ–≥–æ—Ç–æ –∏—Å–∫–∞—à –¥–∞ –¥–∞–¥–µ—à –±–µ–∑–ø–ª–∞—Ç–µ–Ω –ø–µ—Ä–∏–æ–¥
- –ò–Ω—Ñ–ª—É–µ–Ω—Å—ä—Ä, –∫–æ–π—Ç–æ —â–µ –ø—Ä–æ–º–æ—Ç–∏—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ
- –ü–∞—Ä—Ç–Ω—å–æ—Ä—Å–∫–∞ –∞–≥–µ–Ω—Ü–∏—è
- –ë–µ—Ç–∞ —Ç–µ—Å—Ç–µ—Ä–∏

### –ö–∞–∫ –¥–∞ –¥–æ–±–∞–≤–∏—à –º–∞–≥–∞–∑–∏–Ω –≤ Allowlist:

```bash
# –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω —Å 30 –¥–Ω–∏ –±–µ–∑–ø–ª–∞—Ç–µ–Ω trial
curl -X POST https://—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.railway.app/api/billing/admin/allowlist/add \
  -H "Authorization: Bearer –¢–í–û–Ø–¢_ADMIN_SECRET" \
  -H "Content-Type: application/json" \
  -d '{
    "shop": "example-store.myshopify.com",
    "promoType": "free_month",
    "trialDays": 30,
    "expiresInDays": 30,
    "reason": "–ò–Ω—Ñ–ª—É–µ–Ω—Å—ä—Ä –ø–∞—Ä—Ç–Ω—å–æ—Ä—Å—Ç–≤–æ",
    "campaign": "influencer_maria",
    "notes": "–î–æ–≥–æ–≤–æ—Ä–µ–Ω–æ —Å –ú–∞—Ä–∏—è –æ—Ç Instagram"
  }'
```

### –ö–∞–∫ –¥–∞ –¥–∞–¥–µ—à –±–µ–∑–ø–ª–∞—Ç–µ–Ω Enterprise –¥–æ—Å—Ç—ä–ø:

```bash
curl -X POST https://—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.railway.app/api/billing/admin/allowlist/add \
  -H "Authorization: Bearer –¢–í–û–Ø–¢_ADMIN_SECRET" \
  -H "Content-Type: application/json" \
  -d '{
    "shop": "partner-agency-client.myshopify.com",
    "promoType": "free_enterprise",
    "expiresInDays": 365,
    "reason": "–ü–∞—Ä—Ç–Ω—å–æ—Ä—Å–∫–∞ –∞–≥–µ–Ω—Ü–∏—è",
    "campaign": "partner_agency_x"
  }'
```

### –ö–∞–∫ –¥–∞ –ø—Ä–µ–º–∞—Ö–Ω–µ—à –º–∞–≥–∞–∑–∏–Ω –æ—Ç Allowlist:

```bash
curl -X DELETE "https://—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.railway.app/api/billing/admin/allowlist/remove?shop=example-store.myshopify.com" \
  -H "Authorization: Bearer –¢–í–û–Ø–¢_ADMIN_SECRET"
```

---

## EXEMPT_SHOPS (env variable)

### –ö–∞–∫–≤–æ –µ —Ç–æ–≤–∞?

–°–ø–∏—Å—ä–∫ —Å –º–∞–≥–∞–∑–∏–Ω–∏, –∫–æ–∏—Ç–æ **–Ω–∏–∫–æ–≥–∞ –Ω–µ —Å–µ —Ç–∞–∫—Å—É–≤–∞—Ç**. –ü–æ–ª—É—á–∞–≤–∞—Ç –±–µ–∑–ø–ª–∞—Ç–µ–Ω Enterprise –¥–æ—Å—Ç—ä–ø –∑–∞–≤–∏–Ω–∞–≥–∏.

### –ö–∞–∫ –¥–∞ –Ω–∞—Å—Ç—Ä–æ–∏—à:

–í Railway ‚Üí —Ç–≤–æ–µ—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí **Variables**:

```
EXEMPT_SHOPS=my-store.myshopify.com,partner-store.myshopify.com,test-store.myshopify.com
```

### –ö–∞–∫–≤–æ —Å–µ —Å–ª—É—á–≤–∞:

1. –ü—Ä–∏ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –¥–∏—Ä–µ–∫—Ç–Ω–æ –∫—ä–º Dashboard (–Ω–µ –∫—ä–º Billing)
2. –ê–∫–æ –∏–º–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â Shopify subscription ‚Üí –æ—Ç–º–µ–Ω—è —Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
3. –ü–æ–ª—É—á–∞–≤–∞ Enterprise –ø–ª–∞–Ω + 2M tokens
4. –ù–∏–∫–æ–≥–∞ –Ω–µ –≤–∏–∂–¥–∞ billing —Å—Ç—Ä–∞–Ω–∏—Ü–∞

### –ö–æ–≥–∞ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞—à:

- –¢–≤–æ–∏ —Ç–µ—Å—Ç–æ–≤–∏ –º–∞–≥–∞–∑–∏–Ω–∏
- –ü–æ—Å—Ç–æ—è–Ω–Ω–∏ –ø–∞—Ä—Ç–Ω—å–æ—Ä–∏
- –î–µ–º–æ –º–∞–≥–∞–∑–∏–Ω–∏

---

## –ö–∞–∫ –¥–∞ —Ç–µ—Å—Ç–≤–∞–º

### –¢–µ—Å—Ç 1: EXEMPT –º–∞–≥–∞–∑–∏–Ω –Ω–µ —Å–µ —Ç–∞–∫—Å—É–≤–∞

1. –î–æ–±–∞–≤–∏ —Ç–µ—Å—Ç–æ–≤ –º–∞–≥–∞–∑–∏–Ω –≤ `EXEMPT_SHOPS` –≤ Railway
2. –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –≤ —Ç–æ–∑–∏ –º–∞–≥–∞–∑–∏–Ω
3. **–û—á–∞–∫–≤–∞–Ω–æ**: –†–µ–¥–∏—Ä–µ–∫—Ç –¥–∏—Ä–µ–∫—Ç–Ω–æ –∫—ä–º Dashboard, –±–µ–∑ billing —Å—Ç—Ä–∞–Ω–∏—Ü–∞
4. –ü—Ä–æ–≤–µ—Ä–∏ –≤ –±–∞–∑–∞—Ç–∞: `shopifySubscriptionId` —Ç—Ä—è–±–≤–∞ –¥–∞ –µ `null`

### –¢–µ—Å—Ç 2: Promo –∫–æ–¥ —Ä–∞–±–æ—Ç–∏

1. –ì–µ–Ω–µ—Ä–∏—Ä–∞–π promo –∫–æ–¥:
```bash
curl -X POST https://—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.railway.app/api/billing/admin/promo/generate \
  -H "Authorization: Bearer –¢–í–û–Ø–¢_ADMIN_SECRET" \
  -H "Content-Type: application/json" \
  -d '{"count": 1, "prefix": "TEST", "type": "free_month", "trialDays": 30}'
```

2. –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ —Å URL:
```
https://admin.shopify.com/store/–¢–í–û–ô_–ú–ê–ì–ê–ó–ò–ù/oauth/authorize?client_id=XXX&...&promo=TEST-XXXX
```

3. **–û—á–∞–∫–≤–∞–Ω–æ**: Trial –ø–µ—Ä–∏–æ–¥ –æ—Ç 30 –¥–Ω–∏ –≤–º–µ—Å—Ç–æ 5

### –¢–µ—Å—Ç 3: Allowlist —Ä–∞–±–æ—Ç–∏

1. –î–æ–±–∞–≤–∏ –º–∞–≥–∞–∑–∏–Ω –≤ allowlist:
```bash
curl -X POST https://—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.railway.app/api/billing/admin/allowlist/add \
  -H "Authorization: Bearer –¢–í–û–Ø–¢_ADMIN_SECRET" \
  -H "Content-Type: application/json" \
  -d '{"shop": "test.myshopify.com", "promoType": "free_enterprise", "expiresInDays": 7}'
```

2. –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –≤ —Ç–æ–∑–∏ –º–∞–≥–∞–∑–∏–Ω

3. **–û—á–∞–∫–≤–∞–Ω–æ**: –ë–µ–∑–ø–ª–∞—Ç–µ–Ω Enterprise –¥–æ—Å—Ç—ä–ø, –±–µ–∑ Shopify subscription

### –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—Ç–∞—Ç—É—Å

```bash
curl "https://—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.railway.app/api/billing/admin/shop/promo-status?shop=example.myshopify.com" \
  -H "Authorization: Bearer –¢–í–û–Ø–¢_ADMIN_SECRET"
```

**–û—á–∞–∫–≤–∞–Ω –æ—Ç–≥–æ–≤–æ—Ä:**
```json
{
  "shop": "example.myshopify.com",
  "isExempt": false,
  "onAllowlist": true,
  "allowlistPromo": {
    "type": "free_enterprise",
    "expiresAt": "2025-01-28T..."
  },
  "subscription": {
    "plan": "enterprise",
    "status": "active",
    "shopifySubscriptionId": null
  }
}
```

### –¢–µ—Å—Ç 5: –û—Ç–º—è–Ω–∞ –Ω–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â subscription

–ê–∫–æ –º–∞–≥–∞–∑–∏–Ω –≤–µ—á–µ –∏–º–∞ –∞–∫—Ç–∏–≤–µ–Ω Shopify subscription –∏ –∏—Å–∫–∞—à –¥–∞ –≥–æ –æ—Å–≤–æ–±–æ–¥–∏—à:

```bash
curl -X POST https://—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.railway.app/api/billing/admin/shop/cancel-subscription \
  -H "Authorization: Bearer –¢–í–û–Ø–¢_ADMIN_SECRET" \
  -H "Content-Type: application/json" \
  -d '{"shop": "example.myshopify.com"}'
```

---

## Admin API Reference

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–í Railway –¥–æ–±–∞–≤–∏:
```
ADMIN_SECRET=—Ç–≤–æ—è—Ç–∞-—Å–∏–≥—É—Ä–Ω–∞-–ø–∞—Ä–æ–ª–∞
```

–í—Å–∏—á–∫–∏ admin –∑–∞—è–≤–∫–∏ –∏–∑–∏—Å–∫–≤–∞—Ç header:
```
Authorization: Bearer —Ç–≤–æ—è—Ç–∞-—Å–∏–≥—É—Ä–Ω–∞-–ø–∞—Ä–æ–ª–∞
```

### Endpoints

#### Promo –∫–æ–¥–æ–≤–µ

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/api/billing/admin/promo/generate` | –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ–¥–æ–≤–µ |
| GET | `/api/billing/admin/promo/list` | –°–ø–∏—Å—ä–∫ –Ω–∞ –∫–æ–¥–æ–≤–µ |
| GET | `/api/billing/admin/promo/check?code=XXX` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–¥ |

#### Allowlist

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/api/billing/admin/allowlist/add` | –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω |
| DELETE | `/api/billing/admin/allowlist/remove?shop=XXX` | –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ |
| GET | `/api/billing/admin/allowlist/list` | –°–ø–∏—Å—ä–∫ |

#### –ú–∞–≥–∞–∑–∏–Ω–∏

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/billing/admin/shop/promo-status?shop=XXX` | Promo —Å—Ç–∞—Ç—É—Å |
| POST | `/api/billing/admin/shop/cancel-subscription` | –û—Ç–º—è–Ω–∞ –Ω–∞ subscription |

---

## –ü—Ä–∏–º–µ—Ä–Ω–∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: Launch –∫–∞–º–ø–∞–Ω–∏—è

1. –ì–µ–Ω–µ—Ä–∏—Ä–∞–π 100 –∫–æ–¥–∞ —Å 30-–¥–Ω–µ–≤–µ–Ω trial:
```bash
curl -X POST .../api/billing/admin/promo/generate \
  -d '{"count": 100, "prefix": "LAUNCH", "type": "free_month", "trialDays": 30, "campaign": "launch2025"}'
```

2. –°–ø–æ–¥–µ–ª–∏ –ª–∏–Ω–∫–æ–≤–µ:
```
https://apps.shopify.com/—Ç–≤–æ–µ—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?ref=launch2025&promo=LAUNCH-XXXX
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–∞—Ä—Ç–Ω—å–æ—Ä—Å–∫–∞ –∞–≥–µ–Ω—Ü–∏—è

1. –î–æ–±–∞–≤–∏ –∞–≥–µ–Ω—Ü–∏—è—Ç–∞ –≤ allowlist —Å free_enterprise:
```bash
curl -X POST .../api/billing/admin/allowlist/add \
  -d '{"shop": "agency-demo.myshopify.com", "promoType": "free_enterprise", "expiresInDays": 365}'
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–¥–¥—Ä—ä–∂–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç

1. –ö–ª–∏–µ–Ω—Ç –∏–º–∞ –ø—Ä–æ–±–ª–µ–º, –∏—Å–∫–∞—à –¥–∞ –º—É –¥–∞–¥–µ—à 14 –¥–Ω–∏ –±–µ–∑–ø–ª–∞—Ç–Ω–æ:
```bash
curl -X POST .../api/billing/admin/allowlist/add \
  -d '{"shop": "unhappy-customer.myshopify.com", "promoType": "free_month", "trialDays": 14, "expiresInDays": 14, "reason": "–ü–æ–¥–¥—Ä—ä–∂–∫–∞ - –ø—Ä–æ–±–ª–µ–º —Å—ä—Å sync"}'
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–∏ –±–µ–ª–µ–∂–∫–∏

1. **EXEMPT_SHOPS** –µ –ø–æ—Å—Ç–æ—è–Ω–µ–Ω - –º–∞–≥–∞–∑–∏–Ω–∏—Ç–µ –Ω–∏–∫–æ–≥–∞ –Ω—è–º–∞ –¥–∞ –±—ä–¥–∞—Ç —Ç–∞–∫—Å—É–≤–∞–Ω–∏
2. **Allowlist** –∏–º–∞ —Å—Ä–æ–∫ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç - —Å–ª–µ–¥ –∏–∑—Ç–∏—á–∞–Ω–µ—Ç–æ –º—É –º–∞–≥–∞–∑–∏–Ω—ä—Ç —â–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–ª–∞—Ç–∏
3. **Promo –∫–æ–¥–æ–≤–µ** –∏–º–∞—Ç –ª–∏–º–∏—Ç –Ω–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–∏—è - –ø—Ä–æ–≤–µ—Ä—è–≤–∞–π —Å `/promo/list`
4. –ü—Ä–∏ **free_enterprise** –ø—Ä–æ–º–æ—Ü–∏—è - —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç–º–µ–Ω—è Shopify subscription

---

*–ü–æ—Å–ª–µ–¥–Ω–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è: –î–µ–∫–µ–º–≤—Ä–∏ 2025*

